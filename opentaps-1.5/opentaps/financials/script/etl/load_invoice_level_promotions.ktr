<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>load_invoice_level_promotions</name>
    <description>load invoice level promotios</description>
    <extended_description/>
    <trans_version/>
    <trans_status>0</trans_status>
    <directory>&#47;</directory>
    <parameters>
    </parameters>
    <log>
      <read/>
      <write/>
      <input/>
      <output/>
      <update/>
      <rejected/>
      <connection/>
      <table/>
      <step_performance_table/>
      <use_batchid>Y</use_batchid>
      <use_logfield>N</use_logfield>
      <size_limit_lines/>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
  <modified_user>-</modified_user>
  <modified_date>2008&#47;01&#47;18 16:18:00.001</modified_date>
  </info>
  <notepads>
  </notepads>
  <connection>
    <name>ofbiz_dw</name>
    <server>localhost</server>
    <type>GENERIC</type>
    <access>JNDI</access>
    <database>operational</database>
    <port>-1</port>
    <username>ofbiz</username>
    <password>Encrypted 2be98afc86aa7f2e4cb79ce7fd890a6c0</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>-1</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>N</attribute></attribute>
    </attributes>
  </connection>
  <connection>
    <name>ofbiz_ods</name>
    <server>localhost</server>
    <type>GENERIC</type>
    <access>JNDI</access>
    <database>operational</database>
    <port>-1</port>
    <username>ofbiz</username>
    <password>Encrypted 2be98afc86aa7f2e4cb79ce7fd890a6c0</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>-1</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>N</attribute></attribute>
    </attributes>
  </connection>
  <order>
  <hop> <from>Get invoice_item data</from><to>Select values #1 (hack to work with Derby)</to><enabled>Y</enabled> </hop>  <hop> <from>Get product_store_id</from><to>Lookup StoreDim</to><enabled>Y</enabled> </hop>  <hop> <from>Lookup StoreDim</from><to>Select values #2 (hack to work with Derby)</to><enabled>Y</enabled> </hop>  <hop> <from>Select values #1 (hack to work with Derby)</from><to>Extract data for DateDim</to><enabled>Y</enabled> </hop>  <hop> <from>Lookup&#47;update CurrencyDim</from><to>Get product_store_id</to><enabled>Y</enabled> </hop>  <hop> <from>Select values #2 (hack to work with Derby)</from><to>Set default values</to><enabled>Y</enabled> </hop>  <hop> <from>Lookup tax_authority keys</from><to>Lookup tax_authority_dim</to><enabled>Y</enabled> </hop>  <hop> <from>Set default values</from><to>Lookup tax_authority keys</to><enabled>Y</enabled> </hop>  <hop> <from>Lookup tax_authority_dim</from><to>Select tax_invoice_item_fact values</to><enabled>Y</enabled> </hop>  <hop> <from>Select tax_invoice_item_fact values</from><to>Sort rows</to><enabled>Y</enabled> </hop>  <hop> <from>Sort rows</from><to>Unique rows</to><enabled>Y</enabled> </hop>  <hop> <from>Insert &#47; Update tax_invoice_item_fact</from><to>Select sales_invoice_item_fact values</to><enabled>Y</enabled> </hop>  <hop> <from>Select sales_invoice_item_fact values</from><to>Sort rows 2</to><enabled>Y</enabled> </hop>  <hop> <from>Sort rows 2</from><to>Unique rows 2</to><enabled>Y</enabled> </hop>  <hop> <from>Lookup OrganizationDim</from><to>Lookup&#47;update CurrencyDim</to><enabled>Y</enabled> </hop>  <hop> <from>Unique rows 2</from><to>Add sequential key #2</to><enabled>Y</enabled> </hop>  <hop> <from>Add sequential key #2</from><to>Insert &#47; Update sales_invoice_item_fact</to><enabled>Y</enabled> </hop>  <hop> <from>Unique rows</from><to>Add sequential key #1</to><enabled>Y</enabled> </hop>  <hop> <from>Add sequential key #1</from><to>Insert &#47; Update tax_invoice_item_fact</to><enabled>Y</enabled> </hop>  <hop> <from>Extract data for DateDim</from><to>Lookup DateDim</to><enabled>Y</enabled> </hop>  <hop> <from>Lookup DateDim</from><to>Lookup OrganizationDim</to><enabled>Y</enabled> </hop>  </order>
  <step>
    <name>Add sequential key #1</name>
    <type>Sequence</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <valuename>tax_inv_item_fact_id</valuename>
      <use_database>N</use_database>
      <connection/>
      <schema/>
      <seqname>SEQ_</seqname>
      <use_counter>Y</use_counter>
      <counter_name/>
      <start_at>-1</start_at>
      <increment_by>-1</increment_by>
      <max_value>-999999999</max_value>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>948</xloc>
      <yloc>318</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Add sequential key #2</name>
    <type>Sequence</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <valuename>sales_inv_item_fact_id</valuename>
      <use_database>N</use_database>
      <connection/>
      <schema/>
      <seqname>SEQ_</seqname>
      <use_counter>Y</use_counter>
      <counter_name/>
      <start_at>-1</start_at>
      <increment_by>-1</increment_by>
      <max_value>-999999999</max_value>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>312</xloc>
      <yloc>479</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Extract data for DateDim</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <compatible>Y</compatible>
    <jsScripts>      <jsScript>        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>&#47;&#47; The fields we want to calculate
var day_of_month;
var week_of_year;
var month_of_year;
var year_number;
var quarter;
var name_day;
var name_month;
&#47;&#47; Calculate!
day_of_month = _invoice_date.Clone().dat2str(&quot;dd&quot;);
week_of_year = _invoice_date.Clone().dat2str(&quot;ww&quot;);
month_of_year = _invoice_date.Clone().dat2str(&quot;MM&quot;);
year_number = _invoice_date.Clone().dat2str(&quot;yyyy&quot;);
name_day = _invoice_date.Clone().dat2str(&quot;E&quot;).getString();
name_month = _invoice_date.Clone().dat2str(&quot;MMMM&quot;).getString();
if(month_of_year &lt;= 3) {
       quarter = &quot;Q1&quot;;
}
else if(month_of_year &lt;= 6) {
       quarter = &quot;Q2&quot;;
}
else if(month_of_year &lt;= 9) {
       quarter = &quot;Q3&quot;;
}
else {
       quarter = &quot;Q4&quot;;
}


</jsScript_script>
      </jsScript>    </jsScripts>    <fields>      <field>        <name>day_of_month</name>
        <rename>day_of_month</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>week_of_year</name>
        <rename>week_of_year</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>month_of_year</name>
        <rename>month_of_year</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>year_number</name>
        <rename>year_number</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>quarter</name>
        <rename>quarter</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>name_day</name>
        <rename>name_day</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>name_month</name>
        <rename>name_month</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>434</xloc>
      <yloc>33</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Get invoice_item data</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>ofbiz_ods</connection>
    <sql>SELECT INVOICE_ITEM.INVOICE_ID, INVOICE_ITEM_SEQ_ID,
INVOICE_ITEM.QUANTITY*INVOICE_ITEM.AMOUNT AS TOTAL_PROMOTIONS,
INVOICE.INVOICE_DATE,
INVOICE.CURRENCY_UOM_ID,
INVOICE.PARTY_ID_FROM
FROM INVOICE, INVOICE_ITEM
WHERE INVOICE_ITEM.INVOICE_ID = INVOICE.INVOICE_ID
AND INVOICE.INVOICE_TYPE_ID = &apos;SALES_INVOICE&apos;
AND INVOICE.STATUS_ID IN (&apos;INVOICE_READY&apos;, &apos;INVOICE_PAID&apos;)
AND INVOICE_ITEM.INVOICE_ITEM_TYPE_ID IN (&apos;ITM_PROMOTION_ADJ&apos;, &apos;ITM_DISCOUNT_ADJ&apos;)
AND INVOICE_ITEM.PARENT_INVOICE_ID IS NULL
AND INVOICE_ITEM.PARENT_INVOICE_ITEM_SEQ_ID IS NULL</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>48</xloc>
      <yloc>32</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Get product_store_id</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>ofbiz_ods</connection>
    <rowlimit>0</rowlimit>
    <sql>SELECT MAX(PRODUCT_STORE_ID) AS PRODUCT_STORE_ID
FROM ORDER_HEADER, ORDER_ITEM_BILLING
WHERE ORDER_ITEM_BILLING.INVOICE_ID = ?
AND ORDER_HEADER.ORDER_ID = ORDER_ITEM_BILLING.ORDER_ID</sql>
    <outer_join>N</outer_join>
    <replace_vars>N</replace_vars>
    <parameter>
      <field>
        <name>invoice_id</name>
        <type>String</type>
      </field>
    </parameter>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>951</xloc>
      <yloc>189</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Insert &#47; Update sales_invoice_item_fact</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>ofbiz_dw</connection>
    <commit>100</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema/>
      <table>SALES_INVOICE_ITEM_FACT</table>
      <key>
        <name>date_dim_id</name>
        <field>date_dim_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>store_dim_id</name>
        <field>store_dim_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>currency_dim_id</name>
        <field>currency_dim_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>invoice_id</name>
        <field>invoice_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>invoice_item_seq_id</name>
        <field>invoice_item_seq_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>date_dim_id</name>
        <rename>date_dim_id</rename>
        <update>N</update>
      </value>
      <value>
        <name>store_dim_id</name>
        <rename>store_dim_id</rename>
        <update>N</update>
      </value>
      <value>
        <name>currency_dim_id</name>
        <rename>currency_dim_id</rename>
        <update>N</update>
      </value>
      <value>
        <name>invoice_id</name>
        <rename>invoice_id</rename>
        <update>N</update>
      </value>
      <value>
        <name>invoice_item_seq_id</name>
        <rename>invoice_item_seq_id</rename>
        <update>N</update>
      </value>
      <value>
        <name>gross_amount</name>
        <rename>gross_amount</rename>
        <update>Y</update>
      </value>
      <value>
        <name>discounts</name>
        <rename>discounts</rename>
        <update>Y</update>
      </value>
      <value>
        <name>refunds</name>
        <rename>refunds</rename>
        <update>Y</update>
      </value>
      <value>
        <name>net_amount</name>
        <rename>net_amount</rename>
        <update>Y</update>
      </value>
      <value>
        <name>organization_dim_id</name>
        <rename>organization_dim_id</rename>
        <update>Y</update>
      </value>
      <value>
        <name>sales_inv_item_fact_id</name>
        <rename>sales_inv_item_fact_id</rename>
        <update>Y</update>
      </value>
    </lookup>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>135</xloc>
      <yloc>479</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Insert &#47; Update tax_invoice_item_fact</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>ofbiz_dw</connection>
    <commit>100</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema/>
      <table>TAX_INVOICE_ITEM_FACT</table>
      <key>
        <name>date_dim_id</name>
        <field>date_dim_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>store_dim_id</name>
        <field>store_dim_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>tax_authority_dim_id</name>
        <field>tax_authority_dim_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>currency_dim_id</name>
        <field>currency_dim_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>invoice_id</name>
        <field>invoice_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>invoice_item_seq_id</name>
        <field>invoice_item_seq_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>date_dim_id</name>
        <rename>date_dim_id</rename>
        <update>N</update>
      </value>
      <value>
        <name>store_dim_id</name>
        <rename>store_dim_id</rename>
        <update>N</update>
      </value>
      <value>
        <name>tax_authority_dim_id</name>
        <rename>tax_authority_dim_id</rename>
        <update>N</update>
      </value>
      <value>
        <name>currency_dim_id</name>
        <rename>currency_dim_id</rename>
        <update>N</update>
      </value>
      <value>
        <name>invoice_id</name>
        <rename>invoice_id</rename>
        <update>N</update>
      </value>
      <value>
        <name>invoice_item_seq_id</name>
        <rename>invoice_item_seq_id</rename>
        <update>N</update>
      </value>
      <value>
        <name>gross_amount</name>
        <rename>gross_amount</rename>
        <update>Y</update>
      </value>
      <value>
        <name>discounts</name>
        <rename>discounts</rename>
        <update>Y</update>
      </value>
      <value>
        <name>refunds</name>
        <rename>refunds</rename>
        <update>Y</update>
      </value>
      <value>
        <name>net_amount</name>
        <rename>net_amount</rename>
        <update>Y</update>
      </value>
      <value>
        <name>tax_due</name>
        <rename>tax_due</rename>
        <update>Y</update>
      </value>
      <value>
        <name>taxable</name>
        <rename>taxable</rename>
        <update>Y</update>
      </value>
      <value>
        <name>organization_dim_id</name>
        <rename>organization_dim_id</rename>
        <update>Y</update>
      </value>
      <value>
        <name>tax_inv_item_fact_id</name>
        <rename>tax_inv_item_fact_id</rename>
        <update>Y</update>
      </value>
    </lookup>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>947</xloc>
      <yloc>397</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Lookup OrganizationDim</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>ofbiz_dw</connection>
    <cache>Y</cache>
    <cache_load_all>Y</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema/>
      <table>ORGANIZATION_DIM</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>N</eat_row_on_failure>
      <key>
        <name>organization_party_id</name>
        <field>organization_party_id</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>organization_dim_id</name>
        <rename>organization_dim_id</rename>
        <default>0</default>
        <type>Integer</type>
      </value>
    </lookup>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>763</xloc>
      <yloc>32</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Lookup StoreDim</name>
    <type>DimensionLookup</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <schema/>
      <table>STORE_DIM</table>
      <connection>ofbiz_dw</connection>
      <commit>100</commit>
      <update>Y</update>
      <fields>
        <key>
          <name>product_store_id</name>
          <lookup>product_store_id</lookup>
        </key>
        <date>
          <name/>
          <from>date_from</from>
          <to>date_to</to>
        </date>
        <return>
          <name>store_dim_id</name>
          <rename/>
          <creation_method>tablemax</creation_method>
          <use_autoinc>N</use_autoinc>
          <version>dim_version</version>
        </return>
      </fields>
      <sequence/>
      <min_year>1974</min_year>
      <max_year>2199</max_year>
      <cache_size>5000</cache_size>
      <preload_cache>N</preload_cache>
      <use_start_date_alternative>N</use_start_date_alternative>
      <start_date_alternative>none</start_date_alternative>
      <start_date_field_name/>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>715</xloc>
      <yloc>189</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Lookup tax_authority keys</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>ofbiz_ods</connection>
    <rowlimit>0</rowlimit>
    <sql>SELECT TAX_AUTH_PARTY_ID, TAX_AUTH_GEO_ID
FROM INVOICE_ITEM
WHERE PARENT_INVOICE_ID = ?
AND INVOICE_ITEM_TYPE_ID = &apos;ITM_SALES_TAX&apos;</sql>
    <outer_join>N</outer_join>
    <replace_vars>N</replace_vars>
    <parameter>
      <field>
        <name>invoice_id</name>
        <type>String</type>
      </field>
    </parameter>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>64</xloc>
      <yloc>189</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Lookup tax_authority_dim</name>
    <type>DimensionLookup</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <schema/>
      <table>TAX_AUTHORITY_DIM</table>
      <connection>ofbiz_dw</connection>
      <commit>100</commit>
      <update>Y</update>
      <fields>
        <key>
          <name>tax_auth_party_id</name>
          <lookup>tax_auth_party_id</lookup>
        </key>
        <key>
          <name>tax_auth_geo_id</name>
          <lookup>tax_auth_geo_id</lookup>
        </key>
        <date>
          <name/>
          <from>date_from</from>
          <to>date_to</to>
        </date>
        <return>
          <name>tax_authority_dim_id</name>
          <rename/>
          <creation_method>tablemax</creation_method>
          <use_autoinc>N</use_autoinc>
          <version>dim_version</version>
        </return>
      </fields>
      <sequence/>
      <min_year>1974</min_year>
      <max_year>2199</max_year>
      <cache_size>5000</cache_size>
      <preload_cache>N</preload_cache>
      <use_start_date_alternative>N</use_start_date_alternative>
      <start_date_alternative>none</start_date_alternative>
      <start_date_field_name/>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>62</xloc>
      <yloc>320</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Lookup&#47;update CurrencyDim</name>
    <type>DimensionLookup</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <schema/>
      <table>CURRENCY_DIM</table>
      <connection>ofbiz_dw</connection>
      <commit>100</commit>
      <update>Y</update>
      <fields>
        <key>
          <name>uom_id</name>
          <lookup>uom_id</lookup>
        </key>
        <date>
          <name/>
          <from>date_from</from>
          <to>date_to</to>
        </date>
        <return>
          <name>currency_dim_id</name>
          <rename/>
          <creation_method>tablemax</creation_method>
          <use_autoinc>N</use_autoinc>
          <version>dim_version</version>
        </return>
      </fields>
      <sequence/>
      <min_year>1974</min_year>
      <max_year>2199</max_year>
      <cache_size>5000</cache_size>
      <preload_cache>N</preload_cache>
      <use_start_date_alternative>N</use_start_date_alternative>
      <start_date_alternative>none</start_date_alternative>
      <start_date_field_name/>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>950</xloc>
      <yloc>32</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Select sales_invoice_item_fact values</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <fields>      <field>        <name>date_dim_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>store_dim_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>currency_dim_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>invoice_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>invoice_item_seq_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>gross_amount</name>
        <rename/>
        <length>17</length>
        <precision>2</precision>
      </field>      <field>        <name>discounts</name>
        <rename/>
        <length>17</length>
        <precision>2</precision>
      </field>      <field>        <name>refunds</name>
        <rename/>
        <length>17</length>
        <precision>2</precision>
      </field>      <field>        <name>net_amount</name>
        <rename/>
        <length>17</length>
        <precision>2</precision>
      </field>      <field>        <name>organization_dim_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>        <select_unspecified>N</select_unspecified>
    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>952</xloc>
      <yloc>478</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Select tax_invoice_item_fact values</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <fields>      <field>        <name>date_dim_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>store_dim_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>tax_authority_dim_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>currency_dim_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>invoice_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>invoice_item_seq_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>totalSalesAmount</name>
        <rename>gross_amount</rename>
        <length>17</length>
        <precision>2</precision>
      </field>      <field>        <name>totalPromotions</name>
        <rename>discounts</rename>
        <length>17</length>
        <precision>2</precision>
      </field>      <field>        <name>totalRefunds</name>
        <rename>refunds</rename>
        <length>17</length>
        <precision>2</precision>
      </field>      <field>        <name>netAmount</name>
        <rename>net_amount</rename>
        <length>17</length>
        <precision>2</precision>
      </field>      <field>        <name>taxDue</name>
        <rename>tax_due</rename>
        <length>17</length>
        <precision>2</precision>
      </field>      <field>        <name>taxable</name>
        <rename/>
        <length>17</length>
        <precision>2</precision>
      </field>      <field>        <name>organization_dim_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>        <select_unspecified>N</select_unspecified>
    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>260</xloc>
      <yloc>321</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Select values #1 (hack to work with Derby)</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <fields>      <field>        <name>invoice_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>invoice_item_seq_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>total_promotions</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>invoice_date</name>
        <rename>_invoice_date</rename>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>currency_uom_id</name>
        <rename>uom_id</rename>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>party_id_from</name>
        <rename>organization_party_id</rename>
        <length>-2</length>
        <precision>-2</precision>
      </field>        <select_unspecified>N</select_unspecified>
    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>238</xloc>
      <yloc>32</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Select values #2 (hack to work with Derby)</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <fields>      <field>        <name>invoice_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>invoice_item_seq_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>_invoice_date</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>day_of_month</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>week_of_year</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>month_of_year</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>year_number</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>quarter</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>name_day</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>name_month</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>date_dim_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>total_promotions</name>
        <rename>_total_promotions</rename>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>product_store_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>store_dim_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>currency_dim_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>      <field>        <name>organization_dim_id</name>
        <rename/>
        <length>-2</length>
        <precision>-2</precision>
      </field>        <select_unspecified>N</select_unspecified>
    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>512</xloc>
      <yloc>189</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Set default values</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <compatible>Y</compatible>
    <jsScripts>      <jsScript>        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>var totalSalesAmount = 0.00;
var totalPromotions = 0.00;
var totalRefunds = 0.00;
var totalPromotionRefundAdj = 0.00;
var netAmount = 0.00;
var taxable = 0.00;
var taxDue = 0.00;

if (_total_promotions.getNumber() != null) 
{
    totalPromotions = _total_promotions.Clone();
    netAmount = _total_promotions.Clone();
    taxable = _total_promotions.Clone();
}


</jsScript_script>
      </jsScript>    </jsScripts>    <fields>      <field>        <name>totalSalesAmount</name>
        <rename>totalSalesAmount</rename>
        <type>Number</type>
        <length>17</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>      <field>        <name>totalPromotions</name>
        <rename>totalPromotions</rename>
        <type>Number</type>
        <length>17</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>      <field>        <name>totalRefunds</name>
        <rename>totalRefunds</rename>
        <type>Number</type>
        <length>17</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>      <field>        <name>totalPromotionRefundAdj</name>
        <rename>totalPromotionRefundAdj</rename>
        <type>Number</type>
        <length>17</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>      <field>        <name>netAmount</name>
        <rename>netAmount</rename>
        <type>Number</type>
        <length>17</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>      <field>        <name>taxDue</name>
        <rename>taxDue</rename>
        <type>Number</type>
        <length>17</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>      <field>        <name>taxable</name>
        <rename>taxable</rename>
        <type>Number</type>
        <length>17</length>
        <precision>2</precision>
        <replace>N</replace>
      </field>    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>245</xloc>
      <yloc>189</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Sort rows</name>
    <type>SortRows</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <directory>%%java.io.tmpdir%%</directory>
      <prefix>out</prefix>
      <sort_size/>
      <free_memory>25</free_memory>
      <compress>N</compress>
      <compress_variable/>
      <unique_rows>N</unique_rows>
    <fields>
      <field>
        <name>date_dim_id</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
      <field>
        <name>store_dim_id</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
      <field>
        <name>tax_authority_dim_id</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
      <field>
        <name>currency_dim_id</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
      <field>
        <name>invoice_id</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
      <field>
        <name>invoice_item_seq_id</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
      <field>
        <name>gross_amount</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
      <field>
        <name>discounts</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
      <field>
        <name>refunds</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
      <field>
        <name>net_amount</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
      <field>
        <name>tax_due</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
    </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>464</xloc>
      <yloc>321</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Sort rows 2</name>
    <type>SortRows</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <directory>%%java.io.tmpdir%%</directory>
      <prefix>out</prefix>
      <sort_size/>
      <free_memory>25</free_memory>
      <compress>N</compress>
      <compress_variable/>
      <unique_rows>N</unique_rows>
    <fields>
      <field>
        <name>date_dim_id</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
      <field>
        <name>store_dim_id</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
      <field>
        <name>currency_dim_id</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
      <field>
        <name>invoice_id</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
      <field>
        <name>invoice_item_seq_id</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
      <field>
        <name>gross_amount</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
      <field>
        <name>discounts</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
      <field>
        <name>refunds</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
      <field>
        <name>net_amount</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
      </field>
    </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>724</xloc>
      <yloc>478</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Unique rows</name>
    <type>Unique</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <count_rows>N</count_rows>
      <count_field/>
    <fields>      <field>        <name>date_dim_id</name>
        <case_insensitive>N</case_insensitive>
        </field>      <field>        <name>store_dim_id</name>
        <case_insensitive>N</case_insensitive>
        </field>      <field>        <name>tax_authority_dim_id</name>
        <case_insensitive>N</case_insensitive>
        </field>      <field>        <name>currency_dim_id</name>
        <case_insensitive>N</case_insensitive>
        </field>      <field>        <name>invoice_id</name>
        <case_insensitive>N</case_insensitive>
        </field>      <field>        <name>invoice_item_seq_id</name>
        <case_insensitive>N</case_insensitive>
        </field>      <field>        <name>gross_amount</name>
        <case_insensitive>N</case_insensitive>
        </field>      <field>        <name>discounts</name>
        <case_insensitive>N</case_insensitive>
        </field>      <field>        <name>refunds</name>
        <case_insensitive>N</case_insensitive>
        </field>      <field>        <name>net_amount</name>
        <case_insensitive>N</case_insensitive>
        </field>      <field>        <name>tax_due</name>
        <case_insensitive>N</case_insensitive>
        </field>      </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>717</xloc>
      <yloc>321</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Unique rows 2</name>
    <type>Unique</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <count_rows>N</count_rows>
      <count_field/>
    <fields>      <field>        <name>date_dim_id</name>
        <case_insensitive>N</case_insensitive>
        </field>      <field>        <name>store_dim_id</name>
        <case_insensitive>N</case_insensitive>
        </field>      <field>        <name>currency_dim_id</name>
        <case_insensitive>N</case_insensitive>
        </field>      <field>        <name>invoice_id</name>
        <case_insensitive>N</case_insensitive>
        </field>      <field>        <name>invoice_item_seq_id</name>
        <case_insensitive>N</case_insensitive>
        </field>      <field>        <name>gross_amount</name>
        <case_insensitive>N</case_insensitive>
        </field>      <field>        <name>discounts</name>
        <case_insensitive>N</case_insensitive>
        </field>      <field>        <name>refunds</name>
        <case_insensitive>N</case_insensitive>
        </field>      <field>        <name>net_amount</name>
        <case_insensitive>N</case_insensitive>
        </field>      </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>477</xloc>
      <yloc>478</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Lookup DateDim</name>
    <type>DBLookup</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>ofbiz_dw</connection>
    <cache>Y</cache>
    <cache_load_all>N</cache_load_all>
    <cache_size>0</cache_size>
    <lookup>
      <schema/>
      <table>DATE_DIM</table>
      <orderby/>
      <fail_on_multiple>N</fail_on_multiple>
      <eat_row_on_failure>N</eat_row_on_failure>
      <key>
        <name>day_of_month</name>
        <field>day_of_month</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>month_of_year</name>
        <field>month_of_year</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>year_number</name>
        <field>year_number</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>date_dim_id</name>
        <rename>date_dim_id</rename>
        <default/>
        <type>Integer</type>
      </value>
    </lookup>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>593</xloc>
      <yloc>32</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step_error_handling>
  </step_error_handling>
   <slave-step-copy-partition-distribution>
</slave-step-copy-partition-distribution>
   <slave_transformation>N</slave_transformation>
</transformation>
