
if(!Object.create){Object.create=(function(){var Klass=function(){},proto=Klass.prototype;function create(baseProto){Klass.prototype=baseProto||{};var instance=new Klass();Klass.prototype=proto;return instance;}
return create;}());}
if(!String.prototype.endsWith){String.prototype.endsWith=function(str){return(this.match(str+"$")==str);};}
if(!Object.keys){Object.keys=(function(){var hasOwnProperty=Object.prototype.hasOwnProperty,hasDontEnumBug=!({toString:null}).propertyIsEnumerable('toString'),dontEnums=['toString','toLocaleString','valueOf','hasOwnProperty','isPrototypeOf','propertyIsEnumerable','constructor'],dontEnumsLength=dontEnums.length
return function(obj){if(typeof obj!=='object'&&typeof obj!=='function'||obj===null)throw new TypeError('Object.keys called on non-object')
var result=[]
for(var prop in obj){if(hasOwnProperty.call(obj,prop))result.push(prop)}
if(hasDontEnumBug){for(var i=0;i<dontEnumsLength;i++){if(hasOwnProperty.call(obj,dontEnums[i]))result.push(dontEnums[i])}}
return result}})()};if(!Array.prototype.map){Array.prototype.map=function(callback,thisArg){var T,A,k;if(this==null){throw new TypeError(" this is null or not defined");}
var O=Object(this);var len=O.length>>>0;if({}.toString.call(callback)!="[object Function]"){throw new TypeError(callback+" is not a function");}
if(thisArg){T=thisArg;}
A=new Array(len);k=0;while(k<len){var kValue,mappedValue;if(k in O){kValue=O[k];mappedValue=callback.call(T,kValue,k,O);A[k]=mappedValue;}
k++;}
return A;};}
if(!Array.prototype.indexOf){Array.prototype.indexOf=function(searchElement){"use strict";if(this==null){throw new TypeError();}
var t=Object(this);var len=t.length>>>0;if(len===0){return-1;}
var n=0;if(arguments.length>0){n=Number(arguments[1]);if(n!=n){n=0;}else if(n!=0&&n!=Infinity&&n!=-Infinity){n=(n>0||-1)*Math.floor(Math.abs(n));}}
if(n>=len){return-1;}
var k=n>=0?n:Math.max(len-Math.abs(n),0);for(;k<len;k++){if(k in t&&t[k]===searchElement){return k;}}
return-1;}}
if(!Array.prototype.lastIndexOf)
{Array.prototype.lastIndexOf=function(searchElement)
{"use strict";if(this==null)
throw new TypeError();var t=Object(this);var len=t.length>>>0;if(len===0)
return-1;var n=len;if(arguments.length>1)
{n=Number(arguments[1]);if(n!=n)
n=0;else if(n!=0&&n!=(1/0)&&n!=-(1/0))
n=(n>0||-1)*Math.floor(Math.abs(n));}
var k=n>=0?Math.min(n,len-1):len-Math.abs(n);for(;k>=0;k--)
{if(k in t&&t[k]===searchElement)
return k;}
return-1;};}
if(!Array.prototype.reduce){Array.prototype.reduce=function reduce(accumulator){var i,l=this.length,curr;if(typeof accumulator!=="function")
throw new TypeError("First argument is not callable");if((l==0||l===null)&&(arguments.length<=1))
throw new TypeError("Array length is 0 and no second argument");if(arguments.length<=1){curr=this[0];i=1;}
else{curr=arguments[1];}
for(i=i||0;i<l;++i){if(i in this)
curr=accumulator.call(undefined,curr,this[i],i,this);}
return curr;};}
window.Modernizr=(function(window,document,undefined){var version='2.0.6',Modernizr={},enableClasses=true,docElement=document.documentElement,docHead=document.head||document.getElementsByTagName('head')[0],mod='modernizr',modElem=document.createElement(mod),mStyle=modElem.style,inputElem=document.createElement('input'),smile=':)',toString=Object.prototype.toString,prefixes=' -webkit- -moz- -o- -ms- -khtml- '.split(' '),domPrefixes='Webkit Moz O ms Khtml'.split(' '),ns={'svg':'http://www.w3.org/2000/svg'},tests={},inputs={},attrs={},classes=[],featureName,injectElementWithStyles=function(rule,callback,nodes,testnames){var style,ret,node,div=document.createElement('div');if(parseInt(nodes,10)){while(nodes--){node=document.createElement('div');node.id=testnames?testnames[nodes]:mod+(nodes+1);div.appendChild(node);}}
style=['&shy;','<style>',rule,'</style>'].join('');div.id=mod;div.innerHTML+=style;docElement.appendChild(div);ret=callback(div,rule);div.parentNode.removeChild(div);return!!ret;},testMediaQuery=function(mq){if(window.matchMedia){return matchMedia(mq).matches;}
var bool;injectElementWithStyles('@media '+mq+' { #'+mod+' { position: absolute; } }',function(node){bool=(window.getComputedStyle?getComputedStyle(node,null):node.currentStyle)['position']=='absolute';});return bool;},isEventSupported=(function(){var TAGNAMES={'select':'input','change':'input','submit':'form','reset':'form','error':'img','load':'img','abort':'img'};function isEventSupported(eventName,element){element=element||document.createElement(TAGNAMES[eventName]||'div');eventName='on'+eventName;var isSupported=eventName in element;if(!isSupported){if(!element.setAttribute){element=document.createElement('div');}
if(element.setAttribute&&element.removeAttribute){element.setAttribute(eventName,'');isSupported=is(element[eventName],'function');if(!is(element[eventName],undefined)){element[eventName]=undefined;}
element.removeAttribute(eventName);}}
element=null;return isSupported;}
return isEventSupported;})();var _hasOwnProperty=({}).hasOwnProperty,hasOwnProperty;if(!is(_hasOwnProperty,undefined)&&!is(_hasOwnProperty.call,undefined)){hasOwnProperty=function(object,property){return _hasOwnProperty.call(object,property);};}
else{hasOwnProperty=function(object,property){return((property in object)&&is(object.constructor.prototype[property],undefined));};}
function setCss(str){mStyle.cssText=str;}
function setCssAll(str1,str2){return setCss(prefixes.join(str1+';')+(str2||''));}
function is(obj,type){return typeof obj===type;}
function contains(str,substr){return!!~(''+str).indexOf(substr);}
function testProps(props,prefixed){for(var i in props){if(mStyle[props[i]]!==undefined){return prefixed=='pfx'?props[i]:true;}}
return false;}
function testPropsAll(prop,prefixed){var ucProp=prop.charAt(0).toUpperCase()+prop.substr(1),props=(prop+' '+domPrefixes.join(ucProp+' ')+ucProp).split(' ');return testProps(props,prefixed);}
var testBundle=(function(styles,tests){var style=styles.join(''),len=tests.length;injectElementWithStyles(style,function(node,rule){var style=document.styleSheets[document.styleSheets.length-1],cssText=style.cssRules&&style.cssRules[0]?style.cssRules[0].cssText:style.cssText||"",children=node.childNodes,hash={};while(len--){hash[children[len].id]=children[len];}
Modernizr['touch']=('ontouchstart'in window)||hash['touch'].offsetTop===9;Modernizr['csstransforms3d']=hash['csstransforms3d'].offsetLeft===9;Modernizr['generatedcontent']=hash['generatedcontent'].offsetHeight>=1;Modernizr['fontface']=/src/i.test(cssText)&&cssText.indexOf(rule.split(' ')[0])===0;},len,tests);})(['@font-face {font-family:"font";src:url("https://")}',['@media (',prefixes.join('touch-enabled),('),mod,')','{#touch{top:9px;position:absolute}}'].join(''),['@media (',prefixes.join('transform-3d),('),mod,')','{#csstransforms3d{left:9px;position:absolute}}'].join(''),['#generatedcontent:after{content:"',smile,'";visibility:hidden}'].join('')],['fontface','touch','csstransforms3d','generatedcontent']);tests['flexbox']=function(){function setPrefixedValueCSS(element,property,value,extra){property+=':';element.style.cssText=(property+prefixes.join(value+';'+property)).slice(0,-property.length)+(extra||'');}
function setPrefixedPropertyCSS(element,property,value,extra){element.style.cssText=prefixes.join(property+':'+value+';')+(extra||'');}
var c=document.createElement('div'),elem=document.createElement('div');setPrefixedValueCSS(c,'display','box','width:42px;padding:0;');setPrefixedPropertyCSS(elem,'box-flex','1','width:10px;');c.appendChild(elem);docElement.appendChild(c);var ret=elem.offsetWidth===42;c.removeChild(elem);docElement.removeChild(c);return ret;};tests['canvas']=function(){var elem=document.createElement('canvas');return!!(elem.getContext&&elem.getContext('2d'));};tests['canvastext']=function(){return!!(Modernizr['canvas']&&is(document.createElement('canvas').getContext('2d').fillText,'function'));};tests['webgl']=function(){return!!window.WebGLRenderingContext;};tests['touch']=function(){return Modernizr['touch'];};tests['geolocation']=function(){return!!navigator.geolocation;};tests['postmessage']=function(){return!!window.postMessage;};tests['websqldatabase']=function(){var result=!!window.openDatabase;return result;};tests['indexedDB']=function(){for(var i=-1,len=domPrefixes.length;++i<len;){if(window[domPrefixes[i].toLowerCase()+'IndexedDB']){return true;}}
return!!window.indexedDB;};tests['hashchange']=function(){return isEventSupported('hashchange',window)&&(document.documentMode===undefined||document.documentMode>7);};tests['history']=function(){return!!(window.history&&history.pushState);};tests['draganddrop']=function(){return isEventSupported('dragstart')&&isEventSupported('drop');};tests['websockets']=function(){for(var i=-1,len=domPrefixes.length;++i<len;){if(window[domPrefixes[i]+'WebSocket']){return true;}}
return'WebSocket'in window;};tests['rgba']=function(){setCss('background-color:rgba(150,255,150,.5)');return contains(mStyle.backgroundColor,'rgba');};tests['hsla']=function(){setCss('background-color:hsla(120,40%,100%,.5)');return contains(mStyle.backgroundColor,'rgba')||contains(mStyle.backgroundColor,'hsla');};tests['multiplebgs']=function(){setCss('background:url(https://),url(https://),red url(https://)');return new RegExp(/(url\s*\(.*?){3}/).test(mStyle.background);};tests['backgroundsize']=function(){return testPropsAll('backgroundSize');};tests['borderimage']=function(){return testPropsAll('borderImage');};tests['borderradius']=function(){return testPropsAll('borderRadius');};tests['boxshadow']=function(){return testPropsAll('boxShadow');};tests['textshadow']=function(){return document.createElement('div').style.textShadow==='';};tests['opacity']=function(){setCssAll('opacity:.55');return/^0.55$/.test(mStyle.opacity);};tests['cssanimations']=function(){return testPropsAll('animationName');};tests['csscolumns']=function(){return testPropsAll('columnCount');};tests['cssgradients']=function(){var str1='background-image:',str2='gradient(linear,left top,right bottom,from(#9f9),to(white));',str3='linear-gradient(left top,#9f9, white);';setCss((str1+prefixes.join(str2+str1)+prefixes.join(str3+str1)).slice(0,-str1.length));return contains(mStyle.backgroundImage,'gradient');};tests['cssreflections']=function(){return testPropsAll('boxReflect');};tests['csstransforms']=function(){return!!testProps(['transformProperty','WebkitTransform','MozTransform','OTransform','msTransform']);};tests['csstransforms3d']=function(){var ret=!!testProps(['perspectiveProperty','WebkitPerspective','MozPerspective','OPerspective','msPerspective']);if(ret&&'webkitPerspective'in docElement.style){ret=Modernizr['csstransforms3d'];}
return ret;};tests['csstransitions']=function(){return testPropsAll('transitionProperty');};tests['fontface']=function(){return Modernizr['fontface'];};tests['generatedcontent']=function(){return Modernizr['generatedcontent'];};tests['video']=function(){var elem=document.createElement('video'),bool=false;try{if(bool=!!elem.canPlayType){bool=new Boolean(bool);bool.ogg=elem.canPlayType('video/ogg; codecs="theora"');var h264='video/mp4; codecs="avc1.42E01E';bool.h264=elem.canPlayType(h264+'"')||elem.canPlayType(h264+', mp4a.40.2"');bool.webm=elem.canPlayType('video/webm; codecs="vp8, vorbis"');}}catch(e){}
return bool;};tests['audio']=function(){var elem=document.createElement('audio'),bool=false;try{if(bool=!!elem.canPlayType){bool=new Boolean(bool);bool.ogg=elem.canPlayType('audio/ogg; codecs="vorbis"');bool.mp3=elem.canPlayType('audio/mpeg;');bool.wav=elem.canPlayType('audio/wav; codecs="1"');bool.m4a=elem.canPlayType('audio/x-m4a;')||elem.canPlayType('audio/aac;');}}catch(e){}
return bool;};tests['localstorage']=function(){try{return!!localStorage.getItem;}catch(e){return false;}};tests['sessionstorage']=function(){try{return!!sessionStorage.getItem;}catch(e){return false;}};tests['webworkers']=function(){return!!window.Worker;};tests['applicationcache']=function(){return!!window.applicationCache;};tests['svg']=function(){return!!document.createElementNS&&!!document.createElementNS(ns.svg,'svg').createSVGRect;};tests['inlinesvg']=function(){var div=document.createElement('div');div.innerHTML='<svg/>';return(div.firstChild&&div.firstChild.namespaceURI)==ns.svg;};tests['smil']=function(){return!!document.createElementNS&&/SVG/.test(toString.call(document.createElementNS(ns.svg,'animate')));};tests['svgclippaths']=function(){return!!document.createElementNS&&/SVG/.test(toString.call(document.createElementNS(ns.svg,'clipPath')));};function webforms(){Modernizr['input']=(function(props){for(var i=0,len=props.length;i<len;i++){attrs[props[i]]=!!(props[i]in inputElem);}
return attrs;})('autocomplete autofocus list placeholder max min multiple pattern required step'.split(' '));Modernizr['inputtypes']=(function(props){for(var i=0,bool,inputElemType,defaultView,len=props.length;i<len;i++){inputElem.setAttribute('type',inputElemType=props[i]);bool=inputElem.type!=='text';if(bool){inputElem.value=smile;inputElem.style.cssText='position:absolute;visibility:hidden;';if(/^range$/.test(inputElemType)&&inputElem.style.WebkitAppearance!==undefined){docElement.appendChild(inputElem);defaultView=document.defaultView;bool=defaultView.getComputedStyle&&defaultView.getComputedStyle(inputElem,null).WebkitAppearance!=='textfield'&&(inputElem.offsetHeight!==0);docElement.removeChild(inputElem);}else if(/^(search|tel)$/.test(inputElemType)){}else if(/^(url|email)$/.test(inputElemType)){bool=inputElem.checkValidity&&inputElem.checkValidity()===false;}else if(/^color$/.test(inputElemType)){docElement.appendChild(inputElem);docElement.offsetWidth;bool=inputElem.value!=smile;docElement.removeChild(inputElem);}else{bool=inputElem.value!=smile;}}
inputs[props[i]]=!!bool;}
return inputs;})('search tel url email datetime date month week time datetime-local number range color'.split(' '));}
for(var feature in tests){if(hasOwnProperty(tests,feature)){featureName=feature.toLowerCase();Modernizr[featureName]=tests[feature]();classes.push((Modernizr[featureName]?'':'no-')+featureName);}}
Modernizr.input||webforms();Modernizr.addTest=function(feature,test){if(typeof feature=="object"){for(var key in feature){if(hasOwnProperty(feature,key)){Modernizr.addTest(key,feature[key]);}}}else{feature=feature.toLowerCase();if(Modernizr[feature]!==undefined){return;}
test=typeof test=="boolean"?test:!!test();docElement.className+=' '+(test?'':'no-')+feature;Modernizr[feature]=test;}
return Modernizr;};setCss('');modElem=inputElem=null;if(window.attachEvent&&(function(){var elem=document.createElement('div');elem.innerHTML='<elem></elem>';return elem.childNodes.length!==1;})()){(function(win,doc){win.iepp=win.iepp||{};var iepp=win.iepp,elems=iepp.html5elements||'abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video',elemsArr=elems.split('|'),elemsArrLen=elemsArr.length,elemRegExp=new RegExp('(^|\\s)('+elems+')','gi'),tagRegExp=new RegExp('<(\/*)('+elems+')','gi'),filterReg=/^\s*[\{\}]\s*$/,ruleRegExp=new RegExp('(^|[^\\n]*?\\s)('+elems+')([^\\n]*)({[\\n\\w\\W]*?})','gi'),docFrag=doc.createDocumentFragment(),html=doc.documentElement,head=html.firstChild,bodyElem=doc.createElement('body'),styleElem=doc.createElement('style'),printMedias=/print|all/,body;function shim(doc){var a=-1;while(++a<elemsArrLen)
doc.createElement(elemsArr[a]);}
iepp.getCSS=function(styleSheetList,mediaType){if(styleSheetList+''===undefined){return'';}
var a=-1,len=styleSheetList.length,styleSheet,cssTextArr=[];while(++a<len){styleSheet=styleSheetList[a];if(styleSheet.disabled){continue;}
mediaType=styleSheet.media||mediaType;if(printMedias.test(mediaType))cssTextArr.push(iepp.getCSS(styleSheet.imports,mediaType),styleSheet.cssText);mediaType='all';}
return cssTextArr.join('');};iepp.parseCSS=function(cssText){var cssTextArr=[],rule;while((rule=ruleRegExp.exec(cssText))!=null){cssTextArr.push(((filterReg.exec(rule[1])?'\n':rule[1])+rule[2]+rule[3]).replace(elemRegExp,'$1.iepp_$2')+rule[4]);}
return cssTextArr.join('\n');};iepp.writeHTML=function(){var a=-1;body=body||doc.body;while(++a<elemsArrLen){var nodeList=doc.getElementsByTagName(elemsArr[a]),nodeListLen=nodeList.length,b=-1;while(++b<nodeListLen)
if(nodeList[b].className.indexOf('iepp_')<0)
nodeList[b].className+=' iepp_'+elemsArr[a];}
docFrag.appendChild(body);html.appendChild(bodyElem);bodyElem.className=body.className;bodyElem.id=body.id;bodyElem.innerHTML=body.innerHTML.replace(tagRegExp,'<$1font');};iepp._beforePrint=function(){styleElem.styleSheet.cssText=iepp.parseCSS(iepp.getCSS(doc.styleSheets,'all'));iepp.writeHTML();};iepp.restoreHTML=function(){bodyElem.innerHTML='';html.removeChild(bodyElem);html.appendChild(body);};iepp._afterPrint=function(){iepp.restoreHTML();styleElem.styleSheet.cssText='';};shim(doc);shim(docFrag);if(iepp.disablePP){return;}
head.insertBefore(styleElem,head.firstChild);styleElem.media='print';styleElem.className='iepp-printshim';win.attachEvent('onbeforeprint',iepp._beforePrint);win.attachEvent('onafterprint',iepp._afterPrint);})(window,document);}
Modernizr._version=version;Modernizr._prefixes=prefixes;Modernizr._domPrefixes=domPrefixes;Modernizr.mq=testMediaQuery;Modernizr.hasEvent=isEventSupported;Modernizr.testProp=function(prop){return testProps([prop]);};Modernizr.testAllProps=testPropsAll;Modernizr.testStyles=injectElementWithStyles;Modernizr.prefixed=function(prop){return testPropsAll(prop,'pfx');};docElement.className=docElement.className.replace(/\bno-js\b/,'')
+(enableClasses?' js '+classes.join(' '):'');return Modernizr;})(this,this.document);(function(window,undefined){var document=window.document,navigator=window.navigator,location=window.location;var jQuery=(function(){var jQuery=function(selector,context){return new jQuery.fn.init(selector,context,rootjQuery);},_jQuery=window.jQuery,_$=window.$,rootjQuery,quickExpr=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,rnotwhite=/\S/,trimLeft=/^\s+/,trimRight=/\s+$/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,rvalidchars=/^[\],:{}\s]*$/,rvalidescape=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rvalidtokens=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rwebkit=/(webkit)[ \/]([\w.]+)/,ropera=/(opera)(?:.*version)?[ \/]([\w.]+)/,rmsie=/(msie) ([\w.]+)/,rmozilla=/(mozilla)(?:.*? rv:([\w.]+))?/,rdashAlpha=/-([a-z]|[0-9])/ig,rmsPrefix=/^-ms-/,fcamelCase=function(all,letter){return(letter+"").toUpperCase();},userAgent=navigator.userAgent,browserMatch,readyList,DOMContentLoaded,toString=Object.prototype.toString,hasOwn=Object.prototype.hasOwnProperty,push=Array.prototype.push,slice=Array.prototype.slice,trim=String.prototype.trim,indexOf=Array.prototype.indexOf,class2type={};jQuery.fn=jQuery.prototype={constructor:jQuery,init:function(selector,context,rootjQuery){var match,elem,ret,doc;if(!selector){return this;}
if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this;}
if(selector==="body"&&!context&&document.body){this.context=document;this[0]=document.body;this.selector=selector;this.length=1;return this;}
if(typeof selector==="string"){if(selector.charAt(0)==="<"&&selector.charAt(selector.length-1)===">"&&selector.length>=3){match=[null,selector,null];}else{match=quickExpr.exec(selector);}
if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;doc=(context?context.ownerDocument||context:document);ret=rsingleTag.exec(selector);if(ret){if(jQuery.isPlainObject(context)){selector=[document.createElement(ret[1])];jQuery.fn.attr.call(selector,context,true);}else{selector=[doc.createElement(ret[1])];}}else{ret=jQuery.buildFragment([match[1]],[doc]);selector=(ret.cacheable?jQuery.clone(ret.fragment):ret.fragment).childNodes;}
return jQuery.merge(this,selector);}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){if(elem.id!==match[2]){return rootjQuery.find(selector);}
this.length=1;this[0]=elem;}
this.context=document;this.selector=selector;return this;}}else if(!context||context.jquery){return(context||rootjQuery).find(selector);}else{return this.constructor(context).find(selector);}}else if(jQuery.isFunction(selector)){return rootjQuery.ready(selector);}
if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context;}
return jQuery.makeArray(selector,this);},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length;},toArray:function(){return slice.call(this,0);},get:function(num){return num==null?this.toArray():(num<0?this[this.length+num]:this[num]);},pushStack:function(elems,name,selector){var ret=this.constructor();if(jQuery.isArray(elems)){push.apply(ret,elems);}else{jQuery.merge(ret,elems);}
ret.prevObject=this;ret.context=this.context;if(name==="find"){ret.selector=this.selector+(this.selector?" ":"")+selector;}else if(name){ret.selector=this.selector+"."+name+"("+selector+")";}
return ret;},each:function(callback,args){return jQuery.each(this,callback,args);},ready:function(fn){jQuery.bindReady();readyList.add(fn);return this;},eq:function(i){i=+i;return i===-1?this.slice(i):this.slice(i,i+1);},first:function(){return this.eq(0);},last:function(){return this.eq(-1);},slice:function(){return this.pushStack(slice.apply(this,arguments),"slice",slice.call(arguments).join(","));},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem);}));},end:function(){return this.prevObject||this.constructor(null);},push:push,sort:[].sort,splice:[].splice};jQuery.fn.init.prototype=jQuery.fn;jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2;}
if(typeof target!=="object"&&!jQuery.isFunction(target)){target={};}
if(length===i){target=this;--i;}
for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue;}
if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[];}else{clone=src&&jQuery.isPlainObject(src)?src:{};}
target[name]=jQuery.extend(deep,clone,copy);}else if(copy!==undefined){target[name]=copy;}}}}
return target;};jQuery.extend({noConflict:function(deep){if(window.$===jQuery){window.$=_$;}
if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery;}
return jQuery;},isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++;}else{jQuery.ready(true);}},ready:function(wait){if((wait===true&&!--jQuery.readyWait)||(wait!==true&&!jQuery.isReady)){if(!document.body){return setTimeout(jQuery.ready,1);}
jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return;}
readyList.fireWith(document,[jQuery]);if(jQuery.fn.trigger){jQuery(document).trigger("ready").off("ready");}}},bindReady:function(){if(readyList){return;}
readyList=jQuery.Callbacks("once memory");if(document.readyState==="complete"){return setTimeout(jQuery.ready,1);}
if(document.addEventListener){document.addEventListener("DOMContentLoaded",DOMContentLoaded,false);window.addEventListener("load",jQuery.ready,false);}else if(document.attachEvent){document.attachEvent("onreadystatechange",DOMContentLoaded);window.attachEvent("onload",jQuery.ready);var toplevel=false;try{toplevel=window.frameElement==null;}catch(e){}
if(document.documentElement.doScroll&&toplevel){doScrollCheck();}}},isFunction:function(obj){return jQuery.type(obj)==="function";},isArray:Array.isArray||function(obj){return jQuery.type(obj)==="array";},isWindow:function(obj){return obj&&typeof obj==="object"&&"setInterval"in obj;},isNumeric:function(obj){return!isNaN(parseFloat(obj))&&isFinite(obj);},type:function(obj){return obj==null?String(obj):class2type[toString.call(obj)]||"object";},isPlainObject:function(obj){if(!obj||jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false;}
try{if(obj.constructor&&!hasOwn.call(obj,"constructor")&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false;}}catch(e){return false;}
var key;for(key in obj){}
return key===undefined||hasOwn.call(obj,key);},isEmptyObject:function(obj){for(var name in obj){return false;}
return true;},error:function(msg){throw new Error(msg);},parseJSON:function(data){if(typeof data!=="string"||!data){return null;}
data=jQuery.trim(data);if(window.JSON&&window.JSON.parse){return window.JSON.parse(data);}
if(rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))){return(new Function("return "+data))();}
jQuery.error("Invalid JSON: "+data);},parseXML:function(data){var xml,tmp;try{if(window.DOMParser){tmp=new DOMParser();xml=tmp.parseFromString(data,"text/xml");}else{xml=new ActiveXObject("Microsoft.XMLDOM");xml.async="false";xml.loadXML(data);}}catch(e){xml=undefined;}
if(!xml||!xml.documentElement||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data);}
return xml;},noop:function(){},globalEval:function(data){if(data&&rnotwhite.test(data)){(window.execScript||function(data){window["eval"].call(window,data);})(data);}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase);},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toUpperCase()===name.toUpperCase();},each:function(object,callback,args){var name,i=0,length=object.length,isObj=length===undefined||jQuery.isFunction(object);if(args){if(isObj){for(name in object){if(callback.apply(object[name],args)===false){break;}}}else{for(;i<length;){if(callback.apply(object[i++],args)===false){break;}}}}else{if(isObj){for(name in object){if(callback.call(object[name],name,object[name])===false){break;}}}else{for(;i<length;){if(callback.call(object[i],i,object[i++])===false){break;}}}}
return object;},trim:trim?function(text){return text==null?"":trim.call(text);}:function(text){return text==null?"":text.toString().replace(trimLeft,"").replace(trimRight,"");},makeArray:function(array,results){var ret=results||[];if(array!=null){var type=jQuery.type(array);if(array.length==null||type==="string"||type==="function"||type==="regexp"||jQuery.isWindow(array)){push.call(ret,array);}else{jQuery.merge(ret,array);}}
return ret;},inArray:function(elem,array,i){var len;if(array){if(indexOf){return indexOf.call(array,elem,i);}
len=array.length;i=i?i<0?Math.max(0,len+i):i:0;for(;i<len;i++){if(i in array&&array[i]===elem){return i;}}}
return-1;},merge:function(first,second){var i=first.length,j=0;if(typeof second.length==="number"){for(var l=second.length;j<l;j++){first[i++]=second[j];}}else{while(second[j]!==undefined){first[i++]=second[j++];}}
first.length=i;return first;},grep:function(elems,callback,inv){var ret=[],retVal;inv=!!inv;for(var i=0,length=elems.length;i<length;i++){retVal=!!callback(elems[i],i);if(inv!==retVal){ret.push(elems[i]);}}
return ret;},map:function(elems,callback,arg){var value,key,ret=[],i=0,length=elems.length,isArray=elems instanceof jQuery||length!==undefined&&typeof length==="number"&&((length>0&&elems[0]&&elems[length-1])||length===0||jQuery.isArray(elems));if(isArray){for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret[ret.length]=value;}}}else{for(key in elems){value=callback(elems[key],key,arg);if(value!=null){ret[ret.length]=value;}}}
return ret.concat.apply([],ret);},guid:1,proxy:function(fn,context){if(typeof context==="string"){var tmp=fn[context];context=fn;fn=tmp;}
if(!jQuery.isFunction(fn)){return undefined;}
var args=slice.call(arguments,2),proxy=function(){return fn.apply(context,args.concat(slice.call(arguments)));};proxy.guid=fn.guid=fn.guid||proxy.guid||jQuery.guid++;return proxy;},access:function(elems,key,value,exec,fn,pass){var length=elems.length;if(typeof key==="object"){for(var k in key){jQuery.access(elems,k,key[k],exec,fn,value);}
return elems;}
if(value!==undefined){exec=!pass&&exec&&jQuery.isFunction(value);for(var i=0;i<length;i++){fn(elems[i],key,exec?value.call(elems[i],i,fn(elems[i],key)):value,pass);}
return elems;}
return length?fn(elems[0],key):undefined;},now:function(){return(new Date()).getTime();},uaMatch:function(ua){ua=ua.toLowerCase();var match=rwebkit.exec(ua)||ropera.exec(ua)||rmsie.exec(ua)||ua.indexOf("compatible")<0&&rmozilla.exec(ua)||[];return{browser:match[1]||"",version:match[2]||"0"};},sub:function(){function jQuerySub(selector,context){return new jQuerySub.fn.init(selector,context);}
jQuery.extend(true,jQuerySub,this);jQuerySub.superclass=this;jQuerySub.fn=jQuerySub.prototype=this();jQuerySub.fn.constructor=jQuerySub;jQuerySub.sub=this.sub;jQuerySub.fn.init=function init(selector,context){if(context&&context instanceof jQuery&&!(context instanceof jQuerySub)){context=jQuerySub(context);}
return jQuery.fn.init.call(this,selector,context,rootjQuerySub);};jQuerySub.fn.init.prototype=jQuerySub.fn;var rootjQuerySub=jQuerySub(document);return jQuerySub;},browser:{}});jQuery.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase();});browserMatch=jQuery.uaMatch(userAgent);if(browserMatch.browser){jQuery.browser[browserMatch.browser]=true;jQuery.browser.version=browserMatch.version;}
if(jQuery.browser.webkit){jQuery.browser.safari=true;}
if(rnotwhite.test("\xA0")){trimLeft=/^[\s\xA0]+/;trimRight=/[\s\xA0]+$/;}
rootjQuery=jQuery(document);if(document.addEventListener){DOMContentLoaded=function(){document.removeEventListener("DOMContentLoaded",DOMContentLoaded,false);jQuery.ready();};}else if(document.attachEvent){DOMContentLoaded=function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",DOMContentLoaded);jQuery.ready();}};}
function doScrollCheck(){if(jQuery.isReady){return;}
try{document.documentElement.doScroll("left");}catch(e){setTimeout(doScrollCheck,1);return;}
jQuery.ready();}
return jQuery;})();var flagsCache={};function createFlags(flags){var object=flagsCache[flags]={},i,length;flags=flags.split(/\s+/);for(i=0,length=flags.length;i<length;i++){object[flags[i]]=true;}
return object;}
jQuery.Callbacks=function(flags){flags=flags?(flagsCache[flags]||createFlags(flags)):{};var
list=[],stack=[],memory,firing,firingStart,firingLength,firingIndex,add=function(args){var i,length,elem,type,actual;for(i=0,length=args.length;i<length;i++){elem=args[i];type=jQuery.type(elem);if(type==="array"){add(elem);}else if(type==="function"){if(!flags.unique||!self.has(elem)){list.push(elem);}}}},fire=function(context,args){args=args||[];memory=!flags.memory||[context,args];firing=true;firingIndex=firingStart||0;firingStart=0;firingLength=list.length;for(;list&&firingIndex<firingLength;firingIndex++){if(list[firingIndex].apply(context,args)===false&&flags.stopOnFalse){memory=true;break;}}
firing=false;if(list){if(!flags.once){if(stack&&stack.length){memory=stack.shift();self.fireWith(memory[0],memory[1]);}}else if(memory===true){self.disable();}else{list=[];}}},self={add:function(){if(list){var length=list.length;add(arguments);if(firing){firingLength=list.length;}else if(memory&&memory!==true){firingStart=length;fire(memory[0],memory[1]);}}
return this;},remove:function(){if(list){var args=arguments,argIndex=0,argLength=args.length;for(;argIndex<argLength;argIndex++){for(var i=0;i<list.length;i++){if(args[argIndex]===list[i]){if(firing){if(i<=firingLength){firingLength--;if(i<=firingIndex){firingIndex--;}}}
list.splice(i--,1);if(flags.unique){break;}}}}}
return this;},has:function(fn){if(list){var i=0,length=list.length;for(;i<length;i++){if(fn===list[i]){return true;}}}
return false;},empty:function(){list=[];return this;},disable:function(){list=stack=memory=undefined;return this;},disabled:function(){return!list;},lock:function(){stack=undefined;if(!memory||memory===true){self.disable();}
return this;},locked:function(){return!stack;},fireWith:function(context,args){if(stack){if(firing){if(!flags.once){stack.push([context,args]);}}else if(!(flags.once&&memory)){fire(context,args);}}
return this;},fire:function(){self.fireWith(this,arguments);return this;},fired:function(){return!!memory;}};return self;};var
sliceDeferred=[].slice;jQuery.extend({Deferred:function(func){var doneList=jQuery.Callbacks("once memory"),failList=jQuery.Callbacks("once memory"),progressList=jQuery.Callbacks("memory"),state="pending",lists={resolve:doneList,reject:failList,notify:progressList},promise={done:doneList.add,fail:failList.add,progress:progressList.add,state:function(){return state;},isResolved:doneList.fired,isRejected:failList.fired,then:function(doneCallbacks,failCallbacks,progressCallbacks){deferred.done(doneCallbacks).fail(failCallbacks).progress(progressCallbacks);return this;},always:function(){deferred.done.apply(deferred,arguments).fail.apply(deferred,arguments);return this;},pipe:function(fnDone,fnFail,fnProgress){return jQuery.Deferred(function(newDefer){jQuery.each({done:[fnDone,"resolve"],fail:[fnFail,"reject"],progress:[fnProgress,"notify"]},function(handler,data){var fn=data[0],action=data[1],returned;if(jQuery.isFunction(fn)){deferred[handler](function(){returned=fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().then(newDefer.resolve,newDefer.reject,newDefer.notify);}else{newDefer[action+"With"](this===deferred?newDefer:this,[returned]);}});}else{deferred[handler](newDefer[action]);}});}).promise();},promise:function(obj){if(obj==null){obj=promise;}else{for(var key in promise){obj[key]=promise[key];}}
return obj;}},deferred=promise.promise({}),key;for(key in lists){deferred[key]=lists[key].fire;deferred[key+"With"]=lists[key].fireWith;}
deferred.done(function(){state="resolved";},failList.disable,progressList.lock).fail(function(){state="rejected";},doneList.disable,progressList.lock);if(func){func.call(deferred,deferred);}
return deferred;},when:function(firstParam){var args=sliceDeferred.call(arguments,0),i=0,length=args.length,pValues=new Array(length),count=length,pCount=length,deferred=length<=1&&firstParam&&jQuery.isFunction(firstParam.promise)?firstParam:jQuery.Deferred(),promise=deferred.promise();function resolveFunc(i){return function(value){args[i]=arguments.length>1?sliceDeferred.call(arguments,0):value;if(!(--count)){deferred.resolveWith(deferred,args);}};}
function progressFunc(i){return function(value){pValues[i]=arguments.length>1?sliceDeferred.call(arguments,0):value;deferred.notifyWith(promise,pValues);};}
if(length>1){for(;i<length;i++){if(args[i]&&args[i].promise&&jQuery.isFunction(args[i].promise)){args[i].promise().then(resolveFunc(i),deferred.reject,progressFunc(i));}else{--count;}}
if(!count){deferred.resolveWith(deferred,args);}}else if(deferred!==firstParam){deferred.resolveWith(deferred,length?[firstParam]:[]);}
return promise;}});jQuery.support=(function(){var support,all,a,select,opt,input,marginDiv,fragment,tds,events,eventName,i,isSupported,div=document.createElement("div"),documentElement=document.documentElement;div.setAttribute("className","t");div.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>";all=div.getElementsByTagName("*");a=div.getElementsByTagName("a")[0];if(!all||!all.length||!a){return{};}
select=document.createElement("select");opt=select.appendChild(document.createElement("option"));input=div.getElementsByTagName("input")[0];support={leadingWhitespace:(div.firstChild.nodeType===3),tbody:!div.getElementsByTagName("tbody").length,htmlSerialize:!!div.getElementsByTagName("link").length,style:/top/.test(a.getAttribute("style")),hrefNormalized:(a.getAttribute("href")==="/a"),opacity:/^0.55/.test(a.style.opacity),cssFloat:!!a.style.cssFloat,checkOn:(input.value==="on"),optSelected:opt.selected,getSetAttribute:div.className!=="t",enctype:!!document.createElement("form").enctype,html5Clone:document.createElement("nav").cloneNode(true).outerHTML!=="<:nav></:nav>",submitBubbles:true,changeBubbles:true,focusinBubbles:false,deleteExpando:true,noCloneEvent:true,inlineBlockNeedsLayout:false,shrinkWrapBlocks:false,reliableMarginRight:true};input.checked=true;support.noCloneChecked=input.cloneNode(true).checked;select.disabled=true;support.optDisabled=!opt.disabled;try{delete div.test;}catch(e){support.deleteExpando=false;}
if(!div.addEventListener&&div.attachEvent&&div.fireEvent){div.attachEvent("onclick",function(){support.noCloneEvent=false;});div.cloneNode(true).fireEvent("onclick");}
input=document.createElement("input");input.value="t";input.setAttribute("type","radio");support.radioValue=input.value==="t";input.setAttribute("checked","checked");div.appendChild(input);fragment=document.createDocumentFragment();fragment.appendChild(div.lastChild);support.checkClone=fragment.cloneNode(true).cloneNode(true).lastChild.checked;support.appendChecked=input.checked;fragment.removeChild(input);fragment.appendChild(div);div.innerHTML="";if(window.getComputedStyle){marginDiv=document.createElement("div");marginDiv.style.width="0";marginDiv.style.marginRight="0";div.style.width="2px";div.appendChild(marginDiv);support.reliableMarginRight=(parseInt((window.getComputedStyle(marginDiv,null)||{marginRight:0}).marginRight,10)||0)===0;}
if(div.attachEvent){for(i in{submit:1,change:1,focusin:1}){eventName="on"+i;isSupported=(eventName in div);if(!isSupported){div.setAttribute(eventName,"return;");isSupported=(typeof div[eventName]==="function");}
support[i+"Bubbles"]=isSupported;}}
fragment.removeChild(div);fragment=select=opt=marginDiv=div=input=null;jQuery(function(){var container,outer,inner,table,td,offsetSupport,conMarginTop,ptlm,vb,style,html,body=document.getElementsByTagName("body")[0];if(!body){return;}
conMarginTop=1;ptlm="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;";vb="visibility:hidden;border:0;";style="style='"+ptlm+"border:5px solid #000;padding:0;'";html="<div "+style+"><div></div></div>"+"<table "+style+" cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>";container=document.createElement("div");container.style.cssText=vb+"width:0;height:0;position:static;top:0;margin-top:"+conMarginTop+"px";body.insertBefore(container,body.firstChild);div=document.createElement("div");container.appendChild(div);div.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>";tds=div.getElementsByTagName("td");isSupported=(tds[0].offsetHeight===0);tds[0].style.display="";tds[1].style.display="none";support.reliableHiddenOffsets=isSupported&&(tds[0].offsetHeight===0);div.innerHTML="";div.style.width=div.style.paddingLeft="1px";jQuery.boxModel=support.boxModel=div.offsetWidth===2;if(typeof div.style.zoom!=="undefined"){div.style.display="inline";div.style.zoom=1;support.inlineBlockNeedsLayout=(div.offsetWidth===2);div.style.display="";div.innerHTML="<div style='width:4px;'></div>";support.shrinkWrapBlocks=(div.offsetWidth!==2);}
div.style.cssText=ptlm+vb;div.innerHTML=html;outer=div.firstChild;inner=outer.firstChild;td=outer.nextSibling.firstChild.firstChild;offsetSupport={doesNotAddBorder:(inner.offsetTop!==5),doesAddBorderForTableAndCells:(td.offsetTop===5)};inner.style.position="fixed";inner.style.top="20px";offsetSupport.fixedPosition=(inner.offsetTop===20||inner.offsetTop===15);inner.style.position=inner.style.top="";outer.style.overflow="hidden";outer.style.position="relative";offsetSupport.subtractsBorderForOverflowNotVisible=(inner.offsetTop===-5);offsetSupport.doesNotIncludeMarginInBodyOffset=(body.offsetTop!==conMarginTop);body.removeChild(container);div=container=null;jQuery.extend(support,offsetSupport);});return support;})();var rbrace=/^(?:\{.*\}|\[.*\])$/,rmultiDash=/([A-Z])/g;jQuery.extend({cache:{},uuid:0,expando:"jQuery"+(jQuery.fn.jquery+Math.random()).replace(/\D/g,""),noData:{"embed":true,"object":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000","applet":true},hasData:function(elem){elem=elem.nodeType?jQuery.cache[elem[jQuery.expando]]:elem[jQuery.expando];return!!elem&&!isEmptyDataObject(elem);},data:function(elem,name,data,pvt){if(!jQuery.acceptData(elem)){return;}
var privateCache,thisCache,ret,internalKey=jQuery.expando,getByName=typeof name==="string",isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:elem[internalKey]&&internalKey,isEvents=name==="events";if((!id||!cache[id]||(!isEvents&&!pvt&&!cache[id].data))&&getByName&&data===undefined){return;}
if(!id){if(isNode){elem[internalKey]=id=++jQuery.uuid;}else{id=internalKey;}}
if(!cache[id]){cache[id]={};if(!isNode){cache[id].toJSON=jQuery.noop;}}
if(typeof name==="object"||typeof name==="function"){if(pvt){cache[id]=jQuery.extend(cache[id],name);}else{cache[id].data=jQuery.extend(cache[id].data,name);}}
privateCache=thisCache=cache[id];if(!pvt){if(!thisCache.data){thisCache.data={};}
thisCache=thisCache.data;}
if(data!==undefined){thisCache[jQuery.camelCase(name)]=data;}
if(isEvents&&!thisCache[name]){return privateCache.events;}
if(getByName){ret=thisCache[name];if(ret==null){ret=thisCache[jQuery.camelCase(name)];}}else{ret=thisCache;}
return ret;},removeData:function(elem,name,pvt){if(!jQuery.acceptData(elem)){return;}
var thisCache,i,l,internalKey=jQuery.expando,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:internalKey;if(!cache[id]){return;}
if(name){thisCache=pvt?cache[id]:cache[id].data;if(thisCache){if(!jQuery.isArray(name)){if(name in thisCache){name=[name];}else{name=jQuery.camelCase(name);if(name in thisCache){name=[name];}else{name=name.split(" ");}}}
for(i=0,l=name.length;i<l;i++){delete thisCache[name[i]];}
if(!(pvt?isEmptyDataObject:jQuery.isEmptyObject)(thisCache)){return;}}}
if(!pvt){delete cache[id].data;if(!isEmptyDataObject(cache[id])){return;}}
if(jQuery.support.deleteExpando||!cache.setInterval){delete cache[id];}else{cache[id]=null;}
if(isNode){if(jQuery.support.deleteExpando){delete elem[internalKey];}else if(elem.removeAttribute){elem.removeAttribute(internalKey);}else{elem[internalKey]=null;}}},_data:function(elem,name,data){return jQuery.data(elem,name,data,true);},acceptData:function(elem){if(elem.nodeName){var match=jQuery.noData[elem.nodeName.toLowerCase()];if(match){return!(match===true||elem.getAttribute("classid")!==match);}}
return true;}});jQuery.fn.extend({data:function(key,value){var parts,attr,name,data=null;if(typeof key==="undefined"){if(this.length){data=jQuery.data(this[0]);if(this[0].nodeType===1&&!jQuery._data(this[0],"parsedAttrs")){attr=this[0].attributes;for(var i=0,l=attr.length;i<l;i++){name=attr[i].name;if(name.indexOf("data-")===0){name=jQuery.camelCase(name.substring(5));dataAttr(this[0],name,data[name]);}}
jQuery._data(this[0],"parsedAttrs",true);}}
return data;}else if(typeof key==="object"){return this.each(function(){jQuery.data(this,key);});}
parts=key.split(".");parts[1]=parts[1]?"."+parts[1]:"";if(value===undefined){data=this.triggerHandler("getData"+parts[1]+"!",[parts[0]]);if(data===undefined&&this.length){data=jQuery.data(this[0],key);data=dataAttr(this[0],key,data);}
return data===undefined&&parts[1]?this.data(parts[0]):data;}else{return this.each(function(){var self=jQuery(this),args=[parts[0],value];self.triggerHandler("setData"+parts[1]+"!",args);jQuery.data(this,key,value);self.triggerHandler("changeData"+parts[1]+"!",args);});}},removeData:function(key){return this.each(function(){jQuery.removeData(this,key);});}});function dataAttr(elem,key,data){if(data===undefined&&elem.nodeType===1){var name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:jQuery.isNumeric(data)?parseFloat(data):rbrace.test(data)?jQuery.parseJSON(data):data;}catch(e){}
jQuery.data(elem,key,data);}else{data=undefined;}}
return data;}
function isEmptyDataObject(obj){for(var name in obj){if(name==="data"&&jQuery.isEmptyObject(obj[name])){continue;}
if(name!=="toJSON"){return false;}}
return true;}
function handleQueueMarkDefer(elem,type,src){var deferDataKey=type+"defer",queueDataKey=type+"queue",markDataKey=type+"mark",defer=jQuery._data(elem,deferDataKey);if(defer&&(src==="queue"||!jQuery._data(elem,queueDataKey))&&(src==="mark"||!jQuery._data(elem,markDataKey))){setTimeout(function(){if(!jQuery._data(elem,queueDataKey)&&!jQuery._data(elem,markDataKey)){jQuery.removeData(elem,deferDataKey,true);defer.fire();}},0);}}
jQuery.extend({_mark:function(elem,type){if(elem){type=(type||"fx")+"mark";jQuery._data(elem,type,(jQuery._data(elem,type)||0)+1);}},_unmark:function(force,elem,type){if(force!==true){type=elem;elem=force;force=false;}
if(elem){type=type||"fx";var key=type+"mark",count=force?0:((jQuery._data(elem,key)||1)-1);if(count){jQuery._data(elem,key,count);}else{jQuery.removeData(elem,key,true);handleQueueMarkDefer(elem,type,"mark");}}},queue:function(elem,type,data){var q;if(elem){type=(type||"fx")+"queue";q=jQuery._data(elem,type);if(data){if(!q||jQuery.isArray(data)){q=jQuery._data(elem,type,jQuery.makeArray(data));}else{q.push(data);}}
return q||[];}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),fn=queue.shift(),hooks={};if(fn==="inprogress"){fn=queue.shift();}
if(fn){if(type==="fx"){queue.unshift("inprogress");}
jQuery._data(elem,type+".run",hooks);fn.call(elem,function(){jQuery.dequeue(elem,type);},hooks);}
if(!queue.length){jQuery.removeData(elem,type+"queue "+type+".run",true);handleQueueMarkDefer(elem,type,"queue");}}});jQuery.fn.extend({queue:function(type,data){if(typeof type!=="string"){data=type;type="fx";}
if(data===undefined){return jQuery.queue(this[0],type);}
return this.each(function(){var queue=jQuery.queue(this,type,data);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type);}});},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type);});},delay:function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout);};});},clearQueue:function(type){return this.queue(type||"fx",[]);},promise:function(type,object){if(typeof type!=="string"){object=type;type=undefined;}
type=type||"fx";var defer=jQuery.Deferred(),elements=this,i=elements.length,count=1,deferDataKey=type+"defer",queueDataKey=type+"queue",markDataKey=type+"mark",tmp;function resolve(){if(!(--count)){defer.resolveWith(elements,[elements]);}}
while(i--){if((tmp=jQuery.data(elements[i],deferDataKey,undefined,true)||(jQuery.data(elements[i],queueDataKey,undefined,true)||jQuery.data(elements[i],markDataKey,undefined,true))&&jQuery.data(elements[i],deferDataKey,jQuery.Callbacks("once memory"),true))){count++;tmp.add(resolve);}}
resolve();return defer.promise();}});var rclass=/[\n\t\r]/g,rspace=/\s+/,rreturn=/\r/g,rtype=/^(?:button|input)$/i,rfocusable=/^(?:button|input|object|select|textarea)$/i,rclickable=/^a(?:rea)?$/i,rboolean=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,getSetAttribute=jQuery.support.getSetAttribute,nodeHook,boolHook,fixSpecified;jQuery.fn.extend({attr:function(name,value){return jQuery.access(this,name,value,true,jQuery.attr);},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name);});},prop:function(name,value){return jQuery.access(this,name,value,true,jQuery.prop);},removeProp:function(name){name=jQuery.propFix[name]||name;return this.each(function(){try{this[name]=undefined;delete this[name];}catch(e){}});},addClass:function(value){var classNames,i,l,elem,setClass,c,cl;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className));});}
if(value&&typeof value==="string"){classNames=value.split(rspace);for(i=0,l=this.length;i<l;i++){elem=this[i];if(elem.nodeType===1){if(!elem.className&&classNames.length===1){elem.className=value;}else{setClass=" "+elem.className+" ";for(c=0,cl=classNames.length;c<cl;c++){if(!~setClass.indexOf(" "+classNames[c]+" ")){setClass+=classNames[c]+" ";}}
elem.className=jQuery.trim(setClass);}}}}
return this;},removeClass:function(value){var classNames,i,l,elem,className,c,cl;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className));});}
if((value&&typeof value==="string")||value===undefined){classNames=(value||"").split(rspace);for(i=0,l=this.length;i<l;i++){elem=this[i];if(elem.nodeType===1&&elem.className){if(value){className=(" "+elem.className+" ").replace(rclass," ");for(c=0,cl=classNames.length;c<cl;c++){className=className.replace(" "+classNames[c]+" "," ");}
elem.className=jQuery.trim(className);}else{elem.className="";}}}}
return this;},toggleClass:function(value,stateVal){var type=typeof value,isBool=typeof stateVal==="boolean";if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal);});}
return this.each(function(){if(type==="string"){var className,i=0,self=jQuery(this),state=stateVal,classNames=value.split(rspace);while((className=classNames[i++])){state=isBool?state:!self.hasClass(className);self[state?"addClass":"removeClass"](className);}}else if(type==="undefined"||type==="boolean"){if(this.className){jQuery._data(this,"__className__",this.className);}
this.className=this.className||value===false?"":jQuery._data(this,"__className__")||"";}});},hasClass:function(selector){var className=" "+selector+" ",i=0,l=this.length;for(;i<l;i++){if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>-1){return true;}}
return false;},val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.nodeName.toLowerCase()]||jQuery.valHooks[elem.type];if(hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret;}
ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret;}
return;}
isFunction=jQuery.isFunction(value);return this.each(function(i){var self=jQuery(this),val;if(this.nodeType!==1){return;}
if(isFunction){val=value.call(this,i,self.val());}else{val=value;}
if(val==null){val="";}else if(typeof val==="number"){val+="";}else if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+"";});}
hooks=jQuery.valHooks[this.nodeName.toLowerCase()]||jQuery.valHooks[this.type];if(!hooks||!("set"in hooks)||hooks.set(this,val,"value")===undefined){this.value=val;}});}});jQuery.extend({valHooks:{option:{get:function(elem){var val=elem.attributes.value;return!val||val.specified?elem.value:elem.text;}},select:{get:function(elem){var value,i,max,option,index=elem.selectedIndex,values=[],options=elem.options,one=elem.type==="select-one";if(index<0){return null;}
i=one?index:0;max=one?index+1:options.length;for(;i<max;i++){option=options[i];if(option.selected&&(jQuery.support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value;}
values.push(value);}}
if(one&&!values.length&&options.length){return jQuery(options[index]).val();}
return values;},set:function(elem,value){var values=jQuery.makeArray(value);jQuery(elem).find("option").each(function(){this.selected=jQuery.inArray(jQuery(this).val(),values)>=0;});if(!values.length){elem.selectedIndex=-1;}
return values;}}},attrFn:{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true},attr:function(elem,name,value,pass){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return;}
if(pass&&name in jQuery.attrFn){return jQuery(elem)[name](value);}
if(typeof elem.getAttribute==="undefined"){return jQuery.prop(elem,name,value);}
notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(rboolean.test(name)?boolHook:nodeHook);}
if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name);return;}else if(hooks&&"set"in hooks&&notxml&&(ret=hooks.set(elem,value,name))!==undefined){return ret;}else{elem.setAttribute(name,""+value);return value;}}else if(hooks&&"get"in hooks&&notxml&&(ret=hooks.get(elem,name))!==null){return ret;}else{ret=elem.getAttribute(name);return ret===null?undefined:ret;}},removeAttr:function(elem,value){var propName,attrNames,name,l,i=0;if(value&&elem.nodeType===1){attrNames=value.toLowerCase().split(rspace);l=attrNames.length;for(;i<l;i++){name=attrNames[i];if(name){propName=jQuery.propFix[name]||name;jQuery.attr(elem,name,"");elem.removeAttribute(getSetAttribute?name:propName);if(rboolean.test(name)&&propName in elem){elem[propName]=false;}}}}},attrHooks:{type:{set:function(elem,value){if(rtype.test(elem.nodeName)&&elem.parentNode){jQuery.error("type property can't be changed");}else if(!jQuery.support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val;}
return value;}}},value:{get:function(elem,name){if(nodeHook&&jQuery.nodeName(elem,"button")){return nodeHook.get(elem,name);}
return name in elem?elem.value:null;},set:function(elem,value,name){if(nodeHook&&jQuery.nodeName(elem,"button")){return nodeHook.set(elem,value,name);}
elem.value=value;}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return;}
notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name];}
if(value!==undefined){if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret;}else{return(elem[name]=value);}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret;}else{return elem[name];}}},propHooks:{tabIndex:{get:function(elem){var attributeNode=elem.getAttributeNode("tabindex");return attributeNode&&attributeNode.specified?parseInt(attributeNode.value,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:undefined;}}}});jQuery.attrHooks.tabindex=jQuery.propHooks.tabIndex;boolHook={get:function(elem,name){var attrNode,property=jQuery.prop(elem,name);return property===true||typeof property!=="boolean"&&(attrNode=elem.getAttributeNode(name))&&attrNode.nodeValue!==false?name.toLowerCase():undefined;},set:function(elem,value,name){var propName;if(value===false){jQuery.removeAttr(elem,name);}else{propName=jQuery.propFix[name]||name;if(propName in elem){elem[propName]=true;}
elem.setAttribute(name,name.toLowerCase());}
return name;}};if(!getSetAttribute){fixSpecified={name:true,id:true};nodeHook=jQuery.valHooks.button={get:function(elem,name){var ret;ret=elem.getAttributeNode(name);return ret&&(fixSpecified[name]?ret.nodeValue!=="":ret.specified)?ret.nodeValue:undefined;},set:function(elem,value,name){var ret=elem.getAttributeNode(name);if(!ret){ret=document.createAttribute(name);elem.setAttributeNode(ret);}
return(ret.nodeValue=value+"");}};jQuery.attrHooks.tabindex.set=nodeHook.set;jQuery.each(["width","height"],function(i,name){jQuery.attrHooks[name]=jQuery.extend(jQuery.attrHooks[name],{set:function(elem,value){if(value===""){elem.setAttribute(name,"auto");return value;}}});});jQuery.attrHooks.contenteditable={get:nodeHook.get,set:function(elem,value,name){if(value===""){value="false";}
nodeHook.set(elem,value,name);}};}
if(!jQuery.support.hrefNormalized){jQuery.each(["href","src","width","height"],function(i,name){jQuery.attrHooks[name]=jQuery.extend(jQuery.attrHooks[name],{get:function(elem){var ret=elem.getAttribute(name,2);return ret===null?undefined:ret;}});});}
if(!jQuery.support.style){jQuery.attrHooks.style={get:function(elem){return elem.style.cssText.toLowerCase()||undefined;},set:function(elem,value){return(elem.style.cssText=""+value);}};}
if(!jQuery.support.optSelected){jQuery.propHooks.selected=jQuery.extend(jQuery.propHooks.selected,{get:function(elem){var parent=elem.parentNode;if(parent){parent.selectedIndex;if(parent.parentNode){parent.parentNode.selectedIndex;}}
return null;}});}
if(!jQuery.support.enctype){jQuery.propFix.enctype="encoding";}
if(!jQuery.support.checkOn){jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={get:function(elem){return elem.getAttribute("value")===null?"on":elem.value;}};});}
jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]=jQuery.extend(jQuery.valHooks[this],{set:function(elem,value){if(jQuery.isArray(value)){return(elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0);}}});});var rformElems=/^(?:textarea|input|select)$/i,rtypenamespace=/^([^\.]*)?(?:\.(.+))?$/,rhoverHack=/\bhover(\.\S+)?\b/,rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rquickIs=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,quickParse=function(selector){var quick=rquickIs.exec(selector);if(quick){quick[1]=(quick[1]||"").toLowerCase();quick[3]=quick[3]&&new RegExp("(?:^|\\s)"+quick[3]+"(?:\\s|$)");}
return quick;},quickIs=function(elem,m){var attrs=elem.attributes||{};return((!m[1]||elem.nodeName.toLowerCase()===m[1])&&(!m[2]||(attrs.id||{}).value===m[2])&&(!m[3]||m[3].test((attrs["class"]||{}).value)));},hoverHack=function(events){return jQuery.event.special.hover?events:events.replace(rhoverHack,"mouseenter$1 mouseleave$1");};jQuery.event={add:function(elem,types,handler,data,selector){var elemData,eventHandle,events,t,tns,type,namespaces,handleObj,handleObjIn,quick,handlers,special;if(elem.nodeType===3||elem.nodeType===8||!types||!handler||!(elemData=jQuery._data(elem))){return;}
if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;}
if(!handler.guid){handler.guid=jQuery.guid++;}
events=elemData.events;if(!events){elemData.events=events={};}
eventHandle=elemData.handle;if(!eventHandle){elemData.handle=eventHandle=function(e){return typeof jQuery!=="undefined"&&(!e||jQuery.event.triggered!==e.type)?jQuery.event.dispatch.apply(eventHandle.elem,arguments):undefined;};eventHandle.elem=elem;}
types=jQuery.trim(hoverHack(types)).split(" ");for(t=0;t<types.length;t++){tns=rtypenamespace.exec(types[t])||[];type=tns[1];namespaces=(tns[2]||"").split(".").sort();special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:tns[1],data:data,handler:handler,guid:handler.guid,selector:selector,quick:quickParse(selector),namespace:namespaces.join(".")},handleObjIn);handlers=events[type];if(!handlers){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle,false);}else if(elem.attachEvent){elem.attachEvent("on"+type,eventHandle);}}}
if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid;}}
if(selector){handlers.splice(handlers.delegateCount++,0,handleObj);}else{handlers.push(handleObj);}
jQuery.event.global[type]=true;}
elem=null;},global:{},remove:function(elem,types,handler,selector,mappedTypes){var elemData=jQuery.hasData(elem)&&jQuery._data(elem),t,tns,type,origType,namespaces,origCount,j,events,special,handle,eventType,handleObj;if(!elemData||!(events=elemData.events)){return;}
types=jQuery.trim(hoverHack(types||"")).split(" ");for(t=0;t<types.length;t++){tns=rtypenamespace.exec(types[t])||[];type=origType=tns[1];namespaces=tns[2];if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true);}
continue;}
special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;eventType=events[type]||[];origCount=eventType.length;namespaces=namespaces?new RegExp("(^|\\.)"+namespaces.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(j=0;j<eventType.length;j++){handleObj=eventType[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!namespaces||namespaces.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){eventType.splice(j--,1);if(handleObj.selector){eventType.delegateCount--;}
if(special.remove){special.remove.call(elem,handleObj);}}}
if(eventType.length===0&&origCount!==eventType.length){if(!special.teardown||special.teardown.call(elem,namespaces)===false){jQuery.removeEvent(elem,type,elemData.handle);}
delete events[type];}}
if(jQuery.isEmptyObject(events)){handle=elemData.handle;if(handle){handle.elem=null;}
jQuery.removeData(elem,["events","handle"],true);}},customEvent:{"getData":true,"setData":true,"changeData":true},trigger:function(event,data,elem,onlyHandlers){if(elem&&(elem.nodeType===3||elem.nodeType===8)){return;}
var type=event.type||event,namespaces=[],cache,exclusive,i,cur,old,ontype,special,handle,eventPath,bubbleType;if(rfocusMorph.test(type+jQuery.event.triggered)){return;}
if(type.indexOf("!")>=0){type=type.slice(0,-1);exclusive=true;}
if(type.indexOf(".")>=0){namespaces=type.split(".");type=namespaces.shift();namespaces.sort();}
if((!elem||jQuery.event.customEvent[type])&&!jQuery.event.global[type]){return;}
event=typeof event==="object"?event[jQuery.expando]?event:new jQuery.Event(type,event):new jQuery.Event(type);event.type=type;event.isTrigger=true;event.exclusive=exclusive;event.namespace=namespaces.join(".");event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.)?")+"(\\.|$)"):null;ontype=type.indexOf(":")<0?"on"+type:"";if(!elem){cache=jQuery.cache;for(i in cache){if(cache[i].events&&cache[i].events[type]){jQuery.event.trigger(event,data,cache[i].handle.elem,true);}}
return;}
event.result=undefined;if(!event.target){event.target=elem;}
data=data!=null?jQuery.makeArray(data):[];data.unshift(event);special=jQuery.event.special[type]||{};if(special.trigger&&special.trigger.apply(elem,data)===false){return;}
eventPath=[[elem,special.bindType||type]];if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;cur=rfocusMorph.test(bubbleType+type)?elem:elem.parentNode;old=null;for(;cur;cur=cur.parentNode){eventPath.push([cur,bubbleType]);old=cur;}
if(old&&old===elem.ownerDocument){eventPath.push([old.defaultView||old.parentWindow||window,bubbleType]);}}
for(i=0;i<eventPath.length&&!event.isPropagationStopped();i++){cur=eventPath[i][0];event.type=eventPath[i][1];handle=(jQuery._data(cur,"events")||{})[event.type]&&jQuery._data(cur,"handle");if(handle){handle.apply(cur,data);}
handle=ontype&&cur[ontype];if(handle&&jQuery.acceptData(cur)&&handle.apply(cur,data)===false){event.preventDefault();}}
event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(elem.ownerDocument,data)===false)&&!(type==="click"&&jQuery.nodeName(elem,"a"))&&jQuery.acceptData(elem)){if(ontype&&elem[type]&&((type!=="focus"&&type!=="blur")||event.target.offsetWidth!==0)&&!jQuery.isWindow(elem)){old=elem[ontype];if(old){elem[ontype]=null;}
jQuery.event.triggered=type;elem[type]();jQuery.event.triggered=undefined;if(old){elem[ontype]=old;}}}}
return event.result;},dispatch:function(event){event=jQuery.event.fix(event||window.event);var handlers=((jQuery._data(this,"events")||{})[event.type]||[]),delegateCount=handlers.delegateCount,args=[].slice.call(arguments,0),run_all=!event.exclusive&&!event.namespace,handlerQueue=[],i,j,cur,jqcur,ret,selMatch,matched,matches,handleObj,sel,related;args[0]=event;event.delegateTarget=this;if(delegateCount&&!event.target.disabled&&!(event.button&&event.type==="click")){jqcur=jQuery(this);jqcur.context=this.ownerDocument||this;for(cur=event.target;cur!=this;cur=cur.parentNode||this){selMatch={};matches=[];jqcur[0]=cur;for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector;if(selMatch[sel]===undefined){selMatch[sel]=(handleObj.quick?quickIs(cur,handleObj.quick):jqcur.is(sel));}
if(selMatch[sel]){matches.push(handleObj);}}
if(matches.length){handlerQueue.push({elem:cur,matches:matches});}}}
if(handlers.length>delegateCount){handlerQueue.push({elem:this,matches:handlers.slice(delegateCount)});}
for(i=0;i<handlerQueue.length&&!event.isPropagationStopped();i++){matched=handlerQueue[i];event.currentTarget=matched.elem;for(j=0;j<matched.matches.length&&!event.isImmediatePropagationStopped();j++){handleObj=matched.matches[j];if(run_all||(!event.namespace&&!handleObj.namespace)||event.namespace_re&&event.namespace_re.test(handleObj.namespace)){event.data=handleObj.data;event.handleObj=handleObj;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){event.result=ret;if(ret===false){event.preventDefault();event.stopPropagation();}}}}}
return event.result;},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode;}
return event;}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button,fromElement=original.fromElement;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0);}
if(!event.relatedTarget&&fromElement){event.relatedTarget=fromElement===event.target?original.toElement:fromElement;}
if(!event.which&&button!==undefined){event.which=(button&1?1:(button&2?3:(button&4?2:0)));}
return event;}},fix:function(event){if(event[jQuery.expando]){return event;}
var i,prop,originalEvent=event,fixHook=jQuery.event.fixHooks[event.type]||{},copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=jQuery.Event(originalEvent);for(i=copy.length;i;){prop=copy[--i];event[prop]=originalEvent[prop];}
if(!event.target){event.target=originalEvent.srcElement||document;}
if(event.target.nodeType===3){event.target=event.target.parentNode;}
if(event.metaKey===undefined){event.metaKey=event.ctrlKey;}
return fixHook.filter?fixHook.filter(event,originalEvent):event;},special:{ready:{setup:jQuery.bindReady},load:{noBubble:true},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(data,namespaces,eventHandle){if(jQuery.isWindow(this)){this.onbeforeunload=eventHandle;}},teardown:function(namespaces,eventHandle){if(this.onbeforeunload===eventHandle){this.onbeforeunload=null;}}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event(),event,{type:type,isSimulated:true,originalEvent:{}});if(bubble){jQuery.event.trigger(e,null,elem);}else{jQuery.event.dispatch.call(elem,e);}
if(e.isDefaultPrevented()){event.preventDefault();}}};jQuery.event.handle=jQuery.event.dispatch;jQuery.removeEvent=document.removeEventListener?function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle,false);}}:function(elem,type,handle){if(elem.detachEvent){elem.detachEvent("on"+type,handle);}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props);}
if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=(src.defaultPrevented||src.returnValue===false||src.getPreventDefault&&src.getPreventDefault())?returnTrue:returnFalse;}else{this.type=src;}
if(props){jQuery.extend(this,props);}
this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true;};function returnFalse(){return false;}
function returnTrue(){return true;}
jQuery.Event.prototype={preventDefault:function(){this.isDefaultPrevented=returnTrue;var e=this.originalEvent;if(!e){return;}
if(e.preventDefault){e.preventDefault();}else{e.returnValue=false;}},stopPropagation:function(){this.isPropagationStopped=returnTrue;var e=this.originalEvent;if(!e){return;}
if(e.stopPropagation){e.stopPropagation();}
e.cancelBubble=true;},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation();},isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var target=this,related=event.relatedTarget,handleObj=event.handleObj,selector=handleObj.selector,ret;if(!related||(related!==target&&!jQuery.contains(target,related))){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix;}
return ret;}};});if(!jQuery.support.submitBubbles){jQuery.event.special.submit={setup:function(){if(jQuery.nodeName(this,"form")){return false;}
jQuery.event.add(this,"click._submit keypress._submit",function(e){var elem=e.target,form=jQuery.nodeName(elem,"input")||jQuery.nodeName(elem,"button")?elem.form:undefined;if(form&&!form._submit_attached){jQuery.event.add(form,"submit._submit",function(event){if(this.parentNode&&!event.isTrigger){jQuery.event.simulate("submit",this.parentNode,event,true);}});form._submit_attached=true;}});},teardown:function(){if(jQuery.nodeName(this,"form")){return false;}
jQuery.event.remove(this,"._submit");}};}
if(!jQuery.support.changeBubbles){jQuery.event.special.change={setup:function(){if(rformElems.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){jQuery.event.add(this,"propertychange._change",function(event){if(event.originalEvent.propertyName==="checked"){this._just_changed=true;}});jQuery.event.add(this,"click._change",function(event){if(this._just_changed&&!event.isTrigger){this._just_changed=false;jQuery.event.simulate("change",this,event,true);}});}
return false;}
jQuery.event.add(this,"beforeactivate._change",function(e){var elem=e.target;if(rformElems.test(elem.nodeName)&&!elem._change_attached){jQuery.event.add(elem,"change._change",function(event){if(this.parentNode&&!event.isSimulated&&!event.isTrigger){jQuery.event.simulate("change",this.parentNode,event,true);}});elem._change_attached=true;}});},handle:function(event){var elem=event.target;if(this!==elem||event.isSimulated||event.isTrigger||(elem.type!=="radio"&&elem.type!=="checkbox")){return event.handleObj.handler.apply(this,arguments);}},teardown:function(){jQuery.event.remove(this,"._change");return rformElems.test(this.nodeName);}};}
if(!jQuery.support.focusinBubbles){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var attaches=0,handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),true);};jQuery.event.special[fix]={setup:function(){if(attaches++===0){document.addEventListener(orig,handler,true);}},teardown:function(){if(--attaches===0){document.removeEventListener(orig,handler,true);}}};});}
jQuery.fn.extend({on:function(types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=selector;selector=undefined;}
for(type in types){this.on(type,selector,data,types[type],one);}
return this;}
if(data==null&&fn==null){fn=selector;data=selector=undefined;}else if(fn==null){if(typeof selector==="string"){fn=data;data=undefined;}else{fn=data;data=selector;selector=undefined;}}
if(fn===false){fn=returnFalse;}else if(!fn){return this;}
if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments);};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++);}
return this.each(function(){jQuery.event.add(this,types,fn,data,selector);});},one:function(types,selector,data,fn){return this.on.call(this,types,selector,data,fn,1);},off:function(types,selector,fn){if(types&&types.preventDefault&&types.handleObj){var handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.type+"."+handleObj.namespace:handleObj.type,handleObj.selector,handleObj.handler);return this;}
if(typeof types==="object"){for(var type in types){this.off(type,selector,types[type]);}
return this;}
if(selector===false||typeof selector==="function"){fn=selector;selector=undefined;}
if(fn===false){fn=returnFalse;}
return this.each(function(){jQuery.event.remove(this,types,fn,selector);});},bind:function(types,data,fn){return this.on(types,null,data,fn);},unbind:function(types,fn){return this.off(types,null,fn);},live:function(types,data,fn){jQuery(this.context).on(types,this.selector,data,fn);return this;},die:function(types,fn){jQuery(this.context).off(types,this.selector||"**",fn);return this;},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn);},undelegate:function(selector,types,fn){return arguments.length==1?this.off(selector,"**"):this.off(types,selector,fn);},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this);});},triggerHandler:function(type,data){if(this[0]){return jQuery.event.trigger(type,data,this[0],true);}},toggle:function(fn){var args=arguments,guid=fn.guid||jQuery.guid++,i=0,toggler=function(event){var lastToggle=(jQuery._data(this,"lastToggle"+fn.guid)||0)%i;jQuery._data(this,"lastToggle"+fn.guid,lastToggle+1);event.preventDefault();return args[lastToggle].apply(this,arguments)||false;};toggler.guid=guid;while(i<args.length){args[i++].guid=guid;}
return this.click(toggler);},hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver);}});jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){if(fn==null){fn=data;data=null;}
return arguments.length>0?this.on(name,null,data,fn):this.trigger(name);};if(jQuery.attrFn){jQuery.attrFn[name]=true;}
if(rkeyEvent.test(name)){jQuery.event.fixHooks[name]=jQuery.event.keyHooks;}
if(rmouseEvent.test(name)){jQuery.event.fixHooks[name]=jQuery.event.mouseHooks;}});(function(){var chunker=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,expando="sizcache"+(Math.random()+'').replace('.',''),done=0,toString=Object.prototype.toString,hasDuplicate=false,baseHasDuplicate=true,rBackslash=/\\/g,rReturn=/\r\n/g,rNonWord=/\W/;[0,0].sort(function(){baseHasDuplicate=false;return 0;});var Sizzle=function(selector,context,results,seed){results=results||[];context=context||document;var origContext=context;if(context.nodeType!==1&&context.nodeType!==9){return[];}
if(!selector||typeof selector!=="string"){return results;}
var m,set,checkSet,extra,ret,cur,pop,i,prune=true,contextXML=Sizzle.isXML(context),parts=[],soFar=selector;do{chunker.exec("");m=chunker.exec(soFar);if(m){soFar=m[3];parts.push(m[1]);if(m[2]){extra=m[3];break;}}}while(m);if(parts.length>1&&origPOS.exec(selector)){if(parts.length===2&&Expr.relative[parts[0]]){set=posProcess(parts[0]+parts[1],context,seed);}else{set=Expr.relative[parts[0]]?[context]:Sizzle(parts.shift(),context);while(parts.length){selector=parts.shift();if(Expr.relative[selector]){selector+=parts.shift();}
set=posProcess(selector,set,seed);}}}else{if(!seed&&parts.length>1&&context.nodeType===9&&!contextXML&&Expr.match.ID.test(parts[0])&&!Expr.match.ID.test(parts[parts.length-1])){ret=Sizzle.find(parts.shift(),context,contextXML);context=ret.expr?Sizzle.filter(ret.expr,ret.set)[0]:ret.set[0];}
if(context){ret=seed?{expr:parts.pop(),set:makeArray(seed)}:Sizzle.find(parts.pop(),parts.length===1&&(parts[0]==="~"||parts[0]==="+")&&context.parentNode?context.parentNode:context,contextXML);set=ret.expr?Sizzle.filter(ret.expr,ret.set):ret.set;if(parts.length>0){checkSet=makeArray(set);}else{prune=false;}
while(parts.length){cur=parts.pop();pop=cur;if(!Expr.relative[cur]){cur="";}else{pop=parts.pop();}
if(pop==null){pop=context;}
Expr.relative[cur](checkSet,pop,contextXML);}}else{checkSet=parts=[];}}
if(!checkSet){checkSet=set;}
if(!checkSet){Sizzle.error(cur||selector);}
if(toString.call(checkSet)==="[object Array]"){if(!prune){results.push.apply(results,checkSet);}else if(context&&context.nodeType===1){for(i=0;checkSet[i]!=null;i++){if(checkSet[i]&&(checkSet[i]===true||checkSet[i].nodeType===1&&Sizzle.contains(context,checkSet[i]))){results.push(set[i]);}}}else{for(i=0;checkSet[i]!=null;i++){if(checkSet[i]&&checkSet[i].nodeType===1){results.push(set[i]);}}}}else{makeArray(checkSet,results);}
if(extra){Sizzle(extra,origContext,results,seed);Sizzle.uniqueSort(results);}
return results;};Sizzle.uniqueSort=function(results){if(sortOrder){hasDuplicate=baseHasDuplicate;results.sort(sortOrder);if(hasDuplicate){for(var i=1;i<results.length;i++){if(results[i]===results[i-1]){results.splice(i--,1);}}}}
return results;};Sizzle.matches=function(expr,set){return Sizzle(expr,null,null,set);};Sizzle.matchesSelector=function(node,expr){return Sizzle(expr,null,null,[node]).length>0;};Sizzle.find=function(expr,context,isXML){var set,i,len,match,type,left;if(!expr){return[];}
for(i=0,len=Expr.order.length;i<len;i++){type=Expr.order[i];if((match=Expr.leftMatch[type].exec(expr))){left=match[1];match.splice(1,1);if(left.substr(left.length-1)!=="\\"){match[1]=(match[1]||"").replace(rBackslash,"");set=Expr.find[type](match,context,isXML);if(set!=null){expr=expr.replace(Expr.match[type],"");break;}}}}
if(!set){set=typeof context.getElementsByTagName!=="undefined"?context.getElementsByTagName("*"):[];}
return{set:set,expr:expr};};Sizzle.filter=function(expr,set,inplace,not){var match,anyFound,type,found,item,filter,left,i,pass,old=expr,result=[],curLoop=set,isXMLFilter=set&&set[0]&&Sizzle.isXML(set[0]);while(expr&&set.length){for(type in Expr.filter){if((match=Expr.leftMatch[type].exec(expr))!=null&&match[2]){filter=Expr.filter[type];left=match[1];anyFound=false;match.splice(1,1);if(left.substr(left.length-1)==="\\"){continue;}
if(curLoop===result){result=[];}
if(Expr.preFilter[type]){match=Expr.preFilter[type](match,curLoop,inplace,result,not,isXMLFilter);if(!match){anyFound=found=true;}else if(match===true){continue;}}
if(match){for(i=0;(item=curLoop[i])!=null;i++){if(item){found=filter(item,match,i,curLoop);pass=not^found;if(inplace&&found!=null){if(pass){anyFound=true;}else{curLoop[i]=false;}}else if(pass){result.push(item);anyFound=true;}}}}
if(found!==undefined){if(!inplace){curLoop=result;}
expr=expr.replace(Expr.match[type],"");if(!anyFound){return[];}
break;}}}
if(expr===old){if(anyFound==null){Sizzle.error(expr);}else{break;}}
old=expr;}
return curLoop;};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg);};var getText=Sizzle.getText=function(elem){var i,node,nodeType=elem.nodeType,ret="";if(nodeType){if(nodeType===1||nodeType===9){if(typeof elem.textContent==='string'){return elem.textContent;}else if(typeof elem.innerText==='string'){return elem.innerText.replace(rReturn,'');}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem);}}}else if(nodeType===3||nodeType===4){return elem.nodeValue;}}else{for(i=0;(node=elem[i]);i++){if(node.nodeType!==8){ret+=getText(node);}}}
return ret;};var Expr=Sizzle.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(elem){return elem.getAttribute("href");},type:function(elem){return elem.getAttribute("type");}},relative:{"+":function(checkSet,part){var isPartStr=typeof part==="string",isTag=isPartStr&&!rNonWord.test(part),isPartStrNotTag=isPartStr&&!isTag;if(isTag){part=part.toLowerCase();}
for(var i=0,l=checkSet.length,elem;i<l;i++){if((elem=checkSet[i])){while((elem=elem.previousSibling)&&elem.nodeType!==1){}
checkSet[i]=isPartStrNotTag||elem&&elem.nodeName.toLowerCase()===part?elem||false:elem===part;}}
if(isPartStrNotTag){Sizzle.filter(part,checkSet,true);}},">":function(checkSet,part){var elem,isPartStr=typeof part==="string",i=0,l=checkSet.length;if(isPartStr&&!rNonWord.test(part)){part=part.toLowerCase();for(;i<l;i++){elem=checkSet[i];if(elem){var parent=elem.parentNode;checkSet[i]=parent.nodeName.toLowerCase()===part?parent:false;}}}else{for(;i<l;i++){elem=checkSet[i];if(elem){checkSet[i]=isPartStr?elem.parentNode:elem.parentNode===part;}}
if(isPartStr){Sizzle.filter(part,checkSet,true);}}},"":function(checkSet,part,isXML){var nodeCheck,doneName=done++,checkFn=dirCheck;if(typeof part==="string"&&!rNonWord.test(part)){part=part.toLowerCase();nodeCheck=part;checkFn=dirNodeCheck;}
checkFn("parentNode",part,doneName,checkSet,nodeCheck,isXML);},"~":function(checkSet,part,isXML){var nodeCheck,doneName=done++,checkFn=dirCheck;if(typeof part==="string"&&!rNonWord.test(part)){part=part.toLowerCase();nodeCheck=part;checkFn=dirNodeCheck;}
checkFn("previousSibling",part,doneName,checkSet,nodeCheck,isXML);}},find:{ID:function(match,context,isXML){if(typeof context.getElementById!=="undefined"&&!isXML){var m=context.getElementById(match[1]);return m&&m.parentNode?[m]:[];}},NAME:function(match,context){if(typeof context.getElementsByName!=="undefined"){var ret=[],results=context.getElementsByName(match[1]);for(var i=0,l=results.length;i<l;i++){if(results[i].getAttribute("name")===match[1]){ret.push(results[i]);}}
return ret.length===0?null:ret;}},TAG:function(match,context){if(typeof context.getElementsByTagName!=="undefined"){return context.getElementsByTagName(match[1]);}}},preFilter:{CLASS:function(match,curLoop,inplace,result,not,isXML){match=" "+match[1].replace(rBackslash,"")+" ";if(isXML){return match;}
for(var i=0,elem;(elem=curLoop[i])!=null;i++){if(elem){if(not^(elem.className&&(" "+elem.className+" ").replace(/[\t\n\r]/g," ").indexOf(match)>=0)){if(!inplace){result.push(elem);}}else if(inplace){curLoop[i]=false;}}}
return false;},ID:function(match){return match[1].replace(rBackslash,"");},TAG:function(match,curLoop){return match[1].replace(rBackslash,"").toLowerCase();},CHILD:function(match){if(match[1]==="nth"){if(!match[2]){Sizzle.error(match[0]);}
match[2]=match[2].replace(/^\+|\s*/g,'');var test=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(match[2]==="even"&&"2n"||match[2]==="odd"&&"2n+1"||!/\D/.test(match[2])&&"0n+"+match[2]||match[2]);match[2]=(test[1]+(test[2]||1))-0;match[3]=test[3]-0;}
else if(match[2]){Sizzle.error(match[0]);}
match[0]=done++;return match;},ATTR:function(match,curLoop,inplace,result,not,isXML){var name=match[1]=match[1].replace(rBackslash,"");if(!isXML&&Expr.attrMap[name]){match[1]=Expr.attrMap[name];}
match[4]=(match[4]||match[5]||"").replace(rBackslash,"");if(match[2]==="~="){match[4]=" "+match[4]+" ";}
return match;},PSEUDO:function(match,curLoop,inplace,result,not){if(match[1]==="not"){if((chunker.exec(match[3])||"").length>1||/^\w/.test(match[3])){match[3]=Sizzle(match[3],null,null,curLoop);}else{var ret=Sizzle.filter(match[3],curLoop,inplace,true^not);if(!inplace){result.push.apply(result,ret);}
return false;}}else if(Expr.match.POS.test(match[0])||Expr.match.CHILD.test(match[0])){return true;}
return match;},POS:function(match){match.unshift(true);return match;}},filters:{enabled:function(elem){return elem.disabled===false&&elem.type!=="hidden";},disabled:function(elem){return elem.disabled===true;},checked:function(elem){return elem.checked===true;},selected:function(elem){if(elem.parentNode){elem.parentNode.selectedIndex;}
return elem.selected===true;},parent:function(elem){return!!elem.firstChild;},empty:function(elem){return!elem.firstChild;},has:function(elem,i,match){return!!Sizzle(match[3],elem).length;},header:function(elem){return(/h\d/i).test(elem.nodeName);},text:function(elem){var attr=elem.getAttribute("type"),type=elem.type;return elem.nodeName.toLowerCase()==="input"&&"text"===type&&(attr===type||attr===null);},radio:function(elem){return elem.nodeName.toLowerCase()==="input"&&"radio"===elem.type;},checkbox:function(elem){return elem.nodeName.toLowerCase()==="input"&&"checkbox"===elem.type;},file:function(elem){return elem.nodeName.toLowerCase()==="input"&&"file"===elem.type;},password:function(elem){return elem.nodeName.toLowerCase()==="input"&&"password"===elem.type;},submit:function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&"submit"===elem.type;},image:function(elem){return elem.nodeName.toLowerCase()==="input"&&"image"===elem.type;},reset:function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&"reset"===elem.type;},button:function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&"button"===elem.type||name==="button";},input:function(elem){return(/input|select|textarea|button/i).test(elem.nodeName);},focus:function(elem){return elem===elem.ownerDocument.activeElement;}},setFilters:{first:function(elem,i){return i===0;},last:function(elem,i,match,array){return i===array.length-1;},even:function(elem,i){return i%2===0;},odd:function(elem,i){return i%2===1;},lt:function(elem,i,match){return i<match[3]-0;},gt:function(elem,i,match){return i>match[3]-0;},nth:function(elem,i,match){return match[3]-0===i;},eq:function(elem,i,match){return match[3]-0===i;}},filter:{PSEUDO:function(elem,match,i,array){var name=match[1],filter=Expr.filters[name];if(filter){return filter(elem,i,match,array);}else if(name==="contains"){return(elem.textContent||elem.innerText||getText([elem])||"").indexOf(match[3])>=0;}else if(name==="not"){var not=match[3];for(var j=0,l=not.length;j<l;j++){if(not[j]===elem){return false;}}
return true;}else{Sizzle.error(name);}},CHILD:function(elem,match){var first,last,doneName,parent,cache,count,diff,type=match[1],node=elem;switch(type){case"only":case"first":while((node=node.previousSibling)){if(node.nodeType===1){return false;}}
if(type==="first"){return true;}
node=elem;case"last":while((node=node.nextSibling)){if(node.nodeType===1){return false;}}
return true;case"nth":first=match[2];last=match[3];if(first===1&&last===0){return true;}
doneName=match[0];parent=elem.parentNode;if(parent&&(parent[expando]!==doneName||!elem.nodeIndex)){count=0;for(node=parent.firstChild;node;node=node.nextSibling){if(node.nodeType===1){node.nodeIndex=++count;}}
parent[expando]=doneName;}
diff=elem.nodeIndex-last;if(first===0){return diff===0;}else{return(diff%first===0&&diff/first>=0);}}},ID:function(elem,match){return elem.nodeType===1&&elem.getAttribute("id")===match;},TAG:function(elem,match){return(match==="*"&&elem.nodeType===1)||!!elem.nodeName&&elem.nodeName.toLowerCase()===match;},CLASS:function(elem,match){return(" "+(elem.className||elem.getAttribute("class"))+" ").indexOf(match)>-1;},ATTR:function(elem,match){var name=match[1],result=Sizzle.attr?Sizzle.attr(elem,name):Expr.attrHandle[name]?Expr.attrHandle[name](elem):elem[name]!=null?elem[name]:elem.getAttribute(name),value=result+"",type=match[2],check=match[4];return result==null?type==="!=":!type&&Sizzle.attr?result!=null:type==="="?value===check:type==="*="?value.indexOf(check)>=0:type==="~="?(" "+value+" ").indexOf(check)>=0:!check?value&&result!==false:type==="!="?value!==check:type==="^="?value.indexOf(check)===0:type==="$="?value.substr(value.length-check.length)===check:type==="|="?value===check||value.substr(0,check.length+1)===check+"-":false;},POS:function(elem,match,i,array){var name=match[2],filter=Expr.setFilters[name];if(filter){return filter(elem,i,match,array);}}}};var origPOS=Expr.match.POS,fescape=function(all,num){return"\\"+(num-0+1);};for(var type in Expr.match){Expr.match[type]=new RegExp(Expr.match[type].source+(/(?![^\[]*\])(?![^\(]*\))/.source));Expr.leftMatch[type]=new RegExp(/(^(?:.|\r|\n)*?)/.source+Expr.match[type].source.replace(/\\(\d+)/g,fescape));}
var makeArray=function(array,results){array=Array.prototype.slice.call(array,0);if(results){results.push.apply(results,array);return results;}
return array;};try{Array.prototype.slice.call(document.documentElement.childNodes,0)[0].nodeType;}catch(e){makeArray=function(array,results){var i=0,ret=results||[];if(toString.call(array)==="[object Array]"){Array.prototype.push.apply(ret,array);}else{if(typeof array.length==="number"){for(var l=array.length;i<l;i++){ret.push(array[i]);}}else{for(;array[i];i++){ret.push(array[i]);}}}
return ret;};}
var sortOrder,siblingCheck;if(document.documentElement.compareDocumentPosition){sortOrder=function(a,b){if(a===b){hasDuplicate=true;return 0;}
if(!a.compareDocumentPosition||!b.compareDocumentPosition){return a.compareDocumentPosition?-1:1;}
return a.compareDocumentPosition(b)&4?-1:1;};}else{sortOrder=function(a,b){if(a===b){hasDuplicate=true;return 0;}else if(a.sourceIndex&&b.sourceIndex){return a.sourceIndex-b.sourceIndex;}
var al,bl,ap=[],bp=[],aup=a.parentNode,bup=b.parentNode,cur=aup;if(aup===bup){return siblingCheck(a,b);}else if(!aup){return-1;}else if(!bup){return 1;}
while(cur){ap.unshift(cur);cur=cur.parentNode;}
cur=bup;while(cur){bp.unshift(cur);cur=cur.parentNode;}
al=ap.length;bl=bp.length;for(var i=0;i<al&&i<bl;i++){if(ap[i]!==bp[i]){return siblingCheck(ap[i],bp[i]);}}
return i===al?siblingCheck(a,bp[i],-1):siblingCheck(ap[i],b,1);};siblingCheck=function(a,b,ret){if(a===b){return ret;}
var cur=a.nextSibling;while(cur){if(cur===b){return-1;}
cur=cur.nextSibling;}
return 1;};}
(function(){var form=document.createElement("div"),id="script"+(new Date()).getTime(),root=document.documentElement;form.innerHTML="<a name='"+id+"'/>";root.insertBefore(form,root.firstChild);if(document.getElementById(id)){Expr.find.ID=function(match,context,isXML){if(typeof context.getElementById!=="undefined"&&!isXML){var m=context.getElementById(match[1]);return m?m.id===match[1]||typeof m.getAttributeNode!=="undefined"&&m.getAttributeNode("id").nodeValue===match[1]?[m]:undefined:[];}};Expr.filter.ID=function(elem,match){var node=typeof elem.getAttributeNode!=="undefined"&&elem.getAttributeNode("id");return elem.nodeType===1&&node&&node.nodeValue===match;};}
root.removeChild(form);root=form=null;})();(function(){var div=document.createElement("div");div.appendChild(document.createComment(""));if(div.getElementsByTagName("*").length>0){Expr.find.TAG=function(match,context){var results=context.getElementsByTagName(match[1]);if(match[1]==="*"){var tmp=[];for(var i=0;results[i];i++){if(results[i].nodeType===1){tmp.push(results[i]);}}
results=tmp;}
return results;};}
div.innerHTML="<a href='#'></a>";if(div.firstChild&&typeof div.firstChild.getAttribute!=="undefined"&&div.firstChild.getAttribute("href")!=="#"){Expr.attrHandle.href=function(elem){return elem.getAttribute("href",2);};}
div=null;})();if(document.querySelectorAll){(function(){var oldSizzle=Sizzle,div=document.createElement("div"),id="__sizzle__";div.innerHTML="<p class='TEST'></p>";if(div.querySelectorAll&&div.querySelectorAll(".TEST").length===0){return;}
Sizzle=function(query,context,extra,seed){context=context||document;if(!seed&&!Sizzle.isXML(context)){var match=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(query);if(match&&(context.nodeType===1||context.nodeType===9)){if(match[1]){return makeArray(context.getElementsByTagName(query),extra);}else if(match[2]&&Expr.find.CLASS&&context.getElementsByClassName){return makeArray(context.getElementsByClassName(match[2]),extra);}}
if(context.nodeType===9){if(query==="body"&&context.body){return makeArray([context.body],extra);}else if(match&&match[3]){var elem=context.getElementById(match[3]);if(elem&&elem.parentNode){if(elem.id===match[3]){return makeArray([elem],extra);}}else{return makeArray([],extra);}}
try{return makeArray(context.querySelectorAll(query),extra);}catch(qsaError){}}else if(context.nodeType===1&&context.nodeName.toLowerCase()!=="object"){var oldContext=context,old=context.getAttribute("id"),nid=old||id,hasParent=context.parentNode,relativeHierarchySelector=/^\s*[+~]/.test(query);if(!old){context.setAttribute("id",nid);}else{nid=nid.replace(/'/g,"\\$&");}
if(relativeHierarchySelector&&hasParent){context=context.parentNode;}
try{if(!relativeHierarchySelector||hasParent){return makeArray(context.querySelectorAll("[id='"+nid+"'] "+query),extra);}}catch(pseudoError){}finally{if(!old){oldContext.removeAttribute("id");}}}}
return oldSizzle(query,context,extra,seed);};for(var prop in oldSizzle){Sizzle[prop]=oldSizzle[prop];}
div=null;})();}
(function(){var html=document.documentElement,matches=html.matchesSelector||html.mozMatchesSelector||html.webkitMatchesSelector||html.msMatchesSelector;if(matches){var disconnectedMatch=!matches.call(document.createElement("div"),"div"),pseudoWorks=false;try{matches.call(document.documentElement,"[test!='']:sizzle");}catch(pseudoError){pseudoWorks=true;}
Sizzle.matchesSelector=function(node,expr){expr=expr.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!Sizzle.isXML(node)){try{if(pseudoWorks||!Expr.match.PSEUDO.test(expr)&&!/!=/.test(expr)){var ret=matches.call(node,expr);if(ret||!disconnectedMatch||node.document&&node.document.nodeType!==11){return ret;}}}catch(e){}}
return Sizzle(expr,null,null,[node]).length>0;};}})();(function(){var div=document.createElement("div");div.innerHTML="<div class='test e'></div><div class='test'></div>";if(!div.getElementsByClassName||div.getElementsByClassName("e").length===0){return;}
div.lastChild.className="e";if(div.getElementsByClassName("e").length===1){return;}
Expr.order.splice(1,0,"CLASS");Expr.find.CLASS=function(match,context,isXML){if(typeof context.getElementsByClassName!=="undefined"&&!isXML){return context.getElementsByClassName(match[1]);}};div=null;})();function dirNodeCheck(dir,cur,doneName,checkSet,nodeCheck,isXML){for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){var match=false;elem=elem[dir];while(elem){if(elem[expando]===doneName){match=checkSet[elem.sizset];break;}
if(elem.nodeType===1&&!isXML){elem[expando]=doneName;elem.sizset=i;}
if(elem.nodeName.toLowerCase()===cur){match=elem;break;}
elem=elem[dir];}
checkSet[i]=match;}}}
function dirCheck(dir,cur,doneName,checkSet,nodeCheck,isXML){for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){var match=false;elem=elem[dir];while(elem){if(elem[expando]===doneName){match=checkSet[elem.sizset];break;}
if(elem.nodeType===1){if(!isXML){elem[expando]=doneName;elem.sizset=i;}
if(typeof cur!=="string"){if(elem===cur){match=true;break;}}else if(Sizzle.filter(cur,[elem]).length>0){match=elem;break;}}
elem=elem[dir];}
checkSet[i]=match;}}}
if(document.documentElement.contains){Sizzle.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):true);};}else if(document.documentElement.compareDocumentPosition){Sizzle.contains=function(a,b){return!!(a.compareDocumentPosition(b)&16);};}else{Sizzle.contains=function(){return false;};}
Sizzle.isXML=function(elem){var documentElement=(elem?elem.ownerDocument||elem:0).documentElement;return documentElement?documentElement.nodeName!=="HTML":false;};var posProcess=function(selector,context,seed){var match,tmpSet=[],later="",root=context.nodeType?[context]:context;while((match=Expr.match.PSEUDO.exec(selector))){later+=match[0];selector=selector.replace(Expr.match.PSEUDO,"");}
selector=Expr.relative[selector]?selector+"*":selector;for(var i=0,l=root.length;i<l;i++){Sizzle(selector,root[i],tmpSet,seed);}
return Sizzle.filter(later,tmpSet);};Sizzle.attr=jQuery.attr;Sizzle.selectors.attrMap={};jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.filters;jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains;})();var runtil=/Until$/,rparentsprev=/^(?:parents|prevUntil|prevAll)/,rmultiselector=/,/,isSimple=/^.[^:#\[\.,]*$/,slice=Array.prototype.slice,POS=jQuery.expr.match.POS,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.fn.extend({find:function(selector){var self=this,i,l;if(typeof selector!=="string"){return jQuery(selector).filter(function(){for(i=0,l=self.length;i<l;i++){if(jQuery.contains(self[i],this)){return true;}}});}
var ret=this.pushStack("","find",selector),length,n,r;for(i=0,l=this.length;i<l;i++){length=ret.length;jQuery.find(selector,this[i],ret);if(i>0){for(n=length;n<ret.length;n++){for(r=0;r<length;r++){if(ret[r]===ret[n]){ret.splice(n--,1);break;}}}}}
return ret;},has:function(target){var targets=jQuery(target);return this.filter(function(){for(var i=0,l=targets.length;i<l;i++){if(jQuery.contains(this,targets[i])){return true;}}});},not:function(selector){return this.pushStack(winnow(this,selector,false),"not",selector);},filter:function(selector){return this.pushStack(winnow(this,selector,true),"filter",selector);},is:function(selector){return!!selector&&(typeof selector==="string"?POS.test(selector)?jQuery(selector,this.context).index(this[0])>=0:jQuery.filter(selector,this).length>0:this.filter(selector).length>0);},closest:function(selectors,context){var ret=[],i,l,cur=this[0];if(jQuery.isArray(selectors)){var level=1;while(cur&&cur.ownerDocument&&cur!==context){for(i=0;i<selectors.length;i++){if(jQuery(cur).is(selectors[i])){ret.push({selector:selectors[i],elem:cur,level:level});}}
cur=cur.parentNode;level++;}
return ret;}
var pos=POS.test(selectors)||typeof selectors!=="string"?jQuery(selectors,context||this.context):0;for(i=0,l=this.length;i<l;i++){cur=this[i];while(cur){if(pos?pos.index(cur)>-1:jQuery.find.matchesSelector(cur,selectors)){ret.push(cur);break;}else{cur=cur.parentNode;if(!cur||!cur.ownerDocument||cur===context||cur.nodeType===11){break;}}}}
ret=ret.length>1?jQuery.unique(ret):ret;return this.pushStack(ret,"closest",selectors);},index:function(elem){if(!elem){return(this[0]&&this[0].parentNode)?this.prevAll().length:-1;}
if(typeof elem==="string"){return jQuery.inArray(this[0],jQuery(elem));}
return jQuery.inArray(elem.jquery?elem[0]:elem,this);},add:function(selector,context){var set=typeof selector==="string"?jQuery(selector,context):jQuery.makeArray(selector&&selector.nodeType?[selector]:selector),all=jQuery.merge(this.get(),set);return this.pushStack(isDisconnected(set[0])||isDisconnected(all[0])?all:jQuery.unique(all));},andSelf:function(){return this.add(this.prevObject);}});function isDisconnected(node){return!node||!node.parentNode||node.parentNode.nodeType===11;}
jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null;},parents:function(elem){return jQuery.dir(elem,"parentNode");},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until);},next:function(elem){return jQuery.nth(elem,2,"nextSibling");},prev:function(elem){return jQuery.nth(elem,2,"previousSibling");},nextAll:function(elem){return jQuery.dir(elem,"nextSibling");},prevAll:function(elem){return jQuery.dir(elem,"previousSibling");},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until);},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until);},siblings:function(elem){return jQuery.sibling(elem.parentNode.firstChild,elem);},children:function(elem){return jQuery.sibling(elem.firstChild);},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.makeArray(elem.childNodes);}},function(name,fn){jQuery.fn[name]=function(until,selector){var ret=jQuery.map(this,fn,until);if(!runtil.test(name)){selector=until;}
if(selector&&typeof selector==="string"){ret=jQuery.filter(selector,ret);}
ret=this.length>1&&!guaranteedUnique[name]?jQuery.unique(ret):ret;if((this.length>1||rmultiselector.test(selector))&&rparentsprev.test(name)){ret=ret.reverse();}
return this.pushStack(ret,name,slice.call(arguments).join(","));};});jQuery.extend({filter:function(expr,elems,not){if(not){expr=":not("+expr+")";}
return elems.length===1?jQuery.find.matchesSelector(elems[0],expr)?[elems[0]]:[]:jQuery.find.matches(expr,elems);},dir:function(elem,dir,until){var matched=[],cur=elem[dir];while(cur&&cur.nodeType!==9&&(until===undefined||cur.nodeType!==1||!jQuery(cur).is(until))){if(cur.nodeType===1){matched.push(cur);}
cur=cur[dir];}
return matched;},nth:function(cur,result,dir,elem){result=result||1;var num=0;for(;cur;cur=cur[dir]){if(cur.nodeType===1&&++num===result){break;}}
return cur;},sibling:function(n,elem){var r=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){r.push(n);}}
return r;}});function winnow(elements,qualifier,keep){qualifier=qualifier||0;if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){var retVal=!!qualifier.call(elem,i,elem);return retVal===keep;});}else if(qualifier.nodeType){return jQuery.grep(elements,function(elem,i){return(elem===qualifier)===keep;});}else if(typeof qualifier==="string"){var filtered=jQuery.grep(elements,function(elem){return elem.nodeType===1;});if(isSimple.test(qualifier)){return jQuery.filter(qualifier,filtered,!keep);}else{qualifier=jQuery.filter(qualifier,filtered);}}
return jQuery.grep(elements,function(elem,i){return(jQuery.inArray(elem,qualifier)>=0)===keep;});}
function createSafeFragment(document){var list=nodeNames.split("|"),safeFrag=document.createDocumentFragment();if(safeFrag.createElement){while(list.length){safeFrag.createElement(list.pop());}}
return safeFrag;}
var nodeNames="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|"+"header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",rinlinejQuery=/ jQuery\d+="(?:\d+|null)"/g,rleadingWhitespace=/^\s+/,rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,rtagName=/<([\w:]+)/,rtbody=/<tbody/i,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style)/i,rnocache=/<(?:script|object|embed|option|style)/i,rnoshimcache=new RegExp("<(?:"+nodeNames+")","i"),rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/\/(java|ecma)script/i,rcleanScript=/^\s*<!(?:\[CDATA\[|\-\-)/,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},safeFragment=createSafeFragment(document);wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;if(!jQuery.support.htmlSerialize){wrapMap._default=[1,"div<div>","</div>"];}
jQuery.fn.extend({text:function(text){if(jQuery.isFunction(text)){return this.each(function(i){var self=jQuery(this);self.text(text.call(this,i,self.text()));});}
if(typeof text!=="object"&&text!==undefined){return this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(text));}
return jQuery.text(this);},wrapAll:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i));});}
if(this[0]){var wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0]);}
wrap.map(function(){var elem=this;while(elem.firstChild&&elem.firstChild.nodeType===1){elem=elem.firstChild;}
return elem;}).append(this);}
return this;},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i));});}
return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html);}else{self.append(html);}});},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html);});},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes);}}).end();},append:function(){return this.domManip(arguments,true,function(elem){if(this.nodeType===1){this.appendChild(elem);}});},prepend:function(){return this.domManip(arguments,true,function(elem){if(this.nodeType===1){this.insertBefore(elem,this.firstChild);}});},before:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,false,function(elem){this.parentNode.insertBefore(elem,this);});}else if(arguments.length){var set=jQuery.clean(arguments);set.push.apply(set,this.toArray());return this.pushStack(set,"before",arguments);}},after:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,false,function(elem){this.parentNode.insertBefore(elem,this.nextSibling);});}else if(arguments.length){var set=this.pushStack(this,"after",arguments);set.push.apply(set,jQuery.clean(arguments));return set;}},remove:function(selector,keepData){for(var i=0,elem;(elem=this[i])!=null;i++){if(!selector||jQuery.filter(selector,[elem]).length){if(!keepData&&elem.nodeType===1){jQuery.cleanData(elem.getElementsByTagName("*"));jQuery.cleanData([elem]);}
if(elem.parentNode){elem.parentNode.removeChild(elem);}}}
return this;},empty:function(){for(var i=0,elem;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(elem.getElementsByTagName("*"));}
while(elem.firstChild){elem.removeChild(elem.firstChild);}}
return this;},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents);});},html:function(value){if(value===undefined){return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(rinlinejQuery,""):null;}else if(typeof value==="string"&&!rnoInnerhtml.test(value)&&(jQuery.support.leadingWhitespace||!rleadingWhitespace.test(value))&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(var i=0,l=this.length;i<l;i++){if(this[i].nodeType===1){jQuery.cleanData(this[i].getElementsByTagName("*"));this[i].innerHTML=value;}}}catch(e){this.empty().append(value);}}else if(jQuery.isFunction(value)){this.each(function(i){var self=jQuery(this);self.html(value.call(this,i,self.html()));});}else{this.empty().append(value);}
return this;},replaceWith:function(value){if(this[0]&&this[0].parentNode){if(jQuery.isFunction(value)){return this.each(function(i){var self=jQuery(this),old=self.html();self.replaceWith(value.call(this,i,old));});}
if(typeof value!=="string"){value=jQuery(value).detach();}
return this.each(function(){var next=this.nextSibling,parent=this.parentNode;jQuery(this).remove();if(next){jQuery(next).before(value);}else{jQuery(parent).append(value);}});}else{return this.length?this.pushStack(jQuery(jQuery.isFunction(value)?value():value),"replaceWith",value):this;}},detach:function(selector){return this.remove(selector,true);},domManip:function(args,table,callback){var results,first,fragment,parent,value=args[0],scripts=[];if(!jQuery.support.checkClone&&arguments.length===3&&typeof value==="string"&&rchecked.test(value)){return this.each(function(){jQuery(this).domManip(args,table,callback,true);});}
if(jQuery.isFunction(value)){return this.each(function(i){var self=jQuery(this);args[0]=value.call(this,i,table?self.html():undefined);self.domManip(args,table,callback);});}
if(this[0]){parent=value&&value.parentNode;if(jQuery.support.parentNode&&parent&&parent.nodeType===11&&parent.childNodes.length===this.length){results={fragment:parent};}else{results=jQuery.buildFragment(args,this,scripts);}
fragment=results.fragment;if(fragment.childNodes.length===1){first=fragment=fragment.firstChild;}else{first=fragment.firstChild;}
if(first){table=table&&jQuery.nodeName(first,"tr");for(var i=0,l=this.length,lastIndex=l-1;i<l;i++){callback.call(table?root(this[i],first):this[i],results.cacheable||(l>1&&i<lastIndex)?jQuery.clone(fragment,true,true):fragment);}}
if(scripts.length){jQuery.each(scripts,evalScript);}}
return this;}});function root(elem,cur){return jQuery.nodeName(elem,"table")?(elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody"))):elem;}
function cloneCopyEvent(src,dest){if(dest.nodeType!==1||!jQuery.hasData(src)){return;}
var type,i,l,oldData=jQuery._data(src),curData=jQuery._data(dest,oldData),events=oldData.events;if(events){delete curData.handle;curData.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type+(events[type][i].namespace?".":"")+events[type][i].namespace,events[type][i],events[type][i].data);}}}
if(curData.data){curData.data=jQuery.extend({},curData.data);}}
function cloneFixAttributes(src,dest){var nodeName;if(dest.nodeType!==1){return;}
if(dest.clearAttributes){dest.clearAttributes();}
if(dest.mergeAttributes){dest.mergeAttributes(src);}
nodeName=dest.nodeName.toLowerCase();if(nodeName==="object"){dest.outerHTML=src.outerHTML;}else if(nodeName==="input"&&(src.type==="checkbox"||src.type==="radio")){if(src.checked){dest.defaultChecked=dest.checked=src.checked;}
if(dest.value!==src.value){dest.value=src.value;}}else if(nodeName==="option"){dest.selected=src.defaultSelected;}else if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue;}
dest.removeAttribute(jQuery.expando);}
jQuery.buildFragment=function(args,nodes,scripts){var fragment,cacheable,cacheresults,doc,first=args[0];if(nodes&&nodes[0]){doc=nodes[0].ownerDocument||nodes[0];}
if(!doc.createDocumentFragment){doc=document;}
if(args.length===1&&typeof first==="string"&&first.length<512&&doc===document&&first.charAt(0)==="<"&&!rnocache.test(first)&&(jQuery.support.checkClone||!rchecked.test(first))&&(jQuery.support.html5Clone||!rnoshimcache.test(first))){cacheable=true;cacheresults=jQuery.fragments[first];if(cacheresults&&cacheresults!==1){fragment=cacheresults;}}
if(!fragment){fragment=doc.createDocumentFragment();jQuery.clean(args,doc,fragment,scripts);}
if(cacheable){jQuery.fragments[first]=cacheresults?fragment:1;}
return{fragment:fragment,cacheable:cacheable};};jQuery.fragments={};jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var ret=[],insert=jQuery(selector),parent=this.length===1&&this[0].parentNode;if(parent&&parent.nodeType===11&&parent.childNodes.length===1&&insert.length===1){insert[original](this[0]);return this;}else{for(var i=0,l=insert.length;i<l;i++){var elems=(i>0?this.clone(true):this).get();jQuery(insert[i])[original](elems);ret=ret.concat(elems);}
return this.pushStack(ret,name,insert.selector);}};});function getAll(elem){if(typeof elem.getElementsByTagName!=="undefined"){return elem.getElementsByTagName("*");}else if(typeof elem.querySelectorAll!=="undefined"){return elem.querySelectorAll("*");}else{return[];}}
function fixDefaultChecked(elem){if(elem.type==="checkbox"||elem.type==="radio"){elem.defaultChecked=elem.checked;}}
function findInputs(elem){var nodeName=(elem.nodeName||"").toLowerCase();if(nodeName==="input"){fixDefaultChecked(elem);}else if(nodeName!=="script"&&typeof elem.getElementsByTagName!=="undefined"){jQuery.grep(elem.getElementsByTagName("input"),fixDefaultChecked);}}
function shimCloneNode(elem){var div=document.createElement("div");safeFragment.appendChild(div);div.innerHTML=elem.outerHTML;return div.firstChild;}
jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var srcElements,destElements,i,clone=jQuery.support.html5Clone||!rnoshimcache.test("<"+elem.nodeName)?elem.cloneNode(true):shimCloneNode(elem);if((!jQuery.support.noCloneEvent||!jQuery.support.noCloneChecked)&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){cloneFixAttributes(elem,clone);srcElements=getAll(elem);destElements=getAll(clone);for(i=0;srcElements[i];++i){if(destElements[i]){cloneFixAttributes(srcElements[i],destElements[i]);}}}
if(dataAndEvents){cloneCopyEvent(elem,clone);if(deepDataAndEvents){srcElements=getAll(elem);destElements=getAll(clone);for(i=0;srcElements[i];++i){cloneCopyEvent(srcElements[i],destElements[i]);}}}
srcElements=destElements=null;return clone;},clean:function(elems,context,fragment,scripts){var checkScriptType;context=context||document;if(typeof context.createElement==="undefined"){context=context.ownerDocument||context[0]&&context[0].ownerDocument||document;}
var ret=[],j;for(var i=0,elem;(elem=elems[i])!=null;i++){if(typeof elem==="number"){elem+="";}
if(!elem){continue;}
if(typeof elem==="string"){if(!rhtml.test(elem)){elem=context.createTextNode(elem);}else{elem=elem.replace(rxhtmlTag,"<$1></$2>");var tag=(rtagName.exec(elem)||["",""])[1].toLowerCase(),wrap=wrapMap[tag]||wrapMap._default,depth=wrap[0],div=context.createElement("div");if(context===document){safeFragment.appendChild(div);}else{createSafeFragment(context).appendChild(div);}
div.innerHTML=wrap[1]+elem+wrap[2];while(depth--){div=div.lastChild;}
if(!jQuery.support.tbody){var hasBody=rtbody.test(elem),tbody=tag==="table"&&!hasBody?div.firstChild&&div.firstChild.childNodes:wrap[1]==="<table>"&&!hasBody?div.childNodes:[];for(j=tbody.length-1;j>=0;--j){if(jQuery.nodeName(tbody[j],"tbody")&&!tbody[j].childNodes.length){tbody[j].parentNode.removeChild(tbody[j]);}}}
if(!jQuery.support.leadingWhitespace&&rleadingWhitespace.test(elem)){div.insertBefore(context.createTextNode(rleadingWhitespace.exec(elem)[0]),div.firstChild);}
elem=div.childNodes;}}
var len;if(!jQuery.support.appendChecked){if(elem[0]&&typeof(len=elem.length)==="number"){for(j=0;j<len;j++){findInputs(elem[j]);}}else{findInputs(elem);}}
if(elem.nodeType){ret.push(elem);}else{ret=jQuery.merge(ret,elem);}}
if(fragment){checkScriptType=function(elem){return!elem.type||rscriptType.test(elem.type);};for(i=0;ret[i];i++){if(scripts&&jQuery.nodeName(ret[i],"script")&&(!ret[i].type||ret[i].type.toLowerCase()==="text/javascript")){scripts.push(ret[i].parentNode?ret[i].parentNode.removeChild(ret[i]):ret[i]);}else{if(ret[i].nodeType===1){var jsTags=jQuery.grep(ret[i].getElementsByTagName("script"),checkScriptType);ret.splice.apply(ret,[i+1,0].concat(jsTags));}
fragment.appendChild(ret[i]);}}}
return ret;},cleanData:function(elems){var data,id,cache=jQuery.cache,special=jQuery.event.special,deleteExpando=jQuery.support.deleteExpando;for(var i=0,elem;(elem=elems[i])!=null;i++){if(elem.nodeName&&jQuery.noData[elem.nodeName.toLowerCase()]){continue;}
id=elem[jQuery.expando];if(id){data=cache[id];if(data&&data.events){for(var type in data.events){if(special[type]){jQuery.event.remove(elem,type);}else{jQuery.removeEvent(elem,type,data.handle);}}
if(data.handle){data.handle.elem=null;}}
if(deleteExpando){delete elem[jQuery.expando];}else if(elem.removeAttribute){elem.removeAttribute(jQuery.expando);}
delete cache[id];}}}});function evalScript(i,elem){if(elem.src){jQuery.ajax({url:elem.src,async:false,dataType:"script"});}else{jQuery.globalEval((elem.text||elem.textContent||elem.innerHTML||"").replace(rcleanScript,"/*$0*/"));}
if(elem.parentNode){elem.parentNode.removeChild(elem);}}
var ralpha=/alpha\([^)]*\)/i,ropacity=/opacity=([^)]*)/,rupper=/([A-Z]|^ms)/g,rnumpx=/^-?\d+(?:px)?$/i,rnum=/^-?\d/,rrelNum=/^([\-+])=([\-+.\de]+)/,cssShow={position:"absolute",visibility:"hidden",display:"block"},cssWidth=["Left","Right"],cssHeight=["Top","Bottom"],curCSS,getComputedStyle,currentStyle;jQuery.fn.css=function(name,value){if(arguments.length===2&&value===undefined){return this;}
return jQuery.access(this,name,value,true,function(elem,name,value){return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name);});};jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity","opacity");return ret===""?"1":ret;}else{return elem.style.opacity;}}}},cssNumber:{"fillOpacity":true,"fontWeight":true,"lineHeight":true,"opacity":true,"orphans":true,"widows":true,"zIndex":true,"zoom":true},cssProps:{"float":jQuery.support.cssFloat?"cssFloat":"styleFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return;}
var ret,type,origName=jQuery.camelCase(name),style=elem.style,hooks=jQuery.cssHooks[origName];name=jQuery.cssProps[origName]||origName;if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rrelNum.exec(value))){value=(+(ret[1]+1)*+ret[2])+parseFloat(jQuery.css(elem,name));type="number";}
if(value==null||type==="number"&&isNaN(value)){return;}
if(type==="number"&&!jQuery.cssNumber[origName]){value+="px";}
if(!hooks||!("set"in hooks)||(value=hooks.set(elem,value))!==undefined){try{style[name]=value;}catch(e){}}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret;}
return style[name];}},css:function(elem,name,extra){var ret,hooks;name=jQuery.camelCase(name);hooks=jQuery.cssHooks[name];name=jQuery.cssProps[name]||name;if(name==="cssFloat"){name="float";}
if(hooks&&"get"in hooks&&(ret=hooks.get(elem,true,extra))!==undefined){return ret;}else if(curCSS){return curCSS(elem,name);}},swap:function(elem,options,callback){var old={};for(var name in options){old[name]=elem.style[name];elem.style[name]=options[name];}
callback.call(elem);for(name in options){elem.style[name]=old[name];}}});jQuery.curCSS=jQuery.css;jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){var val;if(computed){if(elem.offsetWidth!==0){return getWH(elem,name,extra);}else{jQuery.swap(elem,cssShow,function(){val=getWH(elem,name,extra);});}
return val;}},set:function(elem,value){if(rnumpx.test(value)){value=parseFloat(value);if(value>=0){return value+"px";}}else{return value;}}};});if(!jQuery.support.opacity){jQuery.cssHooks.opacity={get:function(elem,computed){return ropacity.test((computed&&elem.currentStyle?elem.currentStyle.filter:elem.style.filter)||"")?(parseFloat(RegExp.$1)/100)+"":computed?"1":"";},set:function(elem,value){var style=elem.style,currentStyle=elem.currentStyle,opacity=jQuery.isNumeric(value)?"alpha(opacity="+value*100+")":"",filter=currentStyle&&currentStyle.filter||style.filter||"";style.zoom=1;if(value>=1&&jQuery.trim(filter.replace(ralpha,""))===""){style.removeAttribute("filter");if(currentStyle&&!currentStyle.filter){return;}}
style.filter=ralpha.test(filter)?filter.replace(ralpha,opacity):filter+" "+opacity;}};}
jQuery(function(){if(!jQuery.support.reliableMarginRight){jQuery.cssHooks.marginRight={get:function(elem,computed){var ret;jQuery.swap(elem,{"display":"inline-block"},function(){if(computed){ret=curCSS(elem,"margin-right","marginRight");}else{ret=elem.style.marginRight;}});return ret;}};}});if(document.defaultView&&document.defaultView.getComputedStyle){getComputedStyle=function(elem,name){var ret,defaultView,computedStyle;name=name.replace(rupper,"-$1").toLowerCase();if((defaultView=elem.ownerDocument.defaultView)&&(computedStyle=defaultView.getComputedStyle(elem,null))){ret=computedStyle.getPropertyValue(name);if(ret===""&&!jQuery.contains(elem.ownerDocument.documentElement,elem)){ret=jQuery.style(elem,name);}}
return ret;};}
if(document.documentElement.currentStyle){currentStyle=function(elem,name){var left,rsLeft,uncomputed,ret=elem.currentStyle&&elem.currentStyle[name],style=elem.style;if(ret===null&&style&&(uncomputed=style[name])){ret=uncomputed;}
if(!rnumpx.test(ret)&&rnum.test(ret)){left=style.left;rsLeft=elem.runtimeStyle&&elem.runtimeStyle.left;if(rsLeft){elem.runtimeStyle.left=elem.currentStyle.left;}
style.left=name==="fontSize"?"1em":(ret||0);ret=style.pixelLeft+"px";style.left=left;if(rsLeft){elem.runtimeStyle.left=rsLeft;}}
return ret===""?"auto":ret;};}
curCSS=getComputedStyle||currentStyle;function getWH(elem,name,extra){var val=name==="width"?elem.offsetWidth:elem.offsetHeight,which=name==="width"?cssWidth:cssHeight,i=0,len=which.length;if(val>0){if(extra!=="border"){for(;i<len;i++){if(!extra){val-=parseFloat(jQuery.css(elem,"padding"+which[i]))||0;}
if(extra==="margin"){val+=parseFloat(jQuery.css(elem,extra+which[i]))||0;}else{val-=parseFloat(jQuery.css(elem,"border"+which[i]+"Width"))||0;}}}
return val+"px";}
val=curCSS(elem,name,name);if(val<0||val==null){val=elem.style[name]||0;}
val=parseFloat(val)||0;if(extra){for(;i<len;i++){val+=parseFloat(jQuery.css(elem,"padding"+which[i]))||0;if(extra!=="padding"){val+=parseFloat(jQuery.css(elem,"border"+which[i]+"Width"))||0;}
if(extra==="margin"){val+=parseFloat(jQuery.css(elem,extra+which[i]))||0;}}}
return val+"px";}
if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.hidden=function(elem){var width=elem.offsetWidth,height=elem.offsetHeight;return(width===0&&height===0)||(!jQuery.support.reliableHiddenOffsets&&((elem.style&&elem.style.display)||jQuery.css(elem,"display"))==="none");};jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem);};}
var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rhash=/#.*$/,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,rinput=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,rlocalProtocol=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rquery=/\?/,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,rselectTextarea=/^(?:select|textarea)/i,rspacesAjax=/\s+/,rts=/([?&])_=[^&]*/,rurl=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,_load=jQuery.fn.load,prefilters={},transports={},ajaxLocation,ajaxLocParts,allTypes=["*/"]+["*"];try{ajaxLocation=location.href;}catch(e){ajaxLocation=document.createElement("a");ajaxLocation.href="";ajaxLocation=ajaxLocation.href;}
ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*";}
if(jQuery.isFunction(func)){var dataTypes=dataTypeExpression.toLowerCase().split(rspacesAjax),i=0,length=dataTypes.length,dataType,list,placeBefore;for(;i<length;i++){dataType=dataTypes[i];placeBefore=/^\+/.test(dataType);if(placeBefore){dataType=dataType.substr(1)||"*";}
list=structure[dataType]=structure[dataType]||[];list[placeBefore?"unshift":"push"](func);}}};}
function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,dataType,inspected){dataType=dataType||options.dataTypes[0];inspected=inspected||{};inspected[dataType]=true;var list=structure[dataType],i=0,length=list?list.length:0,executeOnly=(structure===prefilters),selection;for(;i<length&&(executeOnly||!selection);i++){selection=list[i](options,originalOptions,jqXHR);if(typeof selection==="string"){if(!executeOnly||inspected[selection]){selection=undefined;}else{options.dataTypes.unshift(selection);selection=inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,selection,inspected);}}}
if((executeOnly||!selection)&&!inspected["*"]){selection=inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR,"*",inspected);}
return selection;}
function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:(deep||(deep={})))[key]=src[key];}}
if(deep){jQuery.extend(true,target,deep);}}
jQuery.fn.extend({load:function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments);}else if(!this.length){return this;}
var off=url.indexOf(" ");if(off>=0){var selector=url.slice(off,url.length);url=url.slice(0,off);}
var type="GET";if(params){if(jQuery.isFunction(params)){callback=params;params=undefined;}else if(typeof params==="object"){params=jQuery.param(params,jQuery.ajaxSettings.traditional);type="POST";}}
var self=this;jQuery.ajax({url:url,type:type,dataType:"html",data:params,complete:function(jqXHR,status,responseText){responseText=jqXHR.responseText;if(jqXHR.isResolved()){jqXHR.done(function(r){responseText=r;});self.html(selector?jQuery("<div>").append(responseText.replace(rscript,"")).find(selector):responseText);}
if(callback){self.each(callback,[responseText,status,jqXHR]);}}});return this;},serialize:function(){return jQuery.param(this.serializeArray());},serializeArray:function(){return this.map(function(){return this.elements?jQuery.makeArray(this.elements):this;}).filter(function(){return this.name&&!this.disabled&&(this.checked||rselectTextarea.test(this.nodeName)||rinput.test(this.type));}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val,i){return{name:elem.name,value:val.replace(rCRLF,"\r\n")};}):{name:elem.name,value:val.replace(rCRLF,"\r\n")};}).get();}});jQuery.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(i,o){jQuery.fn[o]=function(f){return this.on(o,f);};});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined;}
return jQuery.ajax({type:method,url:url,data:data,success:callback,dataType:type});};});jQuery.extend({getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script");},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json");},ajaxSetup:function(target,settings){if(settings){ajaxExtend(target,jQuery.ajaxSettings);}else{settings=target;target=jQuery.ajaxSettings;}
ajaxExtend(target,settings);return target;},ajaxSettings:{url:ajaxLocation,isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":allTypes},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":window.String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{context:true,url:true}},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined;}
options=options||{};var
s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=callbackContext!==s&&(callbackContext.nodeType||callbackContext instanceof jQuery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},ifModifiedKey,requestHeaders={},requestHeadersNames={},responseHeadersString,responseHeaders,transport,timeoutTimer,parts,state=0,fireGlobals,i,jqXHR={readyState:0,setRequestHeader:function(name,value){if(!state){var lname=name.toLowerCase();name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value;}
return this;},getAllResponseHeaders:function(){return state===2?responseHeadersString:null;},getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while((match=rheaders.exec(responseHeadersString))){responseHeaders[match[1].toLowerCase()]=match[2];}}
match=responseHeaders[key.toLowerCase()];}
return match===undefined?null:match;},overrideMimeType:function(type){if(!state){s.mimeType=type;}
return this;},abort:function(statusText){statusText=statusText||"abort";if(transport){transport.abort(statusText);}
done(0,statusText);return this;}};function done(status,nativeStatusText,responses,headers){if(state===2){return;}
state=2;if(timeoutTimer){clearTimeout(timeoutTimer);}
transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;var isSuccess,success,error,statusText=nativeStatusText,response=responses?ajaxHandleResponses(s,jqXHR,responses):undefined,lastModified,etag;if(status>=200&&status<300||status===304){if(s.ifModified){if((lastModified=jqXHR.getResponseHeader("Last-Modified"))){jQuery.lastModified[ifModifiedKey]=lastModified;}
if((etag=jqXHR.getResponseHeader("Etag"))){jQuery.etag[ifModifiedKey]=etag;}}
if(status===304){statusText="notmodified";isSuccess=true;}else{try{success=ajaxConvert(s,response);statusText="success";isSuccess=true;}catch(e){statusText="parsererror";error=e;}}}else{error=statusText;if(!statusText||status){statusText="error";if(status<0){status=0;}}}
jqXHR.status=status;jqXHR.statusText=""+(nativeStatusText||statusText);if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR]);}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error]);}
jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger("ajax"+(isSuccess?"Success":"Error"),[jqXHR,s,isSuccess?success:error]);}
completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!(--jQuery.active)){jQuery.event.trigger("ajaxStop");}}}
deferred.promise(jqXHR);jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;jqXHR.complete=completeDeferred.add;jqXHR.statusCode=function(map){if(map){var tmp;if(state<2){for(tmp in map){statusCode[tmp]=[statusCode[tmp],map[tmp]];}}else{tmp=map[jqXHR.status];jqXHR.then(tmp,tmp);}}
return this;};s.url=((url||s.url)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().split(rspacesAjax);if(s.crossDomain==null){parts=rurl.exec(s.url.toLowerCase());s.crossDomain=!!(parts&&(parts[1]!=ajaxLocParts[1]||parts[2]!=ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?80:443))!=(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?80:443))));}
if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional);}
inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return false;}
fireGlobals=s.global;s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart");}
if(!s.hasContent){if(s.data){s.url+=(rquery.test(s.url)?"&":"?")+s.data;delete s.data;}
ifModifiedKey=s.url;if(s.cache===false){var ts=jQuery.now(),ret=s.url.replace(rts,"$1_="+ts);s.url=ret+((ret===s.url)?(rquery.test(s.url)?"&":"?")+"_="+ts:"");}}
if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType);}
if(s.ifModified){ifModifiedKey=ifModifiedKey||s.url;if(jQuery.lastModified[ifModifiedKey]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[ifModifiedKey]);}
if(jQuery.etag[ifModifiedKey]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[ifModifiedKey]);}}
jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i]);}
if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){jqXHR.abort();return false;}
for(i in{success:1,error:1,complete:1}){jqXHR[i](s[i]);}
transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport");}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s]);}
if(s.async&&s.timeout>0){timeoutTimer=setTimeout(function(){jqXHR.abort("timeout");},s.timeout);}
try{state=1;transport.send(requestHeaders,done);}catch(e){if(state<2){done(-1,e);}else{throw e;}}}
return jqXHR;},param:function(a,traditional){var s=[],add=function(key,value){value=jQuery.isFunction(value)?value():value;s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value);};if(traditional===undefined){traditional=jQuery.ajaxSettings.traditional;}
if(jQuery.isArray(a)||(a.jquery&&!jQuery.isPlainObject(a))){jQuery.each(a,function(){add(this.name,this.value);});}else{for(var prefix in a){buildParams(prefix,a[prefix],traditional,add);}}
return s.join("&").replace(r20,"+");}});function buildParams(prefix,obj,traditional,add){if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v);}else{buildParams(prefix+"["+(typeof v==="object"||jQuery.isArray(v)?i:"")+"]",v,traditional,add);}});}else if(!traditional&&obj!=null&&typeof obj==="object"){for(var name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add);}}else{add(prefix,obj);}}
jQuery.extend({active:0,lastModified:{},etag:{}});function ajaxHandleResponses(s,jqXHR,responses){var contents=s.contents,dataTypes=s.dataTypes,responseFields=s.responseFields,ct,type,finalDataType,firstDataType;for(type in responseFields){if(type in responses){jqXHR[responseFields[type]]=responses[type];}}
while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("content-type");}}
if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break;}}}
if(dataTypes[0]in responses){finalDataType=dataTypes[0];}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break;}
if(!firstDataType){firstDataType=type;}}
finalDataType=finalDataType||firstDataType;}
if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType);}
return responses[finalDataType];}}
function ajaxConvert(s,response){if(s.dataFilter){response=s.dataFilter(response,s.dataType);}
var dataTypes=s.dataTypes,converters={},i,key,length=dataTypes.length,tmp,current=dataTypes[0],prev,conversion,conv,conv1,conv2;for(i=1;i<length;i++){if(i===1){for(key in s.converters){if(typeof key==="string"){converters[key.toLowerCase()]=s.converters[key];}}}
prev=current;current=dataTypes[i];if(current==="*"){current=prev;}else if(prev!=="*"&&prev!==current){conversion=prev+" "+current;conv=converters[conversion]||converters["* "+current];if(!conv){conv2=undefined;for(conv1 in converters){tmp=conv1.split(" ");if(tmp[0]===prev||tmp[0]==="*"){conv2=converters[tmp[1]+" "+current];if(conv2){conv1=converters[conv1];if(conv1===true){conv=conv2;}else if(conv2===true){conv=conv1;}
break;}}}}
if(!(conv||conv2)){jQuery.error("No conversion from "+conversion.replace(" "," to "));}
if(conv!==true){response=conv?conv(response):conv2(conv1(response));}}}
return response;}
var jsc=jQuery.now(),jsre=/(\=)\?(&|$)|\?\?/i;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return jQuery.expando+"_"+(jsc++);}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var inspectData=s.contentType==="application/x-www-form-urlencoded"&&(typeof s.data==="string");if(s.dataTypes[0]==="jsonp"||s.jsonp!==false&&(jsre.test(s.url)||inspectData&&jsre.test(s.data))){var responseContainer,jsonpCallback=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback,previous=window[jsonpCallback],url=s.url,data=s.data,replace="$1"+jsonpCallback+"$2";if(s.jsonp!==false){url=url.replace(jsre,replace);if(s.url===url){if(inspectData){data=data.replace(jsre,replace);}
if(s.data===data){url+=(/\?/.test(url)?"&":"?")+s.jsonp+"="+jsonpCallback;}}}
s.url=url;s.data=data;window[jsonpCallback]=function(response){responseContainer=[response];};jqXHR.always(function(){window[jsonpCallback]=previous;if(responseContainer&&jQuery.isFunction(previous)){window[jsonpCallback](responseContainer[0]);}});s.converters["script json"]=function(){if(!responseContainer){jQuery.error(jsonpCallback+" was not called");}
return responseContainer[0];};s.dataTypes[0]="json";return"script";}});jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(text){jQuery.globalEval(text);return text;}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false;}
if(s.crossDomain){s.type="GET";s.global=false;}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,head=document.head||document.getElementsByTagName("head")[0]||document.documentElement;return{send:function(_,callback){script=document.createElement("script");script.async="async";if(s.scriptCharset){script.charset=s.scriptCharset;}
script.src=s.url;script.onload=script.onreadystatechange=function(_,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState)){script.onload=script.onreadystatechange=null;if(head&&script.parentNode){head.removeChild(script);}
script=undefined;if(!isAbort){callback(200,"success");}}};head.insertBefore(script,head.firstChild);},abort:function(){if(script){script.onload(0,1);}}};}});var
xhrOnUnloadAbort=window.ActiveXObject?function(){for(var key in xhrCallbacks){xhrCallbacks[key](0,1);}}:false,xhrId=0,xhrCallbacks;function createStandardXHR(){try{return new window.XMLHttpRequest();}catch(e){}}
function createActiveXHR(){try{return new window.ActiveXObject("Microsoft.XMLHTTP");}catch(e){}}
jQuery.ajaxSettings.xhr=window.ActiveXObject?function(){return!this.isLocal&&createStandardXHR()||createActiveXHR();}:createStandardXHR;(function(xhr){jQuery.extend(jQuery.support,{ajax:!!xhr,cors:!!xhr&&("withCredentials"in xhr)});})(jQuery.ajaxSettings.xhr());if(jQuery.support.ajax){jQuery.ajaxTransport(function(s){if(!s.crossDomain||jQuery.support.cors){var callback;return{send:function(headers,complete){var xhr=s.xhr(),handle,i;if(s.username){xhr.open(s.type,s.url,s.async,s.username,s.password);}else{xhr.open(s.type,s.url,s.async);}
if(s.xhrFields){for(i in s.xhrFields){xhr[i]=s.xhrFields[i];}}
if(s.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(s.mimeType);}
if(!s.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest";}
try{for(i in headers){xhr.setRequestHeader(i,headers[i]);}}catch(_){}
xhr.send((s.hasContent&&s.data)||null);callback=function(_,isAbort){var status,statusText,responseHeaders,responses,xml;try{if(callback&&(isAbort||xhr.readyState===4)){callback=undefined;if(handle){xhr.onreadystatechange=jQuery.noop;if(xhrOnUnloadAbort){delete xhrCallbacks[handle];}}
if(isAbort){if(xhr.readyState!==4){xhr.abort();}}else{status=xhr.status;responseHeaders=xhr.getAllResponseHeaders();responses={};xml=xhr.responseXML;if(xml&&xml.documentElement){responses.xml=xml;}
responses.text=xhr.responseText;try{statusText=xhr.statusText;}catch(e){statusText="";}
if(!status&&s.isLocal&&!s.crossDomain){status=responses.text?200:404;}else if(status===1223){status=204;}}}}catch(firefoxAccessException){if(!isAbort){complete(-1,firefoxAccessException);}}
if(responses){complete(status,statusText,responses,responseHeaders);}};if(!s.async||xhr.readyState===4){callback();}else{handle=++xhrId;if(xhrOnUnloadAbort){if(!xhrCallbacks){xhrCallbacks={};jQuery(window).unload(xhrOnUnloadAbort);}
xhrCallbacks[handle]=callback;}
xhr.onreadystatechange=callback;}},abort:function(){if(callback){callback(0,1);}}};}});}
var elemdisplay={},iframe,iframeDoc,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,timerId,fxAttrs=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],fxNow;jQuery.fn.extend({show:function(speed,easing,callback){var elem,display;if(speed||speed===0){return this.animate(genFx("show",3),speed,easing,callback);}else{for(var i=0,j=this.length;i<j;i++){elem=this[i];if(elem.style){display=elem.style.display;if(!jQuery._data(elem,"olddisplay")&&display==="none"){display=elem.style.display="";}
if(display===""&&jQuery.css(elem,"display")==="none"){jQuery._data(elem,"olddisplay",defaultDisplay(elem.nodeName));}}}
for(i=0;i<j;i++){elem=this[i];if(elem.style){display=elem.style.display;if(display===""||display==="none"){elem.style.display=jQuery._data(elem,"olddisplay")||"";}}}
return this;}},hide:function(speed,easing,callback){if(speed||speed===0){return this.animate(genFx("hide",3),speed,easing,callback);}else{var elem,display,i=0,j=this.length;for(;i<j;i++){elem=this[i];if(elem.style){display=jQuery.css(elem,"display");if(display!=="none"&&!jQuery._data(elem,"olddisplay")){jQuery._data(elem,"olddisplay",display);}}}
for(i=0;i<j;i++){if(this[i].style){this[i].style.display="none";}}
return this;}},_toggle:jQuery.fn.toggle,toggle:function(fn,fn2,callback){var bool=typeof fn==="boolean";if(jQuery.isFunction(fn)&&jQuery.isFunction(fn2)){this._toggle.apply(this,arguments);}else if(fn==null||bool){this.each(function(){var state=bool?fn:jQuery(this).is(":hidden");jQuery(this)[state?"show":"hide"]();});}else{this.animate(genFx("toggle",3),fn,fn2,callback);}
return this;},fadeTo:function(speed,to,easing,callback){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:to},speed,easing,callback);},animate:function(prop,speed,easing,callback){var optall=jQuery.speed(speed,easing,callback);if(jQuery.isEmptyObject(prop)){return this.each(optall.complete,[false]);}
prop=jQuery.extend({},prop);function doAnimation(){if(optall.queue===false){jQuery._mark(this);}
var opt=jQuery.extend({},optall),isElement=this.nodeType===1,hidden=isElement&&jQuery(this).is(":hidden"),name,val,p,e,parts,start,end,unit,method;opt.animatedProperties={};for(p in prop){name=jQuery.camelCase(p);if(p!==name){prop[name]=prop[p];delete prop[p];}
val=prop[name];if(jQuery.isArray(val)){opt.animatedProperties[name]=val[1];val=prop[name]=val[0];}else{opt.animatedProperties[name]=opt.specialEasing&&opt.specialEasing[name]||opt.easing||'swing';}
if(val==="hide"&&hidden||val==="show"&&!hidden){return opt.complete.call(this);}
if(isElement&&(name==="height"||name==="width")){opt.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY];if(jQuery.css(this,"display")==="inline"&&jQuery.css(this,"float")==="none"){if(!jQuery.support.inlineBlockNeedsLayout||defaultDisplay(this.nodeName)==="inline"){this.style.display="inline-block";}else{this.style.zoom=1;}}}}
if(opt.overflow!=null){this.style.overflow="hidden";}
for(p in prop){e=new jQuery.fx(this,opt,p);val=prop[p];if(rfxtypes.test(val)){method=jQuery._data(this,"toggle"+p)||(val==="toggle"?hidden?"show":"hide":0);if(method){jQuery._data(this,"toggle"+p,method==="show"?"hide":"show");e[method]();}else{e[val]();}}else{parts=rfxnum.exec(val);start=e.cur();if(parts){end=parseFloat(parts[2]);unit=parts[3]||(jQuery.cssNumber[p]?"":"px");if(unit!=="px"){jQuery.style(this,p,(end||1)+unit);start=((end||1)/e.cur())*start;jQuery.style(this,p,start+unit);}
if(parts[1]){end=((parts[1]==="-="?-1:1)*end)+start;}
e.custom(start,end,unit);}else{e.custom(start,val,"");}}}
return true;}
return optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation);},stop:function(type,clearQueue,gotoEnd){if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined;}
if(clearQueue&&type!==false){this.queue(type||"fx",[]);}
return this.each(function(){var index,hadTimers=false,timers=jQuery.timers,data=jQuery._data(this);if(!gotoEnd){jQuery._unmark(true,this);}
function stopQueue(elem,data,index){var hooks=data[index];jQuery.removeData(elem,index,true);hooks.stop(gotoEnd);}
if(type==null){for(index in data){if(data[index]&&data[index].stop&&index.indexOf(".run")===index.length-4){stopQueue(this,data,index);}}}else if(data[index=type+".run"]&&data[index].stop){stopQueue(this,data,index);}
for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){if(gotoEnd){timers[index](true);}else{timers[index].saveState();}
hadTimers=true;timers.splice(index,1);}}
if(!(gotoEnd&&hadTimers)){jQuery.dequeue(this,type);}});}});function createFxNow(){setTimeout(clearFxNow,0);return(fxNow=jQuery.now());}
function clearFxNow(){fxNow=undefined;}
function genFx(type,num){var obj={};jQuery.each(fxAttrs.concat.apply([],fxAttrs.slice(0,num)),function(){obj[this]=type;});return obj;}
jQuery.each({slideDown:genFx("show",1),slideUp:genFx("hide",1),slideToggle:genFx("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback);};});jQuery.extend({speed:function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue="fx";}
opt.old=opt.complete;opt.complete=function(noUnmark){if(jQuery.isFunction(opt.old)){opt.old.call(this);}
if(opt.queue){jQuery.dequeue(this,opt.queue);}else if(noUnmark!==false){jQuery._unmark(this);}};return opt;},easing:{linear:function(p,n,firstNum,diff){return firstNum+diff*p;},swing:function(p,n,firstNum,diff){return((-Math.cos(p*Math.PI)/2)+0.5)*diff+firstNum;}},timers:[],fx:function(elem,options,prop){this.options=options;this.elem=elem;this.prop=prop;options.orig=options.orig||{};}});jQuery.fx.prototype={update:function(){if(this.options.step){this.options.step.call(this.elem,this.now,this);}
(jQuery.fx.step[this.prop]||jQuery.fx.step._default)(this);},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop];}
var parsed,r=jQuery.css(this.elem,this.prop);return isNaN(parsed=parseFloat(r))?!r||r==="auto"?0:r:parsed;},custom:function(from,to,unit){var self=this,fx=jQuery.fx;this.startTime=fxNow||createFxNow();this.end=to;this.now=this.start=from;this.pos=this.state=0;this.unit=unit||this.unit||(jQuery.cssNumber[this.prop]?"":"px");function t(gotoEnd){return self.step(gotoEnd);}
t.queue=this.options.queue;t.elem=this.elem;t.saveState=function(){if(self.options.hide&&jQuery._data(self.elem,"fxshow"+self.prop)===undefined){jQuery._data(self.elem,"fxshow"+self.prop,self.start);}};if(t()&&jQuery.timers.push(t)&&!timerId){timerId=setInterval(fx.tick,fx.interval);}},show:function(){var dataShow=jQuery._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=dataShow||jQuery.style(this.elem,this.prop);this.options.show=true;if(dataShow!==undefined){this.custom(this.cur(),dataShow);}else{this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur());}
jQuery(this.elem).show();},hide:function(){this.options.orig[this.prop]=jQuery._data(this.elem,"fxshow"+this.prop)||jQuery.style(this.elem,this.prop);this.options.hide=true;this.custom(this.cur(),0);},step:function(gotoEnd){var p,n,complete,t=fxNow||createFxNow(),done=true,elem=this.elem,options=this.options;if(gotoEnd||t>=options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();options.animatedProperties[this.prop]=true;for(p in options.animatedProperties){if(options.animatedProperties[p]!==true){done=false;}}
if(done){if(options.overflow!=null&&!jQuery.support.shrinkWrapBlocks){jQuery.each(["","X","Y"],function(index,value){elem.style["overflow"+value]=options.overflow[index];});}
if(options.hide){jQuery(elem).hide();}
if(options.hide||options.show){for(p in options.animatedProperties){jQuery.style(elem,p,options.orig[p]);jQuery.removeData(elem,"fxshow"+p,true);jQuery.removeData(elem,"toggle"+p,true);}}
complete=options.complete;if(complete){options.complete=false;complete.call(elem);}}
return false;}else{if(options.duration==Infinity){this.now=t;}else{n=t-this.startTime;this.state=n/options.duration;this.pos=jQuery.easing[options.animatedProperties[this.prop]](this.state,n,0,1,options.duration);this.now=this.start+((this.end-this.start)*this.pos);}
this.update();}
return true;}};jQuery.extend(jQuery.fx,{tick:function(){var timer,timers=jQuery.timers,i=0;for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1);}}
if(!timers.length){jQuery.fx.stop();}},interval:13,stop:function(){clearInterval(timerId);timerId=null;},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(fx){jQuery.style(fx.elem,"opacity",fx.now);},_default:function(fx){if(fx.elem.style&&fx.elem.style[fx.prop]!=null){fx.elem.style[fx.prop]=fx.now+fx.unit;}else{fx.elem[fx.prop]=fx.now;}}}});jQuery.each(["width","height"],function(i,prop){jQuery.fx.step[prop]=function(fx){jQuery.style(fx.elem,prop,Math.max(0,fx.now)+fx.unit);};});if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem;}).length;};}
function defaultDisplay(nodeName){if(!elemdisplay[nodeName]){var body=document.body,elem=jQuery("<"+nodeName+">").appendTo(body),display=elem.css("display");elem.remove();if(display==="none"||display===""){if(!iframe){iframe=document.createElement("iframe");iframe.frameBorder=iframe.width=iframe.height=0;}
body.appendChild(iframe);if(!iframeDoc||!iframe.createElement){iframeDoc=(iframe.contentWindow||iframe.contentDocument).document;iframeDoc.write((document.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>");iframeDoc.close();}
elem=iframeDoc.createElement(nodeName);iframeDoc.body.appendChild(elem);display=jQuery.css(elem,"display");body.removeChild(iframe);}
elemdisplay[nodeName]=display;}
return elemdisplay[nodeName];}
var rtable=/^t(?:able|d|h)$/i,rroot=/^(?:body|html)$/i;if("getBoundingClientRect"in document.documentElement){jQuery.fn.offset=function(options){var elem=this[0],box;if(options){return this.each(function(i){jQuery.offset.setOffset(this,options,i);});}
if(!elem||!elem.ownerDocument){return null;}
if(elem===elem.ownerDocument.body){return jQuery.offset.bodyOffset(elem);}
try{box=elem.getBoundingClientRect();}catch(e){}
var doc=elem.ownerDocument,docElem=doc.documentElement;if(!box||!jQuery.contains(docElem,elem)){return box?{top:box.top,left:box.left}:{top:0,left:0};}
var body=doc.body,win=getWindow(doc),clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0,scrollTop=win.pageYOffset||jQuery.support.boxModel&&docElem.scrollTop||body.scrollTop,scrollLeft=win.pageXOffset||jQuery.support.boxModel&&docElem.scrollLeft||body.scrollLeft,top=box.top+scrollTop-clientTop,left=box.left+scrollLeft-clientLeft;return{top:top,left:left};};}else{jQuery.fn.offset=function(options){var elem=this[0];if(options){return this.each(function(i){jQuery.offset.setOffset(this,options,i);});}
if(!elem||!elem.ownerDocument){return null;}
if(elem===elem.ownerDocument.body){return jQuery.offset.bodyOffset(elem);}
var computedStyle,offsetParent=elem.offsetParent,prevOffsetParent=elem,doc=elem.ownerDocument,docElem=doc.documentElement,body=doc.body,defaultView=doc.defaultView,prevComputedStyle=defaultView?defaultView.getComputedStyle(elem,null):elem.currentStyle,top=elem.offsetTop,left=elem.offsetLeft;while((elem=elem.parentNode)&&elem!==body&&elem!==docElem){if(jQuery.support.fixedPosition&&prevComputedStyle.position==="fixed"){break;}
computedStyle=defaultView?defaultView.getComputedStyle(elem,null):elem.currentStyle;top-=elem.scrollTop;left-=elem.scrollLeft;if(elem===offsetParent){top+=elem.offsetTop;left+=elem.offsetLeft;if(jQuery.support.doesNotAddBorder&&!(jQuery.support.doesAddBorderForTableAndCells&&rtable.test(elem.nodeName))){top+=parseFloat(computedStyle.borderTopWidth)||0;left+=parseFloat(computedStyle.borderLeftWidth)||0;}
prevOffsetParent=offsetParent;offsetParent=elem.offsetParent;}
if(jQuery.support.subtractsBorderForOverflowNotVisible&&computedStyle.overflow!=="visible"){top+=parseFloat(computedStyle.borderTopWidth)||0;left+=parseFloat(computedStyle.borderLeftWidth)||0;}
prevComputedStyle=computedStyle;}
if(prevComputedStyle.position==="relative"||prevComputedStyle.position==="static"){top+=body.offsetTop;left+=body.offsetLeft;}
if(jQuery.support.fixedPosition&&prevComputedStyle.position==="fixed"){top+=Math.max(docElem.scrollTop,body.scrollTop);left+=Math.max(docElem.scrollLeft,body.scrollLeft);}
return{top:top,left:left};};}
jQuery.offset={bodyOffset:function(body){var top=body.offsetTop,left=body.offsetLeft;if(jQuery.support.doesNotIncludeMarginInBodyOffset){top+=parseFloat(jQuery.css(body,"marginTop"))||0;left+=parseFloat(jQuery.css(body,"marginLeft"))||0;}
return{top:top,left:left};},setOffset:function(elem,options,i){var position=jQuery.css(elem,"position");if(position==="static"){elem.style.position="relative";}
var curElem=jQuery(elem),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),curCSSLeft=jQuery.css(elem,"left"),calculatePosition=(position==="absolute"||position==="fixed")&&jQuery.inArray("auto",[curCSSTop,curCSSLeft])>-1,props={},curPosition={},curTop,curLeft;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left;}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0;}
if(jQuery.isFunction(options)){options=options.call(elem,i,curOffset);}
if(options.top!=null){props.top=(options.top-curOffset.top)+curTop;}
if(options.left!=null){props.left=(options.left-curOffset.left)+curLeft;}
if("using"in options){options.using.call(elem,props);}else{curElem.css(props);}}};jQuery.fn.extend({position:function(){if(!this[0]){return null;}
var elem=this[0],offsetParent=this.offsetParent(),offset=this.offset(),parentOffset=rroot.test(offsetParent[0].nodeName)?{top:0,left:0}:offsetParent.offset();offset.top-=parseFloat(jQuery.css(elem,"marginTop"))||0;offset.left-=parseFloat(jQuery.css(elem,"marginLeft"))||0;parentOffset.top+=parseFloat(jQuery.css(offsetParent[0],"borderTopWidth"))||0;parentOffset.left+=parseFloat(jQuery.css(offsetParent[0],"borderLeftWidth"))||0;return{top:offset.top-parentOffset.top,left:offset.left-parentOffset.left};},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent||document.body;while(offsetParent&&(!rroot.test(offsetParent.nodeName)&&jQuery.css(offsetParent,"position")==="static")){offsetParent=offsetParent.offsetParent;}
return offsetParent;});}});jQuery.each(["Left","Top"],function(i,name){var method="scroll"+name;jQuery.fn[method]=function(val){var elem,win;if(val===undefined){elem=this[0];if(!elem){return null;}
win=getWindow(elem);return win?("pageXOffset"in win)?win[i?"pageYOffset":"pageXOffset"]:jQuery.support.boxModel&&win.document.documentElement[method]||win.document.body[method]:elem[method];}
return this.each(function(){win=getWindow(this);if(win){win.scrollTo(!i?val:jQuery(win).scrollLeft(),i?val:jQuery(win).scrollTop());}else{this[method]=val;}});};});function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9?elem.defaultView||elem.parentWindow:false;}
jQuery.each(["Height","Width"],function(i,name){var type=name.toLowerCase();jQuery.fn["inner"+name]=function(){var elem=this[0];return elem?elem.style?parseFloat(jQuery.css(elem,type,"padding")):this[type]():null;};jQuery.fn["outer"+name]=function(margin){var elem=this[0];return elem?elem.style?parseFloat(jQuery.css(elem,type,margin?"margin":"border")):this[type]():null;};jQuery.fn[type]=function(size){var elem=this[0];if(!elem){return size==null?null:this;}
if(jQuery.isFunction(size)){return this.each(function(i){var self=jQuery(this);self[type](size.call(this,i,self[type]()));});}
if(jQuery.isWindow(elem)){var docElemProp=elem.document.documentElement["client"+name],body=elem.document.body;return elem.document.compatMode==="CSS1Compat"&&docElemProp||body&&body["client"+name]||docElemProp;}else if(elem.nodeType===9){return Math.max(elem.documentElement["client"+name],elem.body["scroll"+name],elem.documentElement["scroll"+name],elem.body["offset"+name],elem.documentElement["offset"+name]);}else if(size===undefined){var orig=jQuery.css(elem,type),ret=parseFloat(orig);return jQuery.isNumeric(ret)?ret:orig;}else{return this.css(type,typeof size==="string"?size:size+"px");}};});window.jQuery=window.$=jQuery;if(typeof define==="function"&&define.amd&&define.amd.jQuery){define("jquery",[],function(){return jQuery;});}})(window);(function(){var root=this;var previousUnderscore=root._;var breaker={};var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var slice=ArrayProto.slice,unshift=ArrayProto.unshift,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var
nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){return new wrapper(obj);};if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports){exports=module.exports=_;}
exports._=_;}else{root['_']=_;}
_.VERSION='1.3.3';var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null)return;if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context);}else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++){if(i in obj&&iterator.call(context,obj[i],i,obj)===breaker)return;}}else{for(var key in obj){if(_.has(obj,key)){if(iterator.call(context,obj[key],key,obj)===breaker)return;}}}};_.map=_.collect=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeMap&&obj.map===nativeMap)return obj.map(iterator,context);each(obj,function(value,index,list){results[results.length]=iterator.call(context,value,index,list);});if(obj.length===+obj.length)results.length=obj.length;return results;};_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduce&&obj.reduce===nativeReduce){if(context)iterator=_.bind(iterator,context);return initial?obj.reduce(iterator,memo):obj.reduce(iterator);}
each(obj,function(value,index,list){if(!initial){memo=value;initial=true;}else{memo=iterator.call(context,memo,value,index,list);}});if(!initial)throw new TypeError('Reduce of empty array with no initial value');return memo;};_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduceRight&&obj.reduceRight===nativeReduceRight){if(context)iterator=_.bind(iterator,context);return initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);}
var reversed=_.toArray(obj).reverse();if(context&&!initial)iterator=_.bind(iterator,context);return initial?_.reduce(reversed,iterator,memo,context):_.reduce(reversed,iterator);};_.find=_.detect=function(obj,iterator,context){var result;any(obj,function(value,index,list){if(iterator.call(context,value,index,list)){result=value;return true;}});return result;};_.filter=_.select=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeFilter&&obj.filter===nativeFilter)return obj.filter(iterator,context);each(obj,function(value,index,list){if(iterator.call(context,value,index,list))results[results.length]=value;});return results;};_.reject=function(obj,iterator,context){var results=[];if(obj==null)return results;each(obj,function(value,index,list){if(!iterator.call(context,value,index,list))results[results.length]=value;});return results;};_.every=_.all=function(obj,iterator,context){var result=true;if(obj==null)return result;if(nativeEvery&&obj.every===nativeEvery)return obj.every(iterator,context);each(obj,function(value,index,list){if(!(result=result&&iterator.call(context,value,index,list)))return breaker;});return!!result;};var any=_.some=_.any=function(obj,iterator,context){iterator||(iterator=_.identity);var result=false;if(obj==null)return result;if(nativeSome&&obj.some===nativeSome)return obj.some(iterator,context);each(obj,function(value,index,list){if(result||(result=iterator.call(context,value,index,list)))return breaker;});return!!result;};_.include=_.contains=function(obj,target){var found=false;if(obj==null)return found;if(nativeIndexOf&&obj.indexOf===nativeIndexOf)return obj.indexOf(target)!=-1;found=any(obj,function(value){return value===target;});return found;};_.invoke=function(obj,method){var args=slice.call(arguments,2);return _.map(obj,function(value){return(_.isFunction(method)?method||value:value[method]).apply(value,args);});};_.pluck=function(obj,key){return _.map(obj,function(value){return value[key];});};_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0])return Math.max.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return-Infinity;var result={computed:-Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>=result.computed&&(result={value:value,computed:computed});});return result.value;};_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0])return Math.min.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return Infinity;var result={computed:Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed<result.computed&&(result={value:value,computed:computed});});return result.value;};_.shuffle=function(obj){var shuffled=[],rand;each(obj,function(value,index,list){rand=Math.floor(Math.random()*(index+1));shuffled[index]=shuffled[rand];shuffled[rand]=value;});return shuffled;};_.sortBy=function(obj,val,context){var iterator=_.isFunction(val)?val:function(obj){return obj[val];};return _.pluck(_.map(obj,function(value,index,list){return{value:value,criteria:iterator.call(context,value,index,list)};}).sort(function(left,right){var a=left.criteria,b=right.criteria;if(a===void 0)return 1;if(b===void 0)return-1;return a<b?-1:a>b?1:0;}),'value');};_.groupBy=function(obj,val){var result={};var iterator=_.isFunction(val)?val:function(obj){return obj[val];};each(obj,function(value,index){var key=iterator(value,index);(result[key]||(result[key]=[])).push(value);});return result;};_.sortedIndex=function(array,obj,iterator){iterator||(iterator=_.identity);var low=0,high=array.length;while(low<high){var mid=(low+high)>>1;iterator(array[mid])<iterator(obj)?low=mid+1:high=mid;}
return low;};_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(_.isArguments(obj))return slice.call(obj);if(obj.toArray&&_.isFunction(obj.toArray))return obj.toArray();return _.values(obj);};_.size=function(obj){return _.isArray(obj)?obj.length:_.keys(obj).length;};_.first=_.head=_.take=function(array,n,guard){return(n!=null)&&!guard?slice.call(array,0,n):array[0];};_.initial=function(array,n,guard){return slice.call(array,0,array.length-((n==null)||guard?1:n));};_.last=function(array,n,guard){if((n!=null)&&!guard){return slice.call(array,Math.max(array.length-n,0));}else{return array[array.length-1];}};_.rest=_.tail=function(array,index,guard){return slice.call(array,(index==null)||guard?1:index);};_.compact=function(array){return _.filter(array,function(value){return!!value;});};_.flatten=function(array,shallow){return _.reduce(array,function(memo,value){if(_.isArray(value))return memo.concat(shallow?value:_.flatten(value));memo[memo.length]=value;return memo;},[]);};_.without=function(array){return _.difference(array,slice.call(arguments,1));};_.uniq=_.unique=function(array,isSorted,iterator){var initial=iterator?_.map(array,iterator):array;var results=[];if(array.length<3)isSorted=true;_.reduce(initial,function(memo,value,index){if(isSorted?_.last(memo)!==value||!memo.length:!_.include(memo,value)){memo.push(value);results.push(array[index]);}
return memo;},[]);return results;};_.union=function(){return _.uniq(_.flatten(arguments,true));};_.intersection=_.intersect=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.indexOf(other,item)>=0;});});};_.difference=function(array){var rest=_.flatten(slice.call(arguments,1),true);return _.filter(array,function(value){return!_.include(rest,value);});};_.zip=function(){var args=slice.call(arguments);var length=_.max(_.pluck(args,'length'));var results=new Array(length);for(var i=0;i<length;i++)results[i]=_.pluck(args,""+i);return results;};_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i,l;if(isSorted){i=_.sortedIndex(array,item);return array[i]===item?i:-1;}
if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item);for(i=0,l=array.length;i<l;i++)if(i in array&&array[i]===item)return i;return-1;};_.lastIndexOf=function(array,item){if(array==null)return-1;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf)return array.lastIndexOf(item);var i=array.length;while(i--)if(i in array&&array[i]===item)return i;return-1;};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0;}
step=arguments[2]||1;var len=Math.max(Math.ceil((stop-start)/step),0);var idx=0;var range=new Array(len);while(idx<len){range[idx++]=start;start+=step;}
return range;};var ctor=function(){};_.bind=function bind(func,context){var bound,args;if(func.bind===nativeBind&&nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError;args=slice.call(arguments,2);return bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));ctor.prototype=func.prototype;var self=new ctor;var result=func.apply(self,args.concat(slice.call(arguments)));if(Object(result)===result)return result;return self;};};_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(funcs.length==0)funcs=_.functions(obj);each(funcs,function(f){obj[f]=_.bind(obj[f],obj);});return obj;};_.memoize=function(func,hasher){var memo={};hasher||(hasher=_.identity);return function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:(memo[key]=func.apply(this,arguments));};};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args);},wait);};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)));};_.throttle=function(func,wait){var context,args,timeout,throttling,more,result;var whenDone=_.debounce(function(){more=throttling=false;},wait);return function(){context=this;args=arguments;var later=function(){timeout=null;if(more)func.apply(context,args);whenDone();};if(!timeout)timeout=setTimeout(later,wait);if(throttling){more=true;}else{result=func.apply(context,args);}
whenDone();throttling=true;return result;};};_.debounce=function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)func.apply(context,args);};if(immediate&&!timeout)func.apply(context,args);clearTimeout(timeout);timeout=setTimeout(later,wait);};};_.once=function(func){var ran=false,memo;return function(){if(ran)return memo;ran=true;return memo=func.apply(this,arguments);};};_.wrap=function(func,wrapper){return function(){var args=[func].concat(slice.call(arguments,0));return wrapper.apply(this,args);};};_.compose=function(){var funcs=arguments;return function(){var args=arguments;for(var i=funcs.length-1;i>=0;i--){args=[funcs[i].apply(this,args)];}
return args[0];};};_.after=function(times,func){if(times<=0)return func();return function(){if(--times<1){return func.apply(this,arguments);}};};_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError('Invalid object');var keys=[];for(var key in obj)if(_.has(obj,key))keys[keys.length]=key;return keys;};_.values=function(obj){return _.map(obj,_.identity);};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key);}
return names.sort();};_.extend=function(obj){each(slice.call(arguments,1),function(source){for(var prop in source){obj[prop]=source[prop];}});return obj;};_.pick=function(obj){var result={};each(_.flatten(slice.call(arguments,1)),function(key){if(key in obj)result[key]=obj[key];});return result;};_.defaults=function(obj){each(slice.call(arguments,1),function(source){for(var prop in source){if(obj[prop]==null)obj[prop]=source[prop];}});return obj;};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj);};_.tap=function(obj,interceptor){interceptor(obj);return obj;};function eq(a,b,stack){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;if(a._chain)a=a._wrapped;if(b._chain)b=b._wrapped;if(a.isEqual&&_.isFunction(a.isEqual))return a.isEqual(b);if(b.isEqual&&_.isFunction(b.isEqual))return b.isEqual(a);var className=toString.call(a);if(className!=toString.call(b))return false;switch(className){case'[object String]':return a==String(b);case'[object Number]':return a!=+a?b!=+b:(a==0?1/a==1/b:a==+b);case'[object Date]':case'[object Boolean]':return+a==+b;case'[object RegExp]':return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase;}
if(typeof a!='object'||typeof b!='object')return false;var length=stack.length;while(length--){if(stack[length]==a)return true;}
stack.push(a);var size=0,result=true;if(className=='[object Array]'){size=a.length;result=size==b.length;if(result){while(size--){if(!(result=size in a==size in b&&eq(a[size],b[size],stack)))break;}}}else{if('constructor'in a!='constructor'in b||a.constructor!=b.constructor)return false;for(var key in a){if(_.has(a,key)){size++;if(!(result=_.has(b,key)&&eq(a[key],b[key],stack)))break;}}
if(result){for(key in b){if(_.has(b,key)&&!(size--))break;}
result=!size;}}
stack.pop();return result;}
_.isEqual=function(a,b){return eq(a,b,[]);};_.isEmpty=function(obj){if(obj==null)return true;if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(_.has(obj,key))return false;return true;};_.isElement=function(obj){return!!(obj&&obj.nodeType==1);};_.isArray=nativeIsArray||function(obj){return toString.call(obj)=='[object Array]';};_.isObject=function(obj){return obj===Object(obj);};_.isArguments=function(obj){return toString.call(obj)=='[object Arguments]';};if(!_.isArguments(arguments)){_.isArguments=function(obj){return!!(obj&&_.has(obj,'callee'));};}
_.isFunction=function(obj){return toString.call(obj)=='[object Function]';};_.isString=function(obj){return toString.call(obj)=='[object String]';};_.isNumber=function(obj){return toString.call(obj)=='[object Number]';};_.isFinite=function(obj){return _.isNumber(obj)&&isFinite(obj);};_.isNaN=function(obj){return obj!==obj;};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)=='[object Boolean]';};_.isDate=function(obj){return toString.call(obj)=='[object Date]';};_.isRegExp=function(obj){return toString.call(obj)=='[object RegExp]';};_.isNull=function(obj){return obj===null;};_.isUndefined=function(obj){return obj===void 0;};_.has=function(obj,key){return hasOwnProperty.call(obj,key);};_.noConflict=function(){root._=previousUnderscore;return this;};_.identity=function(value){return value;};_.times=function(n,iterator,context){for(var i=0;i<n;i++)iterator.call(context,i);};_.escape=function(string){return(''+string).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#x27;').replace(/\//g,'&#x2F;');};_.result=function(object,property){if(object==null)return null;var value=object[property];return _.isFunction(value)?value.call(object):value;};_.mixin=function(obj){each(_.functions(obj),function(name){addToWrapper(name,_[name]=obj[name]);});};var idCounter=0;_.uniqueId=function(prefix){var id=idCounter++;return prefix?prefix+id:id;};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/.^/;var escapes={'\\':'\\',"'":"'",'r':'\r','n':'\n','t':'\t','u2028':'\u2028','u2029':'\u2029'};for(var p in escapes)escapes[escapes[p]]=p;var escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;var unescaper=/\\(\\|'|r|n|t|u2028|u2029)/g;var unescape=function(code){return code.replace(unescaper,function(match,escape){return escapes[escape];});};_.template=function(text,data,settings){settings=_.defaults(settings||{},_.templateSettings);var source="__p+='"+text.replace(escaper,function(match){return'\\'+escapes[match];}).replace(settings.escape||noMatch,function(match,code){return"'+\n_.escape("+unescape(code)+")+\n'";}).replace(settings.interpolate||noMatch,function(match,code){return"'+\n("+unescape(code)+")+\n'";}).replace(settings.evaluate||noMatch,function(match,code){return"';\n"+unescape(code)+"\n;__p+='";})+"';\n";if(!settings.variable)source='with(obj||{}){\n'+source+'}\n';source="var __p='';"+"var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+
source+"return __p;\n";var render=new Function(settings.variable||'obj','_',source);if(data)return render(data,_);var template=function(data){return render.call(this,data,_);};template.source='function('+(settings.variable||'obj')+'){\n'+
source+'}';return template;};_.chain=function(obj){return _(obj).chain();};var wrapper=function(obj){this._wrapped=obj;};_.prototype=wrapper.prototype;var result=function(obj,chain){return chain?_(obj).chain():obj;};var addToWrapper=function(name,func){wrapper.prototype[name]=function(){var args=slice.call(arguments);unshift.call(args,this._wrapped);return result(func.apply(_,args),this._chain);};};_.mixin(_);each(['pop','push','reverse','shift','sort','splice','unshift'],function(name){var method=ArrayProto[name];wrapper.prototype[name]=function(){var wrapped=this._wrapped;method.apply(wrapped,arguments);var length=wrapped.length;if((name=='shift'||name=='splice')&&length===0)delete wrapped[0];return result(wrapped,this._chain);};});each(['concat','join','slice'],function(name){var method=ArrayProto[name];wrapper.prototype[name]=function(){return result(method.apply(this._wrapped,arguments),this._chain);};});wrapper.prototype.chain=function(){this._chain=true;return this;};wrapper.prototype.value=function(){return this._wrapped;};}).call(this);(function(){var root=this;var previousBackbone=root.Backbone;var slice=Array.prototype.slice;var splice=Array.prototype.splice;var Backbone;if(typeof exports!=='undefined'){Backbone=exports;}else{Backbone=root.Backbone={};}
Backbone.VERSION='0.9.2';var _=root._;if(!_&&(typeof require!=='undefined'))_=require('underscore');var $=root.jQuery||root.Zepto||root.ender;Backbone.setDomLibrary=function(lib){$=lib;};Backbone.noConflict=function(){root.Backbone=previousBackbone;return this;};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var eventSplitter=/\s+/;var Events=Backbone.Events={on:function(events,callback,context){var calls,event,node,tail,list;if(!callback)return this;events=events.split(eventSplitter);calls=this._callbacks||(this._callbacks={});while(event=events.shift()){list=calls[event];node=list?list.tail:{};node.next=tail={};node.context=context;node.callback=callback;calls[event]={tail:tail,next:list?list.next:node};}
return this;},off:function(events,callback,context){var event,calls,node,tail,cb,ctx;if(!(calls=this._callbacks))return;if(!(events||callback||context)){delete this._callbacks;return this;}
events=events?events.split(eventSplitter):_.keys(calls);while(event=events.shift()){node=calls[event];delete calls[event];if(!node||!(callback||context))continue;tail=node.tail;while((node=node.next)!==tail){cb=node.callback;ctx=node.context;if((callback&&cb!==callback)||(context&&ctx!==context)){this.on(event,cb,ctx);}}}
return this;},trigger:function(events){var event,node,calls,tail,args,all,rest;if(!(calls=this._callbacks))return this;all=calls.all;events=events.split(eventSplitter);rest=slice.call(arguments,1);while(event=events.shift()){if(node=calls[event]){tail=node.tail;while((node=node.next)!==tail){node.callback.apply(node.context||this,rest);}}
if(node=all){tail=node.tail;args=[event].concat(rest);while((node=node.next)!==tail){node.callback.apply(node.context||this,args);}}}
return this;}};Events.bind=Events.on;Events.unbind=Events.off;var Model=Backbone.Model=function(attributes,options){var defaults;attributes||(attributes={});if(options&&options.parse)attributes=this.parse(attributes);if(defaults=getValue(this,'defaults')){attributes=_.extend({},defaults,attributes);}
if(options&&options.collection)this.collection=options.collection;this.attributes={};this._escapedAttributes={};this.cid=_.uniqueId('c');this.changed={};this._silent={};this._pending={};this.set(attributes,{silent:true});this.changed={};this._silent={};this._pending={};this._previousAttributes=_.clone(this.attributes);this.initialize.apply(this,arguments);};_.extend(Model.prototype,Events,{changed:null,_silent:null,_pending:null,idAttribute:'id',initialize:function(){},toJSON:function(options){return _.clone(this.attributes);},get:function(attr){return this.attributes[attr];},escape:function(attr){var html;if(html=this._escapedAttributes[attr])return html;var val=this.get(attr);return this._escapedAttributes[attr]=_.escape(val==null?'':''+val);},has:function(attr){return this.get(attr)!=null;},set:function(key,value,options){var attrs,attr,val;if(_.isObject(key)||key==null){attrs=key;options=value;}else{attrs={};attrs[key]=value;}
options||(options={});if(!attrs)return this;if(attrs instanceof Model)attrs=attrs.attributes;if(options.unset)for(attr in attrs)attrs[attr]=void 0;if(!this._validate(attrs,options))return false;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];var changes=options.changes={};var now=this.attributes;var escaped=this._escapedAttributes;var prev=this._previousAttributes||{};for(attr in attrs){val=attrs[attr];if(!_.isEqual(now[attr],val)||(options.unset&&_.has(now,attr))){delete escaped[attr];(options.silent?this._silent:changes)[attr]=true;}
options.unset?delete now[attr]:now[attr]=val;if(!_.isEqual(prev[attr],val)||(_.has(now,attr)!=_.has(prev,attr))){this.changed[attr]=val;if(!options.silent)this._pending[attr]=true;}else{delete this.changed[attr];delete this._pending[attr];}}
if(!options.silent)this.change(options);return this;},unset:function(attr,options){(options||(options={})).unset=true;return this.set(attr,null,options);},clear:function(options){(options||(options={})).unset=true;return this.set(_.clone(this.attributes),options);},fetch:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;options.success=function(resp,status,xhr){if(!model.set(model.parse(resp,xhr),options))return false;if(success)success(model,resp);};options.error=Backbone.wrapError(options.error,model,options);return(this.sync||Backbone.sync).call(this,'read',this,options);},save:function(key,value,options){var attrs,current;if(_.isObject(key)||key==null){attrs=key;options=value;}else{attrs={};attrs[key]=value;}
options=options?_.clone(options):{};if(options.wait){if(!this._validate(attrs,options))return false;current=_.clone(this.attributes);}
var silentOptions=_.extend({},options,{silent:true});if(attrs&&!this.set(attrs,options.wait?silentOptions:options)){return false;}
var model=this;var success=options.success;options.success=function(resp,status,xhr){var serverAttrs=model.parse(resp,xhr);if(options.wait){delete options.wait;serverAttrs=_.extend(attrs||{},serverAttrs);}
if(!model.set(serverAttrs,options))return false;if(success){success(model,resp);}else{model.trigger('sync',model,resp,options);}};options.error=Backbone.wrapError(options.error,model,options);var method=this.isNew()?'create':'update';var xhr=(this.sync||Backbone.sync).call(this,method,this,options);if(options.wait)this.set(current,silentOptions);return xhr;},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var triggerDestroy=function(){model.trigger('destroy',model,model.collection,options);};if(this.isNew()){triggerDestroy();return false;}
options.success=function(resp){if(options.wait)triggerDestroy();if(success){success(model,resp);}else{model.trigger('sync',model,resp,options);}};options.error=Backbone.wrapError(options.error,model,options);var xhr=(this.sync||Backbone.sync).call(this,'delete',this,options);if(!options.wait)triggerDestroy();return xhr;},url:function(){var base=getValue(this,'urlRoot')||getValue(this.collection,'url')||urlError();if(this.isNew())return base;return base+(base.charAt(base.length-1)=='/'?'':'/')+encodeURIComponent(this.id);},parse:function(resp,xhr){return resp;},clone:function(){return new this.constructor(this.attributes);},isNew:function(){return this.id==null;},change:function(options){options||(options={});var changing=this._changing;this._changing=true;for(var attr in this._silent)this._pending[attr]=true;var changes=_.extend({},options.changes,this._silent);this._silent={};for(var attr in changes){this.trigger('change:'+attr,this,this.get(attr),options);}
if(changing)return this;while(!_.isEmpty(this._pending)){this._pending={};this.trigger('change',this,options);for(var attr in this.changed){if(this._pending[attr]||this._silent[attr])continue;delete this.changed[attr];}
this._previousAttributes=_.clone(this.attributes);}
this._changing=false;return this;},hasChanged:function(attr){if(!arguments.length)return!_.isEmpty(this.changed);return _.has(this.changed,attr);},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false,old=this._previousAttributes;for(var attr in diff){if(_.isEqual(old[attr],(val=diff[attr])))continue;(changed||(changed={}))[attr]=val;}
return changed;},previous:function(attr){if(!arguments.length||!this._previousAttributes)return null;return this._previousAttributes[attr];},previousAttributes:function(){return _.clone(this._previousAttributes);},isValid:function(){return!this.validate(this.attributes);},_validate:function(attrs,options){if(options.silent||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validate(attrs,options);if(!error)return true;if(options&&options.error){options.error(this,error,options);}else{this.trigger('error',this,error,options);}
return false;}});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.model)this.model=options.model;if(options.comparator)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,{silent:true,parse:options.parse});};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options);});},add:function(models,options){var i,index,length,model,cid,id,cids={},ids={},dups=[];options||(options={});models=_.isArray(models)?models.slice():[models];for(i=0,length=models.length;i<length;i++){if(!(model=models[i]=this._prepareModel(models[i],options))){throw new Error("Can't add an invalid model to a collection");}
cid=model.cid;id=model.id;if(cids[cid]||this._byCid[cid]||((id!=null)&&(ids[id]||this._byId[id]))){dups.push(i);continue;}
cids[cid]=ids[id]=model;}
i=dups.length;while(i--){models.splice(dups[i],1);}
for(i=0,length=models.length;i<length;i++){(model=models[i]).on('all',this._onModelEvent,this);this._byCid[model.cid]=model;if(model.id!=null)this._byId[model.id]=model;}
this.length+=length;index=options.at!=null?options.at:this.models.length;splice.apply(this.models,[index,0].concat(models));if(this.comparator)this.sort({silent:true});if(options.silent)return this;for(i=0,length=this.models.length;i<length;i++){if(!cids[(model=this.models[i]).cid])continue;options.index=i;model.trigger('add',model,this,options);}
return this;},remove:function(models,options){var i,l,index,model;options||(options={});models=_.isArray(models)?models.slice():[models];for(i=0,l=models.length;i<l;i++){model=this.getByCid(models[i])||this.get(models[i]);if(!model)continue;delete this._byId[model.id];delete this._byCid[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger('remove',model,this,options);}
this._removeReference(model);}
return this;},push:function(model,options){model=this._prepareModel(model,options);this.add(model,options);return model;},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model;},unshift:function(model,options){model=this._prepareModel(model,options);this.add(model,_.extend({at:0},options));return model;},shift:function(options){var model=this.at(0);this.remove(model,options);return model;},get:function(id){if(id==null)return void 0;return this._byId[id.id!=null?id.id:id];},getByCid:function(cid){return cid&&this._byCid[cid.cid||cid];},at:function(index){return this.models[index];},where:function(attrs){if(_.isEmpty(attrs))return[];return this.filter(function(model){for(var key in attrs){if(attrs[key]!==model.get(key))return false;}
return true;});},sort:function(options){options||(options={});if(!this.comparator)throw new Error('Cannot sort a set without a comparator');var boundComparator=_.bind(this.comparator,this);if(this.comparator.length==1){this.models=this.sortBy(boundComparator);}else{this.models.sort(boundComparator);}
if(!options.silent)this.trigger('reset',this,options);return this;},pluck:function(attr){return _.map(this.models,function(model){return model.get(attr);});},reset:function(models,options){models||(models=[]);options||(options={});for(var i=0,l=this.models.length;i<l;i++){this._removeReference(this.models[i]);}
this._reset();this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger('reset',this,options);return this;},fetch:function(options){options=options?_.clone(options):{};if(options.parse===undefined)options.parse=true;var collection=this;var success=options.success;options.success=function(resp,status,xhr){collection[options.add?'add':'reset'](collection.parse(resp,xhr),options);if(success)success(collection,resp);};options.error=Backbone.wrapError(options.error,collection,options);return(this.sync||Backbone.sync).call(this,'read',this,options);},create:function(model,options){var coll=this;options=options?_.clone(options):{};model=this._prepareModel(model,options);if(!model)return false;if(!options.wait)coll.add(model,options);var success=options.success;options.success=function(nextModel,resp,xhr){if(options.wait)coll.add(nextModel,options);if(success){success(nextModel,resp);}else{nextModel.trigger('sync',model,resp,options);}};model.save(null,options);return model;},parse:function(resp,xhr){return resp;},chain:function(){return _(this.models).chain();},_reset:function(options){this.length=0;this.models=[];this._byId={};this._byCid={};},_prepareModel:function(model,options){options||(options={});if(!(model instanceof Model)){var attrs=model;options.collection=this;model=new this.model(attrs,options);if(!model._validate(model.attributes,options))model=false;}else if(!model.collection){model.collection=this;}
return model;},_removeReference:function(model){if(this==model.collection){delete model.collection;}
model.off('all',this._onModelEvent,this);},_onModelEvent:function(event,model,collection,options){if((event=='add'||event=='remove')&&collection!=this)return;if(event=='destroy'){this.remove(model,options);}
if(model&&event==='change:'+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];this._byId[model.id]=model;}
this.trigger.apply(this,arguments);}});var methods=['forEach','each','map','reduce','reduceRight','find','detect','filter','select','reject','every','all','some','any','include','contains','invoke','max','min','sortBy','sortedIndex','toArray','size','first','initial','rest','last','without','indexOf','shuffle','lastIndexOf','isEmpty','groupBy'];_.each(methods,function(method){Collection.prototype[method]=function(){return _[method].apply(_,[this.models].concat(_.toArray(arguments)));};});var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments);};var namedParam=/:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[-[\]{}()+?.,\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){Backbone.history||(Backbone.history=new History);if(!_.isRegExp(route))route=this._routeToRegExp(route);if(!callback)callback=this[name];Backbone.history.route(route,_.bind(function(fragment){var args=this._extractParameters(route,fragment);callback&&callback.apply(this,args);this.trigger.apply(this,['route:'+name].concat(args));Backbone.history.trigger('route',this,name,args);},this));return this;},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);},_bindRoutes:function(){if(!this.routes)return;var routes=[];for(var route in this.routes){routes.unshift([route,this.routes[route]]);}
for(var i=0,l=routes.length;i<l;i++){this.route(routes[i][0],routes[i][1],this[routes[i][1]]);}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,'\\$&').replace(namedParam,'([^\/]+)').replace(splatParam,'(.*?)');return new RegExp('^'+route+'$');},_extractParameters:function(route,fragment){return route.exec(fragment).slice(1);}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,'checkUrl');};var routeStripper=/^[#\/]/;var isExplorer=/msie [\w.]+/;History.started=false;_.extend(History.prototype,Events,{interval:50,getHash:function(windowOverride){var loc=windowOverride?windowOverride.location:window.location;var match=loc.href.match(/#(.*)$/);return match?match[1]:'';},getFragment:function(fragment,forcePushState){if(fragment==null){if(this._hasPushState||forcePushState){fragment=window.location.pathname;var search=window.location.search;if(search)fragment+=search;}else{fragment=this.getHash();}}
if(!fragment.indexOf(this.options.root))fragment=fragment.substr(this.options.root.length);return fragment.replace(routeStripper,'');},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({},{root:'/'},this.options,options);this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var fragment=this.getFragment();var docMode=document.documentMode;var oldIE=(isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7));if(oldIE){this.iframe=$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo('body')[0].contentWindow;this.navigate(fragment);}
if(this._hasPushState){$(window).bind('popstate',this.checkUrl);}else if(this._wantsHashChange&&('onhashchange'in window)&&!oldIE){$(window).bind('hashchange',this.checkUrl);}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval);}
this.fragment=fragment;var loc=window.location;var atRoot=loc.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!atRoot){this.fragment=this.getFragment(null,true);window.location.replace(this.options.root+'#'+this.fragment);return true;}else if(this._wantsPushState&&this._hasPushState&&atRoot&&loc.hash){this.fragment=this.getHash().replace(routeStripper,'');window.history.replaceState({},document.title,loc.protocol+'//'+loc.host+this.options.root+this.fragment);}
if(!this.options.silent){return this.loadUrl();}},stop:function(){$(window).unbind('popstate',this.checkUrl).unbind('hashchange',this.checkUrl);clearInterval(this._checkUrlInterval);History.started=false;},route:function(route,callback){this.handlers.unshift({route:route,callback:callback});},checkUrl:function(e){var current=this.getFragment();if(current==this.fragment&&this.iframe)current=this.getFragment(this.getHash(this.iframe));if(current==this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl()||this.loadUrl(this.getHash());},loadUrl:function(fragmentOverride){var fragment=this.fragment=this.getFragment(fragmentOverride);var matched=_.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true;}});return matched;},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:options};var frag=(fragment||'').replace(routeStripper,'');if(this.fragment==frag)return;if(this._hasPushState){if(frag.indexOf(this.options.root)!=0)frag=this.options.root+frag;this.fragment=frag;window.history[options.replace?'replaceState':'pushState']({},document.title,frag);}else if(this._wantsHashChange){this.fragment=frag;this._updateHash(window.location,frag,options.replace);if(this.iframe&&(frag!=this.getFragment(this.getHash(this.iframe)))){if(!options.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,frag,options.replace);}}else{window.location.assign(this.options.root+fragment);}
if(options.trigger)this.loadUrl(fragment);},_updateHash:function(location,fragment,replace){if(replace){location.replace(location.toString().replace(/(javascript:|#).*$/,'')+'#'+fragment);}else{location.hash=fragment;}}});var View=Backbone.View=function(options){this.cid=_.uniqueId('view');this._configure(options||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents();};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=['model','collection','el','id','attributes','className','tagName'];_.extend(View.prototype,Events,{tagName:'div',$:function(selector){return this.$el.find(selector);},initialize:function(){},render:function(){return this;},remove:function(){this.$el.remove();return this;},make:function(tagName,attributes,content){var el=document.createElement(tagName);if(attributes)$(el).attr(attributes);if(content)$(el).html(content);return el;},setElement:function(element,delegate){if(this.$el)this.undelegateEvents();this.$el=(element instanceof $)?element:$(element);this.el=this.$el[0];if(delegate!==false)this.delegateEvents();return this;},delegateEvents:function(events){if(!(events||(events=getValue(this,'events'))))return;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)throw new Error('Method "'+events[key]+'" does not exist');var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+='.delegateEvents'+this.cid;if(selector===''){this.$el.bind(eventName,method);}else{this.$el.delegate(selector,eventName,method);}}},undelegateEvents:function(){this.$el.unbind('.delegateEvents'+this.cid);},_configure:function(options){if(this.options)options=_.extend({},this.options,options);for(var i=0,l=viewOptions.length;i<l;i++){var attr=viewOptions[i];if(options[attr])this[attr]=options[attr];}
this.options=options;},_ensureElement:function(){if(!this.el){var attrs=getValue(this,'attributes')||{};if(this.id)attrs.id=this.id;if(this.className)attrs['class']=this.className;this.setElement(this.make(this.tagName,attrs),false);}else{this.setElement(this.el,false);}}});var extend=function(protoProps,classProps){var child=inherits(this,protoProps,classProps);child.extend=this.extend;return child;};Model.extend=Collection.extend=Router.extend=View.extend=extend;var methodMap={'create':'POST','update':'PUT','delete':'DELETE','read':'GET'};Backbone.sync=function(method,model,options){var type=methodMap[method];options||(options={});var params={type:type,dataType:'json'};if(!options.url){params.url=getValue(model,'url')||urlError();}
if(!options.data&&model&&(method=='create'||method=='update')){params.contentType='application/json';params.data=JSON.stringify(model.toJSON());}
if(Backbone.emulateJSON){params.contentType='application/x-www-form-urlencoded';params.data=params.data?{model:params.data}:{};}
if(Backbone.emulateHTTP){if(type==='PUT'||type==='DELETE'){if(Backbone.emulateJSON)params.data._method=type;params.type='POST';params.beforeSend=function(xhr){xhr.setRequestHeader('X-HTTP-Method-Override',type);};}}
if(params.type!=='GET'&&!Backbone.emulateJSON){params.processData=false;}
return $.ajax(_.extend(params,options));};Backbone.wrapError=function(onError,originalModel,options){return function(model,resp){resp=model===originalModel?resp:model;if(onError){onError(originalModel,resp,options);}else{originalModel.trigger('error',originalModel,resp,options);}};};var ctor=function(){};var inherits=function(parent,protoProps,staticProps){var child;if(protoProps&&protoProps.hasOwnProperty('constructor')){child=protoProps.constructor;}else{child=function(){parent.apply(this,arguments);};}
_.extend(child,parent);ctor.prototype=parent.prototype;child.prototype=new ctor();if(protoProps)_.extend(child.prototype,protoProps);if(staticProps)_.extend(child,staticProps);child.prototype.constructor=child;child.__super__=parent.prototype;return child;};var getValue=function(object,prop){if(!(object&&object[prop]))return null;return _.isFunction(object[prop])?object[prop]():object[prop];};var urlError=function(){throw new Error('A "url" property or function must be specified');};}).call(this);var Mustache=(typeof module!=="undefined"&&module.exports)||{};(function(exports){exports.name="mustache.js";exports.version="0.5.0-dev";exports.tags=["{{","}}"];exports.parse=parse;exports.compile=compile;exports.render=render;exports.clearCache=clearCache;exports.to_html=function(template,view,partials,send){var result=render(template,view,partials);if(typeof send==="function"){send(result);}else{return result;}};var _toString=Object.prototype.toString;var _isArray=Array.isArray;var _forEach=Array.prototype.forEach;var _trim=String.prototype.trim;var isArray;if(_isArray){isArray=_isArray;}else{isArray=function(obj){return _toString.call(obj)==="[object Array]";};}
var forEach;if(_forEach){forEach=function(obj,callback,scope){return _forEach.call(obj,callback,scope);};}else{forEach=function(obj,callback,scope){for(var i=0,len=obj.length;i<len;++i){callback.call(scope,obj[i],i,obj);}};}
var spaceRe=/^\s*$/;function isWhitespace(string){return spaceRe.test(string);}
var trim;if(_trim){trim=function(string){return string==null?"":_trim.call(string);};}else{var trimLeft,trimRight;if(isWhitespace("\xA0")){trimLeft=/^\s+/;trimRight=/\s+$/;}else{trimLeft=/^[\s\xA0]+/;trimRight=/[\s\xA0]+$/;}
trim=function(string){return string==null?"":String(string).replace(trimLeft,"").replace(trimRight,"");};}
var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':'&quot;',"'":'&#39;'};function escapeHTML(string){return String(string).replace(/&(?!\w+;)|[<>"']/g,function(s){return escapeMap[s]||s;});}
function debug(e,template,line,file){file=file||"<template>";var lines=template.split("\n"),start=Math.max(line-3,0),end=Math.min(lines.length,line+3),context=lines.slice(start,end);var c;for(var i=0,len=context.length;i<len;++i){c=i+start+1;context[i]=(c===line?" >> ":"    ")+context[i];}
e.template=template;e.line=line;e.file=file;e.message=[file+":"+line,context.join("\n"),"",e.message].join("\n");return e;}
function lookup(name,stack,defaultValue){if(name==="."){return stack[stack.length-1];}
var names=name.split(".");var lastIndex=names.length-1;var target=names[lastIndex];var value,context,i=stack.length,j,localStack;while(i){localStack=stack.slice(0);context=stack[--i];j=0;while(j<lastIndex){context=context[names[j++]];if(context==null){break;}
localStack.push(context);}
if(context&&typeof context==="object"&&target in context){value=context[target];break;}}
if(typeof value==="function"){value=value.call(localStack[localStack.length-1]);}
if(value==null){return defaultValue;}
return value;}
function renderSection(name,stack,callback,inverted){var buffer="";var value=lookup(name,stack);if(inverted){if(value==null||value===false||(isArray(value)&&value.length===0)){buffer+=callback();}}else if(isArray(value)){forEach(value,function(value){stack.push(value);buffer+=callback();stack.pop();});}else if(typeof value==="object"){stack.push(value);buffer+=callback();stack.pop();}else if(typeof value==="function"){var scope=stack[stack.length-1];var scopedRender=function(template){return render(template,scope);};buffer+=value.call(scope,callback(),scopedRender)||"";}else if(value){buffer+=callback();}
return buffer;}
function parse(template,options){options=options||{};var tags=options.tags||exports.tags,openTag=tags[0],closeTag=tags[tags.length-1];var code=['var buffer = "";',"\nvar line = 1;","\ntry {",'\nbuffer += "'];var spaces=[],hasTag=false,nonSpace=false;var stripSpace=function(){if(hasTag&&!nonSpace&&!options.space){while(spaces.length){code.splice(spaces.pop(),1);}}else{spaces=[];}
hasTag=false;nonSpace=false;};var sectionStack=[],updateLine,nextOpenTag,nextCloseTag;var setTags=function(source){tags=trim(source).split(/\s+/);nextOpenTag=tags[0];nextCloseTag=tags[tags.length-1];};var includePartial=function(source){code.push('";',updateLine,'\nvar partial = partials["'+trim(source)+'"];','\nif (partial) {','\n  buffer += render(partial,stack[stack.length - 1],partials);','\n}','\nbuffer += "');};var openSection=function(source,inverted){var name=trim(source);if(name===""){throw debug(new Error("Section name may not be empty"),template,line,options.file);}
sectionStack.push({name:name,inverted:inverted});code.push('";',updateLine,'\nvar name = "'+name+'";','\nvar callback = (function () {','\n  return function () {','\n    var buffer = "";','\nbuffer += "');};var openInvertedSection=function(source){openSection(source,true);};var closeSection=function(source){var name=trim(source);var openName=sectionStack.length!=0&&sectionStack[sectionStack.length-1].name;if(!openName||name!=openName){throw debug(new Error('Section named "'+name+'" was never opened'),template,line,options.file);}
var section=sectionStack.pop();code.push('";','\n    return buffer;','\n  };','\n})();');if(section.inverted){code.push("\nbuffer += renderSection(name,stack,callback,true);");}else{code.push("\nbuffer += renderSection(name,stack,callback);");}
code.push('\nbuffer += "');};var sendPlain=function(source){code.push('";',updateLine,'\nbuffer += lookup("'+trim(source)+'",stack,"");','\nbuffer += "');};var sendEscaped=function(source){code.push('";',updateLine,'\nbuffer += escapeHTML(lookup("'+trim(source)+'",stack,""));','\nbuffer += "');};var line=1,c,callback;for(var i=0,len=template.length;i<len;++i){if(template.slice(i,i+openTag.length)===openTag){i+=openTag.length;c=template.substr(i,1);updateLine='\nline = '+line+';';nextOpenTag=openTag;nextCloseTag=closeTag;hasTag=true;switch(c){case"!":i++;callback=null;break;case"=":i++;closeTag="="+closeTag;callback=setTags;break;case">":i++;callback=includePartial;break;case"#":i++;callback=openSection;break;case"^":i++;callback=openInvertedSection;break;case"/":i++;callback=closeSection;break;case"{":closeTag="}"+closeTag;case"&":i++;nonSpace=true;callback=sendPlain;break;default:nonSpace=true;callback=sendEscaped;}
var end=template.indexOf(closeTag,i);if(end===-1){throw debug(new Error('Tag "'+openTag+'" was not closed properly'),template,line,options.file);}
var source=template.substring(i,end);if(callback){callback(source);}
var n=0;while(~(n=source.indexOf("\n",n))){line++;n++;}
i=end+closeTag.length-1;openTag=nextOpenTag;closeTag=nextCloseTag;}else{c=template.substr(i,1);switch(c){case'"':case"\\":nonSpace=true;code.push("\\"+c);break;case"\r":break;case"\n":spaces.push(code.length);code.push("\\n");stripSpace();line++;break;default:if(isWhitespace(c)){spaces.push(code.length);}else{nonSpace=true;}
code.push(c);}}}
if(sectionStack.length!=0){throw debug(new Error('Section "'+sectionStack[sectionStack.length-1].name+'" was not closed properly'),template,line,options.file);}
stripSpace();code.push('";',"\nreturn buffer;","\n} catch (e) { throw {error: e, line: line}; }");var body=code.join("").replace(/buffer \+= "";\n/g,"");if(options.debug){if(typeof console!="undefined"&&console.log){console.log(body);}else if(typeof print==="function"){print(body);}}
return body;}
function _compile(template,options){var args="view,partials,stack,lookup,escapeHTML,renderSection,render";var body=parse(template,options);var fn=new Function(args,body);return function(view,partials){partials=partials||{};var stack=[view];try{return fn(view,partials,stack,lookup,escapeHTML,renderSection,render);}catch(e){throw debug(e.error,template,e.line,options.file);}};}
var _cache={};function clearCache(){_cache={};}
function compile(template,options){options=options||{};if(options.cache!==false){if(!_cache[template]){_cache[template]=_compile(template,options);}
return _cache[template];}
return _compile(template,options);}
function render(template,view,partials){return compile(template)(view,partials);}})(Mustache);var def=(function(){var arraySlice=Array.prototype.slice;if(!Object.keys){Object.keys=function(o){if(o!==Object(o)){throw new TypeError('Object.keys called on non-object');}
var ret=[];for(var p in o){if(Object.prototype.hasOwnProperty.call(o,p)){ret.push(p);}}
return ret;};}
if(!Object.create){Object.create=(function(){var Klass=function(){},proto=Klass.prototype;function create(baseProto){Klass.prototype=baseProto||{};var instance=new Klass();Klass.prototype=proto;return instance;}
return create;}());}
if(!Function.prototype.bind){Function.prototype.bind=function(ctx){var staticArgs=arraySlice.call(arguments,1);var fToBind=this;return function(){return fToBind.apply(ctx,staticArgs.concat(arraySlice.call(arguments)));};};}
if(!this.JSON){this.JSON={};}
if(!this.JSON.stringify){this.JSON.stringify=function(t){return''+t;};}
var objectHasOwn=Object.prototype.hasOwnProperty;var def={global:this,get:function(o,p,dv){var v;return o&&(v=o[p])!=null?v:dv;},gets:function(o,props){return props.map(function(p){return o[p];});},getPath:function(o,path,dv,create){if(!o){return dv;}
if(path!=null){var parts=def.array.is(path)?path:path.split('.');var L=parts.length;if(L){var i=0;while(i<L){var part=parts[i++];var value=o[part];if(value==null){if(!create){return dv;}
value=o[part]=(dv==null||isNaN(+dv))?{}:[];}
o=value;}}}
return o;},setPath:function(o,path,v){if(o&&path!=null){var parts=def.array.is(path)?path:path.split('.');if(parts.length){var pLast=parts.pop();o=def.getPath(o,parts,pLast,true);if(o!=null){o[pLast]=v;}}}
return o;},propGet:function(p,dv){p=''+p;return function(o){return o?o[p]:dv;};},getOwn:function(o,p,dv){var v;return o&&objectHasOwn.call(o,p)&&(v=o[p])!=null?v:dv;},hasOwn:function(o,p){return!!o&&objectHasOwn.call(o,p);},hasOwnProp:objectHasOwn,set:function(o){if(!o){o={};}
var a=arguments;for(var i=1,A=a.length-1;i<A;i+=2){o[a[i]]=a[i+1];}
return o;},setDefaults:function(o,o2){if(!o){o={};}
var a=arguments;var A=a.length;var p;if(A===2&&def.object.is(o2)){for(p in o2){if(o[p]==null){o[p]=o2[p];}}}else{A--;for(var i=1;i<A;i+=2){p=a[i];if(o[p]==null){o[p]=a[i+1];}}}
return o;},setUDefaults:function(o,o2){if(!o){o={};}
var a=arguments;var A=a.length;var p;if(A===2&&def.object.is(o2)){for(p in o2){if(o[p]===undefined){o[p]=o2[p];}}}else{A--;for(var i=1;i<A;i+=2){p=a[i];if(o[p]===undefined){o[p]=a[i+1];}}}
return o;},eachOwn:function(o,fun,ctx){if(o){for(var p in o){if(objectHasOwn.call(o,p)){fun.call(ctx,o[p],p,o);}}}},each:function(o,fun,ctx){if(o){for(var p in o){fun.call(ctx,o[p],p,o);}}},copyOwn:function(a,b){var to,from;if(arguments.length>=2){to=a||{};from=b;}else{to={};from=a;}
if(from){for(var p in from){if(objectHasOwn.call(from,p)){to[p]=from[p];}}}
return to;},copy:function(a,b){var to,from;if(arguments.length>=2){to=a||{};from=b;}else{to={};from=a;}
if(from){for(var p in from){to[p]=from[p];}}
return to;},copyProps:function(a,b,props){var to,from;if(arguments.length>=3){to=a||{};from=b;}else{to={};from=a;props=b;}
if(props){if(from){props.forEach(function(p){to[p]=from[p];});}else{props.forEach(function(p){to[p]=undefined;});}}
return to;},keys:function(o){var keys=[];for(var p in o){keys.push(p);}
return keys;},values:function(o){var values=[];for(var p in o){values.push(o[p]);}
return values;},uniqueIndex:function(o,key,ctx){var index={};for(var p in o){var v=key?key.call(ctx,o[p]):o[p];if(v!=null&&!objectHasOwn.call(index,v)){index[v]=p;}}
return index;},ownKeys:Object.keys,own:function(o,f,ctx){var keys=Object.keys(o);return f?keys.map(function(key){return f.call(ctx,o[key],key);}):keys.map(function(key){return o[key];});},scope:function(scopeFun,ctx){return scopeFun.call(ctx);},bit:{set:function(bits,set,on){return(on||on==null)?(bits|set):(bits&~set);}},compare:function(a,b){return(a===b)?0:((a>b)?1:-1);},compareReverse:function(a,b){return(a===b)?0:((a>b)?-1:1);},methodCaller:function(p,x){if(x){return function(){return x[p].apply(x,arguments);};}
return function(){return this[p].apply(this,arguments);};},identity:function(x){return x;},add:function(a,b){return a+b;},negate:function(f){return function(){return!f.apply(this,arguments);};},sqr:function(v){return v*v;},noop:function noop(){},retTrue:function(){return true;},retFalse:function(){return false;},number:{is:function(v){return typeof v==='number';},as:function(d,dv){var v=parseFloat(d);return isNaN(v)?(dv||0):v;},to:function(d,dv){var v=parseFloat(d);return isNaN(v)?(dv||0):v;}},array:{is:function(v){return(v instanceof Array);},isLike:function(v){return v&&(v.length!=null)&&(typeof v!=='string');},as:function(thing){return(thing instanceof Array)?thing:((thing!=null)?[thing]:null);},to:function(thing){return(thing instanceof Array)?thing:((thing!=null)?[thing]:null);},lazy:function(scope,p,f,ctx){return scope[p]||(scope[p]=(f?f.call(ctx,p):[]));},copy:function(al){return arraySlice.apply(al,arraySlice.call(arguments,1));}},object:{is:function(v){return v&&typeof(v)==='object';},isNative:function(v){return(!!v)&&v.constructor===Object;},as:function(v){return v&&typeof(v)==='object'?v:null;},asNative:function(v){return v&&v.constructor===Object?v:null;},lazy:function(scope,p,f,ctx){return scope[p]||(scope[p]=(f?f.call(ctx,p):{}));}},string:{is:function(v){return typeof v==='string';},to:function(v,ds){return v!=null?(''+v):(ds||'');},join:function(sep){var a=arguments;var L=a.length;var v,v2;switch(L){case 3:v=a[1];v2=a[2];if(v!=null&&v!==""){if(v2!=null&&v2!==""){return(""+v)+sep+(""+v2);}
return(""+v);}else if(v2!=null&&v2!==""){return(""+v2);}
return"";case 2:v=a[1];return v!=null?(""+v):"";case 1:case 0:return"";}
var args=[];for(var i=1;i<L;i++){v=a[i];if(v!=null&&v!==""){args.push(""+v);}}
return args.join(sep);},padRight:function(s,n,p){if(!s){s='';}
if(p==null){p=' ';}
var k=~~((n-s.length)/p.length);return k>0?(s+new Array(k+1).join(p)):s;}},fun:{is:function(v){return typeof v==='function';},as:function(v){return typeof v==='function'?v:null;},to:function(v){return typeof v==='function'?v:def.fun.constant(v);},constant:function(v){return function(){return v;};}},nullyTo:function(v,dv){return v!=null?v:dv;},between:function(v,min,max){return Math.max(min,Math.min(v,max));},nully:function(v){return v==null;},notNully:function(v){return v!=null;},notUndef:function(v){return v!==undefined;},empty:function(v){return v==null||v==='';},notEmpty:function(v){return v!=null&&v!=='';},truthy:function(x){return!!x;},falsy:function(x){return!x;},firstUpperCase:function(s){if(s){var c=s.charAt(0),cU=c.toUpperCase();if(c!==cU){s=cU+s.substr(1);}}
return s;},firstLowerCase:function(s){if(s){var c=s.charAt(0),cL=c.toLowerCase();if(c!==cL){s=cL+s.substr(1);}}
return s;},format:function(mask,scope,ctx){if(mask==null||mask===''){return"";}
var isScopeFun=scope&&def.fun.is(scope);return mask.replace(/(^|[^{])\{([^{}]+)\}/g,function($0,before,prop){var value=!scope?null:isScopeFun?scope.call(ctx,prop):scope[prop];return before+(value==null?"":String(value));});},destructuringTypeBind:function(types,values){var T=types.length;var result=new Array(T);if(T&&values){var V=values.length;if(V){var v=0;var t=0;do{var value=values[v];if(value==null||typeof value===types[t]){result[t]=value;v++;}
t++;}while(t<T&&v<V);}}
return result;},error:function(error){return(error instanceof Error)?error:new Error(error);},fail:function(error){throw def.error(error);},assert:function(msg,scope){throw def.error.assertionFailed(msg,scope);}};var AL=def.array.like=def.copyOwn(function(v){return AL.is(v)?v:[v];},{is:function(v){return v&&(v.length!=null)&&(typeof v!=='string');},as:function(v){return AL.is(v)?v:null;}});AL.to=AL;def.lazy=def.object.lazy;def.shared=function(){var _channel=null;function create(value){function safe(){_channel=value;}
return safe;}
function opener(safe){if(_channel!=null){throw new Error("Access denied.");}
safe();var value;value=_channel;_channel=null;return value;}
opener.safe=create;return opener;};var errors={operationInvalid:function(msg,scope){return def.error(def.string.join(" ","Invalid operation.",def.format(msg,scope)));},notImplemented:function(){return def.error("Not implemented.");},argumentRequired:function(name){return def.error(def.format("Required argument '{0}'.",[name]));},argumentInvalid:function(name,msg,scope){return def.error(def.string.join(" ",def.format("Invalid argument '{0}'.",[name]),def.format(msg,scope)));},assertionFailed:function(msg,scope){return def.error(def.string.join(" ","Assertion failed.",def.format(msg,scope)));}};def.copyOwn(def.error,errors);def.eachOwn(errors,function(errorFun,name){def.fail[name]=function(){throw errorFun.apply(null,arguments);};});var currentNamespace=def,globalNamespaces={},namespaceStack=[];function globalSpace(name,space){return globalNamespaces[name]=space;}
function getNamespace(name,base){var current=base||currentNamespace;if(name){var parts=name.split('.');var L=parts.length;if(L){var i=0;var part;if(current===def.global){part=parts[0];var globalNamespace=def.getOwn(globalNamespaces,part);if(globalNamespace){current=globalNamespace;i++;}}
while(i<L){part=parts[i++];current=current[part]||(current[part]={});}}}
return current;}
function createSpace(name,base,definition){if(def.fun.is(base)){definition=base;base=null;}
var namespace=getNamespace(name,base);if(definition){namespaceStack.push(currentNamespace);try{definition(namespace);}finally{currentNamespace=namespaceStack.pop();}}
return namespace;}
function defineName(namespace,name,value){!def.hasOwn(namespace,name)||def.fail.operationInvalid("Name '{0}' is already defined in namespace.",[name]);return namespace[name]=value;}
def.space=createSpace;def.globalSpace=globalSpace;def.mixin=createMixin(Object.create);def.copyOwn(def.mixin,{custom:createMixin,inherit:def.mixin,copy:createMixin(def.copy),share:createMixin(def.identity)});function createMixin(protectNativeObject){return function(instance){return mixinMany(instance,arraySlice.call(arguments,1),protectNativeObject);};}
function mixinMany(instance,mixins,protectNativeObject){for(var i=0,L=mixins.length;i<L;i++){var mixin=mixins[i];if(mixin){mixin=def.object.as(mixin.prototype||mixin);if(mixin){mixinRecursive(instance,mixin,protectNativeObject);}}}
return instance;}
function mixinRecursive(instance,mixin,protectNativeObject){for(var p in mixin){mixinProp(instance,p,mixin[p],protectNativeObject);}}
function mixinProp(instance,p,vMixin,protectNativeObject){if(vMixin!==undefined){var oMixin,oTo=def.object.asNative(instance[p]);if(oTo){oMixin=def.object.as(vMixin);if(oMixin){if(!objectHasOwn.call(instance,p)){instance[p]=oTo=Object.create(oTo);}
mixinRecursive(oTo,oMixin,protectNativeObject);}else{instance[p]=vMixin;}}else{oMixin=def.object.asNative(vMixin);if(oMixin){vMixin=(protectNativeObject||Object.create)(oMixin);}
instance[p]=vMixin;}}}
function createRecursive(instance){for(var p in instance){var vObj=def.object.asNative(instance[p]);if(vObj){createRecursive((instance[p]=Object.create(vObj)));}}}
def.create=function(){var mixins=arraySlice.call(arguments),deep=true,baseProto=mixins.shift();if(typeof(baseProto)==='boolean'){deep=baseProto;baseProto=mixins.shift();}
var instance=baseProto?Object.create(baseProto):{};if(deep){createRecursive(instance);}
if(mixins.length>0){mixins.unshift(instance);def.mixin.apply(def,mixins);}
return instance;};def.scope(function(){var shared=def.shared();function typeLocked(){return def.error.operationInvalid("Type is locked.");}
var typeProto={init:function(init){init||def.fail.argumentRequired('init');var state=shared(this.safe);!state.locked||def.fail(typeLocked());var baseInit=state.init;if(baseInit){init=override(init,baseInit);}
state.init=init;state.initOrPost=true;return this;},postInit:function(postInit){postInit||def.fail.argumentRequired('postInit');var state=shared(this.safe);!state.locked||def.fail(typeLocked());var basePostInit=state.post;if(basePostInit){postInit=override(postInit,basePostInit);}
state.post=postInit;state.initOrPost=true;return this;},add:function(mixin){var state=shared(this.safe);!state.locked||def.fail(typeLocked());var proto=this.prototype;var baseState=state.base;def.each(mixin.prototype||mixin,function(value,p){switch(p){case'base':case'constructor':return;case'toString':if(value===toStringMethod){return;}
break;case'override':if(value===overrideMethod){return;}
break;}
if(value){var method=asMethod(value);if(method){var baseMethod;var bm=state.methods[p];if(bm&&(bm instanceof Method)){baseMethod=bm;}else if(baseState){bm=baseState.methods[p];if(bm&&(bm instanceof Method)){baseMethod=bm;}}
state.methods[p]=method;if(baseMethod){value=baseMethod.override(method);}
proto[p]=value;return;}}
mixinProp(proto,p,value,def.identity);});return this;},getStatic:function(p){return getStatic(shared(this.safe),p);},addStatic:function(mixin){var state=shared(this.safe);!state.locked||def.fail(typeLocked());for(var p in mixin){if(p!=='prototype'){var v1=def.getOwn(this,p);var v2=mixin[p];var o2=def.object.as(v2);if(o2){var v1Local=(v1!==undefined);if(!v1Local){v1=getStatic(state.base,p);}
var o1=def.object.asNative(v1);if(o1){if(v1Local){def.mixin(v1,v2);continue;}
v2=def.create(v1,v2);}}
this[p]=v2;}}
return this;}};function getStatic(state,p){if(state){do{var v=def.getOwn(state.constructor,p);if(v!==undefined){return v;}}while((state=state.base));}}
function TypeName(full){var parts;if(full){if(full instanceof Array){parts=full;full=parts.join('.');}else{parts=full.split('.');}}
if(parts&&parts.length>1){this.name=parts.pop();this.namespace=parts.join('.');this.namespaceParts=parts;}else{this.name=full||null;this.namespace=null;this.namespaceParts=[];}}
TypeName.prototype.toString=function(){return def.string.join('.',this.namespace+'.'+this.name);};function Method(spec){this.fun=spec.as;if(spec){if(spec.isAbstract){this.isAbstract=true;}}}
def.copyOwn(Method.prototype,{isAbstract:false,override:function(method){if(this.isAbstract){return method.fun;}
var fun2=override(method.fun,this.fun);method.fun=fun2;return fun2;}});function asMethod(fun){if(fun){if(def.fun.is(fun)){return new Method({as:fun});}
if(fun instanceof Method){return fun;}
if(def.fun.is(fun.as)){return new Method(fun);}
if(fun.isAbstract){return new Method({isAbstract:true,as:def.fail.notImplemented});}}
return null;}
function method(fun){return asMethod(fun)||def.fail.argumentInvalid('fun');}
function rootType(){}
var rootProto=rootType.prototype;rootProto.base=undefined;var rootState={locked:true,init:undefined,postInit:undefined,initOrPost:false,methods:{},constructor:rootType};rootType.safe=shared.safe(rootState);function override(method,base){return function(){var prevBase=rootProto.base;rootProto.base=base;try{return method.apply(this,arguments);}finally{rootProto.base=prevBase;}};}
function overrideMethod(mname,method){this[mname]=override(method,this[mname]);return this;}
function toStringMethod(){return''+this.constructor;}
function inherits(type,base){var proto=type.prototype=Object.create(base.prototype);proto.constructor=type;return proto;}
function createConstructor(state){var S=1;var steps=[function(){S=0;if(state.initOrPost){steps.length=0;if(state.init){steps.push(state.init);S++;}
if(state.post){steps.push(state.post);S++;}
constructor.apply(this,arguments);return false;}else{steps=null;}}];function constructor(){if(S){var i=0;while(steps[i].apply(this,arguments)!==false&&++i<S){}}}
return constructor;}
var _typeFunArgTypes=['string','function','object'];function type(){var args=def.destructuringTypeBind(_typeFunArgTypes,arguments);return typeCore.apply(this,args);}
function typeCore(name,baseType,space){var typeName=new TypeName(name);var baseState;if(baseType){baseState=(baseType.safe&&shared(baseType.safe))||def.fail.operationInvalid("Invalid \"foreign\" base type.");baseState.locked=true;}else{baseType=rootType;baseState=rootState;}
var state=Object.create(baseState);state.locked=false;state.base=baseState;state.methods=Object.create(baseState.methods);var constructor=createConstructor(state);def.copyOwn(constructor,typeProto);constructor.name=typeName.name;constructor.typeName=typeName;constructor.safe=shared.safe(state);constructor.toString=function(){return(''+this.typeName)||"Anonymous type";};var proto=inherits(constructor,baseType);state.constructor=constructor;proto.override=overrideMethod;proto.toString=toStringMethod;if(typeName.name){defineName(def.space(typeName.namespace,space),typeName.name,constructor);}
return constructor;}
def.type=type;def.method=method;});def.makeEnum=function(a){var i=1;var e={};a.forEach(function(p){e[p]=i;i=i<<1;});return e;};def.copyOwn(def.array,{create:function(len,dv){var a=len>=0?new Array(len):[];if(dv!==undefined){for(var i=0;i<len;i++){a[i]=dv;}}
return a;},append:function(target,source,start){if(start==null){start=0;}
for(var i=0,L=source.length,T=target.length;i<L;i++){target[T+i]=source[start+i];}
return target;},appendMany:function(target){var a=arguments;var S=a.length;if(S>1){var t=target.length;for(var s=1;s<S;s++){var source=a[s];if(source){var i=0;var L=source.length;while(i<L){target[t++]=source[i++];}}}}
return target;},prepend:function(target,source,start){if(start==null){start=0;}
for(var i=0,L=source.length;i<L;i++){target.unshift(source[start+i]);}
return target;},removeAt:function(array,index){return array.splice(index,1)[0];},insertAt:function(array,index,elem){array.splice(index,0,elem);return array;},binarySearch:function(array,item,comparer,key){if(!comparer){comparer=def.compare;}
var low=0,high=array.length-1;while(low<=high){var mid=(low+high)>>1;var result=comparer(item,key?key(array[mid]):array[mid]);if(result<0){high=mid-1;}else if(result>0){low=mid+1;}else{return mid;}}
return~low;},insert:function(array,item,comparer){var index=def.array.binarySearch(array,item,comparer);if(index<0){array.splice(~index,0,item);}
return index;},remove:function(array,item,comparer){var index=def.array.binarySearch(array,item,comparer);if(index>=0){return array.splice(index,1)[0];}}});var nextGlobalId=1,nextIdByScope={};def.nextId=function(scope){if(scope){var nextId=def.getOwn(nextIdByScope,scope)||1;nextIdByScope[scope]=nextId+1;return nextId;}
return nextGlobalId++;};def.type('Set').init(function(source,count){this.source=source||{};this.count=source?(count!=null?count:def.ownKeys(source).length):0;}).add({has:function(p){return objectHasOwn.call(this.source,p);},add:function(p){var source=this.source;if(!objectHasOwn.call(source,p)){this.count++;source[p]=true;}
return this;},rem:function(p){if(objectHasOwn.call(this.source,p)){delete this.source[p];this.count--;}
return this;},clear:function(){if(this.count){this.source={};this.count=0;}
return this;},members:function(){return def.ownKeys(this.source);}});def.type('Map').init(function(source,count){this.source=source||{};this.count=source?(count!=null?count:def.ownKeys(source).length):0;}).add({has:function(p){return objectHasOwn.call(this.source,p);},get:function(p){return objectHasOwn.call(this.source,p)?this.source[p]:undefined;},set:function(p,v){var source=this.source;if(!objectHasOwn.call(source,p)){this.count++;}
source[p]=v;return this;},rem:function(p){if(objectHasOwn.call(this.source,p)){delete this.source[p];this.count--;}
return this;},clear:function(){if(this.count){this.source={};this.count=0;}
return this;},copy:function(other){def.eachOwn(other.source,function(value,p){this.set(p,value);},this);},values:function(){return def.own(this.source);},keys:function(){return def.ownKeys(this.source);},clone:function(){return new def.Map(def.copy(this.source),this.count);},symmetricDifference:function(other){if(!this.count){return other.clone();}
if(!other.count){return this.clone();}
var result={};var count=0;var as=this.source;var bs=other.source;def.eachOwn(as,function(a,p){if(!objectHasOwn.call(bs,p)){result[p]=a;count++;}});def.eachOwn(bs,function(b,p){if(!objectHasOwn.call(as,p)){result[p]=b;count++;}});return new def.Map(result,count);},intersect:function(other,result){if(!result){result=new def.Map();}
def.eachOwn(this.source,function(value,p){if(other.has(p)){result.set(p,value);}});return result;}});def.type('OrderedMap').init(function(){this._list=[];this._map={};}).add({has:function(key){return objectHasOwn.call(this._map,key);},count:function(){return this._list.length;},get:function(key){var bucket=def.getOwn(this._map,key);if(bucket){return bucket.value;}},at:function(index){var bucket=this._list[index];if(bucket){return bucket.value;}},add:function(key,v,index){var map=this._map;var bucket=def.getOwn(map,key);if(!bucket){bucket=map[key]={key:key,value:v};if(index==null){this._list.push(bucket);}else{def.array.insertAt(this._list,index,bucket);}}else if(bucket.value!==v){bucket.value=v;}
return this;},rem:function(key){var bucket=def.getOwn(this._map,key);if(bucket){var index=this._list.indexOf(bucket);this._list.splice(index,1);delete this._map[key];}
return this;},clear:function(){if(this._list.length){this._map={};this._list.length=0;}
return this;},keys:function(){return def.ownKeys(this._map);},forEach:function(fun,ctx){return this._list.forEach(function(bucket){fun.call(ctx,bucket.value,bucket.key);});}});def.html={escape:function(str){return def.string.to(str).replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;");}};def.type('Query').init(function(){this.index=-1;this.item=undefined;}).add({next:function(){var index=this.index;if(index===-2){return false;}
index++;if(!this._next(index)){this.index=-2;this.item=undefined;return false;}
this.index=index;return true;},_next:def.method({isAbstract:true}),_finish:function(){this.index=-2;this.item=undefined;},each:function(fun,ctx){while(this.next()){if(fun.call(ctx,this.item,this.index)===false){return true;}}
return false;},array:function(){var array=[];while(this.next()){array.push(this.item);}
return array;},sort:function(compare,by){if(!compare){compare=def.compare;}
if(by){var keyCompare=compare;compare=function(a,b){return keyCompare(by(a),by(b));};}
var sorted=this.array().sort(compare);return new def.ArrayLikeQuery(sorted);},object:function(keyArgs){var target=def.get(keyArgs,'target')||{},nameFun=def.get(keyArgs,'name'),valueFun=def.get(keyArgs,'value'),ctx=def.get(keyArgs,'context');while(this.next()){var name=''+(nameFun?nameFun.call(ctx,this.item,this.index):this.item);target[name]=valueFun?valueFun.call(ctx,this.item,this.index):this.item;}
return target;},reduce:function(accumulator){var i=0,result;if(arguments.length<2){if(!this.next()){throw new TypeError("Length is 0 and no second argument");}
result=this.item;}else{result=arguments[1];}
while(this.next()){result=accumulator(result,this.item,this.index);++i;}
return result;},count:function(){var count=0;while(this.next()){count++;}
return count;},first:function(pred,ctx,dv){while(this.next()){if(!pred||pred.call(ctx,this.item,this.index)){var item=this.item;this._finish();return item;}}
return dv;},last:function(pred,ctx,dv){var theItem=dv;while(this.next()){if(!pred||pred.call(ctx,this.item,this.index)){theItem=this.item;}}
return theItem;},any:function(pred,ctx){while(this.next()){if(!pred||pred.call(ctx,this.item,this.index)){this._finish();return true;}}
return false;},all:function(pred,ctx){while(this.next()){if(!pred.call(ctx,this.item,this.index)){this._finish();return false;}}
return true;},min:function(){var min=null;while(this.next()){if(min===null||this.item<min){min=this.item;}}
return min;},max:function(){var max=null;while(this.next()){if(max===null||this.item>max){max=this.item;}}
return max;},range:function(){var min=null,max=null;while(this.next()){var item=this.item;if(min===null){min=max=item;}else{if(item<min){min=item;}
if(item>max){max=item;}}}
return min!=null?{min:min,max:max}:null;},multipleIndex:function(keyFun,ctx){var keyIndex={};this.each(function(item){var key=keyFun?keyFun.call(ctx,item):item;if(key!=null){var sameKeyItems=def.getOwn(keyIndex,key)||(keyIndex[key]=[]);sameKeyItems.push(item);}});return keyIndex;},uniqueIndex:function(keyFun,ctx){var keyIndex={};this.each(function(item){var key=keyFun?keyFun.call(ctx,item):item;if(key!=null&&!def.hasOwn(keyIndex,key)){keyIndex[key]=item;}});return keyIndex;},select:function(fun,ctx){return new def.SelectQuery(this,fun,ctx);},prop:function(p){return new def.SelectQuery(this,function(item){if(item){return item[p];}});},selectMany:function(fun,ctx){return new def.SelectManyQuery(this,fun,ctx);},union:function(){var queries=def.array.append([this],arguments);return new def.SelectManyQuery(new def.ArrayLikeQuery(queries));},where:function(fun,ctx){return new def.WhereQuery(this,fun,ctx);},distinct:function(fun,ctx){return new def.DistinctQuery(this,fun,ctx);},skip:function(n){return new def.SkipQuery(this,n);},take:function(n){if(n<=0){return new def.NullQuery();}
if(!isFinite(n)){return this;}
return new def.TakeQuery(this,n);},whayl:function(pred,ctx){return new def.WhileQuery(this,pred,ctx);},reverse:function(){return new def.ReverseQuery(this);}});def.type('NullQuery',def.Query).add({_next:function(){}});def.type('AdhocQuery',def.Query).init(function(next){this.base();this._next=next;});def.type('ArrayLikeQuery',def.Query).init(function(list){this.base();this._list=def.array.isLike(list)?list:[list];this._count=this._list.length;}).add({_next:function(nextIndex){var count=this._count;if(nextIndex<count){var list=this._list;while(!objectHasOwn.call(list,nextIndex)){nextIndex++;if(nextIndex>=count){return 0;}
this._count--;}
this.item=list[nextIndex];return 1;}},count:function(){var remaining=this._count;if(this.index>=0){remaining-=(this.index+1);}
this._finish();return remaining;}});def.type('RangeQuery',def.Query).init(function(start,count,step){this.base();this._index=start;this._count=count;this._step=step==null?1:step;}).add({_next:function(nextIndex){if(nextIndex<this._count){this.item=this._index;this._index+=this._step;return 1;}},count:function(){var remaining=this._count;if(this.index>=0){remaining-=(this.index+1);}
this._finish();return remaining;}});def.type('WhereQuery',def.Query).init(function(source,where,ctx){this.base();this._where=where;this._ctx=ctx;this._source=source;}).add({_next:function(nextIndex){var source=this._source;while(source.next()){var nextItem=source.item;if(this._where.call(this._ctx,nextItem,source.index)){this.item=nextItem;return 1;}}}});def.type('WhileQuery',def.Query).init(function(source,pred,ctx){this.base();this._pred=pred;this._ctx=ctx;this._source=source;}).add({_next:function(nextIndex){while(this._source.next()){var nextItem=this._source.item;if(this._pred.call(this._ctx,nextItem,this._source.index)){this.item=nextItem;return 1;}
return 0;}}});def.type('SelectQuery',def.Query).init(function(source,select,ctx){this.base();this._select=select;this._ctx=ctx;this._source=source;}).add({_next:function(nextIndex){if(this._source.next()){this.item=this._select.call(this._ctx,this._source.item,this._source.index);return 1;}}});def.type('SelectManyQuery',def.Query).init(function(source,selectMany,ctx){this.base();this._selectMany=selectMany;this._ctx=ctx;this._source=source;this._manySource=null;}).add({_next:function(nextIndex){while(true){if(this._manySource){if(this._manySource.next()){this.item=this._manySource.item;return 1;}
this._manySource=null;}
if(!query_nextMany.call(this)){break;}}}});function query_nextMany(){while(this._source.next()){var manySource=this._selectMany?this._selectMany.call(this._ctx,this._source.item,this._source.index):this._source.item;if(manySource!=null){this._manySource=def.query(manySource);return 1;}}}
def.type('DistinctQuery',def.Query).init(function(source,key,ctx){this.base();this._key=key;this._ctx=ctx;this._source=source;this._keys={};}).add({_next:function(nextIndex){while(this._source.next()){var nextItem=this._source.item,keyValue=this._key?this._key.call(this._ctx,nextItem,this._source.index):nextItem;if(keyValue!=null&&!def.hasOwn(this._keys,keyValue)){this._keys[keyValue]=true;this.item=nextItem;return 1;}}}});def.type('SkipQuery',def.Query).init(function(source,skip){this.base();this._source=source;this._skip=skip;}).add({_next:function(nextIndex){while(this._source.next()){if(this._skip>0){this._skip--;}else{this.item=this._source.item;return 1;}}}});def.type('TakeQuery',def.Query).init(function(source,take){this.base();this._source=source;this._take=take;}).add({_next:function(nextIndex){if(this._take>0&&this._source.next()){this._take--;this.item=this._source.item;return 1;}}});def.type('ReverseQuery',def.Query).init(function(source){this.base();this._source=source;}).add({_next:function(nextIndex){if(!nextIndex){if(this._source instanceof def.Query){if(this._source instanceof def.ArrayLikeQuery){this._source=this._source._list;}else{this._source=this._source.array();}}
this._count=this._source.length;}
var count=this._count;if(nextIndex<count){var index=count-nextIndex-1;var source=this._source;while(!objectHasOwn.call(source,index)){if(--index<0){return 0;}
this._count--;}
this.item=source[index];return 1;}}});def.query=function(q){if(q===undefined){return new def.NullQuery();}
if(q instanceof def.Query){return q;}
if(def.fun.is(q)){return new def.AdhocQuery(q);}
return new def.ArrayLikeQuery(q);};def.range=function(start,count,step){return new def.RangeQuery(start,count,step);};currentNamespace=def.global;return def;}());var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(input){var output="";var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;input=Base64._utf8_encode(input);while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=((chr1&3)<<4)|(chr2>>4);enc3=((chr2&15)<<2)|(chr3>>6);enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64;}else if(isNaN(chr3)){enc4=64;}
output=output+
this._keyStr.charAt(enc1)+this._keyStr.charAt(enc2)+
this._keyStr.charAt(enc3)+this._keyStr.charAt(enc4);}
return output;},decode:function(input){var output="";var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length){enc1=this._keyStr.indexOf(input.charAt(i++));enc2=this._keyStr.indexOf(input.charAt(i++));enc3=this._keyStr.indexOf(input.charAt(i++));enc4=this._keyStr.indexOf(input.charAt(i++));chr1=(enc1<<2)|(enc2>>4);chr2=((enc2&15)<<4)|(enc3>>2);chr3=((enc3&3)<<6)|enc4;output=output+String.fromCharCode(chr1);if(enc3!=64){output=output+String.fromCharCode(chr2);}
if(enc4!=64){output=output+String.fromCharCode(chr3);}}
output=Base64._utf8_decode(output);return output;},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c);}
else if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128);}
else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128);}}
return utftext;},_utf8_decode:function(utftext){var string="";var i=0;var c=c1=c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++;}
else if((c>191)&&(c<224)){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode(((c&31)<<6)|(c2&63));i+=2;}
else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode(((c&15)<<12)|((c2&63)<<6)|(c3&63));i+=3;}}
return string;}};(function($){function fixTitle($ele){var title=$ele.attr('title');if(title||typeof($ele.attr('original-title'))!=='string'){$ele.attr('original-title',title||'').removeAttr('title');}}
function Tipsy(element,options){this.$element=$(element);this.options=options;this.enabled=true;fixTitle(this.$element);}
Tipsy.prototype={enter:function(){var tipsy=this;var options=this.options;if(options.delayIn==0){tipsy.hoverState=null;tipsy.show();}else{tipsy.hoverState='in';setTimeout(function(){if(tipsy.hoverState==='in'){tipsy.hoverState=null;tipsy.show();}},options.delayIn);}},leave:function(){var tipsy=this;var options=this.options;if(options.delayOut==0){tipsy.hide();}else{tipsy.hoverState='out';setTimeout(function(){if(tipsy.hoverState==='out')tipsy.hide();},options.delayOut);}},visible:function(){var parent;return this.hoverState==='in'||(this.hoverState!=='out'&&!!(this.$tip&&(parent=this.$tip[0].parentNode)&&(parent.nodeType!==11)));},update:function(){if(this.visible()){this.show(true);}else{this.enter();}},show:function(isUpdate){if(this.hoverState==='in'){return;}
var title=this.getTitle();if(!this.enabled||!title){this.hoverState=null;this.hide();return;}
var $tip=this.tip();$tip.find('.tipsy-inner')[this.options.html?'html':'text'](title);$tip[0].className='tipsy';if(!isUpdate){$tip.remove();}
var parent=$tip[0].parentNode;if(!parent||(parent.nodeType===11)){$tip.css({top:0,left:0,visibility:'hidden',display:'block'}).appendTo(document.body);}
var pos=$.extend({},this.$element.offset());if(this.$element[0].nearestViewportElement){var rect=this.$element[0].getBoundingClientRect();pos.width=rect.width;pos.height=rect.height;}else{pos.width=this.$element[0].offsetWidth||0;pos.height=this.$element[0].offsetHeight||0;}
var tipOffset=this.options.offset,useCorners=this.options.useCorners,showArrow=this.options.arrowVisible,actualWidth=$tip[0].offsetWidth,actualHeight=$tip[0].offsetHeight;if(!showArrow){tipOffset-=4;}
function calcPosition(gravity){var tp;switch(gravity.charAt(0)){case'n':tp={top:pos.top+pos.height+tipOffset,left:pos.left+pos.width/2-actualWidth/2};break;case's':tp={top:pos.top-actualHeight-tipOffset,left:pos.left+pos.width/2-actualWidth/2};break;case'e':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth-tipOffset};break;case'w':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width+tipOffset};break;}
if(gravity.length===2){if(gravity.charAt(1)=='w'){tp.left=useCorners?pos.left+pos.width+tipOffset:pos.left+pos.width/2-15;}else{tp.left=useCorners?pos.left-actualWidth-tipOffset:pos.left+pos.width/2-actualWidth+15;}}
return tp;}
var gravity=(typeof this.options.gravity=='function')?this.options.gravity.call(this.$element[0],{width:actualWidth,height:actualHeight},calcPosition):this.options.gravity;var tp=calcPosition(gravity);$tip.css(tp).addClass('tipsy-'+gravity+(useCorners&&gravity.length>1?gravity.charAt(1):''));if(showArrow){var hideArrow=useCorners&&gravity.length===2;$tip.find('.tipsy-arrow')[hideArrow?'hide':'show']();}
var doFadeIn=this.options.fade&&(!isUpdate||!this._prevGravity||(this._prevGravity!==gravity));if(doFadeIn){$tip.stop().css({opacity:0,display:'block',visibility:'visible'}).animate({opacity:this.options.opacity});}else{$tip.css({visibility:'visible',opacity:this.options.opacity});}
this._prevGravity=gravity;this.hoverState=null;},hide:function(){if(this.options.fade){this.tip().stop().fadeOut(function(){$(this).remove();});}else if(this.$tip){this.tip().remove();}
this.hoverState=null;},setTitle:function(title){title=(title==null)?"":(""+title);this.$element.attr('original-title',title).removeAttr('title');},getTitle:function(){var title,$e=this.$element,o=this.options;fixTitle($e);if(typeof o.title==='string'){title=$e.attr(o.title=='title'?'original-title':o.title);}else if(typeof o.title==='function'){title=o.title.call($e[0]);}
title=(''+title).replace(/(^\s*|\s*$)/,"");return title||o.fallback;},tip:function(){if(!this.$tip){this.$tip=$('<div class="tipsy"></div>');if(this.options.arrowVisible){this.$tip.html('<div class="tipsy-arrow"></div><div class="tipsy-inner"/></div>');}else{this.$tip.html('<div class="tipsy-inner"/></div>');}
this.$tip.remove();}
return this.$tip;},validate:function(){var parent=this.$element[0].parentNode;if(!parent||(parent.nodeType===11)){this.hide();this.$element=null;this.options=null;}},enable:function(){this.enabled=true;},disable:function(){this.enabled=false;},toggleEnabled:function(){this.enabled=!this.enabled;}};$.fn.tipsy=function(options,arg){if(options===true){return this.data('tipsy');}else if(typeof options==='string'){return this.data('tipsy')[options](arg);}
options=$.extend({},$.fn.tipsy.defaults,options);if(options.arrowVisible==null){options.arrowVisible=!options.useCorners;}
function get(ele){var tipsy=$.data(ele,'tipsy');if(!tipsy){tipsy=new Tipsy(ele,$.fn.tipsy.elementOptions(ele,options));$.data(ele,'tipsy',tipsy);}
return tipsy;}
function enter(){get(this).enter();}
function leave(){get(this).leave();}
if(!options.live)this.each(function(){get(this);});if(options.trigger!='manual'){var binder=options.live?'live':'bind',eventIn=options.trigger=='hover'?'mouseenter':'focus',eventOut=options.trigger=='hover'?'mouseleave':'blur';this[binder](eventIn,enter)
[binder](eventOut,leave);}
return this;};$.fn.tipsy.defaults={delayIn:0,delayOut:0,fade:false,fallback:'',gravity:'n',html:false,live:false,offset:0,opacity:0.8,title:'title',trigger:'hover',useCorners:false,arrowVisible:null};$.fn.tipsy.elementOptions=function(ele,options){return $.metadata?$.extend({},options,$(ele).metadata()):options;};$.fn.tipsy.autoNS=function(){return $(this).offset().top>($(document).scrollTop()+$(window).height()/2)?'s':'n';};$.fn.tipsy.autoWE=function(){return $(this).offset().left>($(document).scrollLeft()+$(window).width()/2)?'e':'w';};})(jQuery);if(!Array.prototype.map)Array.prototype.map=function(f,o){var n=this.length;var result=new Array(n);for(var i=0;i<n;i++){if(i in this){result[i]=f.call(o,this[i],i,this);}}
return result;};if(!Array.prototype.filter)Array.prototype.filter=function(f,o){var n=this.length;var result=new Array();for(var i=0;i<n;i++){if(i in this){var v=this[i];if(f.call(o,v,i,this))result.push(v);}}
return result;};if(!Array.prototype.forEach)Array.prototype.forEach=function(f,o){var n=this.length>>>0;for(var i=0;i<n;i++){if(i in this)f.call(o,this[i],i,this);}};if(!Array.prototype.reduce)Array.prototype.reduce=function(f,v){var len=this.length;if(!len&&(arguments.length==1)){throw new Error("reduce: empty array, no initial value");}
var i=0;if(arguments.length<2){while(true){if(i in this){v=this[i++];break;}
if(++i>=len){throw new Error("reduce: no values, no initial value");}}}
for(;i<len;i++){if(i in this){v=f(v,this[i],i,this);}}
return v;};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(s,from){var n=this.length>>>0,i=(!isFinite(from)||from<0)?0:(from>this.length)?this.length:from;for(;i<n;i++){if(this[i]===s){return i;}}
return-1;};var pv={};pv.version={major:3,minor:3};pv.identity=function(x){return x;};pv.index=function(){return this.index;};pv.child=function(){return this.childIndex;};pv.parent=function(){return this.parent.index;};(function(){pv.extend=Object.create?function(f){return Object.create(f.prototype||f);}:function(f){function g(){}
g.prototype=f.prototype||f;return new g();};pv.extendType=function(g,f){var sub=g.prototype=pv.extend(f);sub.constructor=g;return g;};pv.parse=function(js){var re=new RegExp("function\\s*(\\b\\w+)?\\s*\\([^)]*\\)\\s*","mg"),m,d,i=0,s="";while(m=re.exec(js)){var j=m.index+m[0].length;if(js.charAt(j)!='{'){s+=js.substring(i,j)+"{return ";i=j;for(var p=0;p>=0&&j<js.length;j++){var c=js.charAt(j);switch(c){case'"':case'\'':{while(++j<js.length&&(d=js.charAt(j))!=c){if(d=='\\')j++;}
break;}
case'[':case'(':p++;break;case']':case')':p--;break;case';':case',':if(p==0)p--;break;}}
s+=pv.parse(js.substring(i,--j))+";}";i=j;}
re.lastIndex=j;}
s+=js.substring(i);return s;};pv.error=function(e){(typeof console==="undefined"||!console.error)?alert(e):console.error(e);};pv.listen=function(target,type,listener){listener=pv.listener(listener);if(type==='load'||type==='onload'){return pv.listenForPageLoad(listener);}
if(target.addEventListener){target.addEventListener(type,listener,false);}else{if(target===window){target=document.documentElement;}
target.attachEvent('on'+type,listener);}
return listener;};pv.unlisten=function(target,type,listener){if(listener.$listener){listener=listener.$listener;}
target.removeEventListener?target.removeEventListener(type,listener,false):target.detachEvent('on'+type,listener);};pv.listener=function(f){return f.$listener||(f.$listener=function(ev){try{pv.event=ev=pv.fixEvent(ev);return f.call(this,ev);}catch(ex){pv.error(ex);}finally{delete pv.event;}});};pv.fixEvent=function(ev){if(ev.pageX==null&&ev.clientX!=null){var eventDoc=(ev.target&&ev.target.ownerDocument)||document;var doc=eventDoc.documentElement;var body=eventDoc.body;ev.pageX=(ev.clientX*1)+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);ev.pageY=(ev.clientY*1)+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0);}
return ev;};pv.ancestor=function(a,e){while(e){if(e==a)return true;e=e.parentNode;}
return false;};pv.getWindow=function(elem){return(elem!=null&&elem==elem.window)?elem:elem.nodeType===9?elem.defaultView||elem.parentWindow:false;};var _reHiphenSep=/\-([a-z])/g;pv.hiphen2camel=function(prop){if(_reHiphenSep.test(prop)){return prop.replace(_reHiphenSep,function($0,$1){return $1.toUpperCase();});}
return prop;};var _getCompStyle=window.getComputedStyle;pv.css=function(e,p){return _getCompStyle?_getCompStyle.call(window,e,null).getPropertyValue(p):e.currentStyle[p==='float'?'styleFloat':pv.hiphen2camel(p)];};pv.cssStyle=function(e){var style;if(_getCompStyle){style=_getCompStyle.call(window,e,null);return function(p){return style.getPropertyValue(p);};}
style=e.currentStyle;return function(p){return style[p==='float'?'styleFloat':pv.hiphen2camel(p)];};};pv._getElementsByClass=function(searchClass,node){if(node==null){node=document;}
var classElements=[],els=node.getElementsByTagName("*"),L=els.length,pattern=new RegExp("(^|\\s)"+searchClass+"(\\s|$)"),i,j;for(i=0,j=0;i<L;i++){if(pattern.test(els[i].className)){classElements[j]=els[i];j++;}}
return classElements;};pv.getElementsByClassName=function(node,classname){return node.getElementsByClassName?node.getElementsByClassName(classname):pv._getElementsByClass(classname,node);};pv.elementOffset=function(elem){var docElem,body,win,clientTop,clientLeft,scrollTop,scrollLeft,box={top:0,left:0},doc=elem&&elem.ownerDocument;if(!doc){return;}
body=doc.body;if(body===elem){return;}
docElem=doc.documentElement;if(typeof elem.getBoundingClientRect!=="undefined"){box=elem.getBoundingClientRect();}
win=pv.getWindow(doc);clientTop=docElem.clientTop||body.clientTop||0;clientLeft=docElem.clientLeft||body.clientLeft||0;scrollTop=win.pageYOffset||docElem.scrollTop;scrollLeft=win.pageXOffset||docElem.scrollLeft;return{top:box.top+scrollTop-clientTop,left:box.left+scrollLeft-clientLeft};};pv.listenForPageLoad=function(listener){if(document.readyState==="complete"){listener();}
if(pv.renderer()==="svgweb"){window.addEventListener("SVGLoad",listener,false);}else{if(document.addEventListener){window.addEventListener("load",listener,false);}else if(document.attachEvent){window.attachEvent("onload",listener);}}};pv.renderer=function(){var renderer=(typeof document.svgImplementation!=="undefined")?document.svgImplementation:(typeof window.svgweb==="undefined")?"nativesvg":"svgweb";pv.renderer=function(){return renderer;};return renderer;};pv.id=function(){var id=1;return function(){return id++;};}();pv.functor=function(v){return typeof v=="function"?v:function(){return v;};};pv.get=function(o,p,dv){var v;return o&&(v=o[p])!=null?v:dv;};}());if(pv.renderer()!=="batik"){pv.listen(window,"load",function(){pv.$={i:0,x:document.getElementsByTagName("script")};pv.$.xlen=pv.$.x.length;for(;pv.$.i<pv.$.xlen;pv.$.i++){pv.$.s=pv.$.x[pv.$.i];if(pv.$.s.type=="text/javascript+protovis"){try{window.eval(pv.parse(pv.$.s.text));}catch(e){pv.error(e);}}}
delete pv.$;});}
pv.Format={};pv.Format.re=function(s){return s.replace(/[\\\^\$\*\+\?\[\]\(\)\.\{\}]/g,"\\$&");};pv.Format.pad=function(c,n,s){var m=n-String(s).length;return(m<1)?s:new Array(m+1).join(c)+s;};pv.Format.date=function(pattern){var pad=pv.Format.pad;function format(d){return pattern.replace(/%[a-zA-Z0-9]/g,function(s){switch(s){case'%a':return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][d.getDay()];case'%A':return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][d.getDay()];case'%h':case'%b':return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][d.getMonth()];case'%B':return["January","February","March","April","May","June","July","August","September","October","November","December"][d.getMonth()];case'%c':return d.toLocaleString();case'%C':return pad("0",2,Math.floor(d.getFullYear()/100)%100);case'%d':return pad("0",2,d.getDate());case'%x':case'%D':return pad("0",2,d.getMonth()+1)
+"/"+pad("0",2,d.getDate())
+"/"+pad("0",2,d.getFullYear()%100);case'%e':return pad(" ",2,d.getDate());case'%H':return pad("0",2,d.getHours());case'%I':{var h=d.getHours()%12;return h?pad("0",2,h):12;}
case'%m':return pad("0",2,d.getMonth()+1);case'%M':return pad("0",2,d.getMinutes());case'%n':return"\n";case'%p':return d.getHours()<12?"AM":"PM";case'%T':case'%X':case'%r':{var h=d.getHours()%12;return(h?pad("0",2,h):12)
+":"+pad("0",2,d.getMinutes())
+":"+pad("0",2,d.getSeconds())
+" "+(d.getHours()<12?"AM":"PM");}
case'%R':return pad("0",2,d.getHours())+":"+pad("0",2,d.getMinutes());case'%S':return pad("0",2,d.getSeconds());case'%Q':return pad("0",3,d.getMilliseconds());case'%t':return"\t";case'%u':{var w=d.getDay();return w?w:1;}
case'%w':return d.getDay();case'%y':return pad("0",2,d.getFullYear()%100);case'%Y':return d.getFullYear();case'%%':return"%";}
return s;});}
format.format=format;format.parse=function(s){var year=1970,month=0,date=1,hour=0,minute=0,second=0;var fields=[function(){}];var re=pv.Format.re(pattern).replace(/%[a-zA-Z0-9]/g,function(s){switch(s){case'%b':{fields.push(function(x){month={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}[x];});return"([A-Za-z]+)";}
case'%h':case'%B':{fields.push(function(x){month={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11}[x];});return"([A-Za-z]+)";}
case'%e':case'%d':{fields.push(function(x){date=x;});return"([0-9]+)";}
case'%I':case'%H':{fields.push(function(x){hour=x;});return"([0-9]+)";}
case'%m':{fields.push(function(x){month=x-1;});return"([0-9]+)";}
case'%M':{fields.push(function(x){minute=x;});return"([0-9]+)";}
case'%p':{fields.push(function(x){if(hour==12){if(x=="am")hour=0;}else if(x=="pm"){hour=Number(hour)+12;}});return"(am|pm)";}
case'%S':{fields.push(function(x){second=x;});return"([0-9]+)";}
case'%y':{fields.push(function(x){x=Number(x);year=x+(((0<=x)&&(x<69))?2000:(((x>=69)&&(x<100)?1900:0)));});return"([0-9]+)";}
case'%Y':{fields.push(function(x){year=x;});return"([0-9]+)";}
case'%%':{fields.push(function(){});return"%";}}
return s;});var match=s.match(re);if(match)match.forEach(function(m,i){fields[i](m);});return new Date(year,month,date,hour,minute,second);};return format;};pv.Format.time=function(type){var pad=pv.Format.pad;function format(t){t=Number(t);switch(type){case"short":{if(t>=31536e6){return(t/31536e6).toFixed(1)+" years";}else if(t>=6048e5){return(t/6048e5).toFixed(1)+" weeks";}else if(t>=864e5){return(t/864e5).toFixed(1)+" days";}else if(t>=36e5){return(t/36e5).toFixed(1)+" hours";}else if(t>=6e4){return(t/6e4).toFixed(1)+" minutes";}
return(t/1e3).toFixed(1)+" seconds";}
case"long":{var a=[],s=((t%6e4)/1e3)>>0,m=((t%36e5)/6e4)>>0;a.push(pad("0",2,s));if(t>=36e5){var h=((t%864e5)/36e5)>>0;a.push(pad("0",2,m));if(t>=864e5){a.push(pad("0",2,h));a.push(Math.floor(t/864e5).toFixed());}else{a.push(h.toFixed());}}else{a.push(m.toFixed());}
return a.reverse().join(":");}}}
format.format=format;format.parse=function(s){switch(type){case"short":{var re=/([0-9,.]+)\s*([a-z]+)/g,a,t=0;while(a=re.exec(s)){var f=parseFloat(a[0].replace(",","")),u=0;switch(a[2].toLowerCase()){case"year":case"years":u=31536e6;break;case"week":case"weeks":u=6048e5;break;case"day":case"days":u=864e5;break;case"hour":case"hours":u=36e5;break;case"minute":case"minutes":u=6e4;break;case"second":case"seconds":u=1e3;break;}
t+=f*u;}
return t;}
case"long":{var a=s.replace(",","").split(":").reverse(),t=0;if(a.length)t+=parseFloat(a[0])*1e3;if(a.length>1)t+=parseFloat(a[1])*6e4;if(a.length>2)t+=parseFloat(a[2])*36e5;if(a.length>3)t+=parseFloat(a[3])*864e5;return t;}}}
return format;};pv.Format.number=function(){var mini=0,maxi=Infinity,mins=0,minf=0,maxf=0,maxk=1,padi="0",padf="0",padg=true,decimal=".",group=",",np="\u2212",ns="";function format(x){if(Infinity>maxf)x=Math.round(x*maxk)/maxk;var s=String(Math.abs(x)).split(".");var i=s[0];if(i.length>maxi)i=i.substring(i.length-maxi);if(padg&&(i.length<mini))i=new Array(mini-i.length+1).join(padi)+i;if(i.length>3)i=i.replace(/\B(?=(?:\d{3})+(?!\d))/g,group);if(!padg&&(i.length<mins))i=new Array(mins-i.length+1).join(padi)+i;s[0]=x<0?np+i+ns:i;var f=s[1]||"";if(f.length>maxf){f=s[1]=f.substr(0,maxf);}
if(f.length<minf)s[1]=f+new Array(minf-f.length+1).join(padf);return s.join(decimal);}
format.format=format;format.parse=function(x){var re=pv.Format.re;var s=String(x).split(decimal);if(s.length==1)
s[1]="";s[0].replace(new RegExp("^("+re(padi)+")*"),"");s[1].replace(new RegExp("("+re(padf)+")*$"),"")
var i=s[0].replace(new RegExp(re(group),"g"),"");if(i.length>maxi)i=i.substring(i.length-maxi);var f=s[1]?Number("0."+s[1]):0;if(Infinity>maxf)f=Math.round(f*maxk)/maxk;return Math.round(i)+f;};format.integerDigits=function(min,max){if(arguments.length){mini=Number(min);maxi=(arguments.length>1)?Number(max):mini;mins=mini+Math.floor(mini/3)*group.length;return this;}
return[mini,maxi];};format.fractionDigits=function(min,max){if(arguments.length){minf=Number(min);maxf=(arguments.length>1)?Number(max):minf;maxk=Math.pow(10,maxf);return this;}
return[minf,maxf];};format.integerPad=function(x){if(arguments.length){padi=String(x);padg=/\d/.test(padi);return this;}
return padi;};format.fractionPad=function(x){if(arguments.length){padf=String(x);return this;}
return padf;};format.decimal=function(x){if(arguments.length){decimal=String(x);return this;}
return decimal;};format.group=function(x){if(arguments.length){group=x?String(x):"";mins=mini+Math.floor(mini/3)*group.length;return this;}
return group;};format.negativeAffix=function(x,y){if(arguments.length){np=String(x||"");ns=String(y||"");return this;}
return[np,ns];};return format;};(function(){var _cache;pv.Text={};pv.Text.createCache=function(){return new FontSizeCache();};pv.Text.usingCache=function(cache,fun,ctx){if(!(cache instanceof FontSizeCache)){throw new Error("Not a valid cache.");}
var prevCache=_cache;_cache=cache;try{return fun.call(ctx);}finally{_cache=prevCache;}};pv.Text.measure=function(text,font){if(text==null){text="";}else{text=""+text;}
var bbox=_cache&&_cache.get(font,text);if(!bbox){if(!text){bbox={width:0,height:0};}else{bbox=this.measureCore(text,font);}
if(_cache){_cache.put(font,text,bbox);}}
return bbox;};pv.Text.fontHeight=function(font){return pv.Text.measure('M',font).height;};pv.Text.measureCore=(function(){var _svgText,_lastFont='10px sans-serif';function getTextSizeElement(){return _svgText||(_svgText=createTextSizeElement());}
function createTextSizeElement(){var div=document.createElement('div');div.id='pvSVGText_'+new Date().getTime();var style=div.style;style.position='absolute';style.visibility='hidden';style.width=0;style.height=0;style.left=0;style.top=0;var svgElem=pv.SvgScene.create('svg');svgElem.setAttribute('font-size','10px');svgElem.setAttribute('font-family','sans-serif');div.appendChild(svgElem);var svgText=pv.SvgScene.create('text');svgElem.appendChild(svgText);var textNode;if(pv.renderer()==="svgweb"){textNode=document.createTextNode('',true);}else{textNode=document.createTextNode('');}
svgText.appendChild(textNode);document.body.appendChild(div);return svgText;}
return function(text,font){if(!font){font=null;}
var svgText=getTextSizeElement();if(_lastFont!==font){_lastFont=font;pv.SvgScene.setStyle(svgText,{'font':font});}
svgText.firstChild.nodeValue=''+text;var box;try{box=svgText.getBBox();}catch(ex){if(typeof console.error==='function'){console.error("GetBBox failed: ",ex);}
throw ex;}
return{width:box.width,height:box.height};};}());var FontSizeCache=function(){this._fontsCache={};};var hasOwnProp=Object.prototype.hasOwnProperty;FontSizeCache.prototype._getFont=function(font){font=font||'';return hasOwnProp.call(this._fontsCache,font)?this._fontsCache[font]:(this._fontsCache[font]={});};FontSizeCache.prototype.get=function(font,text){text=text||'';var fontCache=this._getFont(font);return hasOwnProp.call(fontCache,text)?fontCache[text]:null;};FontSizeCache.prototype.put=function(font,text,size){return this._getFont(font)[text||'']=size;};}());pv.map=function(array,f){var o={};return f?array.map(function(d,i){o.index=i;return f.call(o,d);}):array.slice();};pv.repeat=function(array,n){if(arguments.length==1)n=2;return pv.blend(pv.range(n).map(function(){return array;}));};pv.array=function(len,dv){var a=len>=0?new Array(len):[];if(dv!==undefined){for(var i=0;i<len;i++){a[i]=dv;}}
return a;};pv.cross=function(a,b){var array=[];for(var i=0,n=a.length,m=b.length;i<n;i++){for(var j=0,x=a[i];j<m;j++){array.push([x,b[j]]);}}
return array;};pv.blend=function(arrays){return Array.prototype.concat.apply([],arrays);};pv.transpose=function(arrays){var n=arrays.length,m=pv.max(arrays,function(d){return d.length;});if(m>n){arrays.length=m;for(var i=n;i<m;i++){arrays[i]=new Array(n);}
for(var i=0;i<n;i++){for(var j=i+1;j<m;j++){var t=arrays[i][j];arrays[i][j]=arrays[j][i];arrays[j][i]=t;}}}else{for(var i=0;i<m;i++){arrays[i].length=n;}
for(var i=0;i<n;i++){for(var j=0;j<i;j++){var t=arrays[i][j];arrays[i][j]=arrays[j][i];arrays[j][i]=t;}}}
arrays.length=m;for(var i=0;i<m;i++){arrays[i].length=n;}
return arrays;};pv.normalize=function(array,f){var norm=pv.map(array,f),sum=pv.sum(norm);for(var i=0;i<norm.length;i++)norm[i]/=sum;return norm;};pv.permute=function(array,indexes,f){if(!f)f=pv.identity;var p=new Array(indexes.length),o={};indexes.forEach(function(j,i){o.index=j;p[i]=f.call(o,array[j]);});return p;};pv.numerate=function(keys,f){if(!f)f=pv.identity;var map={},o={};keys.forEach(function(x,i){o.index=i;map[f.call(o,x)]=i;});return map;};pv.uniq=function(array,f){if(!f)f=pv.identity;var map={},keys=[],o={},y;array.forEach(function(x,i){o.index=i;y=f.call(o,x);if(!(y in map))map[y]=keys.push(y);});return keys;};pv.naturalOrder=function(a,b){return(a<b)?-1:((a>b)?1:0);};pv.reverseOrder=function(b,a){return(a<b)?-1:((a>b)?1:0);};pv.search=function(array,value,f){if(!f)f=pv.identity;var low=0,high=array.length-1;while(low<=high){var mid=(low+high)>>1,midValue=f(array[mid]);if(midValue<value)low=mid+1;else if(midValue>value)high=mid-1;else return mid;}
return-low-1;};pv.search.index=function(array,value,f){var i=pv.search(array,value,f);return(i<0)?(-i-1):i;};pv.range=function(start,stop,step){if(arguments.length==1){stop=start;start=0;}
if(step==undefined)step=1;if((stop-start)/step==Infinity)throw new Error("range must be finite");var array=[],i=0,j;stop-=(stop-start)*1e-10;if(step<0){while((j=start+step*i++)>stop){array.push(j);}}else{while((j=start+step*i++)<stop){array.push(j);}}
return array;};pv.random=function(start,stop,step){if(arguments.length==1){stop=start;start=0;}
if(step==undefined)step=1;return step?(Math.floor(Math.random()*(stop-start)/step)*step+start):(Math.random()*(stop-start)+start);};pv.sum=function(array,f){var o={};return array.reduce(f?function(p,d,i){o.index=i;return p+f.call(o,d);}:function(p,d){return p+d;},0);};pv.max=function(array,f){if(f==pv.index)return array.length-1;return Math.max.apply(null,f?pv.map(array,f):array);};pv.max.index=function(array,f){if(!array.length)return-1;if(f==pv.index)return array.length-1;if(!f)f=pv.identity;var maxi=0,maxx=-Infinity,o={};for(var i=0;i<array.length;i++){o.index=i;var x=f.call(o,array[i]);if(x>maxx){maxx=x;maxi=i;}}
return maxi;};pv.min=function(array,f){if(f==pv.index)return 0;return Math.min.apply(null,f?pv.map(array,f):array);};pv.min.index=function(array,f){if(!array.length)return-1;if(f==pv.index)return 0;if(!f)f=pv.identity;var mini=0,minx=Infinity,o={};for(var i=0;i<array.length;i++){o.index=i;var x=f.call(o,array[i]);if(x<minx){minx=x;mini=i;}}
return mini;};pv.mean=function(array,f){return pv.sum(array,f)/array.length;};pv.median=function(array,f){if(f==pv.index)return(array.length-1)/2;array=pv.map(array,f).sort(pv.naturalOrder);if(array.length%2)return array[Math.floor(array.length/2)];var i=array.length/2;return(array[i-1]+array[i])/2;};pv.variance=function(array,f){if(array.length<1)return NaN;if(array.length==1)return 0;var mean=pv.mean(array,f),sum=0,o={};if(!f)f=pv.identity;for(var i=0;i<array.length;i++){o.index=i;var d=f.call(o,array[i])-mean;sum+=d*d;}
return sum;};pv.deviation=function(array,f){return Math.sqrt(pv.variance(array,f)/(array.length-1));};pv.log=function(x,b){return Math.log(x)/Math.log(b);};pv.logSymmetric=function(x,b){return(x==0)?0:((x<0)?-pv.log(-x,b):pv.log(x,b));};pv.logAdjusted=function(x,b){if(!isFinite(x))return x;var negative=x<0;if(x<b)x+=(b-x)/b;return negative?-pv.log(x,b):pv.log(x,b);};pv.logFloor=function(x,b){return(x>0)?Math.pow(b,Math.floor(pv.log(x,b))):-Math.pow(b,-Math.floor(-pv.log(-x,b)));};pv.logCeil=function(x,b){return(x>0)?Math.pow(b,Math.ceil(pv.log(x,b))):-Math.pow(b,-Math.ceil(-pv.log(-x,b)));};(function(){var radians=Math.PI/180,degrees=180/Math.PI;pv.radians=function(degrees){return radians*degrees;};pv.degrees=function(radians){return degrees*radians;};})();pv.keys=function(map){var array=[];for(var key in map){array.push(key);}
return array;};pv.entries=function(map){var array=[];for(var key in map){array.push({key:key,value:map[key]});}
return array;};pv.values=function(map){var array=[];for(var key in map){array.push(map[key]);}
return array;};pv.dict=function(keys,f){var m={},o={};for(var i=0;i<keys.length;i++){if(i in keys){var k=keys[i];o.index=i;m[k]=f.call(o,k);}}
return m;};pv.hasOwnProp=Object.prototype.hasOwnProperty;pv.copyOwn=function(a,b){if(b){var hop=pv.hasOwnProp;for(var p in b){if(hop.call(b,p)){a[p]=b[p];}}}
return a;};pv.dom=function(map){return new pv.Dom(map);};pv.Dom=function(map){this.$map=map;};pv.Dom.prototype.$leaf=function(n){return typeof n!="object";};pv.Dom.prototype.leaf=function(f){if(arguments.length){this.$leaf=f;return this;}
return this.$leaf;};pv.Dom.prototype.root=function(nodeName){var leaf=this.$leaf,root=recurse(this.$map);function recurse(map){var n=new pv.Dom.Node();for(var k in map){var v=map[k];n.appendChild(leaf(v)?new pv.Dom.Node(v):recurse(v)).nodeName=k;}
return n;}
root.nodeName=nodeName;return root;};pv.Dom.prototype.nodes=function(){return this.root().nodes();};pv.Dom.Node=function(value){if(value!==undefined){this.nodeValue=value;}
this.childNodes=[];};pv.Dom.Node.prototype.nodeValue=undefined;pv.Dom.Node.prototype.parentNode=null;pv.Dom.Node.prototype.firstChild=null;pv.Dom.Node.prototype.lastChild=null;pv.Dom.Node.prototype.previousSibling=null;pv.Dom.Node.prototype.nextSibling=null;pv.Dom.Node.prototype._firstDirtyChildIndex=Infinity;pv.Dom.Node.prototype.removeChild=function(n){var i=this.childNodes.indexOf(n);if(i===-1)throw new Error("child not found");return this.removeAt(i);};pv.Dom.Node.prototype.appendChild=function(n){var pn=n.parentNode;if(pn)pn.removeChild(n);var lc=this.lastChild;n.parentNode=this;n.previousSibling=lc;if(lc){lc.nextSibling=n;n._childIndex=lc._childIndex+1;}else{this.firstChild=n;n._childIndex=0;}
this.lastChild=n;this.childNodes.push(n);return n;};pv.Dom.Node.prototype.insertBefore=function(n,r){if(!r)return this.appendChild(n);var ns=this.childNodes;var i=ns.indexOf(r);if(i===-1)throw new Error("child not found");return this.insertAt(n,i);};pv.Dom.Node.prototype.insertAt=function(n,i){if(i==null){return this.appendChild(n);}
var ns=this.childNodes;var L=ns.length;if(i===L){return this.appendChild(n);}
if(i>L){throw new Error("Index out of range.");}
var pn=n.parentNode;if(pn){pn.removeChild(n);}
var ni=i+1;var firstDirtyIndex=this._firstDirtyChildIndex;if(ni<firstDirtyIndex){this._firstDirtyChildIndex=ni;}
var r=ns[i];n.parentNode=this;n.nextSibling=r;n._childIndex=i;var psib=n.previousSibling=r.previousSibling;r.previousSibling=n;if(psib){psib.nextSibling=n;}else{if(r===this.lastChild){this.lastChild=n;}
this.firstChild=n;}
this.childNodes.splice(i,0,n);return n;};pv.Dom.Node.prototype.removeAt=function(i){var ns=this.childNodes;var n=ns[i];if(n){ns.splice(i,1);if(i<ns.length){var firstDirtyIndex=this._firstDirtyChildIndex;if(i<firstDirtyIndex){this._firstDirtyChildIndex=i;}}
var psib=n.previousSibling;var nsib=n.nextSibling;if(psib){psib.nextSibling=nsib;}else{this.firstChild=nsib;}
if(nsib){nsib.previousSibling=psib;}else{this.lastChild=psib;}
n.nextSibling=null;n.previousSibling=null;n.parentNode=null;}
return n;};pv.Dom.Node.prototype.replaceChild=function(n,r){var ns=this.childNodes;var i=ns.indexOf(r);if(i===-1)throw new Error("child not found");var pn=n.parentNode;if(pn)pn.removeChild(n);n.parentNode=this;n.nextSibling=r.nextSibling;n._childIndex=r._childIndex;var psib=n.previousSibling=r.previousSibling;if(psib)psib.nextSibling=n;else this.firstChild=n;var nsib=r.nextSibling;if(nsib)nsib.previousSibling=n;else this.lastChild=n;ns[i]=n;return r;};pv.Dom.Node.prototype.childIndex=function(){var p=this.parentNode;if(p){var i=p._firstDirtyChildIndex;if(i<Infinity){var ns=p.childNodes;if(i<ns.length){for(var c=ns[i];c;c=c.nextSibling){c._childIndex=i++;}}
p._firstDirtyChildIndex=Infinity;}
return this._childIndex;}
return-1;};pv.Dom.Node.prototype.visitBefore=function(f){function visit(n,i){f(n,i);for(var c=n.firstChild;c;c=c.nextSibling){visit(c,i+1);}}
visit(this,0);};pv.Dom.Node.prototype.visitAfter=function(f){function visit(n,i){for(var c=n.firstChild;c;c=c.nextSibling){visit(c,i+1);}
f(n,i);}
visit(this,0);};pv.Dom.Node.prototype.sort=function(f){if(this.firstChild){this._firstDirtyChildIndex=Infinity;this.childNodes.sort(f);var p=this.firstChild=this.childNodes[0],c;delete p.previousSibling;p._childIndex=0;for(var i=1;i<this.childNodes.length;i++){p.sort(f);c=this.childNodes[i];c._childIndex=i;c.previousSibling=p;p=p.nextSibling=c;}
this.lastChild=p;delete p.nextSibling;p.sort(f);}
return this;};pv.Dom.Node.prototype.reverse=function(){var childNodes=[];this.visitAfter(function(n){this._firstDirtyChildIndex=Infinity;while(n.lastChild)childNodes.push(n.removeChild(n.lastChild));for(var c;c=childNodes.pop();)n.insertBefore(c,n.firstChild);});return this;};pv.Dom.Node.prototype.nodes=function(){var array=[];function flatten(node){array.push(node);node.childNodes.forEach(flatten);}
flatten(this,array);return array;};pv.Dom.Node.prototype.toggle=function(recursive){if(recursive)return this.toggled?this.visitBefore(function(n){if(n.toggled)n.toggle();}):this.visitAfter(function(n){if(!n.toggled)n.toggle();});var n=this;if(n.toggled){for(var c;c=n.toggled.pop();)n.appendChild(c);delete n.toggled;}else if(n.lastChild){n.toggled=[];while(n.lastChild)n.toggled.push(n.removeChild(n.lastChild));}};pv.nodes=function(values){var root=new pv.Dom.Node();for(var i=0;i<values.length;i++){root.appendChild(new pv.Dom.Node(values[i]));}
return root.nodes();};pv.tree=function(array){return new pv.Tree(array);};pv.Tree=function(array){this.array=array;};pv.Tree.prototype.keys=function(k){this.k=k;return this;};pv.Tree.prototype.value=function(v){this.v=v;return this;};pv.Tree.prototype.map=function(){var map={},o={};for(var i=0;i<this.array.length;i++){o.index=i;var value=this.array[i],keys=this.k.call(o,value),node=map;for(var j=0;j<keys.length-1;j++){node=node[keys[j]]||(node[keys[j]]={});}
node[keys[j]]=this.v?this.v.call(o,value):value;}
return map;};pv.nest=function(array){return new pv.Nest(array);};pv.Nest=function(array){this.array=array;this.keys=[];};pv.Nest.prototype.key=function(key){this.keys.push(key);return this;};pv.Nest.prototype.sortKeys=function(order){this.keys[this.keys.length-1].order=order||pv.naturalOrder;return this;};pv.Nest.prototype.sortValues=function(order){this.order=order||pv.naturalOrder;return this;};pv.Nest.prototype.map=function(){var map={},values=[];for(var i,j=0;j<this.array.length;j++){var x=this.array[j];var m=map;for(i=0;i<this.keys.length-1;i++){var k=this.keys[i](x);if(!m[k])m[k]={};m=m[k];}
k=this.keys[i](x);if(!m[k]){var a=[];values.push(a);m[k]=a;}
m[k].push(x);}
if(this.order){for(var i=0;i<values.length;i++){values[i].sort(this.order);}}
return map;};pv.Nest.prototype.entries=function(){function entries(map){var array=[];for(var k in map){var v=map[k];array.push({key:k,values:(v instanceof Array)?v:entries(v)});};return array;}
function sort(array,i){var o=this.keys[i].order;if(o)array.sort(function(a,b){return o(a.key,b.key);});if(++i<this.keys.length){for(var j=0;j<array.length;j++){sort.call(this,array[j].values,i);}}
return array;}
return sort.call(this,entries(this.map()),0);};pv.Nest.prototype.rollup=function(f){function rollup(map){for(var key in map){var value=map[key];if(value instanceof Array){map[key]=f(value);}else{rollup(value);}}
return map;}
return rollup(this.map());};pv.flatten=function(map){return new pv.Flatten(map);};pv.Flatten=function(map){this.map=map;this.keys=[];};pv.Flatten.prototype.key=function(key,f){this.keys.push({name:key,value:f});delete this.$leaf;return this;};pv.Flatten.prototype.leaf=function(f){this.keys.length=0;this.$leaf=f;return this;};pv.Flatten.prototype.array=function(){var entries=[],stack=[],keys=this.keys,leaf=this.$leaf;if(leaf){function recurse(value,i){if(leaf(value)){entries.push({keys:stack.slice(),value:value});}else{for(var key in value){stack.push(key);recurse(value[key],i+1);stack.pop();}}}
recurse(this.map,0);return entries;}
function visit(value,i){if(i<keys.length-1){for(var key in value){stack.push(key);visit(value[key],i+1);stack.pop();}}else{entries.push(stack.concat(value));}}
visit(this.map,0);return entries.map(function(stack){var m={};for(var i=0;i<keys.length;i++){var k=keys[i],v=stack[i];m[k.name]=k.value?k.value.call(null,v):v;}
return m;});};pv.Transform=function(){};pv.Transform.prototype={k:1,x:0,y:0};pv.Transform.identity=new pv.Transform();pv.Transform.prototype.translate=function(x,y){var v=new pv.Transform();v.k=this.k;v.x=this.k*x+this.x;v.y=this.k*y+this.y;return v;};pv.Transform.prototype.scale=function(k){var v=new pv.Transform();v.k=this.k*k;v.x=this.x;v.y=this.y;return v;};pv.Transform.prototype.invert=function(){var v=new pv.Transform(),k=1/this.k;v.k=k;v.x=-this.x*k;v.y=-this.y*k;return v;};pv.Transform.prototype.times=function(m){var v=new pv.Transform();v.k=this.k*m.k;v.x=this.k*m.x+this.x;v.y=this.k*m.y+this.y;return v;};pv.Scale=function(){};pv.Scale.interpolator=function(start,end){if(typeof start=="number"){return function(t){return t*(end-start)+start;};}
var startGradient=(start.type&&start.type!=='solid');var endGradient=(end.type&&end.type!=='solid');if(startGradient||endGradient){start=startGradient?start:pv.color(start).rgb();end=endGradient?end:pv.color(end).rgb();return function(t){return t<0.5?start:end;};}
start=pv.color(start).rgb();end=pv.color(end).rgb();return function(t){var a=start.a*(1-t)+end.a*t;if(a<1e-5)a=0;return(start.a==0)?pv.rgb(end.r,end.g,end.b,a):((end.a==0)?pv.rgb(start.r,start.g,start.b,a):pv.rgb(Math.round(start.r*(1-t)+end.r*t),Math.round(start.g*(1-t)+end.g*t),Math.round(start.b*(1-t)+end.b*t),a));};};pv.Scale.common={by:function(f){var scale=this;function by(){return scale(f.apply(this,arguments));}
for(var method in scale)by[method]=scale[method];return by;},by1:function(f){var scale=this;function by1(x){return scale(f.call(this,x));}
for(var method in scale)by1[method]=scale[method];return by1;},transform:function(t){var scale=this;function transfScale(){return t.call(this,scale.apply(scale,arguments));}
for(var method in scale)transfScale[method]=scale[method];return transfScale;}};pv.Scale.quantitative=function(){var d=[0,1],l=[0,1],r=[0,1],i=[pv.identity],type=Number,n=false,f=pv.identity,g=pv.identity,tickFormat=String,tickFormatter=null,dateTickFormat,dateTickPrecision,usedDateTickPrecision,usedNumberExponent;function newDate(x){return new Date(x);}
function scale(x){var j=pv.search(d,x);if(j<0)j=-j-2;j=Math.max(0,Math.min(i.length-1,j));return i[j]((f(x)-l[j])/(l[j+1]-l[j]));}
scale.transform=function(forward,inverse){f=function(x){return n?-forward(-x):forward(x);};g=function(y){return n?-inverse(-y):inverse(y);};l=d.map(f);return this;};scale.domain=function(array,min,max){if(arguments.length){var o;if(array instanceof Array){if(arguments.length<2)min=pv.identity;if(arguments.length<3)max=min;o=array.length&&min(array[0]);d=array.length?[pv.min(array,min),pv.max(array,max)]:[];}else{o=array;d=Array.prototype.slice.call(arguments).map(Number);}
if(!d.length)d=[-Infinity,Infinity];else if(d.length==1)d=[d[0],d[0]];n=(d[0]||d[d.length-1])<0;l=d.map(f);type=(o instanceof Date)?newDate:Number;return this;}
return d.map(type);};scale.range=function(){if(arguments.length){r=Array.prototype.slice.call(arguments);if(!r.length)r=[-Infinity,Infinity];else if(r.length==1)r=[r[0],r[0]];i=[];for(var j=0;j<r.length-1;j++){i.push(pv.Scale.interpolator(r[j],r[j+1]));}
return this;}
return r;};scale.invert=function(y){var j=pv.search(r,y);if(j<0)j=-j-2;j=Math.max(0,Math.min(i.length-1,j));return type(g(l[j]+(y-r[j])/(r[j+1]-r[j])*(l[j+1]-l[j])));};scale.ticks=function(m,options){var start=d[0],end=d[d.length-1],reverse=end<start,min=reverse?end:start,max=reverse?start:end,span=max-min;if(!span||!isFinite(span)){if(type==newDate)tickFormat=pv.Format.date("%x");return[type(min)];}
if(type==newDate){function floor(d,p){switch(p){case 31536e6:d.setMonth(0);case 2592e6:d.setDate(1);case 6048e5:if(p==6048e5)d.setDate(d.getDate()-d.getDay());case 864e5:d.setHours(0);case 36e5:d.setMinutes(0);case 6e4:d.setSeconds(0);case 1e3:d.setMilliseconds(0);}}
var nn=5;var precision,format,increment,step=1;if(span>=nn*31536e6){precision=31536e6;format="%Y";increment=function(d){d.setFullYear(d.getFullYear()+step);};}else if(span>=nn*2592e6){precision=2592e6;format="%m/%Y";increment=function(d){d.setMonth(d.getMonth()+step);};}else if(span>=nn*6048e5){precision=6048e5;format="%m/%d";increment=function(d){d.setDate(d.getDate()+7*step);};}else if(span>=nn*864e5){precision=864e5;format="%m/%d";increment=function(d){d.setDate(d.getDate()+step);};}else if(span>=nn*36e5){precision=36e5;format="%I:%M %p";increment=function(d){d.setHours(d.getHours()+step);};}else if(span>=nn*6e4){precision=6e4;format="%I:%M %p";increment=function(d){d.setMinutes(d.getMinutes()+step);};}else if(span>=nn*1e3){precision=1e3;format="%I:%M:%S";increment=function(d){d.setSeconds(d.getSeconds()+step);};}else{precision=1;format="%S.%Qs";increment=function(d){d.setTime(d.getTime()+step);};}
precision=dateTickPrecision?dateTickPrecision:precision;format=dateTickFormat?dateTickFormat:format;usedDateTickPrecision=precision;tickFormat=pv.Format.date(format);var date=new Date(min),dates=[];floor(date,precision);var n=span/precision;if(n>10){switch(precision){case 36e5:{step=(n>20)?6:3;date.setHours(Math.floor(date.getHours()/step)*step);break;}
case 2592e6:{step=(n>24)?3:((n>12)?2:1);date.setMonth(Math.floor(date.getMonth()/step)*step);break;}
case 6048e5:{step=(n>15)?3:(n>10?2:1);date.setDate(Math.floor(date.getDate()/(7*step))*(7*step));break;}
case 864e5:{step=(n>=30)?5:((n>=15)?3:2);date.setDate(Math.floor(date.getDate()/step)*step);break;}
case 6e4:{step=(n>30)?15:((n>15)?10:5);date.setMinutes(Math.floor(date.getMinutes()/step)*step);break;}
case 1e3:{step=(n>90)?15:((n>60)?10:5);date.setSeconds(Math.floor(date.getSeconds()/step)*step);break;}
case 1:{step=(n>1000)?250:((n>200)?100:((n>100)?50:((n>50)?25:5)));date.setMilliseconds(Math.floor(date.getMilliseconds()/step)*step);break;}
default:{step=pv.logCeil(n/15,10);if(n/step<2)step/=5;else if(n/step<5)step/=2;date.setFullYear(Math.floor(date.getFullYear()/step)*step);break;}}}
if(dateTickPrecision){step=1;increment=function(d){d.setSeconds(d.getSeconds()+step*dateTickPrecision/1000);};}
while(true){increment(date);if(date>max)break;dates.push(new Date(date));}
return reverse?dates.reverse():dates;}
if(m==null){m=10;}
var roundInside=pv.get(options,'roundInside',true);var exponentMin=pv.get(options,'numberExponentMin',-Infinity);var exponentMax=pv.get(options,'numberExponentMax',+Infinity);var exponent=Math.floor(pv.log(span/m,10));var overflow=false;if(exponent>exponentMax){exponent=exponentMax;overflow=true;}else if(exponent<exponentMin){exponent=exponentMin;overflow=true;}
step=Math.pow(10,exponent);var mObtained=(span/step);var err=m/mObtained;if(err<=.15&&exponent<exponentMax-1){step*=10;}else if(err<=.35){step*=5;}else if(err<=.75){step*=2;}
exponent=Math.floor(pv.log(step,10)+1e-10);start=step*Math[roundInside?'ceil':'floor'](min/step);end=step*Math[roundInside?'floor':'ceil'](max/step);usedNumberExponent=Math.max(0,-exponent);tickFormat=pv.Format.number().fractionDigits(usedNumberExponent);var ticks=pv.range(start,end+step,step);if(reverse){ticks.reverse();}
ticks.roundInside=roundInside;ticks.step=step;ticks.exponent=exponent;ticks.exponentOverflow=overflow;ticks.exponentMin=exponentMin;ticks.exponentMax=exponentMax;return ticks;};scale.dateTickFormat=function(){if(arguments.length){dateTickFormat=arguments[0];return this;}
return dateTickFormat;};scale.dateTickPrecision=function(){if(arguments.length){dateTickPrecision=arguments[0];return this;}
return dateTickPrecision;};scale.tickFormatter=function(f){if(arguments.length){tickFormatter=f;return this;}
return tickFormatter;};scale.tickFormat=function(t){var text;if(tickFormatter){text=tickFormatter(t,type!==Number?usedDateTickPrecision:usedNumberExponent);}else{text=tickFormat(t);}
return text==null?'':(''+text);};scale.nice=function(){if(d.length!=2)return this;var start=d[0],end=d[d.length-1],reverse=end<start,min=reverse?end:start,max=reverse?start:end,span=max-min;if(!span||!isFinite(span))return this;var step=Math.pow(10,Math.round(Math.log(span)/Math.log(10))-1);d=[Math.floor(min/step)*step,Math.ceil(max/step)*step];if(reverse)d.reverse();l=d.map(f);return this;};pv.copyOwn(scale,pv.Scale.common);scale.domain.apply(scale,arguments);return scale;};pv.Scale.linear=function(){var scale=pv.Scale.quantitative();scale.domain.apply(scale,arguments);return scale;};pv.Scale.log=function(){var scale=pv.Scale.quantitative(1,10),b,p,log=function(x){return Math.log(x)/p;},pow=function(y){return Math.pow(b,y);};scale.ticks=function(){var d=scale.domain(),n=d[0]<0,i=Math.floor(n?-log(-d[0]):log(d[0])),j=Math.ceil(n?-log(-d[1]):log(d[1])),ticks=[];if(n){ticks.push(-pow(-i));for(;i++<j;)for(var k=b-1;k>0;k--)ticks.push(-pow(-i)*k);}else{for(;i<j;i++)for(var k=1;k<b;k++)ticks.push(pow(i)*k);ticks.push(pow(i));}
for(i=0;ticks[i]<d[0];i++);for(j=ticks.length;ticks[j-1]>d[1];j--);return ticks.slice(i,j);};scale.tickFormat=function(t){return t.toPrecision(1);};scale.nice=function(){var d=scale.domain();return scale.domain(pv.logFloor(d[0],b),pv.logCeil(d[1],b));};scale.base=function(v){if(arguments.length){b=Number(v);p=Math.log(b);scale.transform(log,pow);return this;}
return b;};scale.domain.apply(scale,arguments);return scale.base(10);};pv.Scale.root=function(){var scale=pv.Scale.quantitative();scale.power=function(v){if(arguments.length){var b=Number(v),p=1/b;scale.transform(function(x){return Math.pow(x,p);},function(y){return Math.pow(y,b);});return this;}
return b;};scale.domain.apply(scale,arguments);return scale.power(2);};pv.Scale.ordinal=function(){var d=[],i={},r=[],band=0;function scale(x){if(!(x in i))i[x]=d.push(x)-1;return r[i[x]%r.length];}
scale.domain=function(array,f){if(arguments.length){array=(array instanceof Array)?((arguments.length>1)?pv.map(array,f):array):Array.prototype.slice.call(arguments);d=[];var seen={};for(var j=0;j<array.length;j++){var o=array[j];if(!(o in seen)){seen[o]=true;d.push(o);}}
i=pv.numerate(d);return this;}
return d;};scale.range=function(array,f){if(arguments.length){r=(array instanceof Array)?((arguments.length>1)?pv.map(array,f):array):Array.prototype.slice.call(arguments);if(typeof r[0]=="string")r=r.map(pv.fillStyle);r.min=r[0];r.max=r[r.length-1];return this;}
return r;};scale.split=function(min,max){var R=max-min;var N=this.domain().length;var step=0;if(R===0){r=pv.array(N,min);}else if(N){step=(max-min)/N;r=pv.range(min+step/2,max,step);}
r.min=min;r.max=max;r.step=step;return this;};scale.splitBandedCenter=function(min,max,band){scale.split(min,max);if(band==null){band=1;}
r.band=r.step*band;r.margin=r.step-r.band;r.min=min;r.max=max;return this;};scale.splitBandedFlushCenter=function(min,max,band){if(band==null){band=1;}
var R=(max-min),N=this.domain().length,S=0,B=0,M=0;if(R===0){r=pv.array(N,min);}else if(N){B=(R*band)/N;M=N>1?((R-N*B)/(N-1)):0;S=M+B;r=pv.range(min+B/2,max,S);}
r.step=S;r.band=B;r.margin=M;r.min=min;r.max=max;return this;};scale.splitFlush=function(min,max){var n=this.domain().length,step=(max-min)/(n-1);r=(n==1)?[(min+max)/2]:pv.range(min,max+step/2,step);r.min=min;r.max=max;return this;};scale.splitBanded=function(min,max,band){if(arguments.length<3)band=1;if(band<0){var n=this.domain().length,total=-band*n,remaining=max-min-total,padding=remaining/(n+1);r=pv.range(min+padding,max,padding-band);r.band=-band;}else{var step=(max-min)/(this.domain().length+(1-band));r=pv.range(min+step*(1-band),max,step);r.band=step*band;r.step=step;r.margin=step-r.band;}
r.min=min;r.max=max;return this;};scale.invertIndex=function(y,noRound){var N=this.domain().length;if(N===0){return-1;}
var r=this.range();var R=r.max-r.min;if(R===0){return 0;}
var S=R/N;if(y>=r.max){return N;}
if(y<r.min){return 0;}
var i=(y-r.min)/S;return noRound?i:Math.round(i);};pv.copyOwn(scale,pv.Scale.common);scale.domain.apply(scale,arguments);return scale;};pv.Scale.quantile=function(){var n=-1,j=-1,q=[],d=[],y=pv.Scale.linear();function scale(x){return y(Math.max(0,Math.min(j,pv.search.index(q,x)-1))/j);}
scale.quantiles=function(x){if(arguments.length){n=Number(x);if(n<0){q=[d[0]].concat(d);j=d.length-1;}else{q=[];q[0]=d[0];for(var i=1;i<=n;i++){q[i]=d[~~(i*(d.length-1)/n)];}
j=n-1;}
return this;}
return q;};scale.domain=function(array,f){if(arguments.length){d=(array instanceof Array)?pv.map(array,f):Array.prototype.slice.call(arguments);d.sort(pv.naturalOrder);scale.quantiles(n);return this;}
return d;};scale.range=function(){if(arguments.length){y.range.apply(y,arguments);return this;}
return y.range();};pv.copyOwn(scale,pv.Scale.common);scale.domain.apply(scale,arguments);return scale;};pv.histogram=function(data,f){var frequency=true;return{bins:function(ticks){var x=pv.map(data,f),bins=[];if(!arguments.length)ticks=pv.Scale.linear(x).ticks();for(var i=0;i<ticks.length-1;i++){var bin=bins[i]=[];bin.x=ticks[i];bin.dx=ticks[i+1]-ticks[i];bin.y=0;}
for(var i=0;i<x.length;i++){var j=pv.search.index(ticks,x[i])-1,bin=bins[Math.max(0,Math.min(bins.length-1,j))];bin.y++;bin.push(data[i]);}
if(!frequency)for(var i=0;i<bins.length;i++){bins[i].y/=x.length;}
return bins;},frequency:function(x){if(arguments.length){frequency=Boolean(x);return this;}
return frequency;}};};(function(){pv.Shape=function(){};var _k0={x:1,y:1};pv.Shape.dist2=function(v,w,k){k=k||_k0;var dx=v.x-w.x;var dy=v.y-w.y;var dx2=dx*dx;var dy2=dy*dy;return{cost:dx2+dy2,dist2:k.x*dx2+k.y*dy2};};var pi=Math.PI;var pi2=2*pi;var atan2=Math.atan2;pv.Shape.normalizeAngle=function(a){a=a%pi2;if(a<0){a+=pi2;}
return a;};pv.Shape.atan2Norm=function(dy,dx){var a=atan2(dy,dx);if(a<0){a+=pi2;}
return a;};pv.Shape.prototype.hasArea=function(){return true;};}());(function(){var dist2=pv.Shape.dist2;var cos=Math.cos;var sin=Math.sin;var sqrt=Math.sqrt;pv.vector=function(x,y){return new Point(x,y);};pv.Vector=function(x,y){this.x=x;this.y=y;};var Point=pv.Shape.Point=pv.Vector;pv.Vector.prototype=pv.extend(pv.Shape);pv.Vector.prototype.perp=function(){return new Point(-this.y,this.x);};pv.Vector.prototype.rotate=function(angle){var c=cos(angle);var s=sin(angle);return new Point(c*this.x-s*this.y,s*this.x+c*this.y);};pv.Vector.prototype.norm=function(){var l=this.length();return this.times(l?(1/l):1);};pv.Vector.prototype.length=function(){return sqrt(this.x*this.x+this.y*this.y);};pv.Vector.prototype.times=function(k){return new Point(this.x*k,this.y*k);};pv.Vector.prototype.plus=function(x,y){return(arguments.length==1)?new Point(this.x+x.x,this.y+x.y):new Point(this.x+x,this.y+y);};pv.Vector.prototype.minus=function(x,y){return(arguments.length==1)?new Point(this.x-x.x,this.y-x.y):new Point(this.x-x,this.y-y);};pv.Vector.prototype.dot=function(x,y){return(arguments.length==1)?this.x*x.x+this.y*x.y:this.x*x+this.y*y;};pv.Vector.prototype.hasArea=function(){return false;};pv.Vector.prototype.clone=function(){return new Point(this.x,this.y);};pv.Vector.prototype.apply=function(t){return new Point(t.x+(t.k*this.x),t.y+(t.k*this.y));};pv.Vector.prototype.intersectsRect=function(rect){return(this.x>=rect.x)&&(this.x<=rect.x2)&&(this.y>=rect.y)&&(this.y<=rect.y2);};pv.Vector.prototype.containsPoint=function(p){return(this.x===p.x)&&(this.y===p.y);};pv.Vector.prototype.points=function(){return[this];};pv.Vector.prototype.edges=function(){return[];};pv.Vector.prototype.center=function(){return this;};pv.Vector.prototype.distance2=function(p,k){return dist2(this,p,k);};}());(function(){var Point=pv.Shape.Point;var dist2=pv.Shape.dist2;pv.Shape.Line=function(x,y,x2,y2){this.x=x||0;this.y=y||0;this.x2=x2||0;this.y2=y2||0;};var Line=pv.Shape.Line;Line.prototype=pv.extend(pv.Shape);Line.prototype.hasArea=function(){return false;};Line.prototype.clone=function(){return new Line(this.x,this.y,this.x2,this.x2);};Line.prototype.apply=function(t){var x=t.x+(t.k*this.x);var y=t.y+(t.k*this.y);var x2=t.x+(t.k*this.x2);var y2=t.y+(t.k*this.y2);return new Line(x,y,x2,y2);};Line.prototype.points=function(){return[new Point(this.x,this.y),new Point(this.x2,this.y2)];};Line.prototype.edges=function(){return[this];};Line.prototype.center=function(){return new Point((this.x+this.x2)/2,(this.y+this.y2)/2);};Line.prototype.normal=function(at,shapeCenter){var points=this.points();var norm=points[1].minus(points[0]).perp().norm();if(shapeCenter){var outside=points[0].minus(shapeCenter);if(outside.dot(norm)<0){norm=norm.times(-1);}}
return norm;};Line.prototype.intersectsRect=function(rect){var i,L;var points=this.points();L=points.length;for(i=0;i<L;i++){if(points[i].intersectsRect(rect)){return true;}}
var edges=rect.edges();L=edges.length;for(i=0;i<L;i++){if(this.intersectsLine(edges[i])){return true;}}
return false;};Line.prototype.containsPoint=function(p){var x=this.x;var x2=this.x2;var y=this.y;var y2=this.y2;return x<=p.x&&p.x<=x2&&((x===x2)?(Math.min(y,y2)<=p.y&&p.y<=Math.max(y,y2)):(Math.abs((y2-y)/(x2-x)*(p.x-x)+y-p.y)<=1e-10));};Line.prototype.intersectsLine=function(b){var a=this,x21=a.x2-a.x,y21=a.y2-a.y,x43=b.x2-b.x,y43=b.y2-b.y,denom=y43*x21-x43*y21;if(denom===0){return false;}
var y13=a.y-b.y,x13=a.x-b.x,numa=(x43*y13-y43*x13),numb=(x21*y13-y21*x13);if(denom===0){return(numa===0)&&(numb===0);}
var ua=numa/denom;if(ua<0||ua>1){return false;}
var ub=numb/denom;if(ub<0||ub>1){return false;}
return true;};Line.prototype.distance2=function(p,k){var v=this;var w={x:this.x2,y:this.y2};var l2=dist2(v,w).dist2;if(l2<=1e-10){return dist2(p,v,k);}
var wvx=w.x-v.x;var wvy=w.y-v.y;var t=((p.x-v.x)*wvx+(p.y-v.y)*wvy)/l2;if(t<0){return dist2(p,v,k);}
if(t>1){return dist2(p,w,k);}
var proj={x:v.x+t*wvx,y:v.y+t*wvy};return dist2(p,proj,k);};}());(function(){var Point=pv.Shape.Point;var Line=pv.Shape.Line;pv.Shape.Polygon=function(points){this._points=points||[];};var Polygon=pv.Shape.Polygon;Polygon.prototype=pv.extend(pv.Shape);Polygon.prototype.points=function(){return this._points;};Polygon.prototype.clone=function(){return new Polygon(this.points().slice());};Polygon.prototype.apply=function(t){var points=this.points();var L=points.length;var points2=new Array(L);for(var i=0;i<L;i++){points2[i]=points[i].apply(t);}
return new Polygon(points2);};Polygon.prototype.intersectsRect=function(rect){var i,L;var points=this.points();L=points.length;for(i=0;i<L;i++){if(points[i].intersectsRect(rect)){return true;}}
var edges=this.edges();L=edges.length;for(i=0;i<L;i++){if(edges[i].intersectsRect(rect)){return true;}}
return false;};Polygon.prototype.edges=function(){var edges=this._edges;if(!edges){edges=this._edges=[];var points=this.points();var L=points.length;if(L){var prevPoint=points[0];var firstPoint=prevPoint;var point;for(var i=1;i<L;i++){point=points[i];edges.push(new Line(prevPoint.x,prevPoint.y,point.x,point.y));prevPoint=point;}
if(L>2){edges.push(new Line(point.x,point.y,firstPoint.x,firstPoint.y));}}}
return edges;};Polygon.prototype.distance2=function(p,k){var min={cost:Infinity,dist2:Infinity};this.edges().forEach(function(edge){var d=edge.distance2(p,k);if(d.cost<min.cost){min=d;}},this);return min;};Polygon.prototype.center=function(){var points=this.points();var x=0;var y=0;for(var i=0,L=points.length;i<L;i++){var p=points[i];x+=p.x;y+=p.y;}
return new Point(x/L,y/L);};Polygon.prototype.containsPoint=function(p){var bbox=this.bbox();if(!bbox.containsPoint(p)){return false;}
var e=bbox.dx*0.01;var ray=new Line(bbox.x-e,p.y,p.x,p.y);var intersectCount=0;var edges=this.edges();edges.forEach(function(edge){if(edge.intersectsLine(ray)){intersectCount++;}});return(intersectCount&1)===1;};Polygon.prototype.bbox=function(){var bbox=this._bbox;if(!bbox){var min,max;this.points().forEach(function(point,index){if(min==null){min={x:point.x,y:point.y};}else{if(point.x<min.x){min.x=point.x;}
if(point.y<min.y){min.y=point.y;}}
if(max==null){max={x:point.x,y:point.y};}else{if(point.x>max.x){max.x=point.x;}
if(point.y>max.y){max.y=point.y;}}});if(min){bbox=this._bbox=new pv.Shape.Rect(min.x,min.y,max.x-min.x,max.y-min.y);}}
return bbox;};}());(function(){var Point=pv.Shape.Point;var Line=pv.Shape.Line;pv.Shape.Rect=function(x,y,dx,dy){this.x=x||0;this.y=y||0;this.dx=dx||0;this.dy=dy||0;if(this.dx<0){this.dx=-this.dx;this.x=this.x-this.dx;}
if(this.dy<0){this.dy=-this.dy;this.y=this.y-this.dy;}
this.x2=this.x+this.dx;this.y2=this.y+this.dy;};var Rect=pv.Shape.Rect;Rect.prototype=pv.extend(pv.Shape.Polygon);Rect.prototype.clone=function(){var r2=Object.create(Rect.prototype);r2.x=this.x;r2.y=this.y;r2.dx=this.dx;r2.dy=this.dy;r2.x2=this.x2;r2.y2=this.y2;return r2;};Rect.prototype.apply=function(t){var x=t.x+(t.k*this.x);var y=t.y+(t.k*this.y);var dx=t.k*this.dx;var dy=t.k*this.dy;return new Rect(x,y,dx,dy);};Rect.prototype.containsPoint=function(p){return this.x<=p.x&&p.x<=this.x2&&this.y<=p.y&&p.y<=this.y2;};Rect.prototype.intersectsRect=function(rect){return(this.x2>rect.x)&&(this.x<rect.x2)&&(this.y2>rect.y)&&(this.y<rect.y2);};Rect.prototype.edges=function(){if(!this._edges){var x=this.x,y=this.y,x2=this.x2,y2=this.y2;this._edges=[new Line(x,y,x2,y),new Line(x2,y,x2,y2),new Line(x2,y2,x,y2),new Line(x,y2,x,y)];}
return this._edges;};Rect.prototype.center=function(){return new Point(this.x+this.dx/2,this.y+this.dy/2);};Rect.prototype.points=function(){var points=this._points;if(!points){var x=this.x,y=this.y,x2=this.x2,y2=this.y2;points=this._points=[new Point(x,y),new Point(x2,y),new Point(x2,y2),new Point(x,y2)];}
return points;};Rect.prototype.bbox=function(){return this.clone();};}());(function(){var Point=pv.Shape.Point;var dist2=pv.Shape.dist2;var sqrt=Math.sqrt;var abs=Math.abs;var pow=Math.pow;pv.Shape.Circle=function(x,y,radius){this.x=x||0;this.y=y||0;this.radius=radius||0;};var Circle=pv.Shape.Circle;Circle.prototype=pv.extend(pv.Shape);Circle.prototype.clone=function(){return new Circle(this.x,this.y,this.radius);};Circle.prototype.apply=function(t){var x=t.x+(t.k*this.x);var y=t.y+(t.k*this.y);var r=t.k*this.radius;return new Circle(x,y,r);};Circle.prototype.intersectsRect=function(rect){var dx2=rect.dx/2,dy2=rect.dy/2,r=this.radius;var circleDistX=abs(this.x-rect.x-dx2),circleDistY=abs(this.y-rect.y-dy2);if((circleDistX>dx2+r)||(circleDistY>dy2+r)){return false;}
if(circleDistX<=dx2||circleDistY<=dy2){return true;}
var sqCornerDistance=pow(circleDistX-dx2,2)+
pow(circleDistY-dy2,2);return sqCornerDistance<=r*r;};Circle.prototype.intersectLine=function(line,isInfiniteLine){var baX=line.x2-line.x;var baY=line.y2-line.y;var caX=this.x-line.x;var caY=this.y-line.y;var ba2=baX*baX+baY*baY;var bBy2=baX*caX+baY*caY;var r=this.radius;var c=caX*caX+caY*caY-r*r;var pBy2=bBy2/ba2;var disc=pBy2*pBy2-c/ba2;if(disc<0){return;}
var discSqrt=sqrt(disc);var t1=pBy2-discSqrt;var t2=pBy2+discSqrt;var ps=[];if(isInfiniteLine||(t1>=0&&t1<=1)){ps.push(new Point(line.x+baX*t1,line.y+baY*t1));}
if(disc!==0){if(isInfiniteLine||(t2>=0&&t2<=1)){ps.push(new Point(line.x+baX*t2,line.y+baY*t2));}}
return ps;};Circle.prototype.points=function(){return[this.center()];};Circle.prototype.center=function(){return new Point(this.x,this.y);};Circle.prototype.normal=function(at){return at.minus(this.x,this.y).norm();};Circle.prototype.containsPoint=function(p){var dx=p.x-this.x,dy=p.y-this.y,r=this.radius;return dx*dx+dy*dy<=r*r;};Circle.prototype.distance2=function(p,k){var dx=p.x-this.x,dy=p.y-this.y,r=this.radius;var b=p.minus(this).norm().times(r).plus(this);var dBorder=dist2(p,b,k);return dBorder;};}());(function(){var Point=pv.Shape.Point;var dist2=pv.Shape.dist2;var normalizeAngle=pv.Shape.normalizeAngle;var atan2Norm=pv.Shape.atan2Norm;var cos=Math.cos;var sin=Math.sin;var sqrt=Math.sqrt;pv.Shape.Arc=function(x,y,radius,startAngle,angleSpan){this.x=x;this.y=y;this.radius=radius;this.startAngle=normalizeAngle(startAngle);this.angleSpan=normalizeAngle(angleSpan);this.endAngle=this.startAngle+this.angleSpan;};var Arc=pv.Shape.Arc;Arc.prototype=pv.extend(pv.Shape);Arc.prototype.hasArea=function(){return false;};Arc.prototype.clone=function(){var arc=Object.create(Arc.prototype);var me=this;arc.x=me.x;arc.y=me.y;arc.radius=me.radius;arc.startAngle=me.startAngle;arc.angleSpan=me.angleSpan;arc.endAngle=me.endAngle;return arc;};Arc.prototype.apply=function(t){var x=t.x+(t.k*this.x);var y=t.y+(t.k*this.y);var r=t.k*this.radius;return new Arc(x,y,r,this.startAngle,this.angleSpan);};Arc.prototype.containsPoint=function(p){var dx=p.x-this.x;var dy=p.y-this.y;var r=sqrt(dx*dx+dy*dy);if(Math.abs(r-this.radius)<=1e-10){var a=atan2Norm(dy,dx);return this.startAngle<=a&&a<=this.endAngle;}
return false;};Arc.prototype.intersectsRect=function(rect){var i,L;var points=this.points();var L=points.length;for(i=0;i<L;i++){if(points[i].intersectsRect(rect)){return true;}}
var edges=rect.edges();L=edges.length;for(i=0;i<L;i++){if(this.intersectLine(edges[i])){return true;}}
return false;};var circleIntersectLine=pv.Shape.Circle.prototype.intersectLine;Arc.prototype.intersectLine=function(line,isInfiniteLine){var ps=circleIntersectLine.call(this,line,isInfiniteLine);if(ps){ps=ps.filter(function(p){return this.containsPoint(p);},this);if(ps.length){return ps;}}};Arc.prototype.points=function(){var x=this.x;var y=this.y;var r=this.radius;var ai=this.startAngle;var af=this.endAngle;return[new Point(x+r*cos(ai),y+r*sin(ai)),new Point(x+r*cos(af),y+r*sin(af))];};Arc.prototype.center=function(){var x=this.x;var y=this.y;var r=this.radius;var am=(this.startAngle+this.endAngle)/2;return new Point(x+r*cos(am),y+r*sin(am));};Arc.prototype.normal=function(at,shapeCenter){var norm=at.minus(this.x,this.y).norm();if(shapeCenter){var outside=this.center().minus(shapeCenter);if(outside.dot(norm)<0){norm=norm.times(-1);}}
return norm;};Arc.prototype.distance2=function(p,k){var dx=p.x-this.x;var dy=p.y-this.y;var a=atan2Norm(dy,dx);if(this.startAngle<=a&&a<=this.endAngle){var b=new Point(this.x+this.radius*cos(a),this.y+this.radius*sin(a));return dist2(p,b,k);}
var points=this.points();var d1=dist2(p,points[0],k);var d2=dist2(p,points[1],k);return d1.cost<d2.cost?d1:d2;};}());(function(){var Arc=pv.Shape.Arc;var Line=pv.Shape.Line;var Point=pv.Shape.Point;var cos=Math.cos;var sin=Math.sin;var sqrt=Math.sqrt;var atan2Norm=pv.Shape.atan2Norm;var normalizeAngle=pv.Shape.normalizeAngle;pv.Shape.Wedge=function(x,y,innerRadius,outerRadius,startAngle,angleSpan){this.x=x;this.y=y;this.innerRadius=innerRadius;this.outerRadius=outerRadius;this.startAngle=normalizeAngle(startAngle);this.angleSpan=normalizeAngle(angleSpan);this.endAngle=this.startAngle+this.angleSpan;};var Wedge=pv.Shape.Wedge;Wedge.prototype=pv.extend(pv.Shape);Wedge.prototype.clone=function(){return new Wedge(this.x,this.y,this.innerRadius,this.outerRadius,this.startAngle,this.angleSpan);};Wedge.prototype.apply=function(t){var x=t.x+(t.k*this.x);var y=t.y+(t.k*this.y);var ir=t.k*this.innerRadius;var or=t.k*this.outerRadius;return new Wedge(x,y,ir,or,this.startAngle,this.angleSpan);};Wedge.prototype.containsPoint=function(p){var dx=p.x-this.x;var dy=p.y-this.y;var r=sqrt(dx*dx+dy*dy);if(r>=this.innerRadius&&r<=this.outerRadius){var a=atan2Norm(dy,dx);return this.startAngle<=a&&a<=this.endAngle;}
return false;};Wedge.prototype.intersectsRect=function(rect){var i,L;var points=this.points();L=points.length;for(i=0;i<L;i++){if(points[i].intersectsRect(rect)){return true;}}
points=rect.points();L=points.length;for(i=0;i<L;i++){if(this.containsPoint(points[i])){return true;}}
var edges=this.edges();L=edges.length;for(i=0;i<L;i++){if(edges[i].intersectsRect(rect)){return true;}}
return false;};Wedge.prototype.points=function(){if(!this._points){this.edges();}
return this._points;};Wedge.prototype.edges=function(){var edges=this._edges;if(!edges){var x=this.x;var y=this.y;var ir=this.innerRadius;var or=this.outerRadius;var ai=this.startAngle;var af=this.endAngle;var aa=this.angleSpan;var cai=cos(ai);var sai=sin(ai);var caf=cos(af);var saf=sin(af);var pii,pfi;if(ir>0){pii=new Point(x+ir*cai,y+ir*sai);pfi=new Point(x+ir*caf,y+ir*saf);}else{pii=pfi=new Point(x,y);}
var pio=new Point(x+or*cai,y+or*sai);var pfo=new Point(x+or*caf,y+or*saf);edges=this._edges=[];if(ir>0){edges.push(new Arc(x,y,ir,ai,aa));}
edges.push(new Line(pii.x,pii.y,pio.x,pio.y),new Arc(x,y,or,ai,aa),new Line(pfi.x,pfi.y,pfo.x,pfo.y));var points=this._points=[pii,pio,pfo];if(ir>0){points.push(pfi);}}
return edges;};Wedge.prototype.distance2=function(p,k){var min={cost:Infinity,dist2:Infinity};this.edges().forEach(function(edge){var d=edge.distance2(p,k);if(d.cost<min.cost){min=d;}});return min;};Wedge.prototype.center=function(){var midAngle=(this.startAngle+this.endAngle)/2;var midRadius=(this.innerRadius+this.outerRadius)/2;return new Point(this.x+midRadius*cos(midAngle),this.y+midRadius*sin(midAngle));};}());(function(){var round=Math.round;var parseRgb=function(c){var f=parseFloat(c);return(c[c.length-1]=='%')?round(f*2.55):f;};var reSysColor=/([a-z]+)\((.*)\)/i;var createColor=function(format){if(format.charAt(0)==="#"){var r,g,b;if(format.length===4){r=format.charAt(1);r+=r;g=format.charAt(2);g+=g;b=format.charAt(3);b+=b;}else if(format.length===7){r=format.substring(1,3);g=format.substring(3,5);b=format.substring(5,7);}
return pv.rgb(parseInt(r,16),parseInt(g,16),parseInt(b,16),1);}
var m1=reSysColor.exec(format);if(m1){var m2=m1[2].split(","),a=1;switch(m1[1]){case"hsla":case"rgba":{a=parseFloat(m2[3]);if(!a)return pv.Color.transparent;break;}}
switch(m1[1]){case"hsla":case"hsl":{var h=parseFloat(m2[0]),s=parseFloat(m2[1])/100,l=parseFloat(m2[2])/100;return(new pv.Color.Hsl(h,s,l,a)).rgb();}
case"rgba":case"rgb":{var r=parseRgb(m2[0]),g=parseRgb(m2[1]),b=parseRgb(m2[2]);return pv.rgb(r,g,b,a);}}}
return new pv.Color(format,1);};var colorsByFormat={};pv.color=function(format){if(format.rgb){return format.rgb();}
var color=pv.Color.names[format];if(!color){color=colorsByFormat[format]||(colorsByFormat[format]=createColor(format));}
return color;};}());pv.Color=function(color,opacity){this.color=color;this.opacity=opacity;this.key="solid "+color+" alpha("+opacity+")";};pv.Color.prototype.hsl=function(){return this.rgb().hsl();};pv.Color.prototype.brighter=function(k){return this.rgb().brighter(k);};pv.Color.prototype.darker=function(k){return this.rgb().darker(k);};pv.Color.prototype.alphaBlend=function(mate){var rgb=this.rgb();var a=rgb.a;if(a===1){return this;}
if(!mate){mate=pv.Color.names.white;}else{mate=pv.color(mate);}
mate=mate.rgb();var z=(1-a);return pv.rgb(z*rgb.r+a*mate.r,z*rgb.g+a*mate.g,z*rgb.b+a*mate.b,1);};pv.Color.prototype.rgbDecimal=function(mate){var rgb=this.alphaBlend(mate);return rgb.r<<16|rgb.g<<8|rgb.b;};pv.Color.prototype.isDark=function(){return this.rgbDecimal()<0xffffff/2;};pv.rgb=function(r,g,b,a){return new pv.Color.Rgb(r,g,b,(arguments.length==4)?a:1);};pv.Color.Rgb=function(r,g,b,a){pv.Color.call(this,a?("rgb("+r+","+g+","+b+")"):"none",a);this.r=r;this.g=g;this.b=b;this.a=a;};pv.Color.Rgb.prototype=pv.extend(pv.Color);pv.Color.Rgb.prototype.red=function(r){return pv.rgb(r,this.g,this.b,this.a);};pv.Color.Rgb.prototype.green=function(g){return pv.rgb(this.r,g,this.b,this.a);};pv.Color.Rgb.prototype.blue=function(b){return pv.rgb(this.r,this.g,b,this.a);};pv.Color.Rgb.prototype.alpha=function(a){return pv.rgb(this.r,this.g,this.b,a);};pv.Color.Rgb.prototype.rgb=function(){return this;};pv.Color.Rgb.prototype.brighter=function(k){k=Math.pow(0.7,k!=null?k:1);var r=this.r,g=this.g,b=this.b,i=30;if(!r&&!g&&!b)return pv.rgb(i,i,i,this.a);if(r&&(r<i))r=i;if(g&&(g<i))g=i;if(b&&(b<i))b=i;return pv.rgb(Math.min(255,Math.floor(r/k)),Math.min(255,Math.floor(g/k)),Math.min(255,Math.floor(b/k)),this.a);};pv.Color.Rgb.prototype.darker=function(k){k=Math.pow(0.7,k!=null?k:1);return pv.rgb(Math.max(0,Math.floor(k*this.r)),Math.max(0,Math.floor(k*this.g)),Math.max(0,Math.floor(k*this.b)),this.a);};pv.Color.Rgb.prototype.hsl=function(){var r=this.r/255;var g=this.g/255;var b=this.b/255;var max=Math.max(r,g,b);var min=Math.min(r,g,b);var l=(max+min)/2;var h,s;if(max===min){h=s=0;}else{var d=max-min;s=l>0.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}
h/=6;}
return pv.hsl(h*360,s,l,this.a);};pv.Color.Rgb.prototype.complementary=function(){return this.hsl().complementary().rgb();};pv.hsl=function(h,s,l,a){return new pv.Color.Hsl(h,s,l,(arguments.length==4)?a:1);};pv.Color.Hsl=function(h,s,l,a){pv.Color.call(this,"hsl("+h+","+(s*100)+"%,"+(l*100)+"%)",a);this.h=h;this.s=s;this.l=l;this.a=a;};pv.Color.Hsl.prototype=pv.extend(pv.Color);pv.Color.Hsl.prototype.hsl=function(){return this;};pv.Color.Hsl.prototype.hue=function(h){return pv.hsl(h,this.s,this.l,this.a);};pv.Color.Hsl.prototype.saturation=function(s){return pv.hsl(this.h,s,this.l,this.a);};pv.Color.Hsl.prototype.lightness=function(l){return pv.hsl(this.h,this.s,l,this.a);};pv.Color.Hsl.prototype.alpha=function(a){return pv.hsl(this.h,this.s,this.l,a);};pv.Color.Hsl.prototype.complementary=function(){return pv.hsl((this.h+180)%360,1-this.s,1-this.l,this.a);};pv.Color.Hsl.prototype.rgb=function(){var h=this.h,s=this.s,l=this.l;h=h%360;if(h<0)h+=360;s=Math.max(0,Math.min(s,1));l=Math.max(0,Math.min(l,1));var m2=(l<=.5)?(l*(1+s)):(l+s-l*s);var m1=2*l-m2;function v(h){if(h>360)h-=360;else if(h<0)h+=360;if(h<60)return m1+(m2-m1)*h/60;if(h<180)return m2;if(h<240)return m1+(m2-m1)*(240-h)/60;return m1;}
function vv(h){return Math.round(v(h)*255);}
return pv.rgb(vv(h+120),vv(h),vv(h-120),this.a);};pv.Color.names={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:pv.Color.transparent=pv.rgb(0,0,0,0)};(function(){var names=pv.Color.names;names.none=names.transparent;for(var name in names)names[name]=pv.color(names[name]);})();pv.colors=function(){var scale=pv.Scale.ordinal();scale.range.apply(scale,arguments);return scale;};pv.Colors={};pv.Colors.category10=function(){var scale=pv.colors("#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf");scale.domain.apply(scale,arguments);return scale;};pv.Colors.category20=function(){var scale=pv.colors("#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5");scale.domain.apply(scale,arguments);return scale;};pv.Colors.category19=function(){var scale=pv.colors("#9c9ede","#7375b5","#4a5584","#cedb9c","#b5cf6b","#8ca252","#637939","#e7cb94","#e7ba52","#bd9e39","#8c6d31","#e7969c","#d6616b","#ad494a","#843c39","#de9ed6","#ce6dbd","#a55194","#7b4173");scale.domain.apply(scale,arguments);return scale;};(function(){pv.fillStyle=function(format){if(format.type){return format;}
var k=format.key||format;var fillStyle=fillStylesByKey[k];if(!fillStyle){fillStyle=fillStylesByKey[k]=createFillStyle(format);}else{fillStyle=fillStyle.clone();}
return fillStyle;};var fillStylesByKey={};var createFillStyle=function(format){if(format.rgb){return new pv.FillStyle.Solid(format.color,format.opacity);}
var match=/^\s*([a-z\-]+)\(\s*(.*?)\s*\)\s*$/.exec(format);if(match){switch(match[1]){case"linear-gradient":return parseLinearGradient(match[2]);case"radial-gradient":return parseRadialGradient(match[2]);}}
return new pv.FillStyle.Solid(pv.color(format));};var keyAnglesDeg={top:0,'top right':45,right:90,'bottom right':135,bottom:180,'bottom left':225,left:270,'top left':315};function parseLinearGradient(text){var terms=parseText(text);if(!terms.length){return null;}
var angle=Math.PI;var keyAngle;var m,f;var term=terms[0];if(term.indexOf('to ')===0){m=/^to\s+(?:((top|bottom)(?:\s+(left|right))?)|((left|right)(?:\\s+(top|bottom))?))$/.exec(term);if(m){if(m[1]){keyAngle=m[2];if(m[3]){keyAngle+=' '+m[3];}}else{keyAngle=m[5];if(m[6]){keyAngle=m[6]+' '+keyAngle;}}
angle=pv.radians(keyAnglesDeg[keyAngle]);terms.shift();}}else{f=parseFloat(term);if(!isNaN(f)){angle=f;if(/^.*?deg$/.test(term)){angle=pv.radians(angle);}
terms.shift();}}
var stops=parseStops(terms);switch(stops.length){case 0:return null;case 1:return new pv.FillStyle.Solid(stops[0].color,1);}
return new pv.FillStyle.LinearGradient(angle,stops,text);}
function parseRadialGradient(text){var terms=parseText(text);if(!terms.length){return null;}
var stops=parseStops(terms);switch(stops.length){case 0:return null;case 1:return new pv.FillStyle.Solid(stops[0].color,1);}
return new pv.FillStyle.RadialGradient(50,50,stops,text);}
function parseText(text){var colorFuns={};var colorFunId=0;text=text.replace(/\b\w+?\(.*?\)/g,function($0){var id='__color'+(colorFunId++);colorFuns[id]=$0;return id;});var terms=text.split(/\s*,\s*/);if(!terms.length){return null;}
if(colorFunId){terms.forEach(function(id,index){if(colorFuns.hasOwnProperty(id)){terms[index]=colorFuns[id];}});}
return terms;}
function parseStops(terms){var stops=[];var minOffsetPercent=+Infinity;var maxOffsetPercent=-Infinity;var pendingOffsetStops=[];function processPendingStops(lastOffset){var count=pendingOffsetStops.length;if(count){var firstOffset=maxOffsetPercent;var step=(lastOffset-firstOffset)/(count+1);for(var i=0;i<count;i++){firstOffset+=step;pendingOffsetStops[i].offset=firstOffset;}
pendingOffsetStops.length=0;}}
var i=0;var T=terms.length;while(i<T){var term=terms[i++];var m=/^(.+?)\s*([+\-]?[e\.\d]+%)?$/i.exec(term);if(m){var stop={color:pv.color(m[1])};var offsetPercent=parseFloat(m[2]);if(isNaN(offsetPercent)){if(!stops.length){offsetPercent=0;}else if(i===T){offsetPercent=Math.max(maxOffsetPercent,100);}}
stops.push(stop);if(isNaN(offsetPercent)){pendingOffsetStops.push(stop);}else{stop.offset=offsetPercent;processPendingStops(offsetPercent);if(offsetPercent>maxOffsetPercent){maxOffsetPercent=offsetPercent;}else if(offsetPercent<maxOffsetPercent){offsetPercent=maxOffsetPercent;}
if(offsetPercent<minOffsetPercent){minOffsetPercent=offsetPercent;}}}}
if(stops.length>=2&&(minOffsetPercent<0||maxOffsetPercent>100)){var colorDomain=[];var colorRange=[];stops.forEach(function(stop){colorDomain.push(stop.offset);colorRange.push(stop.color);});var colorScale=pv.scale.linear().domain(colorDomain).range(colorRange);if(minOffsetPercent<0){while(stops.length&&stops[0].offset<=0){stops.shift();}
stops.unshift({offset:0,color:colorScale(0)});}
if(maxOffsetPercent>100){while(stops.length&&stops[stops.length-1].offset>=100){stops.pop();}
stops.push({offset:100,color:colorScale(100)});}}
return stops;}
var FillStyle=pv.FillStyle=function(type){this.type=type;this.key=type;};pv.extendType(FillStyle,new pv.Color('none',1));FillStyle.prototype.rgb=function(){var color=pv.color(this.color);if(this.opacity!==color.opacity){color=color.alpha(this.opacity);}
return color;};FillStyle.prototype.alphaBlend=function(mate){return this.rgb().alphaBlend(mate);};FillStyle.prototype.rgbDecimal=function(mate){return this.rgb().rgbDecimal(mate);};FillStyle.prototype.isDark=function(){return this.rgb().isDark();};var Solid=pv.FillStyle.Solid=function(color,opacity){FillStyle.call(this,'solid');if(color.rgb){this.color=color.color;this.opacity=color.opacity;}else{this.color=color;this.opacity=opacity;}
this.key+=" "+this.color+" alpha("+this.opacity+")";};pv.extendType(Solid,FillStyle);Solid.prototype.alpha=function(opacity){return new Solid(this.color,opacity);};Solid.prototype.brighter=function(k){return new Solid(this.rgb().brighter(k));};Solid.prototype.darker=function(k){return new Solid(this.rgb().darker(k));};Solid.prototype.complementary=function(){return new Solid(this.rgb().complementary());};Solid.prototype.clone=function(){var o=pv.extend(Solid);o.type=this.type;o.key=this.key;o.color=this.color;o.opacity=this.opacity;return o;};pv.FillStyle.transparent=new Solid(pv.Color.transparent);var gradient_id=0;var Gradient=pv.FillStyle.Gradient=function(type,stops){FillStyle.call(this,type);this.id=++gradient_id;this.stops=stops;if(stops.length){this.color=stops[0].color.color;}
this.key+=" stops("+
stops.map(function(stop){var color=stop.color;return color.color+" alpha("+color.opacity+") at("+stop.offset+")";}).join(", ")+")";};pv.extendType(Gradient,FillStyle);Gradient.prototype.rgb=function(){return this.stops.length?this.stops[0].color:undefined;};Gradient.prototype.alpha=function(opacity){return this._cloneWithStops(this.stops.map(function(stop){return{offset:stop.offset,color:stop.color.alpha(opacity)};}));};Gradient.prototype.darker=function(k){return this._cloneWithStops(this.stops.map(function(stop){return{offset:stop.offset,color:stop.color.darker(k)};}));};Gradient.prototype.brighter=function(k){return this._cloneWithStops(this.stops.map(function(stop){return{offset:stop.offset,color:stop.color.brighter(k)};}));};Gradient.prototype.complementary=function(){return this._cloneWithStops(this.stops.map(function(stop){return{offset:stop.offset,color:stop.color.complementary()};}));};Gradient.prototype.alphaBlend=function(mate){return this._cloneWithStops(this.stops.map(function(stop){return{offset:stop.offset,color:stop.color.alphaBlend(mate)};}));};Gradient.prototype.clone=function(){var Type=this.constructor;var o=pv.extend(Type);o.constructor=Type;o.id=++gradient_id;o.type=this.type;o.key=this.key;var stops=this.stops;o.stops=stops;if(stops.length){o.color=stops[0].color.color;}
this._initClone(o);return o;};var LinearGradient=pv.FillStyle.LinearGradient=function(angle,stops){Gradient.call(this,'lineargradient',stops);this.angle=angle;this.key+=" angle("+angle+")";};pv.extendType(LinearGradient,Gradient);LinearGradient.prototype._cloneWithStops=function(stops){return new LinearGradient(this.angle,stops);};LinearGradient.prototype._initClone=function(o){o.angle=this.angle;};var RadialGradient=pv.FillStyle.RadialGradient=function(cx,cy,stops){Gradient.call(this,'radialgradient',stops);this.cx=cx;this.cy=cy;this.key+=" center("+cx+","+cy+")";};pv.extendType(RadialGradient,Gradient);RadialGradient.prototype._cloneWithStops=function(stops){return new RadialGradient(this.cx,this.cy);};RadialGradient.prototype._initClone=function(o){o.cx=this.cx;o.cy=this.cy;};})();pv.ramp=function(start,end){var scale=pv.Scale.linear();scale.range.apply(scale,arguments);return scale;};pv.Scene=pv.SvgScene={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml",scale:1,events:["DOMMouseScroll","mousewheel","mousedown","mouseup","mouseover","mouseout","mousemove","click","dblclick"],implicit:{svg:{"shape-rendering":"auto","pointer-events":"painted","x":0,"y":0,"dy":0,"text-anchor":"start","transform":"translate(0,0)","fill":"none","fill-opacity":1,"stroke":"none","stroke-opacity":1,"stroke-width":1.5,"stroke-linejoin":"miter","stroke-linecap":"butt","stroke-miterlimit":8,"stroke-dasharray":"none"},css:{"font":"10px sans-serif"}}};pv.SvgScene.updateAll=function(scenes){if(scenes.length&&scenes[0].reverse&&(scenes.type!=="line")&&(scenes.type!=="area")){var reversed=pv.extend(scenes);for(var i=0,j=scenes.length-1;j>=0;i++,j--){reversed[i]=scenes[j];}
scenes=reversed;}
this.removeSiblings(this[scenes.type](scenes));};pv.SvgScene.create=function(type){return document.createElementNS(this.svg,type);};pv.SvgScene.expect=function(e,type,scenes,i,attributes,style){var tagName;if(e){tagName=e.tagName;if(tagName==='defs'){e=e.nextSibling;if(e){tagName=e.tagName;}}else if(tagName==='a'){e=e.firstChild;}}
if(e){if(tagName!==type){var n=this.create(type);e.parentNode.replaceChild(n,e);e=n;}}else{e=this.create(type);}
if(attributes)this.setAttributes(e,attributes);if(style)this.setStyle(e,style);return e;};pv.SvgScene.setAttributes=function(e,attributes){var implicitSvg=this.implicit.svg;var prevAttrs=e.__attributes__;if(prevAttrs===attributes){prevAttrs=null;}
for(var name in attributes){var value=attributes[name];if(!prevAttrs||(value!==prevAttrs[name])){if(value==null||value==implicitSvg[name]){e.removeAttribute(name);}else{e.setAttribute(name,value);}}}
e.__attributes__=attributes;};pv.SvgScene.setStyle=function(e,style){var implicitCss=this.implicit.css;var prevStyle=e.__style__;if(prevStyle===style){prevStyle=null;}
switch(pv.renderer()){case'batik':for(var name in style){var value=style[name];if(!prevStyle||(value!==prevStyle[name])){if(value==null||value==implicitCss[name]){e.removeAttribute(name);}else{e.style.setProperty(name,value);}}}
break;case'svgweb':for(var name in style){var value=style[name];if(value==null||value==implicitCss[name]){continue;}
e.style[name]=value;}
break;default:for(var name in style){var value=style[name];if(!prevStyle||(value!==prevStyle[name])){if(value==null||value==implicitCss[name]){e.style.removeProperty(name);}else{e.style[name]=value;}}}}
e.__style__=style;};pv.SvgScene.append=function(e,scenes,index){e.$scene={scenes:scenes,index:index};e=this.title(e,scenes[index]);if(!e.parentNode)scenes.$g.appendChild(e);return e.nextSibling;};pv.SvgScene.title=function(e,s){var a=e.parentNode;if(a&&(a.tagName!="a"))a=null;if(s.title){if(!a){a=this.create("a");a.setAttributeNS(this.xlink,"xlink:href","");if(e.parentNode)e.parentNode.replaceChild(a,e);a.appendChild(e);}
a.setAttributeNS(this.xlink,"xlink:title",s.title);var t=null;for(var c=e.firstChild;c!=null;c=c.nextSibling){if(c.nodeName=="title"){t=c;break;}}
if(!t){t=this.create("title");e.appendChild(t);}else{t.removeChild(t.firstChild);}
if(pv.renderer()=="svgweb"){t.appendChild(document.createTextNode(s.title,true));}else{t.appendChild(document.createTextNode(s.title));}
return a;}
if(a)a.parentNode.replaceChild(e,a);return e;};pv.SvgScene.dispatch=pv.listener(function(e){var t=e.target.$scene;if(t){var type=e.type;switch(type){case"DOMMouseScroll":type="mousewheel";e.wheel=-480*e.detail;break;case"mousewheel":e.wheel=(window.opera?12:1)*e.wheelDelta;break;}
if(pv.Mark.dispatch(type,t.scenes,t.index,e)){e.preventDefault();e.stopPropagation();}}});pv.SvgScene.removeSiblings=function(e){while(e){var n=e.nextSibling;if(e.nodeName!=='defs'){e.parentNode.removeChild(e);}
e=n;}};pv.SvgScene.undefined=function(){};(function(){var dashAliasMap={'-':'shortdash','.':'shortdot','-.':'shortdashdot','-..':'shortdashdotdot','. ':'dot','- ':'dash','--':'longdash','- .':'dashdot','--.':'longdashdot','--..':'longdashdotdot'};var dashMap={'shortdash':[3,1],'shortdot':[1,1],'shortdashdot':[3,1,1,1],'shortdashdotdot':[3,1,1,1,1,1],'dot':[1,3],'dash':[4,3],'longdash':[8,3],'dashdot':[4,3,1,3],'longdashdot':[8,3,1,3],'longdashdotdot':[8,3,1,3,1,3]};pv.SvgScene.isStandardDashStyle=function(dashArray){return dashMap.hasOwnProperty(dashArray);};pv.SvgScene.translateDashStyleAlias=function(dashArray){return dashAliasMap.hasOwnProperty(dashArray)?dashAliasMap[dashArray]:dashArray;};pv.SvgScene.parseDasharray=function(s){var dashArray=s.strokeDasharray;if(dashArray&&dashArray!=='none'){dashArray=this.translateDashStyleAlias(dashArray);var standardDashArray=dashMap[dashArray];if(standardDashArray){dashArray=standardDashArray;}else{dashArray=dashArray.split(/[\s,]+/);}
var lineWidth=s.lineWidth;var lineCap=s.lineCap||'butt';var isButtCap=lineCap==='butt';dashArray=dashArray.map(function(num,index){num=+num;if(!isButtCap){if(index%2){num++;}else{num-=1;}}
if(num<=0){num=.001;}
return num*lineWidth/this.scale;},this).join(' ');}else{dashArray=null;}
return dashArray;};})();(function(){var reTestUrlColor=/^url\(#/;var next_gradient_id=1;var pi2=Math.PI/2;var pi4=pi2/2;var sqrt22=Math.SQRT2/2;var abs=Math.abs;var sin=Math.sin;var cos=Math.cos;var zr=function(x){return abs(x)<=1e-12?0:x;};pv.SvgScene.addFillStyleDefinition=function(scenes,fill){if(!fill.type||fill.type==='solid'||reTestUrlColor.test(fill.color)){return;}
var rootMark=scenes.mark.root;var fillStyleMap=rootMark.__fillStyleMap__||(rootMark.__fillStyleMap__={});var k=fill.key;var instId=fillStyleMap[k];if(!instId){instId=fillStyleMap[k]='__pvGradient'+(next_gradient_id++);var elem=createGradientDef.call(this,scenes,fill,instId);rootMark.scene.$g.$defs.appendChild(elem);}
fill.color='url(#'+instId+')';};var createGradientDef=function(scenes,fill,instId){var isLinear=(fill.type==='lineargradient');var elem=this.create(isLinear?"linearGradient":"radialGradient");elem.setAttribute("id",instId);if(isLinear){var svgAngle=fill.angle-pi2;var diagAngle=abs(svgAngle%pi2)-pi4;var r=abs(sqrt22*cos(diagAngle));var dirx=r*cos(svgAngle);var diry=r*sin(svgAngle);elem.setAttribute("x1",zr(0.5-dirx));elem.setAttribute("y1",zr(0.5-diry));elem.setAttribute("x2",zr(0.5+dirx));elem.setAttribute("y2",zr(0.5+diry));}
var stops=fill.stops;var S=stops.length;for(var i=0;i<S;i++){var stop=stops[i];var stopElem=elem.appendChild(this.create("stop"));var color=stop.color;stopElem.setAttribute("offset",stop.offset+'%');stopElem.setAttribute("stop-color",color.color);stopElem.setAttribute("stop-opacity",color.opacity+'');}
return elem;};})();pv.SvgScene.pathBasis=(function(){var basis=[[1/6,2/3,1/6,0],[0,2/3,1/3,0],[0,1/3,2/3,0],[0,1/6,2/3,1/6]];function weight(w,p0,p1,p2,p3){return{x:w[0]*p0.left+w[1]*p1.left+w[2]*p2.left+w[3]*p3.left,y:w[0]*p0.top+w[1]*p1.top+w[2]*p2.top+w[3]*p3.top};}
var convert=function(p0,p1,p2,p3){var b1=weight(basis[1],p0,p1,p2,p3),b2=weight(basis[2],p0,p1,p2,p3),b3=weight(basis[3],p0,p1,p2,p3);return"C"+b1.x+","+b1.y
+","+b2.x+","+b2.y
+","+b3.x+","+b3.y;};convert.segment=function(p0,p1,p2,p3){var b0=weight(basis[0],p0,p1,p2,p3),b1=weight(basis[1],p0,p1,p2,p3),b2=weight(basis[2],p0,p1,p2,p3),b3=weight(basis[3],p0,p1,p2,p3);return["M"+b0.x+","+b0.y,"C"+b1.x+","+b1.y+","+
b2.x+","+b2.y+","+
b3.x+","+b3.y];};return convert;})();pv.SvgScene.curveBasis=function(points,from,to){var L;if(from==null){L=points.length;from=0;to=L-1;}else{L=to-from+1;}
if(L<=2)return"";var path="",p0=points[from],p1=p0,p2=p0,p3=points[from+1];path+=this.pathBasis(p0,p1,p2,p3);for(var i=from+2;i<=to;i++){p0=p1;p1=p2;p2=p3;p3=points[i];path+=this.pathBasis(p0,p1,p2,p3);}
path+=this.pathBasis(p1,p2,p3,p3);path+=this.pathBasis(p2,p3,p3,p3);return path;};pv.SvgScene.curveBasisSegments=function(points,from,to){var L;if(from==null){L=points.length;from=0;to=L-1;}else{L=to-from+1;}
if(L<=2)return"";var paths=[],p0=points[from],p1=p0,p2=p0,p3=points[from+1],firstPath=this.pathBasis.segment(p0,p1,p2,p3);p0=p1;p1=p2;p2=p3;p3=points[from+2];firstPath[1]+=this.pathBasis(p0,p1,p2,p3);paths.push(firstPath);for(var i=from+3;i<=to;i++){p0=p1;p1=p2;p2=p3;p3=points[i];paths.push(this.pathBasis.segment(p0,p1,p2,p3));}
var lastPath=this.pathBasis.segment(p1,p2,p3,p3);lastPath[1]+=this.pathBasis(p2,p3,p3,p3);paths.push(lastPath);return paths;};pv.SvgScene.curveHermite=function(points,tangents,from,to){var L;if(from==null){L=points.length;from=0;to=L-1;}else{L=to-from+1;}
var T=tangents.length;if(T<1||(L!==T&&L!==T+2)){return"";}
var quad=L!==T,path="",p0=points[from],p=points[from+1],t0=tangents[0],t=t0,pi=from+1;if(quad){path+="Q"+
(p.left-t0.x*2/3)+","+(p.top-t0.y*2/3)+","+
p.left+","+p.top;p0=points[from+1];pi=from+2;}
if(T>1){t=tangents[1];p=points[pi];pi++;path+="C"+
(p0.left+t0.x)+","+(p0.top+t0.y)+","+
(p.left-t.x)+","+(p.top-t.y)+","+
p.left+","+p.top;for(var i=2;i<T;i++,pi++){p=points[pi];t=tangents[i];path+="S"+
(p.left-t.x)+","+(p.top-t.y)+","+
p.left+","+p.top;}}
if(quad){var lp=points[pi];path+="Q"+
(p.left+t.x*2/3)+","+(p.top+t.y*2/3)+","+
lp.left+","+lp.top;}
return path;};pv.SvgScene.curveHermiteSegments=function(points,tangents,from,to){var L;if(from==null){L=points.length;from=0;to=L-1;}else{L=to-from+1;}
var T=tangents.length;if(T<1||(L!==T&&L!==T+2)){return[];}
var quad=L!==T,paths=[],p0=points[from],p=p0,t0=tangents[0],t=t0,pi=from+1;if(quad){p=points[from+1];paths.push(["M"+p0.left+","+p0.top,"Q"+(p.left-t.x*2/3)+","+
(p.top-t.y*2/3)+","+
p.left+","+p.top]);pi=from+2;}
for(var i=1;i<T;i++,pi++){p0=p;t0=t;p=points[pi];t=tangents[i];paths.push(["M"+p0.left+","+p0.top,"C"+(p0.left+t0.x)+","+(p0.top+t0.y)+","+
(p.left-t.x)+","+(p.top-t.y)+","+
p.left+","+p.top]);}
if(quad){var lp=points[pi];paths.push(["M"+p.left+","+p.top,"Q"+(p.left+t.x*2/3)+","+(p.top+t.y*2/3)+","+
lp.left+","+lp.top]);}
return paths;};pv.SvgScene.cardinalTangents=function(points,tension,from,to){var L;if(from==null){L=points.length;from=0;to=L-1;}else{L=to-from+1;}
var tangents=[],a=(1-tension)/2,p0=points[from],p1=points[from+1],p2=points[from+2];for(var i=from+3;i<=to;i++){tangents.push({x:a*(p2.left-p0.left),y:a*(p2.top-p0.top)});p0=p1;p1=p2;p2=points[i];}
tangents.push({x:a*(p2.left-p0.left),y:a*(p2.top-p0.top)});return tangents;};pv.SvgScene.curveCardinal=function(points,tension,from,to){var L;if(from==null){L=points.length;from=0;to=L-1;}else{L=to-from+1;}
if(L<=2)return"";return this.curveHermite(points,this.cardinalTangents(points,tension,from,to),from,to);};pv.SvgScene.curveCardinalSegments=function(points,tension,from,to){var L;if(from==null){L=points.length;from=0;to=L-1;}else{L=to-from+1;}
if(L<=2)return"";return this.curveHermiteSegments(points,this.cardinalTangents(points,tension,from,to),from,to);};pv.SvgScene.monotoneTangents=function(points,from,to){var L;if(from==null){L=points.length;from=0;to=L-1;}else{L=to-from+1;}
var tangents=[],d=[],m=[],dx=[],k=0,j;for(k=0;k<L-1;k++){j=from+k;var den=points[j+1].left-points[j].left;d[k]=Math.abs(den)<=1e-12?0:(points[j+1].top-points[j].top)/den;}
m[0]=d[0];dx[0]=points[from+1].left-points[from].left;for(k=1,j=from+k;k<L-1;k++,j++){m[k]=(d[k-1]+d[k])/2;dx[k]=(points[j+1].left-points[j-1].left)/2;}
m[k]=d[k-1];dx[k]=(points[j].left-points[j-1].left);for(k=0;k<L-1;k++){if(d[k]==0){m[k]=0;m[k+1]=0;}}
for(k=0;k<L-1;k++){if((Math.abs(m[k])<1e-5)||(Math.abs(m[k+1])<1e-5))continue;var ak=m[k]/d[k],bk=m[k+1]/d[k],s=ak*ak+bk*bk;if(s>9){var tk=3/Math.sqrt(s);m[k]=tk*ak*d[k];m[k+1]=tk*bk*d[k];}}
var len;for(var i=0;i<L;i++){len=1+m[i]*m[i];tangents.push({x:dx[i]/3/len,y:m[i]*dx[i]/3/len});}
return tangents;};pv.SvgScene.curveMonotone=function(points,from,to){var L;if(from==null){L=points.length;from=0;to=L-1;}else{L=to-from+1;}
if(L<=2)return"";return this.curveHermite(points,this.monotoneTangents(points,from,to),from,to);};pv.SvgScene.curveMonotoneSegments=function(points,from,to){var L;if(from==null){L=points.length;from=0;to=L-1;}else{L=to-from+1;}
if(L<=2)return"";return this.curveHermiteSegments(points,this.monotoneTangents(points,from,to),from,to);};pv.SvgScene.area=function(scenes){var e=scenes.$g.firstChild;var count=scenes.length;if(!count){return e;}
var s=scenes[0];if(s.segmented==='smart'){return this.areaSegmentedSmart(e,scenes);}
if(s.segmented){return this.areaSegmentedFull(e,scenes);}
return this.areaFixed(e,scenes,0,count-1,true);};pv.SvgScene.areaFixed=function(elm,scenes,from,to,addEvents){var count=to-from+1;if(count===1){return this.lineAreaDot(elm,scenes,from);}
var s=scenes[from];if(!s.visible){return elm;}
var fill=s.fillStyle;var stroke=s.strokeStyle;if(!fill.opacity&&!stroke.opacity){return elm;}
this.addFillStyleDefinition(scenes,fill);this.addFillStyleDefinition(scenes,stroke);var isInterpBasis=false;var isInterpCardinal=false;var isInterpMonotone=false;var isInterpStepAfter=false;var isInterpStepBefore=false;switch(s.interpolate){case'basis':isInterpBasis=true;break;case'cardinal':isInterpCardinal=true;break;case'monotone':isInterpMonotone=true;break;case'step-after':isInterpStepAfter=true;break;case'step-before':isInterpStepBefore=true;break;}
var isInterpBasisCardinalOrMonotone=isInterpBasis||isInterpCardinal||isInterpMonotone;var d=[],si,sj;for(var i=from;i<=to;i++){si=scenes[i];if(!si.width&&!si.height){continue;}
for(var j=i+1;j<=to;j++){sj=scenes[j];if(!sj.width&&!sj.height){break;}}
if((i>from)&&!isInterpStepAfter){i--;}
if((j<=to)&&!isInterpStepBefore){j++;}
var fun=isInterpBasisCardinalOrMonotone&&(j-i>2)?this.areaPathCurve:this.areaPathStraight;d.push(fun.call(this,scenes,i,j-1,s));i=j-1;}
if(!d.length){return elm;}
var sop=stroke.opacity;elm=this.expect(elm,"path",scenes,from,{"shape-rendering":s.antialias?null:"crispEdges","pointer-events":addEvents?s.events:'none',"cursor":s.cursor,"d":"M"+d.join("ZM")+"Z","fill":fill.color,"fill-opacity":fill.opacity||null,"stroke":stroke.color,"stroke-opacity":sop||null,"stroke-width":sop?(s.lineWidth/this.scale):null,"stroke-linecap":s.lineCap,"stroke-linejoin":s.lineJoin,"stroke-miterlimit":s.strokeMiterLimit,"stroke-dasharray":sop?this.parseDasharray(s):null});if(s.svg)this.setAttributes(elm,s.svg);if(s.css)this.setStyle(elm,s.css);return this.append(elm,scenes,from);};pv.SvgScene.areaSegmentedSmart=function(elm,scenes){if(!elm){elm=scenes.$g.appendChild(this.create("g"));}
var gg=elm;elm=gg.firstChild;var g1=this.expect(elm,"g",scenes,0,{'pointer-events':'none'});if(!g1.parentNode){gg.appendChild(g1);}
scenes.$g=g1;elm=g1.firstChild;var eventsSegments=scenes.mark.$hasHandlers?[]:null;elm=this.eachLineAreaSegment(elm,scenes,function(elm,scenes,from,to){var segment=this.areaSegmentPaths(scenes,from,to);var pathsT=segment.top;var pathsB=segment.bottom;var fromp=from;if(eventsSegments){eventsSegments.push(segment);}
var options={breakOnKeyChange:true,from:from,to:to};return this.eachLineAreaSegment(elm,scenes,options,function(elm,scenes,from,to){var s1=scenes[from];var fill=s1.fillStyle;var stroke=s1.strokeStyle;this.addFillStyleDefinition(scenes,fill);this.addFillStyleDefinition(scenes,stroke);if(from===to){return this.lineAreaDotAlone(elm,scenes,from);}
var d=this.areaJoinPaths(pathsT,pathsB,from-fromp,to-fromp-1);var sop=stroke.opacity;var attrs={'shape-rendering':s1.antialias?null:'crispEdges','pointer-events':'none','cursor':s1.cursor,'d':d,'fill':fill.color,'fill-opacity':fill.opacity||null,'stroke':stroke.color,'stroke-opacity':sop||null,'stroke-width':sop?(s1.lineWidth/this.scale):null,'stroke-linecap':s1.lineCap,'stroke-linejoin':s1.lineJoin,'stroke-miterlimit':s1.strokeMiterLimit,'stroke-dasharray':sop?this.parseDasharray(s1):null};elm=this.expect(elm,'path',scenes,from,attrs,s1.css);return this.append(elm,scenes,from);});});this.removeSiblings(elm);var g2;if(eventsSegments){elm=g1.nextSibling;g2=this.expect(elm,"g",scenes,0);if(!g2.parentNode){gg.appendChild(g2);}
scenes.$g=g2;elm=g2.firstChild;eventsSegments.forEach(function(segment){var from=segment.from;var pathsT=segment.top;var pathsB=segment.bottom;var P=pathsT.length;var attrsBase={'shape-rendering':'crispEdges','fill':'rgb(127,127,127)','fill-opacity':0.005,'stroke':null};pathsT.forEach(function(pathT,j){var i=from+j;var s=scenes[i];var events=s.events;if(events&&events!=="none"){var pathB=pathsB[P-j-1];var attrs=Object.create(attrsBase);attrs['pointer-events']=events;attrs.cursor=s.cursor;attrs.d=pathT.join("")+"L"+pathB[0].substr(1)+pathB[1]+"Z";elm=this.expect(elm,'path',scenes,i,attrs);elm=this.append(elm,scenes,i);}},this);},this);this.removeSiblings(elm);}
scenes.$g=gg;return(g2||g1).nextSibling;};pv.SvgScene.areaSegmentPaths=function(scenes,from,to){return this.areaSegmentCurvePaths(scenes,from,to)||this.areaSegmentStraightPaths(scenes,from,to);};pv.SvgScene.areaSegmentCurvePaths=function(scenes,from,to){var count=to-from+1;var s=scenes[from];var isBasis=s.interpolate==="basis";var isCardinal=!isBasis&&s.interpolate==="cardinal";if(isBasis||isCardinal||s.interpolate=="monotone"){var pointsT=[];var pointsB=[];for(var i=0;i<count;i++){var si=scenes[from+i];var sj=scenes[to-i];pointsT.push(si);pointsB.push({left:sj.left+sj.width,top:sj.top+sj.height});}
var pathsT,pathsB;if(isBasis){pathsT=this.curveBasisSegments(pointsT);pathsB=this.curveBasisSegments(pointsB);}else if(isCardinal){pathsT=this.curveCardinalSegments(pointsT,s.tension);pathsB=this.curveCardinalSegments(pointsB,s.tension);}else{pathsT=this.curveMonotoneSegments(pointsT);pathsB=this.curveMonotoneSegments(pointsB);}
if(pathsT||pathsT.length){return{from:from,top:pathsT,bottom:pathsB};}}};pv.SvgScene.areaSegmentStraightPaths=function(scenes,i,j){var pathsT=[];var pathsB=[];for(var k=j,m=i;i<k;i++,j--){var si=scenes[i],sj=scenes[j],pi=['M'+si.left+","+si.top],pj=['M'+(sj.left+sj.width)+","+(sj.top+sj.height)];var sk=scenes[i+1],sl=scenes[j-1];switch(si.interpolate){case'step-before':pi.push("V"+sk.top+"H"+sk.left);break;case'step-after':pi.push("H"+sk.left+"V"+sk.top);break;default:pi.push("L"+sk.left+","+sk.top);}
pj.push("L"+(sl.left+sl.width)+","+(sl.top+sl.height));pathsT.push(pi);pathsB.push(pj);}
return{from:m,top:pathsT,bottom:pathsB};};pv.SvgScene.areaJoinPaths=function(pathsT,pathsB,i,j){var fullPathT="";var fullPathB="";var N=pathsT.length;for(var k=i,l=N-1-j;k<=j;k++,l++){var pathT=pathsT[k];var pathB=pathsB[l];var dT;var dB;if(k===i){dT=pathT.join("");dB="L"+pathB[0].substr(1)+pathB[1];}else{dT=pathT[1];dB=pathB[1];}
fullPathT+=dT;fullPathB+=dB;}
return fullPathT+fullPathB+"Z";};pv.SvgScene.areaSegmentedFull=function(e,scenes){var count=scenes.length;var pathsT,pathsB;var result=this.areaSegmentCurvePaths(scenes,0,count-1);if(result){pathsT=result.top;pathsB=result.bottom;}
var s=scenes[0];for(var i=0;i<count-1;i++){var s1=scenes[i];var s2=scenes[i+1];if(!s1.visible||!s2.visible){continue;}
var fill=s1.fillStyle;var stroke=s1.strokeStyle;if(!fill.opacity&&!stroke.opacity){continue;}
var d;if(pathsT){var pathT=pathsT[i].join(""),pathB="L"+pathsB[count-i-2].join("").substr(1);d=pathT+pathB+"Z";}else{var si=s1;var sj=s2;switch(s1.interpolate){case"step-before":si=s2;break;case"step-after":sj=s1;break;}
d="M"+s1.left+","+si.top
+"L"+s2.left+","+sj.top
+"L"+(s2.left+s2.width)+","+(sj.top+sj.height)
+"L"+(s1.left+s1.width)+","+(si.top+si.height)
+"Z";}
var attrs={"shape-rendering":s1.antialias?null:"crispEdges","pointer-events":s1.events,"cursor":s1.cursor,"d":d,"fill":fill.color,"fill-opacity":fill.opacity||null,"stroke":stroke.color,"stroke-opacity":stroke.opacity||null,"stroke-width":stroke.opacity?s1.lineWidth/this.scale:null};e=this.expect(e,"path",scenes,i,attrs);if(s1.svg)this.setAttributes(e,s1.svg);if(s1.css)this.setStyle(e,s1.css);e=this.append(e,scenes,i);}
return e;};pv.SvgScene.areaPathStraight=function(scenes,i,j,s){var pointsT=[];var pointsB=[];for(var k=j;i<=k;i++,j--){var si=scenes[i],sj=scenes[j],pi=si.left+","+si.top,pj=(sj.left+sj.width)+","+(sj.top+sj.height);if(i<k){var sk=scenes[i+1],sl=scenes[j-1];switch(s.interpolate){case'step-before':pi+="V"+sk.top;pj+="H"+(sl.left+sl.width);break;case'step-after':pi+="H"+sk.left;pj+="V"+(sl.top+sl.height);break;}}
pointsT.push(pi);pointsB.push(pj);}
return pointsT.concat(pointsB).join("L");};pv.SvgScene.areaPathCurve=function(scenes,i,j,s){var pointsT=[];var pointsB=[];var pathT,pathB;for(var k=j;i<=k;i++,j--){var sj=scenes[j];pointsT.push(scenes[i]);pointsB.push({left:sj.left+sj.width,top:sj.top+sj.height});}
switch(s.interpolate){case'basis':pathT=this.curveBasis(pointsT);pathB=this.curveBasis(pointsB);break;case'cardinal':pathT=this.curveCardinal(pointsT,s.tension);pathB=this.curveCardinal(pointsB,s.tension);break;default:pathT=this.curveMonotone(pointsT);pathB=this.curveMonotone(pointsB);}
return pointsT[0].left+","+pointsT[0].top+
pathT+"L"+
pointsB[0].left+","+pointsB[0].top+
pathB;};pv.SvgScene.minBarWidth=1;pv.SvgScene.minBarHeight=1;pv.SvgScene.minBarLineWidth=0.2;pv.SvgScene.bar=function(scenes){var e=scenes.$g.firstChild;for(var i=0;i<scenes.length;i++){var s=scenes[i];if(!s.visible||Math.abs(s.width)<=1E-10||Math.abs(s.height)<=1E-10)continue;if(s.width<this.minBarWidth){s.width=this.minBarWidth;}
if(s.height<this.minBarHeight){s.height=this.minBarHeight;}
var fill=s.fillStyle,stroke=s.strokeStyle;if(!fill.opacity&&!stroke.opacity)continue;this.addFillStyleDefinition(scenes,fill);this.addFillStyleDefinition(scenes,stroke);var lineWidth;if(stroke.opacity){lineWidth=s.lineWidth;if(lineWidth<1e-10){lineWidth=0;}else{lineWidth=Math.max(this.minBarLineWidth,lineWidth/this.scale);}}else{lineWidth=null;}
e=this.expect(e,"rect",scenes,i,{"shape-rendering":s.antialias?null:"crispEdges","pointer-events":s.events,"cursor":s.cursor,"x":s.left,"y":s.top,"width":Math.max(1E-10,s.width),"height":Math.max(1E-10,s.height),"fill":fill.color,"fill-opacity":fill.opacity||null,"stroke":stroke.color,"stroke-opacity":stroke.opacity||null,"stroke-width":lineWidth,"stroke-linecap":s.lineCap,"stroke-dasharray":stroke.opacity?this.parseDasharray(s):null});if(s.svg)this.setAttributes(e,s.svg);if(s.css)this.setStyle(e,s.css);e=this.append(e,scenes,i);}
return e;};pv.SvgScene.dot=function(scenes){var e=scenes.$g.firstChild;for(var i=0;i<scenes.length;i++){var s=scenes[i];if(!s.visible)continue;var fill=s.fillStyle,stroke=s.strokeStyle;if(!fill.opacity&&!stroke.opacity)continue;this.addFillStyleDefinition(scenes,fill);this.addFillStyleDefinition(scenes,stroke);var radius=s.shapeRadius,path=null;switch(s.shape){case"cross":{path="M"+-radius+","+-radius
+"L"+radius+","+radius
+"M"+radius+","+-radius
+"L"+-radius+","+radius;break;}
case"triangle":{var h=radius,w=radius*1.1547;path="M0,"+h
+"L"+w+","+-h
+" "+-w+","+-h
+"Z";break;}
case"diamond":{radius*=Math.SQRT2;path="M0,"+-radius
+"L"+radius+",0"
+" 0,"+radius
+" "+-radius+",0"
+"Z";break;}
case"square":{path="M"+-radius+","+-radius
+"L"+radius+","+-radius
+" "+radius+","+radius
+" "+-radius+","+radius
+"Z";break;}
case"tick":{path="M0,0L0,"+-s.shapeSize;break;}
case"bar":{path="M0,"+(s.shapeSize/2)+"L0,"+-(s.shapeSize/2);break;}}
var svg={"shape-rendering":s.antialias?null:"crispEdges","pointer-events":s.events,"cursor":s.cursor,"fill":fill.color,"fill-opacity":fill.opacity||null,"stroke":stroke.color,"stroke-opacity":stroke.opacity||null,"stroke-width":stroke.opacity?s.lineWidth/this.scale:null,"stroke-linecap":s.lineCap,"stroke-dasharray":stroke.opacity?this.parseDasharray(s):null};if(path){svg.transform="translate("+s.left+","+s.top+")";if(s.shapeAngle)svg.transform+=" rotate("+180*s.shapeAngle/Math.PI+")";svg.d=path;e=this.expect(e,"path",scenes,i,svg);}else{svg.cx=s.left;svg.cy=s.top;svg.r=radius;e=this.expect(e,"circle",scenes,i,svg);}
if(s.svg)this.setAttributes(e,s.svg);if(s.css)this.setStyle(e,s.css);e=this.append(e,scenes,i);}
return e;};pv.SvgScene.image=function(scenes){var e=scenes.$g.firstChild;for(var i=0;i<scenes.length;i++){var s=scenes[i];if(!s.visible)continue;e=this.fill(e,scenes,i);if(s.image){e=this.expect(e,"foreignObject",scenes,i,{"cursor":s.cursor,"x":s.left,"y":s.top,"width":s.width,"height":s.height});if(s.svg)this.setAttributes(e,s.svg);if(s.css)this.setStyle(e,s.css);var c=e.firstChild||e.appendChild(document.createElementNS(this.xhtml,"canvas"));c.$scene={scenes:scenes,index:i};c.style.width=s.width;c.style.height=s.height;c.width=s.imageWidth;c.height=s.imageHeight;c.getContext("2d").putImageData(s.image,0,0);}else{e=this.expect(e,"image",scenes,i,{"preserveAspectRatio":"none","cursor":s.cursor,"x":s.left,"y":s.top,"width":s.width,"height":s.height});if(s.svg)this.setAttributes(e,s.svg);if(s.css)this.setStyle(e,s.css);e.setAttributeNS(this.xlink,"xlink:href",s.url);}
e=this.append(e,scenes,i);e=this.stroke(e,scenes,i);}
return e;};pv.SvgScene.label=function(scenes){var e=scenes.$g.firstChild;for(var i=0;i<scenes.length;i++){var s=scenes[i];if(!s.visible)continue;var fill=s.textStyle;if(!fill.opacity||!s.text)continue;var x=0,y=0,dy=0,anchor="start";switch(s.textBaseline){case"middle":if(pv.renderer()=='svgweb')
y=3;else
dy=".35em";break;case"top":if(pv.renderer()=='svgweb'){y=9+s.textMargin;}else{dy=".71em";y=s.textMargin;}
break;case"bottom":y="-"+s.textMargin;break;}
switch(s.textAlign){case"right":anchor="end";x="-"+s.textMargin;break;case"center":anchor="middle";break;case"left":x=s.textMargin;break;}
e=this.expect(e,"text",scenes,i,{"pointer-events":s.events,"cursor":s.cursor,"x":x,"y":y,"dy":dy,"transform":"translate("+s.left+","+s.top+")"
+(s.textAngle?" rotate("+180*s.textAngle/Math.PI+")":"")
+(this.scale!=1?" scale("+1/this.scale+")":""),"fill":fill.color,"fill-opacity":fill.opacity||null,"text-anchor":anchor},{"font":s.font,"text-shadow":s.textShadow,"text-decoration":s.textDecoration});if(s.svg)this.setAttributes(e,s.svg);if(s.css)this.setStyle(e,s.css);if(e.firstChild)e.firstChild.nodeValue=s.text;else{if(pv.renderer()=="svgweb"){e.appendChild(document.createTextNode(s.text,true));}else{e.appendChild(document.createTextNode(s.text));}}
e=this.append(e,scenes,i);}
return e;};pv.SvgScene.line=function(scenes){var e=scenes.$g.firstChild;var count=scenes.length;if(!count){return e;}
var s=scenes[0];if(s.segmented==='smart'){return this.lineSegmentedSmart(e,scenes);}
if(count<2){return e;}
if(s.segmented){return this.lineSegmentedFull(e,scenes);}
return this.lineFixed(e,scenes);};pv.SvgScene.lineFixed=function(elm,scenes){var count=scenes.length;if(count===1){return this.lineAreaDotAlone(elm,scenes,0);}
var s=scenes[0];if(!s.visible){return elm;}
var fill=s.fillStyle;var stroke=s.strokeStyle;if(!fill.opacity&&!stroke.opacity){return elm;}
this.addFillStyleDefinition(scenes,fill);this.addFillStyleDefinition(scenes,stroke);var d="M"+s.left+","+s.top;var curveInterpolated=(count>2);if(curveInterpolated){switch(s.interpolate){case"basis":d+=this.curveBasis(scenes);break;case"cardinal":d+=this.curveCardinal(scenes,s.tension);break;case"monotone":d+=this.curveMonotone(scenes);break;default:curveInterpolated=false;}}
if(!curveInterpolated){for(var i=1;i<count;i++){d+=this.lineSegmentPath(scenes[i-1],scenes[i]);}}
var sop=stroke.opacity;var attrs={'shape-rendering':s.antialias?null:'crispEdges','pointer-events':s.events,'cursor':s.cursor,'d':d,'fill':fill.color,'fill-opacity':fill.opacity||null,'stroke':stroke.color,'stroke-opacity':sop||null,'stroke-width':sop?(s.lineWidth/this.scale):null,'stroke-linecap':s.lineCap,'stroke-linejoin':s.lineJoin,'stroke-miterlimit':s.strokeMiterLimit,'stroke-dasharray':sop?this.parseDasharray(s):null};elm=this.expect(elm,'path',scenes,0,attrs,s.css);if(s.svg)this.setAttributes(elm,s.svg);return this.append(elm,scenes,0);};pv.SvgScene.lineSegmentedSmart=function(elm,scenes){if(!elm){elm=scenes.$g.appendChild(this.create("g"));}
var gg=elm;elm=gg.firstChild;var g1=this.expect(elm,"g",scenes,0,{'pointer-events':'none'});if(!g1.parentNode){gg.appendChild(g1);}
scenes.$g=g1;elm=g1.firstChild;var eventsSegments=scenes.mark.$hasHandlers?[]:null;elm=this.eachLineAreaSegment(elm,scenes,function(elm,scenes,from,to){var paths=this.lineSegmentPaths(scenes,from,to);var fromp=from;if(eventsSegments){eventsSegments.push({from:from,paths:paths});}
var options={breakOnKeyChange:true,from:from,to:to};return this.eachLineAreaSegment(elm,scenes,options,function(elm,scenes,from,to){var s1=scenes[from];var fill=s1.fillStyle;this.addFillStyleDefinition(scenes,fill);var stroke=s1.strokeStyle;this.addFillStyleDefinition(scenes,stroke);if(from===to){return this.lineAreaDotAlone(elm,scenes,from);}
var d=this.lineJoinPaths(paths,from-fromp,to-fromp-1);var sop=stroke.opacity;var attrs={'shape-rendering':s1.antialias?null:'crispEdges','pointer-events':'none','cursor':s1.cursor,'d':d,'fill':fill.color,'fill-opacity':fill.opacity||null,'stroke':stroke.color,'stroke-opacity':sop||null,'stroke-width':sop?(s1.lineWidth/this.scale):null,'stroke-linecap':s1.lineCap,'stroke-linejoin':s1.lineJoin,'stroke-miterlimit':s1.strokeMiterLimit,'stroke-dasharray':sop?this.parseDasharray(s1):null};elm=this.expect(elm,'path',scenes,from,attrs,s1.css);return this.append(elm,scenes,from);});});this.removeSiblings(elm);var g2;if(eventsSegments){elm=g1.nextSibling;g2=this.expect(elm,"g",scenes,0);if(!g2.parentNode){gg.appendChild(g2);}
scenes.$g=g2;elm=g2.firstChild;eventsSegments.forEach(function(segment){var from=segment.from;var paths=segment.paths;var attrsBase={'shape-rendering':'crispEdges','fill':'rgb(127,127,127)','fill-opacity':0.005,'stroke':'rgb(127,127,127)','stroke-opacity':0.005,'stroke-width':10,'stroke-dasharray':null};paths.forEach(function(path,j){var i=from+j;var s=scenes[i];var events=s.events;if(events&&events!=='none'){var attrs=Object.create(attrsBase);attrs['pointer-events']=events;attrs.cursor=s.cursor;attrs.d=path.join('');elm=this.expect(elm,'path',scenes,i,attrs);elm=this.append(elm,scenes,i);}},this);},this);this.removeSiblings(elm);}
scenes.$g=gg;return(g2||g1).nextSibling;};pv.SvgScene.lineSegmentedFull=function(e,scenes){var s=scenes[0];var paths;switch(s.interpolate){case"basis":paths=this.curveBasisSegments(scenes);break;case"cardinal":paths=this.curveCardinalSegments(scenes,s.tension);break;case"monotone":paths=this.curveMonotoneSegments(scenes);break;}
for(var i=0,n=scenes.length-1;i<n;i++){var s1=scenes[i],s2=scenes[i+1];if(!s1.visible||!s2.visible)continue;var stroke=s1.strokeStyle,fill=pv.FillStyle.transparent;if(!stroke.opacity)continue;var d;if((s1.interpolate=="linear")&&(s1.lineJoin=="miter")){fill=stroke;stroke=pv.FillStyle.transparent;d=this.pathJoin(scenes[i-1],s1,s2,scenes[i+2]);}else if(paths){d=paths[i].join("");}else{d="M"+s1.left+","+s1.top+this.lineSegmentPath(s1,s2);}
e=this.expect(e,"path",scenes,i,{"shape-rendering":s1.antialias?null:"crispEdges","pointer-events":s1.events,"cursor":s1.cursor,"d":d,"fill":fill.color,"fill-opacity":fill.opacity||null,"stroke":stroke.color,"stroke-opacity":stroke.opacity||null,"stroke-width":stroke.opacity?s1.lineWidth/this.scale:null,"stroke-linejoin":s1.lineJoin});if(s1.svg)this.setAttributes(e,s1.svg);if(s1.css)this.setStyle(e,s1.css);e=this.append(e,scenes,i);}
return e;};pv.SvgScene.lineSegmentPath=function(s1,s2){var l=1;switch(s1.interpolate){case"polar-reverse":l=0;case"polar":{var dx=s2.left-s1.left,dy=s2.top-s1.top,e=1-s1.eccentricity,r=Math.sqrt(dx*dx+dy*dy)/(2*e);if((e<=0)||(e>1))break;return"A"+r+","+r+" 0 0,"+l+" "+s2.left+","+s2.top;}
case"step-before":return"V"+s2.top+"H"+s2.left;case"step-after":return"H"+s2.left+"V"+s2.top;}
return"L"+s2.left+","+s2.top;};pv.SvgScene.lineSegmentPaths=function(scenes,from,to){var s=scenes[from];var paths;switch(s.interpolate){case"basis":paths=this.curveBasisSegments(scenes,from,to);break;case"cardinal":paths=this.curveCardinalSegments(scenes,s.tension,from,to);break;case"monotone":paths=this.curveMonotoneSegments(scenes,from,to);break;}
if(!paths||!paths.length){paths=[];for(var i=from+1;i<=to;i++){var s1=scenes[i-1];var s2=scenes[i];paths.push(["M"+s1.left+","+s1.top,this.lineSegmentPath(s1,s2)]);}}
return paths;};pv.strokeMiterLimit=4;pv.SvgScene.pathJoin=function(s0,s1,s2,s3){var pts=[];var miterLimit,miterRatio,miterLength;var w1=s1.lineWidth/this.scale;var p1=pv.vector(s1.left,s1.top);var p2=pv.vector(s2.left,s2.top);var p21=p2.minus(p1);var v21=p21.perp().norm();var w21=v21.times(w1/2);var a=p1.plus(w21);var d=p1.minus(w21);var b=p2.plus(w21);var c=p2.minus(w21);if(!s0||!s0.visible){pts.push(d,a);}else{var p0=pv.vector(s0.left,s0.top);var p10=p1.minus(p0);var v10=p10.perp().norm();var v1=v10.plus(v21).norm();var am=this.lineIntersect(p1,v1,a,p21);var dm=this.lineIntersect(p1,v1,d,p21);miterLength=am.minus(dm).length();var w0=s0.lineWidth/this.scale;var w10avg=(w1+w0)/2;miterRatio=miterLength/w10avg;miterLimit=s1.strokeMiterLimit||pv.strokeMiterLimit;if(miterRatio<=miterLimit){pts.push(dm,am);}else{var p12=p21.times(-1);var v1Outer=p10.norm().plus(p12.norm()).norm();var bevel10=p1.plus(v1Outer.times(w10avg/2));if(v1Outer.dot(v21)>=0){pts.push(dm,bevel10,a);}else{pts.push(d,bevel10,am);}}}
if(!s3||!s3.visible){pts.push(b,c);}else{var p3=pv.vector(s3.left,s3.top);var p32=p3.minus(p2);var v32=p32.perp().norm();var v2=v32.plus(v21).norm();var bm=this.lineIntersect(p2,v2,b,p21);var cm=this.lineIntersect(p2,v2,c,p21);miterLength=bm.minus(cm).length();var w3=s3.lineWidth/this.scale;var w31avg=(w3+w1)/2;miterRatio=miterLength/w31avg;miterLimit=s2.strokeMiterLimit||pv.strokeMiterLimit;if(miterRatio<=miterLimit){pts.push(bm,cm);}else{var p23=p32.times(-1);var v2Outer=p21.norm().plus(p23.norm()).norm();var bevel31=p2.plus(v2Outer.times(w31avg/2));if(v2Outer.dot(v21)>=0){pts.push(b,bevel31,cm);}else{pts.push(bm,bevel31,c);}}}
var pt=pts.shift();return"M"+pt.x+","+pt.y+"L"+pts.map(function(pt2){return pt2.x+","+pt2.y;}).join(" ");};pv.SvgScene.lineIntersect=function(o1,d1,o2,d2){return o1.plus(d1.times(o2.minus(o1).dot(d2.perp())/d1.dot(d2.perp())));};pv.SvgScene.lineJoinPaths=function(paths,from,to){var d=paths[from].join("");for(var i=from+1;i<=to;i++){d+=paths[i][1];}
return d;};pv.SvgScene.lineAreaDotAlone=function(elm,scenes,i){return elm;};pv.SvgScene.eachLineAreaSegment=function(elm,scenes,keyArgs,lineAreaSegment){if(typeof keyArgs==='function'){lineAreaSegment=keyArgs;keyArgs=null;}
var breakOnKeyChange=pv.get(keyArgs,'breakOnKeyChange',false);var from=pv.get(keyArgs,'from')||0;var to=pv.get(keyArgs,'to',scenes.length-1);var ki,kf;if(breakOnKeyChange){ki=[];kf=[];}
var i=from;while(i<=to){var si=scenes[i];if(!this.isSceneVisible(si)){i++;continue;}
if(breakOnKeyChange){this.lineAreaSceneKey(si,ki);}
var i2;var f=i;while(true){var f2=f+1;if(f2>to){i2=f2;break;}
var sf=scenes[f2];if(!this.isSceneVisible(sf)){i2=f2+1;break;}
f=f2;if(breakOnKeyChange){this.lineAreaSceneKey(sf,kf);if(!this.equalSceneKeys(ki,kf)){i2=f;break;}}}
elm=lineAreaSegment.call(this,elm,scenes,i,f,keyArgs);i=i2;}
return elm;};pv.SvgScene.lineAreaSceneKey=function(s,k){k[0]=s.fillStyle.key;k[1]=s.strokeStyle.key;k[2]=s.lineWidth;k[3]=(s.strokeDasharray||'none');k[4]=s.interpolate;return k;};pv.SvgScene.isSceneVisible=function(s){return s.visible&&(s.fillStyle.opacity>0||s.strokeStyle.opacity>0);};pv.SvgScene.equalSceneKeys=function(ka,kb){for(var i=0,K=ka.length;i<K;i++){if(ka[i]!==kb[i]){return false;}}
return true;};pv.SvgScene.panel=function(scenes){var g=scenes.$g,e=g&&g.firstChild;var complete=false;for(var i=0;i<scenes.length;i++){var s=scenes[i];if(!s.visible)continue;if(!scenes.parent){if(pv.renderer()!=="batik"){s.canvas.style.display="inline-block";}
if(g&&(g.parentNode!=s.canvas)){g=s.canvas.firstChild;e=g&&g.firstChild;}
if(!g){g=this.create(pv.renderer()!=="batik"?"svg":"g");g.setAttribute("font-size","10px");g.setAttribute("font-family","sans-serif");g.setAttribute("fill","none");g.setAttribute("stroke","none");g.setAttribute("stroke-width",1.5);g.setAttribute("style","-webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;");if(typeof g.onselectstart!=='undefined'){g.setAttribute('unselectable','on');g.onselectstart=function(){return false;};}
if(pv.renderer()==="svgweb"){g.setAttribute("width",s.width+s.left+s.right);g.setAttribute("height",s.height+s.top+s.bottom);var frag=document.createDocumentFragment(true);g.addEventListener('SVGLoad',function(){var me=this;(function(){if(complete){complete=false;me.appendChild(frag);for(var j=0;j<pv.Scene.events.length;j++){me.addEventListener(pv.Scene.events[j],pv.SvgScene.dispatch,false);}
scenes.$g=me;scenes.$g.__ready=true;}else{setTimeout(arguments.callee,10);}})();},false);svgweb.appendChild(g,s.canvas);g=frag;}else{for(var j=0;j<this.events.length;j++){g.addEventListener(this.events[j],this.dispatch,false);}
g=s.canvas.appendChild(g);g.__ready=true;}
g.$defs=g.appendChild(this.create("defs"));e=null;}
if(e&&e.tagName==='defs'){e=e.nextSibling;}
scenes.$g=g;if(g.__ready){g.setAttribute("width",s.width+s.left+s.right);g.setAttribute("height",s.height+s.top+s.bottom);}}
if(s.overflow==="hidden"){var id=pv.id().toString(36),c=this.expect(e,"g",scenes,i,{"clip-path":"url(#"+id+")"});if(!c.parentNode)g.appendChild(c);scenes.$g=g=c;e=c.firstChild;e=this.expect(e,"clipPath",scenes,i,{"id":id});var r=e.firstChild||e.appendChild(this.create("rect"));r.setAttribute("x",s.left);r.setAttribute("y",s.top);r.setAttribute("width",s.width);r.setAttribute("height",s.height);if(!e.parentNode)g.appendChild(e);e=e.nextSibling;}
e=this.fill(e,scenes,i);var k=this.scale,t=s.transform,x=s.left+t.x,y=s.top+t.y;this.scale*=t.k;if(s.children.length){var attrs={"transform":"translate("+x+","+y+")"+
(t.k!=1?" scale("+t.k+")":"")};this.eachChild(scenes,i,function(childScenes){childScenes.$g=e=this.expect(e,"g",scenes,i,attrs);this.updateAll(childScenes);if(!e.parentNode)g.appendChild(e);e=e.nextSibling;});}
this.scale=k;e=this.stroke(e,scenes,i);if(s.overflow==="hidden"){scenes.$g=g=c.parentNode;e=c.nextSibling;}}
complete=true;return e;};pv.SvgScene.eachChild=function(scenes,i,fun,ctx){if(scenes.mark.zOrderChildCount){var sorted=scenes[i].children.slice(0);sorted.sort(function(scenes1,scenes2){var compare=scenes1.mark._zOrder-scenes2.mark._zOrder;if(compare===0){compare=scenes1.childIndex-scenes2.childIndex;}
return compare;});sorted.forEach(fun,ctx||this);}else{scenes[i].children.forEach(fun,ctx||this);}};pv.SvgScene.fill=function(e,scenes,i){var s=scenes[i],fill=s.fillStyle;if(fill.opacity||s.events=="all"){this.addFillStyleDefinition(scenes,fill);e=this.expect(e,"rect",scenes,i,{"shape-rendering":s.antialias?null:"crispEdges","pointer-events":s.events,"cursor":s.cursor,"x":s.left,"y":s.top,"width":s.width,"height":s.height,"fill":fill.color,"fill-opacity":fill.opacity,"stroke":null});e=this.append(e,scenes,i);}
return e;};pv.SvgScene.stroke=function(e,scenes,i){var s=scenes[i],stroke=s.strokeStyle;if(stroke.opacity||s.events=="all"){e=this.expect(e,"rect",scenes,i,{"shape-rendering":s.antialias?null:"crispEdges","pointer-events":s.events=="all"?"stroke":s.events,"cursor":s.cursor,"x":s.left,"y":s.top,"width":Math.max(1E-10,s.width),"height":Math.max(1E-10,s.height),"fill":null,"stroke":stroke.color,"stroke-opacity":stroke.opacity,"stroke-width":s.lineWidth/this.scale,"stroke-linecap":s.lineCap,"stroke-dasharray":stroke.opacity?this.parseDasharray(s):null});e=this.append(e,scenes,i);}
return e;};pv.SvgScene.minRuleLineWidth=1;pv.SvgScene.rule=function(scenes){var e=scenes.$g.firstChild;for(var i=0;i<scenes.length;i++){var s=scenes[i];if(!s.visible)continue;var stroke=s.strokeStyle;if(!stroke.opacity)continue;var lineWidth=s.lineWidth;if(lineWidth<1e-10){lineWidth=0;}else{lineWidth=Math.max(this.minRuleLineWidth,lineWidth/this.scale);}
e=this.expect(e,"line",scenes,i,{"shape-rendering":s.antialias?null:"crispEdges","pointer-events":s.events,"cursor":s.cursor,"x1":s.left,"y1":s.top,"x2":s.left+s.width,"y2":s.top+s.height,"stroke":stroke.color,"stroke-opacity":stroke.opacity,"stroke-width":lineWidth,"stroke-linecap":s.lineCap,"stroke-dasharray":stroke.opacity?this.parseDasharray(s):null});if(s.svg)this.setAttributes(e,s.svg);if(s.css)this.setStyle(e,s.css);e=this.append(e,scenes,i);}
return e;};pv.SvgScene.wedge=function(scenes){var e=scenes.$g.firstChild;for(var i=0;i<scenes.length;i++){var s=scenes[i];if(!s.visible)continue;var fill=s.fillStyle,stroke=s.strokeStyle;if(!fill.opacity&&!stroke.opacity)continue;var r1=s.innerRadius,r2=s.outerRadius,a=Math.abs(s.angle),p;if(a>=2*Math.PI){if(r1){p="M0,"+r2
+"A"+r2+","+r2+" 0 1,1 0,"+(-r2)
+"A"+r2+","+r2+" 0 1,1 0,"+r2
+"M0,"+r1
+"A"+r1+","+r1+" 0 1,1 0,"+(-r1)
+"A"+r1+","+r1+" 0 1,1 0,"+r1
+"Z";}else{p="M0,"+r2
+"A"+r2+","+r2+" 0 1,1 0,"+(-r2)
+"A"+r2+","+r2+" 0 1,1 0,"+r2
+"Z";}}else{var sa=Math.min(s.startAngle,s.endAngle),ea=Math.max(s.startAngle,s.endAngle),c1=Math.cos(sa),c2=Math.cos(ea),s1=Math.sin(sa),s2=Math.sin(ea);if(r1){p="M"+r2*c1+","+r2*s1
+"A"+r2+","+r2+" 0 "
+((a<Math.PI)?"0":"1")+",1 "
+r2*c2+","+r2*s2
+"L"+r1*c2+","+r1*s2
+"A"+r1+","+r1+" 0 "
+((a<Math.PI)?"0":"1")+",0 "
+r1*c1+","+r1*s1+"Z";}else{p="M"+r2*c1+","+r2*s1
+"A"+r2+","+r2+" 0 "
+((a<Math.PI)?"0":"1")+",1 "
+r2*c2+","+r2*s2+"L0,0Z";}}
this.addFillStyleDefinition(scenes,fill);this.addFillStyleDefinition(scenes,stroke);e=this.expect(e,"path",scenes,i,{"shape-rendering":s.antialias?null:"crispEdges","pointer-events":s.events,"cursor":s.cursor,"transform":"translate("+s.left+","+s.top+")","d":p,"fill":fill.color,"fill-rule":"evenodd","fill-opacity":fill.opacity||null,"stroke":stroke.color,"stroke-opacity":stroke.opacity||null,"stroke-width":stroke.opacity?s.lineWidth/this.scale:null,"stroke-linejoin":s.lineJoin,"stroke-miterlimit":s.strokeMiterLimit,"stroke-linecap":s.lineCap,"stroke-dasharray":stroke.opacity?this.parseDasharray(s):null});if(s.svg)this.setAttributes(e,s.svg);if(s.css)this.setStyle(e,s.css);e=this.append(e,scenes,i);}
return e;};pv.Mark=function(){this.$properties=[];this.$propertiesMap={};this.$handlers={};};pv.Mark.prototype.properties={};pv.Mark.cast={};pv.Mark.prototype.property=function(name,cast){if(!this.hasOwnProperty("properties")){this.properties=pv.extend(this.properties);}
this.properties[name]=true;pv.Mark.prototype.propertyMethod(name,false,pv.Mark.cast[name]=cast);return this;};pv.Mark.prototype.localProperty=function(name,cast){if(!this.hasOwnProperty("properties")){this.properties=pv.extend(this.properties);}
this.properties[name]=true;var currCast=pv.Mark.cast[name];if(cast){pv.Mark.cast[name]=currCast=cast;}
this.propertyMethod(name,false,currCast);return this;};pv.Mark.prototype.def=function(name,v){this.propertyMethod(name,true);return this[name](arguments.length>1?v:null);};pv.Mark.prototype.propertyMethod=function(name,isDef,cast){if(!cast)cast=pv.Mark.cast[name];this[name]=function(v,tag){if(isDef&&this.scene){var defs=this.scene.defs;if(arguments.length){defs[name]={id:(v==null)?0:pv.id(),value:((v!=null)&&cast)?cast(v):v};return this;}
var def=defs[name];return def?def.value:null;}
if(arguments.length){this.setPropertyValue(name,v,isDef,cast,false,tag);return this;}
var propEval=pv.propertyEval;if(propEval){var binds=this.binds;var propRead=binds.properties[name];if(propRead){var net=binds.net;var readNetIndex=net[name];if(readNetIndex==null){readNetIndex=net[name]=0;}
(propRead.dependents||(propRead.dependents={}))[propEval.name]=true;(pv.propertyEvalDependencies||(pv.propertyEvalDependencies={}))[name]=true;if(readNetIndex>=pv.propertyEvalNetIndex){pv.propertyEvalNetIndex=readNetIndex+1;}}}
return this.instance()[name];};};pv.Mark.funPropertyCaller=function(fun,cast){var stack=pv.Mark.stack;return function(){var value=fun.apply(this,stack);return value!=null?cast(value):value;};};pv.Mark.prototype.setPropertyValue=function(name,v,isDef,cast,chain,tag){var type=!isDef<<1|(typeof v==="function");if(type&1&&cast){v=pv.Mark.funPropertyCaller(v,cast);}else if(v!=null&&cast){v=cast(v);}
var propertiesMap=this.$propertiesMap;var properties=this.$properties;var p={name:name,id:pv.id(),value:v,type:type,tag:tag};var specified=propertiesMap[name];propertiesMap[name]=p;if(specified){for(var i=0;i<properties.length;i++){if(properties[i]===specified){properties.splice(i,1);break;}}}
properties.push(p);if(chain&&specified&&type===3){p.proto=specified;p.root=specified.root||specified;}
return p;};pv.Mark.prototype.intercept=function(name,v,keyArgs){this.setPropertyValue(name,v,false,pv.get(keyArgs,'noCast')?null:pv.Mark.cast[name],true,pv.get(keyArgs,'tag'));return this;};pv.Mark.prototype.propertyValue=function(name,inherit){var p=this.$propertiesMap[name];if(p){return p.value;}
if(inherit){if(this.proto){var value=this.proto.propertyValueRecursive(name);if(value!==undefined){return value;}}
return this.defaults.propertyValueRecursive(name);}};pv.Mark.prototype.propertyValueRecursive=function(name){var p=this.$propertiesMap[name];if(p){return p.value;}
if(this.proto){return this.proto.propertyValueRecursive(name);}};pv.Mark.stack=[];pv.Mark.prototype.property("data").property("visible",Boolean).property("css",Object).property("svg",Object).property("left",Number).property("right",Number).property("top",Number).property("bottom",Number).property("cursor",String).property("title",String).property("reverse",Boolean).property("antialias",Boolean).property("events",String).property("id",String);pv.Mark.prototype.childIndex=-1;pv.Mark.prototype.index=-1;pv.Mark.prototype.scale=1;pv.Mark.prototype._zOrder=0;pv.Mark.prototype.defaults=new pv.Mark().data(function(d){return[d];}).visible(true).antialias(true).events("painted");pv.Mark.prototype.extend=function(proto){this.proto=proto;this.target=proto.target;return this;};pv.Mark.prototype.add=function(type){return this.parent.add(type).extend(this);};pv.Mark.prototype.zOrder=function(zOrder){if(!arguments.length){return this._zOrder;}
zOrder=(+zOrder)||0;if(this._zOrder!==zOrder){var p=this.parent;if(p&&this._zOrder!==0){p.zOrderChildCount--;}
this._zOrder=zOrder;if(p&&this._zOrder!==0){p.zOrderChildCount++;}}
return this;};pv.Mark.prototype.anchor=function(name){if(!name)name="center";return new pv.Anchor(this).name(name).data(function(){return this.scene.target.map(function(s){return s.data;});}).visible(function(){return this.scene.target[this.index].visible;}).id(function(){return this.scene.target[this.index].id;}).left(function(){var s=this.scene.target[this.index],w=s.width||0;switch(this.name()){case"bottom":case"top":case"center":return s.left+w/2;case"left":return null;}
return s.left+w;}).top(function(){var s=this.scene.target[this.index],h=s.height||0;switch(this.name()){case"left":case"right":case"center":return s.top+h/2;case"top":return null;}
return s.top+h;}).right(function(){var s=this.scene.target[this.index];return this.name()=="left"?s.right+(s.width||0):null;}).bottom(function(){var s=this.scene.target[this.index];return this.name()=="top"?s.bottom+(s.height||0):null;}).textAlign(function(){switch(this.name()){case"bottom":case"top":case"center":return"center";case"right":return"right";}
return"left";}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"top";}
return"bottom";});};pv.Mark.prototype.anchorTarget=function(){return this.target;};pv.Mark.prototype.margin=function(n){return this.left(n).right(n).top(n).bottom(n);};pv.Mark.prototype.instance=function(defaultIndex){var scene=this.scene||this.parent.instance(-1).children[this.childIndex],index=(defaultIndex==null)||this.hasOwnProperty("index")?this.index:defaultIndex;return scene[index<0?scene.length-1:index];};pv.Mark.prototype.instances=function(source){var mark=this,index=[],scene;while(!(scene=mark.scene)){source=source.parent;index.push({index:source.index,childIndex:mark.childIndex});mark=mark.parent;}
while(index.length){var i=index.pop();scene=scene[i.index].children[i.childIndex];}
if(this.hasOwnProperty("index")){var s=pv.extend(scene[this.index]);s.right=s.top=s.left=s.bottom=0;return[s];}
return scene;};pv.Mark.prototype.first=function(){return this.scene[0];};pv.Mark.prototype.last=function(){return this.scene[this.scene.length-1];};pv.Mark.prototype.sibling=function(){return(this.index==0)?null:this.scene[this.index-1];};pv.Mark.prototype.cousin=function(){var p=this.parent,s=p&&p.sibling();return(s&&s.children)?s.children[this.childIndex][this.index]:null;};pv.Mark.prototype.render=function(){if(this.parent&&!this.root.scene){this.root.render();return;}
this.renderCore();};pv.Mark.prototype.renderCore=function(){var parent=this.parent,stack=pv.Mark.stack,S=stack.length;var indexes=[];for(var mark=this;mark.parent;mark=mark.parent){indexes.unshift(mark.childIndex);}
var L=indexes.length;function render(mark,depth,scale){mark.scale=scale;if(depth<L){var addStack=(depth>=stack.length);if(addStack){stack.unshift(null);}
if(mark.hasOwnProperty("index")){renderCurrentInstance(mark,depth,scale,addStack);}else{for(var i=0,n=mark.scene.length;i<n;i++){mark.index=i;renderCurrentInstance(mark,depth,scale,addStack);}
delete mark.index;}
if(addStack){stack.shift();}}else{mark.build();pv.Scene.scale=scale;pv.Scene.updateAll(mark.scene);}
delete mark.scale;}
function renderCurrentInstance(mark,depth,scale,fillStack){var s=mark.scene[mark.index],i;if(s.visible){var childMarks=mark.children;var childScenez=s.children;var childIndex=indexes[depth];var childMark=childMarks[childIndex];if(!childMark.scene){childIndex++;}
for(i=0;i<childIndex;i++){childMarks[i].scene=childScenez[i];}
if(fillStack){stack[0]=s.data;}
render(childMark,depth+1,scale*s.transform.k);for(i=0;i<childIndex;i++){childMarks[i].scene=undefined;}}}
this.bind();while(parent&&!parent.hasOwnProperty("index")){parent=parent.parent;}
try{this.context(parent?parent.scene:undefined,parent?parent.index:-1,function(){render(this.root,0,1);});}catch(e){if(stack.length>S){stack.length=S;}}};pv.Mark.prototype.bind=function(){var seen={},data,required=[],types=[[],[],[],[]],bindPropStrategy={'data':function(p){data=p;},'visible':function(p){required.push(p);}},defBindPropStrategy=function(p){types[p.type].push(p);};bindPropStrategy.id=bindPropStrategy.visible;var types0=types[0],types1=types[1],types2=types[2],types3=types[3];function bind(mark){do{var properties=mark.$properties;var i=properties.length;while(i--){var p=properties[i];var name=p.name;var pLeaf=seen[name];if(!pLeaf){seen[name]=p;(bindPropStrategy[name]||defBindPropStrategy)(p);}else if(pLeaf.type===3){var pRoot=pLeaf.root;pLeaf.root=p;if(!pRoot){pLeaf.proto=p;}
else if(!pRoot.proto){pRoot.proto=p;}}}}while((mark=mark.proto));}
bind(this);bind(this.defaults);types1.reverse();types3.reverse();var mark=this;var props=mark.properties;do{for(var name in props){if(!(name in seen)){types2.push(seen[name]={name:name,type:2,value:null});}}}while((mark=mark.proto));var defs;if(types0.length||types1.length){defs=types0.concat(types1);for(var i=0,D=defs.length;i<D;i++){this.propertyMethod(defs[i].name,true);}}else{defs=[];}
this.binds={properties:seen,net:{},data:data,defs:defs,required:required,optional:pv.blend(types)};};pv.Mark.prototype.updateNet=function(pDependent,netIndex){var binds=this.binds;var props=binds.properties;var net=binds.net;propagateRecursive(pDependent,netIndex);function propagateRecursive(p,minNetIndex){if(minNetIndex>(net[p.name]||0)){net[p.name]=minNetIndex;var deps=p.dependents;if(deps){minNetIndex++;for(var depName in deps){if(deps.hasOwnProperty(depName)){var pDep=props[depName];if(pDep){propagateRecursive(pDep,minNetIndex);}}}}}}};pv.Mark.prototype.build=function(){var scene=this.scene,stack=pv.Mark.stack;if(!scene){scene=this.scene=[];scene.mark=this;scene.type=this.type;scene.childIndex=this.childIndex;if(this.parent){scene.parent=this.parent.scene;scene.parentIndex=this.parent.index;}}
if(this.target)scene.target=this.target.instances(scene);var bdefs=this.binds.defs;if(bdefs.length){var defs=scene.defs||(scene.defs={});for(var i=0,B=bdefs.length;i<B;i++){var p=bdefs[i],d=defs[p.name];if(!d||(p.id>d.id)){var fval=p.value;defs[p.name]={id:0,value:(p.type&1)?p.value.apply(this,stack):p.value};}}}
var data=this.evalProperty(this.binds.data);var markProto=pv.Mark.prototype;stack.unshift(null);try{var L=scene.length=data.length;for(var i=0;i<L;i++){markProto.index=this.index=i;var instance=scene[i]||(scene[i]={});instance.data=stack[0]=data[i];this.buildInstance(instance);}}finally{markProto.index=-1;delete this.index;stack.shift();}
return this;};pv.Mark.prototype.buildProperties=function(s,properties){var stack=pv.Mark.stack;var oldProtoProp=pv.propertyProto;try{for(var i=0,n=properties.length;i<n;i++){var p=properties[i];s[p.name]=_buildByPropType[p.type].call(this,p,stack);}}finally{pv.propertyProto=oldProtoProp;}};var _buildByPropType=[function(p){return this.scene.defs[p.name].value;},null,function(p){return p.value;},function(p,stack){pv.propertyProto=p.proto;return p.value.apply(this,stack);}];_buildByPropType[1]=_buildByPropType[0];pv.Mark.prototype.delegate=function(dv,tag){var protoProp=pv.propertyProto;if(protoProp&&(!tag||protoProp.tag===tag)){var value=this.evalProperty(protoProp);if(value!==undefined){return value;}}
return dv;};pv.Mark.prototype.hasDelegate=function(tag){var protoProp=pv.propertyProto;return!!protoProp&&(!tag||protoProp.tag===tag);};var _buildByPropTypeSingle=_buildByPropType.slice();_buildByPropTypeSingle[3]=function(p){var oldProtoProp=pv.propertyProto;try{pv.propertyProto=p.proto;return p.value.apply(this,pv.Mark.stack);}finally{pv.propertyProto=oldProtoProp;}};pv.Mark.prototype.evalProperty=function(p){return _buildByPropTypeSingle[p.type].call(this,p);};pv.Mark.prototype.buildPropertiesWithDepTracking=function(s,properties){var net=this.binds.net;var netIndex,newNetIndex,netDirtyProps,prevNetDirtyProps,propertyIndexes,evaluatedProps;var stack=pv.Mark.stack;var n=properties.length;try{while(true){netDirtyProps=null;evaluatedProps={};var oldProtoProp=pv.propertyProto;try{for(var i=0;i<n;i++){var p=properties[i];var name=p.name;evaluatedProps[name]=true;if(!prevNetDirtyProps||prevNetDirtyProps[name]){var v;switch(p.type){case 3:pv.propertyEval=p;pv.propertyEvalNetIndex=netIndex=(net[name]||0);pv.propertyEvalDependencies=null;pv.propertyProto=p.proto;v=p.value.apply(this,stack);newNetIndex=pv.propertyEvalNetIndex;if(newNetIndex>netIndex){var evalDeps=pv.propertyEvalDependencies;for(var depName in evalDeps){if(evalDeps.hasOwnProperty(depName)&&!evaluatedProps.hasOwnProperty(name)){if(!netDirtyProps){netDirtyProps={};}
netDirtyProps[depName]=true;}}
this.updateNet(p,newNetIndex);}
break;case 2:v=p.value;break;case 0:case 1:v=this.scene.defs[name].value;break;}
s[name]=v;}}}finally{pv.propertyProto=oldProtoProp;}
if(!netDirtyProps){break;}
prevNetDirtyProps=netDirtyProps;propertyIndexes=pv.numerate(properties,function(p){return p.name;});properties.sort(function(pa,pb){var comp=pv.naturalOrder(net[pa.name]||0,net[pb.name]||0);if(!comp){comp=pv.naturalOrder(propertyIndexes[pa.name],propertyIndexes[pb.name]);}
return comp;});propertyIndexes=null;}}finally{pv.propertyEval=null;pv.propertyEvalNetIndex=null;pv.propertyEvalDependencies=null;}};pv.Mark.prototype.buildInstance=function(s){this.buildProperties(s,this.binds.required);if(s.visible){if(this.index===0){this.buildPropertiesWithDepTracking(s,this.binds.optional);}else{this.buildProperties(s,this.binds.optional);}
this.buildImplied(s);}};pv.Mark.prototype.buildImplied=function(s){var l=s.left;var r=s.right;var t=s.top;var b=s.bottom;var p=this.properties;var w=p.width?s.width:0;var h=p.height?s.height:0;var instance;var checked;if(w==null||r==null||l==null){instance=this.parent?this.parent.instance():null;checked=true;var width=instance?instance.width:(w+l+r);if(w==null){w=width-(r=r||0)-(l=l||0);}else if(r==null){if(l==null){l=r=(width-w)/2;}else{r=width-w-l;}}else{l=width-w-r;}}
if(h==null||b==null||t==null){if(!checked){instance=this.parent?this.parent.instance():null;}
var height=instance?instance.height:(h+t+b);if(h==null){h=height-(t=t||0)-(b=b||0);}else if(b==null){if(t==null){b=t=(height-h)/2;}else{b=height-h-t;}}else{t=height-h-b;}}
s.left=l;s.right=r;s.top=t;s.bottom=b;if(p.width)s.width=w;if(p.height)s.height=h;if(p.textStyle&&!s.textStyle)s.textStyle=pv.FillStyle.transparent;if(p.fillStyle&&!s.fillStyle)s.fillStyle=pv.FillStyle.transparent;if(p.strokeStyle&&!s.strokeStyle)s.strokeStyle=pv.FillStyle.transparent;};pv.Mark.prototype.mouse=function(){var n=this.root.canvas(),ev=pv.event,x=ev.pageX,y=ev.pageY;var offset=pv.elementOffset(n);if(offset){var getStyle=pv.cssStyle(n);x-=offset.left+parseFloat(getStyle('paddingLeft')||0);y-=offset.top+parseFloat(getStyle('paddingTop')||0);}
var t=pv.Transform.identity,p=this.properties.transform?this:this.parent,pz=[];do{pz.push(p);}while((p=p.parent));while((p=pz.pop())){var pinst=p.instance();t=t.translate(pinst.left,pinst.top).times(pinst.transform);}
t=t.invert();return pv.vector(x*t.k+t.x,y*t.k+t.y);};pv.Mark.prototype.event=function(type,handler){handler=pv.functor(handler);var handlers=this.$handlers[type];if(!handlers){handlers=handler;}else if(handlers instanceof Array){handlers.push(handler);}else{handlers=[handlers,handler];}
this.$hasHandlers=true;this.$handlers[type]=handlers;return this;};pv.Mark.prototype.context=function(scene,index,f){var proto=pv.Mark.prototype,stack=pv.Mark.stack,oscene=pv.Mark.scene,oindex=proto.index;function apply(scene,index){pv.Mark.scene=scene;proto.index=index;if(!scene){return;}
var that=scene.mark,mark=that,ancestors=[];do{ancestors.push(mark);stack.push(scene[index].data);mark.index=index;mark.scene=scene;if((mark=mark.parent)){index=scene.parentIndex;scene=scene.parent;}}while(mark);var k=1;for(var i=ancestors.length-1;i>0;i--){mark=ancestors[i];mark.scale=k;k*=mark.scene[mark.index].transform.k;}
that.scale=k;var children=that.children,n;if(children&&(n=children.length)>0){var thatInst=that.scene[that.index];k*=thatInst.transform.k;var childScenez=thatInst.children;for(var i=0;i<n;i++){mark=children[i];mark.scene=childScenez[i];mark.scale=k;}}}
function clear(scene){if(!scene)return;var that=scene.mark,mark;var children=that.children;if(children){for(var i=0,n=children.length;i<n;i++){mark=children[i];mark.scene=undefined;mark.scale=1;}}
mark=that;var parent;do{stack.pop();delete mark.index;if((parent=mark.parent)){mark.scene=undefined;mark.scale=1;}}while((mark=parent));}
if(scene&&scene===oscene&&index===oindex){try{f.apply(this,stack);}catch(ex){pv.error(ex);throw ex;}finally{pv.Mark.scene=oscene;proto.index=oindex;}}else{clear(oscene,oindex);apply(scene,index);try{f.apply(this,stack);}catch(ex){pv.error(ex);throw ex;}finally{clear(scene,index);apply(oscene,oindex);}}};pv.Mark.getEventHandler=function(type,scenes,index,event){var handler=scenes.mark.$handlers[type];if(handler){return[handler,type,scenes,index,event];}
var parentScenes=scenes.parent;if(parentScenes){return this.getEventHandler(type,parentScenes,scenes.parentIndex,event);}};pv.Mark.dispatch=function(type,scenes,index,event){var root=scenes.mark.root;if(root.animatingCount){return true;}
var handlerInfo;var interceptors=root.$interceptors&&root.$interceptors[type];if(interceptors){for(var i=0,L=interceptors.length;i<L;i++){handlerInfo=interceptors[i](type,event);if(handlerInfo){break;}
if(handlerInfo===false){return true;}}}
if(!handlerInfo){handlerInfo=this.getEventHandler(type,scenes,index,event);if(!handlerInfo){return false;}}
return this.handle.apply(this,handlerInfo);};pv.Mark.handle=function(handler,type,scenes,index,event){var m=scenes.mark;m.context(scenes,index,function(){var stack=pv.Mark.stack.concat(event);if(handler instanceof Array){var ms;handler.forEach(function(hi){var mi=hi.apply(m,stack);if(mi&&mi.render){(ms||(ms=[])).push(mi);}});if(ms){ms.forEach(function(mi){mi.render();});}}else{m=handler.apply(m,stack);if(m&&m.render){m.render();}}});return true;};pv.Mark.prototype.addEventInterceptor=function(type,handler,before){var root=this.root;if(root){var interceptors=root.$interceptors||(root.$interceptors={});var list=interceptors[type]||(interceptors[type]=[]);if(before){list.unshift(handler);}else{list.push(handler);}}};pv.Mark.prototype.eachInstance=function(fun,ctx){var mark=this,indexes=[];while(mark.parent){indexes.unshift(mark.childIndex);mark=mark.parent;}
var rootScene=mark.scene;if(!rootScene){return;}
var L=indexes.length;function mapRecursive(scene,level,toScreen){var D=scene.length;if(D>0){var isLastLevel=level===L,childIndex;if(!isLastLevel){childIndex=indexes[level];}
for(var index=0;index<D;index++){var instance=scene[index];if(instance.visible){if(level===L){fun.call(ctx,scene,index,toScreen);}else{var childScene=instance.children[childIndex];if(childScene){var childToScreen=toScreen.times(instance.transform).translate(instance.left,instance.top);mapRecursive(childScene,level+1,childToScreen);}}}}}}
mapRecursive(rootScene,0,pv.Transform.identity);};pv.Mark.prototype.toScreenTransform=function(){var t=pv.Transform.identity;if(this instanceof pv.Panel){t=t.translate(this.left(),this.top()).times(this.transform());}
var parent=this.parent;if(parent){do{t=t.translate(parent.left(),parent.top()).times(parent.transform());}while((parent=parent.parent));}
return t;};pv.Mark.prototype.transition=function(){return new pv.Transition(this);};pv.Mark.prototype.on=function(state){return this["$"+state]=new pv.Transient(this);};pv.Mark.prototype.getShape=function(scenes,index,inset){var s=scenes[index];if(!s.visible){return null;}
if(inset==null){inset=0;}
var key='_shape_inset_'+inset;return s[key]||(s[key]=this.getShapeCore(scenes,index,inset));};pv.Mark.prototype.getShapeCore=function(scenes,index,inset){var s=scenes[index];var l=s.left;var t=s.top;var w=s.width;var h=s.height;if(inset>0&&inset<=1){var dw=inset*w;var dh=inset*h;l+=dw;t+=dh;w-=dw*2;h-=dh*2;}
return new pv.Shape.Rect(l,t,w,h);};pv.Anchor=function(target){pv.Mark.call(this);this.target=target;this.parent=target.parent;};pv.Anchor.prototype=pv.extend(pv.Mark).property("name",String);pv.Anchor.prototype.extend=function(proto){this.proto=proto;return this;};pv.Area=function(){pv.Mark.call(this);};pv.Area.castSegmented=function(v){if(!v){return'';}
switch(v){case'smart':case'full':break;default:v='full';}
return v;};pv.Area.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("lineJoin",String).property("strokeMiterLimit",Number).property("lineCap",String).property("strokeDasharray",String).property("strokeStyle",pv.fillStyle).property("fillStyle",pv.fillStyle).property("segmented",pv.Area.castSegmented).property("interpolate",String).property("tension",Number);pv.Area.prototype.type="area";pv.Area.prototype.defaults=new pv.Area().extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent)).interpolate("linear").tension(.7).lineJoin("miter").strokeMiterLimit(8).lineCap("butt").strokeDasharray("none");pv.Area.prototype.buildImplied=function(s){if(s.height==null)s.height=0;if(s.width==null)s.width=0;pv.Mark.prototype.buildImplied.call(this,s);};pv.Area.fixed={lineWidth:1,lineJoin:1,strokeMiterLimit:1,lineCap:1,strokeStyle:1,strokeDasharray:1,fillStyle:1,segmented:1,interpolate:1,tension:1};pv.Area.prototype.bind=function(){pv.Mark.prototype.bind.call(this);var binds=this.binds,required=binds.required,optional=binds.optional;for(var i=0,n=optional.length;i<n;i++){var p=optional[i];p.fixed=p.name in pv.Area.fixed;if(p.name=="segmented"){required.push(p);optional.splice(i,1);i--;n--;}}
this.binds.$required=required;this.binds.$optional=optional;};pv.Area.prototype.buildInstance=function(s){var binds=this.binds;if(this.index){var fixed=binds.fixed;if(!fixed){fixed=binds.fixed=[];function f(p){return!p.fixed||(fixed.push(p),false);}
binds.required=binds.required.filter(f);if(!this.scene[0].segmented)binds.optional=binds.optional.filter(f);}
var n=fixed.length;if(n){var firstScene=this.scene[0];for(var i=0;i<n;i++){var p=fixed[i].name;s[p]=firstScene[p];}}}
else{binds.required=binds.$required;binds.optional=binds.$optional;binds.fixed=null;}
pv.Mark.prototype.buildInstance.call(this,s);};pv.Area.prototype.anchor=function(name){var scene;return pv.Mark.prototype.anchor.call(this,name).interpolate(function(){return this.scene.target[this.index].interpolate;}).eccentricity(function(){return this.scene.target[this.index].eccentricity;}).tension(function(){return this.scene.target[this.index].tension;});};pv.Area.prototype.getShapeCore=function(scenes,index){var s=scenes[index];var w=(s.width||0),h=(s.height||0),x=s.left,y=s.top;var s2=index+1<scenes.length?scenes[index+1]:null;if(!s2||!s2.visible){return new pv.Shape.Line(x,y,x+w,y+h);}
var x2=s2.left,y2=s2.top,h2=s2.height||0,w2=s2.width||0;return new pv.Shape.Polygon([new pv.Vector(x,y),new pv.Vector(x2,y2),new pv.Vector(x2+w2,y2+h2),new pv.Vector(x+w,y+h)]);};pv.Bar=function(){pv.Mark.call(this);};pv.Bar.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("fillStyle",pv.fillStyle).property("lineCap",String).property("strokeDasharray",String);pv.Bar.prototype.type="bar";pv.Bar.prototype.defaults=new pv.Bar().extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent)).lineCap("butt").strokeDasharray("none");pv.Dot=function(){pv.Mark.call(this);};pv.Dot.prototype=pv.extend(pv.Mark).property("shape",String).property("shapeAngle",Number).property("shapeRadius",Number).property("shapeSize",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("lineCap",String).property("strokeDasharray",String).property("fillStyle",pv.fillStyle);pv.Dot.prototype.type="dot";pv.Dot.prototype.defaults=new pv.Dot().extend(pv.Mark.prototype.defaults).shape("circle").lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent)).lineCap("butt").strokeDasharray("none");pv.Dot.prototype.anchor=function(name){var scene;return pv.Mark.prototype.anchor.call(this,name).left(function(){var s=this.scene.target[this.index];switch(this.name()){case"bottom":case"top":case"center":return s.left;case"left":return null;}
return s.left+s.shapeRadius;}).right(function(){var s=this.scene.target[this.index];return this.name()=="left"?s.right+s.shapeRadius:null;}).top(function(){var s=this.scene.target[this.index];switch(this.name()){case"left":case"right":case"center":return s.top;case"top":return null;}
return s.top+s.shapeRadius;}).bottom(function(){var s=this.scene.target[this.index];return this.name()=="top"?s.bottom+s.shapeRadius:null;}).textAlign(function(){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center";}
return"left";}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"bottom":return"top";}
return"bottom";});};pv.Dot.prototype.buildImplied=function(s){var r=s.shapeRadius,z=s.shapeSize;if(r==null){if(z==null){s.shapeSize=20.25;s.shapeRadius=4.5;}else{s.shapeRadius=Math.sqrt(z);}}else if(z==null){s.shapeSize=r*r;}
pv.Mark.prototype.buildImplied.call(this,s);};pv.Dot.prototype.getShapeCore=function(scenes,index){var s=scenes[index];var radius=s.shapeRadius,cx=s.left,cy=s.top;switch(s.shape){case'diamond':radius*=Math.SQRT2;case'square':case'cross':return new pv.Shape.Rect(cx-radius,cy-radius,2*radius,2*radius);}
return new pv.Shape.Circle(cx,cy,radius);};pv.Label=function(){pv.Mark.call(this);};pv.Label.prototype=pv.extend(pv.Mark).property("text",String).property("font",String).property("textAngle",Number).property("textStyle",pv.color).property("textAlign",String).property("textBaseline",String).property("textMargin",Number).property("textDecoration",String).property("textShadow",String);pv.Label.prototype.type="label";pv.Label.prototype.defaults=new pv.Label().extend(pv.Mark.prototype.defaults).events("none").text(pv.identity).font("10px sans-serif").textAngle(0).textStyle("black").textAlign("left").textBaseline("bottom").textMargin(3);pv.Label.prototype.getShapeCore=function(scenes,index,inset){var s=scenes[index];var size=pv.Text.measure(s.text,s.font);var l=s.left;var t=s.top;var w=size.width;var h=size.height;if(inset>0&&inset<=1){var dw=inset*w;var dh=inset*h;l+=dw;t+=dh;w-=dw*2;h-=dh*2;}
return pv.Label.getPolygon(w,h,s.textAlign,s.textBaseline,s.textAngle,s.textMargin).apply(pv.Transform.identity.translate(l,t));};pv.Label.getPolygon=function(textWidth,textHeight,align,baseline,angle,margin){var x,y;switch(baseline){case"middle":y=textHeight/2;break;case"top":y=margin+textHeight;break;case"bottom":y=-margin;break;}
switch(align){case"right":x=-margin-textWidth;break;case"center":x=-textWidth/2;break;case"left":x=margin;break;}
var bl=new pv.Vector(x,y);var br=bl.plus(textWidth,0);var tr=br.plus(0,-textHeight);var tl=bl.plus(0,-textHeight);if(angle!==0){bl=bl.rotate(angle);br=br.rotate(angle);tl=tl.rotate(angle);tr=tr.rotate(angle);}
return new pv.Shape.Polygon([bl,br,tr,tl]);};pv.Line=function(){pv.Mark.call(this);};pv.Line.prototype=pv.extend(pv.Mark).property("lineWidth",Number).property("lineJoin",String).property("strokeMiterLimit",Number).property("lineCap",String).property("strokeStyle",pv.fillStyle).property("strokeDasharray",String).property("fillStyle",pv.fillStyle).property("segmented",pv.Area.castSegmented).property("interpolate",String).property("eccentricity",Number).property("tension",Number);pv.Line.prototype.type="line";pv.Line.prototype.defaults=new pv.Line().extend(pv.Mark.prototype.defaults).lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent)).interpolate("linear").eccentricity(0).tension(.7).lineJoin("miter").strokeMiterLimit(8).lineCap("butt").strokeDasharray("none");pv.Line.prototype.bind=pv.Area.prototype.bind;pv.Line.prototype.buildInstance=pv.Area.prototype.buildInstance;pv.Line.prototype.anchor=function(name){return pv.Area.prototype.anchor.call(this,name).textAlign(function(d){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center";case"right":return"left";}}).textBaseline(function(d){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"bottom";case"bottom":return"top";}});};pv.Line.prototype.getShapeCore=function(scenes,index){var s=scenes[index];var s2=index+1<scenes.length?scenes[index+1]:null;if(s2==null||!s2.visible){return new pv.Shape.Point(s.left,s.top);}
return new pv.Shape.Line(s.left,s.top,s2.left,s2.top);};pv.Rule=function(){pv.Mark.call(this);};pv.Rule.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("lineCap",String).property("strokeDasharray",String);pv.Rule.prototype.type="rule";pv.Rule.prototype.defaults=new pv.Rule().extend(pv.Mark.prototype.defaults).lineWidth(1).strokeStyle("black").antialias(false).lineCap("butt").strokeDasharray("none");pv.Rule.prototype.anchor=pv.Line.prototype.anchor;pv.Rule.prototype.buildImplied=function(s){var l=s.left,r=s.right,t=s.top,b=s.bottom;if((s.width!=null)||((l==null)&&(r==null))||((r!=null)&&(l!=null))){s.height=0;}else{s.width=0;}
pv.Mark.prototype.buildImplied.call(this,s);};pv.Rule.prototype.getShapeCore=function(scenes,index){var s=scenes[index];return new pv.Shape.Line(s.left,s.top,s.left+s.width,s.top+s.height);};pv.Panel=function(){pv.Bar.call(this);this.children=[];this.root=this;this.$dom=pv.$&&pv.$.s;};pv.Panel.prototype=pv.extend(pv.Bar).property("transform").property("overflow",String).property("canvas",function(c){return(typeof c=="string")?document.getElementById(c):c;});pv.Panel.prototype.type="panel";pv.Panel.prototype.animatingCount=0;pv.Panel.prototype.zOrderChildCount=0;pv.Panel.prototype.defaults=new pv.Panel().extend(pv.Bar.prototype.defaults).fillStyle(null).overflow("visible");pv.Panel.prototype.anchor=function(name){var anchor=pv.Bar.prototype.anchor.call(this,name);anchor.parent=this;return anchor;};pv.Panel.prototype.add=function(Type){var child=new Type();child.parent=this;child.root=this.root;child.childIndex=this.children.length;this.children.push(child);return child;};pv.Panel.prototype.bind=function(){pv.Mark.prototype.bind.call(this);var children=this.children;for(var i=0,n=children.length;i<n;i++){children[i].bind();}};pv.Panel.prototype.buildInstance=function(s){pv.Bar.prototype.buildInstance.call(this,s);if(!s.visible)return;var scale=this.scale*s.transform.k;pv.Mark.prototype.index=-1;var child;var children=this.children;var childScenes=s.children||(s.children=[]);for(var i=0,n=children.length;i<n;i++){child=children[i];child.scene=childScenes[i];child.scale=scale;child.build();}
i=n;while(i--){child=children[i];childScenes[i]=child.scene;delete child.scene;delete child.scale;}
childScenes.length=n;};pv.Panel.prototype.buildImplied=function(s){if(!this.parent){var c=s.canvas;if(pv.renderer()==="batik"){if(c){if(c.$panel!=this){pv.Panel.updateCreateId(c);c.$panel=this;while(c.lastChild)c.removeChild(c.lastChild);}}else{c=document.lastChild;}}else if(c){if(c.$panel!=this){pv.Panel.updateCreateId(c);c.$panel=this;while(c.lastChild)c.removeChild(c.lastChild);}
var w,h,cssStyle;if(s.width==null){cssStyle=pv.cssStyle(c);w=parseFloat(cssStyle("width")||0);s.width=w-s.left-s.right;}
if(s.height==null){cssStyle||(cssStyle=pv.cssStyle(c));h=parseFloat(pv.cssStyle("height")||0);s.height=h-s.top-s.bottom;}
cssStyle=null;}else{var cache=this.$canvas||(this.$canvas=[]);if(!(c=cache[this.index])){c=cache[this.index]=document.createElement(pv.renderer()=="svgweb"?"div":"span");if(this.$dom){this.$dom.parentNode.insertBefore(c,this.$dom);}else{var n=document.body;while(n.lastChild&&n.lastChild.tagName)n=n.lastChild;if(n!=document.body)n=n.parentNode;n.appendChild(c);}}}
s.canvas=c;}
if(!s.transform)s.transform=pv.Transform.identity;pv.Mark.prototype.buildImplied.call(this,s);};pv.Panel.updateCreateId=function(c){c.$pvCreateId=(c.$pvCreateId||0)+1;};pv.Image=function(){pv.Bar.call(this);};pv.Image.prototype=pv.extend(pv.Bar).property("url",String).property("imageWidth",Number).property("imageHeight",Number);pv.Image.prototype.type="image";pv.Image.prototype.defaults=new pv.Image().extend(pv.Bar.prototype.defaults).fillStyle(null);pv.Image.prototype.image=function(f){this.$image=function(){var c=f.apply(this,arguments);return c==null?pv.Color.transparent:typeof c=="string"?pv.color(c):c;};return this;};pv.Image.prototype.bind=function(){pv.Bar.prototype.bind.call(this);var binds=this.binds,mark=this;do{binds.image=mark.$image;}while(!binds.image&&(mark=mark.proto));};pv.Image.prototype.buildImplied=function(s){pv.Bar.prototype.buildImplied.call(this,s);if(!s.visible)return;if(s.imageWidth==null)s.imageWidth=s.width;if(s.imageHeight==null)s.imageHeight=s.height;if((s.url==null)&&this.binds.image){var canvas=this.$canvas||(this.$canvas=document.createElement("canvas")),context=canvas.getContext("2d"),w=s.imageWidth,h=s.imageHeight,stack=pv.Mark.stack,data;canvas.width=w;canvas.height=h;data=(s.image=context.createImageData(w,h)).data;stack.unshift(null,null);for(var y=0,p=0;y<h;y++){stack[1]=y;for(var x=0;x<w;x++){stack[0]=x;var color=this.binds.image.apply(this,stack);data[p++]=color.r;data[p++]=color.g;data[p++]=color.b;data[p++]=255*color.a;}}
stack.splice(0,2);}};pv.Wedge=function(){pv.Mark.call(this);};pv.Wedge.prototype=pv.extend(pv.Mark).property("startAngle",Number).property("endAngle",Number).property("angle",Number).property("innerRadius",Number).property("outerRadius",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("lineJoin",String).property("strokeMiterLimit",Number).property("lineCap",String).property("strokeDasharray",String).property("fillStyle",pv.fillStyle);pv.Wedge.prototype.type="wedge";pv.Wedge.prototype.defaults=new pv.Wedge().extend(pv.Mark.prototype.defaults).startAngle(function(){var s=this.sibling();return s?s.endAngle:-Math.PI/2;}).innerRadius(0).lineWidth(1.5).strokeStyle(null).fillStyle(pv.Colors.category20().by(pv.index)).lineJoin("miter").strokeMiterLimit(8).lineCap("butt").strokeDasharray("none");pv.Wedge.prototype.midRadius=function(){return(this.innerRadius()+this.outerRadius())/2;};pv.Wedge.prototype.midAngle=function(){return(this.startAngle()+this.endAngle())/2;};pv.Wedge.prototype.anchor=function(name){function partial(s){return s.innerRadius||s.angle<2*Math.PI;}
function midRadius(s){return(s.innerRadius+s.outerRadius)/2;}
function midAngle(s){return(s.startAngle+s.endAngle)/2;}
return pv.Mark.prototype.anchor.call(this,name).left(function(){var s=this.scene.target[this.index];if(partial(s))switch(this.name()){case"outer":return s.left+s.outerRadius*Math.cos(midAngle(s));case"inner":return s.left+s.innerRadius*Math.cos(midAngle(s));case"start":return s.left+midRadius(s)*Math.cos(s.startAngle);case"center":return s.left+midRadius(s)*Math.cos(midAngle(s));case"end":return s.left+midRadius(s)*Math.cos(s.endAngle);}
return s.left;}).top(function(){var s=this.scene.target[this.index];if(partial(s))switch(this.name()){case"outer":return s.top+s.outerRadius*Math.sin(midAngle(s));case"inner":return s.top+s.innerRadius*Math.sin(midAngle(s));case"start":return s.top+midRadius(s)*Math.sin(s.startAngle);case"center":return s.top+midRadius(s)*Math.sin(midAngle(s));case"end":return s.top+midRadius(s)*Math.sin(s.endAngle);}
return s.top;}).textAlign(function(){var s=this.scene.target[this.index];if(partial(s))switch(this.name()){case"outer":return pv.Wedge.upright(midAngle(s))?"right":"left";case"inner":return pv.Wedge.upright(midAngle(s))?"left":"right";}
return"center";}).textBaseline(function(){var s=this.scene.target[this.index];if(partial(s))switch(this.name()){case"start":return pv.Wedge.upright(s.startAngle)?"top":"bottom";case"end":return pv.Wedge.upright(s.endAngle)?"bottom":"top";}
return"middle";}).textAngle(function(){var s=this.scene.target[this.index],a=0;if(partial(s))switch(this.name()){case"center":case"inner":case"outer":a=midAngle(s);break;case"start":a=s.startAngle;break;case"end":a=s.endAngle;break;}
return pv.Wedge.upright(a)?a:(a+Math.PI);});};pv.Wedge.upright=function(angle){angle=angle%(2*Math.PI);angle=(angle<0)?(2*Math.PI+angle):angle;return(angle<Math.PI/2)||(angle>=3*Math.PI/2);};pv.Wedge.prototype.buildImplied=function(s){if(s.angle==null)s.angle=s.endAngle-s.startAngle;else if(s.endAngle==null)s.endAngle=s.startAngle+s.angle;pv.Mark.prototype.buildImplied.call(this,s);};pv.Wedge.prototype.getShapeCore=function(scenes,index){var s=scenes[index];return new pv.Shape.Wedge(s.left,s.top,s.innerRadius,s.outerRadius,s.startAngle,s.angle);};pv.Ease=(function(){function reverse(f){return function(t){return 1-f(1-t);};}
function reflect(f){return function(t){return.5*(t<.5?f(2*t):(2-f(2-2*t)));};}
function poly(e){return function(t){return t<0?0:t>1?1:Math.pow(t,e);}}
function sin(t){return 1-Math.cos(t*Math.PI/2);}
function exp(t){return t?Math.pow(2,10*(t-1))-0.001:0;}
function circle(t){return-(Math.sqrt(1-t*t)-1);}
function elastic(a,p){var s;if(!p)p=0.45;if(!a||a<1){a=1;s=p/4;}
else s=p/(2*Math.PI)*Math.asin(1/a);return function(t){return t<=0||t>=1?t:-(a*Math.pow(2,10*(--t))*Math.sin((t-s)*(2*Math.PI)/p));};}
function back(s){if(!s)s=1.70158;return function(t){return t*t*((s+1)*t-s);};}
function bounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375;}
var quad=poly(2),cubic=poly(3),elasticDefault=elastic(),backDefault=back();var eases={"linear":pv.identity,"quad-in":quad,"quad-out":reverse(quad),"quad-in-out":reflect(quad),"quad-out-in":reflect(reverse(quad)),"cubic-in":cubic,"cubic-out":reverse(cubic),"cubic-in-out":reflect(cubic),"cubic-out-in":reflect(reverse(cubic)),"sin-in":sin,"sin-out":reverse(sin),"sin-in-out":reflect(sin),"sin-out-in":reflect(reverse(sin)),"exp-in":exp,"exp-out":reverse(exp),"exp-in-out":reflect(exp),"exp-out-in":reflect(reverse(exp)),"circle-in":circle,"circle-out":reverse(circle),"circle-in-out":reflect(circle),"circle-out-in":reflect(reverse(circle)),"elastic-in":elasticDefault,"elastic-out":reverse(elasticDefault),"elastic-in-out":reflect(elasticDefault),"elastic-out-in":reflect(reverse(elasticDefault)),"back-in":backDefault,"back-out":reverse(backDefault),"back-in-out":reflect(backDefault),"back-out-in":reflect(reverse(backDefault)),"bounce-in":bounce,"bounce-out":reverse(bounce),"bounce-in-out":reflect(bounce),"bounce-out-in":reflect(reverse(bounce))};pv.ease=function(f){return eases[f];};return{reverse:reverse,reflect:reflect,linear:function(){return pv.identity;},sin:function(){return sin;},exp:function(){return exp;},circle:function(){return circle;},elastic:elastic,back:back,bounce:bounce,poly:poly};})();pv.Transition=function(mark){var that=this,ease=pv.ease("cubic-in-out"),duration=250,timer,onEndCallback;var interpolated={top:1,left:1,right:1,bottom:1,width:1,height:1,innerRadius:1,outerRadius:1,radius:1,startAngle:1,endAngle:1,angle:1,fillStyle:1,strokeStyle:1,lineWidth:1,eccentricity:1,tension:1,textAngle:1,textStyle:1,textMargin:1};var defaults=new pv.Transient();function ids(marks){var map={};for(var i=0;i<marks.length;i++){var mark=marks[i];if(mark.id){map[mark.id]=mark;}}
return map;}
function interpolateProperty(list,name,before,after){var f;if(name in interpolated){var i=pv.Scale.interpolator(before[name],after[name]);f=function(t){before[name]=i(t);};}else{f=function(t){if(t>.5){before[name]=after[name];}};}
f.next=list.head;list.head=f;}
function interpolateInstance(list,before,after){for(var name in before){if(name=="children")continue;if(before[name]==after[name])continue;interpolateProperty(list,name,before,after);}
if(before.children){for(var j=0;j<before.children.length;j++){interpolate(list,before.children[j],after.children[j]);}}}
function interpolate(list,before,after){var mark=before.mark,bi=ids(before),ai=ids(after);for(var i=0;i<before.length;i++){var b=before[i],a=b.id?ai[b.id]:after[i];b.index=i;if(!b.visible){continue;}
if(!(a&&a.visible)){var o=override(before,i,mark.$exit,after);b.transition=a?2:(after.push(o),1);a=o;}
interpolateInstance(list,b,a);}
for(var i=0;i<after.length;i++){var a=after[i],b=a.id?bi[a.id]:before[i];if(!(b&&b.visible)&&a.visible){var o=override(after,i,mark.$enter,before);if(!b)
before.push(o);else
before[b.index]=o;interpolateInstance(list,o,a);}}}
function override(scene,index,proto,other){var s=pv.extend(scene[index]),m=scene.mark,r=m.root.scene,p=(proto||defaults).$properties,t;if(other.target&&(t=other.target[other.length])){scene=pv.extend(scene);scene.target=pv.extend(other.target);scene.target[index]=t;}
var seen={};for(var i=0;i<p.length;i++){seen[p[i].name]=1;}
p=m.binds.optional.filter(function(p){return!(p.name in seen);}).concat(p);m.context(scene,index,function(){this.buildProperties(s,p);this.buildImplied(s);});m.root.scene=r;return s;}
function cleanup(scene){for(var i=0,j=0;i<scene.length;i++){var s=scene[i];if(s.transition!=1){scene[j++]=s;if(s.transition==2)s.visible=false;if(s.children)s.children.forEach(cleanup);}}
scene.length=j;}
that.ease=function(x){return arguments.length?(ease=typeof x=="function"?x:pv.ease(x),that):ease;};that.duration=function(x){return arguments.length?(duration=Number(x),that):duration;};function doEnd(){mark.root.animatingCount--;if(onEndCallback){var cb=onEndCallback;onEndCallback=null;cb();}}
that.start=function(onEnd){onEndCallback=onEnd;mark.root.animatingCount++;if(mark.parent){doEnd();throw new Error("Animated partial rendering is not supported.");}
try{if(mark.$transition){mark.$transition.stop();}
mark.$transition=that;var i=pv.Mark.prototype.index,before=mark.scene,after;mark.scene=null;mark.bind();mark.build();after=mark.scene;mark.scene=before;pv.Mark.prototype.index=i;var start=Date.now(),list={};interpolate(list,before,after);}catch(ex){doEnd();throw ex;}
if(!list.head){doEnd();return;}
timer=setInterval(function(){var t=Math.max(0,Math.min(1,(Date.now()-start)/duration)),e=ease(t);var i=list.head;do{i(e);}while((i=i.next));if(t===1){cleanup(mark.scene);pv.Scene.updateAll(before);that.stop();}else{pv.Scene.updateAll(before);}},24);};that.stop=function(){clearInterval(timer);doEnd();};};pv.Transient=function(mark){pv.Mark.call(this);this.fillStyle(null).strokeStyle(null).textStyle(null);this.on=function(state){return mark.on(state);};};pv.Transient.prototype=pv.extend(pv.Mark);pv.simulation=function(particles){return new pv.Simulation(particles);};pv.Simulation=function(particles){for(var i=0;i<particles.length;i++)this.particle(particles[i]);};pv.Simulation.prototype.particle=function(p){p.next=this.particles;if(isNaN(p.px))p.px=p.x;if(isNaN(p.py))p.py=p.y;if(isNaN(p.fx))p.fx=0;if(isNaN(p.fy))p.fy=0;this.particles=p;return this;};pv.Simulation.prototype.force=function(f){f.next=this.forces;this.forces=f;return this;};pv.Simulation.prototype.constraint=function(c){c.next=this.constraints;this.constraints=c;return this;};pv.Simulation.prototype.stabilize=function(n){var c;if(!arguments.length)n=3;for(var i=0;i<n;i++){var q=new pv.Quadtree(this.particles);for(c=this.constraints;c;c=c.next)c.apply(this.particles,q);}
for(var p=this.particles;p;p=p.next){p.px=p.x;p.py=p.y;}
return this;};pv.Simulation.prototype.step=function(){var p,f,c;for(p=this.particles;p;p=p.next){var px=p.px,py=p.py;p.px=p.x;p.py=p.y;p.x+=p.vx=((p.x-px)+p.fx);p.y+=p.vy=((p.y-py)+p.fy);}
var q=new pv.Quadtree(this.particles);for(c=this.constraints;c;c=c.next)c.apply(this.particles,q);for(p=this.particles;p;p=p.next)p.fx=p.fy=0;for(f=this.forces;f;f=f.next)f.apply(this.particles,q);};pv.Quadtree=function(particles){var p;var x1=Number.POSITIVE_INFINITY,y1=x1,x2=Number.NEGATIVE_INFINITY,y2=x2;for(p=particles;p;p=p.next){if(p.x<x1)x1=p.x;if(p.y<y1)y1=p.y;if(p.x>x2)x2=p.x;if(p.y>y2)y2=p.y;}
var dx=x2-x1,dy=y2-y1;if(dx>dy)y2=y1+dx;else x2=x1+dy;this.xMin=x1;this.yMin=y1;this.xMax=x2;this.yMax=y2;function insert(n,p,x1,y1,x2,y2){if(isNaN(p.x)||isNaN(p.y))return;if(n.leaf){if(n.p){if((Math.abs(n.p.x-p.x)+Math.abs(n.p.y-p.y))<.01){insertChild(n,p,x1,y1,x2,y2);}else{var v=n.p;n.p=null;insertChild(n,v,x1,y1,x2,y2);insertChild(n,p,x1,y1,x2,y2);}}else{n.p=p;}}else{insertChild(n,p,x1,y1,x2,y2);}}
function insertChild(n,p,x1,y1,x2,y2){var sx=(x1+x2)*.5,sy=(y1+y2)*.5,right=p.x>=sx,bottom=p.y>=sy;n.leaf=false;switch((bottom<<1)+right){case 0:n=n.c1||(n.c1=new pv.Quadtree.Node());break;case 1:n=n.c2||(n.c2=new pv.Quadtree.Node());break;case 2:n=n.c3||(n.c3=new pv.Quadtree.Node());break;case 3:n=n.c4||(n.c4=new pv.Quadtree.Node());break;}
if(right)x1=sx;else x2=sx;if(bottom)y1=sy;else y2=sy;insert(n,p,x1,y1,x2,y2);}
this.root=new pv.Quadtree.Node();for(p=particles;p;p=p.next)insert(this.root,p,x1,y1,x2,y2);};pv.Quadtree.Node=function(){this.leaf=true;this.c1=null;this.c2=null;this.c3=null;this.c4=null;this.p=null;};pv.Force={};pv.Force.charge=function(k){var min=2,min1=1/min,max=500,max1=1/max,theta=.9,force={};if(!arguments.length)k=-40;force.constant=function(x){if(arguments.length){k=Number(x);return force;}
return k;};force.domain=function(a,b){if(arguments.length){min=Number(a);min1=1/min;max=Number(b);max1=1/max;return force;}
return[min,max];};force.theta=function(x){if(arguments.length){theta=Number(x);return force;}
return theta;};function accumulate(n){var cx=0,cy=0;n.cn=0;function accumulateChild(c){accumulate(c);n.cn+=c.cn;cx+=c.cn*c.cx;cy+=c.cn*c.cy;}
if(!n.leaf){if(n.c1)accumulateChild(n.c1);if(n.c2)accumulateChild(n.c2);if(n.c3)accumulateChild(n.c3);if(n.c4)accumulateChild(n.c4);}
if(n.p){n.cn+=k;cx+=k*n.p.x;cy+=k*n.p.y;}
n.cx=cx/n.cn;n.cy=cy/n.cn;}
function forces(n,p,x1,y1,x2,y2){var dx=n.cx-p.x,dy=n.cy-p.y,dn=1/Math.sqrt(dx*dx+dy*dy);if((n.leaf&&(n.p!=p))||((x2-x1)*dn<theta)){if(dn<max1)return;if(dn>min1)dn=min1;var kc=n.cn*dn*dn*dn,fx=dx*kc,fy=dy*kc;p.fx+=fx;p.fy+=fy;}else if(!n.leaf){var sx=(x1+x2)*.5,sy=(y1+y2)*.5;if(n.c1)forces(n.c1,p,x1,y1,sx,sy);if(n.c2)forces(n.c2,p,sx,y1,x2,sy);if(n.c3)forces(n.c3,p,x1,sy,sx,y2);if(n.c4)forces(n.c4,p,sx,sy,x2,y2);if(dn<max1)return;if(dn>min1)dn=min1;if(n.p&&(n.p!=p)){var kc=k*dn*dn*dn,fx=dx*kc,fy=dy*kc;p.fx+=fx;p.fy+=fy;}}}
force.apply=function(particles,q){accumulate(q.root);for(var p=particles;p;p=p.next){forces(q.root,p,q.xMin,q.yMin,q.xMax,q.yMax);}};return force;};pv.Force.drag=function(k){var force={};if(!arguments.length)k=.1;force.constant=function(x){if(arguments.length){k=x;return force;}
return k;};force.apply=function(particles){if(k)for(var p=particles;p;p=p.next){p.fx-=k*p.vx;p.fy-=k*p.vy;}};return force;};pv.Force.spring=function(k){var d=.1,l=20,links,kl,force={};if(!arguments.length)k=.1;force.links=function(x){if(arguments.length){links=x;kl=x.map(function(l){return 1/Math.sqrt(Math.max(l.sourceNode.linkDegree,l.targetNode.linkDegree));});return force;}
return links;};force.constant=function(x){if(arguments.length){k=Number(x);return force;}
return k;};force.damping=function(x){if(arguments.length){d=Number(x);return force;}
return d;};force.length=function(x){if(arguments.length){l=Number(x);return force;}
return l;};force.apply=function(particles){for(var i=0;i<links.length;i++){var a=links[i].sourceNode,b=links[i].targetNode,dx=a.x-b.x,dy=a.y-b.y,dn=Math.sqrt(dx*dx+dy*dy),dd=dn?(1/dn):1,ks=k*kl[i],kd=d*kl[i],kk=(ks*(dn-l)+kd*(dx*(a.vx-b.vx)+dy*(a.vy-b.vy))*dd)*dd,fx=-kk*(dn?dx:(.01*(.5-Math.random()))),fy=-kk*(dn?dy:(.01*(.5-Math.random())));a.fx+=fx;a.fy+=fy;b.fx-=fx;b.fy-=fy;}};return force;};pv.Constraint={};pv.Constraint.collision=function(radius){var n=1,r1,px1,py1,px2,py2,constraint={};if(!arguments.length)r1=10;constraint.repeat=function(x){if(arguments.length){n=Number(x);return constraint;}
return n;};function constrain(n,p,x1,y1,x2,y2){if(!n.leaf){var sx=(x1+x2)*.5,sy=(y1+y2)*.5,top=sy>py1,bottom=sy<py2,left=sx>px1,right=sx<px2;if(top){if(n.c1&&left)constrain(n.c1,p,x1,y1,sx,sy);if(n.c2&&right)constrain(n.c2,p,sx,y1,x2,sy);}
if(bottom){if(n.c3&&left)constrain(n.c3,p,x1,sy,sx,y2);if(n.c4&&right)constrain(n.c4,p,sx,sy,x2,y2);}}
if(n.p&&(n.p!=p)){var dx=p.x-n.p.x,dy=p.y-n.p.y,l=Math.sqrt(dx*dx+dy*dy),d=r1+radius(n.p);if(l<d){var k=(l-d)/l*.5;dx*=k;dy*=k;p.x-=dx;p.y-=dy;n.p.x+=dx;n.p.y+=dy;}}}
constraint.apply=function(particles,q){var p,r,max=-Infinity;for(p=particles;p;p=p.next){r=radius(p);if(r>max)max=r;}
for(var i=0;i<n;i++){for(p=particles;p;p=p.next){r=(r1=radius(p))+max;px1=p.x-r;px2=p.x+r;py1=p.y-r;py2=p.y+r;constrain(q.root,p,q.xMin,q.yMin,q.xMax,q.yMax);}}};return constraint;};pv.Constraint.position=function(f){var a=1,constraint={};if(!arguments.length)f=function(p){return p.fix;};constraint.alpha=function(x){if(arguments.length){a=Number(x);return constraint;}
return a;};constraint.apply=function(particles){for(var p=particles;p;p=p.next){var v=f(p);if(v){p.x+=(v.x-p.x)*a;p.y+=(v.y-p.y)*a;p.fx=p.fy=p.vx=p.vy=0;}}};return constraint;};pv.Constraint.bound=function(){var constraint={},x,y;constraint.x=function(min,max){if(arguments.length){x={min:Math.min(min,max),max:Math.max(min,max)};return this;}
return x;};constraint.y=function(min,max){if(arguments.length){y={min:Math.min(min,max),max:Math.max(min,max)};return this;}
return y;};constraint.apply=function(particles){if(x)for(var p=particles;p;p=p.next){p.x=p.x<x.min?x.min:(p.x>x.max?x.max:p.x);}
if(y)for(var p=particles;p;p=p.next){p.y=p.y<y.min?y.min:(p.y>y.max?y.max:p.y);}};return constraint;};pv.Layout=function(){pv.Panel.call(this);};pv.Layout.prototype=pv.extend(pv.Panel);pv.Layout.prototype.property=pv.Mark.prototype.localProperty;pv.Layout.Network=function(){pv.Layout.call(this);var that=this;this.$id=pv.id();(this.node=new pv.Mark().data(function(){return that.nodes();}).strokeStyle("#1f77b4").fillStyle("#fff").left(function(n){return n.x;}).top(function(n){return n.y;})).parent=this;this.link=new pv.Mark().extend(this.node).data(function(p){return[p.sourceNode,p.targetNode];}).fillStyle(null).lineWidth(function(d,p){return p.linkValue*1.5;}).strokeStyle("rgba(0,0,0,.2)");this.link.add=function(type){return that.add(pv.Panel).data(function(){return that.links();}).add(type).extend(this);};(this.label=new pv.Mark().extend(this.node).textMargin(7).textBaseline("middle").text(function(n){return n.nodeName||n.nodeValue;}).textAngle(function(n){var a=n.midAngle;return pv.Wedge.upright(a)?a:(a+Math.PI);}).textAlign(function(n){return pv.Wedge.upright(n.midAngle)?"left":"right";})).parent=this;};pv.Layout.Network.prototype=pv.extend(pv.Layout).property("nodes",function(v){return v.map(function(d,i){if(typeof d!="object")d={nodeValue:d};d.index=i;return d;});}).property("links",function(v){return v.map(function(d){if(isNaN(d.linkValue))d.linkValue=isNaN(d.value)?1:d.value;return d;});});pv.Layout.Network.prototype.reset=function(){this.$id=pv.id();return this;};pv.Layout.Network.prototype.buildProperties=function(s,properties){if((s.$id||0)<this.$id){pv.Layout.prototype.buildProperties.call(this,s,properties);}};pv.Layout.Network.prototype.buildImplied=function(s){pv.Layout.prototype.buildImplied.call(this,s);if(s.$id>=this.$id)return true;s.$id=this.$id;s.nodes.forEach(function(d){d.linkDegree=0;});s.links.forEach(function(d){var v=d.linkValue;(d.sourceNode||(d.sourceNode=s.nodes[d.source])).linkDegree+=v;(d.targetNode||(d.targetNode=s.nodes[d.target])).linkDegree+=v;});};pv.Layout.Hierarchy=function(){pv.Layout.Network.call(this);this.link.strokeStyle("#ccc");};pv.Layout.Hierarchy.prototype=pv.extend(pv.Layout.Network);pv.Layout.Hierarchy.prototype.buildImplied=function(s){if(!s.links)s.links=pv.Layout.Hierarchy.links.call(this);pv.Layout.Network.prototype.buildImplied.call(this,s);};pv.Layout.Hierarchy.links=function(){return this.nodes().filter(function(n){return n.parentNode;}).map(function(n){return{sourceNode:n,targetNode:n.parentNode,linkValue:1};});};pv.Layout.Hierarchy.NodeLink={buildImplied:function(s){var nodes=s.nodes,orient=s.orient,horizontal=/^(top|bottom)$/.test(orient),w=s.width,h=s.height;if(orient=="radial"){var ir=s.innerRadius,or=s.outerRadius;if(ir==null)ir=0;if(or==null)or=Math.min(w,h)/2;}
function radius(n){return n.parentNode?(n.depth*(or-ir)+ir):0;}
function midAngle(n){return(n.parentNode?(n.breadth-.25)*2*Math.PI:0);}
function x(n){switch(orient){case"left":return n.depth*w;case"right":return w-n.depth*w;case"top":return n.breadth*w;case"bottom":return w-n.breadth*w;case"radial":return w/2+radius(n)*Math.cos(n.midAngle);}}
function y(n){switch(orient){case"left":return n.breadth*h;case"right":return h-n.breadth*h;case"top":return n.depth*h;case"bottom":return h-n.depth*h;case"radial":return h/2+radius(n)*Math.sin(n.midAngle);}}
for(var i=0;i<nodes.length;i++){var n=nodes[i];n.midAngle=orient=="radial"?midAngle(n):horizontal?Math.PI/2:0;n.x=x(n);n.y=y(n);if(n.firstChild)n.midAngle+=Math.PI;}}};pv.Layout.Hierarchy.Fill={constructor:function(){this.node.strokeStyle("#fff").fillStyle("#ccc").width(function(n){return n.dx;}).height(function(n){return n.dy;}).innerRadius(function(n){return n.innerRadius;}).outerRadius(function(n){return n.outerRadius;}).startAngle(function(n){return n.startAngle;}).angle(function(n){return n.angle;});this.label.textAlign("center").left(function(n){return n.x+(n.dx/2);}).top(function(n){return n.y+(n.dy/2);});delete this.link;},buildImplied:function(s){var nodes=s.nodes,orient=s.orient,horizontal=/^(top|bottom)$/.test(orient),w=s.width,h=s.height,depth=-nodes[0].minDepth;if(orient=="radial"){var ir=s.innerRadius,or=s.outerRadius;if(ir==null)ir=0;if(ir)depth*=2;if(or==null)or=Math.min(w,h)/2;}
function scale(d,depth){return(d+depth)/(1+depth);}
function x(n){switch(orient){case"left":return scale(n.minDepth,depth)*w;case"right":return(1-scale(n.maxDepth,depth))*w;case"top":return n.minBreadth*w;case"bottom":return(1-n.maxBreadth)*w;case"radial":return w/2;}}
function y(n){switch(orient){case"left":return n.minBreadth*h;case"right":return(1-n.maxBreadth)*h;case"top":return scale(n.minDepth,depth)*h;case"bottom":return(1-scale(n.maxDepth,depth))*h;case"radial":return h/2;}}
function dx(n){switch(orient){case"left":case"right":return(n.maxDepth-n.minDepth)/(1+depth)*w;case"top":case"bottom":return(n.maxBreadth-n.minBreadth)*w;case"radial":return n.parentNode?(n.innerRadius+n.outerRadius)*Math.cos(n.midAngle):0;}}
function dy(n){switch(orient){case"left":case"right":return(n.maxBreadth-n.minBreadth)*h;case"top":case"bottom":return(n.maxDepth-n.minDepth)/(1+depth)*h;case"radial":return n.parentNode?(n.innerRadius+n.outerRadius)*Math.sin(n.midAngle):0;}}
function innerRadius(n){return Math.max(0,scale(n.minDepth,depth/2))*(or-ir)+ir;}
function outerRadius(n){return scale(n.maxDepth,depth/2)*(or-ir)+ir;}
function startAngle(n){return(n.parentNode?n.minBreadth-.25:0)*2*Math.PI;}
function angle(n){return(n.parentNode?n.maxBreadth-n.minBreadth:1)*2*Math.PI;}
for(var i=0;i<nodes.length;i++){var n=nodes[i];n.x=x(n);n.y=y(n);if(orient=="radial"){n.innerRadius=innerRadius(n);n.outerRadius=outerRadius(n);n.startAngle=startAngle(n);n.angle=angle(n);n.midAngle=n.startAngle+n.angle/2;}else{n.midAngle=horizontal?-Math.PI/2:0;}
n.dx=dx(n);n.dy=dy(n);}}};pv.Layout.Grid=function(){pv.Layout.call(this);var that=this;(this.cell=new pv.Mark().data(function(){return that.scene[that.index].$grid;}).width(function(){return that.width()/that.cols();}).height(function(){return that.height()/that.rows();}).left(function(){return this.width()*(this.index%that.cols());}).top(function(){return this.height()*Math.floor(this.index/that.cols());})).parent=this;};pv.Layout.Grid.prototype=pv.extend(pv.Layout).property("rows").property("cols");pv.Layout.Grid.prototype.defaults=new pv.Layout.Grid().extend(pv.Layout.prototype.defaults).rows(1).cols(1);pv.Layout.Grid.prototype.buildImplied=function(s){pv.Layout.prototype.buildImplied.call(this,s);var r=s.rows,c=s.cols;if(typeof c=="object")r=pv.transpose(c);if(typeof r=="object"){s.$grid=pv.blend(r);s.rows=r.length;s.cols=r[0]?r[0].length:0;}else{s.$grid=pv.repeat([s.data],r*c);}};pv.Layout.Stack=function(){pv.Layout.call(this);var that=this,none=function(){return null;},prop={t:none,l:none,r:none,b:none,w:none,h:none},values,buildImplied=that.buildImplied;function proxy(name){return function(){return prop[name](this.parent.index,this.index);};}
this.buildImplied=function(s){buildImplied.call(this,s);var data=s.layers,n=data.length,m,orient=s.orient,horizontal=/^(top|bottom)\b/.test(orient),h=this.parent[horizontal?"height":"width"](),x=[],y=[],dy=[];var stack=pv.Mark.stack,o={parent:{parent:this}};stack.unshift(null);values=[];for(var i=0;i<n;i++){dy[i]=[];y[i]=[];o.parent.index=i;stack[0]=data[i];values[i]=this.$values.apply(o.parent,stack);if(!i)m=values[i].length;stack.unshift(null);for(var j=0;j<m;j++){stack[0]=values[i][j];o.index=j;if(!i)x[j]=this.$x.apply(o,stack);dy[i][j]=this.$y.apply(o,stack);}
stack.shift();}
stack.shift();var index;switch(s.order){case"inside-out":{var max=dy.map(function(v){return pv.max.index(v);}),map=pv.range(n).sort(function(a,b){return max[a]-max[b];}),sums=dy.map(function(v){return pv.sum(v);}),top=0,bottom=0,tops=[],bottoms=[];for(var i=0;i<n;i++){var j=map[i];if(top<bottom){top+=sums[j];tops.push(j);}else{bottom+=sums[j];bottoms.push(j);}}
index=bottoms.reverse().concat(tops);break;}
case"reverse":index=pv.range(n-1,-1,-1);break;default:index=pv.range(n);break;}
switch(s.offset){case"silohouette":{for(var j=0;j<m;j++){var o=0;for(var i=0;i<n;i++)o+=dy[i][j];y[index[0]][j]=(h-o)/2;}
break;}
case"wiggle":{var o=0;for(var i=0;i<n;i++)o+=dy[i][0];y[index[0]][0]=o=(h-o)/2;for(var j=1;j<m;j++){var s1=0,s2=0,dx=x[j]-x[j-1];for(var i=0;i<n;i++)s1+=dy[i][j];for(var i=0;i<n;i++){var s3=(dy[index[i]][j]-dy[index[i]][j-1])/(2*dx);for(var k=0;k<i;k++){s3+=(dy[index[k]][j]-dy[index[k]][j-1])/dx;}
s2+=s3*dy[index[i]][j];}
y[index[0]][j]=o-=s1?s2/s1*dx:0;}
break;}
case"expand":{for(var j=0;j<m;j++){y[index[0]][j]=0;var k=0;for(var i=0;i<n;i++)k+=dy[i][j];if(k){k=h/k;for(var i=0;i<n;i++)dy[i][j]*=k;}else{k=h/n;for(var i=0;i<n;i++)dy[i][j]=k;}}
break;}
default:{for(var j=0;j<m;j++)y[index[0]][j]=0;break;}}
for(var j=0;j<m;j++){var o=y[index[0]][j];for(var i=1;i<n;i++){o+=dy[index[i-1]][j];y[index[i]][j]=o;}}
var i=orient.indexOf("-"),pdy=horizontal?"h":"w",px=i<0?(horizontal?"l":"b"):orient.charAt(i+1),py=orient.charAt(0);for(var p in prop)prop[p]=none;prop[px]=function(i,j){return x[j];};prop[py]=function(i,j){return y[i][j];};prop[pdy]=function(i,j){return dy[i][j];};};this.layer=new pv.Mark().data(function(){return values[this.parent.index];}).top(proxy("t")).left(proxy("l")).right(proxy("r")).bottom(proxy("b")).width(proxy("w")).height(proxy("h"));this.layer.add=function(type){return that.add(pv.Panel).data(function(){return that.layers();}).add(type).extend(this);};};pv.Layout.Stack.prototype=pv.extend(pv.Layout).property("orient",String).property("offset",String).property("order",String).property("layers");pv.Layout.Stack.prototype.defaults=new pv.Layout.Stack().extend(pv.Layout.prototype.defaults).orient("bottom-left").offset("zero").layers([[]]);pv.Layout.Stack.prototype.$x=pv.Layout.Stack.prototype.$y=function(){return 0;};pv.Layout.Stack.prototype.x=function(f){this.$x=pv.functor(f);return this;};pv.Layout.Stack.prototype.y=function(f){this.$y=pv.functor(f);return this;};pv.Layout.Stack.prototype.$values=pv.identity;pv.Layout.Stack.prototype.values=function(f){this.$values=pv.functor(f);return this;};pv.Layout.Band=function(){pv.Layout.call(this);var that=this,buildImplied=that.buildImplied,itemProps,values;var itemProto=new pv.Mark().data(function(){return values[this.parent.index];}).top(proxy("t")).left(proxy("l")).right(proxy("r")).bottom(proxy("b")).width(proxy("w")).height(proxy("h"));function proxy(name){return function(){return itemProps[name](this.index,this.parent.index);};}
this.buildImplied=function(s){buildImplied.call(this,s);itemProps=Object.create(pv.Layout.Band.$baseItemProps);values=[];var data=s.layers,L=data.length;if(L>0){var orient=s.orient,horizontal=/^(top|bottom)\b/.test(orient),bh=this.parent[horizontal?"height":"width"](),bands=this._readData(data,values,s),B=bands.length;if(s.bandOrder==="reverse"){bands.reverse();}
if(s.order==="reverse"){values.reverse();for(var b=0;b<B;b++){bands[b].items.reverse();}}
switch(s.layout){case"grouped":this._calcGrouped(bands,L,s);break;case"stacked":this._calcStacked(bands,L,bh,s);break;}
this._bindItemProps(bands,itemProps,orient,horizontal);}};var itemAccessor=this.item={end:this,add:function(type){return that.add(pv.Panel).data(function(){return that.layers();}).add(type).extend(itemProto);},order:function(value){that.order(value);return this;},w:function(f){that.$iw=pv.functor(f);return this;},h:function(f){that.$ih=pv.functor(f);return this;},horizontalRatio:function(f){that.$ihorizRatio=pv.functor(f);return this;},verticalMargin:function(f){that.$ivertiMargin=pv.functor(f);return this;}};var bandAccessor=this.band={end:this,w:function(f){that.$bw=pv.functor(f);return this;},x:function(f){that.$bx=pv.functor(f);return this;},order:function(value){that.bandOrder(value);return this;},differentialControl:function(f){that.$bDiffControl=pv.functor(f);return this;}};this.band.item=itemAccessor;this.item.band=bandAccessor;};pv.Layout.Band.$baseItemProps=(function(){var none=function(){return null;};return{t:none,l:none,r:none,b:none,w:none,h:none};}());pv.Layout.Band.prototype=pv.extend(pv.Layout).property("orient",String).property("layout",String).property("layers").property("yZero",Number).property("verticalMode",String).property("horizontalMode",String).property("order",String).property("bandOrder",String);pv.Layout.Band.prototype.defaults=new pv.Layout.Band().extend(pv.Layout.prototype.defaults).orient("bottom-left").layout("grouped").yZero(0).layers([[]]);pv.Layout.Band.prototype.$bx=pv.Layout.Band.prototype.$bw=pv.Layout.Band.prototype.$bDiffControl=pv.Layout.Band.prototype.$iw=pv.Layout.Band.prototype.$ih=pv.Layout.Band.prototype.$ivertiMargin=pv.functor(0);pv.Layout.Band.prototype.$ihorizRatio=pv.functor(0.9);pv.Layout.Band.prototype.$values=pv.identity;pv.Layout.Band.prototype.values=function(f){this.$values=pv.functor(f);return this;};pv.Layout.prototype._readData=function(data,layersValues,scene){var L=data.length,bands=[],B;var stack=pv.Mark.stack,o={parent:{parent:this}};stack.unshift(null);for(var l=0;l<L;l++){o.parent.index=l;stack[0]=data[l];var layerValues=layersValues[l]=this.$values.apply(o.parent,stack);if(!l){B=layerValues.length;}
stack.unshift(null);for(var b=0;b<B;b++){stack[0]=layerValues[b];o.index=b;var band=bands[b];if(!band){band=bands[b]={horizRatio:this.$ihorizRatio.apply(o,stack),vertiMargin:this.$ivertiMargin.apply(o,stack),w:this.$bw.apply(o,stack),x:this.$bx.apply(o,stack),diffControl:this.$bDiffControl?this.$bDiffControl.apply(o,stack):0,items:[]};}
var ih=this.$ih.apply(o,stack);band.items[l]={y:(scene.yZero||0),x:0,w:this.$iw.apply(o,stack),h:ih!=null?Math.abs(ih):ih,dir:ih<0?-1:1};}
stack.shift();}
stack.shift();return bands;};pv.Layout.Band.prototype._calcGrouped=function(bands,L,scene){for(var b=0,B=bands.length;b<B;b++){var band=bands[b],items=band.items,w=band.w,horizRatio=band.horizRatio,wItems=0;for(var l=0;l<L;l++){wItems+=items[l].w;}
if(L===1){horizRatio=1;}else if(!(horizRatio>0&&horizRatio<=1)){horizRatio=1;}
if(w==null){w=band.w=wItems/horizRatio;}else if(scene.horizontalMode==='expand'){var wItems2=horizRatio*w;if(wItems){var wScale=wItems2/wItems;for(var l=0;l<L;l++){items[l].w*=wScale;}}else{var wiavg=wItems2/L;for(var l=0;l<L;l++){items[l].w=wiavg;}}
wItems=wItems2;}
var wItemsWithMargin=wItems/horizRatio,ix=band.x-(wItemsWithMargin/2),margin=L>1?((wItemsWithMargin-wItems)/(L-1)):0;for(var l=0;l<L;l++){var item=items[l];item.x=ix;ix+=item.w+margin;if(item.dir<0){item.y-=item.h;}}}};pv.Layout.Band.prototype._calcStacked=function(bands,L,bh,scene){var B=bands.length,items;if(scene.verticalMode==="expand"){for(var b=0;b<B;b++){items=bands[b].items;var hSum=null,nonNullCount=0;for(var l=0;l<L;l++){var item=items[l];item.dir=1;var h=item.h;if(h!=null){nonNullCount++;hSum+=h;}}
if(nonNullCount){if(hSum){var hScale=bh/hSum;for(var l=0;l<L;l++){var h=items[l].h;if(h!=null){items[l].h=h*hScale;}}}else{var hAvg=bh/nonNullCount;for(var l=0;l<L;l++){var h=items[l].h;if(h!=null){items[l].h=hAvg;}}}}}}
var yZero=scene.yZero,yOffset=yZero;for(var b=0;b<B;b++){var band=bands[b],bx=band.x,bDiffControl=band.diffControl,positiveGoesDown=(bDiffControl<0),vertiMargin=Math.max(0,band.vertiMargin);items=band.items;var resultPos=this._layoutItemsOfDir(+1,positiveGoesDown,items,vertiMargin,bx,yOffset),resultNeg=null;if(resultPos.existsOtherDir){resultNeg=this._layoutItemsOfDir(-1,positiveGoesDown,items,vertiMargin,bx,yOffset);}
if(bDiffControl){if(Math.abs(bDiffControl)===1){var yOffset0=yOffset;yOffset=resultPos.yOffset;if(resultNeg){yOffset-=(yOffset0-resultNeg.yOffset);}}}else{yOffset=yZero;}}};pv.Layout.Band.prototype._layoutItemsOfDir=function(stackDir,positiveGoesDown,items,vertiMargin,bx,yOffset){var existsOtherDir=false,vertiMargin2=vertiMargin/2,efDir=(positiveGoesDown?-stackDir:stackDir),reverseLayers=positiveGoesDown;for(var l=0,L=items.length;l<L;l+=1){var item=items[reverseLayers?(L-l-1):l];if(item.dir===stackDir){var h=item.h||0;if(efDir>0){item.y=yOffset+vertiMargin2;yOffset+=h;}else{item.y=yOffset-(h-vertiMargin2);yOffset-=h;}
var h2=h-vertiMargin;item.h=h2>0?h2:0;item.x=bx-item.w/2;}else{existsOtherDir=true;}}
return{existsOtherDir:existsOtherDir,yOffset:yOffset};};pv.Layout.Band.prototype._bindItemProps=function(bands,itemProps,orient,horizontal){var index=orient.indexOf("-"),ph=horizontal?"h":"w",pw=horizontal?"w":"h",px=index<0?(horizontal?"l":"b"):orient.charAt(index+1),py=orient.charAt(0);itemProps[px]=function(b,l){return bands[b].items[l].x;};itemProps[py]=function(b,l){return bands[b].items[l].y;};itemProps[pw]=function(b,l){return bands[b].items[l].w;};itemProps[ph]=function(b,l){return bands[b].items[l].h||0;};};pv.Layout.Treemap=function(){pv.Layout.Hierarchy.call(this);this.node.strokeStyle("#fff").fillStyle("rgba(31, 119, 180, .25)").width(function(n){return n.dx;}).height(function(n){return n.dy;});this.label.visible(function(n){return!n.firstChild;}).left(function(n){return n.x+(n.dx/2);}).top(function(n){return n.y+(n.dy/2);}).textAlign("center").textAngle(function(n){return n.dx>n.dy?0:-Math.PI/2;});(this.leaf=new pv.Mark().extend(this.node).fillStyle(null).strokeStyle(null).visible(function(n){return!n.firstChild;})).parent=this;delete this.link;};pv.Layout.Treemap.prototype=pv.extend(pv.Layout.Hierarchy).property("round",Boolean).property("mode",String).property("order",String);pv.Layout.Treemap.prototype.defaults=new pv.Layout.Treemap().extend(pv.Layout.Hierarchy.prototype.defaults).mode("squarify").order("ascending");pv.Layout.Treemap.prototype.$size=function(d){return Number(d.nodeValue);};pv.Layout.Treemap.prototype.$padLeft=pv.Layout.Treemap.prototype.$padRight=pv.Layout.Treemap.prototype.$padBottom=pv.Layout.Treemap.prototype.$padTop=function(){return 0;};pv.Layout.Treemap.prototype.size=function(f){this.$size=pv.functor(f);return this;};pv.Layout.Treemap.prototype.padding=function(n){return this.paddingLeft(n).paddingRight(n).paddingTop(n).paddingBottom(n);};pv.Layout.Treemap.prototype.paddingLeft=function(f){if(arguments.length){this.$padLeft=f;}
return this.$padLeft;};pv.Layout.Treemap.prototype.paddingRight=function(f){if(arguments.length){this.$padRight=f;}
return this.$padRight;};pv.Layout.Treemap.prototype.paddingBottom=function(f){if(arguments.length){this.$padBottom=f;}
return this.$padBottom;};pv.Layout.Treemap.prototype.paddingTop=function(f){if(arguments.length){this.$padTop=f;}
return this.$padTop;};pv.Layout.Treemap.prototype.buildImplied=function(s){pv.Layout.Hierarchy.prototype.buildImplied.call(this,s);var that=this,nodes=s.nodes,root=nodes[0],stack=pv.Mark.stack,left=s.paddingLeft,right=s.paddingRight,top=s.paddingTop,bottom=s.paddingBottom,size=function(n){return n.size;},round=s.round?Math.round:Number,mode=s.mode;function slice(row,sum,horizontal,x,y,w,h){for(var i=0,d=0;i<row.length;i++){var n=row[i];if(horizontal){n.x=x+d;n.y=y;d+=n.dx=round(w*n.size/sum);n.dy=h;}else{n.x=x;n.y=y+d;n.dx=w;d+=n.dy=round(h*n.size/sum);}}
if(n){if(horizontal){n.dx+=w-d;}else{n.dy+=h-d;}}}
function ratio(row,l){var rmax=-Infinity,rmin=Infinity,s=0;for(var i=0;i<row.length;i++){var r=row[i].size;if(r<rmin)rmin=r;if(r>rmax)rmax=r;s+=r;}
s=s*s;l=l*l;return Math.max(l*rmax/s,s/(l*rmin));}
function layout(n,i){var p=n.parentNode,x=n.x,y=n.y,w=n.dx,h=n.dy;if(p){x+=p.paddingLeft;y+=p.paddingTop;w+=-p.paddingLeft-p.paddingRight,h+=-p.paddingTop-p.paddingBottom;}
if(mode!="squarify"){slice(n.childNodes,n.size,mode=="slice"?true:mode=="dice"?false:i&1,x,y,w,h);return;}
var row=[],mink=Infinity,l=Math.min(w,h),k=w*h/n.size;if(n.size<=0)return;n.visitBefore(function(n){n.size*=k;});function position(row){var horizontal=w==l,sum=pv.sum(row,size),r=l?round(sum/l):0;slice(row,sum,horizontal,x,y,horizontal?w:r,horizontal?r:h);if(horizontal){y+=r;h-=r;}else{x+=r;w-=r;}
l=Math.min(w,h);return horizontal;}
var children=n.childNodes.slice();while(children.length){var child=children[children.length-1];if(!child.size){children.pop();continue;}
row.push(child);var k=ratio(row,l);if(k<=mink){children.pop();mink=k;}else{row.pop();position(row);row.length=0;mink=Infinity;}}
if(position(row))for(var i=0;i<row.length;i++){row[i].dy+=h;}else for(var i=0;i<row.length;i++){row[i].dx+=w;}}
stack.unshift(null);try{root.visitAfter(function(n,i){n.depth=i;n.x=n.y=n.dx=n.dy=0;stack[0]=n;var f;if(n.firstChild){n.size=pv.sum(n.childNodes,size);n.paddingRight=+that.$padRight.apply(that,stack)||0;n.paddingLeft=+that.$padLeft.apply(that,stack)||0;n.paddingBottom=+that.$padBottom.apply(that,stack)||0;n.paddingTop=+that.$padTop.apply(that,stack)||0;}else{n.size=that.$size.apply(that,stack);}});}finally{stack.shift();}
switch(s.order){case"ascending":root.sort(function(a,b){return a.size-b.size;});break;case"descending":root.sort(function(a,b){return b.size-a.size;});break;case"reverse":root.reverse();break;}
root.x=0;root.y=0;root.dx=s.width;root.dy=s.height;root.visitBefore(layout);};pv.Layout.Tree=function(){pv.Layout.Hierarchy.call(this);};pv.Layout.Tree.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("breadth",Number).property("depth",Number).property("orient",String);pv.Layout.Tree.prototype.defaults=new pv.Layout.Tree().extend(pv.Layout.Hierarchy.prototype.defaults).group(1).breadth(15).depth(60).orient("top");pv.Layout.Tree.prototype.buildImplied=function(s){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,s))return;var nodes=s.nodes,orient=s.orient,depth=s.depth,breadth=s.breadth,group=s.group,w=s.width,h=s.height;function firstWalk(v){var l,r,a;if(!v.firstChild){if(l=v.previousSibling){v.prelim=l.prelim+distance(v.depth,true);}}else{l=v.firstChild;r=v.lastChild;a=l;for(var c=l;c;c=c.nextSibling){firstWalk(c);a=apportion(c,a);}
executeShifts(v);var midpoint=.5*(l.prelim+r.prelim);if(l=v.previousSibling){v.prelim=l.prelim+distance(v.depth,true);v.mod=v.prelim-midpoint;}else{v.prelim=midpoint;}}}
function secondWalk(v,m,depth){v.breadth=v.prelim+m;m+=v.mod;for(var c=v.firstChild;c;c=c.nextSibling){secondWalk(c,m,depth);}}
function apportion(v,a){var w=v.previousSibling;if(w){var vip=v,vop=v,vim=w,vom=v.parentNode.firstChild,sip=vip.mod,sop=vop.mod,sim=vim.mod,som=vom.mod,nr=nextRight(vim),nl=nextLeft(vip);while(nr&&nl){vim=nr;vip=nl;vom=nextLeft(vom);vop=nextRight(vop);vop.ancestor=v;var shift=(vim.prelim+sim)-(vip.prelim+sip)+distance(vim.depth,false);if(shift>0){moveSubtree(ancestor(vim,v,a),v,shift);sip+=shift;sop+=shift;}
sim+=vim.mod;sip+=vip.mod;som+=vom.mod;sop+=vop.mod;nr=nextRight(vim);nl=nextLeft(vip);}
if(nr&&!nextRight(vop)){vop.thread=nr;vop.mod+=sim-sop;}
if(nl&&!nextLeft(vom)){vom.thread=nl;vom.mod+=sip-som;a=v;}}
return a;}
function nextLeft(v){return v.firstChild||v.thread;}
function nextRight(v){return v.lastChild||v.thread;}
function moveSubtree(wm,wp,shift){var subtrees=wp.number-wm.number;wp.change-=shift/subtrees;wp.shift+=shift;wm.change+=shift/subtrees;wp.prelim+=shift;wp.mod+=shift;}
function executeShifts(v){var shift=0,change=0;for(var c=v.lastChild;c;c=c.previousSibling){c.prelim+=shift;c.mod+=shift;change+=c.change;shift+=c.shift+change;}}
function ancestor(vim,v,a){return(vim.ancestor.parentNode==v.parentNode)?vim.ancestor:a;}
function distance(depth,siblings){return(siblings?1:(group+1))/((orient=="radial")?depth:1);}
var root=nodes[0];root.visitAfter(function(v,i){v.ancestor=v;v.prelim=0;v.mod=0;v.change=0;v.shift=0;v.number=v.previousSibling?(v.previousSibling.number+1):0;v.depth=i;});firstWalk(root);secondWalk(root,-root.prelim,0);function midAngle(n){return(orient=="radial")?n.breadth/depth:0;}
function x(n){switch(orient){case"left":return n.depth;case"right":return w-n.depth;case"top":case"bottom":return n.breadth+w/2;case"radial":return w/2+n.depth*Math.cos(midAngle(n));}}
function y(n){switch(orient){case"left":case"right":return n.breadth+h/2;case"top":return n.depth;case"bottom":return h-n.depth;case"radial":return h/2+n.depth*Math.sin(midAngle(n));}}
root.visitAfter(function(v){v.breadth*=breadth;v.depth*=depth;v.midAngle=midAngle(v);v.x=x(v);v.y=y(v);if(v.firstChild)v.midAngle+=Math.PI;delete v.breadth;delete v.depth;delete v.ancestor;delete v.prelim;delete v.mod;delete v.change;delete v.shift;delete v.number;delete v.thread;});};pv.Layout.Indent=function(){pv.Layout.Hierarchy.call(this);this.link.interpolate("step-after");};pv.Layout.Indent.prototype=pv.extend(pv.Layout.Hierarchy).property("depth",Number).property("breadth",Number);pv.Layout.Indent.prototype.defaults=new pv.Layout.Indent().extend(pv.Layout.Hierarchy.prototype.defaults).depth(15).breadth(15);pv.Layout.Indent.prototype.buildImplied=function(s){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,s))return;var nodes=s.nodes,bspace=s.breadth,dspace=s.depth,ax=0,ay=0;function position(n,breadth,depth){n.x=ax+depth++*dspace;n.y=ay+breadth++*bspace;n.midAngle=0;for(var c=n.firstChild;c;c=c.nextSibling){breadth=position(c,breadth,depth);}
return breadth;}
position(nodes[0],1,1);};pv.Layout.Pack=function(){pv.Layout.Hierarchy.call(this);this.node.shapeRadius(function(n){return n.radius;}).strokeStyle("rgb(31, 119, 180)").fillStyle("rgba(31, 119, 180, .25)");this.label.textAlign("center");delete this.link;};pv.Layout.Pack.prototype=pv.extend(pv.Layout.Hierarchy).property("spacing",Number).property("order",String);pv.Layout.Pack.prototype.defaults=new pv.Layout.Pack().extend(pv.Layout.Hierarchy.prototype.defaults).spacing(1).order("ascending");pv.Layout.Pack.prototype.$radius=function(){return 1;};pv.Layout.Pack.prototype.size=function(f){this.$radius=typeof f=="function"?function(){return Math.sqrt(f.apply(this,arguments));}:(f=Math.sqrt(f),function(){return f;});return this;};pv.Layout.Pack.prototype.buildImplied=function(s){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,s))return;var that=this,nodes=s.nodes,root=nodes[0];function radii(nodes){var stack=pv.Mark.stack;stack.unshift(null);for(var i=0,n=nodes.length;i<n;i++){var c=nodes[i];if(!c.firstChild){c.radius=that.$radius.apply(that,(stack[0]=c,stack));}}
stack.shift();}
function packTree(n){var nodes=[];for(var c=n.firstChild;c;c=c.nextSibling){if(c.firstChild)c.radius=packTree(c);c.n=c.p=c;nodes.push(c);}
switch(s.order){case"ascending":{nodes.sort(function(a,b){return a.radius-b.radius;});break;}
case"descending":{nodes.sort(function(a,b){return b.radius-a.radius;});break;}
case"reverse":nodes.reverse();break;}
return packCircle(nodes);}
function packCircle(nodes){var xMin=Infinity,xMax=-Infinity,yMin=Infinity,yMax=-Infinity,a,b,c,j,k;function bound(n){xMin=Math.min(n.x-n.radius,xMin);xMax=Math.max(n.x+n.radius,xMax);yMin=Math.min(n.y-n.radius,yMin);yMax=Math.max(n.y+n.radius,yMax);}
function insert(a,b){var c=a.n;a.n=b;b.p=a;b.n=c;c.p=b;}
function splice(a,b){a.n=b;b.p=a;}
function intersects(a,b){var dx=b.x-a.x,dy=b.y-a.y,dr=a.radius+b.radius;return(dr*dr-dx*dx-dy*dy)>.001;}
a=nodes[0];a.x=-a.radius;a.y=0;bound(a);if(nodes.length>1){b=nodes[1];b.x=b.radius;b.y=0;bound(b);if(nodes.length>2){c=nodes[2];place(a,b,c);bound(c);insert(a,c);a.p=c;insert(c,b);b=a.n;for(var i=3;i<nodes.length;i++){place(a,b,c=nodes[i]);var isect=0,s1=1,s2=1;for(j=b.n;j!=b;j=j.n,s1++){if(intersects(j,c)){isect=1;break;}}
if(isect==1){for(k=a.p;k!=j.p;k=k.p,s2++){if(intersects(k,c)){if(s2<s1){isect=-1;j=k;}
break;}}}
if(isect==0){insert(a,c);b=c;bound(c);}else if(isect>0){splice(a,j);b=j;i--;}else if(isect<0){splice(j,b);a=j;i--;}}}}
var cx=(xMin+xMax)/2,cy=(yMin+yMax)/2,cr=0;for(var i=0;i<nodes.length;i++){var n=nodes[i];n.x-=cx;n.y-=cy;cr=Math.max(cr,n.radius+Math.sqrt(n.x*n.x+n.y*n.y));}
return cr+s.spacing;}
function place(a,b,c){var da=b.radius+c.radius,db=a.radius+c.radius,dx=b.x-a.x,dy=b.y-a.y,dc=Math.sqrt(dx*dx+dy*dy),cos=(db*db+dc*dc-da*da)/(2*db*dc),theta=Math.acos(cos),x=cos*db,h=Math.sin(theta)*db;dx/=dc;dy/=dc;c.x=a.x+x*dx+h*dy;c.y=a.y+x*dy-h*dx;}
function transform(n,x,y,k){for(var c=n.firstChild;c;c=c.nextSibling){c.x+=n.x;c.y+=n.y;transform(c,x,y,k);}
n.x=x+k*n.x;n.y=y+k*n.y;n.radius*=k;}
radii(nodes);root.x=0;root.y=0;root.radius=packTree(root);var w=this.width(),h=this.height(),k=1/Math.max(2*root.radius/w,2*root.radius/h);transform(root,w/2,h/2,k);};pv.Layout.Force=function(){pv.Layout.Network.call(this);this.link.lineWidth(function(d,p){return Math.sqrt(p.linkValue)*1.5;});this.label.textAlign("center");};pv.Layout.Force.prototype=pv.extend(pv.Layout.Network).property("bound",Boolean).property("iterations",Number).property("dragConstant",Number).property("chargeConstant",Number).property("chargeMinDistance",Number).property("chargeMaxDistance",Number).property("chargeTheta",Number).property("springConstant",Number).property("springDamping",Number).property("springLength",Number);pv.Layout.Force.prototype.defaults=new pv.Layout.Force().extend(pv.Layout.Network.prototype.defaults).dragConstant(.1).chargeConstant(-40).chargeMinDistance(2).chargeMaxDistance(500).chargeTheta(.9).springConstant(.1).springDamping(.3).springLength(20);pv.Layout.Force.prototype.buildImplied=function(s){if(pv.Layout.Network.prototype.buildImplied.call(this,s)){var f=s.$force;if(f){f.next=this.binds.$force;this.binds.$force=f;}
return;}
var that=this,nodes=s.nodes,links=s.links,k=s.iterations,w=s.width,h=s.height;for(var i=0,n;i<nodes.length;i++){n=nodes[i];if(isNaN(n.x))n.x=w/2+40*Math.random()-20;if(isNaN(n.y))n.y=h/2+40*Math.random()-20;}
var sim=pv.simulation(nodes);sim.force(pv.Force.drag(s.dragConstant));sim.force(pv.Force.charge(s.chargeConstant).domain(s.chargeMinDistance,s.chargeMaxDistance).theta(s.chargeTheta));sim.force(pv.Force.spring(s.springConstant).damping(s.springDamping).length(s.springLength).links(links));sim.constraint(pv.Constraint.position());if(s.bound){sim.constraint(pv.Constraint.bound().x(6,w-6).y(6,h-6));}
function speed(n){return n.fix?1:n.vx*n.vx+n.vy*n.vy;}
if(k==null){sim.step();sim.step();var force=s.$force=this.binds.$force={next:this.binds.$force,nodes:nodes,min:1e-4*(links.length+1),sim:sim};if(!this.$timer)this.$timer=setInterval(function(){var render=false;for(var f=that.binds.$force;f;f=f.next){if(pv.max(f.nodes,speed)>f.min){f.sim.step();render=true;}}
if(render)that.render();},42);}else for(var i=0;i<k;i++){sim.step();}};pv.Layout.Cluster=function(){pv.Layout.Hierarchy.call(this);var interpolate,buildImplied=this.buildImplied;this.buildImplied=function(s){buildImplied.call(this,s);interpolate=/^(top|bottom)$/.test(s.orient)?"step-before":/^(left|right)$/.test(s.orient)?"step-after":"linear";};this.link.interpolate(function(){return interpolate;});};pv.Layout.Cluster.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);pv.Layout.Cluster.prototype.defaults=new pv.Layout.Cluster().extend(pv.Layout.Hierarchy.prototype.defaults).group(0).orient("top");pv.Layout.Cluster.prototype.buildImplied=function(s){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,s))return;var root=s.nodes[0],group=s.group,breadth,depth,leafCount=0,leafIndex=.5-group/2;var p=undefined;root.visitAfter(function(n){if(n.firstChild){n.depth=1+pv.max(n.childNodes,function(n){return n.depth;});}else{if(group&&(p!=n.parentNode)){p=n.parentNode;leafCount+=group;}
leafCount++;n.depth=0;}});breadth=1/leafCount;depth=1/root.depth;var p=undefined;root.visitAfter(function(n){if(n.firstChild){n.breadth=pv.mean(n.childNodes,function(n){return n.breadth;});}else{if(group&&(p!=n.parentNode)){p=n.parentNode;leafIndex+=group;}
n.breadth=breadth*leafIndex++;}
n.depth=1-n.depth*depth;});root.visitAfter(function(n){n.minBreadth=n.firstChild?n.firstChild.minBreadth:(n.breadth-breadth/2);n.maxBreadth=n.firstChild?n.lastChild.maxBreadth:(n.breadth+breadth/2);});root.visitBefore(function(n){n.minDepth=n.parentNode?n.parentNode.maxDepth:0;n.maxDepth=n.parentNode?(n.depth+root.depth):(n.minDepth+2*root.depth);});root.minDepth=-depth;pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,s);};pv.Layout.Cluster.Fill=function(){pv.Layout.Cluster.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this);};pv.Layout.Cluster.Fill.prototype=pv.extend(pv.Layout.Cluster);pv.Layout.Cluster.Fill.prototype.buildImplied=function(s){if(pv.Layout.Cluster.prototype.buildImplied.call(this,s))return;pv.Layout.Hierarchy.Fill.buildImplied.call(this,s);};pv.Layout.Partition=function(){pv.Layout.Hierarchy.call(this);};pv.Layout.Partition.prototype=pv.extend(pv.Layout.Hierarchy).property("order",String).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);pv.Layout.Partition.prototype.defaults=new pv.Layout.Partition().extend(pv.Layout.Hierarchy.prototype.defaults).orient("top");pv.Layout.Partition.prototype.$size=function(){return 1;};pv.Layout.Partition.prototype.size=function(f){this.$size=f;return this;};pv.Layout.Partition.prototype.buildImplied=function(s){if(pv.Layout.Hierarchy.prototype.buildImplied.call(this,s))return;var that=this,root=s.nodes[0],stack=pv.Mark.stack,maxDepth=0;stack.unshift(null);root.visitAfter(function(n,depth){if(depth>maxDepth)maxDepth=depth;n.size=n.firstChild?pv.sum(n.childNodes,function(n){return n.size;}):that.$size.apply(that,(stack[0]=n,stack));});stack.shift();switch(s.order){case"ascending":root.sort(function(a,b){return a.size-b.size;});break;case"descending":root.sort(function(b,a){return a.size-b.size;});break;}
root.minBreadth=0;root.breadth=.5;root.maxBreadth=1;root.visitBefore(function(n){var b=n.minBreadth,s=n.maxBreadth-b;for(var c=n.firstChild;c;c=c.nextSibling){c.minBreadth=b;b+=(c.size/n.size)*s;c.maxBreadth=b;c.breadth=(b+c.minBreadth)/2;}});root.visitAfter(function(n,depth){n.minDepth=(depth-1)/maxDepth;n.maxDepth=(n.depth=depth/maxDepth);});pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,s);};pv.Layout.Partition.Fill=function(){pv.Layout.Partition.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this);};pv.Layout.Partition.Fill.prototype=pv.extend(pv.Layout.Partition);pv.Layout.Partition.Fill.prototype.buildImplied=function(s){if(pv.Layout.Partition.prototype.buildImplied.call(this,s))return;pv.Layout.Hierarchy.Fill.buildImplied.call(this,s);};pv.Layout.Arc=function(){pv.Layout.Network.call(this);var interpolate,directed,reverse,buildImplied=this.buildImplied;this.buildImplied=function(s){buildImplied.call(this,s);directed=s.directed;interpolate=s.orient=="radial"?"linear":"polar";reverse=s.orient=="right"||s.orient=="top";};this.link.data(function(p){var s=p.sourceNode,t=p.targetNode;return reverse!=(directed||(s.breadth<t.breadth))?[s,t]:[t,s];}).interpolate(function(){return interpolate;});};pv.Layout.Arc.prototype=pv.extend(pv.Layout.Network).property("orient",String).property("directed",Boolean);pv.Layout.Arc.prototype.defaults=new pv.Layout.Arc().extend(pv.Layout.Network.prototype.defaults).orient("bottom");pv.Layout.Arc.prototype.sort=function(f){this.$sort=f;return this;};pv.Layout.Arc.prototype.buildImplied=function(s){if(pv.Layout.Network.prototype.buildImplied.call(this,s))return;var nodes=s.nodes,orient=s.orient,sort=this.$sort,index=pv.range(nodes.length),w=s.width,h=s.height,r=Math.min(w,h)/2;if(sort)index.sort(function(a,b){return sort(nodes[a],nodes[b]);});function midAngle(b){switch(orient){case"top":return-Math.PI/2;case"bottom":return Math.PI/2;case"left":return Math.PI;case"right":return 0;case"radial":return(b-.25)*2*Math.PI;}}
function x(b){switch(orient){case"top":case"bottom":return b*w;case"left":return 0;case"right":return w;case"radial":return w/2+r*Math.cos(midAngle(b));}}
function y(b){switch(orient){case"top":return 0;case"bottom":return h;case"left":case"right":return b*h;case"radial":return h/2+r*Math.sin(midAngle(b));}}
for(var i=0;i<nodes.length;i++){var n=nodes[index[i]],b=n.breadth=(i+.5)/nodes.length;n.x=x(b);n.y=y(b);n.midAngle=midAngle(b);}};pv.Layout.Horizon=function(){pv.Layout.call(this);var that=this,bands,mode,size,fill,red,blue,buildImplied=this.buildImplied;this.buildImplied=function(s){buildImplied.call(this,s);bands=s.bands;mode=s.mode;size=Math.round((mode=="color"?.5:1)*s.height);fill=s.backgroundStyle;red=pv.ramp(fill,s.negativeStyle).domain(0,bands);blue=pv.ramp(fill,s.positiveStyle).domain(0,bands);};var bands=new pv.Panel().data(function(){return pv.range(bands*2);}).overflow("hidden").height(function(){return size;}).top(function(i){return mode=="color"?(i&1)*size:0;}).fillStyle(function(i){return i?null:fill;});this.band=new pv.Mark().top(function(d,i){return mode=="mirror"&&i&1?(i+1>>1)*size:null;}).bottom(function(d,i){return mode=="mirror"?(i&1?null:(i+1>>1)*-size):((i&1||-1)*(i+1>>1)*size);}).fillStyle(function(d,i){return(i&1?red:blue)((i>>1)+1);});this.band.add=function(type){return that.add(pv.Panel).extend(bands).add(type).extend(this);};};pv.Layout.Horizon.prototype=pv.extend(pv.Layout).property("bands",Number).property("mode",String).property("backgroundStyle",pv.fillStyle).property("positiveStyle",pv.fillStyle).property("negativeStyle",pv.fillStyle);pv.Layout.Horizon.prototype.defaults=new pv.Layout.Horizon().extend(pv.Layout.prototype.defaults).bands(2).mode("offset").backgroundStyle("white").positiveStyle("#1f77b4").negativeStyle("#d62728");pv.Layout.Rollup=function(){pv.Layout.Network.call(this);var that=this,nodes,links,buildImplied=that.buildImplied;this.buildImplied=function(s){buildImplied.call(this,s);nodes=s.$rollup.nodes;links=s.$rollup.links;};this.node.data(function(){return nodes;}).shapeSize(function(d){return d.nodes.length*20;});this.link.interpolate("polar").eccentricity(.8);this.link.add=function(type){return that.add(pv.Panel).data(function(){return links;}).add(type).extend(this);};};pv.Layout.Rollup.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);pv.Layout.Rollup.prototype.x=function(f){this.$x=pv.functor(f);return this;};pv.Layout.Rollup.prototype.y=function(f){this.$y=pv.functor(f);return this;};pv.Layout.Rollup.prototype.buildImplied=function(s){if(pv.Layout.Network.prototype.buildImplied.call(this,s))return;var nodes=s.nodes,links=s.links,directed=s.directed,n=nodes.length,x=[],y=[],rnindex=0,rnodes={},rlinks={};function id(i){return x[i]+","+y[i];}
var stack=pv.Mark.stack,o={parent:this};stack.unshift(null);for(var i=0;i<n;i++){o.index=i;stack[0]=nodes[i];x[i]=this.$x.apply(o,stack);y[i]=this.$y.apply(o,stack);}
stack.shift();for(var i=0;i<nodes.length;i++){var nodeId=id(i),rn=rnodes[nodeId];if(!rn){rn=rnodes[nodeId]=pv.extend(nodes[i]);rn.index=rnindex++;rn.x=x[i];rn.y=y[i];rn.nodes=[];}
rn.nodes.push(nodes[i]);}
for(var i=0;i<links.length;i++){var source=links[i].sourceNode,target=links[i].targetNode,rsource=rnodes[id(source.index)],rtarget=rnodes[id(target.index)],reverse=!directed&&rsource.index>rtarget.index,linkId=reverse?rtarget.index+","+rsource.index:rsource.index+","+rtarget.index,rl=rlinks[linkId];if(!rl){rl=rlinks[linkId]={sourceNode:rsource,targetNode:rtarget,linkValue:0,links:[]};}
rl.links.push(links[i]);rl.linkValue+=links[i].linkValue;}
s.$rollup={nodes:pv.values(rnodes),links:pv.values(rlinks)};};pv.Layout.Matrix=function(){pv.Layout.Network.call(this);var that=this,n,dx,dy,labels,pairs,buildImplied=that.buildImplied;this.buildImplied=function(s){buildImplied.call(this,s);n=s.nodes.length;dx=s.width/n;dy=s.height/n;labels=s.$matrix.labels;pairs=s.$matrix.pairs;};this.link.data(function(){return pairs;}).left(function(){return dx*(this.index%n);}).top(function(){return dy*Math.floor(this.index/n);}).width(function(){return dx;}).height(function(){return dy;}).lineWidth(1.5).strokeStyle("#fff").fillStyle(function(l){return l.linkValue?"#555":"#eee";}).parent=this;delete this.link.add;this.label.data(function(){return labels;}).left(function(){return this.index&1?dx*((this.index>>1)+.5):0;}).top(function(){return this.index&1?0:dy*((this.index>>1)+.5);}).textMargin(4).textAlign(function(){return this.index&1?"left":"right";}).textAngle(function(){return this.index&1?-Math.PI/2:0;});delete this.node;};pv.Layout.Matrix.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);pv.Layout.Matrix.prototype.sort=function(f){this.$sort=f;return this;};pv.Layout.Matrix.prototype.buildImplied=function(s){if(pv.Layout.Network.prototype.buildImplied.call(this,s))return;var nodes=s.nodes,links=s.links,sort=this.$sort,n=nodes.length,index=pv.range(n),labels=[],pairs=[],map={};s.$matrix={labels:labels,pairs:pairs};if(sort)index.sort(function(a,b){return sort(nodes[a],nodes[b]);});for(var i=0;i<n;i++){for(var j=0;j<n;j++){var a=index[i],b=index[j],p={row:i,col:j,sourceNode:nodes[a],targetNode:nodes[b],linkValue:0};pairs.push(map[a+"."+b]=p);}}
for(var i=0;i<n;i++){var a=index[i];labels.push(nodes[a],nodes[a]);}
for(var i=0;i<links.length;i++){var l=links[i],source=l.sourceNode.index,target=l.targetNode.index,value=l.linkValue;map[source+"."+target].linkValue+=value;if(!s.directed)map[target+"."+source].linkValue+=value;}};pv.Layout.Bullet=function(){pv.Layout.call(this);var that=this,buildImplied=that.buildImplied,scale=that.x=pv.Scale.linear(),orient,horizontal,rangeColor,measureColor,x;this.buildImplied=function(s){buildImplied.call(this,x=s);orient=s.orient;horizontal=/^left|right$/.test(orient);rangeColor=pv.ramp("#bbb","#eee").domain(0,Math.max(1,x.ranges.length-1));measureColor=pv.ramp("steelblue","lightsteelblue").domain(0,Math.max(1,x.measures.length-1));};(this.range=new pv.Mark()).data(function(){return x.ranges;}).reverse(true).left(function(){return orient=="left"?0:null;}).top(function(){return orient=="top"?0:null;}).right(function(){return orient=="right"?0:null;}).bottom(function(){return orient=="bottom"?0:null;}).width(function(d){return horizontal?scale(d):null;}).height(function(d){return horizontal?null:scale(d);}).fillStyle(function(){return rangeColor(this.index);}).antialias(false).parent=that;(this.measure=new pv.Mark()).extend(this.range).data(function(){return x.measures;}).left(function(){return orient=="left"?0:horizontal?null:this.parent.width()/3.25;}).top(function(){return orient=="top"?0:horizontal?this.parent.height()/3.25:null;}).right(function(){return orient=="right"?0:horizontal?null:this.parent.width()/3.25;}).bottom(function(){return orient=="bottom"?0:horizontal?this.parent.height()/3.25:null;}).fillStyle(function(){return measureColor(this.index);}).parent=that;(this.marker=new pv.Mark()).data(function(){return x.markers;}).left(function(d){return orient=="left"?scale(d):horizontal?null:this.parent.width()/2;}).top(function(d){return orient=="top"?scale(d):horizontal?this.parent.height()/2:null;}).right(function(d){return orient=="right"?scale(d):null;}).bottom(function(d){return orient=="bottom"?scale(d):null;}).strokeStyle("black").shape("bar").shapeAngle(function(){return horizontal?0:Math.PI/2;}).parent=that;(this.tick=new pv.Mark()).data(function(){return scale.ticks(7);}).left(function(d){return orient=="left"?scale(d):null;}).top(function(d){return orient=="top"?scale(d):null;}).right(function(d){return orient=="right"?scale(d):horizontal?null:-6;}).bottom(function(d){return orient=="bottom"?scale(d):horizontal?-8:null;}).height(function(){return horizontal?6:null;}).width(function(){return horizontal?null:6;}).parent=that;};pv.Layout.Bullet.prototype=pv.extend(pv.Layout).property("orient",String).property("ranges").property("markers").property("measures").property("maximum",Number);pv.Layout.Bullet.prototype.defaults=new pv.Layout.Bullet().extend(pv.Layout.prototype.defaults).orient("left").ranges([]).markers([]).measures([]);pv.Layout.Bullet.prototype.buildImplied=function(s){pv.Layout.prototype.buildImplied.call(this,s);var size=this.parent[/^left|right$/.test(s.orient)?"width":"height"]();s.maximum=s.maximum||pv.max([].concat(s.ranges,s.markers,s.measures));this.x.domain(0,s.maximum).range(0,size);};pv.Behavior={};pv.Behavior.dragBase=function(shared){var events,downElem,cancelClick,inited,drag;shared.autoRender=true;shared.positionConstraint=null;shared.bound=function(v,a_p){return Math.max(drag.min[a_p],Math.min(drag.max[a_p],v));};function mousedown(d){if(!inited){inited=true;this.addEventInterceptor('click',eventInterceptor,true);}
if(!events){var root=this.root.scene.$g;events=[[root,'mousemove',pv.listen(root,'mousemove',mousemove)],[root,'mouseup',pv.listen(root,'mouseup',mouseup)],[document,'mousemove',pv.listen(document,'mousemove',mousemove)],[document,'mouseup',pv.listen(document,'mouseup',mouseup)]];}
var ev=arguments[arguments.length-1];downElem=ev.target;cancelClick=false;ev.stopPropagation();var m1=this.mouse();var scene=this.scene;var index=this.index;drag=scene[index].drag={phase:'start',m:m1,m1:m1,m2:null,d:d,scene:scene,index:index};ev=wrapEvent(ev,drag);shared.dragstart.call(this,ev);var m=drag.m;if(m!==m1){m1.x=m.x;m1.y=m.y;}}
function mousemove(ev){if(!drag){return;}
drag.phase='move';ev.stopPropagation();ev=wrapEvent(ev,drag);var scene=drag.scene;scene.mark.context(scene,drag.index,function(){var mprev=drag.m2||drag.m1;var m2=this.mouse();if(mprev&&m2.distance2(mprev).dist2<=2){return;}
drag.m=drag.m2=m2;shared.drag.call(this,ev);var m=drag.m;if(m!==m2){m2.x=m.x;m2.y=m.y;}});}
function mouseup(ev){if(!drag){return;}
drag.phase='end';var m2=drag.m2;var isDrag=m2&&drag.m1.distance2(m2).dist2>0.1;drag.canceled=!isDrag;cancelClick=isDrag&&(downElem===ev.target);if(!cancelClick){downElem=null;}
ev.stopPropagation();ev=wrapEvent(ev,drag);if(events){events.forEach(function(registration){pv.unlisten.apply(pv,registration);});events=null;}
var scene=drag.scene;var index=drag.index;try{scene.mark.context(scene,index,function(){shared.dragend.call(this,ev);});}finally{drag=null;delete scene[index].drag;}}
function wrapEvent(ev,drag){try{ev.drag=drag;return ev;}catch(ex){}
var ev2={};for(var p in ev){var v=ev[p];ev2[p]=typeof v!=='function'?v:bindEventFun(v,ev);}
ev2._sourceEvent=ev;return ev2;}
function bindEventFun(f,ctx){return function(){return f.apply(ctx,arguments);};}
function eventInterceptor(type,ev){if(cancelClick&&downElem===ev.target){cancelClick=false;downElem=null;return false;}}
mousedown.autoRender=function(_){if(arguments.length){shared.autoRender=!!_;return mousedown;}
return shared.autoRender;};mousedown.positionConstraint=function(_){if(arguments.length){shared.positionConstraint=_;return mousedown;}
return shared.positionConstraint;};return mousedown;};pv.Behavior.drag=function(){var collapse=null;var kx=1;var ky=1;var v1;var shared={dragstart:function(ev){var drag=ev.drag;drag.type='drag';var p=drag.d;var fix=pv.vector(p.x,p.y);p.fix=fix;p.drag=drag;v1=fix.minus(drag.m1);var parent=this.parent;drag.max={x:parent.width()-(p.dx||0),y:parent.height()-(p.dy||0)};drag.min={x:0,y:0};if(shared.autoRender){this.render();}
pv.Mark.dispatch("dragstart",drag.scene,drag.index,ev);},drag:function(ev){var drag=ev.drag;var m2=drag.m2;var p=drag.d;drag.m=v1.plus(m2);var constraint=shared.positionConstraint;if(constraint){constraint(drag);}
var m=drag.m;if(kx){p.x=p.fix.x=shared.bound(m.x,'x');}
if(ky){p.y=p.fix.y=shared.bound(m.y,'y');}
if(shared.autoRender){this.render();}
pv.Mark.dispatch("drag",drag.scene,drag.index,ev);},dragend:function(ev){var drag=ev.drag;var p=drag.d;p.fix=null;v1=null;if(shared.autoRender){this.render();}
try{pv.Mark.dispatch('dragend',drag.scene,drag.index,ev);}finally{delete p.drag;}}};var mousedown=pv.Behavior.dragBase(shared);mousedown.collapse=function(x){if(arguments.length){collapse=String(x);switch(collapse){case"y":kx=1;ky=0;break;case"x":kx=0;ky=1;break;default:kx=1;ky=1;break;}
return mousedown;}
return collapse;};return mousedown;};pv.Behavior.point=function(r){var unpoint,collapse=null,kx=1,ky=1,pointingPanel=null,r2=arguments.length?r*r:900;function search(scene,index){var s=scene[index],point={cost:Infinity};for(var i=(s.visible?s.children.length:0)-1;i>=0;i--){var child=s.children[i],mark=child.mark,p;if(mark.type=="panel"){mark.scene=child;for(var j=child.length-1;j>=0;j--){mark.index=j;p=search(child,j);if(p.cost<point.cost)point=p;}
delete mark.scene;delete mark.index;}else if(mark.$handlers.point){var v=mark.mouse();for(var j=child.length-1;j>=0;j--){var c=child[j],dx=v.x-c.left-(c.width||0)/2,dy=v.y-c.top-(c.height||0)/2,dd=kx*dx*dx+ky*dy*dy;if(dd<point.cost){point.distance=dx*dx+dy*dy;point.cost=dd;point.scene=child;point.index=j;}}}}
return point;}
function mousemove(e){var point=search(this.scene,this.index);if((point.cost==Infinity)||(point.distance>r2))point=null;if(unpoint){if(point&&(unpoint.scene==point.scene)&&(unpoint.index==point.index))return;pv.Mark.dispatch("unpoint",unpoint.scene,unpoint.index,e);}
if(unpoint=point){pv.Mark.dispatch("point",point.scene,point.index,e);if(!pointingPanel&&this.type==='panel'){pointingPanel=this;pointingPanel.event('mouseout',function(){var ev=arguments[arguments.length-1];mouseout.call(pointingPanel.scene.$g,ev);});}else{pv.listen(this.root.canvas(),"mouseout",mouseout);}}}
function mouseout(e){if(unpoint&&!pv.ancestor(this,e.relatedTarget)){pv.Mark.dispatch("unpoint",unpoint.scene,unpoint.index,e);unpoint=null;}}
mousemove.collapse=function(x){if(arguments.length){collapse=String(x);switch(collapse){case"y":kx=1;ky=0;break;case"x":kx=0;ky=1;break;default:kx=1;ky=1;break;}
return mousemove;}
return collapse;};return mousemove;};pv.Behavior.select=function(){var collapse=null;var kx=1;var ky=1;var preserveLength=false;var shared={dragstart:function(ev){var drag=ev.drag;drag.type='select';var r=drag.d;r.drag=drag;drag.max={x:this.width(),y:this.height()};drag.min={x:0,y:0};var constraint=shared.positionConstraint;if(constraint){drag.m=drag.m.clone();constraint(drag);}
var m=drag.m;if(kx){r.x=shared.bound(m.x,'x');if(!preserveLength){r.dx=0;}}
if(ky){r.y=shared.bound(m.y,'y');if(!preserveLength){r.dy=0;}}
pv.Mark.dispatch('selectstart',drag.scene,drag.index,ev);},drag:function(ev){var drag=ev.drag;var m1=drag.m1;var r=drag.d;drag.max.x=this.width();drag.max.y=this.height();var constraint=shared.positionConstraint;if(constraint){drag.m=drag.m.clone();constraint(drag);}
var m=drag.m;if(kx){var bx=Math.min(m1.x,m.x);bx=shared.bound(bx,'x');r.x=bx;if(!preserveLength){var ex=Math.max(m.x,m1.x);ex=shared.bound(ex,'x');r.dx=ex-bx;}}
if(ky){var by=Math.min(m1.y,m.y);by=shared.bound(by,'y');r.y=by;if(!preserveLength){var ey=Math.max(m.y,m1.y);ey=shared.bound(ey,'y');r.dy=ey-by;}}
if(shared.autoRender){this.render();}
pv.Mark.dispatch('select',drag.scene,drag.index,ev);},dragend:function(ev){var drag=ev.drag;try{pv.Mark.dispatch('selectend',drag.scene,drag.index,ev);}finally{var r=drag.d;delete r.drag;}}};var mousedown=pv.Behavior.dragBase(shared);mousedown.collapse=function(x){if(arguments.length){collapse=String(x);switch(collapse){case"y":kx=1;ky=0;break;case"x":kx=0;ky=1;break;default:kx=1;ky=1;break;}
return mousedown;}
return collapse;};mousedown.preserveLength=function(_){if(arguments.length){preserveLength=!!_;return mousedown;}
return preserveLength;};return mousedown;};pv.Behavior.resize=function(side){var preserveOrtho=false;var isLeftRight=(side==='left'||side==='right');var shared={dragstart:function(ev){var drag=ev.drag;drag.type='resize';var m1=drag.m1;var r=drag.d;r.drag=drag;switch(side){case"left":m1.x=r.x+r.dx;break;case"right":m1.x=r.x;break;case"top":m1.y=r.y+r.dy;break;case"bottom":m1.y=r.y;break;}
var parent=this.parent;drag.max={x:parent.width(),y:parent.height()};drag.min={x:0,y:0};pv.Mark.dispatch("resizestart",drag.scene,drag.index,ev);},drag:function(ev){var drag=ev.drag;var m1=drag.m1;var constraint=shared.positionConstraint;if(constraint){drag.m=drag.m.clone();constraint(drag);}
var m=drag.m;var r=drag.d;if(!preserveOrtho||isLeftRight){var bx=Math.min(m1.x,m.x);var ex=Math.max(m.x,m1.x);bx=shared.bound(bx,'x');ex=shared.bound(ex,'x');r.x=bx;r.dx=ex-bx;}
if(!preserveOrtho||!isLeftRight){var by=Math.min(m1.y,m.y);var ey=Math.max(m.y,m1.y);bx=shared.bound(by,'y');ex=shared.bound(ey,'y');r.y=by;r.dy=ey-by;}
if(shared.autoRender){this.render();}
pv.Mark.dispatch("resize",drag.scene,drag.index,ev);},dragend:function(ev){var drag=ev.drag;max=null;try{pv.Mark.dispatch('resizeend',drag.scene,drag.index,ev);}finally{var r=drag.d;delete r.drag;}}};var mousedown=pv.Behavior.dragBase(shared);mousedown.preserveOrtho=function(_){if(arguments.length){preserveOrtho=!!_;return mousedown;}
return preserveOrtho;};return mousedown;};pv.Behavior.pan=function(){var scene,index,m1,v1,k,bound;function mousedown(){index=this.index;scene=this.scene;v1=pv.vector(pv.event.pageX,pv.event.pageY);m1=this.transform();k=1/(m1.k*this.scale);if(bound){bound={x:(1-m1.k)*this.width(),y:(1-m1.k)*this.height()};}}
function mousemove(e){if(!scene)return;scene.mark.context(scene,index,function(){var x=(pv.event.pageX-v1.x)*k,y=(pv.event.pageY-v1.y)*k,m=m1.translate(x,y);if(bound){m.x=Math.max(bound.x,Math.min(0,m.x));m.y=Math.max(bound.y,Math.min(0,m.y));}
this.transform(m).render();});pv.Mark.dispatch("pan",scene,index,e);}
function mouseup(){scene=null;}
mousedown.bound=function(x){if(arguments.length){bound=Boolean(x);return this;}
return Boolean(bound);};pv.listen(window,"mousemove",mousemove);pv.listen(window,"mouseup",mouseup);return mousedown;};pv.Behavior.zoom=function(speed){var bound;if(!arguments.length)speed=1/48;function mousewheel(e){var v=this.mouse(),k=pv.event.wheel*speed,m=this.transform().translate(v.x,v.y).scale((k<0)?(1e3/(1e3-k)):((1e3+k)/1e3)).translate(-v.x,-v.y);if(bound){m.k=Math.max(1,m.k);m.x=Math.max((1-m.k)*this.width(),Math.min(0,m.x));m.y=Math.max((1-m.k)*this.height(),Math.min(0,m.y));}
this.transform(m).render();pv.Mark.dispatch("zoom",this.scene,this.index,e);}
mousewheel.bound=function(x){if(arguments.length){bound=Boolean(x);return this;}
return Boolean(bound);};return mousewheel;};pv.Geo=function(){};pv.Geo.projections={mercator:{project:function(latlng){return{x:latlng.lng/180,y:latlng.lat>85?1:latlng.lat<-85?-1:Math.log(Math.tan(Math.PI/4
+pv.radians(latlng.lat)/2))/Math.PI};},invert:function(xy){return{lng:xy.x*180,lat:pv.degrees(2*Math.atan(Math.exp(xy.y*Math.PI))-Math.PI/2)};}},"gall-peters":{project:function(latlng){return{x:latlng.lng/180,y:Math.sin(pv.radians(latlng.lat))};},invert:function(xy){return{lng:xy.x*180,lat:pv.degrees(Math.asin(xy.y))};}},sinusoidal:{project:function(latlng){return{x:pv.radians(latlng.lng)*Math.cos(pv.radians(latlng.lat))/Math.PI,y:latlng.lat/90};},invert:function(xy){return{lng:pv.degrees((xy.x*Math.PI)/Math.cos(xy.y*Math.PI/2)),lat:xy.y*90};}},aitoff:{project:function(latlng){var l=pv.radians(latlng.lng),f=pv.radians(latlng.lat),a=Math.acos(Math.cos(f)*Math.cos(l/2));return{x:2*(a?(Math.cos(f)*Math.sin(l/2)*a/Math.sin(a)):0)/Math.PI,y:2*(a?(Math.sin(f)*a/Math.sin(a)):0)/Math.PI};},invert:function(xy){var x=xy.x*Math.PI/2,y=xy.y*Math.PI/2;return{lng:pv.degrees(x/Math.cos(y)),lat:pv.degrees(y)};}},hammer:{project:function(latlng){var l=pv.radians(latlng.lng),f=pv.radians(latlng.lat),c=Math.sqrt(1+Math.cos(f)*Math.cos(l/2));return{x:2*Math.SQRT2*Math.cos(f)*Math.sin(l/2)/c/3,y:Math.SQRT2*Math.sin(f)/c/1.5};},invert:function(xy){var x=xy.x*3,y=xy.y*1.5,z=Math.sqrt(1-x*x/16-y*y/4);return{lng:pv.degrees(2*Math.atan2(z*x,2*(2*z*z-1))),lat:pv.degrees(Math.asin(z*y))};}},identity:{project:function(latlng){return{x:latlng.lng/180,y:latlng.lat/90};},invert:function(xy){return{lng:xy.x*180,lat:xy.y*90};}}};pv.Geo.scale=function(p){var rmin={x:0,y:0},rmax={x:1,y:1},d=[],j=pv.Geo.projections.identity,x=pv.Scale.linear(-1,1).range(0,1),y=pv.Scale.linear(-1,1).range(1,0),c={lng:0,lat:0},lastLatLng,lastPoint;function scale(latlng){if(!lastLatLng||(latlng.lng!=lastLatLng.lng)||(latlng.lat!=lastLatLng.lat)){lastLatLng=latlng;var p=project(latlng);lastPoint={x:x(p.x),y:y(p.y)};}
return lastPoint;}
function project(latlng){var offset={lng:latlng.lng-c.lng,lat:latlng.lat};return j.project(offset);}
function invert(xy){var latlng=j.invert(xy);latlng.lng+=c.lng;return latlng;}
scale.x=function(latlng){return scale(latlng).x;};scale.y=function(latlng){return scale(latlng).y;};scale.ticks={lng:function(m){var lat,lng;if(d.length>1){var s=pv.Scale.linear();if(m==undefined)m=10;lat=s.domain(d,function(d){return d.lat;}).ticks(m);lng=s.domain(d,function(d){return d.lng;}).ticks(m);}else{lat=pv.range(-80,81,10);lng=pv.range(-180,181,10);}
return lng.map(function(lng){return lat.map(function(lat){return{lat:lat,lng:lng};});});},lat:function(m){return pv.transpose(scale.ticks.lng(m));}};scale.invert=function(p){return invert({x:x.invert(p.x),y:y.invert(p.y)});};scale.domain=function(array,f){if(arguments.length){d=(array instanceof Array)?((arguments.length>1)?pv.map(array,f):array):Array.prototype.slice.call(arguments);if(d.length>1){var lngs=d.map(function(c){return c.lng;});var lats=d.map(function(c){return c.lat;});c={lng:(pv.max(lngs)+pv.min(lngs))/2,lat:(pv.max(lats)+pv.min(lats))/2};var n=d.map(project);x.domain(n,function(p){return p.x;});y.domain(n,function(p){return p.y;});}else{c={lng:0,lat:0};x.domain(-1,1);y.domain(-1,1);}
lastLatLng=null;return this;}
return d;};scale.range=function(min,max){if(arguments.length){if(typeof min=="object"){rmin={x:Number(min.x),y:Number(min.y)};rmax={x:Number(max.x),y:Number(max.y)};}else{rmin={x:0,y:0};rmax={x:Number(min),y:Number(max)};}
x.range(rmin.x,rmax.x);y.range(rmax.y,rmin.y);lastLatLng=null;return this;}
return[rmin,rmax];};scale.projection=function(p){if(arguments.length){j=typeof p=="string"?pv.Geo.projections[p]||pv.Geo.projections.identity:p;return this.domain(d);}
return p;};pv.copyOwn(scale,pv.Scale.common);if(arguments.length)scale.projection(p);return scale;};pv.have_SVG=!!(document.createElementNS&&document.createElementNS('http://www.w3.org/2000/svg','svg').createSVGRect);pv.have_VML=(function(d,a,b){a=d.createElement('div');a.innerHTML='<pvml:shape adj="1" />';b=a.firstChild;b.style.behavior='url(#default#VML)';return b?typeof b.adj==='object':true;})(document);if(!pv.have_SVG&&pv.have_VML){(function(){if(typeof Date.now!=='function'){Date.now=function(){return new Date()*1;};}
var vml={is64Bit:window.navigator.cpuClass==='x64',round:function(n){return Math.round((n||0)*21.6);},styles:null,pre:'<pvml:',post:' class="msvml">',block:{'group':1,'shape':1,'shapetype':1,'line':1,'polyline':1,'curve':1,'rect':1,'roundrect':1,'oval':1,'arc':1,'image':1},caps:{'butt':'flat','round':'round','square':'square'},joins:{'bevel':'bevel','round':'round','miter':'miter'},cursorstyles:{'hand':'pointer','crosshair':1,'pointer':1,'move':1,'text':1,'wait':1,'help':1,'progress':1,'n-resize':1,'ne-resize':1,'nw-resize':1,'s-resize':1,'se-resize':1,'sw-resize':1,'e-resize':1,'w-resize':1},text_shim:null,text_dims:function(text,font){var shim=vml.text_shim||(vml.init(),vml.text_shim);shim.style.font=vml.processFont(font);shim.innerText=text;return{height:shim.offsetHeight,width:shim.offsetWidth};},_fontCache:{},_fontSubst:{'default':'Arial','sans-serif':'Arial','sansserif':'Arial','sans':'Arial','serif':'Times New Roman','dialog':'Arial','monospaced':'Courier New','dialoginput':'Courier New'},_fontWhiteListIE64Bit:{'agency fb':1,'aharoni':1,'algerian':1,'andalus':1,'angsana new':1,'angsanaupc':1,'aparajita':1,'arabic typesetting':1,'arial':1,'arial black':1,'arial narrow':1,'arial rounded mt bold':1,'arial unicode ms':1,'baskerville old face':1,'batang':1,'batangche':1,'bauhaus 93':1,'bell mt':1,'berlin sans fb':1,'berlin sans fb demi':1,'bernard mt condensed':1,'blackadder itc':1,'bodoni mt':1,'bodoni mt black':1,'bodoni mt condensed':1,'bodoni mt poster compressed':1,'book antiqua':1,'bookman old style':1,'bookshelf symbol 7':1,'bradley hand itc':1,'britannic bold':1,'broadway':1,'browallia new':1,'browalliaupc':1,'brush script mt':1,'calibri':1,'californian fb':1,'calisto mt':1,'cambria':1,'cambria math':1,'candara':1,'castellar':1,'centaur':1,'century':1,'century gothic':1,'century schoolbook':1,'chiller':1,'colonna mt':1,'comic sans ms':1,'consolas':1,'constantia':1,'cooper black':1,'copperplate gothic bold':1,'copperplate gothic light':1,'corbel':1,'cordia new':1,'cordiaupc':1,'courier new':1,'curlz mt':1,'daunpenh':1,'david':1,'dfkai-sb':1,'dilleniaupc':1,'dokchampa':1,'dotum':1,'dotumche':1,'ebrima':1,'edwardian script itc':1,'elephant':1,'engravers mt':1,'eras bold itc':1,'eras demi itc':1,'eras light itc':1,'eras medium itc':1,'estrangelo edessa':1,'eucrosiaupc':1,'euphemia':1,'fangsong':1,'felix titling':1,'footlight mt light':1,'forte':1,'franklin gothic book':1,'franklin gothic demi':1,'franklin gothic demi cond':1,'franklin gothic heavy':1,'franklin gothic medium':1,'franklin gothic medium cond':1,'frankruehl':1,'freesiaupc':1,'freestyle script':1,'french script mt':1,'gabriola':1,'garamond':1,'gautami':1,'georgia':1,'gigi':1,'gill sans mt':1,'gill sans mt condensed':1,'gill sans mt ext condensed bold':1,'gill sans ultra bold':1,'gill sans ultra bold condensed':1,'gisha':1,'gloucester mt extra condensed':1,'goudy old style':1,'goudy stout':1,'gulim':1,'gulimche':1,'gungsuh':1,'gungsuhche':1,'guttman adii':1,'guttman adii-light':1,'guttman aharoni':1,'guttman calligraphic':1,'guttman david':1,'guttman drogolin':1,'guttman frank':1,'guttman frnew':1,'guttman haim':1,'guttman haim-condensed':1,'guttman hatzvi':1,'guttman hodes':1,'guttman kav':1,'guttman kav-light':1,'guttman keren':1,'guttman logo1':1,'guttman mantova':1,'guttman mantova-decor':1,'guttman miryam':1,'guttman myamfix':1,'guttman rashi':1,'guttman stam':1,'guttman stam1':1,'guttman vilna':1,'guttman yad':1,'guttman yad-brush':1,'guttman yad-light':1,'guttman-aharoni':1,'guttman-aram':1,'guttman-courmir':1,'guttman-soncino':1,'guttman-toledo':1,'haettenschweiler':1,'harlow solid italic':1,'harrington':1,'high tower text':1,'impact':1,'imprint mt shadow':1,'informal roman':1,'irisupc':1,'iskoola pota':1,'jasmineupc':1,'jokerman':1,'juice itc':1,'kaiti':1,'kalinga':1,'kartika':1,'khmer ui':1,'kodchiangupc':1,'kokila':1,'kristen itc':1,'kunstler script':1,'lao ui':1,'latha':1,'leelawadee':1,'levenim mt':1,'lilyupc':1,'lucida bright':1,'lucida calligraphy':1,'lucida console':1,'lucida fax':1,'lucida handwriting':1,'lucida sans':1,'lucida sans typewriter':1,'lucida sans unicode':1,'magneto':1,'maiandra gd':1,'malgun gothic':1,'mangal':1,'marlett':1,'matura mt script capitals':1,'meiryo':1,'meiryo ui':1,'microsoft himalaya':1,'microsoft jhenghei':1,'microsoft new tai lue':1,'microsoft phagspa':1,'microsoft sans serif':1,'microsoft tai le':1,'microsoft uighur':1,'microsoft yahei':1,'microsoft yi baiti':1,'mingliu':1,'mingliu-extb':1,'mingliu_hkscs':1,'mingliu_hkscs-extb':1,'miriam':1,'miriam fixed':1,'mistral':1,'modern no. 20':1,'mongolian baiti':1,'monotype corsiva':1,'monotype hadassah':1,'moolboran':1,'ms gothic':1,'ms mincho':1,'ms outlook':1,'ms pgothic':1,'ms pmincho':1,'ms reference sans serif':1,'ms reference specialty':1,'ms ui gothic':1,'mt extra':1,'mv boli':1,'narkisim':1,'niagara engraved':1,'niagara solid':1,'nsimsun':1,'nyala':1,'ocr a extended':1,'old english text mt':1,'onyx':1,'palace script mt':1,'palatino linotype':1,'papyrus':1,'parchment':1,'perpetua':1,'perpetua titling mt':1,'plantagenet cherokee':1,'playbill':1,'pmingliu':1,'pmingliu-extb':1,'poor richard':1,'pristina':1,'raavi':1,'rage italic':1,'ravie':1,'rockwell':1,'rockwell condensed':1,'rockwell extra bold':1,'rod':1,'sakkal majalla':1,'script mt bold':1,'segoe print':1,'segoe script':1,'segoe ui':1,'segoe ui light':1,'segoe ui semibold':1,'segoe ui symbol':1,'shonar bangla':1,'showcard gothic':1,'shruti':1,'simhei':1,'simplified arabic':1,'simplified arabic fixed':1,'simsun':1,'simsun-extb':1,'snap itc':1,'stencil':1,'sylfaen':1,'symbol':1,'tahoma':1,'tempus sans itc':1,'times new roman':1,'toptype soncino':1,'traditional arabic':1,'trebuchet ms':1,'tunga':1,'tw cen mt':1,'tw cen mt condensed':1,'tw cen mt condensed extra bold':1,'utsaah':1,'vani':1,'verdana':1,'vijaya':1,'viner hand itc':1,'vivaldi':1,'vladimir script':1,'vrinda':1,'webdings':1,'wide latin':1,'wingdings':1,'wingdings 2':1,'wingdings 3':1},_defaultFontIE64Bit:'Arial',processFont:function(font){var processedFont=vml._fontCache[font];if(!processedFont){var shim=vml.text_shim||(vml.init(),vml.text_shim);var style=shim.style;style.font=font;var fontFamily=style.fontFamily;if(fontFamily.charAt(0)==='"'){fontFamily=fontFamily.substr(1,fontFamily.length-1);}
var ffKey=fontFamily.toLowerCase();var substFF=vml._fontSubst[ffKey];if(substFF){fontFamily=substFF;}else if(vml.is64Bit&&!vml._fontWhiteListIE64Bit[ffKey]){fontFamily=vml._defaultFontIE64Bit;}
style.fontFamily='"'+fontFamily+'"';vml._fontCache[font]=processedFont=style.font;}
return processedFont;},d2r:Math.PI*2/360,get_dim:function(attr,target){var o=target||{};o.translate_x=0;o.translate_y=0;if(attr.transform){var t=/translate\((-?\d+(?:\.\d+)?(?:e-?\d+)?)(?:,(-?\d+(?:\.\d+)?(?:e-?\d+)?))?\)/.exec(attr.transform);if(t&&t[1]){o.translate_x=parseFloat(t[1]);}
if(t&&t[2]){o.translate_y=parseFloat(t[2]);}
var r=/rotate\((-?\d+\.\d+|-?\d+)\)/.exec(attr.transform);if(r){var r=parseFloat(r[1])%360;if(r<0){r+=360;}
r*=vml.d2r;}
o.rotation=r||0;}
o.x=parseFloat(attr.x||0);o.y=parseFloat(attr.y||0);if('width'in attr){o.width=parseFloat(attr.width);}
if('height'in attr){o.height=parseFloat(attr.height);}
return o;},solidFillStyle:{type:'solid'},elm_defaults:{"g":{rewrite:'span',attr:function(attr,style,elm,scenes,i){var d=vml.get_dim(attr);elm.style.cssText="position:absolute;zoom:1;"+"left:"+(d.translate_x+d.x)+"px;"+"top:"+(d.translate_y+d.y)+"px;";}},"line":{rewrite:'shape',attr:function(attr,style,elm,scenes,i){var x1=parseFloat(attr.x1||0),y1=parseFloat(attr.y1||0),x2=parseFloat(attr.x2||0),y2=parseFloat(attr.y2||0),r=vml.round;elm.coordorigin="0,0";elm.coordsize="21600,21600";vml.path(elm).v='M '+r(x1)+' '+r(y1)+' L '+r(x2)+' '+r(y2)+' E';vml.stroke(elm,attr,scenes,i);},css:"top:0px;left:0px;width:1000px;height:1000px"},"rect":{rewrite:'shape',attr:function(attr,style,elm,scenes,i){var d=vml.get_dim(attr),p=vml.path(elm),r=vml.round;elm.coordorigin="0,0";elm.coordsize="21600,21600";var x=r(d.translate_x+d.x),y=r(d.translate_y+d.y),w=r(d.width),h=r(d.height);p.v='M '+x+' '+y+' L '+(x+w)+' '+y+' L '+(x+w)+' '+(y+h)+' L '+x+' '+(y+h)+' x';vml.stroke(elm,attr,scenes,i);vml.fill(elm,attr,scenes,i);},css:"top:0px;left:0px;width:1000px;height:1000px"},"path":{rewrite:'shape',attr:function(attr,style,elm,scenes,i){var d=vml.get_dim(attr),es=elm.style;es.visibility="hidden";es.left=(d.translate_x+d.x)+"px";es.top=(d.translate_y+d.y)+"px";elm.coordorigin="0,0";elm.coordsize="21600,21600";elm._events=attr["pointer-events"]||'none';vml.path(elm,attr.d);var skew=vml.rotate(elm,d.rotation);if(skew){skew.origin="-0.5,-0.5";}
vml.fill(elm,attr,scenes,i);vml.stroke(elm,attr,scenes,i);es.visibility="visible";},css:"top:0px;left:0px;width:1000px;height:1000px;"},"circle":{rewrite:'oval',attr:function(attr,style,elm,scenes,i){var d=vml.get_dim(attr),r=parseFloat(attr.r||0)+0.5,cx=parseFloat(attr.cx||0)+0.7,cy=parseFloat(attr.cy||0)+0.7,es=elm.style;es.left=(d.translate_x+cx-r)+"px";es.top=(d.translate_y+cy-r)+"px";es.width=(r*2)+"px";es.height=(r*2)+"px";vml.fill(elm,attr,scenes,i);vml.stroke(elm,attr,scenes,i);}},"text":{rewrite:'shape',attr:function(attr,style,elm,scenes,i){var es=elm.style;elm.stroked="False";elm.path="m0,0 l1,0 e";var tp=vml.textpath(elm);tp.string=attr.string;var tpStyle=tp.style;tpStyle['v-text-align']=attr.textAlign;tpStyle.font=attr.font;if(attr.textDecoration){tpStyle.textDecoration=attr.textDecoration;}
vml.path(elm).textpathok='True';vml.rotate(elm,attr.rotation&&-attr.rotation);var s=scenes[i];s.fillStyle=vml.solidFillStyle;vml.fill(elm,attr,scenes,i);s.fillStyle=null;},css:"position:absolute;top:0px;left:0px;width:1px;height:1px;"},"svg":{rewrite:'span',css:'position:relative;overflow:hidden;display:inline-block;'},"vml:path":{rewrite:'path'},"vml:stroke":{rewrite:'stroke'},"vml:fill":{rewrite:'fill'},"vml:textpath":{rewrite:'textpath'},"vml:skew":{rewrite:'skew'}},_elmcache:{'span':document.createElement('span'),'div':document.createElement('div')},createElement:function(type){var elm,cache=vml._elmcache,helper=vml.elm_defaults[type]||{};var tagName=helper.rewrite||type;if(tagName in cache){elm=cache[tagName].cloneNode(false);}else{cache[tagName]=document.createElement(vml.pre+tagName+vml.post);if(tagName in vml.block){cache[tagName].className+=' msvml_block';}
elm=cache[tagName].cloneNode(false);}
helper.css&&(elm.style.cssText=helper.css);return elm;},_hex:pv.range(0,256).map(function(i){return pv.Format.pad("0",2,i.toString(16));}),_colorcache:{},color:function(value){var result=vml._colorcache[value];var rgb;if(!result&&(rgb=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(value))){vml._colorcache[value]=result='#'+vml._hex[rgb[1]]+vml._hex[rgb[2]]+vml._hex[rgb[3]];}
return result||value;},fill:function(elm,attr,scenes,i){var fill=elm.getElementsByTagName('fill')[0]||(fill=elm.appendChild(vml.createElement('vml:fill')));var fillStyle=scenes[i].fillStyle;if(!attr.fill||!fillStyle||(fillStyle.type==='solid'&&attr.fill==='none')){fill.on='false';}else{fill.on='true';if(fillStyle.type==='solid'){fill.type='solid';fill.color=vml.color(attr.fill);}else{var isLinear=fillStyle.type==='lineargradient';fill.method='none';var stops=fillStyle.stops;var S=stops.length;if(S>0){var stopsText=[];for(var i=0;i<S;i++){var stop=stops[i];stopsText.push(stop.offset+'% '+vml.color(stop.color.color));}
if(fill.colors&&typeof fill.colors==='object'){fill.colors.value=stopsText.join(',');}else{fill.colors=stopsText.join(',');}}
if(isLinear){fill.type='gradient';var angle=(-pv.degrees(fillStyle.angle))%360;fill.angle=angle<0?(angle+360):angle;}else{fill.type='gradientTitle';fill.focus='100%';fill.focussize='0 0';fill.focusposition='0 0';fill.angle=0;}}
fill.opacity=Math.min(parseFloat(attr['fill-opacity']||'1'),1)||'1';}},stroke:function(elm,attr,scenes,i){var stroke=elm.getElementsByTagName('stroke')[0]||(stroke=elm.appendChild(vml.createElement('vml:stroke')));if(!attr.stroke||attr.stroke==='none'){stroke.on='false';stroke.weight=0;}else{var strokeWidth=attr['stroke-width'];if(strokeWidth==null||strokeWidth===''){strokeWidth=1;}else{strokeWidth=+strokeWidth;}
if(strokeWidth<1e-10){strokeWidth=0;}else if(strokeWidth<1){strokeWidth=1;}
if(!strokeWidth){stroke.on='false';stroke.weight=0;}else{stroke.on='true';stroke.weight=strokeWidth;stroke.color=vml.color(attr.stroke)||'black';stroke.opacity=Math.min(parseFloat(attr['stroke-opacity']||'1'),1)||'1';stroke.joinstyle=vml.joins[attr['stroke-linejoin']]||'miter';stroke.miterlimit=attr['stroke-miterlimit']||8;stroke.endcap=vml.caps[attr['stroke-linecap']]||'flat';var dashArray=attr["stroke-dasharray"];if(!dashArray||dashArray==='none'){dashArray='Solid';}
stroke.dashstyle=dashArray;}}},path:function(elm,svgpath){var p=elm.getElementsByTagName('path')[0]||(p=elm.appendChild(vml.createElement('vml:path')));if(arguments.length>1){p.v=vml.rewritePath(svgpath);}
return p;},skew:function(elm){var sk=elm.getElementsByTagName('skew')[0]||(sk=elm.appendChild(vml.createElement('vml:skew')));sk.on="false";return sk;},rotate:function(elm,r){if(r){r=180*r/Math.PI;r=(~~r%360)*vml.d2r;if(r){var ct=Math.cos(r).toFixed(8),st=Math.sin(r).toFixed(8);var skew=vml.skew(elm);skew.on='true';skew.matrix=ct+","+st+","+-st+","+ct+",0,0";return skew;}}},textpath:function(elm){var tp=elm.getElementsByTagName('textpath')[0]||(tp=elm.appendChild(vml.createElement('vml:textpath')));tp.style['v-text-align']='center';tp.style['v-text-kern']='true';tp.on="true";return tp;},init:function(){if(!vml.text_shim){vml.text_shim=document.getElementById('pv_vml_text_shim')||document.createElement('span');vml.text_shim.id='protovisvml_text_shim';vml.text_shim.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline-block;white-space:nowrap;";document.body.appendChild(vml.text_shim);}
if(!vml.styles){vml.styles=document.getElementById('protovisvml_styles')||document.createElement("style");vml.styles.id='protovisvml_styles';document.documentElement.firstChild.appendChild(vml.styles);vml.styles.styleSheet.addRule('.msvml','behavior:url(#default#VML);');vml.styles.styleSheet.addRule('.msvml_block','position:absolute;top:0;left:0;');try{if(!document.namespaces.pvml){document.namespaces.add('pvml','urn:schemas-microsoft-com:vml');}}catch(e){vml.pre='<';vml.post=' class="msvml" xmlns="urn:schemas-microsoft.com:vml">';}}},_pathcache:{},rewritePath:function(p){var x=0,y=0,round=vml.round;if(!p){return p;}
if(p in vml._pathcache){return vml._pathcache[p];}
p=p.replace(/(\d*)((\.*\d*)(e ?-?\d*))/g,"$1");var bits=p.match(/([MLHVCSQTAZ ][^MLHVCSQTAZ ]*)/gi);var np=[],lastcurve=[];var oldOp='';for(var i=0,bl=bits.length;i<bl;i++){var itm=bits[i],op=itm.charAt(0),args=itm.substring(1).split(/[,]/);if(op==' '){op=oldOp;}
oldOp=op;switch(op){case'M':op='m';x=round(args[0]);y=round(args[1]);args=[x,y];break;case'm':op='m';x+=round(args[0]);y+=round(args[1]);args=[x,y];break;case"A":op='l';args=[(x=round(args[5])),(y=round(args[6]))];break;case"L":op='l';args=[(x=round(args[0])),(y=round(args[1]))];break;case"l":op='l';args=[(x=x+round(args[0])),(y=y+round(args[1]))];break;case"H":op='l';args=[(x=round(args[0])),y];break;case"h":op='l';args=[(x=x+round(args[0])),y];break;case"V":op='l';args=[x,(y=round(args[0]))];break;case"v":op='l';args=[x,(y=y+round(args[0]))];break;case"C":op='c';lastcurve=args=[round(args[0]),round(args[1]),round(args[2]),round(args[3]),(x=round(args[4])),(y=round(args[5]))];break;case"c":op='c';lastcurve=args=[x+round(args[0]),y+round(args[1]),x+round(args[2]),y+round(args[3]),(x=x+round(args[4])),(y=y+round(args[5]))];break;case"S":op='c';lastcurve=args=[lastcurve[4]+(lastcurve[4]-lastcurve[2]),lastcurve[5]+(lastcurve[5]-lastcurve[3]),round(args[0]),round(args[1]),(x=round(args[2])),(y=round(args[3]))];break;case"s":op='c';lastcurve=args=[lastcurve[4]+(lastcurve[4]-lastcurve[2]),lastcurve[5]+(lastcurve[5]-lastcurve[3]),x+round(args[0]),y+round(args[1]),(x=x+round(args[2])),(y=y+round(args[3]))];break;case"Q":op='c';var x1=round(args[0]),y1=round(args[1]),x2=round(args[2]),y2=round(args[3]);args=[~~(x+(x1-x)*2/3),~~(y+(y1-y)*2/3),~~(x1+(x2-x1)/3),~~(y1+(y2-y1)/3),(x=x2),(y=y2)];break;case"q":op='l';x+=round(args[2]);y+=round(args[3]);args=[x,y];break;case"Z":case"z":op='xe';args=[];break;default:op='';args=[];}
np.push(op,args.join(','));}
return(vml._pathcache[p]=(np.join('')+'e'));}};pv.Text.measure=vml.text_dims;pv.Vml=vml;pv.VmlScene={scale:1,events:["mousewheel","mousedown","mouseup","mouseover","mouseout","mousemove","click","dblclick"],implicit:{css:{}},copy_functions:function(obj){for(var name in obj){if(typeof obj[name]==='function'&&!(name in pv.VmlScene)){pv.VmlScene[name]=obj[name];}}}};pv.VmlScene.copy_functions(pv.SvgScene);pv.Scene=pv.VmlScene;pv.renderer=function(){return'vml';};(function(is64bit){pv.VmlScene.minRuleLineWidth=is64bit?1.2:1.1;pv.VmlScene.minBarWidth=is64bit?2.2:1.8;pv.VmlScene.minBarHeight=is64bit?2.2:1.8;pv.VmlScene.minBarLineWidth=is64bit?1.2:1.0;}(vml.is64Bit));pv.VmlScene.expect=function(e,type,scenes,i,attr,style){style=style||{};var helper=vml.elm_defaults[type]||{},_type=helper.rewrite||type;if(e){if(e.tagName.toUpperCase()!==_type.toUpperCase()){var n=vml.createElement(type);e.parentNode.replaceChild(n,e);e=n;}}else{e=vml.createElement(type);}
if(attr){if('attr'in helper){helper.attr(attr,style,e,scenes,i);}
if(attr.cursor in vml.cursorstyles){var curs=vml.cursorstyles[attr.cursor];style.cursor=(curs===1)?attr.cursor:curs;}}
if(style){this.setStyle(e,style);}
return e;};pv.VmlScene.removeSiblings=function(e){while(e){var n=e.nextSibling;e.parentNode.removeChild(e);e=n;}};pv.VmlScene.addFillStyleDefinition=function(){};pv.VmlScene.setAttributes=function(){};pv.VmlScene.setStyle=function(e,style){var prevStyle=e.__style__;if(prevStyle===style){prevStyle=null;}
var eStyle=e.style;for(var name in style){var value=style[name];if(!prevStyle||(value!==prevStyle[name])){if(value==null){eStyle.removeAttribute(name);}else{eStyle[name]=value;}}}
e.__style__=style;};pv.VmlScene.append=function(e,scenes,index){e.$scene={scenes:scenes,index:index};e=this.title(e,scenes[index]);if(!e.parentNode||e.parentNode.nodeType===11){scenes.$g.appendChild(e);}
return e.nextSibling;};pv.VmlScene.title=function(e,s){e.title=s.title||"";return e;};pv.VmlScene.panel=function(scenes){var g=scenes.$g,e=g&&g.firstChild;var inited=false;for(var i=0,L=scenes.length;i<L;i++){var s=scenes[i];if(!s.visible)continue;if(!scenes.parent){var canvas=s.canvas;with(canvas.style){display="inline-block";zoom=1;}
if(g&&(g.parentNode!==canvas)){g=canvas.firstChild;e=g&&g.firstChild;}
if(!g){inited=true;vml.init();g=canvas.appendChild(vml.createElement("svg"));g.unselectable='on';g.onselectstart=function(){return false;};var events=this.events;var dispatch=this.dispatch;for(var j=0,E=events.length;j<E;j++){g.addEventListener?g.addEventListener(events[j],dispatch,false):g.attachEvent("on"+events[j],dispatch);}
e=g.firstChild;}
scenes.$g=g;var w=(s.width+s.left+s.right),h=(s.height+s.top+s.bottom);with(g.style){width=w+'px';height=h+'px';clip="rect(0px "+w+"px "+h+"px 0px)";}}
var c;if(s.overflow==="hidden"){c=this.expect(e,"g",scenes,i);c.style.position="absolute";c.style.clip="rect("+
s.top.toFixed(2)+"px "+
(s.left+s.width).toFixed(2)+"px "+
(s.top+s.height).toFixed(2)+"px "+
s.left.toFixed(2)+"px)";if(!c.parentNode){g.appendChild(c);}
scenes.$g=g=c;e=c.firstChild;}
e=this.fill(e,scenes,i);var k=this.scale,t=s.transform,x=s.left+t.x,y=s.top+t.y;this.scale*=t.k;if(s.children.length){var attrs={"transform":"translate("+x+","+y+")"+
(t.k!=1?" scale("+t.k+")":"")};this.eachChild(scenes,i,function(child){child.$g=e=this.expect(e,"g",scenes,i,attrs);this.updateAll(child);var parentNode=e.parentNode;if(!parentNode||parentNode.nodeType===11){g.appendChild(e);var helper=vml.elm_defaults[e.svgtype];if(helper&&typeof helper.onappend==='function'){helper.onappend(e,scenes[i]);}}
e=e.nextSibling;});}
this.scale=k;e=this.stroke(e,scenes,i);if(c){scenes.$g=g=c.parentNode;e=c.nextSibling;}}
if(inited){this.removeSiblings(e);e=g.appendChild(vml.createElement("oval"));}
return e;};pv.VmlScene.parseDasharray=function(s){var dashArray=s.strokeDasharray;if(dashArray&&dashArray!=='none'){var standardDashArray=this.translateDashStyleAlias(dashArray);if(this.isStandardDashStyle(standardDashArray)){dashArray=standardDashArray;}else{dashArray=dashArray.split(/[\s,]+/).map(function(num){return(+num)/this.scale;},this);if(dashArray.length%2){dashArray=dashArray.concat(dashArray);}
dashArray=dashArray.join(' ');}}else{dashArray=null;}
return dashArray;};pv.VmlScene.create=function(type){return vml.createElement(type);};(function(){var returnTrue=function(){return true;};var returnFalse=function(){return false;};var _event_props=["altKey","attrChange","attrName","bubbles","button","cancelable","charCode","clientX","clientY","ctrlKey","currentTarget","data","detail","eventPhase","fromElement","handler","keyCode","layerX","layerY","metaKey","newValue","offsetX","offsetY","pageX","pageY","prevValue","relatedNode","relatedTarget","screenX","screenY","shiftKey","srcElement","target","toElement","view","wheelDelta","which"];var _evPropCount=_event_props.length;function IEvent(src){if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=returnFalse;if(src.defaultPrevented||src.returnValue===false||src.getPreventDefault&&src.getPreventDefault()){this.isDefaultPrevented=returnTrue;}
this.timeStamp=src.timeStamp||Date.now();}else{this.type=src;this.timeStamp=Date.now();}}
IEvent.prototype={preventDefault:function(){this.isDefaultPrevented=returnTrue;var e=this.originalEvent;if(!e){return;}
if(e.preventDefault){e.preventDefault();}else{e.returnValue=false;}},stopPropagation:function(){this.isPropagationStopped=returnTrue;var e=this.originalEvent;if(!e){return;}
if(e.stopPropagation){e.stopPropagation();}
e.cancelBubble=true;},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation();},isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse};var SCROLL_NODE=(document.compatMode&&document.compatMode!="BackCompat")?'documentElement':'body';vml.fixEvent=function(ev){var originalEvent=ev;ev=new IEvent(originalEvent);var type=ev.type;var isKey=type==='keypress';for(var i=_evPropCount;i;){var prop=_event_props[--i];ev[prop]=originalEvent[prop];}
var target=ev.target;if(!target){target=ev.srcElement||document;if(target.nodeType===3){target=target.parentNode;}
ev.target=target;}
var fromElem;if(!ev.relatedTarget&&(fromElem=ev.fromElement)){ev.relatedTarget=(fromElem===target)?ev.toElement:fromElem;}
if(!isKey){var clientX;if(ev.pageX==null&&(clientX=ev.clientX)!=null){var scrollNode=document[SCROLL_NODE];ev.pageX=clientX+(scrollNode.scrollLeft||0)-(scrollNode.clientLeft||0);ev.pageY=ev.clientY+(scrollNode.scrollTop||0)-(scrollNode.clientTop||0);}}
if(ev.which==null){var charCode,keyCode,btn;if(!isKey){if((btn=ev.button)!==null){ev.which=(btn&1?1:(btn&2?3:(btn&4?2:0)));}}else{if((charCode=ev.charCode)!=null){ev.which=charCode;}else if((keyCode=ev.keyCode)!=null){ev.which=keyCode;}}}
ev.metaKey=!!ev.metaKey;if(type==="mousewheel"){ev.wheel=ev.wheelDelta;}
return ev;};})();pv.fixEvent=function(ev){return vml.fixEvent(ev||window.event);};pv.VmlScene.dispatch=pv.listener(function(e){var t=e.target.$scene;if(t){var events=e.target._events;if(events==='none'||pv.Mark.dispatch(e.type,t.scenes,t.index,e)){e.preventDefault();e.stopPropagation();}}});pv.VmlScene.image=function(scenes){var e=scenes.$g.firstChild;for(var i=0;i<scenes.length;i++){var s=scenes[i];if(!s.visible)continue;e=this.fill(e,scenes,i);if(s.image){}else{e=new Image();e.src=s.url;var st=e.style;st.position='absolute';st.top=s.top;st.left=s.left;st.width=s.width;st.height=s.height;st.cursor=s.cursor;st.msInterpolationMode='bicubic';}
e=this.append(e,scenes,i);e=this.stroke(e,scenes,i);}
return e;};pv.VmlScene.label=function(scenes){var e=scenes.$g.firstChild;for(var i=0;i<scenes.length;i++){var s=scenes[i];if(!s.visible)continue;var fill=s.textStyle;if(!fill.opacity||!s.text)continue;var txt=s.text.replace(/\s+/g,'\xA0');var font=vml.processFont(s.font);var label=vml.text_dims(txt,font);var dx=0;var dy=0;switch(s.textBaseline){case'middle':dy=(.1*label.height);break;case'top':dy=s.textMargin+.5*label.height;break;case'bottom':dy=-(s.textMargin+.5*label.height);break;}
switch(s.textAlign){case'left':dx=s.textMargin;break;case'right':dx=-s.textMargin;break;}
var a=s.textAngle;if(a){var ct=Math.cos(a);var st=Math.sin(a);var dx2=dx*ct-dy*st;var dy2=dx*st+dy*ct;dx=dx2;dy=dy2;}
var left=s.left+dx;var top=s.top+dy;var attr={};if(s.cursor){attr.cursor=s.cursor;}
attr.fill=vml.color(fill.color)||"black";if(vml.is64Bit){attr['fill-opacity']=0.7;}
attr.x=left;attr.y=top;attr.rotation=s.textAngle;attr.string=txt;attr.textAlign=s.textAlign;attr.font=font;attr.textDecoration=s.textDecoration;e=this.expect(e,"text",scenes,i,attr,{'display':'block','lineHeight':1,'whiteSpace':'nowrap','zoom':1,'position':'absolute','cursor':'default','top':top+'px','left':left+'px'});e=this.append(e,scenes,i);}
return e;};pv.VmlScene.wedge=function(scenes){var e=scenes.$g.firstChild,round=vml.round;for(var i=0;i<scenes.length;i++){var s=scenes[i];if(!s.visible)continue;var fill=s.fillStyle,stroke=s.strokeStyle;if(!fill.opacity&&!stroke.opacity)continue;e=this.expect(e,"path",scenes,i,{"pointer-events":s.events,"cursor":s.cursor,"transform":"translate("+s.left+","+s.top+")","d":'',"fill":fill.color,"fill-rule":"evenodd","fill-opacity":fill.opacity||null,"stroke":stroke.color,"stroke-opacity":stroke.opacity||null,"stroke-width":stroke.opacity?s.lineWidth/this.scale:null,"stroke-linecap":s.lineCap,"stroke-linejoin":s.lineJoin,"stroke-miterlimit":s.strokeMiterLimit,"stroke-dasharray":stroke.opacity?this.parseDasharray(s):null});var p=e.getElementsByTagName('path')[0];if(!p){p=vml.make('path');e.appendChild(p);}
var r1=round(s.innerRadius),r2=round(s.outerRadius),d;if(s.angle>=2*Math.PI){if(r1){d="AE0,0 "+r2+","+r2+" 0 23592960"
+"AL0,0 "+r1+","+r1+" 0 23592960";}else{d="AE0,0 "+r2+","+r2+" 0 23592960";}}else{var sa=Math.round(s.startAngle/Math.PI*11796480),a=Math.round(s.angle/Math.PI*11796480);if(r1){d="AE 0,0 "+r2+","+r2+" "+-sa+" "+-a
+" 0,0 "+r1+","+r1+" "+-(sa+a)+" "+a
+"X";}else{d="M0,0"
+"AE0,0 "+r2+","+r2+" "+-sa+" "+-a
+"X";}}
p.v=d;e=this.append(e,scenes,i);}
return e;};})();}
(function(){var _nextTipsyId=0;pv.Behavior.tipsy=function(opts){var _tipsyId=_nextTipsyId++;if(!opts){opts={};}else{opts=Object.create(opts);}
opts.trigger='manual';var _userGravity=opts.gravity||$.fn.tipsy.defaults.gravity;var _userGravityFun;if(typeof _userGravity==='function'){_userGravityFun=_userGravity;_userGravity=null;}
opts.gravity=calculateGravity;var $fakeTipTarget,$targetElem,nextOperationId=0,prevMouseX,prevMouseY,_renderId,_mark,delayOut=opts.delayOut,id,usesPoint=opts.usesPoint,$canvas,isEnabled=opts.isEnabled,sharedTipsyInfo;opts.delayOut=0;function getTooltipText(){var instance=_mark.instance();var title=(instance&&instance.tooltip)||(!_mark.properties.tooltip&&typeof _mark.tooltip=='function'&&_mark.tooltip())||instance.title||instance.text;if(typeof title==='function'){title=title();}
return title||"";}
function getInstanceBounds(){var instance=_mark.instance();var left,top,width,height;if(_mark.properties.width){var bounds=getVisibleScreenBounds(_mark);left=bounds.left;top=bounds.top;width=bounds.width;height=bounds.height;}else{var t=_mark.toScreenTransform();var radius;if(_mark.properties.outerRadius){var midAngle=instance.startAngle+instance.angle/2;radius=instance.outerRadius;left=t.x+instance.left+radius*Math.cos(midAngle);top=t.y+instance.top+radius*Math.sin(midAngle);}else if(_mark.properties.shapeRadius){radius=Math.max(2,instance.shapeRadius);var cx=instance.left;var cy=instance.top;switch(instance.shape){case'diamond':radius*=Math.SQRT2;break;case'circle':radius/=Math.SQRT2;break;}
left=(cx-radius)*t.k+t.x;top=(cy-radius)*t.k+t.y;height=width=2*radius*t.k;}else{left=instance.left*t.k+t.x;top=instance.top*t.k+t.y;}}
var left2=Math.ceil(left);var top2=Math.ceil(top);var leftE=left2-left;var topE=top2-top;width=Math.max(1,Math.floor((width||0)-leftE));height=Math.max(1,Math.floor((height||0)-topE));return{left:left2,top:top2,width:width,height:height};}
var _gravities=['nw','n','ne','e','se','s','sw','w'];function updateUserGravity(){if(_userGravityFun){_userGravity=_userGravityFun.call(_mark)||$.fn.tipsy.defaults.gravity;}
return _userGravity;}
function calculateGravity(tipSize,calcPosition){(this===$fakeTipTarget[0])||def.assert();var $win=$(window);var scrollOffset={width:$win.scrollLeft(),height:$win.scrollTop()};var pageSize={width:$win.width(),height:$win.height()};var gravity=_userGravity;if(gravity==='c'){gravity='w';}
var bestScore=scoreGravity(gravity);if(!bestScore.isTotal){var g=_gravities.indexOf(gravity);for(var n=1,L=_gravities.length;n<L;n++){var i=(g+n)%L;bestScore=chooseScores(bestScore,scoreGravity(_gravities[i]));}
if(_tip.debug>=21&&gravity!==bestScore.gravity){_tip.log("[TIPSY] #"+_tipsyId+" Choosing gravity '"+bestScore.gravity+"' over '"+gravity+"'");}
gravity=bestScore.gravity;}
if(_tip.debug>=21){_tip.log("[TIPSY] #"+_tipsyId+" Gravity '"+gravity+"'");}
return gravity;function scoreGravity(gravity){var tp=calcPosition(gravity);return scorePosition(gravity,tp);}
function scorePosition(gravity,tp){var wScore=calcPosScore(tp.left,'width');var hScore=calcPosScore(tp.top,'height');var isTotal=wScore.fits&&hScore.fits;return{gravity:gravity,width:wScore,height:hScore,value:wScore.value+hScore.value+(2-gravity.length),isTotal:isTotal,isPartial:!isTotal&&(wScore.fits||hScore.fits)};}
function calcPosScore(absPos,a_len){var maxLen=pageSize[a_len];var len=tipSize[a_len];var pos=absPos-scrollOffset[a_len];var opos=maxLen-(pos+len);var fits=pos>=0&&opos>=0;var value=(pos>=0?pos:(4*pos))+
(opos>=0?opos:(4*opos));return{fits:fits,value:value};}}
function chooseScores(score1,score2){if(score1.isTotal){if(!score2.isTotal){return score1;}}else if(score2.isTotal){if(!score1.isTotal){return score2;}}else if(score1.isPartial){if(!score2.isPartial){return score1;}}else if(score2.isPartial){if(!score1.isPartial){return score2;}}
return score2.value>score1.value?score2:score1;}
function setFakeTipTargetBounds(bounds){$fakeTipTarget.css({left:bounds.left+parseFloat($canvas.css("padding-left")),top:bounds.top+parseFloat($canvas.css("padding-top")),width:bounds.width,height:bounds.height});}
function createTipsy(mark){var c=mark.root.canvas();$canvas=$(c);c.style.position="relative";$canvas.mouseleave(hideTipsy);initTipsyCanvasSharedInfo();if(!id){id="tipsyPvBehavior_"+new Date().getTime();}
var fakeTipTarget=document.getElementById(id);if(!fakeTipTarget){fakeTipTarget=document.createElement("div");fakeTipTarget.id=id;c.appendChild(fakeTipTarget);}
var fakeStyle=fakeTipTarget.style;fakeStyle.padding='0px';fakeStyle.margin='0px';fakeStyle.position='absolute';fakeStyle.pointerEvents='none';fakeStyle.display='block';fakeStyle.zIndex=-10;$fakeTipTarget=$(fakeTipTarget);updateTipDebug();$fakeTipTarget.data('tipsy',null);$fakeTipTarget.tipsy(opts);}
function initTipsyCanvasSharedInfo(){sharedTipsyInfo=$canvas.data('tipsy-pv-shared-info');if(sharedTipsyInfo){var createId=($canvas[0].$pvCreateId||0);if(sharedTipsyInfo.createId===createId){sharedTipsyInfo.behaviors.push(hideTipsyOther);return;}
sharedTipsyInfo.behaviors.forEach(function(aHideTipsy){aHideTipsy();});}
sharedTipsyInfo={createId:($canvas[0].$pvCreateId||0),behaviors:[hideTipsyOther]};$canvas.data('tipsy-pv-shared-info',sharedTipsyInfo);}
function updateTipDebug(){if($fakeTipTarget){if(_tip.debug>=22){$fakeTipTarget.css({borderColor:'red',borderWidth:'1px',borderStyle:'solid',zIndex:1000});}else{$fakeTipTarget.css({borderWidth:'0px',zIndex:-10});}}}
function getMouseBounds(ev){if(!ev){ev=pv.event;}
var delta=5;var offset=$canvas.offset();return{left:ev.pageX-offset.left-delta,top:ev.pageY-offset.top-delta,width:10+2*delta,height:20};}
function setTarget(targetElem,mark){if((!$targetElem&&targetElem)||($targetElem&&$targetElem[0]!==targetElem)){if(_tip.debug>=20){_tip.log("[TIPSY] #"+_tipsyId+" Changing target element.");}
if($targetElem){$targetElem.unbind('mousemove',updateTipsy);if(!usesPoint){$targetElem.unbind('mouseleave',hideTipsy);}}
$targetElem=targetElem?$(targetElem):null;_mark=targetElem?mark:null;prevMouseX=prevMouseY=_renderId=null;if($targetElem){$targetElem.mousemove(updateTipsy);if(!usesPoint){$targetElem.mouseleave(hideTipsy);}}}}
function getNewOperationId(){return nextOperationId++;}
function checkCanOperate(opId){return opId===nextOperationId-1;}
function hideTipsy(){var opId=getNewOperationId();if(_tip.debug>=20){_tip.log("[TIPSY] #"+_tipsyId+" Delayed Hide Begin opId="+opId);}
if(delayOut>0){window.setTimeout(function(){if(checkCanOperate(opId)){if(_tip.debug>=20){_tip.log("[TIPSY] #"+_tipsyId+" Hiding opId="+opId+" nextOperationId="+nextOperationId);}
hideTipsyCore(opId);}else{if(_tip.debug>=20){_tip.log("[TIPSY] #"+_tipsyId+" Delayed Hide Cancelled opId="+opId);}}},delayOut);return;}
if(_tip.debug>=20){_tip.log("[TIPSY] #"+_tipsyId+" Hiding Immediately opId="+opId);}
hideTipsyCore(opId);}
function hideTipsyOther(){var opId=getNewOperationId();if(_tip.debug>=20){_tip.log("[TIPSY] #"+_tipsyId+" Hiding as Other opId="+opId);}
hideTipsyCore(opId);}
function hideTipsyCore(opId){setTarget(null,null);if($fakeTipTarget){$fakeTipTarget.tipsy("leave");}}
function hideOtherTipsies(){var hideTipsies=sharedTipsyInfo&&sharedTipsyInfo.behaviors;if(hideTipsies&&hideTipsies.length>1){hideTipsies.forEach(function(aHideTipsy){if(aHideTipsy!==hideTipsyOther){aHideTipsy();}});}}
function updateTipsy(ev){if(!$fakeTipTarget){return;}
if(prevMouseX!=null&&Math.abs(ev.clientX-prevMouseX)<3&&Math.abs(ev.clientY-prevMouseY)<3){return;}
var tag=this.$scene;var scenes;if(!tag||!(scenes=tag.scenes)||!scenes.mark||(scenes.mark!==_mark)){return;}
var renderId=_mark.renderId();var renderIdChanged=(renderId!==_renderId);var followMouse=opts.followMouse;if(!followMouse&&!renderIdChanged){return;}
var opId=getNewOperationId();if(_tip.debug>=20){_tip.log("[TIPSY] #"+_tipsyId+" Updating opId="+opId);}
prevMouseX=ev.clientX;prevMouseY=ev.clientY;var bounds;if(followMouse){bounds=getMouseBounds(ev);}
if(renderIdChanged){_renderId=renderId;_mark.context(scenes,tag.index,function(){if(!followMouse){bounds=getInstanceBounds();}
var text=getTooltipText();if(_tip.debug>=20){_tip.log("[TIPSY] #"+_tipsyId+" Update text. Was hidden. Text: "+text);}
$fakeTipTarget.tipsy('setTitle',text);updateUserGravity();});}
setFakeTipTargetBounds(bounds);hideOtherTipsies();$fakeTipTarget.tipsy("update");}
function initBehavior(mark){if(_tip.debug>=20){_tip.log("[TIPSY] #"+_tipsyId+" Creating");}
createTipsy(mark);if(usesPoint){mark.event('unpoint',hideTipsy);}}
function showTipsy(mark){var opId=getNewOperationId();if(_tip.debug>=20){_tip.log("[TIPSY] #"+_tipsyId+" Show IN opId="+opId);}
if(!$canvas){initBehavior(mark);}
var isHidden=!$targetElem;setTarget(pv.event.target,mark);var text=getTooltipText();if(_tip.debug>=20){_tip.log("[TIPSY] #"+_tipsyId+" Text: "+text);}
$fakeTipTarget.tipsy('setTitle',text);setFakeTipTargetBounds(opts.followMouse?getMouseBounds():getInstanceBounds());updateUserGravity();hideOtherTipsies();if(isHidden){$fakeTipTarget.tipsy('enter');}else{$fakeTipTarget.tipsy('update');}
if(_tip.debug>=20){_tip.log("[TIPSY] #"+_tipsyId+" Show OUT");}}
function tipsyBehavior(){var mark=this;if(!isEnabled||isEnabled(tipsyBehavior,mark)){showTipsy(mark);}}
return tipsyBehavior;};var _tip=pv.Behavior.tipsy;_tip.debug=0;_tip.setDebug=function(level){_tip.debug=level;};_tip.log=function(m){if(typeof console!=="undefined"){console.log(''+m);}};function toParentTransform(parentPanel){return pv.Transform.identity.translate(parentPanel.left(),parentPanel.top()).times(parentPanel.transform());}
function getVisibleScreenBounds(mark){var instance=mark.instance(),left=instance.left,top=instance.top,width=instance.width,height=instance.height,right,bottom,parent;while((parent=mark.parent)){if(left<0){width+=left;left=0;}
if(top<0){height+=top;top=0;}
right=instance.right;if(right<0){width+=right;}
bottom=instance.bottom;if(bottom<0){height+=bottom;}
var t=toParentTransform(parent),s=t.k;left=t.x+(s*left);top=t.y+(s*top);width=s*width;height=s*height;mark=parent;instance=mark.instance();}
return{left:left,top:top,width:width,height:height};}}());(function($){$.prompt=function(message,options){options=$.extend({},$.prompt.defaults,options);$.prompt.currentPrefix=options.prefix;var ie6=($.browser.msie&&$.browser.version<7);var $body=$(document.body);var $window=$(window);options.classes=$.trim(options.classes);if(options.classes!='')
options.classes=' '+options.classes;var msgbox='<div class="'+options.prefix+'box'+options.classes+'" id="'+options.prefix+'box">';if(options.useiframe&&(($('object, applet').length>0)||ie6)){msgbox+='<iframe src="javascript:false;" style="display:block;position:absolute;z-index:-1;" class="'+options.prefix+'fade" id="'+options.prefix+'fade"></iframe>';}else{if(ie6){$('select').css('visibility','hidden');}
msgbox+='<div class="'+options.prefix+'fade" id="'+options.prefix+'fade"></div>';}
msgbox+='<div class="'+options.prefix+'" id="'+options.prefix+'"><div class="'+options.prefix+'container"><div class="';msgbox+=options.prefix+'close">X</div><div id="'+options.prefix+'states"></div>';msgbox+='</div></div></div>';var $jqib=$(msgbox).appendTo($body);var $jqi=$jqib.children('#'+options.prefix);var $jqif=$jqib.children('#'+options.prefix+'fade');if(message.constructor==String){message={state0:{html:message,buttons:options.buttons,focus:options.focus,submit:options.submit}};}
var states="";$.each(message,function(statename,stateobj){stateobj=$.extend({},$.prompt.defaults.state,stateobj);message[statename]=stateobj;states+='<div id="'+options.prefix+'_state_'+statename+'" class="'+options.prefix+'_state" style="display:none;"><div class="'+options.prefix+'message">'+stateobj.html+'</div><div class="'+options.prefix+'buttons">';$.each(stateobj.buttons,function(k,v){if(typeof v=='object')
states+='<button name="'+options.prefix+'_'+statename+'_button'+v.title.replace(/[^a-z0-9]+/gi,'')+'" id="'+options.prefix+'_'+statename+'_button'+v.title.replace(/[^a-z0-9]+/gi,'')+'" value="'+v.value+'">'+v.title+'</button>';else states+='<button name="'+options.prefix+'_'+statename+'_button'+k+'" id="'+options.prefix+'_'+statename+'_button'+k+'" value="'+v+'">'+k+'</button>';});states+='</div></div>';});$jqi.find('#'+options.prefix+'states').html(states).children('.'+options.prefix+'_state:first').css('display','block');$jqi.find('.'+options.prefix+'buttons:empty').css('display','none');$.each(message,function(statename,stateobj){var $state=$jqi.find('#'+options.prefix+'_state_'+statename);$state.children('.'+options.prefix+'buttons').children('button').click(function(){var msg=$state.children('.'+options.prefix+'message');var clicked=stateobj.buttons[$(this).text()];if(clicked==undefined){for(var i in stateobj.buttons)
if(stateobj.buttons[i].title==$(this).text())
clicked=stateobj.buttons[i].value;}
if(typeof clicked=='object')
clicked=clicked.value;var forminputs={};$.each($jqi.find('#'+options.prefix+'states :input').serializeArray(),function(i,obj){if(forminputs[obj.name]===undefined){forminputs[obj.name]=obj.value;}else if(typeof forminputs[obj.name]==Array||typeof forminputs[obj.name]=='object'){forminputs[obj.name].push(obj.value);}else{forminputs[obj.name]=[forminputs[obj.name],obj.value];}});var close=stateobj.submit(clicked,msg,forminputs);if(close===undefined||close){removePrompt(true,clicked,msg,forminputs);}});$state.find('.'+options.prefix+'buttons button:eq('+stateobj.focus+')').addClass(options.prefix+'defaultbutton');});var ie6scroll=function(){$jqib.css({top:$window.scrollTop()});};var fadeClicked=function(){if(options.persistent){var i=0;$jqib.addClass(options.prefix+'warning');var intervalid=setInterval(function(){$jqib.toggleClass(options.prefix+'warning');if(i++>1){clearInterval(intervalid);$jqib.removeClass(options.prefix+'warning');}},100);}
else{removePrompt();}};var keyPressEventHandler=function(e){var key=(window.event)?event.keyCode:e.keyCode;if(key==27){fadeClicked();}
if(key==9){var $inputels=$(':input:enabled:visible',$jqib);var fwd=!e.shiftKey&&e.target==$inputels[$inputels.length-1];var back=e.shiftKey&&e.target==$inputels[0];if(fwd||back){setTimeout(function(){if(!$inputels)
return;var el=$inputels[back===true?$inputels.length-1:0];if(el)
el.focus();},10);return false;}}};var positionPrompt=function(){$jqib.css({position:(ie6)?"absolute":"fixed",height:$window.height(),width:"100%",top:(ie6)?$window.scrollTop():0,left:0,right:0,bottom:0});$jqif.css({position:"absolute",height:$window.height(),width:"100%",top:0,left:0,right:0,bottom:0});$jqi.css({position:"absolute",top:options.top,left:"50%",marginLeft:(($jqi.outerWidth()/2)*-1)});};var stylePrompt=function(){$jqif.css({zIndex:options.zIndex,display:"none",opacity:options.opacity});$jqi.css({zIndex:options.zIndex+1,display:"none"});$jqib.css({zIndex:options.zIndex});};var removePrompt=function(callCallback,clicked,msg,formvals){$jqi.remove();if(ie6){$body.unbind('scroll',ie6scroll);}
$window.unbind('resize',positionPrompt);$jqif.fadeOut(options.overlayspeed,function(){$jqif.unbind('click',fadeClicked);$jqif.remove();if(callCallback){options.callback(clicked,msg,formvals);}
$jqib.unbind('keypress',keyPressEventHandler);$jqib.remove();if(ie6&&!options.useiframe){$('select').css('visibility','visible');}});};positionPrompt();stylePrompt();if(ie6){$window.scroll(ie6scroll);}
$jqif.click(fadeClicked);$window.resize(positionPrompt);$jqib.bind("keydown keypress",keyPressEventHandler);$jqi.find('.'+options.prefix+'close').click(removePrompt);$jqif.fadeIn(options.overlayspeed);$jqi[options.show](options.promptspeed,options.loaded);$jqi.find('#'+options.prefix+'states .'+options.prefix+'_state:first .'+options.prefix+'defaultbutton').focus();if(options.timeout>0)
setTimeout($.prompt.close,options.timeout);return $jqib;};$.prompt.defaults={prefix:'jqi',classes:'',buttons:{Ok:true},loaded:function(){},submit:function(){return true;},callback:function(){},opacity:0.6,zIndex:999,overlayspeed:'slow',promptspeed:'fast',show:'fadeIn',focus:0,useiframe:false,top:"15%",persistent:true,timeout:0,state:{html:'',buttons:{Ok:true},focus:0,submit:function(){return true;}}};$.prompt.currentPrefix=$.prompt.defaults.prefix;$.prompt.setDefaults=function(o){$.prompt.defaults=$.extend({},$.prompt.defaults,o);};$.prompt.setStateDefaults=function(o){$.prompt.defaults.state=$.extend({},$.prompt.defaults.state,o);};$.prompt.getStateContent=function(state){return $('#'+$.prompt.currentPrefix+'_state_'+state);};$.prompt.getCurrentState=function(){return $('.'+$.prompt.currentPrefix+'_state:visible');};$.prompt.getCurrentStateName=function(){var stateid=$.prompt.getCurrentState().attr('id');return stateid.replace($.prompt.currentPrefix+'_state_','');};$.prompt.goToState=function(state,callback){$('.'+$.prompt.currentPrefix+'_state').slideUp('slow');$('#'+$.prompt.currentPrefix+'_state_'+state).slideDown('slow',function(){$(this).find('.'+$.prompt.currentPrefix+'defaultbutton').focus();if(typeof callback=='function')
callback();});};$.prompt.nextState=function(callback){var $next=$('.'+$.prompt.currentPrefix+'_state:visible').next();$('.'+$.prompt.currentPrefix+'_state').slideUp('slow');$next.slideDown('slow',function(){$next.find('.'+$.prompt.currentPrefix+'defaultbutton').focus();if(typeof callback=='function')
callback();});};$.prompt.prevState=function(callback){var $next=$('.'+$.prompt.currentPrefix+'_state:visible').prev();$('.'+$.prompt.currentPrefix+'_state').slideUp('slow');$next.slideDown('slow',function(){$next.find('.'+$.prompt.currentPrefix+'defaultbutton').focus();if(typeof callback=='function')
callback();});};$.prompt.close=function(){$('#'+$.prompt.currentPrefix+'box').fadeOut('fast',function(){$(this).remove();});};$.fn.prompt=function(options){if(options==undefined)
options={};if(options.withDataAndEvents==undefined)
options.withDataAndEvents=false;$.prompt($(this).clone(options.withDataAndEvents).html(),options);}})(jQuery);(function($,undefined){$.ui=$.ui||{};if($.ui.version){return;}
$.extend($.ui,{version:"1.8.14",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}});$.fn.extend({_focus:$.fn.focus,focus:function(delay,fn){return typeof delay==="number"?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus();if(fn){fn.call(elem);}},delay);}):this._focus.apply(this,arguments);},scrollParent:function(){var scrollParent;if(($.browser.msie&&(/(static|relative)/).test(this.css('position')))||(/absolute/).test(this.css('position'))){scrollParent=this.parents().filter(function(){return(/(relative|absolute|fixed)/).test($.curCSS(this,'position',1))&&(/(auto|scroll)/).test($.curCSS(this,'overflow',1)+$.curCSS(this,'overflow-y',1)+$.curCSS(this,'overflow-x',1));}).eq(0);}else{scrollParent=this.parents().filter(function(){return(/(auto|scroll)/).test($.curCSS(this,'overflow',1)+$.curCSS(this,'overflow-y',1)+$.curCSS(this,'overflow-x',1));}).eq(0);}
return(/fixed/).test(this.css('position'))||!scrollParent.length?$(document):scrollParent;},zIndex:function(zIndex){if(zIndex!==undefined){return this.css("zIndex",zIndex);}
if(this.length){var elem=$(this[0]),position,value;while(elem.length&&elem[0]!==document){position=elem.css("position");if(position==="absolute"||position==="relative"||position==="fixed"){value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&value!==0){return value;}}
elem=elem.parent();}}
return 0;},disableSelection:function(){return this.bind(($.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(event){event.preventDefault();});},enableSelection:function(){return this.unbind(".ui-disableSelection");}});$.each(["Width","Height"],function(i,name){var side=name==="Width"?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};function reduce(elem,size,border,margin){$.each(side,function(){size-=parseFloat($.curCSS(elem,"padding"+this,true))||0;if(border){size-=parseFloat($.curCSS(elem,"border"+this+"Width",true))||0;}
if(margin){size-=parseFloat($.curCSS(elem,"margin"+this,true))||0;}});return size;}
$.fn["inner"+name]=function(size){if(size===undefined){return orig["inner"+name].call(this);}
return this.each(function(){$(this).css(type,reduce(this,size)+"px");});};$.fn["outer"+name]=function(size,margin){if(typeof size!=="number"){return orig["outer"+name].call(this,size);}
return this.each(function(){$(this).css(type,reduce(this,size,true,margin)+"px");});};});function focusable(element,isTabIndexNotNaN){var nodeName=element.nodeName.toLowerCase();if("area"===nodeName){var map=element.parentNode,mapName=map.name,img;if(!element.href||!mapName||map.nodeName.toLowerCase()!=="map"){return false;}
img=$("img[usemap=#"+mapName+"]")[0];return!!img&&visible(img);}
return(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"==nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element);}
function visible(element){return!$(element).parents().andSelf().filter(function(){return $.curCSS(this,"visibility")==="hidden"||$.expr.filters.hidden(this);}).length;}
$.extend($.expr[":"],{data:function(elem,i,match){return!!$.data(elem,match[3]);},focusable:function(element){return focusable(element,!isNaN($.attr(element,"tabindex")));},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN);}});$(function(){var body=document.body,div=body.appendChild(div=document.createElement("div"));$.extend(div.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});$.support.minHeight=div.offsetHeight===100;$.support.selectstart="onselectstart"in div;body.removeChild(div).style.display="none";});$.extend($.ui,{plugin:{add:function(module,option,set){var proto=$.ui[module].prototype;for(var i in set){proto.plugins[i]=proto.plugins[i]||[];proto.plugins[i].push([option,set[i]]);}},call:function(instance,name,args){var set=instance.plugins[name];if(!set||!instance.element[0].parentNode){return;}
for(var i=0;i<set.length;i++){if(instance.options[set[i][0]]){set[i][1].apply(instance.element,args);}}}},contains:function(a,b){return document.compareDocumentPosition?a.compareDocumentPosition(b)&16:a!==b&&a.contains(b);},hasScroll:function(el,a){if($(el).css("overflow")==="hidden"){return false;}
var scroll=(a&&a==="left")?"scrollLeft":"scrollTop",has=false;if(el[scroll]>0){return true;}
el[scroll]=1;has=(el[scroll]>0);el[scroll]=0;return has;},isOverAxis:function(x,reference,size){return(x>reference)&&(x<(reference+size));},isOver:function(y,x,top,left,height,width){return $.ui.isOverAxis(y,top,height)&&$.ui.isOverAxis(x,left,width);}});})(jQuery);(function($,undefined){if($.cleanData){var _cleanData=$.cleanData;$.cleanData=function(elems){for(var i=0,elem;(elem=elems[i])!=null;i++){$(elem).triggerHandler("remove");}
_cleanData(elems);};}else{var _remove=$.fn.remove;$.fn.remove=function(selector,keepData){return this.each(function(){if(!keepData){if(!selector||$.filter(selector,[this]).length){$("*",this).add([this]).each(function(){$(this).triggerHandler("remove");});}}
return _remove.call($(this),selector,keepData);});};}
$.widget=function(name,base,prototype){var namespace=name.split(".")[0],fullName;name=name.split(".")[1];fullName=namespace+"-"+name;if(!prototype){prototype=base;base=$.Widget;}
$.expr[":"][fullName]=function(elem){return!!$.data(elem,name);};$[namespace]=$[namespace]||{};$[namespace][name]=function(options,element){if(arguments.length){this._createWidget(options,element);}};var basePrototype=new base();basePrototype.options=$.extend(true,{},basePrototype.options);$[namespace][name].prototype=$.extend(true,basePrototype,{namespace:namespace,widgetName:name,widgetEventPrefix:$[namespace][name].prototype.widgetEventPrefix||name,widgetBaseClass:fullName},prototype);$.widget.bridge(name,$[namespace][name]);};$.widget.bridge=function(name,object){$.fn[name]=function(options){var isMethodCall=typeof options==="string",args=Array.prototype.slice.call(arguments,1),returnValue=this;options=!isMethodCall&&args.length?$.extend.apply(null,[true,options].concat(args)):options;if(isMethodCall&&options.charAt(0)==="_"){return returnValue;}
if(isMethodCall){this.each(function(){var instance=$.data(this,name),methodValue=instance&&$.isFunction(instance[options])?instance[options].apply(instance,args):instance;if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue;return false;}});}else{this.each(function(){var instance=$.data(this,name);if(instance){instance.option(options||{})._init();}else{$.data(this,name,new object(options,this));}});}
return returnValue;};};$.Widget=function(options,element){if(arguments.length){this._createWidget(options,element);}};$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:false},_createWidget:function(options,element){$.data(element,this.widgetName,this);this.element=$(element);this.options=$.extend(true,{},this.options,this._getCreateOptions(),options);var self=this;this.element.bind("remove."+this.widgetName,function(){self.destroy();});this._create();this._trigger("create");this._init();},_getCreateOptions:function(){return $.metadata&&$.metadata.get(this.element[0])[this.widgetName];},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled");},widget:function(){return this.element;},option:function(key,value){var options=key;if(arguments.length===0){return $.extend({},this.options);}
if(typeof key==="string"){if(value===undefined){return this.options[key];}
options={};options[key]=value;}
this._setOptions(options);return this;},_setOptions:function(options){var self=this;$.each(options,function(key,value){self._setOption(key,value);});return this;},_setOption:function(key,value){this.options[key]=value;if(key==="disabled"){this.widget()
[value?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",value);}
return this;},enable:function(){return this._setOption("disabled",false);},disable:function(){return this._setOption("disabled",true);},_trigger:function(type,event,data){var callback=this.options[type];event=$.Event(event);event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();data=data||{};if(event.originalEvent){for(var i=$.event.props.length,prop;i;){prop=$.event.props[--i];event[prop]=event.originalEvent[prop];}}
this.element.trigger(event,data);return!($.isFunction(callback)&&callback.call(this.element[0],event,data)===false||event.isDefaultPrevented());}};})(jQuery);(function($,undefined){var mouseHandled=false;$(document).mousedown(function(e){mouseHandled=false;});$.widget("ui.mouse",{options:{cancel:':input,option',distance:1,delay:0},_mouseInit:function(){var self=this;this.element.bind('mousedown.'+this.widgetName,function(event){return self._mouseDown(event);}).bind('click.'+this.widgetName,function(event){if(true===$.data(event.target,self.widgetName+'.preventClickEvent')){$.removeData(event.target,self.widgetName+'.preventClickEvent');event.stopImmediatePropagation();return false;}});this.started=false;},_mouseDestroy:function(){this.element.unbind('.'+this.widgetName);},_mouseDown:function(event){if(mouseHandled){return};(this._mouseStarted&&this._mouseUp(event));this._mouseDownEvent=event;var self=this,btnIsLeft=(event.which==1),elIsCancel=(typeof this.options.cancel=="string"?$(event.target).closest(this.options.cancel).length:false);if(!btnIsLeft||elIsCancel||!this._mouseCapture(event)){return true;}
this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){self.mouseDelayMet=true;},this.options.delay);}
if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(event)!==false);if(!this._mouseStarted){event.preventDefault();return true;}}
if(true===$.data(event.target,this.widgetName+'.preventClickEvent')){$.removeData(event.target,this.widgetName+'.preventClickEvent');}
this._mouseMoveDelegate=function(event){return self._mouseMove(event);};this._mouseUpDelegate=function(event){return self._mouseUp(event);};$(document).bind('mousemove.'+this.widgetName,this._mouseMoveDelegate).bind('mouseup.'+this.widgetName,this._mouseUpDelegate);event.preventDefault();mouseHandled=true;return true;},_mouseMove:function(event){if($.browser.msie&&!(document.documentMode>=9)&&!event.button){return this._mouseUp(event);}
if(this._mouseStarted){this._mouseDrag(event);return event.preventDefault();}
if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(this._mouseDownEvent,event)!==false);(this._mouseStarted?this._mouseDrag(event):this._mouseUp(event));}
return!this._mouseStarted;},_mouseUp:function(event){$(document).unbind('mousemove.'+this.widgetName,this._mouseMoveDelegate).unbind('mouseup.'+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(event.target==this._mouseDownEvent.target){$.data(event.target,this.widgetName+'.preventClickEvent',true);}
this._mouseStop(event);}
return false;},_mouseDistanceMet:function(event){return(Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance);},_mouseDelayMet:function(event){return this.mouseDelayMet;},_mouseStart:function(event){},_mouseDrag:function(event){},_mouseStop:function(event){},_mouseCapture:function(event){return true;}});})(jQuery);(function($,undefined){$.ui=$.ui||{};var horizontalPositions=/left|center|right/,verticalPositions=/top|center|bottom/,center="center",_position=$.fn.position,_offset=$.fn.offset;$.fn.position=function(options){if(!options||!options.of){return _position.apply(this,arguments);}
options=$.extend({},options);var target=$(options.of),targetElem=target[0],collision=(options.collision||"flip").split(" "),offset=options.offset?options.offset.split(" "):[0,0],targetWidth,targetHeight,basePosition;if(targetElem.nodeType===9){targetWidth=target.width();targetHeight=target.height();basePosition={top:0,left:0};}else if(targetElem.setTimeout){targetWidth=target.width();targetHeight=target.height();basePosition={top:target.scrollTop(),left:target.scrollLeft()};}else if(targetElem.preventDefault){options.at="left top";targetWidth=targetHeight=0;basePosition={top:options.of.pageY,left:options.of.pageX};}else{targetWidth=target.outerWidth();targetHeight=target.outerHeight();basePosition=target.offset();}
$.each(["my","at"],function(){var pos=(options[this]||"").split(" ");if(pos.length===1){pos=horizontalPositions.test(pos[0])?pos.concat([center]):verticalPositions.test(pos[0])?[center].concat(pos):[center,center];}
pos[0]=horizontalPositions.test(pos[0])?pos[0]:center;pos[1]=verticalPositions.test(pos[1])?pos[1]:center;options[this]=pos;});if(collision.length===1){collision[1]=collision[0];}
offset[0]=parseInt(offset[0],10)||0;if(offset.length===1){offset[1]=offset[0];}
offset[1]=parseInt(offset[1],10)||0;if(options.at[0]==="right"){basePosition.left+=targetWidth;}else if(options.at[0]===center){basePosition.left+=targetWidth/2;}
if(options.at[1]==="bottom"){basePosition.top+=targetHeight;}else if(options.at[1]===center){basePosition.top+=targetHeight/2;}
basePosition.left+=offset[0];basePosition.top+=offset[1];return this.each(function(){var elem=$(this),elemWidth=elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseInt($.curCSS(this,"marginLeft",true))||0,marginTop=parseInt($.curCSS(this,"marginTop",true))||0,collisionWidth=elemWidth+marginLeft+
(parseInt($.curCSS(this,"marginRight",true))||0),collisionHeight=elemHeight+marginTop+
(parseInt($.curCSS(this,"marginBottom",true))||0),position=$.extend({},basePosition),collisionPosition;if(options.my[0]==="right"){position.left-=elemWidth;}else if(options.my[0]===center){position.left-=elemWidth/2;}
if(options.my[1]==="bottom"){position.top-=elemHeight;}else if(options.my[1]===center){position.top-=elemHeight/2;}
position.left=Math.round(position.left);position.top=Math.round(position.top);collisionPosition={left:position.left-marginLeft,top:position.top-marginTop};$.each(["left","top"],function(i,dir){if($.ui.position[collision[i]]){$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth,collisionHeight:collisionHeight,offset:offset,my:options.my,at:options.at});}});if($.fn.bgiframe){elem.bgiframe();}
elem.offset($.extend(position,{using:options.using}));});};$.ui.position={fit:{left:function(position,data){var win=$(window),over=data.collisionPosition.left+data.collisionWidth-win.width()-win.scrollLeft();position.left=over>0?position.left-over:Math.max(position.left-data.collisionPosition.left,position.left);},top:function(position,data){var win=$(window),over=data.collisionPosition.top+data.collisionHeight-win.height()-win.scrollTop();position.top=over>0?position.top-over:Math.max(position.top-data.collisionPosition.top,position.top);}},flip:{left:function(position,data){if(data.at[0]===center){return;}
var win=$(window),over=data.collisionPosition.left+data.collisionWidth-win.width()-win.scrollLeft(),myOffset=data.my[0]==="left"?-data.elemWidth:data.my[0]==="right"?data.elemWidth:0,atOffset=data.at[0]==="left"?data.targetWidth:-data.targetWidth,offset=-2*data.offset[0];position.left+=data.collisionPosition.left<0?myOffset+atOffset+offset:over>0?myOffset+atOffset+offset:0;},top:function(position,data){if(data.at[1]===center){return;}
var win=$(window),over=data.collisionPosition.top+data.collisionHeight-win.height()-win.scrollTop(),myOffset=data.my[1]==="top"?-data.elemHeight:data.my[1]==="bottom"?data.elemHeight:0,atOffset=data.at[1]==="top"?data.targetHeight:-data.targetHeight,offset=-2*data.offset[1];position.top+=data.collisionPosition.top<0?myOffset+atOffset+offset:over>0?myOffset+atOffset+offset:0;}}};if(!$.offset.setOffset){$.offset.setOffset=function(elem,options){if(/static/.test($.curCSS(elem,"position"))){elem.style.position="relative";}
var curElem=$(elem),curOffset=curElem.offset(),curTop=parseInt($.curCSS(elem,"top",true),10)||0,curLeft=parseInt($.curCSS(elem,"left",true),10)||0,props={top:(options.top-curOffset.top)+curTop,left:(options.left-curOffset.left)+curLeft};if('using'in options){options.using.call(elem,props);}else{curElem.css(props);}};$.fn.offset=function(options){var elem=this[0];if(!elem||!elem.ownerDocument){return null;}
if(options){return this.each(function(){$.offset.setOffset(this,options);});}
return _offset.call(this);};}}(jQuery));(function($,undefined){$.widget("ui.draggable",$.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false},_create:function(){if(this.options.helper=='original'&&!(/^(?:r|a|f)/).test(this.element.css("position")))
this.element[0].style.position='relative';(this.options.addClasses&&this.element.addClass("ui-draggable"));(this.options.disabled&&this.element.addClass("ui-draggable-disabled"));this._mouseInit();},destroy:function(){if(!this.element.data('draggable'))return;this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable"
+" ui-draggable-dragging"
+" ui-draggable-disabled");this._mouseDestroy();return this;},_mouseCapture:function(event){var o=this.options;if(this.helper||o.disabled||$(event.target).is('.ui-resizable-handle'))
return false;this.handle=this._getHandle(event);if(!this.handle)
return false;$(o.iframeFix===true?"iframe":o.iframeFix).each(function(){$('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1000}).css($(this).offset()).appendTo("body");});return true;},_mouseStart:function(event){var o=this.options;this.helper=this._createHelper(event);this._cacheHelperProportions();if($.ui.ddmanager)
$.ui.ddmanager.current=this;this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;(o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt));if(o.containment)
this._setContainment();if(this._trigger("start",event)===false){this._clear();return false;}
this._cacheHelperProportions();if($.ui.ddmanager&&!o.dropBehaviour)
$.ui.ddmanager.prepareOffsets(this,event);this.helper.addClass("ui-draggable-dragging");this._mouseDrag(event,true);if($.ui.ddmanager)$.ui.ddmanager.dragStart(this,event);return true;},_mouseDrag:function(event,noPropagation){this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");if(!noPropagation){var ui=this._uiHash();if(this._trigger('drag',event,ui)===false){this._mouseUp({});return false;}
this.position=ui.position;}
if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+'px';if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+'px';if($.ui.ddmanager)$.ui.ddmanager.drag(this,event);return false;},_mouseStop:function(event){var dropped=false;if($.ui.ddmanager&&!this.options.dropBehaviour)
dropped=$.ui.ddmanager.drop(this,event);if(this.dropped){dropped=this.dropped;this.dropped=false;}
if((!this.element[0]||!this.element[0].parentNode)&&this.options.helper=="original")
return false;if((this.options.revert=="invalid"&&!dropped)||(this.options.revert=="valid"&&dropped)||this.options.revert===true||($.isFunction(this.options.revert)&&this.options.revert.call(this.element,dropped))){var self=this;$(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){if(self._trigger("stop",event)!==false){self._clear();}});}else{if(this._trigger("stop",event)!==false){this._clear();}}
return false;},_mouseUp:function(event){if(this.options.iframeFix===true){$("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this);});}
if($.ui.ddmanager)$.ui.ddmanager.dragStop(this,event);return $.ui.mouse.prototype._mouseUp.call(this,event);},cancel:function(){if(this.helper.is(".ui-draggable-dragging")){this._mouseUp({});}else{this._clear();}
return this;},_getHandle:function(event){var handle=!this.options.handle||!$(this.options.handle,this.element).length?true:false;$(this.options.handle,this.element).find("*").andSelf().each(function(){if(this==event.target)handle=true;});return handle;},_createHelper:function(event){var o=this.options;var helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event])):(o.helper=='clone'?this.element.clone().removeAttr('id'):this.element);if(!helper.parents('body').length)
helper.appendTo((o.appendTo=='parent'?this.element[0].parentNode:o.appendTo));if(helper[0]!=this.element[0]&&!(/(fixed|absolute)/).test(helper.css("position")))
helper.css("position","absolute");return helper;},_adjustOffsetFromHelper:function(obj){if(typeof obj=='string'){obj=obj.split(' ');}
if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0};}
if('left'in obj){this.offset.click.left=obj.left+this.margins.left;}
if('right'in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left;}
if('top'in obj){this.offset.click.top=obj.top+this.margins.top;}
if('bottom'in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top;}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();if(this.cssPosition=='absolute'&&this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop();}
if((this.offsetParent[0]==document.body)||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=='html'&&$.browser.msie))
po={top:0,left:0};return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var p=this.element.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()};}else{return{top:0,left:0};}},_cacheMargins:function(){this.margins={left:(parseInt(this.element.css("marginLeft"),10)||0),top:(parseInt(this.element.css("marginTop"),10)||0),right:(parseInt(this.element.css("marginRight"),10)||0),bottom:(parseInt(this.element.css("marginBottom"),10)||0)};},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function(){var o=this.options;if(o.containment=='parent')o.containment=this.helper[0].parentNode;if(o.containment=='document'||o.containment=='window')this.containment=[o.containment=='document'?0:$(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,o.containment=='document'?0:$(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(o.containment=='document'?0:$(window).scrollLeft())+$(o.containment=='document'?document:window).width()-this.helperProportions.width-this.margins.left,(o.containment=='document'?0:$(window).scrollTop())+($(o.containment=='document'?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!(/^(document|window|parent)$/).test(o.containment)&&o.containment.constructor!=Array){var c=$(o.containment);var ce=c[0];if(!ce)return;var co=c.offset();var over=($(ce).css("overflow")!='hidden');this.containment=[(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0),(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0),(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom];this.relative_container=c;}else if(o.containment.constructor==Array){this.containment=o.containment;}},_convertPositionTo:function(d,pos){if(!pos)pos=this.position;var mod=d=="absolute"?1:-1;var o=this.options,scroll=this.cssPosition=='absolute'&&!(this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);return{top:(pos.top
+this.offset.relative.top*mod
+this.offset.parent.top*mod
-($.browser.safari&&$.browser.version<526&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop()))*mod)),left:(pos.left
+this.offset.relative.left*mod
+this.offset.parent.left*mod
-($.browser.safari&&$.browser.version<526&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod))};},_generatePosition:function(event){var o=this.options,scroll=this.cssPosition=='absolute'&&!(this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);var pageX=event.pageX;var pageY=event.pageY;if(this.originalPosition){var containment;if(this.containment){if(this.relative_container){var co=this.relative_container.offset();containment=[this.containment[0]+co.left,this.containment[1]+co.top,this.containment[2]+co.left,this.containment[3]+co.top];}
else{containment=this.containment;}
if(event.pageX-this.offset.click.left<containment[0])pageX=containment[0]+this.offset.click.left;if(event.pageY-this.offset.click.top<containment[1])pageY=containment[1]+this.offset.click.top;if(event.pageX-this.offset.click.left>containment[2])pageX=containment[2]+this.offset.click.left;if(event.pageY-this.offset.click.top>containment[3])pageY=containment[3]+this.offset.click.top;}
if(o.grid){var top=o.grid[1]?this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY;pageY=containment?(!(top-this.offset.click.top<containment[1]||top-this.offset.click.top>containment[3])?top:(!(top-this.offset.click.top<containment[1])?top-o.grid[1]:top+o.grid[1])):top;var left=o.grid[0]?this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX;pageX=containment?(!(left-this.offset.click.left<containment[0]||left-this.offset.click.left>containment[2])?left:(!(left-this.offset.click.left<containment[0])?left-o.grid[0]:left+o.grid[0])):left;}}
return{top:(pageY
-this.offset.click.top
-this.offset.relative.top
-this.offset.parent.top
+($.browser.safari&&$.browser.version<526&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop())))),left:(pageX
-this.offset.click.left
-this.offset.relative.left
-this.offset.parent.left
+($.browser.safari&&$.browser.version<526&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())))};},_clear:function(){this.helper.removeClass("ui-draggable-dragging");if(this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval)this.helper.remove();this.helper=null;this.cancelHelperRemoval=false;},_trigger:function(type,event,ui){ui=ui||this._uiHash();$.ui.plugin.call(this,type,[event,ui]);if(type=="drag")this.positionAbs=this._convertPositionTo("absolute");return $.Widget.prototype._trigger.call(this,type,event,ui);},plugins:{},_uiHash:function(event){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs};}});$.extend($.ui.draggable,{version:"1.8.14"});$.ui.plugin.add("draggable","connectToSortable",{start:function(event,ui){var inst=$(this).data("draggable"),o=inst.options,uiSortable=$.extend({},ui,{item:inst.element});inst.sortables=[];$(o.connectToSortable).each(function(){var sortable=$.data(this,'sortable');if(sortable&&!sortable.options.disabled){inst.sortables.push({instance:sortable,shouldRevert:sortable.options.revert});sortable.refreshPositions();sortable._trigger("activate",event,uiSortable);}});},stop:function(event,ui){var inst=$(this).data("draggable"),uiSortable=$.extend({},ui,{item:inst.element});$.each(inst.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;inst.cancelHelperRemoval=true;this.instance.cancelHelperRemoval=false;if(this.shouldRevert)this.instance.options.revert=true;this.instance._mouseStop(event);this.instance.options.helper=this.instance.options._helper;if(inst.options.helper=='original')
this.instance.currentItem.css({top:'auto',left:'auto'});}else{this.instance.cancelHelperRemoval=false;this.instance._trigger("deactivate",event,uiSortable);}});},drag:function(event,ui){var inst=$(this).data("draggable"),self=this;var checkPos=function(o){var dyClick=this.offset.click.top,dxClick=this.offset.click.left;var helperTop=this.positionAbs.top,helperLeft=this.positionAbs.left;var itemHeight=o.height,itemWidth=o.width;var itemTop=o.top,itemLeft=o.left;return $.ui.isOver(helperTop+dyClick,helperLeft+dxClick,itemTop,itemLeft,itemHeight,itemWidth);};$.each(inst.sortables,function(i){this.instance.positionAbs=inst.positionAbs;this.instance.helperProportions=inst.helperProportions;this.instance.offset.click=inst.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){if(!this.instance.isOver){this.instance.isOver=1;this.instance.currentItem=$(self).clone().removeAttr('id').appendTo(this.instance.element).data("sortable-item",true);this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return ui.helper[0];};event.target=this.instance.currentItem[0];this.instance._mouseCapture(event,true);this.instance._mouseStart(event,true,true);this.instance.offset.click.top=inst.offset.click.top;this.instance.offset.click.left=inst.offset.click.left;this.instance.offset.parent.left-=inst.offset.parent.left-this.instance.offset.parent.left;this.instance.offset.parent.top-=inst.offset.parent.top-this.instance.offset.parent.top;inst._trigger("toSortable",event);inst.dropped=this.instance.element;inst.currentItem=inst.element;this.instance.fromOutside=inst;}
if(this.instance.currentItem)this.instance._mouseDrag(event);}else{if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=true;this.instance.options.revert=false;this.instance._trigger('out',event,this.instance._uiHash(this.instance));this.instance._mouseStop(event,true);this.instance.options.helper=this.instance.options._helper;this.instance.currentItem.remove();if(this.instance.placeholder)this.instance.placeholder.remove();inst._trigger("fromSortable",event);inst.dropped=false;}};});}});$.ui.plugin.add("draggable","cursor",{start:function(event,ui){var t=$('body'),o=$(this).data('draggable').options;if(t.css("cursor"))o._cursor=t.css("cursor");t.css("cursor",o.cursor);},stop:function(event,ui){var o=$(this).data('draggable').options;if(o._cursor)$('body').css("cursor",o._cursor);}});$.ui.plugin.add("draggable","opacity",{start:function(event,ui){var t=$(ui.helper),o=$(this).data('draggable').options;if(t.css("opacity"))o._opacity=t.css("opacity");t.css('opacity',o.opacity);},stop:function(event,ui){var o=$(this).data('draggable').options;if(o._opacity)$(ui.helper).css('opacity',o._opacity);}});$.ui.plugin.add("draggable","scroll",{start:function(event,ui){var i=$(this).data("draggable");if(i.scrollParent[0]!=document&&i.scrollParent[0].tagName!='HTML')i.overflowOffset=i.scrollParent.offset();},drag:function(event,ui){var i=$(this).data("draggable"),o=i.options,scrolled=false;if(i.scrollParent[0]!=document&&i.scrollParent[0].tagName!='HTML'){if(!o.axis||o.axis!='x'){if((i.overflowOffset.top+i.scrollParent[0].offsetHeight)-event.pageY<o.scrollSensitivity)
i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop+o.scrollSpeed;else if(event.pageY-i.overflowOffset.top<o.scrollSensitivity)
i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop-o.scrollSpeed;}
if(!o.axis||o.axis!='y'){if((i.overflowOffset.left+i.scrollParent[0].offsetWidth)-event.pageX<o.scrollSensitivity)
i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft+o.scrollSpeed;else if(event.pageX-i.overflowOffset.left<o.scrollSensitivity)
i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft-o.scrollSpeed;}}else{if(!o.axis||o.axis!='x'){if(event.pageY-$(document).scrollTop()<o.scrollSensitivity)
scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed);else if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity)
scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed);}
if(!o.axis||o.axis!='y'){if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity)
scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed);else if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity)
scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed);}}
if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour)
$.ui.ddmanager.prepareOffsets(i,event);}});$.ui.plugin.add("draggable","snap",{start:function(event,ui){var i=$(this).data("draggable"),o=i.options;i.snapElements=[];$(o.snap.constructor!=String?(o.snap.items||':data(draggable)'):o.snap).each(function(){var $t=$(this);var $o=$t.offset();if(this!=i.element[0])i.snapElements.push({item:this,width:$t.outerWidth(),height:$t.outerHeight(),top:$o.top,left:$o.left});});},drag:function(event,ui){var inst=$(this).data("draggable"),o=inst.options;var d=o.snapTolerance;var x1=ui.offset.left,x2=x1+inst.helperProportions.width,y1=ui.offset.top,y2=y1+inst.helperProportions.height;for(var i=inst.snapElements.length-1;i>=0;i--){var l=inst.snapElements[i].left,r=l+inst.snapElements[i].width,t=inst.snapElements[i].top,b=t+inst.snapElements[i].height;if(!((l-d<x1&&x1<r+d&&t-d<y1&&y1<b+d)||(l-d<x1&&x1<r+d&&t-d<y2&&y2<b+d)||(l-d<x2&&x2<r+d&&t-d<y1&&y1<b+d)||(l-d<x2&&x2<r+d&&t-d<y2&&y2<b+d))){if(inst.snapElements[i].snapping)(inst.options.snap.release&&inst.options.snap.release.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})));inst.snapElements[i].snapping=false;continue;}
if(o.snapMode!='inner'){var ts=Math.abs(t-y2)<=d;var bs=Math.abs(b-y1)<=d;var ls=Math.abs(l-x2)<=d;var rs=Math.abs(r-x1)<=d;if(ts)ui.position.top=inst._convertPositionTo("relative",{top:t-inst.helperProportions.height,left:0}).top-inst.margins.top;if(bs)ui.position.top=inst._convertPositionTo("relative",{top:b,left:0}).top-inst.margins.top;if(ls)ui.position.left=inst._convertPositionTo("relative",{top:0,left:l-inst.helperProportions.width}).left-inst.margins.left;if(rs)ui.position.left=inst._convertPositionTo("relative",{top:0,left:r}).left-inst.margins.left;}
var first=(ts||bs||ls||rs);if(o.snapMode!='outer'){var ts=Math.abs(t-y1)<=d;var bs=Math.abs(b-y2)<=d;var ls=Math.abs(l-x1)<=d;var rs=Math.abs(r-x2)<=d;if(ts)ui.position.top=inst._convertPositionTo("relative",{top:t,left:0}).top-inst.margins.top;if(bs)ui.position.top=inst._convertPositionTo("relative",{top:b-inst.helperProportions.height,left:0}).top-inst.margins.top;if(ls)ui.position.left=inst._convertPositionTo("relative",{top:0,left:l}).left-inst.margins.left;if(rs)ui.position.left=inst._convertPositionTo("relative",{top:0,left:r-inst.helperProportions.width}).left-inst.margins.left;}
if(!inst.snapElements[i].snapping&&(ts||bs||ls||rs||first))
(inst.options.snap.snap&&inst.options.snap.snap.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})));inst.snapElements[i].snapping=(ts||bs||ls||rs||first);};}});$.ui.plugin.add("draggable","stack",{start:function(event,ui){var o=$(this).data("draggable").options;var group=$.makeArray($(o.stack)).sort(function(a,b){return(parseInt($(a).css("zIndex"),10)||0)-(parseInt($(b).css("zIndex"),10)||0);});if(!group.length){return;}
var min=parseInt(group[0].style.zIndex)||0;$(group).each(function(i){this.style.zIndex=min+i;});this[0].style.zIndex=min+group.length;}});$.ui.plugin.add("draggable","zIndex",{start:function(event,ui){var t=$(ui.helper),o=$(this).data("draggable").options;if(t.css("zIndex"))o._zIndex=t.css("zIndex");t.css('zIndex',o.zIndex);},stop:function(event,ui){var o=$(this).data("draggable").options;if(o._zIndex)$(ui.helper).css('zIndex',o._zIndex);}});})(jQuery);(function($,undefined){$.widget("ui.droppable",{widgetEventPrefix:"drop",options:{accept:'*',activeClass:false,addClasses:true,greedy:false,hoverClass:false,scope:'default',tolerance:'intersect'},_create:function(){var o=this.options,accept=o.accept;this.isover=0;this.isout=1;this.accept=$.isFunction(accept)?accept:function(d){return d.is(accept);};this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight};$.ui.ddmanager.droppables[o.scope]=$.ui.ddmanager.droppables[o.scope]||[];$.ui.ddmanager.droppables[o.scope].push(this);(o.addClasses&&this.element.addClass("ui-droppable"));},destroy:function(){var drop=$.ui.ddmanager.droppables[this.options.scope];for(var i=0;i<drop.length;i++)
if(drop[i]==this)
drop.splice(i,1);this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable");return this;},_setOption:function(key,value){if(key=='accept'){this.accept=$.isFunction(value)?value:function(d){return d.is(value);};}
$.Widget.prototype._setOption.apply(this,arguments);},_activate:function(event){var draggable=$.ui.ddmanager.current;if(this.options.activeClass)this.element.addClass(this.options.activeClass);(draggable&&this._trigger('activate',event,this.ui(draggable)));},_deactivate:function(event){var draggable=$.ui.ddmanager.current;if(this.options.activeClass)this.element.removeClass(this.options.activeClass);(draggable&&this._trigger('deactivate',event,this.ui(draggable)));},_over:function(event){var draggable=$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]==this.element[0])return;if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){if(this.options.hoverClass)this.element.addClass(this.options.hoverClass);this._trigger('over',event,this.ui(draggable));}},_out:function(event){var draggable=$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]==this.element[0])return;if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){if(this.options.hoverClass)this.element.removeClass(this.options.hoverClass);this._trigger('out',event,this.ui(draggable));}},_drop:function(event,custom){var draggable=custom||$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]==this.element[0])return false;var childrenIntersection=false;this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var inst=$.data(this,'droppable');if(inst.options.greedy&&!inst.options.disabled&&inst.options.scope==draggable.options.scope&&inst.accept.call(inst.element[0],(draggable.currentItem||draggable.element))&&$.ui.intersect(draggable,$.extend(inst,{offset:inst.element.offset()}),inst.options.tolerance)){childrenIntersection=true;return false;}});if(childrenIntersection)return false;if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){if(this.options.activeClass)this.element.removeClass(this.options.activeClass);if(this.options.hoverClass)this.element.removeClass(this.options.hoverClass);this._trigger('drop',event,this.ui(draggable));return this.element;}
return false;},ui:function(c){return{draggable:(c.currentItem||c.element),helper:c.helper,position:c.position,offset:c.positionAbs};}});$.extend($.ui.droppable,{version:"1.8.14"});$.ui.intersect=function(draggable,droppable,toleranceMode){if(!droppable.offset)return false;var x1=(draggable.positionAbs||draggable.position.absolute).left,x2=x1+draggable.helperProportions.width,y1=(draggable.positionAbs||draggable.position.absolute).top,y2=y1+draggable.helperProportions.height;var l=droppable.offset.left,r=l+droppable.proportions.width,t=droppable.offset.top,b=t+droppable.proportions.height;switch(toleranceMode){case'fit':return(l<=x1&&x2<=r&&t<=y1&&y2<=b);break;case'intersect':return(l<x1+(draggable.helperProportions.width/2)&&x2-(draggable.helperProportions.width/2)<r&&t<y1+(draggable.helperProportions.height/2)&&y2-(draggable.helperProportions.height/2)<b);break;case'pointer':var draggableLeft=((draggable.positionAbs||draggable.position.absolute).left+(draggable.clickOffset||draggable.offset.click).left),draggableTop=((draggable.positionAbs||draggable.position.absolute).top+(draggable.clickOffset||draggable.offset.click).top),isOver=$.ui.isOver(draggableTop,draggableLeft,t,l,droppable.proportions.height,droppable.proportions.width);return isOver;break;case'touch':return((y1>=t&&y1<=b)||(y2>=t&&y2<=b)||(y1<t&&y2>b))&&((x1>=l&&x1<=r)||(x2>=l&&x2<=r)||(x1<l&&x2>r));break;default:return false;break;}};$.ui.ddmanager={current:null,droppables:{'default':[]},prepareOffsets:function(t,event){var m=$.ui.ddmanager.droppables[t.options.scope]||[];var type=event?event.type:null;var list=(t.currentItem||t.element).find(":data(droppable)").andSelf();droppablesLoop:for(var i=0;i<m.length;i++){if(m[i].options.disabled||(t&&!m[i].accept.call(m[i].element[0],(t.currentItem||t.element))))continue;for(var j=0;j<list.length;j++){if(list[j]==m[i].element[0]){m[i].proportions.height=0;continue droppablesLoop;}};m[i].visible=m[i].element.css("display")!="none";if(!m[i].visible)continue;if(type=="mousedown")m[i]._activate.call(m[i],event);m[i].offset=m[i].element.offset();m[i].proportions={width:m[i].element[0].offsetWidth,height:m[i].element[0].offsetHeight};}},drop:function(draggable,event){var dropped=false;$.each($.ui.ddmanager.droppables[draggable.options.scope]||[],function(){if(!this.options)return;if(!this.options.disabled&&this.visible&&$.ui.intersect(draggable,this,this.options.tolerance))
dropped=dropped||this._drop.call(this,event);if(!this.options.disabled&&this.visible&&this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){this.isout=1;this.isover=0;this._deactivate.call(this,event);}});return dropped;},dragStart:function(draggable,event){draggable.element.parentsUntil("body").bind("scroll.droppable",function(){if(!draggable.options.refreshPositions)$.ui.ddmanager.prepareOffsets(draggable,event);});},drag:function(draggable,event){if(draggable.options.refreshPositions)$.ui.ddmanager.prepareOffsets(draggable,event);$.each($.ui.ddmanager.droppables[draggable.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible)return;var intersects=$.ui.intersect(draggable,this,this.options.tolerance);var c=!intersects&&this.isover==1?'isout':(intersects&&this.isover==0?'isover':null);if(!c)return;var parentInstance;if(this.options.greedy){var parent=this.element.parents(':data(droppable):eq(0)');if(parent.length){parentInstance=$.data(parent[0],'droppable');parentInstance.greedyChild=(c=='isover'?1:0);}}
if(parentInstance&&c=='isover'){parentInstance['isover']=0;parentInstance['isout']=1;parentInstance._out.call(parentInstance,event);}
this[c]=1;this[c=='isout'?'isover':'isout']=0;this[c=="isover"?"_over":"_out"].call(this,event);if(parentInstance&&c=='isout'){parentInstance['isout']=0;parentInstance['isover']=1;parentInstance._over.call(parentInstance,event);}});},dragStop:function(draggable,event){draggable.element.parentsUntil("body").unbind("scroll.droppable");if(!draggable.options.refreshPositions)$.ui.ddmanager.prepareOffsets(draggable,event);}};})(jQuery);(function($,undefined){$.widget("ui.resizable",$.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:false,animate:false,animateDuration:"slow",animateEasing:"swing",aspectRatio:false,autoHide:false,containment:false,ghost:false,grid:false,handles:"e,s,se",helper:false,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1000},_create:function(){var self=this,o=this.options;this.element.addClass("ui-resizable");$.extend(this,{_aspectRatio:!!(o.aspectRatio),aspectRatio:o.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:o.helper||o.ghost||o.animate?o.helper||'ui-resizable-helper':null});if(this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)){if(/relative/.test(this.element.css('position'))&&$.browser.opera)
this.element.css({position:'relative',top:'auto',left:'auto'});this.element.wrap($('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css('position'),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css('top'),left:this.element.css('left')}));this.element=this.element.parent().data("resizable",this.element.data('resizable'));this.elementIsWrapper=true;this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")});this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0});this.originalResizeStyle=this.originalElement.css('resize');this.originalElement.css('resize','none');this._proportionallyResizeElements.push(this.originalElement.css({position:'static',zoom:1,display:'block'}));this.originalElement.css({margin:this.originalElement.css('margin')});this._proportionallyResize();}
this.handles=o.handles||(!$('.ui-resizable-handle',this.element).length?"e,s,se":{n:'.ui-resizable-n',e:'.ui-resizable-e',s:'.ui-resizable-s',w:'.ui-resizable-w',se:'.ui-resizable-se',sw:'.ui-resizable-sw',ne:'.ui-resizable-ne',nw:'.ui-resizable-nw'});if(this.handles.constructor==String){if(this.handles=='all')this.handles='n,e,s,w,se,sw,ne,nw';var n=this.handles.split(",");this.handles={};for(var i=0;i<n.length;i++){var handle=$.trim(n[i]),hname='ui-resizable-'+handle;var axis=$('<div class="ui-resizable-handle '+hname+'"></div>');if(/sw|se|ne|nw/.test(handle))axis.css({zIndex:++o.zIndex});if('se'==handle){axis.addClass('ui-icon ui-icon-gripsmall-diagonal-se');};this.handles[handle]='.ui-resizable-'+handle;this.element.append(axis);}}
this._renderAxis=function(target){target=target||this.element;for(var i in this.handles){if(this.handles[i].constructor==String)
this.handles[i]=$(this.handles[i],this.element).show();if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var axis=$(this.handles[i],this.element),padWrapper=0;padWrapper=/sw|ne|nw|se|n|s/.test(i)?axis.outerHeight():axis.outerWidth();var padPos=['padding',/ne|nw|n/.test(i)?'Top':/se|sw|s/.test(i)?'Bottom':/^e$/.test(i)?'Right':'Left'].join("");target.css(padPos,padWrapper);this._proportionallyResize();}
if(!$(this.handles[i]).length)
continue;}};this._renderAxis(this.element);this._handles=$('.ui-resizable-handle',this.element).disableSelection();this._handles.mouseover(function(){if(!self.resizing){if(this.className)
var axis=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);self.axis=axis&&axis[1]?axis[1]:'se';}});if(o.autoHide){this._handles.hide();$(this.element).addClass("ui-resizable-autohide").hover(function(){if(o.disabled)return;$(this).removeClass("ui-resizable-autohide");self._handles.show();},function(){if(o.disabled)return;if(!self.resizing){$(this).addClass("ui-resizable-autohide");self._handles.hide();}});}
this._mouseInit();},destroy:function(){this._mouseDestroy();var _destroy=function(exp){$(exp).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find('.ui-resizable-handle').remove();};if(this.elementIsWrapper){_destroy(this.element);var wrapper=this.element;wrapper.after(this.originalElement.css({position:wrapper.css('position'),width:wrapper.outerWidth(),height:wrapper.outerHeight(),top:wrapper.css('top'),left:wrapper.css('left')})).remove();}
this.originalElement.css('resize',this.originalResizeStyle);_destroy(this.originalElement);return this;},_mouseCapture:function(event){var handle=false;for(var i in this.handles){if($(this.handles[i])[0]==event.target){handle=true;}}
return!this.options.disabled&&handle;},_mouseStart:function(event){var o=this.options,iniPos=this.element.position(),el=this.element;this.resizing=true;this.documentScroll={top:$(document).scrollTop(),left:$(document).scrollLeft()};if(el.is('.ui-draggable')||(/absolute/).test(el.css('position'))){el.css({position:'absolute',top:iniPos.top,left:iniPos.left});}
if($.browser.opera&&(/relative/).test(el.css('position')))
el.css({position:'relative',top:'auto',left:'auto'});this._renderProxy();var curleft=num(this.helper.css('left')),curtop=num(this.helper.css('top'));if(o.containment){curleft+=$(o.containment).scrollLeft()||0;curtop+=$(o.containment).scrollTop()||0;}
this.offset=this.helper.offset();this.position={left:curleft,top:curtop};this.size=this._helper?{width:el.outerWidth(),height:el.outerHeight()}:{width:el.width(),height:el.height()};this.originalSize=this._helper?{width:el.outerWidth(),height:el.outerHeight()}:{width:el.width(),height:el.height()};this.originalPosition={left:curleft,top:curtop};this.sizeDiff={width:el.outerWidth()-el.width(),height:el.outerHeight()-el.height()};this.originalMousePosition={left:event.pageX,top:event.pageY};this.aspectRatio=(typeof o.aspectRatio=='number')?o.aspectRatio:((this.originalSize.width/this.originalSize.height)||1);var cursor=$('.ui-resizable-'+this.axis).css('cursor');$('body').css('cursor',cursor=='auto'?this.axis+'-resize':cursor);el.addClass("ui-resizable-resizing");this._propagate("start",event);return true;},_mouseDrag:function(event){var el=this.helper,o=this.options,props={},self=this,smp=this.originalMousePosition,a=this.axis;var dx=(event.pageX-smp.left)||0,dy=(event.pageY-smp.top)||0;var trigger=this._change[a];if(!trigger)return false;var data=trigger.apply(this,[event,dx,dy]),ie6=$.browser.msie&&$.browser.version<7,csdif=this.sizeDiff;this._updateVirtualBoundaries(event.shiftKey);if(this._aspectRatio||event.shiftKey)
data=this._updateRatio(data,event);data=this._respectSize(data,event);this._propagate("resize",event);el.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"});if(!this._helper&&this._proportionallyResizeElements.length)
this._proportionallyResize();this._updateCache(data);this._trigger('resize',event,this.ui());return false;},_mouseStop:function(event){this.resizing=false;var o=this.options,self=this;if(this._helper){var pr=this._proportionallyResizeElements,ista=pr.length&&(/textarea/i).test(pr[0].nodeName),soffseth=ista&&$.ui.hasScroll(pr[0],'left')?0:self.sizeDiff.height,soffsetw=ista?0:self.sizeDiff.width;var s={width:(self.helper.width()-soffsetw),height:(self.helper.height()-soffseth)},left=(parseInt(self.element.css('left'),10)+(self.position.left-self.originalPosition.left))||null,top=(parseInt(self.element.css('top'),10)+(self.position.top-self.originalPosition.top))||null;if(!o.animate)
this.element.css($.extend(s,{top:top,left:left}));self.helper.height(self.size.height);self.helper.width(self.size.width);if(this._helper&&!o.animate)this._proportionallyResize();}
$('body').css('cursor','auto');this.element.removeClass("ui-resizable-resizing");this._propagate("stop",event);if(this._helper)this.helper.remove();return false;},_updateVirtualBoundaries:function(forceAspectRatio){var o=this.options,pMinWidth,pMaxWidth,pMinHeight,pMaxHeight,b;b={minWidth:isNumber(o.minWidth)?o.minWidth:0,maxWidth:isNumber(o.maxWidth)?o.maxWidth:Infinity,minHeight:isNumber(o.minHeight)?o.minHeight:0,maxHeight:isNumber(o.maxHeight)?o.maxHeight:Infinity};if(this._aspectRatio||forceAspectRatio){pMinWidth=b.minHeight*this.aspectRatio;pMinHeight=b.minWidth/this.aspectRatio;pMaxWidth=b.maxHeight*this.aspectRatio;pMaxHeight=b.maxWidth/this.aspectRatio;if(pMinWidth>b.minWidth)b.minWidth=pMinWidth;if(pMinHeight>b.minHeight)b.minHeight=pMinHeight;if(pMaxWidth<b.maxWidth)b.maxWidth=pMaxWidth;if(pMaxHeight<b.maxHeight)b.maxHeight=pMaxHeight;}
this._vBoundaries=b;},_updateCache:function(data){var o=this.options;this.offset=this.helper.offset();if(isNumber(data.left))this.position.left=data.left;if(isNumber(data.top))this.position.top=data.top;if(isNumber(data.height))this.size.height=data.height;if(isNumber(data.width))this.size.width=data.width;},_updateRatio:function(data,event){var o=this.options,cpos=this.position,csize=this.size,a=this.axis;if(isNumber(data.height))data.width=(data.height*this.aspectRatio);else if(isNumber(data.width))data.height=(data.width/this.aspectRatio);if(a=='sw'){data.left=cpos.left+(csize.width-data.width);data.top=null;}
if(a=='nw'){data.top=cpos.top+(csize.height-data.height);data.left=cpos.left+(csize.width-data.width);}
return data;},_respectSize:function(data,event){var el=this.helper,o=this._vBoundaries,pRatio=this._aspectRatio||event.shiftKey,a=this.axis,ismaxw=isNumber(data.width)&&o.maxWidth&&(o.maxWidth<data.width),ismaxh=isNumber(data.height)&&o.maxHeight&&(o.maxHeight<data.height),isminw=isNumber(data.width)&&o.minWidth&&(o.minWidth>data.width),isminh=isNumber(data.height)&&o.minHeight&&(o.minHeight>data.height);if(isminw)data.width=o.minWidth;if(isminh)data.height=o.minHeight;if(ismaxw)data.width=o.maxWidth;if(ismaxh)data.height=o.maxHeight;var dw=this.originalPosition.left+this.originalSize.width,dh=this.position.top+this.size.height;var cw=/sw|nw|w/.test(a),ch=/nw|ne|n/.test(a);if(isminw&&cw)data.left=dw-o.minWidth;if(ismaxw&&cw)data.left=dw-o.maxWidth;if(isminh&&ch)data.top=dh-o.minHeight;if(ismaxh&&ch)data.top=dh-o.maxHeight;var isNotwh=!data.width&&!data.height;if(isNotwh&&!data.left&&data.top)data.top=null;else if(isNotwh&&!data.top&&data.left)data.left=null;return data;},_proportionallyResize:function(){var o=this.options;if(!this._proportionallyResizeElements.length)return;var element=this.helper||this.element;for(var i=0;i<this._proportionallyResizeElements.length;i++){var prel=this._proportionallyResizeElements[i];if(!this.borderDif){var b=[prel.css('borderTopWidth'),prel.css('borderRightWidth'),prel.css('borderBottomWidth'),prel.css('borderLeftWidth')],p=[prel.css('paddingTop'),prel.css('paddingRight'),prel.css('paddingBottom'),prel.css('paddingLeft')];this.borderDif=$.map(b,function(v,i){var border=parseInt(v,10)||0,padding=parseInt(p[i],10)||0;return border+padding;});}
if($.browser.msie&&!(!($(element).is(':hidden')||$(element).parents(':hidden').length)))
continue;prel.css({height:(element.height()-this.borderDif[0]-this.borderDif[2])||0,width:(element.width()-this.borderDif[1]-this.borderDif[3])||0});};},_renderProxy:function(){var el=this.element,o=this.options;this.elementOffset=el.offset();if(this._helper){this.helper=this.helper||$('<div style="overflow:hidden;"></div>');var ie6=$.browser.msie&&$.browser.version<7,ie6offset=(ie6?1:0),pxyoffset=(ie6?2:-1);this.helper.addClass(this._helper).css({width:this.element.outerWidth()+pxyoffset,height:this.element.outerHeight()+pxyoffset,position:'absolute',left:this.elementOffset.left-ie6offset+'px',top:this.elementOffset.top-ie6offset+'px',zIndex:++o.zIndex});this.helper.appendTo("body").disableSelection();}else{this.helper=this.element;}},_change:{e:function(event,dx,dy){return{width:this.originalSize.width+dx};},w:function(event,dx,dy){var o=this.options,cs=this.originalSize,sp=this.originalPosition;return{left:sp.left+dx,width:cs.width-dx};},n:function(event,dx,dy){var o=this.options,cs=this.originalSize,sp=this.originalPosition;return{top:sp.top+dy,height:cs.height-dy};},s:function(event,dx,dy){return{height:this.originalSize.height+dy};},se:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]));},sw:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]));},ne:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]));},nw:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]));}},_propagate:function(n,event){$.ui.plugin.call(this,n,[event,this.ui()]);(n!="resize"&&this._trigger(n,event,this.ui()));},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition};}});$.extend($.ui.resizable,{version:"1.8.14"});$.ui.plugin.add("resizable","alsoResize",{start:function(event,ui){var self=$(this).data("resizable"),o=self.options;var _store=function(exp){$(exp).each(function(){var el=$(this);el.data("resizable-alsoresize",{width:parseInt(el.width(),10),height:parseInt(el.height(),10),left:parseInt(el.css('left'),10),top:parseInt(el.css('top'),10),position:el.css('position')});});};if(typeof(o.alsoResize)=='object'&&!o.alsoResize.parentNode){if(o.alsoResize.length){o.alsoResize=o.alsoResize[0];_store(o.alsoResize);}
else{$.each(o.alsoResize,function(exp){_store(exp);});}}else{_store(o.alsoResize);}},resize:function(event,ui){var self=$(this).data("resizable"),o=self.options,os=self.originalSize,op=self.originalPosition;var delta={height:(self.size.height-os.height)||0,width:(self.size.width-os.width)||0,top:(self.position.top-op.top)||0,left:(self.position.left-op.left)||0},_alsoResize=function(exp,c){$(exp).each(function(){var el=$(this),start=$(this).data("resizable-alsoresize"),style={},css=c&&c.length?c:el.parents(ui.originalElement[0]).length?['width','height']:['width','height','top','left'];$.each(css,function(i,prop){var sum=(start[prop]||0)+(delta[prop]||0);if(sum&&sum>=0)
style[prop]=sum||null;});if($.browser.opera&&/relative/.test(el.css('position'))){self._revertToRelativePosition=true;el.css({position:'absolute',top:'auto',left:'auto'});}
el.css(style);});};if(typeof(o.alsoResize)=='object'&&!o.alsoResize.nodeType){$.each(o.alsoResize,function(exp,c){_alsoResize(exp,c);});}else{_alsoResize(o.alsoResize);}},stop:function(event,ui){var self=$(this).data("resizable"),o=self.options;var _reset=function(exp){$(exp).each(function(){var el=$(this);el.css({position:el.data("resizable-alsoresize").position});});};if(self._revertToRelativePosition){self._revertToRelativePosition=false;if(typeof(o.alsoResize)=='object'&&!o.alsoResize.nodeType){$.each(o.alsoResize,function(exp){_reset(exp);});}else{_reset(o.alsoResize);}}
$(this).removeData("resizable-alsoresize");}});$.ui.plugin.add("resizable","animate",{stop:function(event,ui){var self=$(this).data("resizable"),o=self.options;var pr=self._proportionallyResizeElements,ista=pr.length&&(/textarea/i).test(pr[0].nodeName),soffseth=ista&&$.ui.hasScroll(pr[0],'left')?0:self.sizeDiff.height,soffsetw=ista?0:self.sizeDiff.width;var style={width:(self.size.width-soffsetw),height:(self.size.height-soffseth)},left=(parseInt(self.element.css('left'),10)+(self.position.left-self.originalPosition.left))||null,top=(parseInt(self.element.css('top'),10)+(self.position.top-self.originalPosition.top))||null;self.element.animate($.extend(style,top&&left?{top:top,left:left}:{}),{duration:o.animateDuration,easing:o.animateEasing,step:function(){var data={width:parseInt(self.element.css('width'),10),height:parseInt(self.element.css('height'),10),top:parseInt(self.element.css('top'),10),left:parseInt(self.element.css('left'),10)};if(pr&&pr.length)$(pr[0]).css({width:data.width,height:data.height});self._updateCache(data);self._propagate("resize",event);}});}});$.ui.plugin.add("resizable","containment",{start:function(event,ui){var self=$(this).data("resizable"),o=self.options,el=self.element;var oc=o.containment,ce=(oc instanceof $)?oc.get(0):(/parent/.test(oc))?el.parent().get(0):oc;if(!ce)return;self.containerElement=$(ce);if(/document/.test(oc)||oc==document){self.containerOffset={left:0,top:0};self.containerPosition={left:0,top:0};self.parentData={element:$(document),left:0,top:0,width:$(document).width(),height:$(document).height()||document.body.parentNode.scrollHeight};}
else{var element=$(ce),p=[];$(["Top","Right","Left","Bottom"]).each(function(i,name){p[i]=num(element.css("padding"+name));});self.containerOffset=element.offset();self.containerPosition=element.position();self.containerSize={height:(element.innerHeight()-p[3]),width:(element.innerWidth()-p[1])};var co=self.containerOffset,ch=self.containerSize.height,cw=self.containerSize.width,width=($.ui.hasScroll(ce,"left")?ce.scrollWidth:cw),height=($.ui.hasScroll(ce)?ce.scrollHeight:ch);self.parentData={element:ce,left:co.left,top:co.top,width:width,height:height};}},resize:function(event,ui){var self=$(this).data("resizable"),o=self.options,ps=self.containerSize,co=self.containerOffset,cs=self.size,cp=self.position,pRatio=self._aspectRatio||event.shiftKey,cop={top:0,left:0},ce=self.containerElement;if(ce[0]!=document&&(/static/).test(ce.css('position')))cop=co;if(cp.left<(self._helper?co.left:0)){self.size.width=self.size.width+(self._helper?(self.position.left-co.left):(self.position.left-cop.left));if(pRatio)self.size.height=self.size.width/o.aspectRatio;self.position.left=o.helper?co.left:0;}
if(cp.top<(self._helper?co.top:0)){self.size.height=self.size.height+(self._helper?(self.position.top-co.top):self.position.top);if(pRatio)self.size.width=self.size.height*o.aspectRatio;self.position.top=self._helper?co.top:0;}
self.offset.left=self.parentData.left+self.position.left;self.offset.top=self.parentData.top+self.position.top;var woset=Math.abs((self._helper?self.offset.left-cop.left:(self.offset.left-cop.left))+self.sizeDiff.width),hoset=Math.abs((self._helper?self.offset.top-cop.top:(self.offset.top-co.top))+self.sizeDiff.height);var isParent=self.containerElement.get(0)==self.element.parent().get(0),isOffsetRelative=/relative|absolute/.test(self.containerElement.css('position'));if(isParent&&isOffsetRelative)woset-=self.parentData.left;if(woset+self.size.width>=self.parentData.width){self.size.width=self.parentData.width-woset;if(pRatio)self.size.height=self.size.width/self.aspectRatio;}
if(hoset+self.size.height>=self.parentData.height){self.size.height=self.parentData.height-hoset;if(pRatio)self.size.width=self.size.height*self.aspectRatio;}},stop:function(event,ui){var self=$(this).data("resizable"),o=self.options,cp=self.position,co=self.containerOffset,cop=self.containerPosition,ce=self.containerElement;var helper=$(self.helper),ho=helper.offset(),w=helper.outerWidth()-self.sizeDiff.width,h=helper.outerHeight()-self.sizeDiff.height;if(self._helper&&!o.animate&&(/relative/).test(ce.css('position')))
$(this).css({left:ho.left-cop.left-co.left,width:w,height:h});if(self._helper&&!o.animate&&(/static/).test(ce.css('position')))
$(this).css({left:ho.left-cop.left-co.left,width:w,height:h});}});$.ui.plugin.add("resizable","ghost",{start:function(event,ui){var self=$(this).data("resizable"),o=self.options,cs=self.size;self.ghost=self.originalElement.clone();self.ghost.css({opacity:.25,display:'block',position:'relative',height:cs.height,width:cs.width,margin:0,left:0,top:0}).addClass('ui-resizable-ghost').addClass(typeof o.ghost=='string'?o.ghost:'');self.ghost.appendTo(self.helper);},resize:function(event,ui){var self=$(this).data("resizable"),o=self.options;if(self.ghost)self.ghost.css({position:'relative',height:self.size.height,width:self.size.width});},stop:function(event,ui){var self=$(this).data("resizable"),o=self.options;if(self.ghost&&self.helper)self.helper.get(0).removeChild(self.ghost.get(0));}});$.ui.plugin.add("resizable","grid",{resize:function(event,ui){var self=$(this).data("resizable"),o=self.options,cs=self.size,os=self.originalSize,op=self.originalPosition,a=self.axis,ratio=o._aspectRatio||event.shiftKey;o.grid=typeof o.grid=="number"?[o.grid,o.grid]:o.grid;var ox=Math.round((cs.width-os.width)/(o.grid[0]||1))*(o.grid[0]||1),oy=Math.round((cs.height-os.height)/(o.grid[1]||1))*(o.grid[1]||1);if(/^(se|s|e)$/.test(a)){self.size.width=os.width+ox;self.size.height=os.height+oy;}
else if(/^(ne)$/.test(a)){self.size.width=os.width+ox;self.size.height=os.height+oy;self.position.top=op.top-oy;}
else if(/^(sw)$/.test(a)){self.size.width=os.width+ox;self.size.height=os.height+oy;self.position.left=op.left-ox;}
else{self.size.width=os.width+ox;self.size.height=os.height+oy;self.position.top=op.top-oy;self.position.left=op.left-ox;}}});var num=function(v){return parseInt(v,10)||0;};var isNumber=function(value){return!isNaN(parseInt(value,10));};})(jQuery);(function($,undefined){$.widget("ui.selectable",$.ui.mouse,{options:{appendTo:'body',autoRefresh:true,distance:0,filter:'*',tolerance:'touch'},_create:function(){var self=this;this.element.addClass("ui-selectable");this.dragged=false;var selectees;this.refresh=function(){selectees=$(self.options.filter,self.element[0]);selectees.each(function(){var $this=$(this);var pos=$this.offset();$.data(this,"selectable-item",{element:this,$element:$this,left:pos.left,top:pos.top,right:pos.left+$this.outerWidth(),bottom:pos.top+$this.outerHeight(),startselected:false,selected:$this.hasClass('ui-selected'),selecting:$this.hasClass('ui-selecting'),unselecting:$this.hasClass('ui-unselecting')});});};this.refresh();this.selectees=selectees.addClass("ui-selectee");this._mouseInit();this.helper=$("<div class='ui-selectable-helper'></div>");},destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item");this.element.removeClass("ui-selectable ui-selectable-disabled").removeData("selectable").unbind(".selectable");this._mouseDestroy();return this;},_mouseStart:function(event){var self=this;this.opos=[event.pageX,event.pageY];if(this.options.disabled)
return;var options=this.options;this.selectees=$(options.filter,this.element[0]);this._trigger("start",event);$(options.appendTo).append(this.helper);this.helper.css({"left":event.clientX,"top":event.clientY,"width":0,"height":0});if(options.autoRefresh){this.refresh();}
this.selectees.filter('.ui-selected').each(function(){var selectee=$.data(this,"selectable-item");selectee.startselected=true;if(!event.ctrlKey){selectee.$element.removeClass('ui-selected');selectee.selected=false;selectee.$element.addClass('ui-unselecting');selectee.unselecting=true;self._trigger("unselecting",event,{unselecting:selectee.element});}});$(event.target).parents().andSelf().each(function(){var selectee=$.data(this,"selectable-item");if(selectee){var doSelect=!event.ctrlKey||!selectee.$element.hasClass('ui-selected');selectee.$element.removeClass(doSelect?"ui-unselecting":"ui-selected").addClass(doSelect?"ui-selecting":"ui-unselecting");selectee.unselecting=!doSelect;selectee.selecting=doSelect;selectee.selected=doSelect;if(doSelect){self._trigger("selecting",event,{selecting:selectee.element});}else{self._trigger("unselecting",event,{unselecting:selectee.element});}
return false;}});},_mouseDrag:function(event){var self=this;this.dragged=true;if(this.options.disabled)
return;var options=this.options;var x1=this.opos[0],y1=this.opos[1],x2=event.pageX,y2=event.pageY;if(x1>x2){var tmp=x2;x2=x1;x1=tmp;}
if(y1>y2){var tmp=y2;y2=y1;y1=tmp;}
this.helper.css({left:x1,top:y1,width:x2-x1,height:y2-y1});this.selectees.each(function(){var selectee=$.data(this,"selectable-item");if(!selectee||selectee.element==self.element[0])
return;var hit=false;if(options.tolerance=='touch'){hit=(!(selectee.left>x2||selectee.right<x1||selectee.top>y2||selectee.bottom<y1));}else if(options.tolerance=='fit'){hit=(selectee.left>x1&&selectee.right<x2&&selectee.top>y1&&selectee.bottom<y2);}
if(hit){if(selectee.selected){selectee.$element.removeClass('ui-selected');selectee.selected=false;}
if(selectee.unselecting){selectee.$element.removeClass('ui-unselecting');selectee.unselecting=false;}
if(!selectee.selecting){selectee.$element.addClass('ui-selecting');selectee.selecting=true;self._trigger("selecting",event,{selecting:selectee.element});}}else{if(selectee.selecting){if(event.metaKey&&selectee.startselected){selectee.$element.removeClass('ui-selecting');selectee.selecting=false;selectee.$element.addClass('ui-selected');selectee.selected=true;}else{selectee.$element.removeClass('ui-selecting');selectee.selecting=false;if(selectee.startselected){selectee.$element.addClass('ui-unselecting');selectee.unselecting=true;}
self._trigger("unselecting",event,{unselecting:selectee.element});}}
if(selectee.selected){if(!event.metaKey&&!selectee.startselected){selectee.$element.removeClass('ui-selected');selectee.selected=false;selectee.$element.addClass('ui-unselecting');selectee.unselecting=true;self._trigger("unselecting",event,{unselecting:selectee.element});}}}});return false;},_mouseStop:function(event){var self=this;this.dragged=false;var options=this.options;$('.ui-unselecting',this.element[0]).each(function(){var selectee=$.data(this,"selectable-item");selectee.$element.removeClass('ui-unselecting');selectee.unselecting=false;selectee.startselected=false;self._trigger("unselected",event,{unselected:selectee.element});});$('.ui-selecting',this.element[0]).each(function(){var selectee=$.data(this,"selectable-item");selectee.$element.removeClass('ui-selecting').addClass('ui-selected');selectee.selecting=false;selectee.selected=true;selectee.startselected=true;self._trigger("selected",event,{selected:selectee.element});});this._trigger("stop",event);this.helper.remove();return false;}});$.extend($.ui.selectable,{version:"1.8.14"});})(jQuery);(function($,undefined){$.widget("ui.sortable",$.ui.mouse,{widgetEventPrefix:"sort",options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:'auto',cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:'> *',opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1000},_create:function(){var o=this.options;this.containerCache={};this.element.addClass("ui-sortable");this.refresh();this.floating=this.items.length?o.axis==='x'||(/left|right/).test(this.items[0].item.css('float'))||(/inline|table-cell/).test(this.items[0].item.css('display')):false;this.offset=this.element.offset();this._mouseInit();},destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").removeData("sortable").unbind(".sortable");this._mouseDestroy();for(var i=this.items.length-1;i>=0;i--)
this.items[i].item.removeData("sortable-item");return this;},_setOption:function(key,value){if(key==="disabled"){this.options[key]=value;this.widget()
[value?"addClass":"removeClass"]("ui-sortable-disabled");}else{$.Widget.prototype._setOption.apply(this,arguments);}},_mouseCapture:function(event,overrideHandle){if(this.reverting){return false;}
if(this.options.disabled||this.options.type=='static')return false;this._refreshItems(event);var currentItem=null,self=this,nodes=$(event.target).parents().each(function(){if($.data(this,'sortable-item')==self){currentItem=$(this);return false;}});if($.data(event.target,'sortable-item')==self)currentItem=$(event.target);if(!currentItem)return false;if(this.options.handle&&!overrideHandle){var validHandle=false;$(this.options.handle,currentItem).find("*").andSelf().each(function(){if(this==event.target)validHandle=true;});if(!validHandle)return false;}
this.currentItem=currentItem;this._removeCurrentsFromItems();return true;},_mouseStart:function(event,overrideHandle,noActivation){var o=this.options,self=this;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(event);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;(o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt));this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};if(this.helper[0]!=this.currentItem[0]){this.currentItem.hide();}
this._createPlaceholder();if(o.containment)
this._setContainment();if(o.cursor){if($('body').css("cursor"))this._storedCursor=$('body').css("cursor");$('body').css("cursor",o.cursor);}
if(o.opacity){if(this.helper.css("opacity"))this._storedOpacity=this.helper.css("opacity");this.helper.css("opacity",o.opacity);}
if(o.zIndex){if(this.helper.css("zIndex"))this._storedZIndex=this.helper.css("zIndex");this.helper.css("zIndex",o.zIndex);}
if(this.scrollParent[0]!=document&&this.scrollParent[0].tagName!='HTML')
this.overflowOffset=this.scrollParent.offset();this._trigger("start",event,this._uiHash());if(!this._preserveHelperProportions)
this._cacheHelperProportions();if(!noActivation){for(var i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("activate",event,self._uiHash(this));}}
if($.ui.ddmanager)
$.ui.ddmanager.current=this;if($.ui.ddmanager&&!o.dropBehaviour)
$.ui.ddmanager.prepareOffsets(this,event);this.dragging=true;this.helper.addClass("ui-sortable-helper");this._mouseDrag(event);return true;},_mouseDrag:function(event){this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");if(!this.lastPositionAbs){this.lastPositionAbs=this.positionAbs;}
if(this.options.scroll){var o=this.options,scrolled=false;if(this.scrollParent[0]!=document&&this.scrollParent[0].tagName!='HTML'){if((this.overflowOffset.top+this.scrollParent[0].offsetHeight)-event.pageY<o.scrollSensitivity)
this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop+o.scrollSpeed;else if(event.pageY-this.overflowOffset.top<o.scrollSensitivity)
this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop-o.scrollSpeed;if((this.overflowOffset.left+this.scrollParent[0].offsetWidth)-event.pageX<o.scrollSensitivity)
this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft+o.scrollSpeed;else if(event.pageX-this.overflowOffset.left<o.scrollSensitivity)
this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft-o.scrollSpeed;}else{if(event.pageY-$(document).scrollTop()<o.scrollSensitivity)
scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed);else if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity)
scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed);if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity)
scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed);else if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity)
scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed);}
if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour)
$.ui.ddmanager.prepareOffsets(this,event);}
this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+'px';if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+'px';for(var i=this.items.length-1;i>=0;i--){var item=this.items[i],itemElement=item.item[0],intersection=this._intersectsWithPointer(item);if(!intersection)continue;if(itemElement!=this.currentItem[0]&&this.placeholder[intersection==1?"next":"prev"]()[0]!=itemElement&&!$.ui.contains(this.placeholder[0],itemElement)&&(this.options.type=='semi-dynamic'?!$.ui.contains(this.element[0],itemElement):true)){this.direction=intersection==1?"down":"up";if(this.options.tolerance=="pointer"||this._intersectsWithSides(item)){this._rearrange(event,item);}else{break;}
this._trigger("change",event,this._uiHash());break;}}
this._contactContainers(event);if($.ui.ddmanager)$.ui.ddmanager.drag(this,event);this._trigger('sort',event,this._uiHash());this.lastPositionAbs=this.positionAbs;return false;},_mouseStop:function(event,noPropagation){if(!event)return;if($.ui.ddmanager&&!this.options.dropBehaviour)
$.ui.ddmanager.drop(this,event);if(this.options.revert){var self=this;var cur=self.placeholder.offset();self.reverting=true;$(this.helper).animate({left:cur.left-this.offset.parent.left-self.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:cur.top-this.offset.parent.top-self.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){self._clear(event);});}else{this._clear(event,noPropagation);}
return false;},cancel:function(){var self=this;if(this.dragging){this._mouseUp({target:null});if(this.options.helper=="original")
this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper");else
this.currentItem.show();for(var i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("deactivate",null,self._uiHash(this));if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",null,self._uiHash(this));this.containers[i].containerCache.over=0;}}}
if(this.placeholder){if(this.placeholder[0].parentNode)this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(this.options.helper!="original"&&this.helper&&this.helper[0].parentNode)this.helper.remove();$.extend(this,{helper:null,dragging:false,reverting:false,_noFinalSort:null});if(this.domPosition.prev){$(this.domPosition.prev).after(this.currentItem);}else{$(this.domPosition.parent).prepend(this.currentItem);}}
return this;},serialize:function(o){var items=this._getItemsAsjQuery(o&&o.connected);var str=[];o=o||{};$(items).each(function(){var res=($(o.item||this).attr(o.attribute||'id')||'').match(o.expression||(/(.+)[-=_](.+)/));if(res)str.push((o.key||res[1]+'[]')+'='+(o.key&&o.expression?res[1]:res[2]));});if(!str.length&&o.key){str.push(o.key+'=');}
return str.join('&');},toArray:function(o){var items=this._getItemsAsjQuery(o&&o.connected);var ret=[];o=o||{};items.each(function(){ret.push($(o.item||this).attr(o.attribute||'id')||'');});return ret;},_intersectsWith:function(item){var x1=this.positionAbs.left,x2=x1+this.helperProportions.width,y1=this.positionAbs.top,y2=y1+this.helperProportions.height;var l=item.left,r=l+item.width,t=item.top,b=t+item.height;var dyClick=this.offset.click.top,dxClick=this.offset.click.left;var isOverElement=(y1+dyClick)>t&&(y1+dyClick)<b&&(x1+dxClick)>l&&(x1+dxClick)<r;if(this.options.tolerance=="pointer"||this.options.forcePointerForContainers||(this.options.tolerance!="pointer"&&this.helperProportions[this.floating?'width':'height']>item[this.floating?'width':'height'])){return isOverElement;}else{return(l<x1+(this.helperProportions.width/2)&&x2-(this.helperProportions.width/2)<r&&t<y1+(this.helperProportions.height/2)&&y2-(this.helperProportions.height/2)<b);}},_intersectsWithPointer:function(item){var isOverElementHeight=$.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,item.top,item.height),isOverElementWidth=$.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,item.left,item.width),isOverElement=isOverElementHeight&&isOverElementWidth,verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(!isOverElement)
return false;return this.floating?(((horizontalDirection&&horizontalDirection=="right")||verticalDirection=="down")?2:1):(verticalDirection&&(verticalDirection=="down"?2:1));},_intersectsWithSides:function(item){var isOverBottomHalf=$.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,item.top+(item.height/2),item.height),isOverRightHalf=$.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,item.left+(item.width/2),item.width),verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(this.floating&&horizontalDirection){return((horizontalDirection=="right"&&isOverRightHalf)||(horizontalDirection=="left"&&!isOverRightHalf));}else{return verticalDirection&&((verticalDirection=="down"&&isOverBottomHalf)||(verticalDirection=="up"&&!isOverBottomHalf));}},_getDragVerticalDirection:function(){var delta=this.positionAbs.top-this.lastPositionAbs.top;return delta!=0&&(delta>0?"down":"up");},_getDragHorizontalDirection:function(){var delta=this.positionAbs.left-this.lastPositionAbs.left;return delta!=0&&(delta>0?"right":"left");},refresh:function(event){this._refreshItems(event);this.refreshPositions();return this;},_connectWith:function(){var options=this.options;return options.connectWith.constructor==String?[options.connectWith]:options.connectWith;},_getItemsAsjQuery:function(connected){var self=this;var items=[];var queries=[];var connectWith=this._connectWith();if(connectWith&&connected){for(var i=connectWith.length-1;i>=0;i--){var cur=$(connectWith[i]);for(var j=cur.length-1;j>=0;j--){var inst=$.data(cur[j],'sortable');if(inst&&inst!=this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element):$(inst.options.items,inst.element).not(".ui-sortable-helper").not('.ui-sortable-placeholder'),inst]);}};};}
queries.push([$.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):$(this.options.items,this.element).not(".ui-sortable-helper").not('.ui-sortable-placeholder'),this]);for(var i=queries.length-1;i>=0;i--){queries[i][0].each(function(){items.push(this);});};return $(items);},_removeCurrentsFromItems:function(){var list=this.currentItem.find(":data(sortable-item)");for(var i=0;i<this.items.length;i++){for(var j=0;j<list.length;j++){if(list[j]==this.items[i].item[0])
this.items.splice(i,1);};};},_refreshItems:function(event){this.items=[];this.containers=[this];var items=this.items;var self=this;var queries=[[$.isFunction(this.options.items)?this.options.items.call(this.element[0],event,{item:this.currentItem}):$(this.options.items,this.element),this]];var connectWith=this._connectWith();if(connectWith){for(var i=connectWith.length-1;i>=0;i--){var cur=$(connectWith[i]);for(var j=cur.length-1;j>=0;j--){var inst=$.data(cur[j],'sortable');if(inst&&inst!=this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element[0],event,{item:this.currentItem}):$(inst.options.items,inst.element),inst]);this.containers.push(inst);}};};}
for(var i=queries.length-1;i>=0;i--){var targetData=queries[i][1];var _queries=queries[i][0];for(var j=0,queriesLength=_queries.length;j<queriesLength;j++){var item=$(_queries[j]);item.data('sortable-item',targetData);items.push({item:item,instance:targetData,width:0,height:0,left:0,top:0});};};},refreshPositions:function(fast){if(this.offsetParent&&this.helper){this.offset.parent=this._getParentOffset();}
for(var i=this.items.length-1;i>=0;i--){var item=this.items[i];if(item.instance!=this.currentContainer&&this.currentContainer&&item.item[0]!=this.currentItem[0])
continue;var t=this.options.toleranceElement?$(this.options.toleranceElement,item.item):item.item;if(!fast){item.width=t.outerWidth();item.height=t.outerHeight();}
var p=t.offset();item.left=p.left;item.top=p.top;};if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this);}else{for(var i=this.containers.length-1;i>=0;i--){var p=this.containers[i].element.offset();this.containers[i].containerCache.left=p.left;this.containers[i].containerCache.top=p.top;this.containers[i].containerCache.width=this.containers[i].element.outerWidth();this.containers[i].containerCache.height=this.containers[i].element.outerHeight();};}
return this;},_createPlaceholder:function(that){var self=that||this,o=self.options;if(!o.placeholder||o.placeholder.constructor==String){var className=o.placeholder;o.placeholder={element:function(){var el=$(document.createElement(self.currentItem[0].nodeName)).addClass(className||self.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];if(!className)
el.style.visibility="hidden";return el;},update:function(container,p){if(className&&!o.forcePlaceholderSize)return;if(!p.height()){p.height(self.currentItem.innerHeight()-parseInt(self.currentItem.css('paddingTop')||0,10)-parseInt(self.currentItem.css('paddingBottom')||0,10));};if(!p.width()){p.width(self.currentItem.innerWidth()-parseInt(self.currentItem.css('paddingLeft')||0,10)-parseInt(self.currentItem.css('paddingRight')||0,10));};}};}
self.placeholder=$(o.placeholder.element.call(self.element,self.currentItem));self.currentItem.after(self.placeholder);o.placeholder.update(self,self.placeholder);},_contactContainers:function(event){var innermostContainer=null,innermostIndex=null;for(var i=this.containers.length-1;i>=0;i--){if($.ui.contains(this.currentItem[0],this.containers[i].element[0]))
continue;if(this._intersectsWith(this.containers[i].containerCache)){if(innermostContainer&&$.ui.contains(this.containers[i].element[0],innermostContainer.element[0]))
continue;innermostContainer=this.containers[i];innermostIndex=i;}else{if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",event,this._uiHash(this));this.containers[i].containerCache.over=0;}}}
if(!innermostContainer)return;if(this.containers.length===1){this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1;}else if(this.currentContainer!=this.containers[innermostIndex]){var dist=10000;var itemWithLeastDistance=null;var base=this.positionAbs[this.containers[innermostIndex].floating?'left':'top'];for(var j=this.items.length-1;j>=0;j--){if(!$.ui.contains(this.containers[innermostIndex].element[0],this.items[j].item[0]))continue;var cur=this.items[j][this.containers[innermostIndex].floating?'left':'top'];if(Math.abs(cur-base)<dist){dist=Math.abs(cur-base);itemWithLeastDistance=this.items[j];}}
if(!itemWithLeastDistance&&!this.options.dropOnEmpty)
return;this.currentContainer=this.containers[innermostIndex];itemWithLeastDistance?this._rearrange(event,itemWithLeastDistance,null,true):this._rearrange(event,null,this.containers[innermostIndex].element,true);this._trigger("change",event,this._uiHash());this.containers[innermostIndex]._trigger("change",event,this._uiHash(this));this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1;}},_createHelper:function(event){var o=this.options;var helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event,this.currentItem])):(o.helper=='clone'?this.currentItem.clone():this.currentItem);if(!helper.parents('body').length)
$(o.appendTo!='parent'?o.appendTo:this.currentItem[0].parentNode)[0].appendChild(helper[0]);if(helper[0]==this.currentItem[0])
this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")};if(helper[0].style.width==''||o.forceHelperSize)helper.width(this.currentItem.width());if(helper[0].style.height==''||o.forceHelperSize)helper.height(this.currentItem.height());return helper;},_adjustOffsetFromHelper:function(obj){if(typeof obj=='string'){obj=obj.split(' ');}
if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0};}
if('left'in obj){this.offset.click.left=obj.left+this.margins.left;}
if('right'in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left;}
if('top'in obj){this.offset.click.top=obj.top+this.margins.top;}
if('bottom'in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top;}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();if(this.cssPosition=='absolute'&&this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop();}
if((this.offsetParent[0]==document.body)||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=='html'&&$.browser.msie))
po={top:0,left:0};return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var p=this.currentItem.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()};}else{return{top:0,left:0};}},_cacheMargins:function(){this.margins={left:(parseInt(this.currentItem.css("marginLeft"),10)||0),top:(parseInt(this.currentItem.css("marginTop"),10)||0)};},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function(){var o=this.options;if(o.containment=='parent')o.containment=this.helper[0].parentNode;if(o.containment=='document'||o.containment=='window')this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,$(o.containment=='document'?document:window).width()-this.helperProportions.width-this.margins.left,($(o.containment=='document'?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!(/^(document|window|parent)$/).test(o.containment)){var ce=$(o.containment)[0];var co=$(o.containment).offset();var over=($(ce).css("overflow")!='hidden');this.containment=[co.left+(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0)-this.margins.left,co.top+(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0)-this.margins.top,co.left+(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,co.top+(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top];}},_convertPositionTo:function(d,pos){if(!pos)pos=this.position;var mod=d=="absolute"?1:-1;var o=this.options,scroll=this.cssPosition=='absolute'&&!(this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);return{top:(pos.top
+this.offset.relative.top*mod
+this.offset.parent.top*mod
-($.browser.safari&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop()))*mod)),left:(pos.left
+this.offset.relative.left*mod
+this.offset.parent.left*mod
-($.browser.safari&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod))};},_generatePosition:function(event){var o=this.options,scroll=this.cssPosition=='absolute'&&!(this.scrollParent[0]!=document&&$.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);if(this.cssPosition=='relative'&&!(this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0])){this.offset.relative=this._getRelativeOffset();}
var pageX=event.pageX;var pageY=event.pageY;if(this.originalPosition){if(this.containment){if(event.pageX-this.offset.click.left<this.containment[0])pageX=this.containment[0]+this.offset.click.left;if(event.pageY-this.offset.click.top<this.containment[1])pageY=this.containment[1]+this.offset.click.top;if(event.pageX-this.offset.click.left>this.containment[2])pageX=this.containment[2]+this.offset.click.left;if(event.pageY-this.offset.click.top>this.containment[3])pageY=this.containment[3]+this.offset.click.top;}
if(o.grid){var top=this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1];pageY=this.containment?(!(top-this.offset.click.top<this.containment[1]||top-this.offset.click.top>this.containment[3])?top:(!(top-this.offset.click.top<this.containment[1])?top-o.grid[1]:top+o.grid[1])):top;var left=this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0];pageX=this.containment?(!(left-this.offset.click.left<this.containment[0]||left-this.offset.click.left>this.containment[2])?left:(!(left-this.offset.click.left<this.containment[0])?left-o.grid[0]:left+o.grid[0])):left;}}
return{top:(pageY
-this.offset.click.top
-this.offset.relative.top
-this.offset.parent.top
+($.browser.safari&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop())))),left:(pageX
-this.offset.click.left
-this.offset.relative.left
-this.offset.parent.left
+($.browser.safari&&this.cssPosition=='fixed'?0:(this.cssPosition=='fixed'?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())))};},_rearrange:function(event,i,a,hardRefresh){a?a[0].appendChild(this.placeholder[0]):i.item[0].parentNode.insertBefore(this.placeholder[0],(this.direction=='down'?i.item[0]:i.item[0].nextSibling));this.counter=this.counter?++this.counter:1;var self=this,counter=this.counter;window.setTimeout(function(){if(counter==self.counter)self.refreshPositions(!hardRefresh);},0);},_clear:function(event,noPropagation){this.reverting=false;var delayedTriggers=[],self=this;if(!this._noFinalSort&&this.currentItem.parent().length)this.placeholder.before(this.currentItem);this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var i in this._storedCSS){if(this._storedCSS[i]=='auto'||this._storedCSS[i]=='static')this._storedCSS[i]='';}
this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper");}else{this.currentItem.show();}
if(this.fromOutside&&!noPropagation)delayedTriggers.push(function(event){this._trigger("receive",event,this._uiHash(this.fromOutside));});if((this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!noPropagation)delayedTriggers.push(function(event){this._trigger("update",event,this._uiHash());});if(!$.ui.contains(this.element[0],this.currentItem[0])){if(!noPropagation)delayedTriggers.push(function(event){this._trigger("remove",event,this._uiHash());});for(var i=this.containers.length-1;i>=0;i--){if($.ui.contains(this.containers[i].element[0],this.currentItem[0])&&!noPropagation){delayedTriggers.push((function(c){return function(event){c._trigger("receive",event,this._uiHash(this));};}).call(this,this.containers[i]));delayedTriggers.push((function(c){return function(event){c._trigger("update",event,this._uiHash(this));};}).call(this,this.containers[i]));}};};for(var i=this.containers.length-1;i>=0;i--){if(!noPropagation)delayedTriggers.push((function(c){return function(event){c._trigger("deactivate",event,this._uiHash(this));};}).call(this,this.containers[i]));if(this.containers[i].containerCache.over){delayedTriggers.push((function(c){return function(event){c._trigger("out",event,this._uiHash(this));};}).call(this,this.containers[i]));this.containers[i].containerCache.over=0;}}
if(this._storedCursor)$('body').css("cursor",this._storedCursor);if(this._storedOpacity)this.helper.css("opacity",this._storedOpacity);if(this._storedZIndex)this.helper.css("zIndex",this._storedZIndex=='auto'?'':this._storedZIndex);this.dragging=false;if(this.cancelHelperRemoval){if(!noPropagation){this._trigger("beforeStop",event,this._uiHash());for(var i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event);};this._trigger("stop",event,this._uiHash());}
return false;}
if(!noPropagation)this._trigger("beforeStop",event,this._uiHash());this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(this.helper[0]!=this.currentItem[0])this.helper.remove();this.helper=null;if(!noPropagation){for(var i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event);};this._trigger("stop",event,this._uiHash());}
this.fromOutside=false;return true;},_trigger:function(){if($.Widget.prototype._trigger.apply(this,arguments)===false){this.cancel();}},_uiHash:function(inst){var self=inst||this;return{helper:self.helper,placeholder:self.placeholder||$([]),position:self.position,originalPosition:self.originalPosition,offset:self.positionAbs,item:self.currentItem,sender:inst?inst.element:null};}});$.extend($.ui.sortable,{version:"1.8.14"});})(jQuery);(function($,undefined){$.widget("ui.accordion",{options:{active:0,animated:"slide",autoHeight:true,clearStyle:false,collapsible:false,event:"click",fillSpace:false,header:"> li > :first-child,> :not(li):even",icons:{header:"ui-icon-triangle-1-e",headerSelected:"ui-icon-triangle-1-s"},navigation:false,navigationFilter:function(){return this.href.toLowerCase()===location.href.toLowerCase();}},_create:function(){var self=this,options=self.options;self.running=0;self.element.addClass("ui-accordion ui-widget ui-helper-reset").children("li").addClass("ui-accordion-li-fix");self.headers=self.element.find(options.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all").bind("mouseenter.accordion",function(){if(options.disabled){return;}
$(this).addClass("ui-state-hover");}).bind("mouseleave.accordion",function(){if(options.disabled){return;}
$(this).removeClass("ui-state-hover");}).bind("focus.accordion",function(){if(options.disabled){return;}
$(this).addClass("ui-state-focus");}).bind("blur.accordion",function(){if(options.disabled){return;}
$(this).removeClass("ui-state-focus");});self.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom");if(options.navigation){var current=self.element.find("a").filter(options.navigationFilter).eq(0);if(current.length){var header=current.closest(".ui-accordion-header");if(header.length){self.active=header;}else{self.active=current.closest(".ui-accordion-content").prev();}}}
self.active=self._findActive(self.active||options.active).addClass("ui-state-default ui-state-active").toggleClass("ui-corner-all").toggleClass("ui-corner-top");self.active.next().addClass("ui-accordion-content-active");self._createIcons();self.resize();self.element.attr("role","tablist");self.headers.attr("role","tab").bind("keydown.accordion",function(event){return self._keydown(event);}).next().attr("role","tabpanel");self.headers.not(self.active||"").attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).next().hide();if(!self.active.length){self.headers.eq(0).attr("tabIndex",0);}else{self.active.attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0});}
if(!$.browser.safari){self.headers.find("a").attr("tabIndex",-1);}
if(options.event){self.headers.bind(options.event.split(" ").join(".accordion ")+".accordion",function(event){self._clickHandler.call(self,event,this);event.preventDefault();});}},_createIcons:function(){var options=this.options;if(options.icons){$("<span></span>").addClass("ui-icon "+options.icons.header).prependTo(this.headers);this.active.children(".ui-icon").toggleClass(options.icons.header).toggleClass(options.icons.headerSelected);this.element.addClass("ui-accordion-icons");}},_destroyIcons:function(){this.headers.children(".ui-icon").remove();this.element.removeClass("ui-accordion-icons");},destroy:function(){var options=this.options;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role");this.headers.unbind(".accordion").removeClass("ui-accordion-header ui-accordion-disabled ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("tabIndex");this.headers.find("a").removeAttr("tabIndex");this._destroyIcons();var contents=this.headers.next().css("display","").removeAttr("role").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-accordion-disabled ui-state-disabled");if(options.autoHeight||options.fillHeight){contents.css("height","");}
return $.Widget.prototype.destroy.call(this);},_setOption:function(key,value){$.Widget.prototype._setOption.apply(this,arguments);if(key=="active"){this.activate(value);}
if(key=="icons"){this._destroyIcons();if(value){this._createIcons();}}
if(key=="disabled"){this.headers.add(this.headers.next())
[value?"addClass":"removeClass"]("ui-accordion-disabled ui-state-disabled");}},_keydown:function(event){if(this.options.disabled||event.altKey||event.ctrlKey){return;}
var keyCode=$.ui.keyCode,length=this.headers.length,currentIndex=this.headers.index(event.target),toFocus=false;switch(event.keyCode){case keyCode.RIGHT:case keyCode.DOWN:toFocus=this.headers[(currentIndex+1)%length];break;case keyCode.LEFT:case keyCode.UP:toFocus=this.headers[(currentIndex-1+length)%length];break;case keyCode.SPACE:case keyCode.ENTER:this._clickHandler({target:event.target},event.target);event.preventDefault();}
if(toFocus){$(event.target).attr("tabIndex",-1);$(toFocus).attr("tabIndex",0);toFocus.focus();return false;}
return true;},resize:function(){var options=this.options,maxHeight;if(options.fillSpace){if($.browser.msie){var defOverflow=this.element.parent().css("overflow");this.element.parent().css("overflow","hidden");}
maxHeight=this.element.parent().height();if($.browser.msie){this.element.parent().css("overflow",defOverflow);}
this.headers.each(function(){maxHeight-=$(this).outerHeight(true);});this.headers.next().each(function(){$(this).height(Math.max(0,maxHeight-
$(this).innerHeight()+$(this).height()));}).css("overflow","auto");}else if(options.autoHeight){maxHeight=0;this.headers.next().each(function(){maxHeight=Math.max(maxHeight,$(this).height("").height());}).height(maxHeight);}
return this;},activate:function(index){this.options.active=index;var active=this._findActive(index)[0];this._clickHandler({target:active},active);return this;},_findActive:function(selector){return selector?typeof selector==="number"?this.headers.filter(":eq("+selector+")"):this.headers.not(this.headers.not(selector)):selector===false?$([]):this.headers.filter(":eq(0)");},_clickHandler:function(event,target){var options=this.options;if(options.disabled){return;}
if(!event.target){if(!options.collapsible){return;}
this.active.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(options.icons.headerSelected).addClass(options.icons.header);this.active.next().addClass("ui-accordion-content-active");var toHide=this.active.next(),data={options:options,newHeader:$([]),oldHeader:options.active,newContent:$([]),oldContent:toHide},toShow=(this.active=$([]));this._toggle(toShow,toHide,data);return;}
var clicked=$(event.currentTarget||target),clickedIsActive=clicked[0]===this.active[0];options.active=options.collapsible&&clickedIsActive?false:this.headers.index(clicked);if(this.running||(!options.collapsible&&clickedIsActive)){return;}
var active=this.active,toShow=clicked.next(),toHide=this.active.next(),data={options:options,newHeader:clickedIsActive&&options.collapsible?$([]):clicked,oldHeader:this.active,newContent:clickedIsActive&&options.collapsible?$([]):toShow,oldContent:toHide},down=this.headers.index(this.active[0])>this.headers.index(clicked[0]);this.active=clickedIsActive?$([]):clicked;this._toggle(toShow,toHide,data,clickedIsActive,down);active.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(options.icons.headerSelected).addClass(options.icons.header);if(!clickedIsActive){clicked.removeClass("ui-state-default ui-corner-all").addClass("ui-state-active ui-corner-top").children(".ui-icon").removeClass(options.icons.header).addClass(options.icons.headerSelected);clicked.next().addClass("ui-accordion-content-active");}
return;},_toggle:function(toShow,toHide,data,clickedIsActive,down){var self=this,options=self.options;self.toShow=toShow;self.toHide=toHide;self.data=data;var complete=function(){if(!self){return;}
return self._completed.apply(self,arguments);};self._trigger("changestart",null,self.data);self.running=toHide.size()===0?toShow.size():toHide.size();if(options.animated){var animOptions={};if(options.collapsible&&clickedIsActive){animOptions={toShow:$([]),toHide:toHide,complete:complete,down:down,autoHeight:options.autoHeight||options.fillSpace};}else{animOptions={toShow:toShow,toHide:toHide,complete:complete,down:down,autoHeight:options.autoHeight||options.fillSpace};}
if(!options.proxied){options.proxied=options.animated;}
if(!options.proxiedDuration){options.proxiedDuration=options.duration;}
options.animated=$.isFunction(options.proxied)?options.proxied(animOptions):options.proxied;options.duration=$.isFunction(options.proxiedDuration)?options.proxiedDuration(animOptions):options.proxiedDuration;var animations=$.ui.accordion.animations,duration=options.duration,easing=options.animated;if(easing&&!animations[easing]&&!$.easing[easing]){easing="slide";}
if(!animations[easing]){animations[easing]=function(options){this.slide(options,{easing:easing,duration:duration||700});};}
animations[easing](animOptions);}else{if(options.collapsible&&clickedIsActive){toShow.toggle();}else{toHide.hide();toShow.show();}
complete(true);}
toHide.prev().attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).blur();toShow.prev().attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}).focus();},_completed:function(cancel){this.running=cancel?0:--this.running;if(this.running){return;}
if(this.options.clearStyle){this.toShow.add(this.toHide).css({height:"",overflow:""});}
this.toHide.removeClass("ui-accordion-content-active");if(this.toHide.length){this.toHide.parent()[0].className=this.toHide.parent()[0].className;}
this._trigger("change",null,this.data);}});$.extend($.ui.accordion,{version:"1.8.14",animations:{slide:function(options,additions){options=$.extend({easing:"swing",duration:300},options,additions);if(!options.toHide.size()){options.toShow.animate({height:"show",paddingTop:"show",paddingBottom:"show"},options);return;}
if(!options.toShow.size()){options.toHide.animate({height:"hide",paddingTop:"hide",paddingBottom:"hide"},options);return;}
var overflow=options.toShow.css("overflow"),percentDone=0,showProps={},hideProps={},fxAttrs=["height","paddingTop","paddingBottom"],originalWidth;var s=options.toShow;originalWidth=s[0].style.width;s.width(parseInt(s.parent().width(),10)
-parseInt(s.css("paddingLeft"),10)
-parseInt(s.css("paddingRight"),10)
-(parseInt(s.css("borderLeftWidth"),10)||0)
-(parseInt(s.css("borderRightWidth"),10)||0));$.each(fxAttrs,function(i,prop){hideProps[prop]="hide";var parts=(""+$.css(options.toShow[0],prop)).match(/^([\d+-.]+)(.*)$/);showProps[prop]={value:parts[1],unit:parts[2]||"px"};});options.toShow.css({height:0,overflow:"hidden"}).show();options.toHide.filter(":hidden").each(options.complete).end().filter(":visible").animate(hideProps,{step:function(now,settings){if(settings.prop=="height"){percentDone=(settings.end-settings.start===0)?0:(settings.now-settings.start)/(settings.end-settings.start);}
options.toShow[0].style[settings.prop]=(percentDone*showProps[settings.prop].value)
+showProps[settings.prop].unit;},duration:options.duration,easing:options.easing,complete:function(){if(!options.autoHeight){options.toShow.css("height","");}
options.toShow.css({width:originalWidth,overflow:overflow});options.complete();}});},bounceslide:function(options){this.slide(options,{easing:options.down?"easeOutBounce":"swing",duration:options.down?1000:200});}}});})(jQuery);(function($,undefined){var requestIndex=0;$.widget("ui.autocomplete",{options:{appendTo:"body",autoFocus:false,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null},pending:0,_create:function(){var self=this,doc=this.element[0].ownerDocument,suppressKeyPress;this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(event){if(self.options.disabled||self.element.attr("readonly")){return;}
suppressKeyPress=false;var keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.PAGE_UP:self._move("previousPage",event);break;case keyCode.PAGE_DOWN:self._move("nextPage",event);break;case keyCode.UP:self._move("previous",event);event.preventDefault();break;case keyCode.DOWN:self._move("next",event);event.preventDefault();break;case keyCode.ENTER:case keyCode.NUMPAD_ENTER:if(self.menu.active){suppressKeyPress=true;event.preventDefault();}
case keyCode.TAB:if(!self.menu.active){return;}
self.menu.select(event);break;case keyCode.ESCAPE:self.element.val(self.term);self.close(event);break;default:clearTimeout(self.searching);self.searching=setTimeout(function(){if(self.term!=self.element.val()){self.selectedItem=null;self.search(null,event);}},self.options.delay);break;}}).bind("keypress.autocomplete",function(event){if(suppressKeyPress){suppressKeyPress=false;event.preventDefault();}}).bind("focus.autocomplete",function(){if(self.options.disabled){return;}
self.selectedItem=null;self.previous=self.element.val();}).bind("blur.autocomplete",function(event){if(self.options.disabled){return;}
clearTimeout(self.searching);self.closing=setTimeout(function(){self.close(event);self._change(event);},150);});this._initSource();this.response=function(){return self._response.apply(self,arguments);};this.menu=$("<ul></ul>").addClass("ui-autocomplete").appendTo($(this.options.appendTo||"body",doc)[0]).mousedown(function(event){var menuElement=self.menu.element[0];if(!$(event.target).closest(".ui-menu-item").length){setTimeout(function(){$(document).one('mousedown',function(event){if(event.target!==self.element[0]&&event.target!==menuElement&&!$.ui.contains(menuElement,event.target)){self.close();}});},1);}
setTimeout(function(){clearTimeout(self.closing);},13);}).menu({focus:function(event,ui){var item=ui.item.data("item.autocomplete");if(false!==self._trigger("focus",event,{item:item})){if(/^key/.test(event.originalEvent.type)){self.element.val(item.value);}}},selected:function(event,ui){var item=ui.item.data("item.autocomplete"),previous=self.previous;if(self.element[0]!==doc.activeElement){self.element.focus();self.previous=previous;setTimeout(function(){self.previous=previous;self.selectedItem=item;},1);}
if(false!==self._trigger("select",event,{item:item})){self.element.val(item.value);}
self.term=self.element.val();self.close(event);self.selectedItem=item;},blur:function(event,ui){if(self.menu.element.is(":visible")&&(self.element.val()!==self.term)){self.element.val(self.term);}}}).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("menu");if($.fn.bgiframe){this.menu.element.bgiframe();}},destroy:function(){this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup");this.menu.element.remove();$.Widget.prototype.destroy.call(this);},_setOption:function(key,value){$.Widget.prototype._setOption.apply(this,arguments);if(key==="source"){this._initSource();}
if(key==="appendTo"){this.menu.element.appendTo($(value||"body",this.element[0].ownerDocument)[0])}
if(key==="disabled"&&value&&this.xhr){this.xhr.abort();}},_initSource:function(){var self=this,array,url;if($.isArray(this.options.source)){array=this.options.source;this.source=function(request,response){response($.ui.autocomplete.filter(array,request.term));};}else if(typeof this.options.source==="string"){url=this.options.source;this.source=function(request,response){if(self.xhr){self.xhr.abort();}
self.xhr=$.ajax({url:url,data:request,dataType:"json",autocompleteRequest:++requestIndex,success:function(data,status){if(this.autocompleteRequest===requestIndex){response(data);}},error:function(){if(this.autocompleteRequest===requestIndex){response([]);}}});};}else{this.source=this.options.source;}},search:function(value,event){value=value!=null?value:this.element.val();this.term=this.element.val();if(value.length<this.options.minLength){return this.close(event);}
clearTimeout(this.closing);if(this._trigger("search",event)===false){return;}
return this._search(value);},_search:function(value){this.pending++;this.element.addClass("ui-autocomplete-loading");this.source({term:value},this.response);},_response:function(content){if(!this.options.disabled&&content&&content.length){content=this._normalize(content);this._suggest(content);this._trigger("open");}else{this.close();}
this.pending--;if(!this.pending){this.element.removeClass("ui-autocomplete-loading");}},close:function(event){clearTimeout(this.closing);if(this.menu.element.is(":visible")){this.menu.element.hide();this.menu.deactivate();this._trigger("close",event);}},_change:function(event){if(this.previous!==this.element.val()){this._trigger("change",event,{item:this.selectedItem});}},_normalize:function(items){if(items.length&&items[0].label&&items[0].value){return items;}
return $.map(items,function(item){if(typeof item==="string"){return{label:item,value:item};}
return $.extend({label:item.label||item.value,value:item.value||item.label},item);});},_suggest:function(items){var ul=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(ul,items);this.menu.deactivate();this.menu.refresh();ul.show();this._resizeMenu();ul.position($.extend({of:this.element},this.options.position));if(this.options.autoFocus){this.menu.next(new $.Event("mouseover"));}},_resizeMenu:function(){var ul=this.menu.element;ul.outerWidth(Math.max(ul.width("").outerWidth(),this.element.outerWidth()));},_renderMenu:function(ul,items){var self=this;$.each(items,function(index,item){self._renderItem(ul,item);});},_renderItem:function(ul,item){return $("<li></li>").data("item.autocomplete",item).append($("<a></a>").text(item.label)).appendTo(ul);},_move:function(direction,event){if(!this.menu.element.is(":visible")){this.search(null,event);return;}
if(this.menu.first()&&/^previous/.test(direction)||this.menu.last()&&/^next/.test(direction)){this.element.val(this.term);this.menu.deactivate();return;}
this.menu[direction](event);},widget:function(){return this.menu.element;}});$.extend($.ui.autocomplete,{escapeRegex:function(value){return value.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");},filter:function(array,term){var matcher=new RegExp($.ui.autocomplete.escapeRegex(term),"i");return $.grep(array,function(value){return matcher.test(value.label||value.value||value);});}});}(jQuery));(function($){$.widget("ui.menu",{_create:function(){var self=this;this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(event){if(!$(event.target).closest(".ui-menu-item a").length){return;}
event.preventDefault();self.select(event);});this.refresh();},refresh:function(){var self=this;var items=this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem");items.children("a").addClass("ui-corner-all").attr("tabindex",-1).mouseenter(function(event){self.activate(event,$(this).parent());}).mouseleave(function(){self.deactivate();});},activate:function(event,item){this.deactivate();if(this.hasScroll()){var offset=item.offset().top-this.element.offset().top,scroll=this.element.scrollTop(),elementHeight=this.element.height();if(offset<0){this.element.scrollTop(scroll+offset);}else if(offset>=elementHeight){this.element.scrollTop(scroll+offset-elementHeight+item.height());}}
this.active=item.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end();this._trigger("focus",event,{item:item});},deactivate:function(){if(!this.active){return;}
this.active.children("a").removeClass("ui-state-hover").removeAttr("id");this._trigger("blur");this.active=null;},next:function(event){this.move("next",".ui-menu-item:first",event);},previous:function(event){this.move("prev",".ui-menu-item:last",event);},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length;},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length;},move:function(direction,edge,event){if(!this.active){this.activate(event,this.element.children(edge));return;}
var next=this.active[direction+"All"](".ui-menu-item").eq(0);if(next.length){this.activate(event,next);}else{this.activate(event,this.element.children(edge));}},nextPage:function(event){if(this.hasScroll()){if(!this.active||this.last()){this.activate(event,this.element.children(".ui-menu-item:first"));return;}
var base=this.active.offset().top,height=this.element.height(),result=this.element.children(".ui-menu-item").filter(function(){var close=$(this).offset().top-base-height+$(this).height();return close<10&&close>-10;});if(!result.length){result=this.element.children(".ui-menu-item:last");}
this.activate(event,result);}else{this.activate(event,this.element.children(".ui-menu-item").filter(!this.active||this.last()?":first":":last"));}},previousPage:function(event){if(this.hasScroll()){if(!this.active||this.first()){this.activate(event,this.element.children(".ui-menu-item:last"));return;}
var base=this.active.offset().top,height=this.element.height();result=this.element.children(".ui-menu-item").filter(function(){var close=$(this).offset().top-base+height-$(this).height();return close<10&&close>-10;});if(!result.length){result=this.element.children(".ui-menu-item:first");}
this.activate(event,result);}else{this.activate(event,this.element.children(".ui-menu-item").filter(!this.active||this.first()?":last":":first"));}},hasScroll:function(){return this.element.height()<this.element[$.fn.prop?"prop":"attr"]("scrollHeight");},select:function(event){this._trigger("selected",event,{item:this.active});}});}(jQuery));(function($,undefined){var lastActive,startXPos,startYPos,clickDragged,baseClasses="ui-button ui-widget ui-state-default ui-corner-all",stateClasses="ui-state-hover ui-state-active ",typeClasses="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",formResetHandler=function(){var buttons=$(this).find(":ui-button");setTimeout(function(){buttons.button("refresh");},1);},radioGroup=function(radio){var name=radio.name,form=radio.form,radios=$([]);if(name){if(form){radios=$(form).find("[name='"+name+"']");}else{radios=$("[name='"+name+"']",radio.ownerDocument).filter(function(){return!this.form;});}}
return radios;};$.widget("ui.button",{options:{disabled:null,text:true,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset.button").bind("reset.button",formResetHandler);if(typeof this.options.disabled!=="boolean"){this.options.disabled=this.element.attr("disabled");}
this._determineButtonType();this.hasTitle=!!this.buttonElement.attr("title");var self=this,options=this.options,toggleButton=this.type==="checkbox"||this.type==="radio",hoverClass="ui-state-hover"+(!toggleButton?" ui-state-active":""),focusClass="ui-state-focus";if(options.label===null){options.label=this.buttonElement.html();}
if(this.element.is(":disabled")){options.disabled=true;}
this.buttonElement.addClass(baseClasses).attr("role","button").bind("mouseenter.button",function(){if(options.disabled){return;}
$(this).addClass("ui-state-hover");if(this===lastActive){$(this).addClass("ui-state-active");}}).bind("mouseleave.button",function(){if(options.disabled){return;}
$(this).removeClass(hoverClass);}).bind("click.button",function(event){if(options.disabled){event.preventDefault();event.stopImmediatePropagation();}});this.element.bind("focus.button",function(){self.buttonElement.addClass(focusClass);}).bind("blur.button",function(){self.buttonElement.removeClass(focusClass);});if(toggleButton){this.element.bind("change.button",function(){if(clickDragged){return;}
self.refresh();});this.buttonElement.bind("mousedown.button",function(event){if(options.disabled){return;}
clickDragged=false;startXPos=event.pageX;startYPos=event.pageY;}).bind("mouseup.button",function(event){if(options.disabled){return;}
if(startXPos!==event.pageX||startYPos!==event.pageY){clickDragged=true;}});}
if(this.type==="checkbox"){this.buttonElement.bind("click.button",function(){if(options.disabled||clickDragged){return false;}
$(this).toggleClass("ui-state-active");self.buttonElement.attr("aria-pressed",self.element[0].checked);});}else if(this.type==="radio"){this.buttonElement.bind("click.button",function(){if(options.disabled||clickDragged){return false;}
$(this).addClass("ui-state-active");self.buttonElement.attr("aria-pressed",true);var radio=self.element[0];radioGroup(radio).not(radio).map(function(){return $(this).button("widget")[0];}).removeClass("ui-state-active").attr("aria-pressed",false);});}else{this.buttonElement.bind("mousedown.button",function(){if(options.disabled){return false;}
$(this).addClass("ui-state-active");lastActive=this;$(document).one("mouseup",function(){lastActive=null;});}).bind("mouseup.button",function(){if(options.disabled){return false;}
$(this).removeClass("ui-state-active");}).bind("keydown.button",function(event){if(options.disabled){return false;}
if(event.keyCode==$.ui.keyCode.SPACE||event.keyCode==$.ui.keyCode.ENTER){$(this).addClass("ui-state-active");}}).bind("keyup.button",function(){$(this).removeClass("ui-state-active");});if(this.buttonElement.is("a")){this.buttonElement.keyup(function(event){if(event.keyCode===$.ui.keyCode.SPACE){$(this).click();}});}}
this._setOption("disabled",options.disabled);this._resetButton();},_determineButtonType:function(){if(this.element.is(":checkbox")){this.type="checkbox";}else if(this.element.is(":radio")){this.type="radio";}else if(this.element.is("input")){this.type="input";}else{this.type="button";}
if(this.type==="checkbox"||this.type==="radio"){var ancestor=this.element.parents().filter(":last"),labelSelector="label[for="+this.element.attr("id")+"]";this.buttonElement=ancestor.find(labelSelector);if(!this.buttonElement.length){ancestor=ancestor.length?ancestor.siblings():this.element.siblings();this.buttonElement=ancestor.filter(labelSelector);if(!this.buttonElement.length){this.buttonElement=ancestor.find(labelSelector);}}
this.element.addClass("ui-helper-hidden-accessible");var checked=this.element.is(":checked");if(checked){this.buttonElement.addClass("ui-state-active");}
this.buttonElement.attr("aria-pressed",checked);}else{this.buttonElement=this.element;}},widget:function(){return this.buttonElement;},destroy:function(){this.element.removeClass("ui-helper-hidden-accessible");this.buttonElement.removeClass(baseClasses+" "+stateClasses+" "+typeClasses).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html());if(!this.hasTitle){this.buttonElement.removeAttr("title");}
$.Widget.prototype.destroy.call(this);},_setOption:function(key,value){$.Widget.prototype._setOption.apply(this,arguments);if(key==="disabled"){if(value){this.element.attr("disabled",true);}else{this.element.removeAttr("disabled");}
return;}
this._resetButton();},refresh:function(){var isDisabled=this.element.is(":disabled");if(isDisabled!==this.options.disabled){this._setOption("disabled",isDisabled);}
if(this.type==="radio"){radioGroup(this.element[0]).each(function(){if($(this).is(":checked")){$(this).button("widget").addClass("ui-state-active").attr("aria-pressed",true);}else{$(this).button("widget").removeClass("ui-state-active").attr("aria-pressed",false);}});}else if(this.type==="checkbox"){if(this.element.is(":checked")){this.buttonElement.addClass("ui-state-active").attr("aria-pressed",true);}else{this.buttonElement.removeClass("ui-state-active").attr("aria-pressed",false);}}},_resetButton:function(){if(this.type==="input"){if(this.options.label){this.element.val(this.options.label);}
return;}
var buttonElement=this.buttonElement.removeClass(typeClasses),buttonText=$("<span></span>").addClass("ui-button-text").html(this.options.label).appendTo(buttonElement.empty()).text(),icons=this.options.icons,multipleIcons=icons.primary&&icons.secondary,buttonClasses=[];if(icons.primary||icons.secondary){if(this.options.text){buttonClasses.push("ui-button-text-icon"+(multipleIcons?"s":(icons.primary?"-primary":"-secondary")));}
if(icons.primary){buttonElement.prepend("<span class='ui-button-icon-primary ui-icon "+icons.primary+"'></span>");}
if(icons.secondary){buttonElement.append("<span class='ui-button-icon-secondary ui-icon "+icons.secondary+"'></span>");}
if(!this.options.text){buttonClasses.push(multipleIcons?"ui-button-icons-only":"ui-button-icon-only");if(!this.hasTitle){buttonElement.attr("title",buttonText);}}}else{buttonClasses.push("ui-button-text-only");}
buttonElement.addClass(buttonClasses.join(" "));}});$.widget("ui.buttonset",{options:{items:":button, :submit, :reset, :checkbox, :radio, a, :data(button)"},_create:function(){this.element.addClass("ui-buttonset");},_init:function(){this.refresh();},_setOption:function(key,value){if(key==="disabled"){this.buttons.button("option",key,value);}
$.Widget.prototype._setOption.apply(this,arguments);},refresh:function(){var ltr=this.element.css("direction")==="ltr";this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return $(this).button("widget")[0];}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(ltr?"ui-corner-left":"ui-corner-right").end().filter(":last").addClass(ltr?"ui-corner-right":"ui-corner-left").end().end();},destroy:function(){this.element.removeClass("ui-buttonset");this.buttons.map(function(){return $(this).button("widget")[0];}).removeClass("ui-corner-left ui-corner-right").end().button("destroy");$.Widget.prototype.destroy.call(this);}});}(jQuery));(function($,undefined){var uiDialogClasses='ui-dialog '+'ui-widget '+'ui-widget-content '+'ui-corner-all ',sizeRelatedOptions={buttons:true,height:true,maxHeight:true,maxWidth:true,minHeight:true,minWidth:true,width:true},resizableRelatedOptions={maxHeight:true,maxWidth:true,minHeight:true,minWidth:true},attrFn=$.attrFn||{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true,click:true};$.widget("ui.dialog",{options:{autoOpen:true,buttons:{},closeOnEscape:true,closeText:'close',dialogClass:'',draggable:true,hide:null,height:'auto',maxHeight:false,maxWidth:false,minHeight:150,minWidth:150,modal:false,position:{my:'center',at:'center',collision:'fit',using:function(pos){var topOffset=$(this).css(pos).offset().top;if(topOffset<0){$(this).css('top',pos.top-topOffset);}}},resizable:true,show:null,stack:true,title:'',width:300,zIndex:1000},_create:function(){this.originalTitle=this.element.attr('title');if(typeof this.originalTitle!=="string"){this.originalTitle="";}
this.options.title=this.options.title||this.originalTitle;var self=this,options=self.options,title=options.title||'&#160;',titleId=$.ui.dialog.getTitleId(self.element),uiDialog=(self.uiDialog=$('<div></div>')).appendTo(document.body).hide().addClass(uiDialogClasses+options.dialogClass).css({zIndex:options.zIndex}).attr('tabIndex',-1).css('outline',0).keydown(function(event){if(options.closeOnEscape&&event.keyCode&&event.keyCode===$.ui.keyCode.ESCAPE){self.close(event);event.preventDefault();}}).attr({role:'dialog','aria-labelledby':titleId}).mousedown(function(event){self.moveToTop(false,event);}),uiDialogContent=self.element.show().removeAttr('title').addClass('ui-dialog-content '+'ui-widget-content').appendTo(uiDialog),uiDialogTitlebar=(self.uiDialogTitlebar=$('<div></div>')).addClass('ui-dialog-titlebar '+'ui-widget-header '+'ui-corner-all '+'ui-helper-clearfix').prependTo(uiDialog),uiDialogTitlebarClose=$('<a href="#"></a>').addClass('ui-dialog-titlebar-close '+'ui-corner-all').attr('role','button').hover(function(){uiDialogTitlebarClose.addClass('ui-state-hover');},function(){uiDialogTitlebarClose.removeClass('ui-state-hover');}).focus(function(){uiDialogTitlebarClose.addClass('ui-state-focus');}).blur(function(){uiDialogTitlebarClose.removeClass('ui-state-focus');}).click(function(event){self.close(event);return false;}).appendTo(uiDialogTitlebar),uiDialogTitlebarCloseText=(self.uiDialogTitlebarCloseText=$('<span></span>')).addClass('ui-icon '+'ui-icon-closethick').text(options.closeText).appendTo(uiDialogTitlebarClose),uiDialogTitle=$('<span></span>').addClass('ui-dialog-title').attr('id',titleId).html(title).prependTo(uiDialogTitlebar);if($.isFunction(options.beforeclose)&&!$.isFunction(options.beforeClose)){options.beforeClose=options.beforeclose;}
uiDialogTitlebar.find("*").add(uiDialogTitlebar).disableSelection();if(options.draggable&&$.fn.draggable){self._makeDraggable();}
if(options.resizable&&$.fn.resizable){self._makeResizable();}
self._createButtons(options.buttons);self._isOpen=false;if($.fn.bgiframe){uiDialog.bgiframe();}},_init:function(){if(this.options.autoOpen){this.open();}},destroy:function(){var self=this;if(self.overlay){self.overlay.destroy();}
self.uiDialog.hide();self.element.unbind('.dialog').removeData('dialog').removeClass('ui-dialog-content ui-widget-content').hide().appendTo('body');self.uiDialog.remove();if(self.originalTitle){self.element.attr('title',self.originalTitle);}
return self;},widget:function(){return this.uiDialog;},close:function(event){var self=this,maxZ,thisZ;if(false===self._trigger('beforeClose',event)){return;}
if(self.overlay){self.overlay.destroy();}
self.uiDialog.unbind('keypress.ui-dialog');self._isOpen=false;if(self.options.hide){self.uiDialog.hide(self.options.hide,function(){self._trigger('close',event);});}else{self.uiDialog.hide();self._trigger('close',event);}
$.ui.dialog.overlay.resize();if(self.options.modal){maxZ=0;$('.ui-dialog').each(function(){if(this!==self.uiDialog[0]){thisZ=$(this).css('z-index');if(!isNaN(thisZ)){maxZ=Math.max(maxZ,thisZ);}}});$.ui.dialog.maxZ=maxZ;}
return self;},isOpen:function(){return this._isOpen;},moveToTop:function(force,event){var self=this,options=self.options,saveScroll;if((options.modal&&!force)||(!options.stack&&!options.modal)){return self._trigger('focus',event);}
if(options.zIndex>$.ui.dialog.maxZ){$.ui.dialog.maxZ=options.zIndex;}
if(self.overlay){$.ui.dialog.maxZ+=1;self.overlay.$el.css('z-index',$.ui.dialog.overlay.maxZ=$.ui.dialog.maxZ);}
saveScroll={scrollTop:self.element.attr('scrollTop'),scrollLeft:self.element.attr('scrollLeft')};$.ui.dialog.maxZ+=1;self.uiDialog.css('z-index',$.ui.dialog.maxZ);self.element.attr(saveScroll);self._trigger('focus',event);return self;},open:function(){if(this._isOpen){return;}
var self=this,options=self.options,uiDialog=self.uiDialog;self.overlay=options.modal?new $.ui.dialog.overlay(self):null;self._size();self._position(options.position);uiDialog.show(options.show);self.moveToTop(true);if(options.modal){uiDialog.bind('keypress.ui-dialog',function(event){if(event.keyCode!==$.ui.keyCode.TAB){return;}
var tabbables=$(':tabbable',this),first=tabbables.filter(':first'),last=tabbables.filter(':last');if(event.target===last[0]&&!event.shiftKey){first.focus(1);return false;}else if(event.target===first[0]&&event.shiftKey){last.focus(1);return false;}});}
$(self.element.find(':tabbable').get().concat(uiDialog.find('.ui-dialog-buttonpane :tabbable').get().concat(uiDialog.get()))).eq(0).focus();self._isOpen=true;self._trigger('open');return self;},_createButtons:function(buttons){var self=this,hasButtons=false,uiDialogButtonPane=$('<div></div>').addClass('ui-dialog-buttonpane '+'ui-widget-content '+'ui-helper-clearfix'),uiButtonSet=$("<div></div>").addClass("ui-dialog-buttonset").appendTo(uiDialogButtonPane);self.uiDialog.find('.ui-dialog-buttonpane').remove();if(typeof buttons==='object'&&buttons!==null){$.each(buttons,function(){return!(hasButtons=true);});}
if(hasButtons){$.each(buttons,function(name,props){props=$.isFunction(props)?{click:props,text:name}:props;var button=$('<button type="button"></button>').click(function(){props.click.apply(self.element[0],arguments);}).appendTo(uiButtonSet);$.each(props,function(key,value){if(key==="click"){return;}
if(key in attrFn){button[key](value);}else{button.attr(key,value);}});if($.fn.button){button.button();}});uiDialogButtonPane.appendTo(self.uiDialog);}},_makeDraggable:function(){var self=this,options=self.options,doc=$(document),heightBeforeDrag;function filteredUi(ui){return{position:ui.position,offset:ui.offset};}
self.uiDialog.draggable({cancel:'.ui-dialog-content, .ui-dialog-titlebar-close',handle:'.ui-dialog-titlebar',containment:'document',start:function(event,ui){heightBeforeDrag=options.height==="auto"?"auto":$(this).height();$(this).height($(this).height()).addClass("ui-dialog-dragging");self._trigger('dragStart',event,filteredUi(ui));},drag:function(event,ui){self._trigger('drag',event,filteredUi(ui));},stop:function(event,ui){options.position=[ui.position.left-doc.scrollLeft(),ui.position.top-doc.scrollTop()];$(this).removeClass("ui-dialog-dragging").height(heightBeforeDrag);self._trigger('dragStop',event,filteredUi(ui));$.ui.dialog.overlay.resize();}});},_makeResizable:function(handles){handles=(handles===undefined?this.options.resizable:handles);var self=this,options=self.options,position=self.uiDialog.css('position'),resizeHandles=(typeof handles==='string'?handles:'n,e,s,w,se,sw,ne,nw');function filteredUi(ui){return{originalPosition:ui.originalPosition,originalSize:ui.originalSize,position:ui.position,size:ui.size};}
self.uiDialog.resizable({cancel:'.ui-dialog-content',containment:'document',alsoResize:self.element,maxWidth:options.maxWidth,maxHeight:options.maxHeight,minWidth:options.minWidth,minHeight:self._minHeight(),handles:resizeHandles,start:function(event,ui){$(this).addClass("ui-dialog-resizing");self._trigger('resizeStart',event,filteredUi(ui));},resize:function(event,ui){self._trigger('resize',event,filteredUi(ui));},stop:function(event,ui){$(this).removeClass("ui-dialog-resizing");options.height=$(this).height();options.width=$(this).width();self._trigger('resizeStop',event,filteredUi(ui));$.ui.dialog.overlay.resize();}}).css('position',position).find('.ui-resizable-se').addClass('ui-icon ui-icon-grip-diagonal-se');},_minHeight:function(){var options=this.options;if(options.height==='auto'){return options.minHeight;}else{return Math.min(options.minHeight,options.height);}},_position:function(position){var myAt=[],offset=[0,0],isVisible;if(position){if(typeof position==='string'||(typeof position==='object'&&'0'in position)){myAt=position.split?position.split(' '):[position[0],position[1]];if(myAt.length===1){myAt[1]=myAt[0];}
$.each(['left','top'],function(i,offsetPosition){if(+myAt[i]===myAt[i]){offset[i]=myAt[i];myAt[i]=offsetPosition;}});position={my:myAt.join(" "),at:myAt.join(" "),offset:offset.join(" ")};}
position=$.extend({},$.ui.dialog.prototype.options.position,position);}else{position=$.ui.dialog.prototype.options.position;}
isVisible=this.uiDialog.is(':visible');if(!isVisible){this.uiDialog.show();}
this.uiDialog.css({top:0,left:0}).position($.extend({of:window},position));if(!isVisible){this.uiDialog.hide();}},_setOptions:function(options){var self=this,resizableOptions={},resize=false;$.each(options,function(key,value){self._setOption(key,value);if(key in sizeRelatedOptions){resize=true;}
if(key in resizableRelatedOptions){resizableOptions[key]=value;}});if(resize){this._size();}
if(this.uiDialog.is(":data(resizable)")){this.uiDialog.resizable("option",resizableOptions);}},_setOption:function(key,value){var self=this,uiDialog=self.uiDialog;switch(key){case"beforeclose":key="beforeClose";break;case"buttons":self._createButtons(value);break;case"closeText":self.uiDialogTitlebarCloseText.text(""+value);break;case"dialogClass":uiDialog.removeClass(self.options.dialogClass).addClass(uiDialogClasses+value);break;case"disabled":if(value){uiDialog.addClass('ui-dialog-disabled');}else{uiDialog.removeClass('ui-dialog-disabled');}
break;case"draggable":var isDraggable=uiDialog.is(":data(draggable)");if(isDraggable&&!value){uiDialog.draggable("destroy");}
if(!isDraggable&&value){self._makeDraggable();}
break;case"position":self._position(value);break;case"resizable":var isResizable=uiDialog.is(":data(resizable)");if(isResizable&&!value){uiDialog.resizable('destroy');}
if(isResizable&&typeof value==='string'){uiDialog.resizable('option','handles',value);}
if(!isResizable&&value!==false){self._makeResizable(value);}
break;case"title":$(".ui-dialog-title",self.uiDialogTitlebar).html(""+(value||'&#160;'));break;}
$.Widget.prototype._setOption.apply(self,arguments);},_size:function(){var options=this.options,nonContentHeight,minContentHeight,isVisible=this.uiDialog.is(":visible");this.element.show().css({width:'auto',minHeight:0,height:0});if(options.minWidth>options.width){options.width=options.minWidth;}
nonContentHeight=this.uiDialog.css({height:'auto',width:options.width}).height();minContentHeight=Math.max(0,options.minHeight-nonContentHeight);if(options.height==="auto"){if($.support.minHeight){this.element.css({minHeight:minContentHeight,height:"auto"});}else{this.uiDialog.show();var autoHeight=this.element.css("height","auto").height();if(!isVisible){this.uiDialog.hide();}
this.element.height(Math.max(autoHeight,minContentHeight));}}else{this.element.height(Math.max(options.height-nonContentHeight,0));}
if(this.uiDialog.is(':data(resizable)')){this.uiDialog.resizable('option','minHeight',this._minHeight());}}});$.extend($.ui.dialog,{version:"1.8.14",uuid:0,maxZ:0,getTitleId:function($el){var id=$el.attr('id');if(!id){this.uuid+=1;id=this.uuid;}
return'ui-dialog-title-'+id;},overlay:function(dialog){this.$el=$.ui.dialog.overlay.create(dialog);}});$.extend($.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:$.map('focus,mousedown,mouseup,keydown,keypress,click'.split(','),function(event){return event+'.dialog-overlay';}).join(' '),create:function(dialog){if(this.instances.length===0){setTimeout(function(){if($.ui.dialog.overlay.instances.length){$(document).bind($.ui.dialog.overlay.events,function(event){if($(event.target).zIndex()<$.ui.dialog.overlay.maxZ){return false;}});}},1);$(document).bind('keydown.dialog-overlay',function(event){if(dialog.options.closeOnEscape&&event.keyCode&&event.keyCode===$.ui.keyCode.ESCAPE){dialog.close(event);event.preventDefault();}});$(window).bind('resize.dialog-overlay',$.ui.dialog.overlay.resize);}
var $el=(this.oldInstances.pop()||$('<div></div>').addClass('ui-widget-overlay')).appendTo(document.body).css({width:this.width(),height:this.height()});if($.fn.bgiframe){$el.bgiframe();}
this.instances.push($el);return $el;},destroy:function($el){var indexOf=$.inArray($el,this.instances);if(indexOf!=-1){this.oldInstances.push(this.instances.splice(indexOf,1)[0]);}
if(this.instances.length===0){$([document,window]).unbind('.dialog-overlay');}
$el.remove();var maxZ=0;$.each(this.instances,function(){maxZ=Math.max(maxZ,this.css('z-index'));});this.maxZ=maxZ;},height:function(){var scrollHeight,offsetHeight;if($.browser.msie&&$.browser.version<7){scrollHeight=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);offsetHeight=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);if(scrollHeight<offsetHeight){return $(window).height()+'px';}else{return scrollHeight+'px';}}else{return $(document).height()+'px';}},width:function(){var scrollWidth,offsetWidth;if($.browser.msie){scrollWidth=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);offsetWidth=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);if(scrollWidth<offsetWidth){return $(window).width()+'px';}else{return scrollWidth+'px';}}else{return $(document).width()+'px';}},resize:function(){var $overlays=$([]);$.each($.ui.dialog.overlay.instances,function(){$overlays=$overlays.add(this);});$overlays.css({width:0,height:0}).css({width:$.ui.dialog.overlay.width(),height:$.ui.dialog.overlay.height()});}});$.extend($.ui.dialog.overlay.prototype,{destroy:function(){$.ui.dialog.overlay.destroy(this.$el);}});}(jQuery));(function($,undefined){var numPages=5;$.widget("ui.slider",$.ui.mouse,{widgetEventPrefix:"slide",options:{animate:false,distance:0,max:100,min:0,orientation:"horizontal",range:false,step:1,value:0,values:null},_create:function(){var self=this,o=this.options,existingHandles=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),handle="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",handleCount=(o.values&&o.values.length)||1,handles=[];this._keySliding=false;this._mouseSliding=false;this._animateOff=true;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider"+" ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"+
(o.disabled?" ui-slider-disabled ui-disabled":""));this.range=$([]);if(o.range){if(o.range===true){if(!o.values){o.values=[this._valueMin(),this._valueMin()];}
if(o.values.length&&o.values.length!==2){o.values=[o.values[0],o.values[0]];}}
this.range=$("<div></div>").appendTo(this.element).addClass("ui-slider-range"+" ui-widget-header"+
((o.range==="min"||o.range==="max")?" ui-slider-range-"+o.range:""));}
for(var i=existingHandles.length;i<handleCount;i+=1){handles.push(handle);}
this.handles=existingHandles.add($(handles.join("")).appendTo(self.element));this.handle=this.handles.eq(0);this.handles.add(this.range).filter("a").click(function(event){event.preventDefault();}).hover(function(){if(!o.disabled){$(this).addClass("ui-state-hover");}},function(){$(this).removeClass("ui-state-hover");}).focus(function(){if(!o.disabled){$(".ui-slider .ui-state-focus").removeClass("ui-state-focus");$(this).addClass("ui-state-focus");}else{$(this).blur();}}).blur(function(){$(this).removeClass("ui-state-focus");});this.handles.each(function(i){$(this).data("index.ui-slider-handle",i);});this.handles.keydown(function(event){var ret=true,index=$(this).data("index.ui-slider-handle"),allowed,curVal,newVal,step;if(self.options.disabled){return;}
switch(event.keyCode){case $.ui.keyCode.HOME:case $.ui.keyCode.END:case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.PAGE_DOWN:case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:ret=false;if(!self._keySliding){self._keySliding=true;$(this).addClass("ui-state-active");allowed=self._start(event,index);if(allowed===false){return;}}
break;}
step=self.options.step;if(self.options.values&&self.options.values.length){curVal=newVal=self.values(index);}else{curVal=newVal=self.value();}
switch(event.keyCode){case $.ui.keyCode.HOME:newVal=self._valueMin();break;case $.ui.keyCode.END:newVal=self._valueMax();break;case $.ui.keyCode.PAGE_UP:newVal=self._trimAlignValue(curVal+((self._valueMax()-self._valueMin())/numPages));break;case $.ui.keyCode.PAGE_DOWN:newVal=self._trimAlignValue(curVal-((self._valueMax()-self._valueMin())/numPages));break;case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:if(curVal===self._valueMax()){return;}
newVal=self._trimAlignValue(curVal+step);break;case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:if(curVal===self._valueMin()){return;}
newVal=self._trimAlignValue(curVal-step);break;}
self._slide(event,index,newVal);return ret;}).keyup(function(event){var index=$(this).data("index.ui-slider-handle");if(self._keySliding){self._keySliding=false;self._stop(event,index);self._change(event,index);$(this).removeClass("ui-state-active");}});this._refreshValue();this._animateOff=false;},destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider"+" ui-slider-horizontal"+" ui-slider-vertical"+" ui-slider-disabled"+" ui-widget"+" ui-widget-content"+" ui-corner-all").removeData("slider").unbind(".slider");this._mouseDestroy();return this;},_mouseCapture:function(event){var o=this.options,position,normValue,distance,closestHandle,self,index,allowed,offset,mouseOverHandle;if(o.disabled){return false;}
this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();position={x:event.pageX,y:event.pageY};normValue=this._normValueFromMouse(position);distance=this._valueMax()-this._valueMin()+1;self=this;this.handles.each(function(i){var thisDistance=Math.abs(normValue-self.values(i));if(distance>thisDistance){distance=thisDistance;closestHandle=$(this);index=i;}});if(o.range===true&&this.values(1)===o.min){index+=1;closestHandle=$(this.handles[index]);}
allowed=this._start(event,index);if(allowed===false){return false;}
this._mouseSliding=true;self._handleIndex=index;closestHandle.addClass("ui-state-active").focus();offset=closestHandle.offset();mouseOverHandle=!$(event.target).parents().andSelf().is(".ui-slider-handle");this._clickOffset=mouseOverHandle?{left:0,top:0}:{left:event.pageX-offset.left-(closestHandle.width()/2),top:event.pageY-offset.top-
(closestHandle.height()/2)-
(parseInt(closestHandle.css("borderTopWidth"),10)||0)-
(parseInt(closestHandle.css("borderBottomWidth"),10)||0)+
(parseInt(closestHandle.css("marginTop"),10)||0)};if(!this.handles.hasClass("ui-state-hover")){this._slide(event,index,normValue);}
this._animateOff=true;return true;},_mouseStart:function(event){return true;},_mouseDrag:function(event){var position={x:event.pageX,y:event.pageY},normValue=this._normValueFromMouse(position);this._slide(event,this._handleIndex,normValue);return false;},_mouseStop:function(event){this.handles.removeClass("ui-state-active");this._mouseSliding=false;this._stop(event,this._handleIndex);this._change(event,this._handleIndex);this._handleIndex=null;this._clickOffset=null;this._animateOff=false;return false;},_detectOrientation:function(){this.orientation=(this.options.orientation==="vertical")?"vertical":"horizontal";},_normValueFromMouse:function(position){var pixelTotal,pixelMouse,percentMouse,valueTotal,valueMouse;if(this.orientation==="horizontal"){pixelTotal=this.elementSize.width;pixelMouse=position.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0);}else{pixelTotal=this.elementSize.height;pixelMouse=position.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0);}
percentMouse=(pixelMouse/pixelTotal);if(percentMouse>1){percentMouse=1;}
if(percentMouse<0){percentMouse=0;}
if(this.orientation==="vertical"){percentMouse=1-percentMouse;}
valueTotal=this._valueMax()-this._valueMin();valueMouse=this._valueMin()+percentMouse*valueTotal;return this._trimAlignValue(valueMouse);},_start:function(event,index){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values();}
return this._trigger("start",event,uiHash);},_slide:function(event,index,newVal){var otherVal,newValues,allowed;if(this.options.values&&this.options.values.length){otherVal=this.values(index?0:1);if((this.options.values.length===2&&this.options.range===true)&&((index===0&&newVal>otherVal)||(index===1&&newVal<otherVal))){newVal=otherVal;}
if(newVal!==this.values(index)){newValues=this.values();newValues[index]=newVal;allowed=this._trigger("slide",event,{handle:this.handles[index],value:newVal,values:newValues});otherVal=this.values(index?0:1);if(allowed!==false){this.values(index,newVal,true);}}}else{if(newVal!==this.value()){allowed=this._trigger("slide",event,{handle:this.handles[index],value:newVal});if(allowed!==false){this.value(newVal);}}}},_stop:function(event,index){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values();}
this._trigger("stop",event,uiHash);},_change:function(event,index){if(!this._keySliding&&!this._mouseSliding){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values();}
this._trigger("change",event,uiHash);}},value:function(newValue){if(arguments.length){this.options.value=this._trimAlignValue(newValue);this._refreshValue();this._change(null,0);return;}
return this._value();},values:function(index,newValue){var vals,newValues,i;if(arguments.length>1){this.options.values[index]=this._trimAlignValue(newValue);this._refreshValue();this._change(null,index);return;}
if(arguments.length){if($.isArray(arguments[0])){vals=this.options.values;newValues=arguments[0];for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(newValues[i]);this._change(null,i);}
this._refreshValue();}else{if(this.options.values&&this.options.values.length){return this._values(index);}else{return this.value();}}}else{return this._values();}},_setOption:function(key,value){var i,valsLength=0;if($.isArray(this.options.values)){valsLength=this.options.values.length;}
$.Widget.prototype._setOption.apply(this,arguments);switch(key){case"disabled":if(value){this.handles.filter(".ui-state-focus").blur();this.handles.removeClass("ui-state-hover");this.handles.attr("disabled","disabled");this.element.addClass("ui-disabled");}else{this.handles.removeAttr("disabled");this.element.removeClass("ui-disabled");}
break;case"orientation":this._detectOrientation();this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();break;case"value":this._animateOff=true;this._refreshValue();this._change(null,0);this._animateOff=false;break;case"values":this._animateOff=true;this._refreshValue();for(i=0;i<valsLength;i+=1){this._change(null,i);}
this._animateOff=false;break;}},_value:function(){var val=this.options.value;val=this._trimAlignValue(val);return val;},_values:function(index){var val,vals,i;if(arguments.length){val=this.options.values[index];val=this._trimAlignValue(val);return val;}else{vals=this.options.values.slice();for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(vals[i]);}
return vals;}},_trimAlignValue:function(val){if(val<=this._valueMin()){return this._valueMin();}
if(val>=this._valueMax()){return this._valueMax();}
var step=(this.options.step>0)?this.options.step:1,valModStep=(val-this._valueMin())%step;alignValue=val-valModStep;if(Math.abs(valModStep)*2>=step){alignValue+=(valModStep>0)?step:(-step);}
return parseFloat(alignValue.toFixed(5));},_valueMin:function(){return this.options.min;},_valueMax:function(){return this.options.max;},_refreshValue:function(){var oRange=this.options.range,o=this.options,self=this,animate=(!this._animateOff)?o.animate:false,valPercent,_set={},lastValPercent,value,valueMin,valueMax;if(this.options.values&&this.options.values.length){this.handles.each(function(i,j){valPercent=(self.values(i)-self._valueMin())/(self._valueMax()-self._valueMin())*100;_set[self.orientation==="horizontal"?"left":"bottom"]=valPercent+"%";$(this).stop(1,1)[animate?"animate":"css"](_set,o.animate);if(self.options.range===true){if(self.orientation==="horizontal"){if(i===0){self.range.stop(1,1)[animate?"animate":"css"]({left:valPercent+"%"},o.animate);}
if(i===1){self.range[animate?"animate":"css"]({width:(valPercent-lastValPercent)+"%"},{queue:false,duration:o.animate});}}else{if(i===0){self.range.stop(1,1)[animate?"animate":"css"]({bottom:(valPercent)+"%"},o.animate);}
if(i===1){self.range[animate?"animate":"css"]({height:(valPercent-lastValPercent)+"%"},{queue:false,duration:o.animate});}}}
lastValPercent=valPercent;});}else{value=this.value();valueMin=this._valueMin();valueMax=this._valueMax();valPercent=(valueMax!==valueMin)?(value-valueMin)/(valueMax-valueMin)*100:0;_set[self.orientation==="horizontal"?"left":"bottom"]=valPercent+"%";this.handle.stop(1,1)[animate?"animate":"css"](_set,o.animate);if(oRange==="min"&&this.orientation==="horizontal"){this.range.stop(1,1)[animate?"animate":"css"]({width:valPercent+"%"},o.animate);}
if(oRange==="max"&&this.orientation==="horizontal"){this.range[animate?"animate":"css"]({width:(100-valPercent)+"%"},{queue:false,duration:o.animate});}
if(oRange==="min"&&this.orientation==="vertical"){this.range.stop(1,1)[animate?"animate":"css"]({height:valPercent+"%"},o.animate);}
if(oRange==="max"&&this.orientation==="vertical"){this.range[animate?"animate":"css"]({height:(100-valPercent)+"%"},{queue:false,duration:o.animate});}}}});$.extend($.ui.slider,{version:"1.8.14"});}(jQuery));(function($,undefined){var tabId=0,listId=0;function getNextTabId(){return++tabId;}
function getNextListId(){return++listId;}
$.widget("ui.tabs",{options:{add:null,ajaxOptions:null,cache:false,cookie:null,collapsible:false,disable:null,disabled:[],enable:null,event:"click",fx:null,idPrefix:"ui-tabs-",load:null,panelTemplate:"<div></div>",remove:null,select:null,show:null,spinner:"<em>Loading&#8230;</em>",tabTemplate:"<li><a href='#{href}'><span>#{label}</span></a></li>"},_create:function(){this._tabify(true);},_setOption:function(key,value){if(key=="selected"){if(this.options.collapsible&&value==this.options.selected){return;}
this.select(value);}else{this.options[key]=value;this._tabify();}},_tabId:function(a){return a.title&&a.title.replace(/\s/g,"_").replace(/[^\w\u00c0-\uFFFF-]/g,"")||this.options.idPrefix+getNextTabId();},_sanitizeSelector:function(hash){return hash.replace(/:/g,"\\:");},_cookie:function(){var cookie=this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+getNextListId());return $.cookie.apply(null,[cookie].concat($.makeArray(arguments)));},_ui:function(tab,panel){return{tab:tab,panel:panel,index:this.anchors.index(tab)};},_cleanup:function(){this.lis.filter(".ui-state-processing").removeClass("ui-state-processing").find("span:data(label.tabs)").each(function(){var el=$(this);el.html(el.data("label.tabs")).removeData("label.tabs");});},_tabify:function(init){var self=this,o=this.options,fragmentId=/^#.+/;this.list=this.element.find("ol,ul").eq(0);this.lis=$(" > li:has(a[href])",this.list);this.anchors=this.lis.map(function(){return $("a",this)[0];});this.panels=$([]);this.anchors.each(function(i,a){var href=$(a).attr("href");var hrefBase=href.split("#")[0],baseEl;if(hrefBase&&(hrefBase===location.toString().split("#")[0]||(baseEl=$("base")[0])&&hrefBase===baseEl.href)){href=a.hash;a.href=href;}
if(fragmentId.test(href)){self.panels=self.panels.add(self.element.find(self._sanitizeSelector(href)));}else if(href&&href!=="#"){$.data(a,"href.tabs",href);$.data(a,"load.tabs",href.replace(/#.*$/,""));var id=self._tabId(a);a.href="#"+id;var $panel=self.element.find("#"+id);if(!$panel.length){$panel=$(o.panelTemplate).attr("id",id).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").insertAfter(self.panels[i-1]||self.list);$panel.data("destroy.tabs",true);}
self.panels=self.panels.add($panel);}else{o.disabled.push(i);}});if(init){this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all");this.list.addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.lis.addClass("ui-state-default ui-corner-top");this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom");if(o.selected===undefined){if(location.hash){this.anchors.each(function(i,a){if(a.hash==location.hash){o.selected=i;return false;}});}
if(typeof o.selected!=="number"&&o.cookie){o.selected=parseInt(self._cookie(),10);}
if(typeof o.selected!=="number"&&this.lis.filter(".ui-tabs-selected").length){o.selected=this.lis.index(this.lis.filter(".ui-tabs-selected"));}
o.selected=o.selected||(this.lis.length?0:-1);}else if(o.selected===null){o.selected=-1;}
o.selected=((o.selected>=0&&this.anchors[o.selected])||o.selected<0)?o.selected:0;o.disabled=$.unique(o.disabled.concat($.map(this.lis.filter(".ui-state-disabled"),function(n,i){return self.lis.index(n);}))).sort();if($.inArray(o.selected,o.disabled)!=-1){o.disabled.splice($.inArray(o.selected,o.disabled),1);}
this.panels.addClass("ui-tabs-hide");this.lis.removeClass("ui-tabs-selected ui-state-active");if(o.selected>=0&&this.anchors.length){self.element.find(self._sanitizeSelector(self.anchors[o.selected].hash)).removeClass("ui-tabs-hide");this.lis.eq(o.selected).addClass("ui-tabs-selected ui-state-active");self.element.queue("tabs",function(){self._trigger("show",null,self._ui(self.anchors[o.selected],self.element.find(self._sanitizeSelector(self.anchors[o.selected].hash))[0]));});this.load(o.selected);}
$(window).bind("unload",function(){self.lis.add(self.anchors).unbind(".tabs");self.lis=self.anchors=self.panels=null;});}else{o.selected=this.lis.index(this.lis.filter(".ui-tabs-selected"));}
this.element[o.collapsible?"addClass":"removeClass"]("ui-tabs-collapsible");if(o.cookie){this._cookie(o.selected,o.cookie);}
for(var i=0,li;(li=this.lis[i]);i++){$(li)[$.inArray(i,o.disabled)!=-1&&!$(li).hasClass("ui-tabs-selected")?"addClass":"removeClass"]("ui-state-disabled");}
if(o.cache===false){this.anchors.removeData("cache.tabs");}
this.lis.add(this.anchors).unbind(".tabs");if(o.event!=="mouseover"){var addState=function(state,el){if(el.is(":not(.ui-state-disabled)")){el.addClass("ui-state-"+state);}};var removeState=function(state,el){el.removeClass("ui-state-"+state);};this.lis.bind("mouseover.tabs",function(){addState("hover",$(this));});this.lis.bind("mouseout.tabs",function(){removeState("hover",$(this));});this.anchors.bind("focus.tabs",function(){addState("focus",$(this).closest("li"));});this.anchors.bind("blur.tabs",function(){removeState("focus",$(this).closest("li"));});}
var hideFx,showFx;if(o.fx){if($.isArray(o.fx)){hideFx=o.fx[0];showFx=o.fx[1];}else{hideFx=showFx=o.fx;}}
function resetStyle($el,fx){$el.css("display","");if(!$.support.opacity&&fx.opacity){$el[0].style.removeAttribute("filter");}}
var showTab=showFx?function(clicked,$show){$(clicked).closest("li").addClass("ui-tabs-selected ui-state-active");$show.hide().removeClass("ui-tabs-hide").animate(showFx,showFx.duration||"normal",function(){resetStyle($show,showFx);self._trigger("show",null,self._ui(clicked,$show[0]));});}:function(clicked,$show){$(clicked).closest("li").addClass("ui-tabs-selected ui-state-active");$show.removeClass("ui-tabs-hide");self._trigger("show",null,self._ui(clicked,$show[0]));};var hideTab=hideFx?function(clicked,$hide){$hide.animate(hideFx,hideFx.duration||"normal",function(){self.lis.removeClass("ui-tabs-selected ui-state-active");$hide.addClass("ui-tabs-hide");resetStyle($hide,hideFx);self.element.dequeue("tabs");});}:function(clicked,$hide,$show){self.lis.removeClass("ui-tabs-selected ui-state-active");$hide.addClass("ui-tabs-hide");self.element.dequeue("tabs");};this.anchors.bind(o.event+".tabs",function(){var el=this,$li=$(el).closest("li"),$hide=self.panels.filter(":not(.ui-tabs-hide)"),$show=self.element.find(self._sanitizeSelector(el.hash));if(($li.hasClass("ui-tabs-selected")&&!o.collapsible)||$li.hasClass("ui-state-disabled")||$li.hasClass("ui-state-processing")||self.panels.filter(":animated").length||self._trigger("select",null,self._ui(this,$show[0]))===false){this.blur();return false;}
o.selected=self.anchors.index(this);self.abort();if(o.collapsible){if($li.hasClass("ui-tabs-selected")){o.selected=-1;if(o.cookie){self._cookie(o.selected,o.cookie);}
self.element.queue("tabs",function(){hideTab(el,$hide);}).dequeue("tabs");this.blur();return false;}else if(!$hide.length){if(o.cookie){self._cookie(o.selected,o.cookie);}
self.element.queue("tabs",function(){showTab(el,$show);});self.load(self.anchors.index(this));this.blur();return false;}}
if(o.cookie){self._cookie(o.selected,o.cookie);}
if($show.length){if($hide.length){self.element.queue("tabs",function(){hideTab(el,$hide);});}
self.element.queue("tabs",function(){showTab(el,$show);});self.load(self.anchors.index(this));}else{throw"jQuery UI Tabs: Mismatching fragment identifier.";}
if($.browser.msie){this.blur();}});this.anchors.bind("click.tabs",function(){return false;});},_getIndex:function(index){if(typeof index=="string"){index=this.anchors.index(this.anchors.filter("[href$="+index+"]"));}
return index;},destroy:function(){var o=this.options;this.abort();this.element.unbind(".tabs").removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible").removeData("tabs");this.list.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.anchors.each(function(){var href=$.data(this,"href.tabs");if(href){this.href=href;}
var $this=$(this).unbind(".tabs");$.each(["href","load","cache"],function(i,prefix){$this.removeData(prefix+".tabs");});});this.lis.unbind(".tabs").add(this.panels).each(function(){if($.data(this,"destroy.tabs")){$(this).remove();}else{$(this).removeClass(["ui-state-default","ui-corner-top","ui-tabs-selected","ui-state-active","ui-state-hover","ui-state-focus","ui-state-disabled","ui-tabs-panel","ui-widget-content","ui-corner-bottom","ui-tabs-hide"].join(" "));}});if(o.cookie){this._cookie(null,o.cookie);}
return this;},add:function(url,label,index){if(index===undefined){index=this.anchors.length;}
var self=this,o=this.options,$li=$(o.tabTemplate.replace(/#\{href\}/g,url).replace(/#\{label\}/g,label)),id=!url.indexOf("#")?url.replace("#",""):this._tabId($("a",$li)[0]);$li.addClass("ui-state-default ui-corner-top").data("destroy.tabs",true);var $panel=self.element.find("#"+id);if(!$panel.length){$panel=$(o.panelTemplate).attr("id",id).data("destroy.tabs",true);}
$panel.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide");if(index>=this.lis.length){$li.appendTo(this.list);$panel.appendTo(this.list[0].parentNode);}else{$li.insertBefore(this.lis[index]);$panel.insertBefore(this.panels[index]);}
o.disabled=$.map(o.disabled,function(n,i){return n>=index?++n:n;});this._tabify();if(this.anchors.length==1){o.selected=0;$li.addClass("ui-tabs-selected ui-state-active");$panel.removeClass("ui-tabs-hide");this.element.queue("tabs",function(){self._trigger("show",null,self._ui(self.anchors[0],self.panels[0]));});this.load(0);}
this._trigger("add",null,this._ui(this.anchors[index],this.panels[index]));return this;},remove:function(index){index=this._getIndex(index);var o=this.options,$li=this.lis.eq(index).remove(),$panel=this.panels.eq(index).remove();if($li.hasClass("ui-tabs-selected")&&this.anchors.length>1){this.select(index+(index+1<this.anchors.length?1:-1));}
o.disabled=$.map($.grep(o.disabled,function(n,i){return n!=index;}),function(n,i){return n>=index?--n:n;});this._tabify();this._trigger("remove",null,this._ui($li.find("a")[0],$panel[0]));return this;},enable:function(index){index=this._getIndex(index);var o=this.options;if($.inArray(index,o.disabled)==-1){return;}
this.lis.eq(index).removeClass("ui-state-disabled");o.disabled=$.grep(o.disabled,function(n,i){return n!=index;});this._trigger("enable",null,this._ui(this.anchors[index],this.panels[index]));return this;},disable:function(index){index=this._getIndex(index);var self=this,o=this.options;if(index!=o.selected){this.lis.eq(index).addClass("ui-state-disabled");o.disabled.push(index);o.disabled.sort();this._trigger("disable",null,this._ui(this.anchors[index],this.panels[index]));}
return this;},select:function(index){index=this._getIndex(index);if(index==-1){if(this.options.collapsible&&this.options.selected!=-1){index=this.options.selected;}else{return this;}}
this.anchors.eq(index).trigger(this.options.event+".tabs");return this;},load:function(index){index=this._getIndex(index);var self=this,o=this.options,a=this.anchors.eq(index)[0],url=$.data(a,"load.tabs");this.abort();if(!url||this.element.queue("tabs").length!==0&&$.data(a,"cache.tabs")){this.element.dequeue("tabs");return;}
this.lis.eq(index).addClass("ui-state-processing");if(o.spinner){var span=$("span",a);span.data("label.tabs",span.html()).html(o.spinner);}
this.xhr=$.ajax($.extend({},o.ajaxOptions,{url:url,success:function(r,s){self.element.find(self._sanitizeSelector(a.hash)).html(r);self._cleanup();if(o.cache){$.data(a,"cache.tabs",true);}
self._trigger("load",null,self._ui(self.anchors[index],self.panels[index]));try{o.ajaxOptions.success(r,s);}
catch(e){}},error:function(xhr,s,e){self._cleanup();self._trigger("load",null,self._ui(self.anchors[index],self.panels[index]));try{o.ajaxOptions.error(xhr,s,index,a);}
catch(e){}}}));self.element.dequeue("tabs");return this;},abort:function(){this.element.queue([]);this.panels.stop(false,true);this.element.queue("tabs",this.element.queue("tabs").splice(-2,2));if(this.xhr){this.xhr.abort();delete this.xhr;}
this._cleanup();return this;},url:function(index,url){this.anchors.eq(index).removeData("cache.tabs").data("load.tabs",url);return this;},length:function(){return this.anchors.length;}});$.extend($.ui.tabs,{version:"1.8.14"});$.extend($.ui.tabs.prototype,{rotation:null,rotate:function(ms,continuing){var self=this,o=this.options;var rotate=self._rotate||(self._rotate=function(e){clearTimeout(self.rotation);self.rotation=setTimeout(function(){var t=o.selected;self.select(++t<self.anchors.length?t:0);},ms);if(e){e.stopPropagation();}});var stop=self._unrotate||(self._unrotate=!continuing?function(e){if(e.clientX){self.rotate(null);}}:function(e){t=o.selected;rotate();});if(ms){this.element.bind("tabsshow",rotate);this.anchors.bind(o.event+".tabs",stop);rotate();}else{clearTimeout(self.rotation);this.element.unbind("tabsshow",rotate);this.anchors.unbind(o.event+".tabs",stop);delete this._rotate;delete this._unrotate;}
return this;}});})(jQuery);(function($,undefined){$.extend($.ui,{datepicker:{version:"1.8.14"}});var PROP_NAME='datepicker';var dpuuid=new Date().getTime();var instActive;function Datepicker(){this.debug=false;this._curInst=null;this._keyEvent=false;this._disabledInputs=[];this._datepickerShowing=false;this._inDialog=false;this._mainDivId='ui-datepicker-div';this._inlineClass='ui-datepicker-inline';this._appendClass='ui-datepicker-append';this._triggerClass='ui-datepicker-trigger';this._dialogClass='ui-datepicker-dialog';this._disableClass='ui-datepicker-disabled';this._unselectableClass='ui-datepicker-unselectable';this._currentClass='ui-datepicker-current-day';this._dayOverClass='ui-datepicker-days-cell-over';this.regional=[];this.regional['']={closeText:'Done',prevText:'Prev',nextText:'Next',currentText:'Today',monthNames:['January','February','March','April','May','June','July','August','September','October','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],dayNames:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],dayNamesShort:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],dayNamesMin:['Su','Mo','Tu','We','Th','Fr','Sa'],weekHeader:'Wk',dateFormat:'mm/dd/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};this._defaults={showOn:'focus',showAnim:'fadeIn',showOptions:{},defaultDate:null,appendText:'',buttonText:'...',buttonImage:'',buttonImageOnly:false,hideIfNoPrevNext:false,navigationAsDateFormat:false,gotoCurrent:false,changeMonth:false,changeYear:false,yearRange:'c-10:c+10',showOtherMonths:false,selectOtherMonths:false,showWeek:false,calculateWeek:this.iso8601Week,shortYearCutoff:'+10',minDate:null,maxDate:null,duration:'fast',beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:'',altFormat:'',constrainInput:true,showButtonPanel:false,autoSize:false};$.extend(this._defaults,this.regional['']);this.dpDiv=bindHover($('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'));}
$.extend(Datepicker.prototype,{markerClassName:'hasDatepicker',maxRows:4,log:function(){if(this.debug)
console.log.apply('',arguments);},_widgetDatepicker:function(){return this.dpDiv;},setDefaults:function(settings){extendRemove(this._defaults,settings||{});return this;},_attachDatepicker:function(target,settings){var inlineSettings=null;for(var attrName in this._defaults){var attrValue=target.getAttribute('date:'+attrName);if(attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue);}catch(err){inlineSettings[attrName]=attrValue;}}}
var nodeName=target.nodeName.toLowerCase();var inline=(nodeName=='div'||nodeName=='span');if(!target.id){this.uuid+=1;target.id='dp'+this.uuid;}
var inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{},inlineSettings||{});if(nodeName=='input'){this._connectDatepicker(target,inst);}else if(inline){this._inlineDatepicker(target,inst);}},_newInst:function(target,inline){var id=target[0].id.replace(/([^A-Za-z0-9_-])/g,'\\\\$1');return{id:id,input:target,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:inline,dpDiv:(!inline?this.dpDiv:bindHover($('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>')))};},_connectDatepicker:function(target,inst){var input=$(target);inst.append=$([]);inst.trigger=$([]);if(input.hasClass(this.markerClassName))
return;this._attachments(input,inst);input.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(event,key,value){inst.settings[key]=value;}).bind("getData.datepicker",function(event,key){return this._get(inst,key);});this._autoSize(inst);$.data(target,PROP_NAME,inst);},_attachments:function(input,inst){var appendText=this._get(inst,'appendText');var isRTL=this._get(inst,'isRTL');if(inst.append)
inst.append.remove();if(appendText){inst.append=$('<span class="'+this._appendClass+'">'+appendText+'</span>');input[isRTL?'before':'after'](inst.append);}
input.unbind('focus',this._showDatepicker);if(inst.trigger)
inst.trigger.remove();var showOn=this._get(inst,'showOn');if(showOn=='focus'||showOn=='both')
input.focus(this._showDatepicker);if(showOn=='button'||showOn=='both'){var buttonText=this._get(inst,'buttonText');var buttonImage=this._get(inst,'buttonImage');inst.trigger=$(this._get(inst,'buttonImageOnly')?$('<img/>').addClass(this._triggerClass).attr({src:buttonImage,alt:buttonText,title:buttonText}):$('<button type="button"></button>').addClass(this._triggerClass).html(buttonImage==''?buttonText:$('<img/>').attr({src:buttonImage,alt:buttonText,title:buttonText})));input[isRTL?'before':'after'](inst.trigger);inst.trigger.click(function(){if($.datepicker._datepickerShowing&&$.datepicker._lastInput==input[0])
$.datepicker._hideDatepicker();else
$.datepicker._showDatepicker(input[0]);return false;});}},_autoSize:function(inst){if(this._get(inst,'autoSize')&&!inst.inline){var date=new Date(2009,12-1,20);var dateFormat=this._get(inst,'dateFormat');if(dateFormat.match(/[DM]/)){var findMax=function(names){var max=0;var maxI=0;for(var i=0;i<names.length;i++){if(names[i].length>max){max=names[i].length;maxI=i;}}
return maxI;};date.setMonth(findMax(this._get(inst,(dateFormat.match(/MM/)?'monthNames':'monthNamesShort'))));date.setDate(findMax(this._get(inst,(dateFormat.match(/DD/)?'dayNames':'dayNamesShort')))+20-date.getDay());}
inst.input.attr('size',this._formatDate(inst,date).length);}},_inlineDatepicker:function(target,inst){var divSpan=$(target);if(divSpan.hasClass(this.markerClassName))
return;divSpan.addClass(this.markerClassName).append(inst.dpDiv).bind("setData.datepicker",function(event,key,value){inst.settings[key]=value;}).bind("getData.datepicker",function(event,key){return this._get(inst,key);});$.data(target,PROP_NAME,inst);this._setDate(inst,this._getDefaultDate(inst),true);this._updateDatepicker(inst);this._updateAlternate(inst);inst.dpDiv.show();},_dialogDatepicker:function(input,date,onSelect,settings,pos){var inst=this._dialogInst;if(!inst){this.uuid+=1;var id='dp'+this.uuid;this._dialogInput=$('<input type="text" id="'+id+'" style="position: absolute; top: -100px; width: 0px; z-index: -10;"/>');this._dialogInput.keydown(this._doKeyDown);$('body').append(this._dialogInput);inst=this._dialogInst=this._newInst(this._dialogInput,false);inst.settings={};$.data(this._dialogInput[0],PROP_NAME,inst);}
extendRemove(inst.settings,settings||{});date=(date&&date.constructor==Date?this._formatDate(inst,date):date);this._dialogInput.val(date);this._pos=(pos?(pos.length?pos:[pos.pageX,pos.pageY]):null);if(!this._pos){var browserWidth=document.documentElement.clientWidth;var browserHeight=document.documentElement.clientHeight;var scrollX=document.documentElement.scrollLeft||document.body.scrollLeft;var scrollY=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[(browserWidth/2)-100+scrollX,(browserHeight/2)-150+scrollY];}
this._dialogInput.css('left',(this._pos[0]+20)+'px').css('top',this._pos[1]+'px');inst.settings.onSelect=onSelect;this._inDialog=true;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);if($.blockUI)
$.blockUI(this.dpDiv);$.data(this._dialogInput[0],PROP_NAME,inst);return this;},_destroyDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return;}
var nodeName=target.nodeName.toLowerCase();$.removeData(target,PROP_NAME);if(nodeName=='input'){inst.append.remove();inst.trigger.remove();$target.removeClass(this.markerClassName).unbind('focus',this._showDatepicker).unbind('keydown',this._doKeyDown).unbind('keypress',this._doKeyPress).unbind('keyup',this._doKeyUp);}else if(nodeName=='div'||nodeName=='span')
$target.removeClass(this.markerClassName).empty();},_enableDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return;}
var nodeName=target.nodeName.toLowerCase();if(nodeName=='input'){target.disabled=false;inst.trigger.filter('button').each(function(){this.disabled=false;}).end().filter('img').css({opacity:'1.0',cursor:''});}
else if(nodeName=='div'||nodeName=='span'){var inline=$target.children('.'+this._inlineClass);inline.children().removeClass('ui-state-disabled');inline.find("select.ui-datepicker-month, select.ui-datepicker-year").removeAttr("disabled");}
this._disabledInputs=$.map(this._disabledInputs,function(value){return(value==target?null:value);});},_disableDatepicker:function(target){var $target=$(target);var inst=$.data(target,PROP_NAME);if(!$target.hasClass(this.markerClassName)){return;}
var nodeName=target.nodeName.toLowerCase();if(nodeName=='input'){target.disabled=true;inst.trigger.filter('button').each(function(){this.disabled=true;}).end().filter('img').css({opacity:'0.5',cursor:'default'});}
else if(nodeName=='div'||nodeName=='span'){var inline=$target.children('.'+this._inlineClass);inline.children().addClass('ui-state-disabled');inline.find("select.ui-datepicker-month, select.ui-datepicker-year").attr("disabled","disabled");}
this._disabledInputs=$.map(this._disabledInputs,function(value){return(value==target?null:value);});this._disabledInputs[this._disabledInputs.length]=target;},_isDisabledDatepicker:function(target){if(!target){return false;}
for(var i=0;i<this._disabledInputs.length;i++){if(this._disabledInputs[i]==target)
return true;}
return false;},_getInst:function(target){try{return $.data(target,PROP_NAME);}
catch(err){throw'Missing instance data for this datepicker';}},_optionDatepicker:function(target,name,value){var inst=this._getInst(target);if(arguments.length==2&&typeof name=='string'){return(name=='defaults'?$.extend({},$.datepicker._defaults):(inst?(name=='all'?$.extend({},inst.settings):this._get(inst,name)):null));}
var settings=name||{};if(typeof name=='string'){settings={};settings[name]=value;}
if(inst){if(this._curInst==inst){this._hideDatepicker();}
var date=this._getDateDatepicker(target,true);var minDate=this._getMinMaxDate(inst,'min');var maxDate=this._getMinMaxDate(inst,'max');extendRemove(inst.settings,settings);if(minDate!==null&&settings['dateFormat']!==undefined&&settings['minDate']===undefined)
inst.settings.minDate=this._formatDate(inst,minDate);if(maxDate!==null&&settings['dateFormat']!==undefined&&settings['maxDate']===undefined)
inst.settings.maxDate=this._formatDate(inst,maxDate);this._attachments($(target),inst);this._autoSize(inst);this._setDate(inst,date);this._updateAlternate(inst);this._updateDatepicker(inst);}},_changeDatepicker:function(target,name,value){this._optionDatepicker(target,name,value);},_refreshDatepicker:function(target){var inst=this._getInst(target);if(inst){this._updateDatepicker(inst);}},_setDateDatepicker:function(target,date){var inst=this._getInst(target);if(inst){this._setDate(inst,date);this._updateDatepicker(inst);this._updateAlternate(inst);}},_getDateDatepicker:function(target,noDefault){var inst=this._getInst(target);if(inst&&!inst.inline)
this._setDateFromField(inst,noDefault);return(inst?this._getDate(inst):null);},_doKeyDown:function(event){var inst=$.datepicker._getInst(event.target);var handled=true;var isRTL=inst.dpDiv.is('.ui-datepicker-rtl');inst._keyEvent=true;if($.datepicker._datepickerShowing)
switch(event.keyCode){case 9:$.datepicker._hideDatepicker();handled=false;break;case 13:var sel=$('td.'+$.datepicker._dayOverClass+':not(.'+
$.datepicker._currentClass+')',inst.dpDiv);if(sel[0])
$.datepicker._selectDay(event.target,inst.selectedMonth,inst.selectedYear,sel[0]);else
$.datepicker._hideDatepicker();return false;break;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,'stepBigMonths'):-$.datepicker._get(inst,'stepMonths')),'M');break;case 34:$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,'stepBigMonths'):+$.datepicker._get(inst,'stepMonths')),'M');break;case 35:if(event.ctrlKey||event.metaKey)$.datepicker._clearDate(event.target);handled=event.ctrlKey||event.metaKey;break;case 36:if(event.ctrlKey||event.metaKey)$.datepicker._gotoToday(event.target);handled=event.ctrlKey||event.metaKey;break;case 37:if(event.ctrlKey||event.metaKey)$.datepicker._adjustDate(event.target,(isRTL?+1:-1),'D');handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey)$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,'stepBigMonths'):-$.datepicker._get(inst,'stepMonths')),'M');break;case 38:if(event.ctrlKey||event.metaKey)$.datepicker._adjustDate(event.target,-7,'D');handled=event.ctrlKey||event.metaKey;break;case 39:if(event.ctrlKey||event.metaKey)$.datepicker._adjustDate(event.target,(isRTL?-1:+1),'D');handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey)$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,'stepBigMonths'):+$.datepicker._get(inst,'stepMonths')),'M');break;case 40:if(event.ctrlKey||event.metaKey)$.datepicker._adjustDate(event.target,+7,'D');handled=event.ctrlKey||event.metaKey;break;default:handled=false;}
else if(event.keyCode==36&&event.ctrlKey)
$.datepicker._showDatepicker(this);else{handled=false;}
if(handled){event.preventDefault();event.stopPropagation();}},_doKeyPress:function(event){var inst=$.datepicker._getInst(event.target);if($.datepicker._get(inst,'constrainInput')){var chars=$.datepicker._possibleChars($.datepicker._get(inst,'dateFormat'));var chr=String.fromCharCode(event.charCode==undefined?event.keyCode:event.charCode);return event.ctrlKey||event.metaKey||(chr<' '||!chars||chars.indexOf(chr)>-1);}},_doKeyUp:function(event){var inst=$.datepicker._getInst(event.target);if(inst.input.val()!=inst.lastVal){try{var date=$.datepicker.parseDate($.datepicker._get(inst,'dateFormat'),(inst.input?inst.input.val():null),$.datepicker._getFormatConfig(inst));if(date){$.datepicker._setDateFromField(inst);$.datepicker._updateAlternate(inst);$.datepicker._updateDatepicker(inst);}}
catch(event){$.datepicker.log(event);}}
return true;},_showDatepicker:function(input){input=input.target||input;if(input.nodeName.toLowerCase()!='input')
input=$('input',input.parentNode)[0];if($.datepicker._isDisabledDatepicker(input)||$.datepicker._lastInput==input)
return;var inst=$.datepicker._getInst(input);if($.datepicker._curInst&&$.datepicker._curInst!=inst){if($.datepicker._datepickerShowing){$.datepicker._triggerOnClose($.datepicker._curInst);}
$.datepicker._curInst.dpDiv.stop(true,true);}
var beforeShow=$.datepicker._get(inst,'beforeShow');extendRemove(inst.settings,(beforeShow?beforeShow.apply(input,[input,inst]):{}));inst.lastVal=null;$.datepicker._lastInput=input;$.datepicker._setDateFromField(inst);if($.datepicker._inDialog)
input.value='';if(!$.datepicker._pos){$.datepicker._pos=$.datepicker._findPos(input);$.datepicker._pos[1]+=input.offsetHeight;}
var isFixed=false;$(input).parents().each(function(){isFixed|=$(this).css('position')=='fixed';return!isFixed;});if(isFixed&&$.browser.opera){$.datepicker._pos[0]-=document.documentElement.scrollLeft;$.datepicker._pos[1]-=document.documentElement.scrollTop;}
var offset={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};$.datepicker._pos=null;inst.dpDiv.empty();inst.dpDiv.css({position:'absolute',display:'block',top:'-1000px'});$.datepicker._updateDatepicker(inst);offset=$.datepicker._checkOffset(inst,offset,isFixed);inst.dpDiv.css({position:($.datepicker._inDialog&&$.blockUI?'static':(isFixed?'fixed':'absolute')),display:'none',left:offset.left+'px',top:offset.top+'px'});if(!inst.inline){var showAnim=$.datepicker._get(inst,'showAnim');var duration=$.datepicker._get(inst,'duration');var postProcess=function(){var cover=inst.dpDiv.find('iframe.ui-datepicker-cover');if(!!cover.length){var borders=$.datepicker._getBorders(inst.dpDiv);cover.css({left:-borders[0],top:-borders[1],width:inst.dpDiv.outerWidth(),height:inst.dpDiv.outerHeight()});}};inst.dpDiv.zIndex($(input).zIndex()+1);$.datepicker._datepickerShowing=true;if($.effects&&$.effects[showAnim])
inst.dpDiv.show(showAnim,$.datepicker._get(inst,'showOptions'),duration,postProcess);else
inst.dpDiv[showAnim||'show']((showAnim?duration:null),postProcess);if(!showAnim||!duration)
postProcess();if(inst.input.is(':visible')&&!inst.input.is(':disabled'))
inst.input.focus();$.datepicker._curInst=inst;}},_updateDatepicker:function(inst){var self=this;self.maxRows=4;var borders=$.datepicker._getBorders(inst.dpDiv);instActive=inst;inst.dpDiv.empty().append(this._generateHTML(inst));var cover=inst.dpDiv.find('iframe.ui-datepicker-cover');if(!!cover.length){cover.css({left:-borders[0],top:-borders[1],width:inst.dpDiv.outerWidth(),height:inst.dpDiv.outerHeight()})}
inst.dpDiv.find('.'+this._dayOverClass+' a').mouseover();var numMonths=this._getNumberOfMonths(inst);var cols=numMonths[1];var width=17;inst.dpDiv.removeClass('ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4').width('');if(cols>1)
inst.dpDiv.addClass('ui-datepicker-multi-'+cols).css('width',(width*cols)+'em');inst.dpDiv[(numMonths[0]!=1||numMonths[1]!=1?'add':'remove')+'Class']('ui-datepicker-multi');inst.dpDiv[(this._get(inst,'isRTL')?'add':'remove')+'Class']('ui-datepicker-rtl');if(inst==$.datepicker._curInst&&$.datepicker._datepickerShowing&&inst.input&&inst.input.is(':visible')&&!inst.input.is(':disabled')&&inst.input[0]!=document.activeElement)
inst.input.focus();if(inst.yearshtml){var origyearshtml=inst.yearshtml;setTimeout(function(){if(origyearshtml===inst.yearshtml&&inst.yearshtml){inst.dpDiv.find('select.ui-datepicker-year:first').replaceWith(inst.yearshtml);}
origyearshtml=inst.yearshtml=null;},0);}},_getBorders:function(elem){var convert=function(value){return{thin:1,medium:2,thick:3}[value]||value;};return[parseFloat(convert(elem.css('border-left-width'))),parseFloat(convert(elem.css('border-top-width')))];},_checkOffset:function(inst,offset,isFixed){var dpWidth=inst.dpDiv.outerWidth();var dpHeight=inst.dpDiv.outerHeight();var inputWidth=inst.input?inst.input.outerWidth():0;var inputHeight=inst.input?inst.input.outerHeight():0;var viewWidth=document.documentElement.clientWidth+$(document).scrollLeft();var viewHeight=document.documentElement.clientHeight+$(document).scrollTop();offset.left-=(this._get(inst,'isRTL')?(dpWidth-inputWidth):0);offset.left-=(isFixed&&offset.left==inst.input.offset().left)?$(document).scrollLeft():0;offset.top-=(isFixed&&offset.top==(inst.input.offset().top+inputHeight))?$(document).scrollTop():0;offset.left-=Math.min(offset.left,(offset.left+dpWidth>viewWidth&&viewWidth>dpWidth)?Math.abs(offset.left+dpWidth-viewWidth):0);offset.top-=Math.min(offset.top,(offset.top+dpHeight>viewHeight&&viewHeight>dpHeight)?Math.abs(dpHeight+inputHeight):0);return offset;},_findPos:function(obj){var inst=this._getInst(obj);var isRTL=this._get(inst,'isRTL');while(obj&&(obj.type=='hidden'||obj.nodeType!=1||$.expr.filters.hidden(obj))){obj=obj[isRTL?'previousSibling':'nextSibling'];}
var position=$(obj).offset();return[position.left,position.top];},_triggerOnClose:function(inst){var onClose=this._get(inst,'onClose');if(onClose)
onClose.apply((inst.input?inst.input[0]:null),[(inst.input?inst.input.val():''),inst]);},_hideDatepicker:function(input){var inst=this._curInst;if(!inst||(input&&inst!=$.data(input,PROP_NAME)))
return;if(this._datepickerShowing){var showAnim=this._get(inst,'showAnim');var duration=this._get(inst,'duration');var postProcess=function(){$.datepicker._tidyDialog(inst);this._curInst=null;};if($.effects&&$.effects[showAnim])
inst.dpDiv.hide(showAnim,$.datepicker._get(inst,'showOptions'),duration,postProcess);else
inst.dpDiv[(showAnim=='slideDown'?'slideUp':(showAnim=='fadeIn'?'fadeOut':'hide'))]((showAnim?duration:null),postProcess);if(!showAnim)
postProcess();$.datepicker._triggerOnClose(inst);this._datepickerShowing=false;this._lastInput=null;if(this._inDialog){this._dialogInput.css({position:'absolute',left:'0',top:'-100px'});if($.blockUI){$.unblockUI();$('body').append(this.dpDiv);}}
this._inDialog=false;}},_tidyDialog:function(inst){inst.dpDiv.removeClass(this._dialogClass).unbind('.ui-datepicker-calendar');},_checkExternalClick:function(event){if(!$.datepicker._curInst)
return;var $target=$(event.target);if($target[0].id!=$.datepicker._mainDivId&&$target.parents('#'+$.datepicker._mainDivId).length==0&&!$target.hasClass($.datepicker.markerClassName)&&!$target.hasClass($.datepicker._triggerClass)&&$.datepicker._datepickerShowing&&!($.datepicker._inDialog&&$.blockUI))
$.datepicker._hideDatepicker();},_adjustDate:function(id,offset,period){var target=$(id);var inst=this._getInst(target[0]);if(this._isDisabledDatepicker(target[0])){return;}
this._adjustInstDate(inst,offset+
(period=='M'?this._get(inst,'showCurrentAtPos'):0),period);this._updateDatepicker(inst);},_gotoToday:function(id){var target=$(id);var inst=this._getInst(target[0]);if(this._get(inst,'gotoCurrent')&&inst.currentDay){inst.selectedDay=inst.currentDay;inst.drawMonth=inst.selectedMonth=inst.currentMonth;inst.drawYear=inst.selectedYear=inst.currentYear;}
else{var date=new Date();inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();}
this._notifyChange(inst);this._adjustDate(target);},_selectMonthYear:function(id,select,period){var target=$(id);var inst=this._getInst(target[0]);inst._selectingMonthYear=false;inst['selected'+(period=='M'?'Month':'Year')]=inst['draw'+(period=='M'?'Month':'Year')]=parseInt(select.options[select.selectedIndex].value,10);this._notifyChange(inst);this._adjustDate(target);},_clickMonthYear:function(id){var target=$(id);var inst=this._getInst(target[0]);if(inst.input&&inst._selectingMonthYear){setTimeout(function(){inst.input.focus();},0);}
inst._selectingMonthYear=!inst._selectingMonthYear;},_selectDay:function(id,month,year,td){var target=$(id);if($(td).hasClass(this._unselectableClass)||this._isDisabledDatepicker(target[0])){return;}
var inst=this._getInst(target[0]);inst.selectedDay=inst.currentDay=$('a',td).html();inst.selectedMonth=inst.currentMonth=month;inst.selectedYear=inst.currentYear=year;this._selectDate(id,this._formatDate(inst,inst.currentDay,inst.currentMonth,inst.currentYear));},_clearDate:function(id){var target=$(id);var inst=this._getInst(target[0]);this._selectDate(target,'');},_selectDate:function(id,dateStr){var target=$(id);var inst=this._getInst(target[0]);dateStr=(dateStr!=null?dateStr:this._formatDate(inst));if(inst.input)
inst.input.val(dateStr);this._updateAlternate(inst);var onSelect=this._get(inst,'onSelect');if(onSelect)
onSelect.apply((inst.input?inst.input[0]:null),[dateStr,inst]);else if(inst.input)
inst.input.trigger('change');if(inst.inline)
this._updateDatepicker(inst);else{this._hideDatepicker();this._lastInput=inst.input[0];if(typeof(inst.input[0])!='object')
inst.input.focus();this._lastInput=null;}},_updateAlternate:function(inst){var altField=this._get(inst,'altField');if(altField){var altFormat=this._get(inst,'altFormat')||this._get(inst,'dateFormat');var date=this._getDate(inst);var dateStr=this.formatDate(altFormat,date,this._getFormatConfig(inst));$(altField).each(function(){$(this).val(dateStr);});}},noWeekends:function(date){var day=date.getDay();return[(day>0&&day<6),''];},iso8601Week:function(date){var checkDate=new Date(date.getTime());checkDate.setDate(checkDate.getDate()+4-(checkDate.getDay()||7));var time=checkDate.getTime();checkDate.setMonth(0);checkDate.setDate(1);return Math.floor(Math.round((time-checkDate)/86400000)/7)+1;},parseDate:function(format,value,settings){if(format==null||value==null)
throw'Invalid arguments';value=(typeof value=='object'?value.toString():value+'');if(value=='')
return null;var shortYearCutoff=(settings?settings.shortYearCutoff:null)||this._defaults.shortYearCutoff;shortYearCutoff=(typeof shortYearCutoff!='string'?shortYearCutoff:new Date().getFullYear()%100+parseInt(shortYearCutoff,10));var dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort;var dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames;var monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort;var monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames;var year=-1;var month=-1;var day=-1;var doy=-1;var literal=false;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches)
iFormat++;return matches;};var getNumber=function(match){var isDoubled=lookAhead(match);var size=(match=='@'?14:(match=='!'?20:(match=='y'&&isDoubled?4:(match=='o'?3:2))));var digits=new RegExp('^\\d{1,'+size+'}');var num=value.substring(iValue).match(digits);if(!num)
throw'Missing number at position '+iValue;iValue+=num[0].length;return parseInt(num[0],10);};var getName=function(match,shortNames,longNames){var names=$.map(lookAhead(match)?longNames:shortNames,function(v,k){return[[k,v]];}).sort(function(a,b){return-(a[1].length-b[1].length);});var index=-1;$.each(names,function(i,pair){var name=pair[1];if(value.substr(iValue,name.length).toLowerCase()==name.toLowerCase()){index=pair[0];iValue+=name.length;return false;}});if(index!=-1)
return index+1;else
throw'Unknown name at position '+iValue;};var checkLiteral=function(){if(value.charAt(iValue)!=format.charAt(iFormat))
throw'Unexpected literal at position '+iValue;iValue++;};var iValue=0;for(var iFormat=0;iFormat<format.length;iFormat++){if(literal)
if(format.charAt(iFormat)=="'"&&!lookAhead("'"))
literal=false;else
checkLiteral();else
switch(format.charAt(iFormat)){case'd':day=getNumber('d');break;case'D':getName('D',dayNamesShort,dayNames);break;case'o':doy=getNumber('o');break;case'm':month=getNumber('m');break;case'M':month=getName('M',monthNamesShort,monthNames);break;case'y':year=getNumber('y');break;case'@':var date=new Date(getNumber('@'));year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case'!':var date=new Date((getNumber('!')-this._ticksTo1970)/10000);year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case"'":if(lookAhead("'"))
checkLiteral();else
literal=true;break;default:checkLiteral();}}
if(iValue<value.length){throw"Extra/unparsed characters found in date: "+value.substring(iValue);}
if(year==-1)
year=new Date().getFullYear();else if(year<100)
year+=new Date().getFullYear()-new Date().getFullYear()%100+
(year<=shortYearCutoff?0:-100);if(doy>-1){month=1;day=doy;do{var dim=this._getDaysInMonth(year,month-1);if(day<=dim)
break;month++;day-=dim;}while(true);}
var date=this._daylightSavingAdjust(new Date(year,month-1,day));if(date.getFullYear()!=year||date.getMonth()+1!=month||date.getDate()!=day)
throw'Invalid date';return date;},ATOM:'yy-mm-dd',COOKIE:'D, dd M yy',ISO_8601:'yy-mm-dd',RFC_822:'D, d M y',RFC_850:'DD, dd-M-y',RFC_1036:'D, d M y',RFC_1123:'D, d M yy',RFC_2822:'D, d M yy',RSS:'D, d M y',TICKS:'!',TIMESTAMP:'@',W3C:'yy-mm-dd',_ticksTo1970:(((1970-1)*365+Math.floor(1970/4)-Math.floor(1970/100)+
Math.floor(1970/400))*24*60*60*10000000),formatDate:function(format,date,settings){if(!date)
return'';var dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort;var dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames;var monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort;var monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches)
iFormat++;return matches;};var formatNumber=function(match,value,len){var num=''+value;if(lookAhead(match))
while(num.length<len)
num='0'+num;return num;};var formatName=function(match,value,shortNames,longNames){return(lookAhead(match)?longNames[value]:shortNames[value]);};var output='';var literal=false;if(date)
for(var iFormat=0;iFormat<format.length;iFormat++){if(literal)
if(format.charAt(iFormat)=="'"&&!lookAhead("'"))
literal=false;else
output+=format.charAt(iFormat);else
switch(format.charAt(iFormat)){case'd':output+=formatNumber('d',date.getDate(),2);break;case'D':output+=formatName('D',date.getDay(),dayNamesShort,dayNames);break;case'o':output+=formatNumber('o',Math.round((new Date(date.getFullYear(),date.getMonth(),date.getDate()).getTime()-new Date(date.getFullYear(),0,0).getTime())/86400000),3);break;case'm':output+=formatNumber('m',date.getMonth()+1,2);break;case'M':output+=formatName('M',date.getMonth(),monthNamesShort,monthNames);break;case'y':output+=(lookAhead('y')?date.getFullYear():(date.getYear()%100<10?'0':'')+date.getYear()%100);break;case'@':output+=date.getTime();break;case'!':output+=date.getTime()*10000+this._ticksTo1970;break;case"'":if(lookAhead("'"))
output+="'";else
literal=true;break;default:output+=format.charAt(iFormat);}}
return output;},_possibleChars:function(format){var chars='';var literal=false;var lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)==match);if(matches)
iFormat++;return matches;};for(var iFormat=0;iFormat<format.length;iFormat++)
if(literal)
if(format.charAt(iFormat)=="'"&&!lookAhead("'"))
literal=false;else
chars+=format.charAt(iFormat);else
switch(format.charAt(iFormat)){case'd':case'm':case'y':case'@':chars+='0123456789';break;case'D':case'M':return null;case"'":if(lookAhead("'"))
chars+="'";else
literal=true;break;default:chars+=format.charAt(iFormat);}
return chars;},_get:function(inst,name){return inst.settings[name]!==undefined?inst.settings[name]:this._defaults[name];},_setDateFromField:function(inst,noDefault){if(inst.input.val()==inst.lastVal){return;}
var dateFormat=this._get(inst,'dateFormat');var dates=inst.lastVal=inst.input?inst.input.val():null;var date,defaultDate;date=defaultDate=this._getDefaultDate(inst);var settings=this._getFormatConfig(inst);try{date=this.parseDate(dateFormat,dates,settings)||defaultDate;}catch(event){this.log(event);dates=(noDefault?'':dates);}
inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();inst.currentDay=(dates?date.getDate():0);inst.currentMonth=(dates?date.getMonth():0);inst.currentYear=(dates?date.getFullYear():0);this._adjustInstDate(inst);},_getDefaultDate:function(inst){return this._restrictMinMax(inst,this._determineDate(inst,this._get(inst,'defaultDate'),new Date()));},_determineDate:function(inst,date,defaultDate){var offsetNumeric=function(offset){var date=new Date();date.setDate(date.getDate()+offset);return date;};var offsetString=function(offset){try{return $.datepicker.parseDate($.datepicker._get(inst,'dateFormat'),offset,$.datepicker._getFormatConfig(inst));}
catch(e){}
var date=(offset.toLowerCase().match(/^c/)?$.datepicker._getDate(inst):null)||new Date();var year=date.getFullYear();var month=date.getMonth();var day=date.getDate();var pattern=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g;var matches=pattern.exec(offset);while(matches){switch(matches[2]||'d'){case'd':case'D':day+=parseInt(matches[1],10);break;case'w':case'W':day+=parseInt(matches[1],10)*7;break;case'm':case'M':month+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break;case'y':case'Y':year+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break;}
matches=pattern.exec(offset);}
return new Date(year,month,day);};var newDate=(date==null||date===''?defaultDate:(typeof date=='string'?offsetString(date):(typeof date=='number'?(isNaN(date)?defaultDate:offsetNumeric(date)):new Date(date.getTime()))));newDate=(newDate&&newDate.toString()=='Invalid Date'?defaultDate:newDate);if(newDate){newDate.setHours(0);newDate.setMinutes(0);newDate.setSeconds(0);newDate.setMilliseconds(0);}
return this._daylightSavingAdjust(newDate);},_daylightSavingAdjust:function(date){if(!date)return null;date.setHours(date.getHours()>12?date.getHours()+2:0);return date;},_setDate:function(inst,date,noChange){var clear=!date;var origMonth=inst.selectedMonth;var origYear=inst.selectedYear;var newDate=this._restrictMinMax(inst,this._determineDate(inst,date,new Date()));inst.selectedDay=inst.currentDay=newDate.getDate();inst.drawMonth=inst.selectedMonth=inst.currentMonth=newDate.getMonth();inst.drawYear=inst.selectedYear=inst.currentYear=newDate.getFullYear();if((origMonth!=inst.selectedMonth||origYear!=inst.selectedYear)&&!noChange)
this._notifyChange(inst);this._adjustInstDate(inst);if(inst.input){inst.input.val(clear?'':this._formatDate(inst));}},_getDate:function(inst){var startDate=(!inst.currentYear||(inst.input&&inst.input.val()=='')?null:this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return startDate;},_generateHTML:function(inst){var today=new Date();today=this._daylightSavingAdjust(new Date(today.getFullYear(),today.getMonth(),today.getDate()));var isRTL=this._get(inst,'isRTL');var showButtonPanel=this._get(inst,'showButtonPanel');var hideIfNoPrevNext=this._get(inst,'hideIfNoPrevNext');var navigationAsDateFormat=this._get(inst,'navigationAsDateFormat');var numMonths=this._getNumberOfMonths(inst);var showCurrentAtPos=this._get(inst,'showCurrentAtPos');var stepMonths=this._get(inst,'stepMonths');var isMultiMonth=(numMonths[0]!=1||numMonths[1]!=1);var currentDate=this._daylightSavingAdjust((!inst.currentDay?new Date(9999,9,9):new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));var minDate=this._getMinMaxDate(inst,'min');var maxDate=this._getMinMaxDate(inst,'max');var drawMonth=inst.drawMonth-showCurrentAtPos;var drawYear=inst.drawYear;if(drawMonth<0){drawMonth+=12;drawYear--;}
if(maxDate){var maxDraw=this._daylightSavingAdjust(new Date(maxDate.getFullYear(),maxDate.getMonth()-(numMonths[0]*numMonths[1])+1,maxDate.getDate()));maxDraw=(minDate&&maxDraw<minDate?minDate:maxDraw);while(this._daylightSavingAdjust(new Date(drawYear,drawMonth,1))>maxDraw){drawMonth--;if(drawMonth<0){drawMonth=11;drawYear--;}}}
inst.drawMonth=drawMonth;inst.drawYear=drawYear;var prevText=this._get(inst,'prevText');prevText=(!navigationAsDateFormat?prevText:this.formatDate(prevText,this._daylightSavingAdjust(new Date(drawYear,drawMonth-stepMonths,1)),this._getFormatConfig(inst)));var prev=(this._canAdjustMonth(inst,-1,drawYear,drawMonth)?'<a class="ui-datepicker-prev ui-corner-all" onclick="DP_jQuery_'+dpuuid+'.datepicker._adjustDate(\'#'+inst.id+'\', -'+stepMonths+', \'M\');"'+' title="'+prevText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?'e':'w')+'">'+prevText+'</span></a>':(hideIfNoPrevNext?'':'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+prevText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?'e':'w')+'">'+prevText+'</span></a>'));var nextText=this._get(inst,'nextText');nextText=(!navigationAsDateFormat?nextText:this.formatDate(nextText,this._daylightSavingAdjust(new Date(drawYear,drawMonth+stepMonths,1)),this._getFormatConfig(inst)));var next=(this._canAdjustMonth(inst,+1,drawYear,drawMonth)?'<a class="ui-datepicker-next ui-corner-all" onclick="DP_jQuery_'+dpuuid+'.datepicker._adjustDate(\'#'+inst.id+'\', +'+stepMonths+', \'M\');"'+' title="'+nextText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?'w':'e')+'">'+nextText+'</span></a>':(hideIfNoPrevNext?'':'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+nextText+'"><span class="ui-icon ui-icon-circle-triangle-'+(isRTL?'w':'e')+'">'+nextText+'</span></a>'));var currentText=this._get(inst,'currentText');var gotoDate=(this._get(inst,'gotoCurrent')&&inst.currentDay?currentDate:today);currentText=(!navigationAsDateFormat?currentText:this.formatDate(currentText,gotoDate,this._getFormatConfig(inst)));var controls=(!inst.inline?'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" onclick="DP_jQuery_'+dpuuid+'.datepicker._hideDatepicker();">'+this._get(inst,'closeText')+'</button>':'');var buttonPanel=(showButtonPanel)?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(isRTL?controls:'')+
(this._isInRange(inst,gotoDate)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" onclick="DP_jQuery_'+dpuuid+'.datepicker._gotoToday(\'#'+inst.id+'\');"'+'>'+currentText+'</button>':'')+(isRTL?'':controls)+'</div>':'';var firstDay=parseInt(this._get(inst,'firstDay'),10);firstDay=(isNaN(firstDay)?0:firstDay);var showWeek=this._get(inst,'showWeek');var dayNames=this._get(inst,'dayNames');var dayNamesShort=this._get(inst,'dayNamesShort');var dayNamesMin=this._get(inst,'dayNamesMin');var monthNames=this._get(inst,'monthNames');var monthNamesShort=this._get(inst,'monthNamesShort');var beforeShowDay=this._get(inst,'beforeShowDay');var showOtherMonths=this._get(inst,'showOtherMonths');var selectOtherMonths=this._get(inst,'selectOtherMonths');var calculateWeek=this._get(inst,'calculateWeek')||this.iso8601Week;var defaultDate=this._getDefaultDate(inst);var html='';for(var row=0;row<numMonths[0];row++){var group='';this.maxRows=4;for(var col=0;col<numMonths[1];col++){var selectedDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,inst.selectedDay));var cornerClass=' ui-corner-all';var calender='';if(isMultiMonth){calender+='<div class="ui-datepicker-group';if(numMonths[1]>1)
switch(col){case 0:calender+=' ui-datepicker-group-first';cornerClass=' ui-corner-'+(isRTL?'right':'left');break;case numMonths[1]-1:calender+=' ui-datepicker-group-last';cornerClass=' ui-corner-'+(isRTL?'left':'right');break;default:calender+=' ui-datepicker-group-middle';cornerClass='';break;}
calender+='">';}
calender+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+cornerClass+'">'+
(/all|left/.test(cornerClass)&&row==0?(isRTL?next:prev):'')+
(/all|right/.test(cornerClass)&&row==0?(isRTL?prev:next):'')+
this._generateMonthYearHeader(inst,drawMonth,drawYear,minDate,maxDate,row>0||col>0,monthNames,monthNamesShort)+'</div><table class="ui-datepicker-calendar"><thead>'+'<tr>';var thead=(showWeek?'<th class="ui-datepicker-week-col">'+this._get(inst,'weekHeader')+'</th>':'');for(var dow=0;dow<7;dow++){var day=(dow+firstDay)%7;thead+='<th'+((dow+firstDay+6)%7>=5?' class="ui-datepicker-week-end"':'')+'>'+'<span title="'+dayNames[day]+'">'+dayNamesMin[day]+'</span></th>';}
calender+=thead+'</tr></thead><tbody>';var daysInMonth=this._getDaysInMonth(drawYear,drawMonth);if(drawYear==inst.selectedYear&&drawMonth==inst.selectedMonth)
inst.selectedDay=Math.min(inst.selectedDay,daysInMonth);var leadDays=(this._getFirstDayOfMonth(drawYear,drawMonth)-firstDay+7)%7;var curRows=Math.ceil((leadDays+daysInMonth)/7);var numRows=(isMultiMonth?this.maxRows>curRows?this.maxRows:curRows:curRows);this.maxRows=numRows;var printDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,1-leadDays));for(var dRow=0;dRow<numRows;dRow++){calender+='<tr>';var tbody=(!showWeek?'':'<td class="ui-datepicker-week-col">'+
this._get(inst,'calculateWeek')(printDate)+'</td>');for(var dow=0;dow<7;dow++){var daySettings=(beforeShowDay?beforeShowDay.apply((inst.input?inst.input[0]:null),[printDate]):[true,'']);var otherMonth=(printDate.getMonth()!=drawMonth);var unselectable=(otherMonth&&!selectOtherMonths)||!daySettings[0]||(minDate&&printDate<minDate)||(maxDate&&printDate>maxDate);tbody+='<td class="'+
((dow+firstDay+6)%7>=5?' ui-datepicker-week-end':'')+
(otherMonth?' ui-datepicker-other-month':'')+
((printDate.getTime()==selectedDate.getTime()&&drawMonth==inst.selectedMonth&&inst._keyEvent)||(defaultDate.getTime()==printDate.getTime()&&defaultDate.getTime()==selectedDate.getTime())?' '+this._dayOverClass:'')+
(unselectable?' '+this._unselectableClass+' ui-state-disabled':'')+
(otherMonth&&!showOtherMonths?'':' '+daySettings[1]+
(printDate.getTime()==currentDate.getTime()?' '+this._currentClass:'')+
(printDate.getTime()==today.getTime()?' ui-datepicker-today':''))+'"'+
((!otherMonth||showOtherMonths)&&daySettings[2]?' title="'+daySettings[2]+'"':'')+
(unselectable?'':' onclick="DP_jQuery_'+dpuuid+'.datepicker._selectDay(\'#'+
inst.id+'\','+printDate.getMonth()+','+printDate.getFullYear()+', this);return false;"')+'>'+
(otherMonth&&!showOtherMonths?'&#xa0;':(unselectable?'<span class="ui-state-default">'+printDate.getDate()+'</span>':'<a class="ui-state-default'+
(printDate.getTime()==today.getTime()?' ui-state-highlight':'')+
(printDate.getTime()==currentDate.getTime()?' ui-state-active':'')+
(otherMonth?' ui-priority-secondary':'')+'" href="#">'+printDate.getDate()+'</a>'))+'</td>';printDate.setDate(printDate.getDate()+1);printDate=this._daylightSavingAdjust(printDate);}
calender+=tbody+'</tr>';}
drawMonth++;if(drawMonth>11){drawMonth=0;drawYear++;}
calender+='</tbody></table>'+(isMultiMonth?'</div>'+
((numMonths[0]>0&&col==numMonths[1]-1)?'<div class="ui-datepicker-row-break"></div>':''):'');group+=calender;}
html+=group;}
html+=buttonPanel+($.browser.msie&&parseInt($.browser.version,10)<7&&!inst.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':'');inst._keyEvent=false;return html;},_generateMonthYearHeader:function(inst,drawMonth,drawYear,minDate,maxDate,secondary,monthNames,monthNamesShort){var changeMonth=this._get(inst,'changeMonth');var changeYear=this._get(inst,'changeYear');var showMonthAfterYear=this._get(inst,'showMonthAfterYear');var html='<div class="ui-datepicker-title">';var monthHtml='';if(secondary||!changeMonth)
monthHtml+='<span class="ui-datepicker-month">'+monthNames[drawMonth]+'</span>';else{var inMinYear=(minDate&&minDate.getFullYear()==drawYear);var inMaxYear=(maxDate&&maxDate.getFullYear()==drawYear);monthHtml+='<select class="ui-datepicker-month" '+'onchange="DP_jQuery_'+dpuuid+'.datepicker._selectMonthYear(\'#'+inst.id+'\', this, \'M\');" '+'onclick="DP_jQuery_'+dpuuid+'.datepicker._clickMonthYear(\'#'+inst.id+'\');"'+'>';for(var month=0;month<12;month++){if((!inMinYear||month>=minDate.getMonth())&&(!inMaxYear||month<=maxDate.getMonth()))
monthHtml+='<option value="'+month+'"'+
(month==drawMonth?' selected="selected"':'')+'>'+monthNamesShort[month]+'</option>';}
monthHtml+='</select>';}
if(!showMonthAfterYear)
html+=monthHtml+(secondary||!(changeMonth&&changeYear)?'&#xa0;':'');if(!inst.yearshtml){inst.yearshtml='';if(secondary||!changeYear)
html+='<span class="ui-datepicker-year">'+drawYear+'</span>';else{var years=this._get(inst,'yearRange').split(':');var thisYear=new Date().getFullYear();var determineYear=function(value){var year=(value.match(/c[+-].*/)?drawYear+parseInt(value.substring(1),10):(value.match(/[+-].*/)?thisYear+parseInt(value,10):parseInt(value,10)));return(isNaN(year)?thisYear:year);};var year=determineYear(years[0]);var endYear=Math.max(year,determineYear(years[1]||''));year=(minDate?Math.max(year,minDate.getFullYear()):year);endYear=(maxDate?Math.min(endYear,maxDate.getFullYear()):endYear);inst.yearshtml+='<select class="ui-datepicker-year" '+'onchange="DP_jQuery_'+dpuuid+'.datepicker._selectMonthYear(\'#'+inst.id+'\', this, \'Y\');" '+'onclick="DP_jQuery_'+dpuuid+'.datepicker._clickMonthYear(\'#'+inst.id+'\');"'+'>';for(;year<=endYear;year++){inst.yearshtml+='<option value="'+year+'"'+
(year==drawYear?' selected="selected"':'')+'>'+year+'</option>';}
inst.yearshtml+='</select>';html+=inst.yearshtml;inst.yearshtml=null;}}
html+=this._get(inst,'yearSuffix');if(showMonthAfterYear)
html+=(secondary||!(changeMonth&&changeYear)?'&#xa0;':'')+monthHtml;html+='</div>';return html;},_adjustInstDate:function(inst,offset,period){var year=inst.drawYear+(period=='Y'?offset:0);var month=inst.drawMonth+(period=='M'?offset:0);var day=Math.min(inst.selectedDay,this._getDaysInMonth(year,month))+
(period=='D'?offset:0);var date=this._restrictMinMax(inst,this._daylightSavingAdjust(new Date(year,month,day)));inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();if(period=='M'||period=='Y')
this._notifyChange(inst);},_restrictMinMax:function(inst,date){var minDate=this._getMinMaxDate(inst,'min');var maxDate=this._getMinMaxDate(inst,'max');var newDate=(minDate&&date<minDate?minDate:date);newDate=(maxDate&&newDate>maxDate?maxDate:newDate);return newDate;},_notifyChange:function(inst){var onChange=this._get(inst,'onChangeMonthYear');if(onChange)
onChange.apply((inst.input?inst.input[0]:null),[inst.selectedYear,inst.selectedMonth+1,inst]);},_getNumberOfMonths:function(inst){var numMonths=this._get(inst,'numberOfMonths');return(numMonths==null?[1,1]:(typeof numMonths=='number'?[1,numMonths]:numMonths));},_getMinMaxDate:function(inst,minMax){return this._determineDate(inst,this._get(inst,minMax+'Date'),null);},_getDaysInMonth:function(year,month){return 32-this._daylightSavingAdjust(new Date(year,month,32)).getDate();},_getFirstDayOfMonth:function(year,month){return new Date(year,month,1).getDay();},_canAdjustMonth:function(inst,offset,curYear,curMonth){var numMonths=this._getNumberOfMonths(inst);var date=this._daylightSavingAdjust(new Date(curYear,curMonth+(offset<0?offset:numMonths[0]*numMonths[1]),1));if(offset<0)
date.setDate(this._getDaysInMonth(date.getFullYear(),date.getMonth()));return this._isInRange(inst,date);},_isInRange:function(inst,date){var minDate=this._getMinMaxDate(inst,'min');var maxDate=this._getMinMaxDate(inst,'max');return((!minDate||date.getTime()>=minDate.getTime())&&(!maxDate||date.getTime()<=maxDate.getTime()));},_getFormatConfig:function(inst){var shortYearCutoff=this._get(inst,'shortYearCutoff');shortYearCutoff=(typeof shortYearCutoff!='string'?shortYearCutoff:new Date().getFullYear()%100+parseInt(shortYearCutoff,10));return{shortYearCutoff:shortYearCutoff,dayNamesShort:this._get(inst,'dayNamesShort'),dayNames:this._get(inst,'dayNames'),monthNamesShort:this._get(inst,'monthNamesShort'),monthNames:this._get(inst,'monthNames')};},_formatDate:function(inst,day,month,year){if(!day){inst.currentDay=inst.selectedDay;inst.currentMonth=inst.selectedMonth;inst.currentYear=inst.selectedYear;}
var date=(day?(typeof day=='object'?day:this._daylightSavingAdjust(new Date(year,month,day))):this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return this.formatDate(this._get(inst,'dateFormat'),date,this._getFormatConfig(inst));}});function bindHover(dpDiv){var selector='button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a';return dpDiv.bind('mouseout',function(event){var elem=$(event.target).closest(selector);if(!elem.length){return;}
elem.removeClass("ui-state-hover ui-datepicker-prev-hover ui-datepicker-next-hover");}).bind('mouseover',function(event){var elem=$(event.target).closest(selector);if($.datepicker._isDisabledDatepicker(instActive.inline?dpDiv.parent()[0]:instActive.input[0])||!elem.length){return;}
elem.parents('.ui-datepicker-calendar').find('a').removeClass('ui-state-hover');elem.addClass('ui-state-hover');if(elem.hasClass('ui-datepicker-prev'))elem.addClass('ui-datepicker-prev-hover');if(elem.hasClass('ui-datepicker-next'))elem.addClass('ui-datepicker-next-hover');});}
function extendRemove(target,props){$.extend(target,props);for(var name in props)
if(props[name]==null||props[name]==undefined)
target[name]=props[name];return target;};function isArray(a){return(a&&(($.browser.safari&&typeof a=='object'&&a.length)||(a.constructor&&a.constructor.toString().match(/\Array\(\)/))));};$.fn.datepicker=function(options){if(!this.length){return this;}
if(!$.datepicker.initialized){$(document).mousedown($.datepicker._checkExternalClick).find('body').append($.datepicker.dpDiv);$.datepicker.initialized=true;}
var otherArgs=Array.prototype.slice.call(arguments,1);if(typeof options=='string'&&(options=='isDisabled'||options=='getDate'||options=='widget'))
return $.datepicker['_'+options+'Datepicker'].apply($.datepicker,[this[0]].concat(otherArgs));if(options=='option'&&arguments.length==2&&typeof arguments[1]=='string')
return $.datepicker['_'+options+'Datepicker'].apply($.datepicker,[this[0]].concat(otherArgs));return this.each(function(){typeof options=='string'?$.datepicker['_'+options+'Datepicker'].apply($.datepicker,[this].concat(otherArgs)):$.datepicker._attachDatepicker(this,options);});};$.datepicker=new Datepicker();$.datepicker.initialized=false;$.datepicker.uuid=new Date().getTime();$.datepicker.version="1.8.14";window['DP_jQuery_'+dpuuid]=$;})(jQuery);(function($,undefined){$.widget("ui.progressbar",{options:{value:0,max:100},min:0,_create:function(){this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min,"aria-valuemax":this.options.max,"aria-valuenow":this._value()});this.valueDiv=$("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element);this.oldValue=this._value();this._refreshValue();},destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow");this.valueDiv.remove();$.Widget.prototype.destroy.apply(this,arguments);},value:function(newValue){if(newValue===undefined){return this._value();}
this._setOption("value",newValue);return this;},_setOption:function(key,value){if(key==="value"){this.options.value=value;this._refreshValue();if(this._value()===this.options.max){this._trigger("complete");}}
$.Widget.prototype._setOption.apply(this,arguments);},_value:function(){var val=this.options.value;if(typeof val!=="number"){val=0;}
return Math.min(this.options.max,Math.max(this.min,val));},_percentage:function(){return 100*this._value()/this.options.max;},_refreshValue:function(){var value=this.value();var percentage=this._percentage();if(this.oldValue!==value){this.oldValue=value;this._trigger("change");}
this.valueDiv.toggle(value>this.min).toggleClass("ui-corner-right",value===this.options.max).width(percentage.toFixed(0)+"%");this.element.attr("aria-valuenow",value);}});$.extend($.ui.progressbar,{version:"1.8.14"});})(jQuery);;jQuery.effects||(function($,undefined){$.effects={};$.each(['backgroundColor','borderBottomColor','borderLeftColor','borderRightColor','borderTopColor','borderColor','color','outlineColor'],function(i,attr){$.fx.step[attr]=function(fx){if(!fx.colorInit){fx.start=getColor(fx.elem,attr);fx.end=getRGB(fx.end);fx.colorInit=true;}
fx.elem.style[attr]='rgb('+
Math.max(Math.min(parseInt((fx.pos*(fx.end[0]-fx.start[0]))+fx.start[0],10),255),0)+','+
Math.max(Math.min(parseInt((fx.pos*(fx.end[1]-fx.start[1]))+fx.start[1],10),255),0)+','+
Math.max(Math.min(parseInt((fx.pos*(fx.end[2]-fx.start[2]))+fx.start[2],10),255),0)+')';};});function getRGB(color){var result;if(color&&color.constructor==Array&&color.length==3)
return color;if(result=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(color))
return[parseInt(result[1],10),parseInt(result[2],10),parseInt(result[3],10)];if(result=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(color))
return[parseFloat(result[1])*2.55,parseFloat(result[2])*2.55,parseFloat(result[3])*2.55];if(result=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(color))
return[parseInt(result[1],16),parseInt(result[2],16),parseInt(result[3],16)];if(result=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(color))
return[parseInt(result[1]+result[1],16),parseInt(result[2]+result[2],16),parseInt(result[3]+result[3],16)];if(result=/rgba\(0, 0, 0, 0\)/.exec(color))
return colors['transparent'];return colors[$.trim(color).toLowerCase()];}
function getColor(elem,attr){var color;do{color=$.curCSS(elem,attr);if(color!=''&&color!='transparent'||$.nodeName(elem,"body"))
break;attr="backgroundColor";}while(elem=elem.parentNode);return getRGB(color);};var colors={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]};var classAnimationActions=['add','remove','toggle'],shorthandStyles={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};function getElementStyles(){var style=document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle,newStyle={},key,camelCase;if(style&&style.length&&style[0]&&style[style[0]]){var len=style.length;while(len--){key=style[len];if(typeof style[key]=='string'){camelCase=key.replace(/\-(\w)/g,function(all,letter){return letter.toUpperCase();});newStyle[camelCase]=style[key];}}}else{for(key in style){if(typeof style[key]==='string'){newStyle[key]=style[key];}}}
return newStyle;}
function filterStyles(styles){var name,value;for(name in styles){value=styles[name];if(value==null||$.isFunction(value)||name in shorthandStyles||(/scrollbar/).test(name)||(!(/color/i).test(name)&&isNaN(parseFloat(value)))){delete styles[name];}}
return styles;}
function styleDifference(oldStyle,newStyle){var diff={_:0},name;for(name in newStyle){if(oldStyle[name]!=newStyle[name]){diff[name]=newStyle[name];}}
return diff;}
$.effects.animateClass=function(value,duration,easing,callback){if($.isFunction(easing)){callback=easing;easing=null;}
return this.queue(function(){var that=$(this),originalStyleAttr=that.attr('style')||' ',originalStyle=filterStyles(getElementStyles.call(this)),newStyle,className=that.attr('class');$.each(classAnimationActions,function(i,action){if(value[action]){that[action+'Class'](value[action]);}});newStyle=filterStyles(getElementStyles.call(this));that.attr('class',className);that.animate(styleDifference(originalStyle,newStyle),{queue:false,duration:duration,easing:easing,complete:function(){$.each(classAnimationActions,function(i,action){if(value[action]){that[action+'Class'](value[action]);}});if(typeof that.attr('style')=='object'){that.attr('style').cssText='';that.attr('style').cssText=originalStyleAttr;}else{that.attr('style',originalStyleAttr);}
if(callback){callback.apply(this,arguments);}
$.dequeue(this);}});});};$.fn.extend({_addClass:$.fn.addClass,addClass:function(classNames,speed,easing,callback){return speed?$.effects.animateClass.apply(this,[{add:classNames},speed,easing,callback]):this._addClass(classNames);},_removeClass:$.fn.removeClass,removeClass:function(classNames,speed,easing,callback){return speed?$.effects.animateClass.apply(this,[{remove:classNames},speed,easing,callback]):this._removeClass(classNames);},_toggleClass:$.fn.toggleClass,toggleClass:function(classNames,force,speed,easing,callback){if(typeof force=="boolean"||force===undefined){if(!speed){return this._toggleClass(classNames,force);}else{return $.effects.animateClass.apply(this,[(force?{add:classNames}:{remove:classNames}),speed,easing,callback]);}}else{return $.effects.animateClass.apply(this,[{toggle:classNames},force,speed,easing]);}},switchClass:function(remove,add,speed,easing,callback){return $.effects.animateClass.apply(this,[{add:add,remove:remove},speed,easing,callback]);}});$.extend($.effects,{version:"1.8.14",save:function(element,set){for(var i=0;i<set.length;i++){if(set[i]!==null)element.data("ec.storage."+set[i],element[0].style[set[i]]);}},restore:function(element,set){for(var i=0;i<set.length;i++){if(set[i]!==null)element.css(set[i],element.data("ec.storage."+set[i]));}},setMode:function(el,mode){if(mode=='toggle')mode=el.is(':hidden')?'show':'hide';return mode;},getBaseline:function(origin,original){var y,x;switch(origin[0]){case'top':y=0;break;case'middle':y=0.5;break;case'bottom':y=1;break;default:y=origin[0]/original.height;};switch(origin[1]){case'left':x=0;break;case'center':x=0.5;break;case'right':x=1;break;default:x=origin[1]/original.width;};return{x:x,y:y};},createWrapper:function(element){if(element.parent().is('.ui-effects-wrapper')){return element.parent();}
var props={width:element.outerWidth(true),height:element.outerHeight(true),'float':element.css('float')},wrapper=$('<div></div>').addClass('ui-effects-wrapper').css({fontSize:'100%',background:'transparent',border:'none',margin:0,padding:0});element.wrap(wrapper);wrapper=element.parent();if(element.css('position')=='static'){wrapper.css({position:'relative'});element.css({position:'relative'});}else{$.extend(props,{position:element.css('position'),zIndex:element.css('z-index')});$.each(['top','left','bottom','right'],function(i,pos){props[pos]=element.css(pos);if(isNaN(parseInt(props[pos],10))){props[pos]='auto';}});element.css({position:'relative',top:0,left:0,right:'auto',bottom:'auto'});}
return wrapper.css(props).show();},removeWrapper:function(element){if(element.parent().is('.ui-effects-wrapper'))
return element.parent().replaceWith(element);return element;},setTransition:function(element,list,factor,value){value=value||{};$.each(list,function(i,x){unit=element.cssUnit(x);if(unit[0]>0)value[x]=unit[0]*factor+unit[1];});return value;}});function _normalizeArguments(effect,options,speed,callback){if(typeof effect=='object'){callback=options;speed=null;options=effect;effect=options.effect;}
if($.isFunction(options)){callback=options;speed=null;options={};}
if(typeof options=='number'||$.fx.speeds[options]){callback=speed;speed=options;options={};}
if($.isFunction(speed)){callback=speed;speed=null;}
options=options||{};speed=speed||options.duration;speed=$.fx.off?0:typeof speed=='number'?speed:speed in $.fx.speeds?$.fx.speeds[speed]:$.fx.speeds._default;callback=callback||options.complete;return[effect,options,speed,callback];}
function standardSpeed(speed){if(!speed||typeof speed==="number"||$.fx.speeds[speed]){return true;}
if(typeof speed==="string"&&!$.effects[speed]){return true;}
return false;}
$.fn.extend({effect:function(effect,options,speed,callback){var args=_normalizeArguments.apply(this,arguments),args2={options:args[1],duration:args[2],callback:args[3]},mode=args2.options.mode,effectMethod=$.effects[effect];if($.fx.off||!effectMethod){if(mode){return this[mode](args2.duration,args2.callback);}else{return this.each(function(){if(args2.callback){args2.callback.call(this);}});}}
return effectMethod.call(this,args2);},_show:$.fn.show,show:function(speed){if(standardSpeed(speed)){return this._show.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args[1].mode='show';return this.effect.apply(this,args);}},_hide:$.fn.hide,hide:function(speed){if(standardSpeed(speed)){return this._hide.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args[1].mode='hide';return this.effect.apply(this,args);}},__toggle:$.fn.toggle,toggle:function(speed){if(standardSpeed(speed)||typeof speed==="boolean"||$.isFunction(speed)){return this.__toggle.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args[1].mode='toggle';return this.effect.apply(this,args);}},cssUnit:function(key){var style=this.css(key),val=[];$.each(['em','px','%','pt'],function(i,unit){if(style.indexOf(unit)>0)
val=[parseFloat(style),unit];});return val;}});$.easing.jswing=$.easing.swing;$.extend($.easing,{def:'easeOutQuad',swing:function(x,t,b,c,d){return $.easing[$.easing.def](x,t,b,c,d);},easeInQuad:function(x,t,b,c,d){return c*(t/=d)*t+b;},easeOutQuad:function(x,t,b,c,d){return-c*(t/=d)*(t-2)+b;},easeInOutQuad:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t+b;return-c/2*((--t)*(t-2)-1)+b;},easeInCubic:function(x,t,b,c,d){return c*(t/=d)*t*t+b;},easeOutCubic:function(x,t,b,c,d){return c*((t=t/d-1)*t*t+1)+b;},easeInOutCubic:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t+b;return c/2*((t-=2)*t*t+2)+b;},easeInQuart:function(x,t,b,c,d){return c*(t/=d)*t*t*t+b;},easeOutQuart:function(x,t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b;},easeInOutQuart:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t*t+b;return-c/2*((t-=2)*t*t*t-2)+b;},easeInQuint:function(x,t,b,c,d){return c*(t/=d)*t*t*t*t+b;},easeOutQuint:function(x,t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b;},easeInOutQuint:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t*t*t+b;return c/2*((t-=2)*t*t*t*t+2)+b;},easeInSine:function(x,t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b;},easeOutSine:function(x,t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b;},easeInOutSine:function(x,t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b;},easeInExpo:function(x,t,b,c,d){return(t==0)?b:c*Math.pow(2,10*(t/d-1))+b;},easeOutExpo:function(x,t,b,c,d){return(t==d)?b+c:c*(-Math.pow(2,-10*t/d)+1)+b;},easeInOutExpo:function(x,t,b,c,d){if(t==0)return b;if(t==d)return b+c;if((t/=d/2)<1)return c/2*Math.pow(2,10*(t-1))+b;return c/2*(-Math.pow(2,-10*--t)+2)+b;},easeInCirc:function(x,t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b;},easeOutCirc:function(x,t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b;},easeInOutCirc:function(x,t,b,c,d){if((t/=d/2)<1)return-c/2*(Math.sqrt(1-t*t)-1)+b;return c/2*(Math.sqrt(1-(t-=2)*t)+1)+b;},easeInElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;},easeOutElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b;},easeInOutElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d/2)==2)return b+c;if(!p)p=d*(.3*1.5);if(a<Math.abs(c)){a=c;var s=p/4;}
else var s=p/(2*Math.PI)*Math.asin(c/a);if(t<1)return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*.5+c+b;},easeInBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b;},easeOutBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b;},easeInOutBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;if((t/=d/2)<1)return c/2*(t*t*(((s*=(1.525))+1)*t-s))+b;return c/2*((t-=2)*t*(((s*=(1.525))+1)*t+s)+2)+b;},easeInBounce:function(x,t,b,c,d){return c-$.easing.easeOutBounce(x,d-t,0,c,d)+b;},easeOutBounce:function(x,t,b,c,d){if((t/=d)<(1/2.75)){return c*(7.5625*t*t)+b;}else if(t<(2/2.75)){return c*(7.5625*(t-=(1.5/2.75))*t+.75)+b;}else if(t<(2.5/2.75)){return c*(7.5625*(t-=(2.25/2.75))*t+.9375)+b;}else{return c*(7.5625*(t-=(2.625/2.75))*t+.984375)+b;}},easeInOutBounce:function(x,t,b,c,d){if(t<d/2)return $.easing.easeInBounce(x,t*2,0,c,d)*.5+b;return $.easing.easeOutBounce(x,t*2-d,0,c,d)*.5+c*.5+b;}});})(jQuery);(function($,undefined){$.effects.blind=function(o){return this.queue(function(){var el=$(this),props=['position','top','bottom','left','right'];var mode=$.effects.setMode(el,o.options.mode||'hide');var direction=o.options.direction||'vertical';$.effects.save(el,props);el.show();var wrapper=$.effects.createWrapper(el).css({overflow:'hidden'});var ref=(direction=='vertical')?'height':'width';var distance=(direction=='vertical')?wrapper.height():wrapper.width();if(mode=='show')wrapper.css(ref,0);var animation={};animation[ref]=mode=='show'?distance:0;wrapper.animate(animation,o.duration,o.options.easing,function(){if(mode=='hide')el.hide();$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback)o.callback.apply(el[0],arguments);el.dequeue();});});};})(jQuery);(function($,undefined){$.effects.bounce=function(o){return this.queue(function(){var el=$(this),props=['position','top','bottom','left','right'];var mode=$.effects.setMode(el,o.options.mode||'effect');var direction=o.options.direction||'up';var distance=o.options.distance||20;var times=o.options.times||5;var speed=o.duration||250;if(/show|hide/.test(mode))props.push('opacity');$.effects.save(el,props);el.show();$.effects.createWrapper(el);var ref=(direction=='up'||direction=='down')?'top':'left';var motion=(direction=='up'||direction=='left')?'pos':'neg';var distance=o.options.distance||(ref=='top'?el.outerHeight({margin:true})/3:el.outerWidth({margin:true})/3);if(mode=='show')el.css('opacity',0).css(ref,motion=='pos'?-distance:distance);if(mode=='hide')distance=distance/(times*2);if(mode!='hide')times--;if(mode=='show'){var animation={opacity:1};animation[ref]=(motion=='pos'?'+=':'-=')+distance;el.animate(animation,speed/2,o.options.easing);distance=distance/2;times--;};for(var i=0;i<times;i++){var animation1={},animation2={};animation1[ref]=(motion=='pos'?'-=':'+=')+distance;animation2[ref]=(motion=='pos'?'+=':'-=')+distance;el.animate(animation1,speed/2,o.options.easing).animate(animation2,speed/2,o.options.easing);distance=(mode=='hide')?distance*2:distance/2;};if(mode=='hide'){var animation={opacity:0};animation[ref]=(motion=='pos'?'-=':'+=')+distance;el.animate(animation,speed/2,o.options.easing,function(){el.hide();$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback)o.callback.apply(this,arguments);});}else{var animation1={},animation2={};animation1[ref]=(motion=='pos'?'-=':'+=')+distance;animation2[ref]=(motion=='pos'?'+=':'-=')+distance;el.animate(animation1,speed/2,o.options.easing).animate(animation2,speed/2,o.options.easing,function(){$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback)o.callback.apply(this,arguments);});};el.queue('fx',function(){el.dequeue();});el.dequeue();});};})(jQuery);(function($,undefined){$.effects.clip=function(o){return this.queue(function(){var el=$(this),props=['position','top','bottom','left','right','height','width'];var mode=$.effects.setMode(el,o.options.mode||'hide');var direction=o.options.direction||'vertical';$.effects.save(el,props);el.show();var wrapper=$.effects.createWrapper(el).css({overflow:'hidden'});var animate=el[0].tagName=='IMG'?wrapper:el;var ref={size:(direction=='vertical')?'height':'width',position:(direction=='vertical')?'top':'left'};var distance=(direction=='vertical')?animate.height():animate.width();if(mode=='show'){animate.css(ref.size,0);animate.css(ref.position,distance/2);}
var animation={};animation[ref.size]=mode=='show'?distance:0;animation[ref.position]=mode=='show'?0:distance/2;animate.animate(animation,{queue:false,duration:o.duration,easing:o.options.easing,complete:function(){if(mode=='hide')el.hide();$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback)o.callback.apply(el[0],arguments);el.dequeue();}});});};})(jQuery);(function($,undefined){$.effects.drop=function(o){return this.queue(function(){var el=$(this),props=['position','top','bottom','left','right','opacity'];var mode=$.effects.setMode(el,o.options.mode||'hide');var direction=o.options.direction||'left';$.effects.save(el,props);el.show();$.effects.createWrapper(el);var ref=(direction=='up'||direction=='down')?'top':'left';var motion=(direction=='up'||direction=='left')?'pos':'neg';var distance=o.options.distance||(ref=='top'?el.outerHeight({margin:true})/2:el.outerWidth({margin:true})/2);if(mode=='show')el.css('opacity',0).css(ref,motion=='pos'?-distance:distance);var animation={opacity:mode=='show'?1:0};animation[ref]=(mode=='show'?(motion=='pos'?'+=':'-='):(motion=='pos'?'-=':'+='))+distance;el.animate(animation,{queue:false,duration:o.duration,easing:o.options.easing,complete:function(){if(mode=='hide')el.hide();$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback)o.callback.apply(this,arguments);el.dequeue();}});});};})(jQuery);(function($,undefined){$.effects.explode=function(o){return this.queue(function(){var rows=o.options.pieces?Math.round(Math.sqrt(o.options.pieces)):3;var cells=o.options.pieces?Math.round(Math.sqrt(o.options.pieces)):3;o.options.mode=o.options.mode=='toggle'?($(this).is(':visible')?'hide':'show'):o.options.mode;var el=$(this).show().css('visibility','hidden');var offset=el.offset();offset.top-=parseInt(el.css("marginTop"),10)||0;offset.left-=parseInt(el.css("marginLeft"),10)||0;var width=el.outerWidth(true);var height=el.outerHeight(true);for(var i=0;i<rows;i++){for(var j=0;j<cells;j++){el.clone().appendTo('body').wrap('<div></div>').css({position:'absolute',visibility:'visible',left:-j*(width/cells),top:-i*(height/rows)}).parent().addClass('ui-effects-explode').css({position:'absolute',overflow:'hidden',width:width/cells,height:height/rows,left:offset.left+j*(width/cells)+(o.options.mode=='show'?(j-Math.floor(cells/2))*(width/cells):0),top:offset.top+i*(height/rows)+(o.options.mode=='show'?(i-Math.floor(rows/2))*(height/rows):0),opacity:o.options.mode=='show'?0:1}).animate({left:offset.left+j*(width/cells)+(o.options.mode=='show'?0:(j-Math.floor(cells/2))*(width/cells)),top:offset.top+i*(height/rows)+(o.options.mode=='show'?0:(i-Math.floor(rows/2))*(height/rows)),opacity:o.options.mode=='show'?1:0},o.duration||500);}}
setTimeout(function(){o.options.mode=='show'?el.css({visibility:'visible'}):el.css({visibility:'visible'}).hide();if(o.callback)o.callback.apply(el[0]);el.dequeue();$('div.ui-effects-explode').remove();},o.duration||500);});};})(jQuery);(function($,undefined){$.effects.fade=function(o){return this.queue(function(){var elem=$(this),mode=$.effects.setMode(elem,o.options.mode||'hide');elem.animate({opacity:mode},{queue:false,duration:o.duration,easing:o.options.easing,complete:function(){(o.callback&&o.callback.apply(this,arguments));elem.dequeue();}});});};})(jQuery);(function($,undefined){$.effects.fold=function(o){return this.queue(function(){var el=$(this),props=['position','top','bottom','left','right'];var mode=$.effects.setMode(el,o.options.mode||'hide');var size=o.options.size||15;var horizFirst=!(!o.options.horizFirst);var duration=o.duration?o.duration/2:$.fx.speeds._default/2;$.effects.save(el,props);el.show();var wrapper=$.effects.createWrapper(el).css({overflow:'hidden'});var widthFirst=((mode=='show')!=horizFirst);var ref=widthFirst?['width','height']:['height','width'];var distance=widthFirst?[wrapper.width(),wrapper.height()]:[wrapper.height(),wrapper.width()];var percent=/([0-9]+)%/.exec(size);if(percent)size=parseInt(percent[1],10)/100*distance[mode=='hide'?0:1];if(mode=='show')wrapper.css(horizFirst?{height:0,width:size}:{height:size,width:0});var animation1={},animation2={};animation1[ref[0]]=mode=='show'?distance[0]:size;animation2[ref[1]]=mode=='show'?distance[1]:0;wrapper.animate(animation1,duration,o.options.easing).animate(animation2,duration,o.options.easing,function(){if(mode=='hide')el.hide();$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback)o.callback.apply(el[0],arguments);el.dequeue();});});};})(jQuery);(function($,undefined){$.effects.highlight=function(o){return this.queue(function(){var elem=$(this),props=['backgroundImage','backgroundColor','opacity'],mode=$.effects.setMode(elem,o.options.mode||'show'),animation={backgroundColor:elem.css('backgroundColor')};if(mode=='hide'){animation.opacity=0;}
$.effects.save(elem,props);elem.show().css({backgroundImage:'none',backgroundColor:o.options.color||'#ffff99'}).animate(animation,{queue:false,duration:o.duration,easing:o.options.easing,complete:function(){(mode=='hide'&&elem.hide());$.effects.restore(elem,props);(mode=='show'&&!$.support.opacity&&this.style.removeAttribute('filter'));(o.callback&&o.callback.apply(this,arguments));elem.dequeue();}});});};})(jQuery);(function($,undefined){$.effects.pulsate=function(o){return this.queue(function(){var elem=$(this),mode=$.effects.setMode(elem,o.options.mode||'show');times=((o.options.times||5)*2)-1;duration=o.duration?o.duration/2:$.fx.speeds._default/2,isVisible=elem.is(':visible'),animateTo=0;if(!isVisible){elem.css('opacity',0).show();animateTo=1;}
if((mode=='hide'&&isVisible)||(mode=='show'&&!isVisible)){times--;}
for(var i=0;i<times;i++){elem.animate({opacity:animateTo},duration,o.options.easing);animateTo=(animateTo+1)%2;}
elem.animate({opacity:animateTo},duration,o.options.easing,function(){if(animateTo==0){elem.hide();}
(o.callback&&o.callback.apply(this,arguments));});elem.queue('fx',function(){elem.dequeue();}).dequeue();});};})(jQuery);(function($,undefined){$.effects.puff=function(o){return this.queue(function(){var elem=$(this),mode=$.effects.setMode(elem,o.options.mode||'hide'),percent=parseInt(o.options.percent,10)||150,factor=percent/100,original={height:elem.height(),width:elem.width()};$.extend(o.options,{fade:true,mode:mode,percent:mode=='hide'?percent:100,from:mode=='hide'?original:{height:original.height*factor,width:original.width*factor}});elem.effect('scale',o.options,o.duration,o.callback);elem.dequeue();});};$.effects.scale=function(o){return this.queue(function(){var el=$(this);var options=$.extend(true,{},o.options);var mode=$.effects.setMode(el,o.options.mode||'effect');var percent=parseInt(o.options.percent,10)||(parseInt(o.options.percent,10)==0?0:(mode=='hide'?0:100));var direction=o.options.direction||'both';var origin=o.options.origin;if(mode!='effect'){options.origin=origin||['middle','center'];options.restore=true;}
var original={height:el.height(),width:el.width()};el.from=o.options.from||(mode=='show'?{height:0,width:0}:original);var factor={y:direction!='horizontal'?(percent/100):1,x:direction!='vertical'?(percent/100):1};el.to={height:original.height*factor.y,width:original.width*factor.x};if(o.options.fade){if(mode=='show'){el.from.opacity=0;el.to.opacity=1;};if(mode=='hide'){el.from.opacity=1;el.to.opacity=0;};};options.from=el.from;options.to=el.to;options.mode=mode;el.effect('size',options,o.duration,o.callback);el.dequeue();});};$.effects.size=function(o){return this.queue(function(){var el=$(this),props=['position','top','bottom','left','right','width','height','overflow','opacity'];var props1=['position','top','bottom','left','right','overflow','opacity'];var props2=['width','height','overflow'];var cProps=['fontSize'];var vProps=['borderTopWidth','borderBottomWidth','paddingTop','paddingBottom'];var hProps=['borderLeftWidth','borderRightWidth','paddingLeft','paddingRight'];var mode=$.effects.setMode(el,o.options.mode||'effect');var restore=o.options.restore||false;var scale=o.options.scale||'both';var origin=o.options.origin;var original={height:el.height(),width:el.width()};el.from=o.options.from||original;el.to=o.options.to||original;if(origin){var baseline=$.effects.getBaseline(origin,original);el.from.top=(original.height-el.from.height)*baseline.y;el.from.left=(original.width-el.from.width)*baseline.x;el.to.top=(original.height-el.to.height)*baseline.y;el.to.left=(original.width-el.to.width)*baseline.x;};var factor={from:{y:el.from.height/original.height,x:el.from.width/original.width},to:{y:el.to.height/original.height,x:el.to.width/original.width}};if(scale=='box'||scale=='both'){if(factor.from.y!=factor.to.y){props=props.concat(vProps);el.from=$.effects.setTransition(el,vProps,factor.from.y,el.from);el.to=$.effects.setTransition(el,vProps,factor.to.y,el.to);};if(factor.from.x!=factor.to.x){props=props.concat(hProps);el.from=$.effects.setTransition(el,hProps,factor.from.x,el.from);el.to=$.effects.setTransition(el,hProps,factor.to.x,el.to);};};if(scale=='content'||scale=='both'){if(factor.from.y!=factor.to.y){props=props.concat(cProps);el.from=$.effects.setTransition(el,cProps,factor.from.y,el.from);el.to=$.effects.setTransition(el,cProps,factor.to.y,el.to);};};$.effects.save(el,restore?props:props1);el.show();$.effects.createWrapper(el);el.css('overflow','hidden').css(el.from);if(scale=='content'||scale=='both'){vProps=vProps.concat(['marginTop','marginBottom']).concat(cProps);hProps=hProps.concat(['marginLeft','marginRight']);props2=props.concat(vProps).concat(hProps);el.find("*[width]").each(function(){child=$(this);if(restore)$.effects.save(child,props2);var c_original={height:child.height(),width:child.width()};child.from={height:c_original.height*factor.from.y,width:c_original.width*factor.from.x};child.to={height:c_original.height*factor.to.y,width:c_original.width*factor.to.x};if(factor.from.y!=factor.to.y){child.from=$.effects.setTransition(child,vProps,factor.from.y,child.from);child.to=$.effects.setTransition(child,vProps,factor.to.y,child.to);};if(factor.from.x!=factor.to.x){child.from=$.effects.setTransition(child,hProps,factor.from.x,child.from);child.to=$.effects.setTransition(child,hProps,factor.to.x,child.to);};child.css(child.from);child.animate(child.to,o.duration,o.options.easing,function(){if(restore)$.effects.restore(child,props2);});});};el.animate(el.to,{queue:false,duration:o.duration,easing:o.options.easing,complete:function(){if(el.to.opacity===0){el.css('opacity',el.from.opacity);}
if(mode=='hide')el.hide();$.effects.restore(el,restore?props:props1);$.effects.removeWrapper(el);if(o.callback)o.callback.apply(this,arguments);el.dequeue();}});});};})(jQuery);(function($,undefined){$.effects.shake=function(o){return this.queue(function(){var el=$(this),props=['position','top','bottom','left','right'];var mode=$.effects.setMode(el,o.options.mode||'effect');var direction=o.options.direction||'left';var distance=o.options.distance||20;var times=o.options.times||3;var speed=o.duration||o.options.duration||140;$.effects.save(el,props);el.show();$.effects.createWrapper(el);var ref=(direction=='up'||direction=='down')?'top':'left';var motion=(direction=='up'||direction=='left')?'pos':'neg';var animation={},animation1={},animation2={};animation[ref]=(motion=='pos'?'-=':'+=')+distance;animation1[ref]=(motion=='pos'?'+=':'-=')+distance*2;animation2[ref]=(motion=='pos'?'-=':'+=')+distance*2;el.animate(animation,speed,o.options.easing);for(var i=1;i<times;i++){el.animate(animation1,speed,o.options.easing).animate(animation2,speed,o.options.easing);};el.animate(animation1,speed,o.options.easing).animate(animation,speed/2,o.options.easing,function(){$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback)o.callback.apply(this,arguments);});el.queue('fx',function(){el.dequeue();});el.dequeue();});};})(jQuery);(function($,undefined){$.effects.slide=function(o){return this.queue(function(){var el=$(this),props=['position','top','bottom','left','right'];var mode=$.effects.setMode(el,o.options.mode||'show');var direction=o.options.direction||'left';$.effects.save(el,props);el.show();$.effects.createWrapper(el).css({overflow:'hidden'});var ref=(direction=='up'||direction=='down')?'top':'left';var motion=(direction=='up'||direction=='left')?'pos':'neg';var distance=o.options.distance||(ref=='top'?el.outerHeight({margin:true}):el.outerWidth({margin:true}));if(mode=='show')el.css(ref,motion=='pos'?(isNaN(distance)?"-"+distance:-distance):distance);var animation={};animation[ref]=(mode=='show'?(motion=='pos'?'+=':'-='):(motion=='pos'?'-=':'+='))+distance;el.animate(animation,{queue:false,duration:o.duration,easing:o.options.easing,complete:function(){if(mode=='hide')el.hide();$.effects.restore(el,props);$.effects.removeWrapper(el);if(o.callback)o.callback.apply(this,arguments);el.dequeue();}});});};})(jQuery);(function($,undefined){$.effects.transfer=function(o){return this.queue(function(){var elem=$(this),target=$(o.options.to),endPosition=target.offset(),animation={top:endPosition.top,left:endPosition.left,height:target.innerHeight(),width:target.innerWidth()},startPosition=elem.offset(),transfer=$('<div class="ui-effects-transfer"></div>').appendTo(document.body).addClass(o.options.className).css({top:startPosition.top,left:startPosition.left,height:elem.innerHeight(),width:elem.innerWidth(),position:'absolute'}).animate(animation,o.duration,o.options.easing,function(){transfer.remove();(o.callback&&o.callback.apply(elem[0],arguments));elem.dequeue();});});};})(jQuery);;(function($){var expr=(function(){if(!$.browser.msie)return false;var div=document.createElement('div');try{div.style.setExpression('width','0+0');}
catch(e){return false;}
return true;})();function sz(el,p){return parseInt($.css(el,p))||0;};function hex2(s){var s=parseInt(s).toString(16);return(s.length<2)?'0'+s:s;};function gpc(node){for(;node&&node.nodeName.toLowerCase()!='html';node=node.parentNode){var v=$.css(node,'backgroundColor');if(v=='rgba(0, 0, 0, 0)')
continue;if(v.indexOf('rgb')>=0){var rgb=v.match(/\d+/g);return'#'+hex2(rgb[0])+hex2(rgb[1])+hex2(rgb[2]);}
if(v&&v!='transparent')
return v;}
return'#ffffff';};function getWidth(fx,i,width){switch(fx){case'round':return Math.round(width*(1-Math.cos(Math.asin(i/width))));case'cool':return Math.round(width*(1+Math.cos(Math.asin(i/width))));case'sharp':return Math.round(width*(1-Math.cos(Math.acos(i/width))));case'bite':return Math.round(width*(Math.cos(Math.asin((width-i-1)/width))));case'slide':return Math.round(width*(Math.atan2(i,width/i)));case'jut':return Math.round(width*(Math.atan2(width,(width-i-1))));case'curl':return Math.round(width*(Math.atan(i)));case'tear':return Math.round(width*(Math.cos(i)));case'wicked':return Math.round(width*(Math.tan(i)));case'long':return Math.round(width*(Math.sqrt(i)));case'sculpt':return Math.round(width*(Math.log((width-i-1),width)));case'dog':return(i&1)?(i+1):width;case'dog2':return(i&2)?(i+1):width;case'dog3':return(i&3)?(i+1):width;case'fray':return(i%2)*width;case'notch':return width;case'bevel':return i+1;}};$.fn.corner=function(o){if(this.length==0){if(!$.isReady&&this.selector){var s=this.selector,c=this.context;$(function(){$(s,c).corner(o);});}
return this;}
o=(o||"").toLowerCase();var keep=/keep/.test(o);var cc=((o.match(/cc:(#[0-9a-f]+)/)||[])[1]);var sc=((o.match(/sc:(#[0-9a-f]+)/)||[])[1]);var width=parseInt((o.match(/(\d+)px/)||[])[1])||10;var re=/round|bevel|notch|bite|cool|sharp|slide|jut|curl|tear|fray|wicked|sculpt|long|dog3|dog2|dog/;var fx=((o.match(re)||['round'])[0]);var edges={T:0,B:1};var opts={TL:/top|tl/.test(o),TR:/top|tr/.test(o),BL:/bottom|bl/.test(o),BR:/bottom|br/.test(o)};if(!opts.TL&&!opts.TR&&!opts.BL&&!opts.BR)
opts={TL:1,TR:1,BL:1,BR:1};var strip=document.createElement('div');strip.style.overflow='hidden';strip.style.height='1px';strip.style.backgroundColor=sc||'transparent';strip.style.borderStyle='solid';return this.each(function(index){var pad={T:parseInt($.css(this,'paddingTop'))||0,R:parseInt($.css(this,'paddingRight'))||0,B:parseInt($.css(this,'paddingBottom'))||0,L:parseInt($.css(this,'paddingLeft'))||0};if(typeof this.style.zoom!=undefined)this.style.zoom=1;if(!keep)this.style.border='none';strip.style.borderColor=cc||gpc(this.parentNode);var cssHeight=$.curCSS(this,'height');for(var j in edges){var bot=edges[j];if((bot&&(opts.BL||opts.BR))||(!bot&&(opts.TL||opts.TR))){strip.style.borderStyle='none '+(opts[j+'R']?'solid':'none')+' none '+(opts[j+'L']?'solid':'none');var d=document.createElement('div');$(d).addClass('jquery-corner');var ds=d.style;bot?this.appendChild(d):this.insertBefore(d,this.firstChild);if(bot&&cssHeight!='auto'){if($.css(this,'position')=='static')
this.style.position='relative';ds.position='absolute';ds.bottom=ds.left=ds.padding=ds.margin='0';if(expr)
ds.setExpression('width','this.parentNode.offsetWidth');else
ds.width='100%';}
else if(!bot&&$.browser.msie){if($.css(this,'position')=='static')
this.style.position='relative';ds.position='absolute';ds.top=ds.left=ds.right=ds.padding=ds.margin='0';if(expr){var bw=sz(this,'borderLeftWidth')+sz(this,'borderRightWidth');ds.setExpression('width','this.parentNode.offsetWidth - '+bw+'+ "px"');}
else
ds.width='100%';}
else{ds.margin=!bot?'-'+pad.T+'px -'+pad.R+'px '+(pad.T-width)+'px -'+pad.L+'px':(pad.B-width)+'px -'+pad.R+'px -'+pad.B+'px -'+pad.L+'px';}
for(var i=0;i<width;i++){var w=Math.max(0,getWidth(fx,i,width));var e=strip.cloneNode(false);e.style.borderWidth='0 '+(opts[j+'R']?w:0)+'px 0 '+(opts[j+'L']?w:0)+'px';bot?d.appendChild(e):d.insertBefore(e,d.firstChild);}}}});};$.fn.uncorner=function(){$('div.jquery-corner',this).remove();return this;};})(jQuery);(function($){$.fn.bgIframe=$.fn.bgiframe=function(s){if($.browser.msie&&/MSIE 6.0/.test(navigator.userAgent)){s=$.extend({top:'auto',left:'auto',width:'auto',height:'auto',opacity:true,src:'javascript:false;'},s||{});var prop=function(n){return n&&n.constructor==Number?n+'px':n;},html='<iframe class="bgiframe"frameborder="0"tabindex="-1"src="'+s.src+'"'+'style="display:block;position:absolute;z-index:-1;'+
(s.opacity!==false?'filter:Alpha(Opacity=\'0\');':'')+'top:'+(s.top=='auto'?'expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)||0)*-1)+\'px\')':prop(s.top))+';'+'left:'+(s.left=='auto'?'expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth)||0)*-1)+\'px\')':prop(s.left))+';'+'width:'+(s.width=='auto'?'expression(this.parentNode.offsetWidth+\'px\')':prop(s.width))+';'+'height:'+(s.height=='auto'?'expression(this.parentNode.offsetHeight+\'px\')':prop(s.height))+';'+'"/>';return this.each(function(){if($('> iframe.bgiframe',this).length==0)
this.insertBefore(document.createElement(html),this.firstChild);});}
return this;};})(jQuery);(function($){function addEvents(ul){var settings=$.data($(ul).parents().andSelf().filter('ul.jd_menu')[0],'jdMenuSettings');$('> li',ul).bind('mouseenter.jdmenu mouseleave.jdmenu',function(evt){$(this).toggleClass('jdm_hover');var ul=$('> ul',this);if(ul.length==1){clearTimeout(this.$jdTimer);var enter=(evt.type=='mouseenter');var fn=(enter?showMenu:hideMenu);this.$jdTimer=setTimeout(function(){fn(ul[0],settings.onAnimate,settings.isVertical);},enter?settings.showDelay:settings.hideDelay);}}).bind('click.jdmenu',function(evt){var ul=$('> ul',this);if(ul.length==1&&(settings.disableLinks==true||$(this).hasClass('accessible'))){showMenu(ul,settings.onAnimate,settings.isVertical);return false;}
if(evt.target==this){var link=$('> a',evt.target).not('.accessible');if(link.length>0){var a=link[0];if(!a.onclick){window.open(a.href,a.target||'_self');}else{$(a).trigger('click');}}}
if(settings.disableLinks||(!settings.disableLinks&&!$(this).parent().hasClass('jd_menu'))){$(this).parent().jdMenuHide();evt.stopPropagation();}}).find('> a').bind('focus.jdmenu blur.jdmenu',function(evt){var p=$(this).parents('li:eq(0)');if(evt.type=='focus'){p.addClass('jdm_hover');}else{p.removeClass('jdm_hover');}}).filter('.accessible').bind('click.jdmenu',function(evt){evt.preventDefault();});}
function showMenu(ul,animate,vertical){var ul=$(ul);if(ul.is(':visible')){return;}
ul.bgiframe();var li=ul.parent();ul.trigger('jdMenuShow').positionBy({target:li[0],targetPos:(vertical===true||!li.parent().hasClass('jd_menu')?1:3),elementPos:0,hideAfterPosition:true});if(!ul.hasClass('jdm_events')){ul.addClass('jdm_events');addEvents(ul);}
li.addClass('jdm_active').siblings('li').find('> ul:eq(0):visible').each(function(){hideMenu(this);});if(animate===undefined){ul.show();}else{animate.apply(ul[0],[true]);}}
function hideMenu(ul,animate){var ul=$(ul);$('.bgiframe',ul).remove();ul.filter(':not(.jd_menu)').find('> li > ul:eq(0):visible').each(function(){hideMenu(this);}).end();if(animate===undefined){ul.hide()}else{animate.apply(ul[0],[false]);}
ul.trigger('jdMenuHide').parents('li:eq(0)').removeClass('jdm_active jdm_hover').end().find('> li').removeClass('jdm_active jdm_hover');}
$.fn.jdMenu=function(settings){var settings=$.extend({showDelay:200,hideDelay:500,disableLinks:true},settings);if(!$.isFunction(settings.onAnimate)){settings.onAnimate=undefined;}
return this.filter('ul.jd_menu').each(function(){$.data(this,'jdMenuSettings',$.extend({isVertical:$(this).hasClass('jd_menu_vertical')},settings));addEvents(this);});};$.fn.jdMenuUnbind=function(){$('ul.jdm_events',this).unbind('.jdmenu').find('> a').unbind('.jdmenu');};$.fn.jdMenuHide=function(){return this.filter('ul').each(function(){hideMenu(this);});};$(window).bind('click.jdmenu',function(){$('ul.jd_menu ul:visible').jdMenuHide();});})(jQuery);$(function(){$('ul.jd_menu').jdMenu();});(function($){var Range=function(x1,y1,x2,y2){this.x1=x1;this.x2=x2;this.y1=y1;this.y2=y2;};Range.prototype.contains=function(range){return(this.x1<=range.x1&&range.x2<=this.x2)&&(this.y1<=range.y1&&range.y2<=this.y2);};Range.prototype.transform=function(x,y){return new Range(this.x1+x,this.y1+y,this.x2+x,this.y2+y);};$.fn.positionBy=function(args){var date1=new Date();if(this.length==0){return this;}
var args=$.extend({target:null,targetPos:null,elementPos:null,x:null,y:null,positions:null,addClass:false,force:false,container:window,hideAfterPosition:false},args);if(args.x!=null){var tLeft=args.x;var tTop=args.y;var tWidth=0;var tHeight=0;}else{var $target=$($(args.target)[0]);var tWidth=$target.outerWidth();var tHeight=$target.outerHeight();var tOffset=$target.offset();var tLeft=tOffset.left;var tTop=tOffset.top;}
var tRight=tLeft+tWidth;var tBottom=tTop+tHeight;return this.each(function(){var $element=$(this);if(!$element.is(':visible')){$element.css({left:-3000,top:-3000}).show();}
var eWidth=$element.outerWidth();var eHeight=$element.outerHeight();var position=[];var next=[];position[0]=new Range(tRight,tTop,tRight+eWidth,tTop+eHeight);next[0]=[1,7,4];position[1]=new Range(tRight,tBottom-eHeight,tRight+eWidth,tBottom);next[1]=[0,6,4];position[2]=new Range(tRight,tBottom,tRight+eWidth,tBottom+eHeight);next[2]=[1,3,10];position[3]=new Range(tRight-eWidth,tBottom,tRight,tBottom+eHeight);next[3]=[1,6,10];position[4]=new Range(tLeft,tBottom,tLeft+eWidth,tBottom+eHeight);next[4]=[1,6,9];position[5]=new Range(tLeft-eWidth,tBottom,tLeft,tBottom+eHeight);next[5]=[6,4,9];position[6]=new Range(tLeft-eWidth,tBottom-eHeight,tLeft,tBottom);next[6]=[7,1,4];position[7]=new Range(tLeft-eWidth,tTop,tLeft,tTop+eHeight);next[7]=[6,0,4];position[8]=new Range(tLeft-eWidth,tTop-eHeight,tLeft,tTop);next[8]=[7,9,4];position[9]=new Range(tLeft,tTop-eHeight,tLeft+eWidth,tTop);next[9]=[0,7,4];position[10]=new Range(tRight-eWidth,tTop-eHeight,tRight,tTop);next[10]=[0,7,3];position[11]=new Range(tRight,tTop-eHeight,tRight+eWidth,tTop);next[11]=[0,10,3];position[12]=new Range(tRight-eWidth,tTop,tRight,tTop+eHeight);next[12]=[13,7,10];position[13]=new Range(tRight-eWidth,tBottom-eHeight,tRight,tBottom);next[13]=[12,6,3];position[14]=new Range(tLeft,tBottom-eHeight,tLeft+eWidth,tBottom);next[14]=[15,1,4];position[15]=new Range(tLeft,tTop,tLeft+eWidth,tTop+eHeight);next[15]=[14,0,9];if(args.positions!==null){var pos=args.positions[0];}else if(args.targetPos!=null&&args.elementPos!=null){var pos=[];pos[0]=[];pos[0][0]=15;pos[0][1]=7;pos[0][2]=8;pos[0][3]=9;pos[1]=[];pos[1][0]=0;pos[1][1]=12;pos[1][2]=10;pos[1][3]=11;pos[2]=[];pos[2][0]=2;pos[2][1]=3;pos[2][2]=13;pos[2][3]=1;pos[3]=[];pos[3][0]=4;pos[3][1]=5;pos[3][2]=6;pos[3][3]=14;var pos=pos[args.targetPos][args.elementPos];}
var ePos=position[pos];var fPos=pos;if(!args.force){$window=$(window);var sx=$window.scrollLeft();var sy=$window.scrollTop();var container=new Range(sx,sy,sx+$window.width(),sy+$window.height());var stack;if(args.positions){stack=args.positions;}else{stack=[pos];}
var test=[];while(stack.length>0){var p=stack.shift();if(test[p]){continue;}
test[p]=true;if(!container.contains(position[p])){if(args.positions===null){stack=jQuery.merge(stack,next[p]);}}else{ePos=position[p];break;}}}
$element.parents().each(function(){var $this=$(this);if($this.css('position')!='static'){var abs=$this.offset();ePos=ePos.transform(-abs.left,-abs.top);return false;}});var css={left:ePos.x1,top:ePos.y1};if(args.hideAfterPosition){css['display']='none';}
$element.css(css);if(args.addClass){$element.removeClass('positionBy0 positionBy1 positionBy2 positionBy3 positionBy4 positionBy5 '
+'positionBy6 positionBy7 positionBy8 positionBy9 positionBy10 positionBy11 '
+'positionBy12 positionBy13 positionBy14 positionBy15').addClass('positionBy'+p);}});};})(jQuery);;(function($){var helper={},current,title,tID,IE=$.browser.msie&&/MSIE\s(5\.5|6\.)/.test(navigator.userAgent),track=false;$.tooltip={blocked:false,defaults:{delay:200,fade:false,showURL:true,extraClass:"",top:15,left:15,id:"tooltip"},block:function(){$.tooltip.blocked=!$.tooltip.blocked;}};$.fn.extend({tooltip:function(settings){settings=$.extend({},$.tooltip.defaults,settings);createHelper(settings);return this.each(function(){$.data(this,"tooltip",settings);this.tOpacity=helper.parent.css("opacity");this.tooltipText=this.title;$(this).removeAttr("title");this.alt="";}).mouseover(save).mouseout(hide).click(hide);},fixPNG:IE?function(){return this.each(function(){var image=$(this).css('backgroundImage');if(image.match(/^url\(["']?(.*\.png)["']?\)$/i)){image=RegExp.$1;$(this).css({'backgroundImage':'none','filter':"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+image+"')"}).each(function(){var position=$(this).css('position');if(position!='absolute'&&position!='relative')
$(this).css('position','relative');});}});}:function(){return this;},unfixPNG:IE?function(){return this.each(function(){$(this).css({'filter':'',backgroundImage:''});});}:function(){return this;},hideWhenEmpty:function(){return this.each(function(){$(this)[$(this).html()?"show":"hide"]();});},url:function(){return this.attr('href')||this.attr('src');}});function createHelper(settings){if(helper.parent)
return;helper.parent=$('<div id="'+settings.id+'"><h3></h3><div class="body"></div><div class="url"></div></div>').appendTo(document.body).hide();if($.fn.bgiframe)
helper.parent.bgiframe();helper.title=$('h3',helper.parent);helper.body=$('div.body',helper.parent);helper.url=$('div.url',helper.parent);}
function settings(element){return $.data(element,"tooltip");}
function handle(event){if(settings(this).delay)
tID=setTimeout(show,settings(this).delay);else
show();track=!!settings(this).track;$(document.body).bind('mousemove',update);update(event);}
function save(){if($.tooltip.blocked||this==current||(!this.tooltipText&&!settings(this).bodyHandler))
return;current=this;title=this.tooltipText;if(settings(this).bodyHandler){helper.title.hide();var bodyContent=settings(this).bodyHandler.call(this);if(bodyContent.nodeType||bodyContent.jquery){helper.body.empty().append(bodyContent)}else{helper.body.html(bodyContent);}
helper.body.show();}else if(settings(this).showBody){var parts=title.split(settings(this).showBody);helper.title.html(parts.shift()).show();helper.body.empty();for(var i=0,part;(part=parts[i]);i++){if(i>0)
helper.body.append("<br/>");helper.body.append(part);}
helper.body.hideWhenEmpty();}else{helper.title.html(title).show();helper.body.hide();}
if(settings(this).showURL&&$(this).url())
helper.url.html($(this).url().replace('http://','')).show();else
helper.url.hide();helper.parent.addClass(settings(this).extraClass);if(settings(this).fixPNG)
helper.parent.fixPNG();handle.apply(this,arguments);}
function show(){tID=null;if((!IE||!$.fn.bgiframe)&&settings(current).fade){if(helper.parent.is(":animated"))
helper.parent.stop().show().fadeTo(settings(current).fade,current.tOpacity);else
helper.parent.is(':visible')?helper.parent.fadeTo(settings(current).fade,current.tOpacity):helper.parent.fadeIn(settings(current).fade);}else{helper.parent.show();}
update();}
function update(event){if($.tooltip.blocked)
return;if(event&&event.target.tagName=="OPTION"){return;}
if(!track&&helper.parent.is(":visible")){$(document.body).unbind('mousemove',update)}
if(current==null){$(document.body).unbind('mousemove',update);return;}
helper.parent.removeClass("viewport-right").removeClass("viewport-bottom");var left=helper.parent[0].offsetLeft;var top=helper.parent[0].offsetTop;if(event){left=event.pageX+settings(current).left;top=event.pageY+settings(current).top;var right='auto';if(settings(current).positionLeft){right=$(window).width()-left;left='auto';}
helper.parent.css({left:left,right:right,top:top});}
var v=viewport(),h=helper.parent[0];if(v.x+v.cx<h.offsetLeft+h.offsetWidth){left-=h.offsetWidth+20+settings(current).left;helper.parent.css({left:left+'px'}).addClass("viewport-right");}
if(v.y+v.cy<h.offsetTop+h.offsetHeight){top-=h.offsetHeight+20+settings(current).top;helper.parent.css({top:top+'px'}).addClass("viewport-bottom");}}
function viewport(){return{x:$(window).scrollLeft(),y:$(window).scrollTop(),cx:$(window).width(),cy:$(window).height()};}
function hide(event){if($.tooltip.blocked)
return;if(tID)
clearTimeout(tID);current=null;var tsettings=settings(this);function complete(){helper.parent.removeClass(tsettings.extraClass).hide().css("opacity","");}
if((!IE||!$.fn.bgiframe)&&tsettings.fade){if(helper.parent.is(':animated'))
helper.parent.stop().fadeTo(tsettings.fade,0,complete);else
helper.parent.stop().fadeOut(tsettings.fade,complete);}else
complete();if(settings(this).fixPNG)
helper.parent.unfixPNG();}})(jQuery);;(function($){if(/1\.(0|1|2)\.(0|1|2)/.test($.fn.jquery)||/^1.1/.test($.fn.jquery)){alert('blockUI requires jQuery v1.2.3 or later!  You are using v'+$.fn.jquery);return;}
$.fn._fadeIn=$.fn.fadeIn;var noOp=function(){};var mode=document.documentMode||0;var setExpr=$.browser.msie&&(($.browser.version<8&&!mode)||mode<8);var ie6=$.browser.msie&&/MSIE 6.0/.test(navigator.userAgent)&&!mode;$.blockUI=function(opts){install(window,opts);};$.unblockUI=function(opts){remove(window,opts);};$.growlUI=function(title,message,timeout,onClose){var $m=$('<div class="growlUI"></div>');if(title)$m.append('<h1>'+title+'</h1>');if(message)$m.append('<h2>'+message+'</h2>');if(timeout==undefined)timeout=3000;$.blockUI({message:$m,fadeIn:700,fadeOut:1000,centerY:false,timeout:timeout,showOverlay:false,onUnblock:onClose,css:$.blockUI.defaults.growlCSS});};$.fn.block=function(opts){return this.unblock({fadeOut:0}).each(function(){if($.css(this,'position')=='static')
this.style.position='relative';if($.browser.msie)
this.style.zoom=1;install(this,opts);});};$.fn.unblock=function(opts){return this.each(function(){remove(this,opts);});};$.blockUI.version=2.33;$.blockUI.defaults={message:'<h1>Please wait...</h1>',title:null,draggable:true,theme:false,css:{padding:0,margin:0,width:'30%',top:'40%',left:'35%',textAlign:'center',color:'#000',border:'3px solid #aaa',backgroundColor:'#fff',cursor:'wait'},themedCSS:{width:'30%',top:'40%',left:'35%'},overlayCSS:{backgroundColor:'#000',opacity:0.6,cursor:'wait'},growlCSS:{width:'350px',top:'10px',left:'',right:'10px',border:'none',padding:'5px',opacity:0.6,cursor:'default',color:'#fff',backgroundColor:'#000','-webkit-border-radius':'10px','-moz-border-radius':'10px','border-radius':'10px'},iframeSrc:/^https/i.test(window.location.href||'')?'javascript:false':'about:blank',forceIframe:false,baseZ:1000,centerX:true,centerY:true,allowBodyStretch:true,bindEvents:true,constrainTabKey:true,fadeIn:200,fadeOut:400,timeout:0,showOverlay:true,focusInput:true,applyPlatformOpacityRules:true,onBlock:null,onUnblock:null,quirksmodeOffsetHack:4};var pageBlock=null;var pageBlockEls=[];function install(el,opts){var full=(el==window);var msg=opts&&opts.message!==undefined?opts.message:undefined;opts=$.extend({},$.blockUI.defaults,opts||{});opts.overlayCSS=$.extend({},$.blockUI.defaults.overlayCSS,opts.overlayCSS||{});var css=$.extend({},$.blockUI.defaults.css,opts.css||{});var themedCSS=$.extend({},$.blockUI.defaults.themedCSS,opts.themedCSS||{});msg=msg===undefined?opts.message:msg;if(full&&pageBlock)
remove(window,{fadeOut:0});if(msg&&typeof msg!='string'&&(msg.parentNode||msg.jquery)){var node=msg.jquery?msg[0]:msg;var data={};$(el).data('blockUI.history',data);data.el=node;data.parent=node.parentNode;data.display=node.style.display;data.position=node.style.position;if(data.parent)
data.parent.removeChild(node);}
var z=opts.baseZ;var lyr1=($.browser.msie||opts.forceIframe)?$('<iframe class="blockUI" style="z-index:'+(z++)+';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="'+opts.iframeSrc+'"></iframe>'):$('<div class="blockUI" style="display:none"></div>');var lyr2=$('<div class="blockUI blockOverlay" style="z-index:'+(z++)+';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>');var lyr3,s;if(opts.theme&&full){s='<div class="blockUI blockMsg blockPage ui-dialog ui-widget ui-corner-all" style="z-index:'+z+';display:none;position:fixed">'+'<div class="ui-widget-header ui-dialog-titlebar blockTitle">'+(opts.title||'&nbsp;')+'</div>'+'<div class="ui-widget-content ui-dialog-content"></div>'+'</div>';}
else if(opts.theme){s='<div class="blockUI blockMsg blockElement ui-dialog ui-widget ui-corner-all" style="z-index:'+z+';display:none;position:absolute">'+'<div class="ui-widget-header ui-dialog-titlebar blockTitle">'+(opts.title||'&nbsp;')+'</div>'+'<div class="ui-widget-content ui-dialog-content"></div>'+'</div>';}
else if(full){s='<div class="blockUI blockMsg blockPage" style="z-index:'+z+';display:none;position:fixed"></div>';}
else{s='<div class="blockUI blockMsg blockElement" style="z-index:'+z+';display:none;position:absolute"></div>';}
lyr3=$(s);if(msg){if(opts.theme){lyr3.css(themedCSS);lyr3.addClass('ui-widget-content');}
else
lyr3.css(css);}
if(!opts.applyPlatformOpacityRules||!($.browser.mozilla&&/Linux/.test(navigator.platform)))
lyr2.css(opts.overlayCSS);lyr2.css('position',full?'fixed':'absolute');if($.browser.msie||opts.forceIframe)
lyr1.css('opacity',0.0);var layers=[lyr1,lyr2,lyr3],$par=full?$('body'):$(el);$.each(layers,function(){this.appendTo($par);});if(opts.theme&&opts.draggable&&$.fn.draggable){lyr3.draggable({handle:'.ui-dialog-titlebar',cancel:'li'});}
var expr=setExpr&&(!$.boxModel||$('object,embed',full?null:el).length>0);if(ie6||expr){if(full&&opts.allowBodyStretch&&$.boxModel)
$('html,body').css('height','100%');if((ie6||!$.boxModel)&&!full){var t=sz(el,'borderTopWidth'),l=sz(el,'borderLeftWidth');var fixT=t?'(0 - '+t+')':0;var fixL=l?'(0 - '+l+')':0;}
$.each([lyr1,lyr2,lyr3],function(i,o){var s=o[0].style;s.position='absolute';if(i<2){full?s.setExpression('height','Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.boxModel?0:'+opts.quirksmodeOffsetHack+') + "px"'):s.setExpression('height','this.parentNode.offsetHeight + "px"');full?s.setExpression('width','jQuery.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"'):s.setExpression('width','this.parentNode.offsetWidth + "px"');if(fixL)s.setExpression('left',fixL);if(fixT)s.setExpression('top',fixT);}
else if(opts.centerY){if(full)s.setExpression('top','(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"');s.marginTop=0;}
else if(!opts.centerY&&full){var top=(opts.css&&opts.css.top)?parseInt(opts.css.top):0;var expression='((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + '+top+') + "px"';s.setExpression('top',expression);}});}
if(msg){if(opts.theme)
lyr3.find('.ui-widget-content').append(msg);else
lyr3.append(msg);if(msg.jquery||msg.nodeType)
$(msg).show();}
if(($.browser.msie||opts.forceIframe)&&opts.showOverlay)
lyr1.show();if(opts.fadeIn){var cb=opts.onBlock?opts.onBlock:noOp;var cb1=(opts.showOverlay&&!msg)?cb:noOp;var cb2=msg?cb:noOp;if(opts.showOverlay)
lyr2._fadeIn(opts.fadeIn,cb1);if(msg)
lyr3._fadeIn(opts.fadeIn,cb2);}
else{if(opts.showOverlay)
lyr2.show();if(msg)
lyr3.show();if(opts.onBlock)
opts.onBlock();}
bind(1,el,opts);if(full){pageBlock=lyr3[0];pageBlockEls=$(':input:enabled:visible',pageBlock);if(opts.focusInput)
setTimeout(focus,20);}
else
center(lyr3[0],opts.centerX,opts.centerY);if(opts.timeout){var to=setTimeout(function(){full?$.unblockUI(opts):$(el).unblock(opts);},opts.timeout);$(el).data('blockUI.timeout',to);}};function remove(el,opts){var full=(el==window);var $el=$(el);var data=$el.data('blockUI.history');var to=$el.data('blockUI.timeout');if(to){clearTimeout(to);$el.removeData('blockUI.timeout');}
opts=$.extend({},$.blockUI.defaults,opts||{});bind(0,el,opts);var els;if(full)
els=$('body').children().filter('.blockUI').add('body > .blockUI');else
els=$('.blockUI',el);if(full)
pageBlock=pageBlockEls=null;if(opts.fadeOut){els.fadeOut(opts.fadeOut);setTimeout(function(){reset(els,data,opts,el);},opts.fadeOut);}
else
reset(els,data,opts,el);};function reset(els,data,opts,el){els.each(function(i,o){if(this.parentNode)
this.parentNode.removeChild(this);});if(data&&data.el){data.el.style.display=data.display;data.el.style.position=data.position;if(data.parent)
data.parent.appendChild(data.el);$(el).removeData('blockUI.history');}
if(typeof opts.onUnblock=='function')
opts.onUnblock(el,opts);};function bind(b,el,opts){var full=el==window,$el=$(el);if(!b&&(full&&!pageBlock||!full&&!$el.data('blockUI.isBlocked')))
return;if(!full)
$el.data('blockUI.isBlocked',b);if(!opts.bindEvents||(b&&!opts.showOverlay))
return;var events='mousedown mouseup keydown keypress';b?$(document).bind(events,opts,handler):$(document).unbind(events,handler);};function handler(e){if(e.keyCode&&e.keyCode==9){if(pageBlock&&e.data.constrainTabKey){var els=pageBlockEls;var fwd=!e.shiftKey&&e.target==els[els.length-1];var back=e.shiftKey&&e.target==els[0];if(fwd||back){setTimeout(function(){focus(back)},10);return false;}}}
if($(e.target).parents('div.blockMsg').length>0)
return true;return $(e.target).parents().children().filter('div.blockUI').length==0;};function focus(back){if(!pageBlockEls)
return;var e=pageBlockEls[back===true?pageBlockEls.length-1:0];if(e)
e.focus();};function center(el,x,y){var p=el.parentNode,s=el.style;var l=((p.offsetWidth-el.offsetWidth)/2)-sz(p,'borderLeftWidth');var t=((p.offsetHeight-el.offsetHeight)/2)-sz(p,'borderTopWidth');if(x)s.left=l>0?(l+'px'):'0';if(y)s.top=t>0?(t+'px'):'0';};function sz(el,p){return parseInt($.css(el,p))||0;};})(jQuery);jQuery.fn.extend({reverse:function(event){var events=$(this).data("events");var reverseEvent=new Array;for(var e in events[event]){reverseEvent.unshift(events[event][e]);}
events[event]=reverseEvent;return this;},stack:function(event,data,fn){return this.reverse(event).bind(event,data,fn).reverse(event);},hover:function(fnOver,fnOut,reverse){if(reverse){return this.stack('mouseenter',fnOver).stack('mouseout',fnOut);}else{return this.bind('mouseenter',fnOver).bind('mouseout',fnOut);}}});jQuery.each(("blur,focus,load,resize,scroll,unload,click,dblclick,"+"mousedown,mouseup,mousemove,mouseover,mouseout,change,select,"+"submit,keydown,keypress,keyup,error").split(","),function(i,name){jQuery.fn[name]=function(fn,reverse){if(fn){return reverse?this.stack(name,fn):this.bind(name,fn);}else{return this.trigger(name);}};});(function($){$.i18n={};$.i18n.map={};$.i18n.properties=function(settings){var defaults={name:'Messages',language:'',path:'',mode:'vars',callback:function(){}};settings=$.extend(defaults,settings);if(settings.language===null||settings.language==''){settings.language=$.i18n.browserLang();}
if(settings.language===null){settings.language='';}
var files=getFiles(settings.name);for(i=0;i<files.length;i++){loadAndParseFile(settings.path+files[i]+'.properties',settings.language,settings.mode);if(settings.language.length>=2){loadAndParseFile(settings.path+files[i]+'_'+settings.language.substring(0,2)+'.properties',settings.language,settings.mode);}
if(settings.language.length>=5){loadAndParseFile(settings.path+files[i]+'_'+settings.language.substring(0,5)+'.properties',settings.language,settings.mode);}}
if(settings.callback){settings.callback();}};$.i18n.prop=function(key,placeHolderValues){var value=$.i18n.map[key];if(value==null){return'['+key+']';}
if(!placeHolderValues){return value;}else{for(var i=0;i<placeHolderValues.length;i++){var regexp=new RegExp('\\{('+i+')\\}',"g");value=value.replace(regexp,placeHolderValues[i]);}
return value;}};$.i18n.browserLang=function(){return normaliseLanguageCode(navigator.language||navigator.userLanguage);}
function loadAndParseFile(filename,language,mode){$.ajax({url:filename,async:false,contentType:"text/plain;charset=UTF-8",dataType:'text',success:function(data,status){var parsed='';var parameters=data.split(/\n/);var regPlaceHolder=/(\{\d+\})/g;var regRepPlaceHolder=/\{(\d+)\}/g;var unicodeRE=/(\\u.{4})/ig;for(var i=0;i<parameters.length;i++){parameters[i]=parameters[i].replace(/^\s\s*/,'').replace(/\s\s*$/,'');if(parameters[i].length>0&&parameters[i].match("^#")!="#"){var pair=parameters[i].split('=');if(pair.length>0){var name=unescape(pair[0]).replace(/^\s\s*/,'').replace(/\s\s*$/,'');var value=pair.length==1?"":pair[1];for(var s=2;s<pair.length;s++){value+='='+pair[s];}
value=value.replace(/"/g,'\\"');value=value.replace(/^\s\s*/,'').replace(/\s\s*$/,'');if(mode=='map'||mode=='both'){var unicodeMatches=value.match(unicodeRE);if(unicodeMatches){for(var u=0;u<unicodeMatches.length;u++){value=value.replace(unicodeMatches[u],unescapeUnicode(unicodeMatches[u]));}}
$.i18n.map[name]=value;}
if(mode=='vars'||mode=='both'){checkKeyNamespace(name);if(regPlaceHolder.test(value)){var parts=value.split(regPlaceHolder);var first=true;var fnArgs='';var usedArgs=[];for(var p=0;p<parts.length;p++){if(regPlaceHolder.test(parts[p])&&usedArgs.indexOf(parts[p])==-1){if(!first){fnArgs+=',';}
fnArgs+=parts[p].replace(regRepPlaceHolder,'v$1');usedArgs.push(parts[p]);first=false;}}
parsed+=name+'=function('+fnArgs+'){';var fnExpr='"'+value.replace(regRepPlaceHolder,'"+v$1+"')+'"';parsed+='return '+fnExpr+';'+'};';}else{parsed+=name+'="'+value+'";';}}}}}
eval(parsed);}});}
function checkKeyNamespace(key){var regDot=/\./;if(regDot.test(key)){var fullname='';var names=key.split(/\./);for(var i=0;i<names.length;i++){if(i>0){fullname+='.';}
fullname+=names[i];if(eval('typeof '+fullname+' == "undefined"')){eval(fullname+'={};');}}}}
function getFiles(names){return(names&&names.constructor==Array)?names:[names];}
function normaliseLanguageCode(lang){lang=lang.toLowerCase();if(lang.length>3){lang=lang.substring(0,3)+lang.substring(3).toUpperCase();}
return lang;}
function unescapeUnicode(str){var codes=[];var code=parseInt(str.substr(2),16);if(code>=0&&code<Math.pow(2,16)){codes.push(code);}
var unescaped='';for(var i=0;i<codes.length;++i){unescaped+=String.fromCharCode(codes[i]);}
return unescaped;}})(jQuery);
jQuery(function($){$.datepicker.regional['af']={closeText:'Selekteer',prevText:'Vorige',nextText:'Volgende',currentText:'Vandag',monthNames:['Januarie','Februarie','Maart','April','Mei','Junie','Julie','Augustus','September','Oktober','November','Desember'],monthNamesShort:['Jan','Feb','Mrt','Apr','Mei','Jun','Jul','Aug','Sep','Okt','Nov','Des'],dayNames:['Sondag','Maandag','Dinsdag','Woensdag','Donderdag','Vrydag','Saterdag'],dayNamesShort:['Son','Maa','Din','Woe','Don','Vry','Sat'],dayNamesMin:['So','Ma','Di','Wo','Do','Vr','Sa'],weekHeader:'Wk',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['af']);});
jQuery(function($){$.datepicker.regional['ar']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:[' ','','','','','','','','',' ',' ',' '],monthNamesShort:['1','2','3','4','5','6','7','8','9','10','11','12'],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd/mm/yy',firstDay:0,isRTL:true,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ar']);});
jQuery(function($){$.datepicker.regional['az']={closeText:'Bala',prevText:'&#x3c;Geri',nextText:'rli&#x3e;',currentText:'Bugn',monthNames:['Yanvar','Fevral','Mart','Aprel','May','yun','yul','Avqust','Sentyabr','Oktyabr','Noyabr','Dekabr'],monthNamesShort:['Yan','Fev','Mar','Apr','May','yun','yul','Avq','Sen','Okt','Noy','Dek'],dayNames:['Bazar','Bazar ertsi','rnb axam','rnb','Cm axam','Cm','nb'],dayNamesShort:['B','Be','a','','Ca','C',''],dayNamesMin:['B','B','','','','C',''],weekHeader:'Hf',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['az']);});
jQuery(function($){$.datepicker.regional['bg']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',nextBigText:'&#x3e;&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'Wk',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['bg']);});
jQuery(function($){$.datepicker.regional['bs']={closeText:'Zatvori',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'Danas',monthNames:['Januar','Februar','Mart','April','Maj','Juni','Juli','August','Septembar','Oktobar','Novembar','Decembar'],monthNamesShort:['Jan','Feb','Mar','Apr','Maj','Jun','Jul','Aug','Sep','Okt','Nov','Dec'],dayNames:['Nedelja','Ponedeljak','Utorak','Srijeda','etvrtak','Petak','Subota'],dayNamesShort:['Ned','Pon','Uto','Sri','et','Pet','Sub'],dayNamesMin:['Ne','Po','Ut','Sr','e','Pe','Su'],weekHeader:'Wk',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['bs']);});jQuery(function($){$.datepicker.regional['ca']={closeText:'Tancar',prevText:'&#x3c;Ant',nextText:'Seg&#x3e;',currentText:'Avui',monthNames:['Gener','Febrer','Mar&ccedil;','Abril','Maig','Juny','Juliol','Agost','Setembre','Octubre','Novembre','Desembre'],monthNamesShort:['Gen','Feb','Mar','Abr','Mai','Jun','Jul','Ago','Set','Oct','Nov','Des'],dayNames:['Diumenge','Dilluns','Dimarts','Dimecres','Dijous','Divendres','Dissabte'],dayNamesShort:['Dug','Dln','Dmt','Dmc','Djs','Dvn','Dsb'],dayNamesMin:['Dg','Dl','Dt','Dc','Dj','Dv','Ds'],weekHeader:'Sm',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ca']);});
jQuery(function($){$.datepicker.regional['cs']={closeText:'Zavt',prevText:'&#x3c;Dve',nextText:'Pozdji&#x3e;',currentText:'Nyn',monthNames:['leden','nor','bezen','duben','kvten','erven','ervenec','srpen','z','jen','listopad','prosinec'],monthNamesShort:['led','no','be','dub','kv','er','vc','srp','z','j','lis','pro'],dayNames:['nedle','pondl','ter','steda','tvrtek','ptek','sobota'],dayNamesShort:['ne','po','t','st','t','p','so'],dayNamesMin:['ne','po','t','st','t','p','so'],weekHeader:'Td',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['cs']);});
jQuery(function($){$.datepicker.regional['da']={closeText:'Luk',prevText:'&#x3c;Forrige',nextText:'Nste&#x3e;',currentText:'Idag',monthNames:['Januar','Februar','Marts','April','Maj','Juni','Juli','August','September','Oktober','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','Maj','Jun','Jul','Aug','Sep','Okt','Nov','Dec'],dayNames:['Sndag','Mandag','Tirsdag','Onsdag','Torsdag','Fredag','Lrdag'],dayNamesShort:['Sn','Man','Tir','Ons','Tor','Fre','Lr'],dayNamesMin:['S','Ma','Ti','On','To','Fr','L'],weekHeader:'Uge',dateFormat:'dd-mm-yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['da']);});
jQuery(function($){$.datepicker.regional['de']={closeText:'schlieen',prevText:'&#x3c;zurck',nextText:'Vor&#x3e;',currentText:'heute',monthNames:['Januar','Februar','Mrz','April','Mai','Juni','Juli','August','September','Oktober','November','Dezember'],monthNamesShort:['Jan','Feb','Mr','Apr','Mai','Jun','Jul','Aug','Sep','Okt','Nov','Dez'],dayNames:['Sonntag','Montag','Dienstag','Mittwoch','Donnerstag','Freitag','Samstag'],dayNamesShort:['So','Mo','Di','Mi','Do','Fr','Sa'],dayNamesMin:['So','Mo','Di','Mi','Do','Fr','Sa'],weekHeader:'Wo',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['de']);});
jQuery(function($){$.datepicker.regional['el']={closeText:'',prevText:'',nextText:'',currentText:' ',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['el']);});
jQuery(function($){$.datepicker.regional['en-GB']={closeText:'Done',prevText:'Prev',nextText:'Next',currentText:'Today',monthNames:['January','February','March','April','May','June','July','August','September','October','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],dayNames:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],dayNamesShort:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],dayNamesMin:['Su','Mo','Tu','We','Th','Fr','Sa'],weekHeader:'Wk',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['en-GB']);});
jQuery(function($){$.datepicker.regional['eo']={closeText:'Fermi',prevText:'&lt;Anta',nextText:'Sekv&gt;',currentText:'Nuna',monthNames:['Januaro','Februaro','Marto','Aprilo','Majo','Junio','Julio','Agusto','Septembro','Oktobro','Novembro','Decembro'],monthNamesShort:['Jan','Feb','Mar','Apr','Maj','Jun','Jul','Ag','Sep','Okt','Nov','Dec'],dayNames:['Dimano','Lundo','Mardo','Merkredo','ado','Vendredo','Sabato'],dayNamesShort:['Dim','Lun','Mar','Mer','a','Ven','Sab'],dayNamesMin:['Di','Lu','Ma','Me','a','Ve','Sa'],weekHeader:'Sb',dateFormat:'dd/mm/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['eo']);});jQuery(function($){$.datepicker.regional['es']={closeText:'Cerrar',prevText:'&#x3c;Ant',nextText:'Sig&#x3e;',currentText:'Hoy',monthNames:['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'],monthNamesShort:['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'],dayNames:['Domingo','Lunes','Martes','Mi&eacute;rcoles','Jueves','Viernes','S&aacute;bado'],dayNamesShort:['Dom','Lun','Mar','Mi&eacute;','Juv','Vie','S&aacute;b'],dayNamesMin:['Do','Lu','Ma','Mi','Ju','Vi','S&aacute;'],weekHeader:'Sm',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['es']);});
jQuery(function($){$.datepicker.regional['et']={closeText:'Sulge',prevText:'Eelnev',nextText:'Jrgnev',currentText:'Tna',monthNames:['Jaanuar','Veebruar','Mrts','Aprill','Mai','Juuni','Juuli','August','September','Oktoober','November','Detsember'],monthNamesShort:['Jaan','Veebr','Mrts','Apr','Mai','Juuni','Juuli','Aug','Sept','Okt','Nov','Dets'],dayNames:['Phapev','Esmaspev','Teisipev','Kolmapev','Neljapev','Reede','Laupev'],dayNamesShort:['Phap','Esmasp','Teisip','Kolmap','Neljap','Reede','Laup'],dayNamesMin:['P','E','T','K','N','R','L'],weekHeader:'Sm',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['et']);});
jQuery(function($){$.datepicker.regional['eu']={closeText:'Egina',prevText:'&#x3c;Aur',nextText:'Hur&#x3e;',currentText:'Gaur',monthNames:['Urtarrila','Otsaila','Martxoa','Apirila','Maiatza','Ekaina','Uztaila','Abuztua','Iraila','Urria','Azaroa','Abendua'],monthNamesShort:['Urt','Ots','Mar','Api','Mai','Eka','Uzt','Abu','Ira','Urr','Aza','Abe'],dayNames:['Igandea','Astelehena','Asteartea','Asteazkena','Osteguna','Ostirala','Larunbata'],dayNamesShort:['Iga','Ast','Ast','Ast','Ost','Ost','Lar'],dayNamesMin:['Ig','As','As','As','Os','Os','La'],weekHeader:'Wk',dateFormat:'yy/mm/dd',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['eu']);});
jQuery(function($){$.datepicker.regional['fa']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['1','2','3','4','5','6','7','8','9','10','11','12'],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'yy/mm/dd',firstDay:6,isRTL:true,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['fa']);});jQuery(function($){$.datepicker.regional['fi']={closeText:'Sulje',prevText:'&laquo;Edellinen',nextText:'Seuraava&raquo;',currentText:'T&auml;n&auml;&auml;n',monthNames:['Tammikuu','Helmikuu','Maaliskuu','Huhtikuu','Toukokuu','Kes&auml;kuu','Hein&auml;kuu','Elokuu','Syyskuu','Lokakuu','Marraskuu','Joulukuu'],monthNamesShort:['Tammi','Helmi','Maalis','Huhti','Touko','Kes&auml;','Hein&auml;','Elo','Syys','Loka','Marras','Joulu'],dayNamesShort:['Su','Ma','Ti','Ke','To','Pe','Su'],dayNames:['Sunnuntai','Maanantai','Tiistai','Keskiviikko','Torstai','Perjantai','Lauantai'],dayNamesMin:['Su','Ma','Ti','Ke','To','Pe','La'],weekHeader:'Vk',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['fi']);});
jQuery(function($){$.datepicker.regional['fo']={closeText:'Lat aftur',prevText:'&#x3c;Fyrra',nextText:'Nsta&#x3e;',currentText:' dag',monthNames:['Januar','Februar','Mars','Aprl','Mei','Juni','Juli','August','September','Oktober','November','Desember'],monthNamesShort:['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Aug','Sep','Okt','Nov','Des'],dayNames:['Sunnudagur','Mnadagur','Tsdagur','Mikudagur','Hsdagur','Frggjadagur','Leyardagur'],dayNamesShort:['Sun','Mn','Ts','Mik','Hs','Fr','Ley'],dayNamesMin:['Su','M','T','Mi','H','Fr','Le'],weekHeader:'Vk',dateFormat:'dd-mm-yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['fo']);});
jQuery(function($){$.datepicker.regional['fr-CH']={closeText:'Fermer',prevText:'&#x3c;Prc',nextText:'Suiv&#x3e;',currentText:'Courant',monthNames:['Janvier','Fvrier','Mars','Avril','Mai','Juin','Juillet','Aot','Septembre','Octobre','Novembre','Dcembre'],monthNamesShort:['Jan','Fv','Mar','Avr','Mai','Jun','Jul','Ao','Sep','Oct','Nov','Dc'],dayNames:['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'],dayNamesShort:['Dim','Lun','Mar','Mer','Jeu','Ven','Sam'],dayNamesMin:['Di','Lu','Ma','Me','Je','Ve','Sa'],weekHeader:'Sm',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['fr-CH']);});
jQuery(function($){$.datepicker.regional['fr']={closeText:'Fermer',prevText:'&#x3c;Prc',nextText:'Suiv&#x3e;',currentText:'Courant',monthNames:['Janvier','Fvrier','Mars','Avril','Mai','Juin','Juillet','Aot','Septembre','Octobre','Novembre','Dcembre'],monthNamesShort:['Jan','Fv','Mar','Avr','Mai','Jun','Jul','Ao','Sep','Oct','Nov','Dc'],dayNames:['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'],dayNamesShort:['Dim','Lun','Mar','Mer','Jeu','Ven','Sam'],dayNamesMin:['Di','Lu','Ma','Me','Je','Ve','Sa'],weekHeader:'Sm',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['fr']);});
jQuery(function($){$.datepicker.regional['he']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['1','2','3','4','5','6','7','8','9','10','11','12'],dayNames:['','','','','','',''],dayNamesShort:['\'','\'','\'','\'','\'','\'',''],dayNamesMin:['\'','\'','\'','\'','\'','\'',''],weekHeader:'Wk',dateFormat:'dd/mm/yy',firstDay:0,isRTL:true,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['he']);});
jQuery(function($){$.datepicker.regional['hr']={closeText:'Zatvori',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'Danas',monthNames:['Sijeanj','Veljaa','Oujak','Travanj','Svibanj','Lipanj','Srpanj','Kolovoz','Rujan','Listopad','Studeni','Prosinac'],monthNamesShort:['Sij','Velj','Ou','Tra','Svi','Lip','Srp','Kol','Ruj','Lis','Stu','Pro'],dayNames:['Nedjelja','Ponedjeljak','Utorak','Srijeda','etvrtak','Petak','Subota'],dayNamesShort:['Ned','Pon','Uto','Sri','et','Pet','Sub'],dayNamesMin:['Ne','Po','Ut','Sr','e','Pe','Su'],weekHeader:'Tje',dateFormat:'dd.mm.yy.',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['hr']);});jQuery(function($){$.datepicker.regional['hu']={closeText:'bezrs',prevText:'&laquo;&nbsp;vissza',nextText:'elre&nbsp;&raquo;',currentText:'ma',monthNames:['Janur','Februr','Mrcius','prilis','Mjus','Jnius','Jlius','Augusztus','Szeptember','Oktber','November','December'],monthNamesShort:['Jan','Feb','Mr','pr','Mj','Jn','Jl','Aug','Szep','Okt','Nov','Dec'],dayNames:['Vasrnap','Htf','Kedd','Szerda','Cstrtk','Pntek','Szombat'],dayNamesShort:['Vas','Ht','Ked','Sze','Cs','Pn','Szo'],dayNamesMin:['V','H','K','Sze','Cs','P','Szo'],weekHeader:'H',dateFormat:'yy-mm-dd',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['hu']);});jQuery(function($){$.datepicker.regional['hy']={closeText:'',prevText:'&#x3c;.',nextText:'.&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['hy']);});jQuery(function($){$.datepicker.regional['id']={closeText:'Tutup',prevText:'&#x3c;mundur',nextText:'maju&#x3e;',currentText:'hari ini',monthNames:['Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','Nopember','Desember'],monthNamesShort:['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Agus','Sep','Okt','Nop','Des'],dayNames:['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'],dayNamesShort:['Min','Sen','Sel','Rab','kam','Jum','Sab'],dayNamesMin:['Mg','Sn','Sl','Rb','Km','jm','Sb'],weekHeader:'Mg',dateFormat:'dd/mm/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['id']);});jQuery(function($){$.datepicker.regional['is']={closeText:'Loka',prevText:'&#x3c; Fyrri',nextText:'N&aelig;sti &#x3e;',currentText:'&Iacute; dag',monthNames:['Jan&uacute;ar','Febr&uacute;ar','Mars','Apr&iacute;l','Ma&iacute','J&uacute;n&iacute;','J&uacute;l&iacute;','&Aacute;g&uacute;st','September','Okt&oacute;ber','N&oacute;vember','Desember'],monthNamesShort:['Jan','Feb','Mar','Apr','Ma&iacute;','J&uacute;n','J&uacute;l','&Aacute;g&uacute;','Sep','Okt','N&oacute;v','Des'],dayNames:['Sunnudagur','M&aacute;nudagur','&THORN;ri&eth;judagur','Mi&eth;vikudagur','Fimmtudagur','F&ouml;studagur','Laugardagur'],dayNamesShort:['Sun','M&aacute;n','&THORN;ri','Mi&eth;','Fim','F&ouml;s','Lau'],dayNamesMin:['Su','M&aacute;','&THORN;r','Mi','Fi','F&ouml;','La'],weekHeader:'Vika',dateFormat:'dd/mm/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['is']);});jQuery(function($){$.datepicker.regional['it']={closeText:'Chiudi',prevText:'&#x3c;Prec',nextText:'Succ&#x3e;',currentText:'Oggi',monthNames:['Gennaio','Febbraio','Marzo','Aprile','Maggio','Giugno','Luglio','Agosto','Settembre','Ottobre','Novembre','Dicembre'],monthNamesShort:['Gen','Feb','Mar','Apr','Mag','Giu','Lug','Ago','Set','Ott','Nov','Dic'],dayNames:['Domenica','Luned&#236','Marted&#236','Mercoled&#236','Gioved&#236','Venerd&#236','Sabato'],dayNamesShort:['Dom','Lun','Mar','Mer','Gio','Ven','Sab'],dayNamesMin:['Do','Lu','Ma','Me','Gi','Ve','Sa'],weekHeader:'Sm',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['it']);});
jQuery(function($){$.datepicker.regional['ja']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['1','2','3','4','5','6','7','8','9','10','11','12'],monthNamesShort:['1','2','3','4','5','6','7','8','9','10','11','12'],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'yy/mm/dd',firstDay:0,isRTL:false,showMonthAfterYear:true,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ja']);});jQuery(function($){$.datepicker.regional['ko']={closeText:'',prevText:'',nextText:'',currentText:'',monthNames:['1(JAN)','2(FEB)','3(MAR)','4(APR)','5(MAY)','6(JUN)','7(JUL)','8(AUG)','9(SEP)','10(OCT)','11(NOV)','12(DEC)'],monthNamesShort:['1(JAN)','2(FEB)','3(MAR)','4(APR)','5(MAY)','6(JUN)','7(JUL)','8(AUG)','9(SEP)','10(OCT)','11(NOV)','12(DEC)'],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'Wk',dateFormat:'yy-mm-dd',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ko']);});jQuery(function($){$.datepicker.regional['lt']={closeText:'Udaryti',prevText:'&#x3c;Atgal',nextText:'Pirmyn&#x3e;',currentText:'iandien',monthNames:['Sausis','Vasaris','Kovas','Balandis','Gegu','Birelis','Liepa','Rugpjtis','Rugsjis','Spalis','Lapkritis','Gruodis'],monthNamesShort:['Sau','Vas','Kov','Bal','Geg','Bir','Lie','Rugp','Rugs','Spa','Lap','Gru'],dayNames:['sekmadienis','pirmadienis','antradienis','treiadienis','ketvirtadienis','penktadienis','etadienis'],dayNamesShort:['sek','pir','ant','tre','ket','pen','e'],dayNamesMin:['Se','Pr','An','Tr','Ke','Pe','e'],weekHeader:'Wk',dateFormat:'yy-mm-dd',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['lt']);});jQuery(function($){$.datepicker.regional['lv']={closeText:'Aizvrt',prevText:'Iepr',nextText:'Nka',currentText:'odien',monthNames:['Janvris','Februris','Marts','Aprlis','Maijs','Jnijs','Jlijs','Augusts','Septembris','Oktobris','Novembris','Decembris'],monthNamesShort:['Jan','Feb','Mar','Apr','Mai','Jn','Jl','Aug','Sep','Okt','Nov','Dec'],dayNames:['svtdiena','pirmdiena','otrdiena','trediena','ceturtdiena','piektdiena','sestdiena'],dayNamesShort:['svt','prm','otr','tre','ctr','pkt','sst'],dayNamesMin:['Sv','Pr','Ot','Tr','Ct','Pk','Ss'],weekHeader:'Nav',dateFormat:'dd-mm-yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['lv']);});jQuery(function($){$.datepicker.regional['ms']={closeText:'Tutup',prevText:'&#x3c;Sebelum',nextText:'Selepas&#x3e;',currentText:'hari ini',monthNames:['Januari','Februari','Mac','April','Mei','Jun','Julai','Ogos','September','Oktober','November','Disember'],monthNamesShort:['Jan','Feb','Mac','Apr','Mei','Jun','Jul','Ogo','Sep','Okt','Nov','Dis'],dayNames:['Ahad','Isnin','Selasa','Rabu','Khamis','Jumaat','Sabtu'],dayNamesShort:['Aha','Isn','Sel','Rab','kha','Jum','Sab'],dayNamesMin:['Ah','Is','Se','Ra','Kh','Ju','Sa'],weekHeader:'Mg',dateFormat:'dd/mm/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ms']);});
jQuery(function($){$.datepicker.regional.nl={closeText:'Sluiten',prevText:'',nextText:'',currentText:'Vandaag',monthNames:['januari','februari','maart','april','mei','juni','juli','augustus','september','oktober','november','december'],monthNamesShort:['jan','feb','maa','apr','mei','jun','jul','aug','sep','okt','nov','dec'],dayNames:['zondag','maandag','dinsdag','woensdag','donderdag','vrijdag','zaterdag'],dayNamesShort:['zon','maa','din','woe','don','vri','zat'],dayNamesMin:['zo','ma','di','wo','do','vr','za'],weekHeader:'Wk',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional.nl);});jQuery(function($){$.datepicker.regional['no']={closeText:'Lukk',prevText:'&laquo;Forrige',nextText:'Neste&raquo;',currentText:'I dag',monthNames:['Januar','Februar','Mars','April','Mai','Juni','Juli','August','September','Oktober','November','Desember'],monthNamesShort:['Jan','Feb','Mar','Apr','Mai','Jun','Jul','Aug','Sep','Okt','Nov','Des'],dayNamesShort:['Sn','Man','Tir','Ons','Tor','Fre','Lr'],dayNames:['Sndag','Mandag','Tirsdag','Onsdag','Torsdag','Fredag','Lrdag'],dayNamesMin:['S','Ma','Ti','On','To','Fr','L'],weekHeader:'Uke',dateFormat:'yy-mm-dd',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['no']);});jQuery(function($){$.datepicker.regional['pl']={closeText:'Zamknij',prevText:'&#x3c;Poprzedni',nextText:'Nastpny&#x3e;',currentText:'Dzi',monthNames:['Stycze','Luty','Marzec','Kwiecie','Maj','Czerwiec','Lipiec','Sierpie','Wrzesie','Padziernik','Listopad','Grudzie'],monthNamesShort:['Sty','Lu','Mar','Kw','Maj','Cze','Lip','Sie','Wrz','Pa','Lis','Gru'],dayNames:['Niedziela','Poniedziaek','Wtorek','roda','Czwartek','Pitek','Sobota'],dayNamesShort:['Nie','Pn','Wt','r','Czw','Pt','So'],dayNamesMin:['N','Pn','Wt','r','Cz','Pt','So'],weekHeader:'Tydz',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['pl']);});jQuery(function($){$.datepicker.regional['pt-BR']={closeText:'Fechar',prevText:'&#x3c;Anterior',nextText:'Pr&oacute;ximo&#x3e;',currentText:'Hoje',monthNames:['Janeiro','Fevereiro','Mar&ccedil;o','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'],monthNamesShort:['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'],dayNames:['Domingo','Segunda-feira','Ter&ccedil;a-feira','Quarta-feira','Quinta-feira','Sexta-feira','S&aacute;bado'],dayNamesShort:['Dom','Seg','Ter','Qua','Qui','Sex','S&aacute;b'],dayNamesMin:['Dom','Seg','Ter','Qua','Qui','Sex','S&aacute;b'],weekHeader:'Sm',dateFormat:'dd/mm/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['pt-BR']);});
jQuery(function($){$.datepicker.regional['ro']={closeText:'nchide',prevText:'&laquo; Luna precedent',nextText:'Luna urmtoare &raquo;',currentText:'Azi',monthNames:['Ianuarie','Februarie','Martie','Aprilie','Mai','Iunie','Iulie','August','Septembrie','Octombrie','Noiembrie','Decembrie'],monthNamesShort:['Ian','Feb','Mar','Apr','Mai','Iun','Iul','Aug','Sep','Oct','Nov','Dec'],dayNames:['Duminic','Luni','Mari','Miercuri','Joi','Vineri','Smbt'],dayNamesShort:['Dum','Lun','Mar','Mie','Joi','Vin','Sm'],dayNamesMin:['Du','Lu','Ma','Mi','Jo','Vi','S'],weekHeader:'Spt',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ro']);});jQuery(function($){$.datepicker.regional['ru']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ru']);});jQuery(function($){$.datepicker.regional['sk']={closeText:'Zavrie',prevText:'&#x3c;Predchdzajci',nextText:'Nasledujci&#x3e;',currentText:'Dnes',monthNames:['Janur','Februr','Marec','Aprl','Mj','Jn','Jl','August','September','Oktber','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','Mj','Jn','Jl','Aug','Sep','Okt','Nov','Dec'],dayNames:['Nedel\'a','Pondelok','Utorok','Streda','tvrtok','Piatok','Sobota'],dayNamesShort:['Ned','Pon','Uto','Str','tv','Pia','Sob'],dayNamesMin:['Ne','Po','Ut','St','t','Pia','So'],weekHeader:'Ty',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['sk']);});jQuery(function($){$.datepicker.regional['sl']={closeText:'Zapri',prevText:'&lt;Prej&#x161;nji',nextText:'Naslednji&gt;',currentText:'Trenutni',monthNames:['Januar','Februar','Marec','April','Maj','Junij','Julij','Avgust','September','Oktober','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','Maj','Jun','Jul','Avg','Sep','Okt','Nov','Dec'],dayNames:['Nedelja','Ponedeljek','Torek','Sreda','&#x10C;etrtek','Petek','Sobota'],dayNamesShort:['Ned','Pon','Tor','Sre','&#x10C;et','Pet','Sob'],dayNamesMin:['Ne','Po','To','Sr','&#x10C;e','Pe','So'],weekHeader:'Teden',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['sl']);});
jQuery(function($){$.datepicker.regional['sq']={closeText:'mbylle',prevText:'&#x3c;mbrapa',nextText:'Prpara&#x3e;',currentText:'sot',monthNames:['Janar','Shkurt','Mars','Prill','Maj','Qershor','Korrik','Gusht','Shtator','Tetor','Nntor','Dhjetor'],monthNamesShort:['Jan','Shk','Mar','Pri','Maj','Qer','Kor','Gus','Sht','Tet','Nn','Dhj'],dayNames:['E Diel','E Hn','E Mart','E Mrkur','E Enjte','E Premte','E Shtune'],dayNamesShort:['Di','H','Ma','M','En','Pr','Sh'],dayNamesMin:['Di','H','Ma','M','En','Pr','Sh'],weekHeader:'Ja',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['sq']);});
jQuery(function($){$.datepicker.regional['sr-SR']={closeText:'Zatvori',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'Danas',monthNames:['Januar','Februar','Mart','April','Maj','Jun','Jul','Avgust','Septembar','Oktobar','Novembar','Decembar'],monthNamesShort:['Jan','Feb','Mar','Apr','Maj','Jun','Jul','Avg','Sep','Okt','Nov','Dec'],dayNames:['Nedelja','Ponedeljak','Utorak','Sreda','etvrtak','Petak','Subota'],dayNamesShort:['Ned','Pon','Uto','Sre','et','Pet','Sub'],dayNamesMin:['Ne','Po','Ut','Sr','e','Pe','Su'],weekHeader:'Sed',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['sr-SR']);});
jQuery(function($){$.datepicker.regional['sr']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['sr']);});
jQuery(function($){$.datepicker.regional['sv']={closeText:'Stng',prevText:'&laquo;Frra',nextText:'Nsta&raquo;',currentText:'Idag',monthNames:['Januari','Februari','Mars','April','Maj','Juni','Juli','Augusti','September','Oktober','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','Maj','Jun','Jul','Aug','Sep','Okt','Nov','Dec'],dayNamesShort:['Sn','Mn','Tis','Ons','Tor','Fre','Lr'],dayNames:['Sndag','Mndag','Tisdag','Onsdag','Torsdag','Fredag','Lrdag'],dayNamesMin:['S','M','Ti','On','To','Fr','L'],weekHeader:'Ve',dateFormat:'yy-mm-dd',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['sv']);});
jQuery(function($){$.datepicker.regional['ta']={closeText:'',prevText:'',nextText:'',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ta']);});
jQuery(function($){$.datepicker.regional['th']={closeText:'',prevText:'&laquo;&nbsp;',nextText:'&nbsp;&raquo;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['..','..','..','..','..','..','..','..','..','..','..','..'],dayNames:['','','','','','',''],dayNamesShort:['.','.','.','.','.','.','.'],dayNamesMin:['.','.','.','.','.','.','.'],weekHeader:'Wk',dateFormat:'dd/mm/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['th']);});jQuery(function($){$.datepicker.regional['tr']={closeText:'kapat',prevText:'&#x3c;geri',nextText:'ileri&#x3e',currentText:'bugn',monthNames:['Ocak','ubat','Mart','Nisan','Mays','Haziran','Temmuz','Austos','Eyll','Ekim','Kasm','Aralk'],monthNamesShort:['Oca','ub','Mar','Nis','May','Haz','Tem','Au','Eyl','Eki','Kas','Ara'],dayNames:['Pazar','Pazartesi','Sal','aramba','Perembe','Cuma','Cumartesi'],dayNamesShort:['Pz','Pt','Sa','a','Pe','Cu','Ct'],dayNamesMin:['Pz','Pt','Sa','a','Pe','Cu','Ct'],weekHeader:'Hf',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['tr']);});jQuery(function($){$.datepicker.regional['uk']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['uk']);});
jQuery(function($){$.datepicker.regional['vi']={closeText:'ng',prevText:'&#x3c;Trc',nextText:'Tip&#x3e;',currentText:'Hm nay',monthNames:['Thng Mt','Thng Hai','Thng Ba','Thng T','Thng Nm','Thng Su','Thng By','Thng Tm','Thng Chn','Thng Mi','Thng Mi Mt','Thng Mi Hai'],monthNamesShort:['Thng 1','Thng 2','Thng 3','Thng 4','Thng 5','Thng 6','Thng 7','Thng 8','Thng 9','Thng 10','Thng 11','Thng 12'],dayNames:['Ch Nht','Th Hai','Th Ba','Th T','Th Nm','Th Su','Th By'],dayNamesShort:['CN','T2','T3','T4','T5','T6','T7'],dayNamesMin:['CN','T2','T3','T4','T5','T6','T7'],weekHeader:'Tu',dateFormat:'dd/mm/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['vi']);});jQuery(function($){$.datepicker.regional['zh-CN']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'yy-mm-dd',firstDay:1,isRTL:false,showMonthAfterYear:true,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['zh-CN']);});jQuery(function($){$.datepicker.regional['zh-HK']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd-mm-yy',firstDay:0,isRTL:false,showMonthAfterYear:true,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['zh-HK']);});
jQuery(function($){$.datepicker.regional['zh-TW']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'yy/mm/dd',firstDay:1,isRTL:false,showMonthAfterYear:true,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['zh-TW']);});var MetaLayer={getCurrentDate:function(){var currentDate=new Date();return MetaLayer.toDateString(currentDate);},getYesterdayDate:function(){var currentDate=new Date();currentDate.setDate(currentDate.getDate()-1);return MetaLayer.toDateString(currentDate);},getFirstDayOfYearDate:function(){var currentDate=new Date();return currentDate.getFullYear()+"-01-01";},getFirstDayOfLastMonth:function(){var currentDate=new Date();currentDate.setMonth(currentDate.getMonth()-1);currentDate.setDate(1);return MetaLayer.toDateString(currentDate);},getLastDayOfLastMonth:function(){var currentDate=new Date();currentDate.setDate(0);return MetaLayer.toDateString(currentDate);},getLastMonthDate:function(){var currentDate=new Date();var prevDate=new Date(currentDate.getFullYear(),currentDate.getMonth(),currentDate.getDate()-30);var prevMonth="0"+(prevDate.getMonth()+1);var prevDay="0"+(prevDate.getDate());var prevDateStr=prevDate.getFullYear()+"-"+(prevMonth.substring(prevMonth.length-2,prevMonth.length))+"-"+(prevDay.substring(prevDay.length-2,prevDay.length));return prevDateStr;},toDateString:function(d){var currentMonth="0"+(d.getMonth()+1);var currentDay="0"+(d.getDate());var dStr=d.getFullYear()+"-"+(currentMonth.substring(currentMonth.length-2,currentMonth.length))+"-"+(currentDay.substring(currentDay.length-2,currentDay.length));return dStr;},getMonth:function(){var currentDate=new Date();var currentMonth="0"+(currentDate.getMonth()+1);var currentDateStr=currentDate.getFullYear()+"-"+(currentMonth.substring(currentMonth.length-2,currentMonth.length));return currentDateStr;},getMdxMonth:function(){var currentDate=new Date();var currentDateStr="[Date].["+currentDate.getFullYear()+"].["+currentDate.getMonth()+"]";return currentDateStr;},getInitialMonth:function(){var c=new Date();c.setMonth(c.getMonth()-1);return c;},allValues:[["All","All"]]};jQuery.fn.check=function(mode){var mode=mode||'on';return this.each(function(){switch(mode){case'on':this.checked=true;break;case'off':this.checked=false;break;case'toggle':this.checked=!this.checked;break;}});};;(function($){var tmp,loading,overlay,wrap,outer,content,close,title,nav_left,nav_right,selectedIndex=0,selectedOpts={},selectedArray=[],currentIndex=0,currentOpts={},currentArray=[],ajaxLoader=null,imgPreloader=new Image(),imgRegExp=/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i,swfRegExp=/[^\.]\.(swf)\s*$/i,loadingTimer,loadingFrame=1,titleHeight=0,titleStr='',start_pos,final_pos,busy=false,fx=$.extend($('<div/>')[0],{prop:0}),isIE6=$.browser.msie&&$.browser.version<7&&!window.XMLHttpRequest,_abort=function(){loading.hide();imgPreloader.onerror=imgPreloader.onload=null;if(ajaxLoader){ajaxLoader.abort();}
tmp.empty();},_error=function(){if(false===selectedOpts.onError(selectedArray,selectedIndex,selectedOpts)){loading.hide();busy=false;return;}
selectedOpts.titleShow=false;selectedOpts.width='auto';selectedOpts.height='auto';tmp.html('<p id="fancybox-error">The requested content cannot be loaded.<br />Please try again later.</p>');_process_inline();},_start=function(){var obj=selectedArray[selectedIndex],href,type,title,str,emb,ret;_abort();selectedOpts=$.extend({},$.fn.fancybox.defaults,(typeof $(obj).data('fancybox')=='undefined'?selectedOpts:$(obj).data('fancybox')));ret=selectedOpts.onStart(selectedArray,selectedIndex,selectedOpts);if(ret===false){busy=false;return;}else if(typeof ret=='object'){selectedOpts=$.extend(selectedOpts,ret);}
title=selectedOpts.title||(obj.nodeName?$(obj).attr('title'):obj.title)||'';if(obj.nodeName&&!selectedOpts.orig){selectedOpts.orig=$(obj).children("img:first").length?$(obj).children("img:first"):$(obj);}
if(title===''&&selectedOpts.orig&&selectedOpts.titleFromAlt){title=selectedOpts.orig.attr('alt');}
href=selectedOpts.href||(obj.nodeName?$(obj).attr('href'):obj.href)||null;if((/^(?:javascript)/i).test(href)||href=='#'){href=null;}
if(selectedOpts.type){type=selectedOpts.type;if(!href){href=selectedOpts.content;}}else if(selectedOpts.content){type='html';}else if(href){if(href.match(imgRegExp)){type='image';}else if(href.match(swfRegExp)){type='swf';}else if($(obj).hasClass("iframe")){type='iframe';}else if(href.indexOf("#")===0){type='inline';}else{type='ajax';}}
if(!type){_error();return;}
if(type=='inline'){obj=href.substr(href.indexOf("#"));type=$(obj).length>0?'inline':'ajax';}
selectedOpts.type=type;selectedOpts.href=href;selectedOpts.title=title;if(selectedOpts.autoDimensions){if(selectedOpts.type=='html'||selectedOpts.type=='inline'||selectedOpts.type=='ajax'){selectedOpts.width='auto';selectedOpts.height='auto';}else{selectedOpts.autoDimensions=false;}}
if(selectedOpts.modal){selectedOpts.overlayShow=true;selectedOpts.hideOnOverlayClick=false;selectedOpts.hideOnContentClick=false;selectedOpts.enableEscapeButton=false;selectedOpts.showCloseButton=false;}
selectedOpts.padding=parseInt(selectedOpts.padding,10);selectedOpts.margin=parseInt(selectedOpts.margin,10);tmp.css('padding',(selectedOpts.padding+selectedOpts.margin));$('.fancybox-inline-tmp').unbind('fancybox-cancel').bind('fancybox-change',function(){$(this).replaceWith(content.children());});switch(type){case'html':tmp.html(selectedOpts.content);_process_inline();break;case'inline':if($(obj).parent().is('#fancybox-content')===true){busy=false;return;}
$('<div class="fancybox-inline-tmp" />').hide().insertBefore($(obj)).bind('fancybox-cleanup',function(){$(this).replaceWith(content.children());}).bind('fancybox-cancel',function(){$(this).replaceWith(tmp.children());});$(obj).appendTo(tmp);_process_inline();break;case'image':busy=false;$.fancybox.showActivity();imgPreloader=new Image();imgPreloader.onerror=function(){_error();};imgPreloader.onload=function(){busy=true;imgPreloader.onerror=imgPreloader.onload=null;_process_image();};imgPreloader.src=href;break;case'swf':selectedOpts.scrolling='no';str='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+selectedOpts.width+'" height="'+selectedOpts.height+'"><param name="movie" value="'+href+'"></param>';emb='';$.each(selectedOpts.swf,function(name,val){str+='<param name="'+name+'" value="'+val+'"></param>';emb+=' '+name+'="'+val+'"';});str+='<embed src="'+href+'" type="application/x-shockwave-flash" width="'+selectedOpts.width+'" height="'+selectedOpts.height+'"'+emb+'></embed></object>';tmp.html(str);_process_inline();break;case'ajax':busy=false;$.fancybox.showActivity();selectedOpts.ajax.win=selectedOpts.ajax.success;ajaxLoader=$.ajax($.extend({},selectedOpts.ajax,{url:href,data:selectedOpts.ajax.data||{},error:function(XMLHttpRequest,textStatus,errorThrown){if(XMLHttpRequest.status>0){_error();}},success:function(data,textStatus,XMLHttpRequest){var o=typeof XMLHttpRequest=='object'?XMLHttpRequest:ajaxLoader;if(o.status==200){if(typeof selectedOpts.ajax.win=='function'){ret=selectedOpts.ajax.win(href,data,textStatus,XMLHttpRequest);if(ret===false){loading.hide();return;}else if(typeof ret=='string'||typeof ret=='object'){data=ret;}}
tmp.html(data);_process_inline();}}}));break;case'iframe':_show();break;}},_process_inline=function(){var
w=selectedOpts.width,h=selectedOpts.height;if(w.toString().indexOf('%')>-1){w=parseInt(($(window).width()-(selectedOpts.margin*2))*parseFloat(w)/100,10)+'px';}else{w=w=='auto'?'auto':w+'px';}
if(h.toString().indexOf('%')>-1){h=parseInt(($(window).height()-(selectedOpts.margin*2))*parseFloat(h)/100,10)+'px';}else{h=h=='auto'?'auto':h+'px';}
tmp.wrapInner('<div style="width:'+w+';height:'+h+';overflow: '+(selectedOpts.scrolling=='auto'?'auto':(selectedOpts.scrolling=='yes'?'scroll':'hidden'))+';position:relative;"></div>');selectedOpts.width=tmp.width();selectedOpts.height=tmp.height();_show();},_process_image=function(){selectedOpts.width=imgPreloader.width;selectedOpts.height=imgPreloader.height;$("<img />").attr({'id':'fancybox-img','src':imgPreloader.src,'alt':selectedOpts.title}).appendTo(tmp);_show();},_show=function(){var pos,equal;loading.hide();if(wrap.is(":visible")&&false===currentOpts.onCleanup(currentArray,currentIndex,currentOpts)){$.event.trigger('fancybox-cancel');busy=false;return;}
busy=true;$(content.add(overlay)).unbind();$(window).unbind("resize.fb scroll.fb");$(document).unbind('keydown.fb');if(wrap.is(":visible")&&currentOpts.titlePosition!=='outside'){wrap.css('height',wrap.height());}
currentArray=selectedArray;currentIndex=selectedIndex;currentOpts=selectedOpts;if(currentOpts.overlayShow){overlay.css({'background-color':currentOpts.overlayColor,'opacity':currentOpts.overlayOpacity,'cursor':currentOpts.hideOnOverlayClick?'pointer':'auto','height':$(document).height()});if(!overlay.is(':visible')){if(isIE6){$('select:not(#fancybox-tmp select)').filter(function(){return this.style.visibility!=='hidden';}).css({'visibility':'hidden'}).one('fancybox-cleanup',function(){this.style.visibility='inherit';});}
overlay.show();}}else{overlay.hide();}
final_pos=_get_zoom_to();_process_title();if(wrap.is(":visible")){$(close.add(nav_left).add(nav_right)).hide();pos=wrap.position(),start_pos={top:pos.top,left:pos.left,width:wrap.width(),height:wrap.height()};equal=(start_pos.width==final_pos.width&&start_pos.height==final_pos.height);content.fadeTo(currentOpts.changeFade,0.3,function(){var finish_resizing=function(){content.html(tmp.contents()).fadeTo(currentOpts.changeFade,1,_finish);};$.event.trigger('fancybox-change');content.empty().removeAttr('filter').css({'border-width':currentOpts.padding,'width':final_pos.width-currentOpts.padding*2,'height':selectedOpts.autoDimensions?'auto':final_pos.height-titleHeight-currentOpts.padding*2});if(equal){finish_resizing();}else{fx.prop=0;$(fx).animate({prop:1},{duration:currentOpts.changeSpeed,easing:currentOpts.easingChange,step:_draw,complete:finish_resizing});}});return;}
wrap.removeAttr("style");content.css('border-width',currentOpts.padding);if(currentOpts.transitionIn=='elastic'){start_pos=_get_zoom_from();content.html(tmp.contents());wrap.show();if(currentOpts.opacity){final_pos.opacity=0;}
fx.prop=0;$(fx).animate({prop:1},{duration:currentOpts.speedIn,easing:currentOpts.easingIn,step:_draw,complete:_finish});return;}
if(currentOpts.titlePosition=='inside'&&titleHeight>0){title.show();}
content.css({'width':final_pos.width-currentOpts.padding*2,'height':selectedOpts.autoDimensions?'auto':final_pos.height-titleHeight-currentOpts.padding*2}).html(tmp.contents());wrap.css(final_pos).fadeIn(currentOpts.transitionIn=='none'?0:currentOpts.speedIn,_finish);},_format_title=function(title){if(title&&title.length){if(currentOpts.titlePosition=='float'){return'<table id="fancybox-title-float-wrap" cellpadding="0" cellspacing="0"><tr><td id="fancybox-title-float-left"></td><td id="fancybox-title-float-main">'+title+'</td><td id="fancybox-title-float-right"></td></tr></table>';}
return'<div id="fancybox-title-'+currentOpts.titlePosition+'">'+title+'</div>';}
return false;},_process_title=function(){titleStr=currentOpts.title||'';titleHeight=0;title.empty().removeAttr('style').removeClass();if(currentOpts.titleShow===false){title.hide();return;}
titleStr=$.isFunction(currentOpts.titleFormat)?currentOpts.titleFormat(titleStr,currentArray,currentIndex,currentOpts):_format_title(titleStr);if(!titleStr||titleStr===''){title.hide();return;}
title.addClass('fancybox-title-'+currentOpts.titlePosition).html(titleStr).appendTo('body').show();switch(currentOpts.titlePosition){case'inside':title.css({'width':final_pos.width-(currentOpts.padding*2),'marginLeft':currentOpts.padding,'marginRight':currentOpts.padding});titleHeight=title.outerHeight(true);title.appendTo(outer);final_pos.height+=titleHeight;break;case'over':title.css({'marginLeft':currentOpts.padding,'width':final_pos.width-(currentOpts.padding*2),'bottom':currentOpts.padding}).appendTo(outer);break;case'float':title.css('left',parseInt((title.width()-final_pos.width-40)/2,10)*-1).appendTo(wrap);break;default:title.css({'width':final_pos.width-(currentOpts.padding*2),'paddingLeft':currentOpts.padding,'paddingRight':currentOpts.padding}).appendTo(wrap);break;}
title.hide();},_set_navigation=function(){if(currentOpts.enableEscapeButton||currentOpts.enableKeyboardNav){$(document).bind('keydown.fb',function(e){if(e.keyCode==27&&currentOpts.enableEscapeButton){e.preventDefault();$.fancybox.close();}else if((e.keyCode==37||e.keyCode==39)&&currentOpts.enableKeyboardNav&&e.target.tagName!=='INPUT'&&e.target.tagName!=='TEXTAREA'&&e.target.tagName!=='SELECT'){e.preventDefault();$.fancybox[e.keyCode==37?'prev':'next']();}});}
if(!currentOpts.showNavArrows){nav_left.hide();nav_right.hide();return;}
if((currentOpts.cyclic&&currentArray.length>1)||currentIndex!==0){nav_left.show();}
if((currentOpts.cyclic&&currentArray.length>1)||currentIndex!=(currentArray.length-1)){nav_right.show();}},_finish=function(){if(!$.support.opacity){content.get(0).style.removeAttribute('filter');wrap.get(0).style.removeAttribute('filter');}
if(selectedOpts.autoDimensions){content.css('height','auto');}
wrap.css('height','auto');if(titleStr&&titleStr.length){title.show();}
if(currentOpts.showCloseButton){close.show();}
_set_navigation();if(currentOpts.hideOnContentClick){content.bind('click',$.fancybox.close);}
if(currentOpts.hideOnOverlayClick){overlay.bind('click',$.fancybox.close);}
$(window).bind("resize.fb",$.fancybox.resize);if(currentOpts.centerOnScroll){$(window).bind("scroll.fb",$.fancybox.center);}
if(currentOpts.type=='iframe'){$('<iframe id="fancybox-frame" name="fancybox-frame'+new Date().getTime()+'" frameborder="0" hspace="0" '+($.browser.msie?'allowtransparency="true""':'')+' scrolling="'+selectedOpts.scrolling+'" src="'+currentOpts.href+'"></iframe>').appendTo(content);}
wrap.show();busy=false;$.fancybox.center();currentOpts.onComplete(currentArray,currentIndex,currentOpts);_preload_images();},_preload_images=function(){var href,objNext;if((currentArray.length-1)>currentIndex){href=currentArray[currentIndex+1].href;if(typeof href!=='undefined'&&href.match(imgRegExp)){objNext=new Image();objNext.src=href;}}
if(currentIndex>0){href=currentArray[currentIndex-1].href;if(typeof href!=='undefined'&&href.match(imgRegExp)){objNext=new Image();objNext.src=href;}}},_draw=function(pos){var dim={width:parseInt(start_pos.width+(final_pos.width-start_pos.width)*pos,10),height:parseInt(start_pos.height+(final_pos.height-start_pos.height)*pos,10),top:parseInt(start_pos.top+(final_pos.top-start_pos.top)*pos,10),left:parseInt(start_pos.left+(final_pos.left-start_pos.left)*pos,10)};if(typeof final_pos.opacity!=='undefined'){dim.opacity=pos<0.5?0.5:pos;}
wrap.css(dim);content.css({'width':dim.width-currentOpts.padding*2,'height':dim.height-(titleHeight*pos)-currentOpts.padding*2});},_get_viewport=function(){return[$(window).width()-(currentOpts.margin*2),$(window).height()-(currentOpts.margin*2),$(document).scrollLeft()+currentOpts.margin,$(document).scrollTop()+currentOpts.margin];},_get_zoom_to=function(){var view=_get_viewport(),to={},resize=currentOpts.autoScale,double_padding=currentOpts.padding*2,ratio;if(currentOpts.width.toString().indexOf('%')>-1){to.width=parseInt((view[0]*parseFloat(currentOpts.width))/100,10);}else{to.width=currentOpts.width+double_padding;}
if(currentOpts.height.toString().indexOf('%')>-1){to.height=parseInt((view[1]*parseFloat(currentOpts.height))/100,10);}else{to.height=currentOpts.height+double_padding;}
if(resize&&(to.width>view[0]||to.height>view[1])){if(selectedOpts.type=='image'||selectedOpts.type=='swf'){ratio=(currentOpts.width)/(currentOpts.height);if((to.width)>view[0]){to.width=view[0];to.height=parseInt(((to.width-double_padding)/ratio)+double_padding,10);}
if((to.height)>view[1]){to.height=view[1];to.width=parseInt(((to.height-double_padding)*ratio)+double_padding,10);}}else{to.width=Math.min(to.width,view[0]);to.height=Math.min(to.height,view[1]);}}
to.top=parseInt(Math.max(view[3]-20,view[3]+((view[1]-to.height-40)*0.5)),10);to.left=parseInt(Math.max(view[2]-20,view[2]+((view[0]-to.width-40)*0.5)),10);return to;},_get_obj_pos=function(obj){var pos=obj.offset();pos.top+=parseInt(obj.css('paddingTop'),10)||0;pos.left+=parseInt(obj.css('paddingLeft'),10)||0;pos.top+=parseInt(obj.css('border-top-width'),10)||0;pos.left+=parseInt(obj.css('border-left-width'),10)||0;pos.width=obj.width();pos.height=obj.height();return pos;},_get_zoom_from=function(){var orig=selectedOpts.orig?$(selectedOpts.orig):false,from={},pos,view;if(orig&&orig.length){pos=_get_obj_pos(orig);from={width:pos.width+(currentOpts.padding*2),height:pos.height+(currentOpts.padding*2),top:pos.top-currentOpts.padding-20,left:pos.left-currentOpts.padding-20};}else{view=_get_viewport();from={width:currentOpts.padding*2,height:currentOpts.padding*2,top:parseInt(view[3]+view[1]*0.5,10),left:parseInt(view[2]+view[0]*0.5,10)};}
return from;},_animate_loading=function(){if(!loading.is(':visible')){clearInterval(loadingTimer);return;}
$('div',loading).css('top',(loadingFrame*-40)+'px');loadingFrame=(loadingFrame+1)%12;};$.fn.fancybox=function(options){if(!$(this).length){return this;}
$(this).data('fancybox',$.extend({},options,($.metadata?$(this).metadata():{}))).unbind('click.fb').bind('click.fb',function(e){e.preventDefault();if(busy){return;}
busy=true;$(this).blur();selectedArray=[];selectedIndex=0;var rel=$(this).attr('rel')||'';if(!rel||rel==''||rel==='nofollow'){selectedArray.push(this);}else{selectedArray=$("a[rel="+rel+"], area[rel="+rel+"]");selectedIndex=selectedArray.index(this);}
_start();return;});return this;};$.fancybox=function(obj){var opts;if(busy){return;}
busy=true;opts=typeof arguments[1]!=='undefined'?arguments[1]:{};selectedArray=[];selectedIndex=parseInt(opts.index,10)||0;if($.isArray(obj)){for(var i=0,j=obj.length;i<j;i++){if(typeof obj[i]=='object'){$(obj[i]).data('fancybox',$.extend({},opts,obj[i]));}else{obj[i]=$({}).data('fancybox',$.extend({content:obj[i]},opts));}}
selectedArray=jQuery.merge(selectedArray,obj);}else{if(typeof obj=='object'){$(obj).data('fancybox',$.extend({},opts,obj));}else{obj=$({}).data('fancybox',$.extend({content:obj},opts));}
selectedArray.push(obj);}
if(selectedIndex>selectedArray.length||selectedIndex<0){selectedIndex=0;}
_start();};$.fancybox.showActivity=function(){clearInterval(loadingTimer);loading.show();loadingTimer=setInterval(_animate_loading,66);};$.fancybox.hideActivity=function(){loading.hide();};$.fancybox.next=function(){return $.fancybox.pos(currentIndex+1);};$.fancybox.prev=function(){return $.fancybox.pos(currentIndex-1);};$.fancybox.pos=function(pos){if(busy){return;}
pos=parseInt(pos);selectedArray=currentArray;if(pos>-1&&pos<currentArray.length){selectedIndex=pos;_start();}else if(currentOpts.cyclic&&currentArray.length>1){selectedIndex=pos>=currentArray.length?0:currentArray.length-1;_start();}
return;};$.fancybox.cancel=function(){if(busy){return;}
busy=true;$.event.trigger('fancybox-cancel');_abort();selectedOpts.onCancel(selectedArray,selectedIndex,selectedOpts);busy=false;};$.fancybox.close=function(){if(busy||wrap.is(':hidden')){return;}
busy=true;if(currentOpts&&false===currentOpts.onCleanup(currentArray,currentIndex,currentOpts)){busy=false;return;}
_abort();$(close.add(nav_left).add(nav_right)).hide();$(content.add(overlay)).unbind();$(window).unbind("resize.fb scroll.fb");$(document).unbind('keydown.fb');content.find('iframe').attr('src',isIE6&&/^https/i.test(window.location.href||'')?'javascript:void(false)':'about:blank');if(currentOpts.titlePosition!=='inside'){title.empty();}
wrap.stop();function _cleanup(){overlay.fadeOut('fast');title.empty().hide();wrap.hide();$.event.trigger('fancybox-cleanup');content.empty();currentOpts.onClosed(currentArray,currentIndex,currentOpts);currentArray=selectedOpts=[];currentIndex=selectedIndex=0;currentOpts=selectedOpts={};busy=false;}
if(currentOpts.transitionOut=='elastic'){start_pos=_get_zoom_from();var pos=wrap.position();final_pos={top:pos.top,left:pos.left,width:wrap.width(),height:wrap.height()};if(currentOpts.opacity){final_pos.opacity=1;}
title.empty().hide();fx.prop=1;$(fx).animate({prop:0},{duration:currentOpts.speedOut,easing:currentOpts.easingOut,step:_draw,complete:_cleanup});}else{wrap.fadeOut(currentOpts.transitionOut=='none'?0:currentOpts.speedOut,_cleanup);}};$.fancybox.resize=function(){if(overlay.is(':visible')){overlay.css('height',$(document).height());}
$.fancybox.center(true);};$.fancybox.center=function(){var view,align;if(busy){return;}
align=arguments[0]===true?1:0;view=_get_viewport();if(!align&&(wrap.width()>view[0]||wrap.height()>view[1])){return;}
wrap.stop().animate({'top':parseInt(Math.max(view[3]-20,view[3]+((view[1]-content.height()-40)*0.5)-currentOpts.padding)),'left':parseInt(Math.max(view[2]-20,view[2]+((view[0]-content.width()-40)*0.5)-currentOpts.padding))},typeof arguments[0]=='number'?arguments[0]:200);};$.fancybox.init=function(){if($("#fancybox-wrap").length){return;}
$('body').append(tmp=$('<div id="fancybox-tmp"></div>'),loading=$('<div id="fancybox-loading"><div></div></div>'),overlay=$('<div id="fancybox-overlay"></div>'),wrap=$('<div id="fancybox-wrap"></div>'));outer=$('<div id="fancybox-outer"></div>').append('<div class="fancybox-bg" id="fancybox-bg-n"></div><div class="fancybox-bg" id="fancybox-bg-ne"></div><div class="fancybox-bg" id="fancybox-bg-e"></div><div class="fancybox-bg" id="fancybox-bg-se"></div><div class="fancybox-bg" id="fancybox-bg-s"></div><div class="fancybox-bg" id="fancybox-bg-sw"></div><div class="fancybox-bg" id="fancybox-bg-w"></div><div class="fancybox-bg" id="fancybox-bg-nw"></div>').appendTo(wrap);outer.append(content=$('<div id="fancybox-content"></div>'),close=$('<a id="fancybox-close"></a>'),title=$('<div id="fancybox-title"></div>'),nav_left=$('<a href="javascript:;" id="fancybox-left"><span class="fancy-ico" id="fancybox-left-ico"></span></a>'),nav_right=$('<a href="javascript:;" id="fancybox-right"><span class="fancy-ico" id="fancybox-right-ico"></span></a>'));close.click($.fancybox.close);loading.click($.fancybox.cancel);nav_left.click(function(e){e.preventDefault();$.fancybox.prev();});nav_right.click(function(e){e.preventDefault();$.fancybox.next();});if($.fn.mousewheel){wrap.bind('mousewheel.fb',function(e,delta){if(busy){e.preventDefault();}else if($(e.target).get(0).clientHeight==0||$(e.target).get(0).scrollHeight===$(e.target).get(0).clientHeight){e.preventDefault();$.fancybox[delta>0?'prev':'next']();}});}
if(!$.support.opacity){wrap.addClass('fancybox-ie');}
if(isIE6){loading.addClass('fancybox-ie6');wrap.addClass('fancybox-ie6');$('<iframe id="fancybox-hide-sel-frame" src="'+(/^https/i.test(window.location.href||'')?'javascript:void(false)':'about:blank')+'" scrolling="no" border="0" frameborder="0" tabindex="-1"></iframe>').prependTo(outer);}};$.fn.fancybox.defaults={padding:10,margin:40,opacity:false,modal:false,cyclic:false,scrolling:'auto',width:560,height:340,autoScale:true,autoDimensions:true,centerOnScroll:false,ajax:{},swf:{wmode:'transparent'},hideOnOverlayClick:true,hideOnContentClick:false,overlayShow:true,overlayOpacity:0.7,overlayColor:'#777',titleShow:true,titlePosition:'float',titleFormat:null,titleFromAlt:false,transitionIn:'fade',transitionOut:'fade',speedIn:300,speedOut:300,changeSpeed:300,changeFade:'fast',easingIn:'swing',easingOut:'swing',showCloseButton:true,showNavArrows:true,enableEscapeButton:true,enableKeyboardNav:true,onStart:function(){},onCancel:function(){},onComplete:function(){},onCleanup:function(){},onClosed:function(){},onError:function(){}};$(document).ready(function(){$.fancybox.init();});})(jQuery);(function($,window,document){$.fn.dataTableSettings=[];var _aoSettings=$.fn.dataTableSettings;$.fn.dataTableExt={};var _oExt=$.fn.dataTableExt;_oExt.sVersion="1.7.4";_oExt.sErrMode="alert";_oExt.iApiIndex=0;_oExt.oApi={};_oExt.afnFiltering=[];_oExt.aoFeatures=[];_oExt.ofnSearch={};_oExt.afnSortData=[];_oExt.oStdClasses={"sPagePrevEnabled":"paginate_enabled_previous","sPagePrevDisabled":"paginate_disabled_previous","sPageNextEnabled":"paginate_enabled_next","sPageNextDisabled":"paginate_disabled_next","sPageJUINext":"","sPageJUIPrev":"","sPageButton":"paginate_button","sPageButtonActive":"paginate_active","sPageButtonStaticDisabled":"paginate_button","sPageFirst":"first","sPagePrevious":"previous","sPageNext":"next","sPageLast":"last","sStripOdd":"odd","sStripEven":"even","sRowEmpty":"dataTables_empty","sWrapper":"dataTables_wrapper","sFilter":"dataTables_filter","sInfo":"dataTables_info","sPaging":"dataTables_paginate paging_","sLength":"dataTables_length","sProcessing":"dataTables_processing","sSortAsc":"sorting_asc","sSortDesc":"sorting_desc","sSortable":"sorting","sSortableAsc":"sorting_asc_disabled","sSortableDesc":"sorting_desc_disabled","sSortableNone":"sorting_disabled","sSortColumn":"sorting_","sSortJUIAsc":"","sSortJUIDesc":"","sSortJUI":"","sSortJUIAscAllowed":"","sSortJUIDescAllowed":"","sSortJUIWrapper":"","sScrollWrapper":"dataTables_scroll","sScrollHead":"dataTables_scrollHead","sScrollHeadInner":"dataTables_scrollHeadInner","sScrollBody":"dataTables_scrollBody","sScrollFoot":"dataTables_scrollFoot","sScrollFootInner":"dataTables_scrollFootInner","sFooterTH":""};_oExt.oJUIClasses={"sPagePrevEnabled":"fg-button ui-button ui-state-default ui-corner-left","sPagePrevDisabled":"fg-button ui-button ui-state-default ui-corner-left ui-state-disabled","sPageNextEnabled":"fg-button ui-button ui-state-default ui-corner-right","sPageNextDisabled":"fg-button ui-button ui-state-default ui-corner-right ui-state-disabled","sPageJUINext":"ui-icon ui-icon-circle-arrow-e","sPageJUIPrev":"ui-icon ui-icon-circle-arrow-w","sPageButton":"fg-button ui-button ui-state-default","sPageButtonActive":"fg-button ui-button ui-state-default ui-state-disabled","sPageButtonStaticDisabled":"fg-button ui-button ui-state-default ui-state-disabled","sPageFirst":"first ui-corner-tl ui-corner-bl","sPagePrevious":"previous","sPageNext":"next","sPageLast":"last ui-corner-tr ui-corner-br","sStripOdd":"odd","sStripEven":"even","sRowEmpty":"dataTables_empty","sWrapper":"dataTables_wrapper","sFilter":"dataTables_filter","sInfo":"dataTables_info","sPaging":"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi "+"ui-buttonset-multi paging_","sLength":"dataTables_length","sProcessing":"dataTables_processing","sSortAsc":"ui-state-default","sSortDesc":"ui-state-default","sSortable":"ui-state-default","sSortableAsc":"ui-state-default","sSortableDesc":"ui-state-default","sSortableNone":"ui-state-default","sSortColumn":"sorting_","sSortJUIAsc":"css_right ui-icon ui-icon-triangle-1-n","sSortJUIDesc":"css_right ui-icon ui-icon-triangle-1-s","sSortJUI":"css_right ui-icon ui-icon-carat-2-n-s","sSortJUIAscAllowed":"css_right ui-icon ui-icon-carat-1-n","sSortJUIDescAllowed":"css_right ui-icon ui-icon-carat-1-s","sSortJUIWrapper":"DataTables_sort_wrapper","sScrollWrapper":"dataTables_scroll","sScrollHead":"dataTables_scrollHead ui-state-default","sScrollHeadInner":"dataTables_scrollHeadInner","sScrollBody":"dataTables_scrollBody","sScrollFoot":"dataTables_scrollFoot ui-state-default","sScrollFootInner":"dataTables_scrollFootInner","sFooterTH":"ui-state-default"};_oExt.oPagination={"two_button":{"fnInit":function(oSettings,nPaging,fnCallbackDraw)
{var nPrevious,nNext,nPreviousInner,nNextInner;if(!oSettings.bJUI)
{nPrevious=document.createElement('div');nNext=document.createElement('div');}
else
{nPrevious=document.createElement('a');nNext=document.createElement('a');nNextInner=document.createElement('span');nNextInner.className=oSettings.oClasses.sPageJUINext;nNext.appendChild(nNextInner);nPreviousInner=document.createElement('span');nPreviousInner.className=oSettings.oClasses.sPageJUIPrev;nPrevious.appendChild(nPreviousInner);}
nPrevious.className=oSettings.oClasses.sPagePrevDisabled;nNext.className=oSettings.oClasses.sPageNextDisabled;nPrevious.title=oSettings.oLanguage.oPaginate.sPrevious;nNext.title=oSettings.oLanguage.oPaginate.sNext;nPaging.appendChild(nPrevious);nPaging.appendChild(nNext);$(nPrevious).click(function(){if(oSettings.oApi._fnPageChange(oSettings,"previous"))
{fnCallbackDraw(oSettings);}});$(nNext).click(function(){if(oSettings.oApi._fnPageChange(oSettings,"next"))
{fnCallbackDraw(oSettings);}});$(nPrevious).bind('selectstart',function(){return false;});$(nNext).bind('selectstart',function(){return false;});if(oSettings.sTableId!==''&&typeof oSettings.aanFeatures.p=="undefined")
{nPaging.setAttribute('id',oSettings.sTableId+'_paginate');nPrevious.setAttribute('id',oSettings.sTableId+'_previous');nNext.setAttribute('id',oSettings.sTableId+'_next');}},"fnUpdate":function(oSettings,fnCallbackDraw)
{if(!oSettings.aanFeatures.p)
{return;}
var an=oSettings.aanFeatures.p;for(var i=0,iLen=an.length;i<iLen;i++)
{if(an[i].childNodes.length!==0)
{an[i].childNodes[0].className=(oSettings._iDisplayStart===0)?oSettings.oClasses.sPagePrevDisabled:oSettings.oClasses.sPagePrevEnabled;an[i].childNodes[1].className=(oSettings.fnDisplayEnd()==oSettings.fnRecordsDisplay())?oSettings.oClasses.sPageNextDisabled:oSettings.oClasses.sPageNextEnabled;}}}},"iFullNumbersShowPages":5,"full_numbers":{"fnInit":function(oSettings,nPaging,fnCallbackDraw)
{var nFirst=document.createElement('span');var nPrevious=document.createElement('span');var nList=document.createElement('span');var nNext=document.createElement('span');var nLast=document.createElement('span');nFirst.innerHTML=oSettings.oLanguage.oPaginate.sFirst;nPrevious.innerHTML=oSettings.oLanguage.oPaginate.sPrevious;nNext.innerHTML=oSettings.oLanguage.oPaginate.sNext;nLast.innerHTML=oSettings.oLanguage.oPaginate.sLast;var oClasses=oSettings.oClasses;nFirst.className=oClasses.sPageButton+" "+oClasses.sPageFirst;nPrevious.className=oClasses.sPageButton+" "+oClasses.sPagePrevious;nNext.className=oClasses.sPageButton+" "+oClasses.sPageNext;nLast.className=oClasses.sPageButton+" "+oClasses.sPageLast;nPaging.appendChild(nFirst);nPaging.appendChild(nPrevious);nPaging.appendChild(nList);nPaging.appendChild(nNext);nPaging.appendChild(nLast);$(nFirst).click(function(){if(oSettings.oApi._fnPageChange(oSettings,"first"))
{fnCallbackDraw(oSettings);}});$(nPrevious).click(function(){if(oSettings.oApi._fnPageChange(oSettings,"previous"))
{fnCallbackDraw(oSettings);}});$(nNext).click(function(){if(oSettings.oApi._fnPageChange(oSettings,"next"))
{fnCallbackDraw(oSettings);}});$(nLast).click(function(){if(oSettings.oApi._fnPageChange(oSettings,"last"))
{fnCallbackDraw(oSettings);}});$('span',nPaging).bind('mousedown',function(){return false;}).bind('selectstart',function(){return false;});if(oSettings.sTableId!==''&&typeof oSettings.aanFeatures.p=="undefined")
{nPaging.setAttribute('id',oSettings.sTableId+'_paginate');nFirst.setAttribute('id',oSettings.sTableId+'_first');nPrevious.setAttribute('id',oSettings.sTableId+'_previous');nNext.setAttribute('id',oSettings.sTableId+'_next');nLast.setAttribute('id',oSettings.sTableId+'_last');}},"fnUpdate":function(oSettings,fnCallbackDraw)
{if(!oSettings.aanFeatures.p)
{return;}
var iPageCount=_oExt.oPagination.iFullNumbersShowPages;var iPageCountHalf=Math.floor(iPageCount/2);var iPages=Math.ceil((oSettings.fnRecordsDisplay())/oSettings._iDisplayLength);var iCurrentPage=Math.ceil(oSettings._iDisplayStart/oSettings._iDisplayLength)+1;var sList="";var iStartButton,iEndButton,i,iLen;var oClasses=oSettings.oClasses;if(iPages<iPageCount)
{iStartButton=1;iEndButton=iPages;}
else
{if(iCurrentPage<=iPageCountHalf)
{iStartButton=1;iEndButton=iPageCount;}
else
{if(iCurrentPage>=(iPages-iPageCountHalf))
{iStartButton=iPages-iPageCount+1;iEndButton=iPages;}
else
{iStartButton=iCurrentPage-Math.ceil(iPageCount/2)+1;iEndButton=iStartButton+iPageCount-1;}}}
for(i=iStartButton;i<=iEndButton;i++)
{if(iCurrentPage!=i)
{sList+='<span class="'+oClasses.sPageButton+'">'+i+'</span>';}
else
{sList+='<span class="'+oClasses.sPageButtonActive+'">'+i+'</span>';}}
var an=oSettings.aanFeatures.p;var anButtons,anStatic,nPaginateList;var fnClick=function(){var iTarget=(this.innerHTML*1)-1;oSettings._iDisplayStart=iTarget*oSettings._iDisplayLength;fnCallbackDraw(oSettings);return false;};var fnFalse=function(){return false;};for(i=0,iLen=an.length;i<iLen;i++)
{if(an[i].childNodes.length===0)
{continue;}
var qjPaginateList=$('span:eq(2)',an[i]);qjPaginateList.html(sList);$('span',qjPaginateList).click(fnClick).bind('mousedown',fnFalse).bind('selectstart',fnFalse);anButtons=an[i].getElementsByTagName('span');anStatic=[anButtons[0],anButtons[1],anButtons[anButtons.length-2],anButtons[anButtons.length-1]];$(anStatic).removeClass(oClasses.sPageButton+" "+oClasses.sPageButtonActive+" "+oClasses.sPageButtonStaticDisabled);if(iCurrentPage==1)
{anStatic[0].className+=" "+oClasses.sPageButtonStaticDisabled;anStatic[1].className+=" "+oClasses.sPageButtonStaticDisabled;}
else
{anStatic[0].className+=" "+oClasses.sPageButton;anStatic[1].className+=" "+oClasses.sPageButton;}
if(iPages===0||iCurrentPage==iPages||oSettings._iDisplayLength==-1)
{anStatic[2].className+=" "+oClasses.sPageButtonStaticDisabled;anStatic[3].className+=" "+oClasses.sPageButtonStaticDisabled;}
else
{anStatic[2].className+=" "+oClasses.sPageButton;anStatic[3].className+=" "+oClasses.sPageButton;}}}}};_oExt.oSort={"string-asc":function(a,b)
{var x=a.toLowerCase();var y=b.toLowerCase();return((x<y)?-1:((x>y)?1:0));},"string-desc":function(a,b)
{var x=a.toLowerCase();var y=b.toLowerCase();return((x<y)?1:((x>y)?-1:0));},"html-asc":function(a,b)
{var x=a.replace(/<.*?>/g,"").toLowerCase();var y=b.replace(/<.*?>/g,"").toLowerCase();return((x<y)?-1:((x>y)?1:0));},"html-desc":function(a,b)
{var x=a.replace(/<.*?>/g,"").toLowerCase();var y=b.replace(/<.*?>/g,"").toLowerCase();return((x<y)?1:((x>y)?-1:0));},"date-asc":function(a,b)
{var x=Date.parse(a);var y=Date.parse(b);if(isNaN(x)||x==="")
{x=Date.parse("01/01/1970 00:00:00");}
if(isNaN(y)||y==="")
{y=Date.parse("01/01/1970 00:00:00");}
return x-y;},"date-desc":function(a,b)
{var x=Date.parse(a);var y=Date.parse(b);if(isNaN(x)||x==="")
{x=Date.parse("01/01/1970 00:00:00");}
if(isNaN(y)||y==="")
{y=Date.parse("01/01/1970 00:00:00");}
return y-x;},"numeric-asc":function(a,b)
{var x=(a=="-"||a==="")?0:a*1;var y=(b=="-"||b==="")?0:b*1;return x-y;},"numeric-desc":function(a,b)
{var x=(a=="-"||a==="")?0:a*1;var y=(b=="-"||b==="")?0:b*1;return y-x;}};_oExt.aTypes=[function(sData)
{if(sData.length===0)
{return'numeric';}
var sValidFirstChars="0123456789-";var sValidChars="0123456789.";var Char;var bDecimal=false;Char=sData.charAt(0);if(sValidFirstChars.indexOf(Char)==-1)
{return null;}
for(var i=1;i<sData.length;i++)
{Char=sData.charAt(i);if(sValidChars.indexOf(Char)==-1)
{return null;}
if(Char==".")
{if(bDecimal)
{return null;}
bDecimal=true;}}
return'numeric';},function(sData)
{var iParse=Date.parse(sData);if((iParse!==null&&!isNaN(iParse))||sData.length===0)
{return'date';}
return null;},function(sData)
{if(sData.indexOf('<')!=-1&&sData.indexOf('>')!=-1)
{return'html';}
return null;}];_oExt.fnVersionCheck=function(sVersion)
{var fnZPad=function(Zpad,count)
{while(Zpad.length<count){Zpad+='0';}
return Zpad;};var aThis=_oExt.sVersion.split('.');var aThat=sVersion.split('.');var sThis='',sThat='';for(var i=0,iLen=aThat.length;i<iLen;i++)
{sThis+=fnZPad(aThis[i],3);sThat+=fnZPad(aThat[i],3);}
return parseInt(sThis,10)>=parseInt(sThat,10);};_oExt._oExternConfig={"iNextUnique":0};$.fn.dataTable=function(oInit)
{function classSettings()
{this.fnRecordsTotal=function()
{if(this.oFeatures.bServerSide){return parseInt(this._iRecordsTotal,10);}else{return this.aiDisplayMaster.length;}};this.fnRecordsDisplay=function()
{if(this.oFeatures.bServerSide){return parseInt(this._iRecordsDisplay,10);}else{return this.aiDisplay.length;}};this.fnDisplayEnd=function()
{if(this.oFeatures.bServerSide){if(this.oFeatures.bPaginate===false||this._iDisplayLength==-1){return this._iDisplayStart+this.aiDisplay.length;}else{return Math.min(this._iDisplayStart+this._iDisplayLength,this._iRecordsDisplay);}}else{return this._iDisplayEnd;}};this.oInstance=null;this.sInstance=null;this.oFeatures={"bPaginate":true,"bLengthChange":true,"bFilter":true,"bSort":true,"bInfo":true,"bAutoWidth":true,"bProcessing":false,"bSortClasses":true,"bStateSave":false,"bServerSide":false};this.oScroll={"sX":"","sXInner":"","sY":"","bCollapse":false,"bInfinite":false,"iLoadGap":100,"iBarWidth":0};this.aanFeatures=[];this.oLanguage={"sProcessing":"Processing...","sLengthMenu":"Show _MENU_ entries","sZeroRecords":"No matching records found","sEmptyTable":"No data available in table","sInfo":"Showing _START_ to _END_ of _TOTAL_ entries","sInfoEmpty":"Showing 0 to 0 of 0 entries","sInfoFiltered":"(filtered from _MAX_ total entries)","sInfoPostFix":"","sSearch":"Search:","sUrl":"","oPaginate":{"sFirst":"First","sPrevious":"Previous","sNext":"Next","sLast":"Last"},"fnInfoCallback":null};this.aoData=[];this.aiDisplay=[];this.aiDisplayMaster=[];this.aoColumns=[];this.iNextId=0;this.asDataSearch=[];this.oPreviousSearch={"sSearch":"","bRegex":false,"bSmart":true};this.aoPreSearchCols=[];this.aaSorting=[[0,'asc',0]];this.aaSortingFixed=null;this.asStripClasses=[];this.asDestoryStrips=[];this.sDestroyWidth=0;this.fnRowCallback=null;this.fnHeaderCallback=null;this.fnFooterCallback=null;this.aoDrawCallback=[];this.fnInitComplete=null;this.sTableId="";this.nTable=null;this.nTHead=null;this.nTFoot=null;this.nTBody=null;this.nTableWrapper=null;this.bInitialised=false;this.aoOpenRows=[];this.sDom='lfrtip';this.sPaginationType="two_button";this.iCookieDuration=60*60*2;this.sCookiePrefix="SpryMedia_DataTables_";this.fnCookieCallback=null;this.aoStateSave=[];this.aoStateLoad=[];this.oLoadedState=null;this.sAjaxSource=null;this.bAjaxDataGet=true;this.fnServerData=function(url,data,callback){$.ajax({"url":url,"data":data,"success":callback,"dataType":"json","cache":false,"error":function(xhr,error,thrown){if(error=="parsererror"){alert("DataTables warning: JSON data from server could not be parsed. "+"This is caused by a JSON formatting error.");}}});};this.fnFormatNumber=function(iIn)
{if(iIn<1000)
{return iIn;}
else
{var s=(iIn+""),a=s.split(""),out="",iLen=s.length;for(var i=0;i<iLen;i++)
{if(i%3===0&&i!==0)
{out=','+out;}
out=a[iLen-i-1]+out;}}
return out;};this.aLengthMenu=[10,25,50,100];this.iDraw=0;this.bDrawing=0;this.iDrawError=-1;this._iDisplayLength=10;this._iDisplayStart=0;this._iDisplayEnd=10;this._iRecordsTotal=0;this._iRecordsDisplay=0;this.bJUI=false;this.oClasses=_oExt.oStdClasses;this.bFiltered=false;this.bSorted=false;this.oInit=null;}
this.oApi={};this.fnDraw=function(bComplete)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);if(typeof bComplete!='undefined'&&bComplete===false)
{_fnCalculateEnd(oSettings);_fnDraw(oSettings);}
else
{_fnReDraw(oSettings);}};this.fnFilter=function(sInput,iColumn,bRegex,bSmart,bShowGlobal)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);if(!oSettings.oFeatures.bFilter)
{return;}
if(typeof bRegex=='undefined')
{bRegex=false;}
if(typeof bSmart=='undefined')
{bSmart=true;}
if(typeof bShowGlobal=='undefined')
{bShowGlobal=true;}
if(typeof iColumn=="undefined"||iColumn===null)
{_fnFilterComplete(oSettings,{"sSearch":sInput,"bRegex":bRegex,"bSmart":bSmart},1);if(bShowGlobal&&typeof oSettings.aanFeatures.f!='undefined')
{var n=oSettings.aanFeatures.f;for(var i=0,iLen=n.length;i<iLen;i++)
{$('input',n[i]).val(sInput);}}}
else
{oSettings.aoPreSearchCols[iColumn].sSearch=sInput;oSettings.aoPreSearchCols[iColumn].bRegex=bRegex;oSettings.aoPreSearchCols[iColumn].bSmart=bSmart;_fnFilterComplete(oSettings,oSettings.oPreviousSearch,1);}};this.fnSettings=function(nNode)
{return _fnSettingsFromNode(this[_oExt.iApiIndex]);};this.fnVersionCheck=_oExt.fnVersionCheck;this.fnSort=function(aaSort)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);oSettings.aaSorting=aaSort;_fnSort(oSettings);};this.fnSortListener=function(nNode,iColumn,fnCallback)
{_fnSortAttachListener(_fnSettingsFromNode(this[_oExt.iApiIndex]),nNode,iColumn,fnCallback);};this.fnAddData=function(mData,bRedraw)
{if(mData.length===0)
{return[];}
var aiReturn=[];var iTest;var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);if(typeof mData[0]=="object")
{for(var i=0;i<mData.length;i++)
{iTest=_fnAddData(oSettings,mData[i]);if(iTest==-1)
{return aiReturn;}
aiReturn.push(iTest);}}
else
{iTest=_fnAddData(oSettings,mData);if(iTest==-1)
{return aiReturn;}
aiReturn.push(iTest);}
oSettings.aiDisplay=oSettings.aiDisplayMaster.slice();if(typeof bRedraw=='undefined'||bRedraw)
{_fnReDraw(oSettings);}
return aiReturn;};this.fnDeleteRow=function(mTarget,fnCallBack,bRedraw)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);var i,iAODataIndex;iAODataIndex=(typeof mTarget=='object')?_fnNodeToDataIndex(oSettings,mTarget):mTarget;var oData=oSettings.aoData.splice(iAODataIndex,1);var iDisplayIndex=$.inArray(iAODataIndex,oSettings.aiDisplay);oSettings.asDataSearch.splice(iDisplayIndex,1);_fnDeleteIndex(oSettings.aiDisplayMaster,iAODataIndex);_fnDeleteIndex(oSettings.aiDisplay,iAODataIndex);if(typeof fnCallBack=="function")
{fnCallBack.call(this,oSettings,oData);}
if(oSettings._iDisplayStart>=oSettings.aiDisplay.length)
{oSettings._iDisplayStart-=oSettings._iDisplayLength;if(oSettings._iDisplayStart<0)
{oSettings._iDisplayStart=0;}}
if(typeof bRedraw=='undefined'||bRedraw)
{_fnCalculateEnd(oSettings);_fnDraw(oSettings);}
return oData;};this.fnClearTable=function(bRedraw)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);_fnClearTable(oSettings);if(typeof bRedraw=='undefined'||bRedraw)
{_fnDraw(oSettings);}};this.fnOpen=function(nTr,sHtml,sClass)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);this.fnClose(nTr);var nNewRow=document.createElement("tr");var nNewCell=document.createElement("td");nNewRow.appendChild(nNewCell);nNewCell.className=sClass;nNewCell.colSpan=_fnVisbleColumns(oSettings);nNewCell.innerHTML=sHtml;var nTrs=$('tr',oSettings.nTBody);if($.inArray(nTr,nTrs)!=-1)
{$(nNewRow).insertAfter(nTr);}
oSettings.aoOpenRows.push({"nTr":nNewRow,"nParent":nTr});return nNewRow;};this.fnClose=function(nTr)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);for(var i=0;i<oSettings.aoOpenRows.length;i++)
{if(oSettings.aoOpenRows[i].nParent==nTr)
{var nTrParent=oSettings.aoOpenRows[i].nTr.parentNode;if(nTrParent)
{nTrParent.removeChild(oSettings.aoOpenRows[i].nTr);}
oSettings.aoOpenRows.splice(i,1);return 0;}}
return 1;};this.fnGetData=function(mRow)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);if(typeof mRow!='undefined')
{var iRow=(typeof mRow=='object')?_fnNodeToDataIndex(oSettings,mRow):mRow;return oSettings.aoData[iRow]._aData;}
return _fnGetDataMaster(oSettings);};this.fnGetNodes=function(iRow)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);if(typeof iRow!='undefined')
{return oSettings.aoData[iRow].nTr;}
return _fnGetTrNodes(oSettings);};this.fnGetPosition=function(nNode)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);var i;if(nNode.nodeName.toUpperCase()=="TR")
{return _fnNodeToDataIndex(oSettings,nNode);}
else if(nNode.nodeName.toUpperCase()=="TD")
{var iDataIndex=_fnNodeToDataIndex(oSettings,nNode.parentNode);var iCorrector=0;for(var j=0;j<oSettings.aoColumns.length;j++)
{if(oSettings.aoColumns[j].bVisible)
{if(oSettings.aoData[iDataIndex].nTr.getElementsByTagName('td')[j-iCorrector]==nNode)
{return[iDataIndex,j-iCorrector,j];}}
else
{iCorrector++;}}}
return null;};this.fnUpdate=function(mData,mRow,iColumn,bRedraw,bAction)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);var iVisibleColumn;var sDisplay;var iRow=(typeof mRow=='object')?_fnNodeToDataIndex(oSettings,mRow):mRow;if(typeof mData!='object')
{sDisplay=mData;oSettings.aoData[iRow]._aData[iColumn]=sDisplay;if(oSettings.aoColumns[iColumn].fnRender!==null)
{sDisplay=oSettings.aoColumns[iColumn].fnRender({"iDataRow":iRow,"iDataColumn":iColumn,"aData":oSettings.aoData[iRow]._aData,"oSettings":oSettings});if(oSettings.aoColumns[iColumn].bUseRendered)
{oSettings.aoData[iRow]._aData[iColumn]=sDisplay;}}
iVisibleColumn=_fnColumnIndexToVisible(oSettings,iColumn);if(iVisibleColumn!==null)
{oSettings.aoData[iRow].nTr.getElementsByTagName('td')[iVisibleColumn].innerHTML=sDisplay;}}
else
{if(mData.length!=oSettings.aoColumns.length)
{_fnLog(oSettings,0,'An array passed to fnUpdate must have the same number of '+'columns as the table in question - in this case '+oSettings.aoColumns.length);return 1;}
for(var i=0;i<mData.length;i++)
{sDisplay=mData[i];oSettings.aoData[iRow]._aData[i]=sDisplay;if(oSettings.aoColumns[i].fnRender!==null)
{sDisplay=oSettings.aoColumns[i].fnRender({"iDataRow":iRow,"iDataColumn":i,"aData":oSettings.aoData[iRow]._aData,"oSettings":oSettings});if(oSettings.aoColumns[i].bUseRendered)
{oSettings.aoData[iRow]._aData[i]=sDisplay;}}
iVisibleColumn=_fnColumnIndexToVisible(oSettings,i);if(iVisibleColumn!==null)
{oSettings.aoData[iRow].nTr.getElementsByTagName('td')[iVisibleColumn].innerHTML=sDisplay;}}}
var iDisplayIndex=$.inArray(iRow,oSettings.aiDisplay);oSettings.asDataSearch[iDisplayIndex]=_fnBuildSearchRow(oSettings,oSettings.aoData[iRow]._aData);if(typeof bAction=='undefined'||bAction)
{_fnAjustColumnSizing(oSettings);}
if(typeof bRedraw=='undefined'||bRedraw)
{_fnReDraw(oSettings);}
return 0;};this.fnSetColumnVis=function(iCol,bShow,bRedraw)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);var i,iLen;var iColumns=oSettings.aoColumns.length;var nTd,anTds;if(oSettings.aoColumns[iCol].bVisible==bShow)
{return;}
var nTrHead=$('>tr',oSettings.nTHead)[0];var nTrFoot=$('>tr',oSettings.nTFoot)[0];var anTheadTh=[];var anTfootTh=[];for(i=0;i<iColumns;i++)
{anTheadTh.push(oSettings.aoColumns[i].nTh);anTfootTh.push(oSettings.aoColumns[i].nTf);}
if(bShow)
{var iInsert=0;for(i=0;i<iCol;i++)
{if(oSettings.aoColumns[i].bVisible)
{iInsert++;}}
if(iInsert>=_fnVisbleColumns(oSettings))
{nTrHead.appendChild(anTheadTh[iCol]);if(nTrFoot)
{nTrFoot.appendChild(anTfootTh[iCol]);}
for(i=0,iLen=oSettings.aoData.length;i<iLen;i++)
{nTd=oSettings.aoData[i]._anHidden[iCol];oSettings.aoData[i].nTr.appendChild(nTd);}}
else
{var iBefore;for(i=iCol;i<iColumns;i++)
{iBefore=_fnColumnIndexToVisible(oSettings,i);if(iBefore!==null)
{break;}}
nTrHead.insertBefore(anTheadTh[iCol],nTrHead.getElementsByTagName('th')[iBefore]);if(nTrFoot)
{nTrFoot.insertBefore(anTfootTh[iCol],nTrFoot.getElementsByTagName('th')[iBefore]);}
anTds=_fnGetTdNodes(oSettings);for(i=0,iLen=oSettings.aoData.length;i<iLen;i++)
{nTd=oSettings.aoData[i]._anHidden[iCol];oSettings.aoData[i].nTr.insertBefore(nTd,$('>td:eq('+iBefore+')',oSettings.aoData[i].nTr)[0]);}}
oSettings.aoColumns[iCol].bVisible=true;}
else
{nTrHead.removeChild(anTheadTh[iCol]);if(nTrFoot)
{nTrFoot.removeChild(anTfootTh[iCol]);}
anTds=_fnGetTdNodes(oSettings);for(i=0,iLen=oSettings.aoData.length;i<iLen;i++)
{nTd=anTds[(i*oSettings.aoColumns.length)+(iCol*1)];oSettings.aoData[i]._anHidden[iCol]=nTd;nTd.parentNode.removeChild(nTd);}
oSettings.aoColumns[iCol].bVisible=false;}
for(i=0,iLen=oSettings.aoOpenRows.length;i<iLen;i++)
{oSettings.aoOpenRows[i].nTr.colSpan=_fnVisbleColumns(oSettings);}
if(typeof bRedraw=='undefined'||bRedraw)
{_fnAjustColumnSizing(oSettings);_fnDraw(oSettings);}
_fnSaveState(oSettings);};this.fnPageChange=function(sAction,bRedraw)
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);_fnPageChange(oSettings,sAction);_fnCalculateEnd(oSettings);if(typeof bRedraw=='undefined'||bRedraw)
{_fnDraw(oSettings);}};this.fnDestroy=function()
{var oSettings=_fnSettingsFromNode(this[_oExt.iApiIndex]);var nOrig=oSettings.nTableWrapper.parentNode;var nBody=oSettings.nTBody;var i,iLen;oSettings.bDestroying=true;for(i=0,iLen=oSettings.aoColumns.length;i<iLen;i++)
{if(oSettings.aoColumns[i].bVisible===false)
{this.fnSetColumnVis(i,true);}}
$('tbody>tr>td.'+oSettings.oClasses.sRowEmpty,oSettings.nTable).parent().remove();if(oSettings.nTable!=oSettings.nTHead.parentNode)
{$('>thead',oSettings.nTable).remove();oSettings.nTable.appendChild(oSettings.nTHead);}
if(oSettings.nTFoot&&oSettings.nTable!=oSettings.nTFoot.parentNode)
{$('>tfoot',oSettings.nTable).remove();oSettings.nTable.appendChild(oSettings.nTFoot);}
oSettings.nTable.parentNode.removeChild(oSettings.nTable);$(oSettings.nTableWrapper).remove();oSettings.aaSorting=[];oSettings.aaSortingFixed=[];_fnSortingClasses(oSettings);$(_fnGetTrNodes(oSettings)).removeClass(oSettings.asStripClasses.join(' '));if(!oSettings.bJUI)
{$('th',oSettings.nTHead).removeClass([_oExt.oStdClasses.sSortable,_oExt.oStdClasses.sSortableAsc,_oExt.oStdClasses.sSortableDesc,_oExt.oStdClasses.sSortableNone].join(' '));}
else
{$('th',oSettings.nTHead).removeClass([_oExt.oStdClasses.sSortable,_oExt.oJUIClasses.sSortableAsc,_oExt.oJUIClasses.sSortableDesc,_oExt.oJUIClasses.sSortableNone].join(' '));$('th span',oSettings.nTHead).remove();}
nOrig.appendChild(oSettings.nTable);for(i=0,iLen=oSettings.aoData.length;i<iLen;i++)
{nBody.appendChild(oSettings.aoData[i].nTr);}
oSettings.nTable.style.width=_fnStringToCss(oSettings.sDestroyWidth);$('>tr:even',nBody).addClass(oSettings.asDestoryStrips[0]);$('>tr:odd',nBody).addClass(oSettings.asDestoryStrips[1]);for(i=0,iLen=_aoSettings.length;i<iLen;i++)
{if(_aoSettings[i]==oSettings)
{_aoSettings.splice(i,1);}}
oSettings=null;};this.fnAdjustColumnSizing=function(bRedraw)
{_fnAjustColumnSizing(_fnSettingsFromNode(this[_oExt.iApiIndex]));if(typeof bRedraw=='undefined'||bRedraw)
{this.fnDraw(false);}};function _fnExternApiFunc(sFunc)
{return function(){var aArgs=[_fnSettingsFromNode(this[_oExt.iApiIndex])].concat(Array.prototype.slice.call(arguments));return _oExt.oApi[sFunc].apply(this,aArgs);};}
for(var sFunc in _oExt.oApi)
{if(sFunc)
{this[sFunc]=_fnExternApiFunc(sFunc);}}
function _fnInitalise(oSettings)
{var i,iLen;if(oSettings.bInitialised===false)
{setTimeout(function(){_fnInitalise(oSettings);},200);return;}
_fnAddOptionsHtml(oSettings);_fnDrawHead(oSettings);_fnProcessingDisplay(oSettings,true);if(oSettings.oFeatures.bAutoWidth)
{_fnCalculateColumnWidths(oSettings);}
for(i=0,iLen=oSettings.aoColumns.length;i<iLen;i++)
{if(oSettings.aoColumns[i].sWidth!==null)
{oSettings.aoColumns[i].nTh.style.width=_fnStringToCss(oSettings.aoColumns[i].sWidth);}}
if(oSettings.oFeatures.bSort)
{_fnSort(oSettings);}
else
{oSettings.aiDisplay=oSettings.aiDisplayMaster.slice();_fnCalculateEnd(oSettings);_fnDraw(oSettings);}
if(oSettings.sAjaxSource!==null&&!oSettings.oFeatures.bServerSide)
{oSettings.fnServerData.call(oSettings.oInstance,oSettings.sAjaxSource,[],function(json){for(i=0;i<json.aaData.length;i++)
{_fnAddData(oSettings,json.aaData[i]);}
oSettings.iInitDisplayStart=oSettings._iDisplayStart;if(oSettings.oFeatures.bSort)
{_fnSort(oSettings);}
else
{oSettings.aiDisplay=oSettings.aiDisplayMaster.slice();_fnCalculateEnd(oSettings);_fnDraw(oSettings);}
_fnProcessingDisplay(oSettings,false);if(typeof oSettings.fnInitComplete=='function')
{oSettings.fnInitComplete.call(oSettings.oInstance,oSettings,json);}});return;}
if(!oSettings.oFeatures.bServerSide)
{_fnProcessingDisplay(oSettings,false);}}
function _fnLanguageProcess(oSettings,oLanguage,bInit)
{_fnMap(oSettings.oLanguage,oLanguage,'sProcessing');_fnMap(oSettings.oLanguage,oLanguage,'sLengthMenu');_fnMap(oSettings.oLanguage,oLanguage,'sEmptyTable');_fnMap(oSettings.oLanguage,oLanguage,'sZeroRecords');_fnMap(oSettings.oLanguage,oLanguage,'sInfo');_fnMap(oSettings.oLanguage,oLanguage,'sInfoEmpty');_fnMap(oSettings.oLanguage,oLanguage,'sInfoFiltered');_fnMap(oSettings.oLanguage,oLanguage,'sInfoPostFix');_fnMap(oSettings.oLanguage,oLanguage,'sSearch');if(typeof oLanguage.oPaginate!='undefined')
{_fnMap(oSettings.oLanguage.oPaginate,oLanguage.oPaginate,'sFirst');_fnMap(oSettings.oLanguage.oPaginate,oLanguage.oPaginate,'sPrevious');_fnMap(oSettings.oLanguage.oPaginate,oLanguage.oPaginate,'sNext');_fnMap(oSettings.oLanguage.oPaginate,oLanguage.oPaginate,'sLast');}
if(typeof oLanguage.sEmptyTable=='undefined'&&typeof oLanguage.sZeroRecords!='undefined')
{_fnMap(oSettings.oLanguage,oLanguage,'sZeroRecords','sEmptyTable');}
if(bInit)
{_fnInitalise(oSettings);}}
function _fnAddColumn(oSettings,nTh)
{oSettings.aoColumns[oSettings.aoColumns.length++]={"sType":null,"_bAutoType":true,"bVisible":true,"bSearchable":true,"bSortable":true,"asSorting":['asc','desc'],"sSortingClass":oSettings.oClasses.sSortable,"sSortingClassJUI":oSettings.oClasses.sSortJUI,"sTitle":nTh?nTh.innerHTML:'',"sName":'',"sWidth":null,"sWidthOrig":null,"sClass":null,"fnRender":null,"bUseRendered":true,"iDataSort":oSettings.aoColumns.length-1,"sSortDataType":'std',"nTh":nTh?nTh:document.createElement('th'),"nTf":null};var iCol=oSettings.aoColumns.length-1;var oCol=oSettings.aoColumns[iCol];if(typeof oSettings.aoPreSearchCols[iCol]=='undefined'||oSettings.aoPreSearchCols[iCol]===null)
{oSettings.aoPreSearchCols[iCol]={"sSearch":"","bRegex":false,"bSmart":true};}
else
{if(typeof oSettings.aoPreSearchCols[iCol].bRegex=='undefined')
{oSettings.aoPreSearchCols[iCol].bRegex=true;}
if(typeof oSettings.aoPreSearchCols[iCol].bSmart=='undefined')
{oSettings.aoPreSearchCols[iCol].bSmart=true;}}
_fnColumnOptions(oSettings,iCol,null);}
function _fnColumnOptions(oSettings,iCol,oOptions)
{var oCol=oSettings.aoColumns[iCol];if(typeof oOptions!='undefined'&&oOptions!==null)
{if(typeof oOptions.sType!='undefined')
{oCol.sType=oOptions.sType;oCol._bAutoType=false;}
_fnMap(oCol,oOptions,"bVisible");_fnMap(oCol,oOptions,"bSearchable");_fnMap(oCol,oOptions,"bSortable");_fnMap(oCol,oOptions,"sTitle");_fnMap(oCol,oOptions,"sName");_fnMap(oCol,oOptions,"sWidth");_fnMap(oCol,oOptions,"sWidth","sWidthOrig");_fnMap(oCol,oOptions,"sClass");_fnMap(oCol,oOptions,"fnRender");_fnMap(oCol,oOptions,"bUseRendered");_fnMap(oCol,oOptions,"iDataSort");_fnMap(oCol,oOptions,"asSorting");_fnMap(oCol,oOptions,"sSortDataType");}
if(!oSettings.oFeatures.bSort)
{oCol.bSortable=false;}
if(!oCol.bSortable||($.inArray('asc',oCol.asSorting)==-1&&$.inArray('desc',oCol.asSorting)==-1))
{oCol.sSortingClass=oSettings.oClasses.sSortableNone;oCol.sSortingClassJUI="";}
else if($.inArray('asc',oCol.asSorting)!=-1&&$.inArray('desc',oCol.asSorting)==-1)
{oCol.sSortingClass=oSettings.oClasses.sSortableAsc;oCol.sSortingClassJUI=oSettings.oClasses.sSortJUIAscAllowed;}
else if($.inArray('asc',oCol.asSorting)==-1&&$.inArray('desc',oCol.asSorting)!=-1)
{oCol.sSortingClass=oSettings.oClasses.sSortableDesc;oCol.sSortingClassJUI=oSettings.oClasses.sSortJUIDescAllowed;}}
function _fnAddData(oSettings,aDataSupplied)
{if(aDataSupplied.length!=oSettings.aoColumns.length&&oSettings.iDrawError!=oSettings.iDraw)
{_fnLog(oSettings,0,"Added data (size "+aDataSupplied.length+") does not match known "+"number of columns ("+oSettings.aoColumns.length+")");oSettings.iDrawError=oSettings.iDraw;return-1;}
var aData=aDataSupplied.slice();var iThisIndex=oSettings.aoData.length;oSettings.aoData.push({"nTr":document.createElement('tr'),"_iId":oSettings.iNextId++,"_aData":aData,"_anHidden":[],"_sRowStripe":''});var nTd,sThisType;for(var i=0;i<aData.length;i++)
{nTd=document.createElement('td');if(aData[i]===null)
{aData[i]='';}
if(typeof oSettings.aoColumns[i].fnRender=='function')
{var sRendered=oSettings.aoColumns[i].fnRender({"iDataRow":iThisIndex,"iDataColumn":i,"aData":aData,"oSettings":oSettings});nTd.innerHTML=sRendered;if(oSettings.aoColumns[i].bUseRendered)
{oSettings.aoData[iThisIndex]._aData[i]=sRendered;}}
else
{nTd.innerHTML=aData[i];}
if(typeof aData[i]!='string')
{aData[i]+="";}
aData[i]=$.trim(aData[i]);if(oSettings.aoColumns[i].sClass!==null)
{nTd.className=oSettings.aoColumns[i].sClass;}
if(oSettings.aoColumns[i]._bAutoType&&oSettings.aoColumns[i].sType!='string')
{sThisType=_fnDetectType(oSettings.aoData[iThisIndex]._aData[i]);if(oSettings.aoColumns[i].sType===null)
{oSettings.aoColumns[i].sType=sThisType;}
else if(oSettings.aoColumns[i].sType!=sThisType)
{oSettings.aoColumns[i].sType='string';}}
if(oSettings.aoColumns[i].bVisible)
{oSettings.aoData[iThisIndex].nTr.appendChild(nTd);oSettings.aoData[iThisIndex]._anHidden[i]=null;}
else
{oSettings.aoData[iThisIndex]._anHidden[i]=nTd;}}
oSettings.aiDisplayMaster.push(iThisIndex);return iThisIndex;}
function _fnGatherData(oSettings)
{var iLoop,i,iLen,j,jLen,jInner,nTds,nTrs,nTd,aLocalData,iThisIndex,iRow,iRows,iColumn,iColumns;if(oSettings.sAjaxSource===null)
{nTrs=oSettings.nTBody.childNodes;for(i=0,iLen=nTrs.length;i<iLen;i++)
{if(nTrs[i].nodeName.toUpperCase()=="TR")
{iThisIndex=oSettings.aoData.length;oSettings.aoData.push({"nTr":nTrs[i],"_iId":oSettings.iNextId++,"_aData":[],"_anHidden":[],"_sRowStripe":''});oSettings.aiDisplayMaster.push(iThisIndex);aLocalData=oSettings.aoData[iThisIndex]._aData;nTds=nTrs[i].childNodes;jInner=0;for(j=0,jLen=nTds.length;j<jLen;j++)
{if(nTds[j].nodeName.toUpperCase()=="TD")
{aLocalData[jInner]=$.trim(nTds[j].innerHTML);jInner++;}}}}}
nTrs=_fnGetTrNodes(oSettings);nTds=[];for(i=0,iLen=nTrs.length;i<iLen;i++)
{for(j=0,jLen=nTrs[i].childNodes.length;j<jLen;j++)
{nTd=nTrs[i].childNodes[j];if(nTd.nodeName.toUpperCase()=="TD")
{nTds.push(nTd);}}}
if(nTds.length!=nTrs.length*oSettings.aoColumns.length)
{_fnLog(oSettings,1,"Unexpected number of TD elements. Expected "+
(nTrs.length*oSettings.aoColumns.length)+" and got "+nTds.length+". DataTables does "+"not support rowspan / colspan in the table body, and there must be one cell for each "+"row/column combination.");}
for(iColumn=0,iColumns=oSettings.aoColumns.length;iColumn<iColumns;iColumn++)
{if(oSettings.aoColumns[iColumn].sTitle===null)
{oSettings.aoColumns[iColumn].sTitle=oSettings.aoColumns[iColumn].nTh.innerHTML;}
var
bAutoType=oSettings.aoColumns[iColumn]._bAutoType,bRender=typeof oSettings.aoColumns[iColumn].fnRender=='function',bClass=oSettings.aoColumns[iColumn].sClass!==null,bVisible=oSettings.aoColumns[iColumn].bVisible,nCell,sThisType,sRendered;if(bAutoType||bRender||bClass||!bVisible)
{for(iRow=0,iRows=oSettings.aoData.length;iRow<iRows;iRow++)
{nCell=nTds[(iRow*iColumns)+iColumn];if(bAutoType)
{if(oSettings.aoColumns[iColumn].sType!='string')
{sThisType=_fnDetectType(oSettings.aoData[iRow]._aData[iColumn]);if(oSettings.aoColumns[iColumn].sType===null)
{oSettings.aoColumns[iColumn].sType=sThisType;}
else if(oSettings.aoColumns[iColumn].sType!=sThisType)
{oSettings.aoColumns[iColumn].sType='string';}}}
if(bRender)
{sRendered=oSettings.aoColumns[iColumn].fnRender({"iDataRow":iRow,"iDataColumn":iColumn,"aData":oSettings.aoData[iRow]._aData,"oSettings":oSettings});nCell.innerHTML=sRendered;if(oSettings.aoColumns[iColumn].bUseRendered)
{oSettings.aoData[iRow]._aData[iColumn]=sRendered;}}
if(bClass)
{nCell.className+=' '+oSettings.aoColumns[iColumn].sClass;}
if(!bVisible)
{oSettings.aoData[iRow]._anHidden[iColumn]=nCell;nCell.parentNode.removeChild(nCell);}
else
{oSettings.aoData[iRow]._anHidden[iColumn]=null;}}}}}
function _fnDrawHead(oSettings)
{var i,nTh,iLen,j,jLen;var iThs=oSettings.nTHead.getElementsByTagName('th').length;var iCorrector=0;if(iThs!==0)
{for(i=0,iLen=oSettings.aoColumns.length;i<iLen;i++)
{nTh=oSettings.aoColumns[i].nTh;if(oSettings.aoColumns[i].bVisible)
{if(oSettings.aoColumns[i].sTitle!=nTh.innerHTML)
{nTh.innerHTML=oSettings.aoColumns[i].sTitle;}}
else
{nTh.parentNode.removeChild(nTh);iCorrector++;}}}
else
{var nTr=document.createElement("tr");for(i=0,iLen=oSettings.aoColumns.length;i<iLen;i++)
{nTh=oSettings.aoColumns[i].nTh;nTh.innerHTML=oSettings.aoColumns[i].sTitle;if(oSettings.aoColumns[i].bVisible)
{if(oSettings.aoColumns[i].sClass!==null)
{nTh.className=oSettings.aoColumns[i].sClass;}
nTr.appendChild(nTh);}}
$(oSettings.nTHead).html('')[0].appendChild(nTr);}
if(oSettings.bJUI)
{for(i=0,iLen=oSettings.aoColumns.length;i<iLen;i++)
{nTh=oSettings.aoColumns[i].nTh;var nDiv=document.createElement('div');nDiv.className=oSettings.oClasses.sSortJUIWrapper;$(nTh).contents().appendTo(nDiv);nDiv.appendChild(document.createElement('span'));nTh.appendChild(nDiv);}}
var fnNoSelect=function(e){this.onselectstart=function(){return false;};return false;};if(oSettings.oFeatures.bSort)
{for(i=0;i<oSettings.aoColumns.length;i++)
{if(oSettings.aoColumns[i].bSortable!==false)
{_fnSortAttachListener(oSettings,oSettings.aoColumns[i].nTh,i);$(oSettings.aoColumns[i].nTh).mousedown(fnNoSelect);}
else
{$(oSettings.aoColumns[i].nTh).addClass(oSettings.oClasses.sSortableNone);}}}
if(oSettings.nTFoot!==null)
{iCorrector=0;var nTfs=oSettings.nTFoot.getElementsByTagName('th');for(i=0,iLen=nTfs.length;i<iLen;i++)
{if(typeof oSettings.aoColumns[i]!='undefined')
{oSettings.aoColumns[i].nTf=nTfs[i-iCorrector];if(oSettings.oClasses.sFooterTH!=="")
{oSettings.aoColumns[i].nTf.className+=" "+oSettings.oClasses.sFooterTH;}
if(!oSettings.aoColumns[i].bVisible)
{nTfs[i-iCorrector].parentNode.removeChild(nTfs[i-iCorrector]);iCorrector++;}}}}}
function _fnDraw(oSettings)
{var i,iLen;var anRows=[];var iRowCount=0;var bRowError=false;var iStrips=oSettings.asStripClasses.length;var iOpenRows=oSettings.aoOpenRows.length;oSettings.bDrawing=true;if(typeof oSettings.iInitDisplayStart!='undefined'&&oSettings.iInitDisplayStart!=-1)
{if(oSettings.oFeatures.bServerSide)
{oSettings._iDisplayStart=oSettings.iInitDisplayStart;}
else
{oSettings._iDisplayStart=(oSettings.iInitDisplayStart>=oSettings.fnRecordsDisplay())?0:oSettings.iInitDisplayStart;}
oSettings.iInitDisplayStart=-1;_fnCalculateEnd(oSettings);}
if(oSettings.oFeatures.bServerSide&&!_fnAjaxUpdate(oSettings))
{return;}
else if(!oSettings.oFeatures.bServerSide)
{oSettings.iDraw++;}
if(oSettings.aiDisplay.length!==0)
{var iStart=oSettings._iDisplayStart;var iEnd=oSettings._iDisplayEnd;if(oSettings.oFeatures.bServerSide)
{iStart=0;iEnd=oSettings.aoData.length;}
for(var j=iStart;j<iEnd;j++)
{var aoData=oSettings.aoData[oSettings.aiDisplay[j]];var nRow=aoData.nTr;if(iStrips!==0)
{var sStrip=oSettings.asStripClasses[iRowCount%iStrips];if(aoData._sRowStripe!=sStrip)
{$(nRow).removeClass(aoData._sRowStripe).addClass(sStrip);aoData._sRowStripe=sStrip;}}
if(typeof oSettings.fnRowCallback=="function")
{nRow=oSettings.fnRowCallback.call(oSettings.oInstance,nRow,oSettings.aoData[oSettings.aiDisplay[j]]._aData,iRowCount,j);if(!nRow&&!bRowError)
{_fnLog(oSettings,0,"A node was not returned by fnRowCallback");bRowError=true;}}
anRows.push(nRow);iRowCount++;if(iOpenRows!==0)
{for(var k=0;k<iOpenRows;k++)
{if(nRow==oSettings.aoOpenRows[k].nParent)
{anRows.push(oSettings.aoOpenRows[k].nTr);}}}}}
else
{anRows[0]=document.createElement('tr');if(typeof oSettings.asStripClasses[0]!='undefined')
{anRows[0].className=oSettings.asStripClasses[0];}
var nTd=document.createElement('td');nTd.setAttribute('valign',"top");nTd.colSpan=_fnVisbleColumns(oSettings);nTd.className=oSettings.oClasses.sRowEmpty;if(typeof oSettings.oLanguage.sEmptyTable!='undefined'&&oSettings.fnRecordsTotal()===0)
{nTd.innerHTML=oSettings.oLanguage.sEmptyTable;}
else
{nTd.innerHTML=oSettings.oLanguage.sZeroRecords.replace('_MAX_',oSettings.fnFormatNumber(oSettings.fnRecordsTotal()));}
anRows[iRowCount].appendChild(nTd);}
if(typeof oSettings.fnHeaderCallback=='function')
{oSettings.fnHeaderCallback.call(oSettings.oInstance,$('>tr',oSettings.nTHead)[0],_fnGetDataMaster(oSettings),oSettings._iDisplayStart,oSettings.fnDisplayEnd(),oSettings.aiDisplay);}
if(typeof oSettings.fnFooterCallback=='function')
{oSettings.fnFooterCallback.call(oSettings.oInstance,$('>tr',oSettings.nTFoot)[0],_fnGetDataMaster(oSettings),oSettings._iDisplayStart,oSettings.fnDisplayEnd(),oSettings.aiDisplay);}
var
nAddFrag=document.createDocumentFragment(),nRemoveFrag=document.createDocumentFragment(),nBodyPar,nTrs;if(oSettings.nTBody)
{nBodyPar=oSettings.nTBody.parentNode;nRemoveFrag.appendChild(oSettings.nTBody);if(!oSettings.oScroll.bInfinite||!oSettings._bInitComplete||oSettings.bSorted||oSettings.bFiltered)
{nTrs=oSettings.nTBody.childNodes;for(i=nTrs.length-1;i>=0;i--)
{nTrs[i].parentNode.removeChild(nTrs[i]);}}
for(i=0,iLen=anRows.length;i<iLen;i++)
{nAddFrag.appendChild(anRows[i]);}
oSettings.nTBody.appendChild(nAddFrag);if(nBodyPar!==null)
{nBodyPar.appendChild(oSettings.nTBody);}}
for(i=0,iLen=oSettings.aoDrawCallback.length;i<iLen;i++)
{oSettings.aoDrawCallback[i].fn.call(oSettings.oInstance,oSettings);}
oSettings.bSorted=false;oSettings.bFiltered=false;oSettings.bDrawing=false;if(typeof oSettings._bInitComplete=="undefined")
{oSettings._bInitComplete=true;if(typeof oSettings.fnInitComplete=='function'&&(oSettings.oFeatures.bServerSide||oSettings.sAjaxSource===null))
{oSettings.fnInitComplete.call(oSettings.oInstance,oSettings);}}}
function _fnReDraw(oSettings)
{if(oSettings.oFeatures.bSort)
{_fnSort(oSettings,oSettings.oPreviousSearch);}
else if(oSettings.oFeatures.bFilter)
{_fnFilterComplete(oSettings,oSettings.oPreviousSearch);}
else
{_fnCalculateEnd(oSettings);_fnDraw(oSettings);}}
function _fnAjaxUpdate(oSettings)
{if(oSettings.bAjaxDataGet)
{_fnProcessingDisplay(oSettings,true);var iColumns=oSettings.aoColumns.length;var aoData=[];var i;oSettings.iDraw++;aoData.push({"name":"sEcho","value":oSettings.iDraw});aoData.push({"name":"iColumns","value":iColumns});aoData.push({"name":"sColumns","value":_fnColumnOrdering(oSettings)});aoData.push({"name":"iDisplayStart","value":oSettings._iDisplayStart});aoData.push({"name":"iDisplayLength","value":oSettings.oFeatures.bPaginate!==false?oSettings._iDisplayLength:-1});var aNames=[];for(i=0;i<iColumns;i++)
{aNames.push(oSettings.aoColumns[i].sName);}
aoData.push({"name":"sNames","value":aNames.join(',')});if(oSettings.oFeatures.bFilter!==false)
{aoData.push({"name":"sSearch","value":oSettings.oPreviousSearch.sSearch});aoData.push({"name":"bRegex","value":oSettings.oPreviousSearch.bRegex});for(i=0;i<iColumns;i++)
{aoData.push({"name":"sSearch_"+i,"value":oSettings.aoPreSearchCols[i].sSearch});aoData.push({"name":"bRegex_"+i,"value":oSettings.aoPreSearchCols[i].bRegex});aoData.push({"name":"bSearchable_"+i,"value":oSettings.aoColumns[i].bSearchable});}}
if(oSettings.oFeatures.bSort!==false)
{var iFixed=oSettings.aaSortingFixed!==null?oSettings.aaSortingFixed.length:0;var iUser=oSettings.aaSorting.length;aoData.push({"name":"iSortingCols","value":iFixed+iUser});for(i=0;i<iFixed;i++)
{aoData.push({"name":"iSortCol_"+i,"value":oSettings.aaSortingFixed[i][0]});aoData.push({"name":"sSortDir_"+i,"value":oSettings.aaSortingFixed[i][1]});}
for(i=0;i<iUser;i++)
{aoData.push({"name":"iSortCol_"+(i+iFixed),"value":oSettings.aaSorting[i][0]});aoData.push({"name":"sSortDir_"+(i+iFixed),"value":oSettings.aaSorting[i][1]});}
for(i=0;i<iColumns;i++)
{aoData.push({"name":"bSortable_"+i,"value":oSettings.aoColumns[i].bSortable});}}
oSettings.fnServerData.call(oSettings.oInstance,oSettings.sAjaxSource,aoData,function(json){_fnAjaxUpdateDraw(oSettings,json);});return false;}
else
{return true;}}
function _fnAjaxUpdateDraw(oSettings,json)
{if(typeof json.sEcho!='undefined')
{if(json.sEcho*1<oSettings.iDraw)
{return;}
else
{oSettings.iDraw=json.sEcho*1;}}
if(!oSettings.oScroll.bInfinite||(oSettings.oScroll.bInfinite&&(oSettings.bSorted||oSettings.bFiltered)))
{_fnClearTable(oSettings);}
oSettings._iRecordsTotal=json.iTotalRecords;oSettings._iRecordsDisplay=json.iTotalDisplayRecords;var sOrdering=_fnColumnOrdering(oSettings);var bReOrder=(typeof json.sColumns!='undefined'&&sOrdering!==""&&json.sColumns!=sOrdering);if(bReOrder)
{var aiIndex=_fnReOrderIndex(oSettings,json.sColumns);}
for(var i=0,iLen=json.aaData.length;i<iLen;i++)
{if(bReOrder)
{var aData=[];for(var j=0,jLen=oSettings.aoColumns.length;j<jLen;j++)
{aData.push(json.aaData[i][aiIndex[j]]);}
_fnAddData(oSettings,aData);}
else
{_fnAddData(oSettings,json.aaData[i]);}}
oSettings.aiDisplay=oSettings.aiDisplayMaster.slice();oSettings.bAjaxDataGet=false;_fnDraw(oSettings);oSettings.bAjaxDataGet=true;_fnProcessingDisplay(oSettings,false);}
function _fnAddOptionsHtml(oSettings)
{var nHolding=document.createElement('div');oSettings.nTable.parentNode.insertBefore(nHolding,oSettings.nTable);oSettings.nTableWrapper=document.createElement('div');oSettings.nTableWrapper.className=oSettings.oClasses.sWrapper;if(oSettings.sTableId!=='')
{oSettings.nTableWrapper.setAttribute('id',oSettings.sTableId+'_wrapper');}
var nInsertNode=oSettings.nTableWrapper;var aDom=oSettings.sDom.split('');var nTmp,iPushFeature,cOption,nNewNode,cNext,sAttr,j;for(var i=0;i<aDom.length;i++)
{iPushFeature=0;cOption=aDom[i];if(cOption=='<')
{nNewNode=document.createElement('div');cNext=aDom[i+1];if(cNext=="'"||cNext=='"')
{sAttr="";j=2;while(aDom[i+j]!=cNext)
{sAttr+=aDom[i+j];j++;}
if(sAttr=="H")
{sAttr="fg-toolbar ui-toolbar ui-widget-header ui-corner-tl ui-corner-tr ui-helper-clearfix";}
else if(sAttr=="F")
{sAttr="fg-toolbar ui-toolbar ui-widget-header ui-corner-bl ui-corner-br ui-helper-clearfix";}
if(sAttr.indexOf('.')!=-1)
{var aSplit=sAttr.split('.');nNewNode.setAttribute('id',aSplit[0].substr(1,aSplit[0].length-1));nNewNode.className=aSplit[1];}
else if(sAttr.charAt(0)=="#")
{nNewNode.setAttribute('id',sAttr.substr(1,sAttr.length-1));}
else
{nNewNode.className=sAttr;}
i+=j;}
nInsertNode.appendChild(nNewNode);nInsertNode=nNewNode;}
else if(cOption=='>')
{nInsertNode=nInsertNode.parentNode;}
else if(cOption=='l'&&oSettings.oFeatures.bPaginate&&oSettings.oFeatures.bLengthChange)
{nTmp=_fnFeatureHtmlLength(oSettings);iPushFeature=1;}
else if(cOption=='f'&&oSettings.oFeatures.bFilter)
{nTmp=_fnFeatureHtmlFilter(oSettings);iPushFeature=1;}
else if(cOption=='r'&&oSettings.oFeatures.bProcessing)
{nTmp=_fnFeatureHtmlProcessing(oSettings);iPushFeature=1;}
else if(cOption=='t')
{nTmp=_fnFeatureHtmlTable(oSettings);iPushFeature=1;}
else if(cOption=='i'&&oSettings.oFeatures.bInfo)
{nTmp=_fnFeatureHtmlInfo(oSettings);iPushFeature=1;}
else if(cOption=='p'&&oSettings.oFeatures.bPaginate)
{nTmp=_fnFeatureHtmlPaginate(oSettings);iPushFeature=1;}
else if(_oExt.aoFeatures.length!==0)
{var aoFeatures=_oExt.aoFeatures;for(var k=0,kLen=aoFeatures.length;k<kLen;k++)
{if(cOption==aoFeatures[k].cFeature)
{nTmp=aoFeatures[k].fnInit(oSettings);if(nTmp)
{iPushFeature=1;}
break;}}}
if(iPushFeature==1&&nTmp!==null)
{if(typeof oSettings.aanFeatures[cOption]!='object')
{oSettings.aanFeatures[cOption]=[];}
oSettings.aanFeatures[cOption].push(nTmp);nInsertNode.appendChild(nTmp);}}
nHolding.parentNode.replaceChild(oSettings.nTableWrapper,nHolding);}
function _fnFeatureHtmlTable(oSettings)
{if(oSettings.oScroll.sX===""&&oSettings.oScroll.sY==="")
{return oSettings.nTable;}
var
nScroller=document.createElement('div'),nScrollHead=document.createElement('div'),nScrollHeadInner=document.createElement('div'),nScrollBody=document.createElement('div'),nScrollFoot=document.createElement('div'),nScrollFootInner=document.createElement('div'),nScrollHeadTable=oSettings.nTable.cloneNode(false),nScrollFootTable=oSettings.nTable.cloneNode(false),nThead=oSettings.nTable.getElementsByTagName('thead')[0],nTfoot=oSettings.nTable.getElementsByTagName('tfoot').length===0?null:oSettings.nTable.getElementsByTagName('tfoot')[0],oClasses=(typeof oInit.bJQueryUI!='undefined'&&oInit.bJQueryUI)?_oExt.oJUIClasses:_oExt.oStdClasses;nScrollHead.appendChild(nScrollHeadInner);nScrollFoot.appendChild(nScrollFootInner);nScrollBody.appendChild(oSettings.nTable);nScroller.appendChild(nScrollHead);nScroller.appendChild(nScrollBody);nScrollHeadInner.appendChild(nScrollHeadTable);nScrollHeadTable.appendChild(nThead);if(nTfoot!==null)
{nScroller.appendChild(nScrollFoot);nScrollFootInner.appendChild(nScrollFootTable);nScrollFootTable.appendChild(nTfoot);}
nScroller.className=oClasses.sScrollWrapper;nScrollHead.className=oClasses.sScrollHead;nScrollHeadInner.className=oClasses.sScrollHeadInner;nScrollBody.className=oClasses.sScrollBody;nScrollFoot.className=oClasses.sScrollFoot;nScrollFootInner.className=oClasses.sScrollFootInner;nScrollHead.style.overflow="hidden";nScrollHead.style.position="relative";nScrollFoot.style.overflow="hidden";nScrollBody.style.overflow="auto";nScrollHead.style.border="0";nScrollFoot.style.border="0";nScrollHeadInner.style.width="150%";nScrollHeadTable.removeAttribute('id');nScrollHeadTable.style.marginLeft="0";oSettings.nTable.style.marginLeft="0";if(nTfoot!==null)
{nScrollFootTable.removeAttribute('id');nScrollFootTable.style.marginLeft="0";}
var nCaptions=$('>caption',oSettings.nTable);for(var i=0,iLen=nCaptions.length;i<iLen;i++)
{nScrollHeadTable.appendChild(nCaptions[i]);}
if(oSettings.oScroll.sX!=="")
{nScrollHead.style.width=_fnStringToCss(oSettings.oScroll.sX);nScrollBody.style.width=_fnStringToCss(oSettings.oScroll.sX);if(nTfoot!==null)
{nScrollFoot.style.width=_fnStringToCss(oSettings.oScroll.sX);}
$(nScrollBody).scroll(function(e){nScrollHead.scrollLeft=this.scrollLeft;if(nTfoot!==null)
{nScrollFoot.scrollLeft=this.scrollLeft;}});}
if(oSettings.oScroll.sY!=="")
{nScrollBody.style.height=_fnStringToCss(oSettings.oScroll.sY);}
oSettings.aoDrawCallback.push({"fn":_fnScrollDraw,"sName":"scrolling"});if(oSettings.oScroll.bInfinite)
{$(nScrollBody).scroll(function(){if(!oSettings.bDrawing)
{if($(this).scrollTop()+$(this).height()>$(oSettings.nTable).height()-oSettings.oScroll.iLoadGap)
{if(oSettings.fnDisplayEnd()<oSettings.fnRecordsDisplay())
{_fnPageChange(oSettings,'next');_fnCalculateEnd(oSettings);_fnDraw(oSettings);}}}});}
oSettings.nScrollHead=nScrollHead;oSettings.nScrollFoot=nScrollFoot;return nScroller;}
function _fnScrollDraw(o)
{var
nScrollHeadInner=o.nScrollHead.getElementsByTagName('div')[0],nScrollHeadTable=nScrollHeadInner.getElementsByTagName('table')[0],nScrollBody=o.nTable.parentNode,i,iLen,j,jLen,anHeadToSize,anHeadSizers,anFootSizers,anFootToSize,oStyle,iVis,iWidth,aApplied=[],iSanityWidth;var nTheadSize=o.nTable.getElementsByTagName('thead');if(nTheadSize.length>0)
{o.nTable.removeChild(nTheadSize[0]);}
if(o.nTFoot!==null)
{var nTfootSize=o.nTable.getElementsByTagName('tfoot');if(nTfootSize.length>0)
{o.nTable.removeChild(nTfootSize[0]);}}
nTheadSize=o.nTHead.cloneNode(true);o.nTable.insertBefore(nTheadSize,o.nTable.childNodes[0]);if(o.nTFoot!==null)
{nTfootSize=o.nTFoot.cloneNode(true);o.nTable.insertBefore(nTfootSize,o.nTable.childNodes[1]);}
var nThs=_fnGetUniqueThs(nTheadSize);for(i=0,iLen=nThs.length;i<iLen;i++)
{iVis=_fnVisibleToColumnIndex(o,i);nThs[i].style.width=o.aoColumns[iVis].sWidth;}
if(o.nTFoot!==null)
{_fnApplyToChildren(function(n){n.style.width="";},nTfootSize.getElementsByTagName('tr'));}
iSanityWidth=$(o.nTable).outerWidth();if(o.oScroll.sX==="")
{o.nTable.style.width="100%";if($.browser.msie&&$.browser.version<=7)
{o.nTable.style.width=_fnStringToCss($(o.nTable).outerWidth()-o.oScroll.iBarWidth);}}
else
{if(o.oScroll.sXInner!=="")
{o.nTable.style.width=_fnStringToCss(o.oScroll.sXInner);}
else if(iSanityWidth==$(nScrollBody).width()&&$(nScrollBody).height()<$(o.nTable).height())
{o.nTable.style.width=_fnStringToCss(iSanityWidth-o.oScroll.iBarWidth);if($(o.nTable).outerWidth()>iSanityWidth-o.oScroll.iBarWidth)
{o.nTable.style.width=_fnStringToCss(iSanityWidth);}}
else
{o.nTable.style.width=_fnStringToCss(iSanityWidth);}}
iSanityWidth=$(o.nTable).outerWidth();anHeadToSize=o.nTHead.getElementsByTagName('tr');anHeadSizers=nTheadSize.getElementsByTagName('tr');_fnApplyToChildren(function(nSizer,nToSize){oStyle=nSizer.style;oStyle.paddingTop="0";oStyle.paddingBottom="0";oStyle.borderTopWidth="0";oStyle.borderBottomWidth="0";oStyle.height=0;iWidth=$(nSizer).width();nToSize.style.width=_fnStringToCss(iWidth);aApplied.push(iWidth);},anHeadSizers,anHeadToSize);$(anHeadSizers).height(0);if(o.nTFoot!==null)
{anFootSizers=nTfootSize.getElementsByTagName('tr');anFootToSize=o.nTFoot.getElementsByTagName('tr');_fnApplyToChildren(function(nSizer,nToSize){oStyle=nSizer.style;oStyle.paddingTop="0";oStyle.paddingBottom="0";oStyle.borderTopWidth="0";oStyle.borderBottomWidth="0";iWidth=$(nSizer).width();nToSize.style.width=_fnStringToCss(iWidth);aApplied.push(iWidth);},anFootSizers,anFootToSize);$(anFootSizers).height(0);}
_fnApplyToChildren(function(nSizer){nSizer.innerHTML="";nSizer.style.width=_fnStringToCss(aApplied.shift());},anHeadSizers);if(o.nTFoot!==null)
{_fnApplyToChildren(function(nSizer){nSizer.innerHTML="";nSizer.style.width=_fnStringToCss(aApplied.shift());},anFootSizers);}
if($(o.nTable).outerWidth()<iSanityWidth)
{if(o.oScroll.sX==="")
{_fnLog(o,1,"The table cannot fit into the current element which will cause column"+" misalignment. It is suggested that you enable x-scrolling or increase the width"+" the table has in which to be drawn");}
else if(o.oScroll.sXInner!=="")
{_fnLog(o,1,"The table cannot fit into the current element which will cause column"+" misalignment. It is suggested that you increase the sScrollXInner property to"+" allow it to draw in a larger area, or simply remove that parameter to allow"+" automatic calculation");}}
if(o.oScroll.sY==="")
{if($.browser.msie&&$.browser.version<=7)
{nScrollBody.style.height=_fnStringToCss(o.nTable.offsetHeight+o.oScroll.iBarWidth);}}
if(o.oScroll.sY!==""&&o.oScroll.bCollapse)
{nScrollBody.style.height=_fnStringToCss(o.oScroll.sY);var iExtra=(o.oScroll.sX!==""&&o.nTable.offsetWidth>nScrollBody.offsetWidth)?o.oScroll.iBarWidth:0;if(o.nTable.offsetHeight<nScrollBody.offsetHeight)
{nScrollBody.style.height=_fnStringToCss($(o.nTable).height()+iExtra);}}
var iOuterWidth=$(o.nTable).outerWidth();nScrollHeadTable.style.width=_fnStringToCss(iOuterWidth);nScrollHeadInner.style.width=_fnStringToCss(iOuterWidth+o.oScroll.iBarWidth);nScrollHeadInner.parentNode.style.width=_fnStringToCss($(nScrollBody).width());if(o.nTFoot!==null)
{var
nScrollFootInner=o.nScrollFoot.getElementsByTagName('div')[0],nScrollFootTable=nScrollFootInner.getElementsByTagName('table')[0];nScrollFootInner.style.width=_fnStringToCss(o.nTable.offsetWidth+o.oScroll.iBarWidth);nScrollFootTable.style.width=_fnStringToCss(o.nTable.offsetWidth);}
if(o.bSorted||o.bFiltered)
{nScrollBody.scrollTop=0;}}
function _fnAjustColumnSizing(oSettings)
{if(oSettings.oFeatures.bAutoWidth===false)
{return false;}
_fnCalculateColumnWidths(oSettings);for(var i=0,iLen=oSettings.aoColumns.length;i<iLen;i++)
{oSettings.aoColumns[i].nTh.style.width=oSettings.aoColumns[i].sWidth;}}
function _fnFeatureHtmlFilter(oSettings)
{var nFilter=document.createElement('div');if(oSettings.sTableId!==''&&typeof oSettings.aanFeatures.f=="undefined")
{nFilter.setAttribute('id',oSettings.sTableId+'_filter');}
nFilter.className=oSettings.oClasses.sFilter;var sSpace=oSettings.oLanguage.sSearch===""?"":" ";nFilter.innerHTML=oSettings.oLanguage.sSearch+sSpace+'<input type="text" />';var jqFilter=$("input",nFilter);jqFilter.val(oSettings.oPreviousSearch.sSearch.replace('"','&quot;'));jqFilter.keyup(function(e){var n=oSettings.aanFeatures.f;for(var i=0,iLen=n.length;i<iLen;i++)
{if(n[i]!=this.parentNode)
{$('input',n[i]).val(this.value);}}
if(this.value!=oSettings.oPreviousSearch.sSearch)
{_fnFilterComplete(oSettings,{"sSearch":this.value,"bRegex":oSettings.oPreviousSearch.bRegex,"bSmart":oSettings.oPreviousSearch.bSmart});}});jqFilter.keypress(function(e){if(e.keyCode==13)
{return false;}});return nFilter;}
function _fnFilterComplete(oSettings,oInput,iForce)
{_fnFilter(oSettings,oInput.sSearch,iForce,oInput.bRegex,oInput.bSmart);for(var i=0;i<oSettings.aoPreSearchCols.length;i++)
{_fnFilterColumn(oSettings,oSettings.aoPreSearchCols[i].sSearch,i,oSettings.aoPreSearchCols[i].bRegex,oSettings.aoPreSearchCols[i].bSmart);}
if(_oExt.afnFiltering.length!==0)
{_fnFilterCustom(oSettings);}
oSettings.bFiltered=true;oSettings._iDisplayStart=0;_fnCalculateEnd(oSettings);_fnDraw(oSettings);_fnBuildSearchArray(oSettings,0);}
function _fnFilterCustom(oSettings)
{var afnFilters=_oExt.afnFiltering;for(var i=0,iLen=afnFilters.length;i<iLen;i++)
{var iCorrector=0;for(var j=0,jLen=oSettings.aiDisplay.length;j<jLen;j++)
{var iDisIndex=oSettings.aiDisplay[j-iCorrector];if(!afnFilters[i](oSettings,oSettings.aoData[iDisIndex]._aData,iDisIndex))
{oSettings.aiDisplay.splice(j-iCorrector,1);iCorrector++;}}}}
function _fnFilterColumn(oSettings,sInput,iColumn,bRegex,bSmart)
{if(sInput==="")
{return;}
var iIndexCorrector=0;var rpSearch=_fnFilterCreateSearch(sInput,bRegex,bSmart);for(var i=oSettings.aiDisplay.length-1;i>=0;i--)
{var sData=_fnDataToSearch(oSettings.aoData[oSettings.aiDisplay[i]]._aData[iColumn],oSettings.aoColumns[iColumn].sType);if(!rpSearch.test(sData))
{oSettings.aiDisplay.splice(i,1);iIndexCorrector++;}}}
function _fnFilter(oSettings,sInput,iForce,bRegex,bSmart)
{var i;var rpSearch=_fnFilterCreateSearch(sInput,bRegex,bSmart);if(typeof iForce=='undefined'||iForce===null)
{iForce=0;}
if(_oExt.afnFiltering.length!==0)
{iForce=1;}
if(sInput.length<=0)
{oSettings.aiDisplay.splice(0,oSettings.aiDisplay.length);oSettings.aiDisplay=oSettings.aiDisplayMaster.slice();}
else
{if(oSettings.aiDisplay.length==oSettings.aiDisplayMaster.length||oSettings.oPreviousSearch.sSearch.length>sInput.length||iForce==1||sInput.indexOf(oSettings.oPreviousSearch.sSearch)!==0)
{oSettings.aiDisplay.splice(0,oSettings.aiDisplay.length);_fnBuildSearchArray(oSettings,1);for(i=0;i<oSettings.aiDisplayMaster.length;i++)
{if(rpSearch.test(oSettings.asDataSearch[i]))
{oSettings.aiDisplay.push(oSettings.aiDisplayMaster[i]);}}}
else
{var iIndexCorrector=0;for(i=0;i<oSettings.asDataSearch.length;i++)
{if(!rpSearch.test(oSettings.asDataSearch[i]))
{oSettings.aiDisplay.splice(i-iIndexCorrector,1);iIndexCorrector++;}}}}
oSettings.oPreviousSearch.sSearch=sInput;oSettings.oPreviousSearch.bRegex=bRegex;oSettings.oPreviousSearch.bSmart=bSmart;}
function _fnBuildSearchArray(oSettings,iMaster)
{oSettings.asDataSearch.splice(0,oSettings.asDataSearch.length);var aArray=(typeof iMaster!='undefined'&&iMaster==1)?oSettings.aiDisplayMaster:oSettings.aiDisplay;for(var i=0,iLen=aArray.length;i<iLen;i++)
{oSettings.asDataSearch[i]=_fnBuildSearchRow(oSettings,oSettings.aoData[aArray[i]]._aData);}}
function _fnBuildSearchRow(oSettings,aData)
{var sSearch='';var nTmp=document.createElement('div');for(var j=0,jLen=oSettings.aoColumns.length;j<jLen;j++)
{if(oSettings.aoColumns[j].bSearchable)
{var sData=aData[j];sSearch+=_fnDataToSearch(sData,oSettings.aoColumns[j].sType)+'  ';}}
if(sSearch.indexOf('&')!==-1)
{nTmp.innerHTML=sSearch;sSearch=nTmp.textContent?nTmp.textContent:nTmp.innerText;sSearch=sSearch.replace(/\n/g," ").replace(/\r/g,"");}
return sSearch;}
function _fnFilterCreateSearch(sSearch,bRegex,bSmart)
{var asSearch,sRegExpString;if(bSmart)
{asSearch=bRegex?sSearch.split(' '):_fnEscapeRegex(sSearch).split(' ');sRegExpString='^(?=.*?'+asSearch.join(')(?=.*?')+').*$';return new RegExp(sRegExpString,"i");}
else
{sSearch=bRegex?sSearch:_fnEscapeRegex(sSearch);return new RegExp(sSearch,"i");}}
function _fnDataToSearch(sData,sType)
{if(typeof _oExt.ofnSearch[sType]=="function")
{return _oExt.ofnSearch[sType](sData);}
else if(sType=="html")
{return sData.replace(/\n/g," ").replace(/<.*?>/g,"");}
else if(typeof sData=="string")
{return sData.replace(/\n/g," ");}
return sData;}
function _fnSort(oSettings,bApplyClasses)
{var aaSort=[];var oSort=_oExt.oSort;var aoData=oSettings.aoData;var iDataSort;var iDataType;var i,j,jLen;if(!oSettings.oFeatures.bServerSide&&(oSettings.aaSorting.length!==0||oSettings.aaSortingFixed!==null))
{if(oSettings.aaSortingFixed!==null)
{aaSort=oSettings.aaSortingFixed.concat(oSettings.aaSorting);}
else
{aaSort=oSettings.aaSorting.slice();}
for(i=0;i<aaSort.length;i++)
{var iColumn=aaSort[i][0];var iVisColumn=_fnColumnIndexToVisible(oSettings,iColumn);var sDataType=oSettings.aoColumns[iColumn].sSortDataType;if(typeof _oExt.afnSortData[sDataType]!='undefined')
{var aData=_oExt.afnSortData[sDataType](oSettings,iColumn,iVisColumn);for(j=0,jLen=aoData.length;j<jLen;j++)
{aoData[j]._aData[iColumn]=aData[j];}}}
if(!window.runtime)
{this.ClosureDataTables={"fn":function(){},"data":aoData,"sort":_oExt.oSort,"master":oSettings.aiDisplayMaster.slice()};var sDynamicSort="this.ClosureDataTables.fn = function(a,b){"+"var iTest, oSort=this.ClosureDataTables.sort, "+"aoData=this.ClosureDataTables.data, "+"aiOrig=this.ClosureDataTables.master;";for(i=0;i<aaSort.length-1;i++)
{iDataSort=oSettings.aoColumns[aaSort[i][0]].iDataSort;iDataType=oSettings.aoColumns[iDataSort].sType;sDynamicSort+="iTest = oSort['"+iDataType+"-"+aaSort[i][1]+"']"+"( aoData[a]._aData["+iDataSort+"], aoData[b]._aData["+iDataSort+"] ); if ( iTest === 0 )";}
if(aaSort.length>0)
{iDataSort=oSettings.aoColumns[aaSort[aaSort.length-1][0]].iDataSort;iDataType=oSettings.aoColumns[iDataSort].sType;sDynamicSort+="iTest = oSort['"+iDataType+"-"+aaSort[aaSort.length-1][1]+"']"+"( aoData[a]._aData["+iDataSort+"], aoData[b]._aData["+iDataSort+"] );"+"if (iTest===0) "+"return oSort['numeric-asc'](jQuery.inArray(a,aiOrig), jQuery.inArray(b,aiOrig)); "+"return iTest;}";eval(sDynamicSort);oSettings.aiDisplayMaster.sort(this.ClosureDataTables.fn);}
this.ClosureDataTables=undefined;}
else
{var aAirSort=[];var iLen=aaSort.length;for(i=0;i<iLen;i++)
{iDataSort=oSettings.aoColumns[aaSort[i][0]].iDataSort;aAirSort.push([iDataSort,oSettings.aoColumns[iDataSort].sType+'-'+aaSort[i][1]]);}
oSettings.aiDisplayMaster.sort(function(a,b){var iTest;for(var i=0;i<iLen;i++)
{iTest=oSort[aAirSort[i][1]](aoData[a]._aData[aAirSort[i][0]],aoData[b]._aData[aAirSort[i][0]]);if(iTest!==0)
{return iTest;}}
return 0;});}}
if(typeof bApplyClasses=='undefined'||bApplyClasses)
{_fnSortingClasses(oSettings);}
oSettings.bSorted=true;if(oSettings.oFeatures.bFilter)
{_fnFilterComplete(oSettings,oSettings.oPreviousSearch,1);}
else
{oSettings.aiDisplay=oSettings.aiDisplayMaster.slice();oSettings._iDisplayStart=0;_fnCalculateEnd(oSettings);_fnDraw(oSettings);}}
function _fnSortAttachListener(oSettings,nNode,iDataIndex,fnCallback)
{$(nNode).click(function(e){if(oSettings.aoColumns[iDataIndex].bSortable===false)
{return;}
var fnInnerSorting=function(){var iColumn,iNextSort;if(e.shiftKey)
{var bFound=false;for(var i=0;i<oSettings.aaSorting.length;i++)
{if(oSettings.aaSorting[i][0]==iDataIndex)
{bFound=true;iColumn=oSettings.aaSorting[i][0];iNextSort=oSettings.aaSorting[i][2]+1;if(typeof oSettings.aoColumns[iColumn].asSorting[iNextSort]=='undefined')
{oSettings.aaSorting.splice(i,1);}
else
{oSettings.aaSorting[i][1]=oSettings.aoColumns[iColumn].asSorting[iNextSort];oSettings.aaSorting[i][2]=iNextSort;}
break;}}
if(bFound===false)
{oSettings.aaSorting.push([iDataIndex,oSettings.aoColumns[iDataIndex].asSorting[0],0]);}}
else
{if(oSettings.aaSorting.length==1&&oSettings.aaSorting[0][0]==iDataIndex)
{iColumn=oSettings.aaSorting[0][0];iNextSort=oSettings.aaSorting[0][2]+1;if(typeof oSettings.aoColumns[iColumn].asSorting[iNextSort]=='undefined')
{iNextSort=0;}
oSettings.aaSorting[0][1]=oSettings.aoColumns[iColumn].asSorting[iNextSort];oSettings.aaSorting[0][2]=iNextSort;}
else
{oSettings.aaSorting.splice(0,oSettings.aaSorting.length);oSettings.aaSorting.push([iDataIndex,oSettings.aoColumns[iDataIndex].asSorting[0],0]);}}
_fnSort(oSettings);};if(!oSettings.oFeatures.bProcessing)
{fnInnerSorting();}
else
{_fnProcessingDisplay(oSettings,true);setTimeout(function(){fnInnerSorting();if(!oSettings.oFeatures.bServerSide)
{_fnProcessingDisplay(oSettings,false);}},0);}
if(typeof fnCallback=='function')
{fnCallback(oSettings);}});}
function _fnSortingClasses(oSettings)
{var i,iLen,j,jLen,iFound;var aaSort,sClass;var iColumns=oSettings.aoColumns.length;var oClasses=oSettings.oClasses;for(i=0;i<iColumns;i++)
{if(oSettings.aoColumns[i].bSortable)
{$(oSettings.aoColumns[i].nTh).removeClass(oClasses.sSortAsc+" "+oClasses.sSortDesc+" "+oSettings.aoColumns[i].sSortingClass);}}
if(oSettings.aaSortingFixed!==null)
{aaSort=oSettings.aaSortingFixed.concat(oSettings.aaSorting);}
else
{aaSort=oSettings.aaSorting.slice();}
for(i=0;i<oSettings.aoColumns.length;i++)
{if(oSettings.aoColumns[i].bSortable)
{sClass=oSettings.aoColumns[i].sSortingClass;iFound=-1;for(j=0;j<aaSort.length;j++)
{if(aaSort[j][0]==i)
{sClass=(aaSort[j][1]=="asc")?oClasses.sSortAsc:oClasses.sSortDesc;iFound=j;break;}}
$(oSettings.aoColumns[i].nTh).addClass(sClass);if(oSettings.bJUI)
{var jqSpan=$("span",oSettings.aoColumns[i].nTh);jqSpan.removeClass(oClasses.sSortJUIAsc+" "+oClasses.sSortJUIDesc+" "+
oClasses.sSortJUI+" "+oClasses.sSortJUIAscAllowed+" "+oClasses.sSortJUIDescAllowed);var sSpanClass;if(iFound==-1)
{sSpanClass=oSettings.aoColumns[i].sSortingClassJUI;}
else if(aaSort[iFound][1]=="asc")
{sSpanClass=oClasses.sSortJUIAsc;}
else
{sSpanClass=oClasses.sSortJUIDesc;}
jqSpan.addClass(sSpanClass);}}
else
{$(oSettings.aoColumns[i].nTh).addClass(oSettings.aoColumns[i].sSortingClass);}}
sClass=oClasses.sSortColumn;if(oSettings.oFeatures.bSort&&oSettings.oFeatures.bSortClasses)
{var nTds=_fnGetTdNodes(oSettings);if(nTds.length>=iColumns)
{for(i=0;i<iColumns;i++)
{if(nTds[i].className.indexOf(sClass+"1")!=-1)
{for(j=0,jLen=(nTds.length/iColumns);j<jLen;j++)
{nTds[(iColumns*j)+i].className=$.trim(nTds[(iColumns*j)+i].className.replace(sClass+"1",""));}}
else if(nTds[i].className.indexOf(sClass+"2")!=-1)
{for(j=0,jLen=(nTds.length/iColumns);j<jLen;j++)
{nTds[(iColumns*j)+i].className=$.trim(nTds[(iColumns*j)+i].className.replace(sClass+"2",""));}}
else if(nTds[i].className.indexOf(sClass+"3")!=-1)
{for(j=0,jLen=(nTds.length/iColumns);j<jLen;j++)
{nTds[(iColumns*j)+i].className=$.trim(nTds[(iColumns*j)+i].className.replace(" "+sClass+"3",""));}}}}
var iClass=1,iTargetCol;for(i=0;i<aaSort.length;i++)
{iTargetCol=parseInt(aaSort[i][0],10);for(j=0,jLen=(nTds.length/iColumns);j<jLen;j++)
{nTds[(iColumns*j)+iTargetCol].className+=" "+sClass+iClass;}
if(iClass<3)
{iClass++;}}}}
function _fnFeatureHtmlPaginate(oSettings)
{if(oSettings.oScroll.bInfinite)
{return null;}
var nPaginate=document.createElement('div');nPaginate.className=oSettings.oClasses.sPaging+oSettings.sPaginationType;_oExt.oPagination[oSettings.sPaginationType].fnInit(oSettings,nPaginate,function(oSettings){_fnCalculateEnd(oSettings);_fnDraw(oSettings);});if(typeof oSettings.aanFeatures.p=="undefined")
{oSettings.aoDrawCallback.push({"fn":function(oSettings){_oExt.oPagination[oSettings.sPaginationType].fnUpdate(oSettings,function(oSettings){_fnCalculateEnd(oSettings);_fnDraw(oSettings);});},"sName":"pagination"});}
return nPaginate;}
function _fnPageChange(oSettings,sAction)
{var iOldStart=oSettings._iDisplayStart;if(sAction=="first")
{oSettings._iDisplayStart=0;}
else if(sAction=="previous")
{oSettings._iDisplayStart=oSettings._iDisplayLength>=0?oSettings._iDisplayStart-oSettings._iDisplayLength:0;if(oSettings._iDisplayStart<0)
{oSettings._iDisplayStart=0;}}
else if(sAction=="next")
{if(oSettings._iDisplayLength>=0)
{if(oSettings._iDisplayStart+oSettings._iDisplayLength<oSettings.fnRecordsDisplay())
{oSettings._iDisplayStart+=oSettings._iDisplayLength;}}
else
{oSettings._iDisplayStart=0;}}
else if(sAction=="last")
{if(oSettings._iDisplayLength>=0)
{var iPages=parseInt((oSettings.fnRecordsDisplay()-1)/oSettings._iDisplayLength,10)+1;oSettings._iDisplayStart=(iPages-1)*oSettings._iDisplayLength;}
else
{oSettings._iDisplayStart=0;}}
else
{_fnLog(oSettings,0,"Unknown paging action: "+sAction);}
return iOldStart!=oSettings._iDisplayStart;}
function _fnFeatureHtmlInfo(oSettings)
{var nInfo=document.createElement('div');nInfo.className=oSettings.oClasses.sInfo;if(typeof oSettings.aanFeatures.i=="undefined")
{oSettings.aoDrawCallback.push({"fn":_fnUpdateInfo,"sName":"information"});if(oSettings.sTableId!=='')
{nInfo.setAttribute('id',oSettings.sTableId+'_info');}}
return nInfo;}
function _fnUpdateInfo(oSettings)
{if(!oSettings.oFeatures.bInfo||oSettings.aanFeatures.i.length===0)
{return;}
var
iStart=oSettings._iDisplayStart+1,iEnd=oSettings.fnDisplayEnd(),iMax=oSettings.fnRecordsTotal(),iTotal=oSettings.fnRecordsDisplay(),sStart=oSettings.fnFormatNumber(iStart),sEnd=oSettings.fnFormatNumber(iEnd),sMax=oSettings.fnFormatNumber(iMax),sTotal=oSettings.fnFormatNumber(iTotal),sOut;if(oSettings.oScroll.bInfinite)
{sStart=oSettings.fnFormatNumber(1);}
if(oSettings.fnRecordsDisplay()===0&&oSettings.fnRecordsDisplay()==oSettings.fnRecordsTotal())
{sOut=oSettings.oLanguage.sInfoEmpty+oSettings.oLanguage.sInfoPostFix;}
else if(oSettings.fnRecordsDisplay()===0)
{sOut=oSettings.oLanguage.sInfoEmpty+' '+
oSettings.oLanguage.sInfoFiltered.replace('_MAX_',sMax)+
oSettings.oLanguage.sInfoPostFix;}
else if(oSettings.fnRecordsDisplay()==oSettings.fnRecordsTotal())
{sOut=oSettings.oLanguage.sInfo.replace('_START_',sStart).replace('_END_',sEnd).replace('_TOTAL_',sTotal)+
oSettings.oLanguage.sInfoPostFix;}
else
{sOut=oSettings.oLanguage.sInfo.replace('_START_',sStart).replace('_END_',sEnd).replace('_TOTAL_',sTotal)+' '+
oSettings.oLanguage.sInfoFiltered.replace('_MAX_',oSettings.fnFormatNumber(oSettings.fnRecordsTotal()))+
oSettings.oLanguage.sInfoPostFix;}
if(oSettings.oLanguage.fnInfoCallback!==null)
{sOut=oSettings.oLanguage.fnInfoCallback(oSettings,iStart,iEnd,iMax,iTotal,sOut);}
var n=oSettings.aanFeatures.i;for(var i=0,iLen=n.length;i<iLen;i++)
{$(n[i]).html(sOut);}}
function _fnFeatureHtmlLength(oSettings)
{if(oSettings.oScroll.bInfinite)
{return null;}
var sName=(oSettings.sTableId==="")?"":'name="'+oSettings.sTableId+'_length"';var sStdMenu='<select size="1" '+sName+'>';var i,iLen;if(oSettings.aLengthMenu.length==2&&typeof oSettings.aLengthMenu[0]=='object'&&typeof oSettings.aLengthMenu[1]=='object')
{for(i=0,iLen=oSettings.aLengthMenu[0].length;i<iLen;i++)
{sStdMenu+='<option value="'+oSettings.aLengthMenu[0][i]+'">'+
oSettings.aLengthMenu[1][i]+'</option>';}}
else
{for(i=0,iLen=oSettings.aLengthMenu.length;i<iLen;i++)
{sStdMenu+='<option value="'+oSettings.aLengthMenu[i]+'">'+
oSettings.aLengthMenu[i]+'</option>';}}
sStdMenu+='</select>';var nLength=document.createElement('div');if(oSettings.sTableId!==''&&typeof oSettings.aanFeatures.l=="undefined")
{nLength.setAttribute('id',oSettings.sTableId+'_length');}
nLength.className=oSettings.oClasses.sLength;nLength.innerHTML=oSettings.oLanguage.sLengthMenu.replace('_MENU_',sStdMenu);$('select option[value="'+oSettings._iDisplayLength+'"]',nLength).attr("selected",true);$('select',nLength).change(function(e){var iVal=$(this).val();var n=oSettings.aanFeatures.l;for(i=0,iLen=n.length;i<iLen;i++)
{if(n[i]!=this.parentNode)
{$('select',n[i]).val(iVal);}}
oSettings._iDisplayLength=parseInt(iVal,10);_fnCalculateEnd(oSettings);if(oSettings.fnDisplayEnd()==oSettings.fnRecordsDisplay())
{oSettings._iDisplayStart=oSettings.fnDisplayEnd()-oSettings._iDisplayLength;if(oSettings._iDisplayStart<0)
{oSettings._iDisplayStart=0;}}
if(oSettings._iDisplayLength==-1)
{oSettings._iDisplayStart=0;}
_fnDraw(oSettings);});return nLength;}
function _fnFeatureHtmlProcessing(oSettings)
{var nProcessing=document.createElement('div');if(oSettings.sTableId!==''&&typeof oSettings.aanFeatures.r=="undefined")
{nProcessing.setAttribute('id',oSettings.sTableId+'_processing');}
nProcessing.innerHTML=oSettings.oLanguage.sProcessing;nProcessing.className=oSettings.oClasses.sProcessing;oSettings.nTable.parentNode.insertBefore(nProcessing,oSettings.nTable);return nProcessing;}
function _fnProcessingDisplay(oSettings,bShow)
{if(oSettings.oFeatures.bProcessing)
{var an=oSettings.aanFeatures.r;for(var i=0,iLen=an.length;i<iLen;i++)
{an[i].style.visibility=bShow?"visible":"hidden";}}}
function _fnVisibleToColumnIndex(oSettings,iMatch)
{var iColumn=-1;for(var i=0;i<oSettings.aoColumns.length;i++)
{if(oSettings.aoColumns[i].bVisible===true)
{iColumn++;}
if(iColumn==iMatch)
{return i;}}
return null;}
function _fnColumnIndexToVisible(oSettings,iMatch)
{var iVisible=-1;for(var i=0;i<oSettings.aoColumns.length;i++)
{if(oSettings.aoColumns[i].bVisible===true)
{iVisible++;}
if(i==iMatch)
{return oSettings.aoColumns[i].bVisible===true?iVisible:null;}}
return null;}
function _fnNodeToDataIndex(s,n)
{var i,iLen;for(i=s._iDisplayStart,iLen=s._iDisplayEnd;i<iLen;i++)
{if(s.aoData[s.aiDisplay[i]].nTr==n)
{return s.aiDisplay[i];}}
for(i=0,iLen=s.aoData.length;i<iLen;i++)
{if(s.aoData[i].nTr==n)
{return i;}}
return null;}
function _fnVisbleColumns(oS)
{var iVis=0;for(var i=0;i<oS.aoColumns.length;i++)
{if(oS.aoColumns[i].bVisible===true)
{iVis++;}}
return iVis;}
function _fnCalculateEnd(oSettings)
{if(oSettings.oFeatures.bPaginate===false)
{oSettings._iDisplayEnd=oSettings.aiDisplay.length;}
else
{if(oSettings._iDisplayStart+oSettings._iDisplayLength>oSettings.aiDisplay.length||oSettings._iDisplayLength==-1)
{oSettings._iDisplayEnd=oSettings.aiDisplay.length;}
else
{oSettings._iDisplayEnd=oSettings._iDisplayStart+oSettings._iDisplayLength;}}}
function _fnConvertToWidth(sWidth,nParent)
{if(!sWidth||sWidth===null||sWidth==='')
{return 0;}
if(typeof nParent=="undefined")
{nParent=document.getElementsByTagName('body')[0];}
var iWidth;var nTmp=document.createElement("div");nTmp.style.width=sWidth;nParent.appendChild(nTmp);iWidth=nTmp.offsetWidth;nParent.removeChild(nTmp);return(iWidth);}
function _fnCalculateColumnWidths(oSettings)
{var iTableWidth=oSettings.nTable.offsetWidth;var iUserInputs=0;var iTmpWidth;var iVisibleColumns=0;var iColums=oSettings.aoColumns.length;var i;var oHeaders=$('th',oSettings.nTHead);for(i=0;i<iColums;i++)
{if(oSettings.aoColumns[i].bVisible)
{iVisibleColumns++;if(oSettings.aoColumns[i].sWidth!==null)
{iTmpWidth=_fnConvertToWidth(oSettings.aoColumns[i].sWidthOrig,oSettings.nTable.parentNode);if(iTmpWidth!==null)
{oSettings.aoColumns[i].sWidth=_fnStringToCss(iTmpWidth);}
iUserInputs++;}}}
if(iColums==oHeaders.length&&iUserInputs===0&&iVisibleColumns==iColums&&oSettings.oScroll.sX===""&&oSettings.oScroll.sY==="")
{for(i=0;i<oSettings.aoColumns.length;i++)
{iTmpWidth=$(oHeaders[i]).width();if(iTmpWidth!==null)
{oSettings.aoColumns[i].sWidth=_fnStringToCss(iTmpWidth);}}}
else
{var
nCalcTmp=oSettings.nTable.cloneNode(false),nBody=document.createElement('tbody'),nTr=document.createElement('tr'),nDivSizing;nCalcTmp.removeAttribute("id");nCalcTmp.appendChild(oSettings.nTHead.cloneNode(true));if(oSettings.nTFoot!==null)
{nCalcTmp.appendChild(oSettings.nTFoot.cloneNode(true));_fnApplyToChildren(function(n){n.style.width="";},nCalcTmp.getElementsByTagName('tr'));}
nCalcTmp.appendChild(nBody);nBody.appendChild(nTr);var jqColSizing=$('thead th',nCalcTmp);if(jqColSizing.length===0)
{jqColSizing=$('tbody tr:eq(0)>td',nCalcTmp);}
jqColSizing.each(function(i){this.style.width="";var iIndex=_fnVisibleToColumnIndex(oSettings,i);if(iIndex!==null&&oSettings.aoColumns[iIndex].sWidthOrig!=="")
{this.style.width=oSettings.aoColumns[iIndex].sWidthOrig;}});for(i=0;i<iColums;i++)
{if(oSettings.aoColumns[i].bVisible)
{var nTd=_fnGetWidestNode(oSettings,i);if(nTd!==null)
{nTd=nTd.cloneNode(true);nTr.appendChild(nTd);}}}
var nWrapper=oSettings.nTable.parentNode;nWrapper.appendChild(nCalcTmp);if(oSettings.oScroll.sX!==""&&oSettings.oScroll.sXInner!=="")
{nCalcTmp.style.width=_fnStringToCss(oSettings.oScroll.sXInner);}
else if(oSettings.oScroll.sX!=="")
{nCalcTmp.style.width="";if($(nCalcTmp).width()<nWrapper.offsetWidth)
{nCalcTmp.style.width=_fnStringToCss(nWrapper.offsetWidth);}}
else if(oSettings.oScroll.sY!=="")
{nCalcTmp.style.width=_fnStringToCss(nWrapper.offsetWidth);}
nCalcTmp.style.visibility="hidden";_fnScrollingWidthAdjust(oSettings,nCalcTmp);var oNodes=$("tbody tr:eq(0)>td",nCalcTmp);if(oNodes.length===0)
{oNodes=$("thead tr:eq(0)>th",nCalcTmp);}
var iIndex,iCorrector=0,iWidth;for(i=0;i<oSettings.aoColumns.length;i++)
{if(oSettings.aoColumns[i].bVisible)
{iWidth=$(oNodes[iCorrector]).width();if(iWidth!==null&&iWidth>0)
{oSettings.aoColumns[i].sWidth=_fnStringToCss(iWidth);}
iCorrector++;}}
oSettings.nTable.style.width=_fnStringToCss($(nCalcTmp).outerWidth());nCalcTmp.parentNode.removeChild(nCalcTmp);}}
function _fnScrollingWidthAdjust(oSettings,n)
{if(oSettings.oScroll.sX===""&&oSettings.oScroll.sY!=="")
{var iOrigWidth=$(n).width();n.style.width=_fnStringToCss($(n).outerWidth()-oSettings.oScroll.iBarWidth);}
else if(oSettings.oScroll.sX!=="")
{n.style.width=_fnStringToCss($(n).outerWidth());}}
function _fnGetWidestNode(oSettings,iCol,bFast)
{if(typeof bFast=='undefined'||bFast)
{var iMaxLen=_fnGetMaxLenString(oSettings,iCol);var iFastVis=_fnColumnIndexToVisible(oSettings,iCol);if(iMaxLen<0)
{return null;}
return oSettings.aoData[iMaxLen].nTr.getElementsByTagName('td')[iFastVis];}
var
iMax=-1,i,iLen,iMaxIndex=-1,n=document.createElement('div');n.style.visibility="hidden";n.style.position="absolute";document.body.appendChild(n);for(i=0,iLen=oSettings.aoData.length;i<iLen;i++)
{n.innerHTML=oSettings.aoData[i]._aData[iCol];if(n.offsetWidth>iMax)
{iMax=n.offsetWidth;iMaxIndex=i;}}
document.body.removeChild(n);if(iMaxIndex>=0)
{var iVis=_fnColumnIndexToVisible(oSettings,iCol);var nRet=oSettings.aoData[iMaxIndex].nTr.getElementsByTagName('td')[iVis];if(nRet)
{return nRet;}}
return null;}
function _fnGetMaxLenString(oSettings,iCol)
{var iMax=-1;var iMaxIndex=-1;for(var i=0;i<oSettings.aoData.length;i++)
{var s=oSettings.aoData[i]._aData[iCol];if(s.length>iMax)
{iMax=s.length;iMaxIndex=i;}}
return iMaxIndex;}
function _fnStringToCss(s)
{if(s===null)
{return"0px";}
if(typeof s=='number')
{if(s<0)
{return"0px";}
return s+"px";}
var c=s.charCodeAt(s.length-1);if(c<0x30||c>0x39)
{return s;}
return s+"px";}
function _fnArrayCmp(aArray1,aArray2)
{if(aArray1.length!=aArray2.length)
{return 1;}
for(var i=0;i<aArray1.length;i++)
{if(aArray1[i]!=aArray2[i])
{return 2;}}
return 0;}
function _fnDetectType(sData)
{var aTypes=_oExt.aTypes;var iLen=aTypes.length;for(var i=0;i<iLen;i++)
{var sType=aTypes[i](sData);if(sType!==null)
{return sType;}}
return'string';}
function _fnSettingsFromNode(nTable)
{for(var i=0;i<_aoSettings.length;i++)
{if(_aoSettings[i].nTable==nTable)
{return _aoSettings[i];}}
return null;}
function _fnGetDataMaster(oSettings)
{var aData=[];var iLen=oSettings.aoData.length;for(var i=0;i<iLen;i++)
{aData.push(oSettings.aoData[i]._aData);}
return aData;}
function _fnGetTrNodes(oSettings)
{var aNodes=[];var iLen=oSettings.aoData.length;for(var i=0;i<iLen;i++)
{aNodes.push(oSettings.aoData[i].nTr);}
return aNodes;}
function _fnGetTdNodes(oSettings)
{var nTrs=_fnGetTrNodes(oSettings);var nTds=[],nTd;var anReturn=[];var iCorrector;var iRow,iRows,iColumn,iColumns;for(iRow=0,iRows=nTrs.length;iRow<iRows;iRow++)
{nTds=[];for(iColumn=0,iColumns=nTrs[iRow].childNodes.length;iColumn<iColumns;iColumn++)
{nTd=nTrs[iRow].childNodes[iColumn];if(nTd.nodeName.toUpperCase()=="TD")
{nTds.push(nTd);}}
iCorrector=0;for(iColumn=0,iColumns=oSettings.aoColumns.length;iColumn<iColumns;iColumn++)
{if(oSettings.aoColumns[iColumn].bVisible)
{anReturn.push(nTds[iColumn-iCorrector]);}
else
{anReturn.push(oSettings.aoData[iRow]._anHidden[iColumn]);iCorrector++;}}}
return anReturn;}
function _fnEscapeRegex(sVal)
{var acEscape=['/','.','*','+','?','|','(',')','[',']','{','}','\\','$','^'];var reReplace=new RegExp('(\\'+acEscape.join('|\\')+')','g');return sVal.replace(reReplace,'\\$1');}
function _fnDeleteIndex(a,iTarget)
{var iTargetIndex=-1;for(var i=0,iLen=a.length;i<iLen;i++)
{if(a[i]==iTarget)
{iTargetIndex=i;}
else if(a[i]>iTarget)
{a[i]--;}}
if(iTargetIndex!=-1)
{a.splice(iTargetIndex,1);}}
function _fnReOrderIndex(oSettings,sColumns)
{var aColumns=sColumns.split(',');var aiReturn=[];for(var i=0,iLen=oSettings.aoColumns.length;i<iLen;i++)
{for(var j=0;j<iLen;j++)
{if(oSettings.aoColumns[i].sName==aColumns[j])
{aiReturn.push(j);break;}}}
return aiReturn;}
function _fnColumnOrdering(oSettings)
{var sNames='';for(var i=0,iLen=oSettings.aoColumns.length;i<iLen;i++)
{sNames+=oSettings.aoColumns[i].sName+',';}
if(sNames.length==iLen)
{return"";}
return sNames.slice(0,-1);}
function _fnLog(oSettings,iLevel,sMesg)
{var sAlert=oSettings.sTableId===""?"DataTables warning: "+sMesg:"DataTables warning (table id = '"+oSettings.sTableId+"'): "+sMesg;if(iLevel===0)
{if(_oExt.sErrMode=='alert')
{alert(sAlert);}
else
{throw sAlert;}
return;}
else if(typeof console!='undefined'&&typeof console.log!='undefined')
{console.log(sAlert);}}
function _fnClearTable(oSettings)
{oSettings.aoData.splice(0,oSettings.aoData.length);oSettings.aiDisplayMaster.splice(0,oSettings.aiDisplayMaster.length);oSettings.aiDisplay.splice(0,oSettings.aiDisplay.length);_fnCalculateEnd(oSettings);}
function _fnSaveState(oSettings)
{if(!oSettings.oFeatures.bStateSave||typeof oSettings.bDestroying!='undefined')
{return;}
var i,iLen,sTmp;var sValue="{";sValue+='"iCreate":'+new Date().getTime()+',';sValue+='"iStart":'+oSettings._iDisplayStart+',';sValue+='"iEnd":'+oSettings._iDisplayEnd+',';sValue+='"iLength":'+oSettings._iDisplayLength+',';sValue+='"sFilter":"'+encodeURIComponent(oSettings.oPreviousSearch.sSearch)+'",';sValue+='"sFilterEsc":'+!oSettings.oPreviousSearch.bRegex+',';sValue+='"aaSorting":[ ';for(i=0;i<oSettings.aaSorting.length;i++)
{sValue+='['+oSettings.aaSorting[i][0]+',"'+oSettings.aaSorting[i][1]+'"],';}
sValue=sValue.substring(0,sValue.length-1);sValue+="],";sValue+='"aaSearchCols":[ ';for(i=0;i<oSettings.aoPreSearchCols.length;i++)
{sValue+='["'+encodeURIComponent(oSettings.aoPreSearchCols[i].sSearch)+'",'+!oSettings.aoPreSearchCols[i].bRegex+'],';}
sValue=sValue.substring(0,sValue.length-1);sValue+="],";sValue+='"abVisCols":[ ';for(i=0;i<oSettings.aoColumns.length;i++)
{sValue+=oSettings.aoColumns[i].bVisible+",";}
sValue=sValue.substring(0,sValue.length-1);sValue+="]";for(i=0,iLen=oSettings.aoStateSave.length;i<iLen;i++)
{sTmp=oSettings.aoStateSave[i].fn(oSettings,sValue);if(sTmp!=="")
{sValue=sTmp;}}
sValue+="}";_fnCreateCookie(oSettings.sCookiePrefix+oSettings.sInstance,sValue,oSettings.iCookieDuration,oSettings.sCookiePrefix,oSettings.fnCookieCallback);}
function _fnLoadState(oSettings,oInit)
{if(!oSettings.oFeatures.bStateSave)
{return;}
var oData,i,iLen;var sData=_fnReadCookie(oSettings.sCookiePrefix+oSettings.sInstance);if(sData!==null&&sData!=='')
{try
{oData=(typeof $.parseJSON=='function')?$.parseJSON(sData.replace(/'/g,'"')):eval('('+sData+')');}
catch(e)
{return;}
for(i=0,iLen=oSettings.aoStateLoad.length;i<iLen;i++)
{if(!oSettings.aoStateLoad[i].fn(oSettings,oData))
{return;}}
oSettings.oLoadedState=$.extend(true,{},oData);oSettings._iDisplayStart=oData.iStart;oSettings.iInitDisplayStart=oData.iStart;oSettings._iDisplayEnd=oData.iEnd;oSettings._iDisplayLength=oData.iLength;oSettings.oPreviousSearch.sSearch=decodeURIComponent(oData.sFilter);oSettings.aaSorting=oData.aaSorting.slice();oSettings.saved_aaSorting=oData.aaSorting.slice();if(typeof oData.sFilterEsc!='undefined')
{oSettings.oPreviousSearch.bRegex=!oData.sFilterEsc;}
if(typeof oData.aaSearchCols!='undefined')
{for(i=0;i<oData.aaSearchCols.length;i++)
{oSettings.aoPreSearchCols[i]={"sSearch":decodeURIComponent(oData.aaSearchCols[i][0]),"bRegex":!oData.aaSearchCols[i][1]};}}
if(typeof oData.abVisCols!='undefined')
{oInit.saved_aoColumns=[];for(i=0;i<oData.abVisCols.length;i++)
{oInit.saved_aoColumns[i]={};oInit.saved_aoColumns[i].bVisible=oData.abVisCols[i];}}}}
function _fnCreateCookie(sName,sValue,iSecs,sBaseName,fnCallback)
{var date=new Date();date.setTime(date.getTime()+(iSecs*1000));var aParts=window.location.pathname.split('/');var sNameFile=sName+'_'+aParts.pop().replace(/[\/:]/g,"").toLowerCase();var sFullCookie,oData;if(fnCallback!==null)
{oData=(typeof $.parseJSON=='function')?$.parseJSON(sValue):eval('('+sValue+')');sFullCookie=fnCallback(sNameFile,oData,date.toGMTString(),aParts.join('/')+"/");}
else
{sFullCookie=sNameFile+"="+encodeURIComponent(sValue)+"; expires="+date.toGMTString()+"; path="+aParts.join('/')+"/";}
var sOldName="",iOldTime=9999999999999;var iLength=_fnReadCookie(sNameFile)!==null?document.cookie.length:sFullCookie.length+document.cookie.length;if(iLength+10>4096)
{var aCookies=document.cookie.split(';');for(var i=0,iLen=aCookies.length;i<iLen;i++)
{if(aCookies[i].indexOf(sBaseName)!=-1)
{var aSplitCookie=aCookies[i].split('=');try{oData=eval('('+decodeURIComponent(aSplitCookie[1])+')');}
catch(e){continue;}
if(typeof oData.iCreate!='undefined'&&oData.iCreate<iOldTime)
{sOldName=aSplitCookie[0];iOldTime=oData.iCreate;}}}
if(sOldName!=="")
{document.cookie=sOldName+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; path="+
aParts.join('/')+"/";}}
document.cookie=sFullCookie;}
function _fnReadCookie(sName)
{var
aParts=window.location.pathname.split('/'),sNameEQ=sName+'_'+aParts[aParts.length-1].replace(/[\/:]/g,"").toLowerCase()+'=',sCookieContents=document.cookie.split(';');for(var i=0;i<sCookieContents.length;i++)
{var c=sCookieContents[i];while(c.charAt(0)==' ')
{c=c.substring(1,c.length);}
if(c.indexOf(sNameEQ)===0)
{return decodeURIComponent(c.substring(sNameEQ.length,c.length));}}
return null;}
function _fnGetUniqueThs(nThead)
{var nTrs=nThead.getElementsByTagName('tr');if(nTrs.length==1)
{return nTrs[0].getElementsByTagName('th');}
var aLayout=[],aReturn=[];var ROWSPAN=2,COLSPAN=3,TDELEM=4;var i,j,k,iLen,jLen,iColumnShifted;var fnShiftCol=function(a,i,j){while(typeof a[i][j]!='undefined'){j++;}
return j;};var fnAddRow=function(i){if(typeof aLayout[i]=='undefined'){aLayout[i]=[];}};for(i=0,iLen=nTrs.length;i<iLen;i++)
{fnAddRow(i);var iColumn=0;var nTds=[];for(j=0,jLen=nTrs[i].childNodes.length;j<jLen;j++)
{if(nTrs[i].childNodes[j].nodeName.toUpperCase()=="TD"||nTrs[i].childNodes[j].nodeName.toUpperCase()=="TH")
{nTds.push(nTrs[i].childNodes[j]);}}
for(j=0,jLen=nTds.length;j<jLen;j++)
{var iColspan=nTds[j].getAttribute('colspan')*1;var iRowspan=nTds[j].getAttribute('rowspan')*1;if(!iColspan||iColspan===0||iColspan===1)
{iColumnShifted=fnShiftCol(aLayout,i,iColumn);aLayout[i][iColumnShifted]=(nTds[j].nodeName.toUpperCase()=="TD")?TDELEM:nTds[j];if(iRowspan||iRowspan===0||iRowspan===1)
{for(k=1;k<iRowspan;k++)
{fnAddRow(i+k);aLayout[i+k][iColumnShifted]=ROWSPAN;}}
iColumn++;}
else
{iColumnShifted=fnShiftCol(aLayout,i,iColumn);for(k=0;k<iColspan;k++)
{aLayout[i][iColumnShifted+k]=COLSPAN;}
iColumn+=iColspan;}}}
for(i=0,iLen=aLayout.length;i<iLen;i++)
{for(j=0,jLen=aLayout[i].length;j<jLen;j++)
{if(typeof aLayout[i][j]=='object')
{aReturn[j]=aLayout[i][j];}}}
return aReturn;}
function _fnScrollBarWidth()
{var inner=document.createElement('p');var style=inner.style;style.width="100%";style.height="200px";var outer=document.createElement('div');style=outer.style;style.position="absolute";style.top="0px";style.left="0px";style.visibility="hidden";style.width="200px";style.height="150px";style.overflow="hidden";outer.appendChild(inner);document.body.appendChild(outer);var w1=inner.offsetWidth;outer.style.overflow='scroll';var w2=inner.offsetWidth;if(w1==w2)
{w2=outer.clientWidth;}
document.body.removeChild(outer);return(w1-w2);}
function _fnApplyToChildren(fn,an1,an2)
{for(var i=0,iLen=an1.length;i<iLen;i++)
{for(var j=0,jLen=an1[i].childNodes.length;j<jLen;j++)
{if(an1[i].childNodes[j].nodeType==1)
{if(typeof an2!='undefined')
{fn(an1[i].childNodes[j],an2[i].childNodes[j]);}
else
{fn(an1[i].childNodes[j]);}}}}}
function _fnMap(oRet,oSrc,sName,sMappedName)
{if(typeof sMappedName=='undefined')
{sMappedName=sName;}
if(typeof oSrc[sName]!='undefined')
{oRet[sMappedName]=oSrc[sName];}}
this.oApi._fnExternApiFunc=_fnExternApiFunc;this.oApi._fnInitalise=_fnInitalise;this.oApi._fnLanguageProcess=_fnLanguageProcess;this.oApi._fnAddColumn=_fnAddColumn;this.oApi._fnColumnOptions=_fnColumnOptions;this.oApi._fnAddData=_fnAddData;this.oApi._fnGatherData=_fnGatherData;this.oApi._fnDrawHead=_fnDrawHead;this.oApi._fnDraw=_fnDraw;this.oApi._fnReDraw=_fnReDraw;this.oApi._fnAjaxUpdate=_fnAjaxUpdate;this.oApi._fnAjaxUpdateDraw=_fnAjaxUpdateDraw;this.oApi._fnAddOptionsHtml=_fnAddOptionsHtml;this.oApi._fnFeatureHtmlTable=_fnFeatureHtmlTable;this.oApi._fnScrollDraw=_fnScrollDraw;this.oApi._fnAjustColumnSizing=_fnAjustColumnSizing;this.oApi._fnFeatureHtmlFilter=_fnFeatureHtmlFilter;this.oApi._fnFilterComplete=_fnFilterComplete;this.oApi._fnFilterCustom=_fnFilterCustom;this.oApi._fnFilterColumn=_fnFilterColumn;this.oApi._fnFilter=_fnFilter;this.oApi._fnBuildSearchArray=_fnBuildSearchArray;this.oApi._fnBuildSearchRow=_fnBuildSearchRow;this.oApi._fnFilterCreateSearch=_fnFilterCreateSearch;this.oApi._fnDataToSearch=_fnDataToSearch;this.oApi._fnSort=_fnSort;this.oApi._fnSortAttachListener=_fnSortAttachListener;this.oApi._fnSortingClasses=_fnSortingClasses;this.oApi._fnFeatureHtmlPaginate=_fnFeatureHtmlPaginate;this.oApi._fnPageChange=_fnPageChange;this.oApi._fnFeatureHtmlInfo=_fnFeatureHtmlInfo;this.oApi._fnUpdateInfo=_fnUpdateInfo;this.oApi._fnFeatureHtmlLength=_fnFeatureHtmlLength;this.oApi._fnFeatureHtmlProcessing=_fnFeatureHtmlProcessing;this.oApi._fnProcessingDisplay=_fnProcessingDisplay;this.oApi._fnVisibleToColumnIndex=_fnVisibleToColumnIndex;this.oApi._fnColumnIndexToVisible=_fnColumnIndexToVisible;this.oApi._fnNodeToDataIndex=_fnNodeToDataIndex;this.oApi._fnVisbleColumns=_fnVisbleColumns;this.oApi._fnCalculateEnd=_fnCalculateEnd;this.oApi._fnConvertToWidth=_fnConvertToWidth;this.oApi._fnCalculateColumnWidths=_fnCalculateColumnWidths;this.oApi._fnScrollingWidthAdjust=_fnScrollingWidthAdjust;this.oApi._fnGetWidestNode=_fnGetWidestNode;this.oApi._fnGetMaxLenString=_fnGetMaxLenString;this.oApi._fnStringToCss=_fnStringToCss;this.oApi._fnArrayCmp=_fnArrayCmp;this.oApi._fnDetectType=_fnDetectType;this.oApi._fnSettingsFromNode=_fnSettingsFromNode;this.oApi._fnGetDataMaster=_fnGetDataMaster;this.oApi._fnGetTrNodes=_fnGetTrNodes;this.oApi._fnGetTdNodes=_fnGetTdNodes;this.oApi._fnEscapeRegex=_fnEscapeRegex;this.oApi._fnDeleteIndex=_fnDeleteIndex;this.oApi._fnReOrderIndex=_fnReOrderIndex;this.oApi._fnColumnOrdering=_fnColumnOrdering;this.oApi._fnLog=_fnLog;this.oApi._fnClearTable=_fnClearTable;this.oApi._fnSaveState=_fnSaveState;this.oApi._fnLoadState=_fnLoadState;this.oApi._fnCreateCookie=_fnCreateCookie;this.oApi._fnReadCookie=_fnReadCookie;this.oApi._fnGetUniqueThs=_fnGetUniqueThs;this.oApi._fnScrollBarWidth=_fnScrollBarWidth;this.oApi._fnApplyToChildren=_fnApplyToChildren;this.oApi._fnMap=_fnMap;var _that=this;return this.each(function()
{var i=0,iLen,j,jLen,k,kLen;for(i=0,iLen=_aoSettings.length;i<iLen;i++)
{if(_aoSettings[i].nTable==this)
{if(typeof oInit=='undefined'||(typeof oInit.bRetrieve!='undefined'&&oInit.bRetrieve===true))
{return _aoSettings[i].oInstance;}
else if(typeof oInit.bDestroy!='undefined'&&oInit.bDestroy===true)
{_aoSettings[i].oInstance.fnDestroy();break;}
else
{_fnLog(_aoSettings[i],0,"Cannot reinitialise DataTable.\n\n"+"To retrieve the DataTables object for this table, please pass either no arguments "+"to the dataTable() function, or set bRetrieve to true. Alternatively, to destory "+"the old table and create a new one, set bDestroy to true (note that a lot of "+"changes to the configuration can be made through the API which is usually much "+"faster).");return;}}
if(_aoSettings[i].sTableId!==""&&_aoSettings[i].sTableId==this.getAttribute('id'))
{_aoSettings.splice(i,1);break;}}
var oSettings=new classSettings();_aoSettings.push(oSettings);var bInitHandedOff=false;var bUsePassedData=false;var sId=this.getAttribute('id');if(sId!==null)
{oSettings.sTableId=sId;oSettings.sInstance=sId;}
else
{oSettings.sInstance=_oExt._oExternConfig.iNextUnique++;}
if(this.nodeName.toLowerCase()!='table')
{_fnLog(oSettings,0,"Attempted to initialise DataTables on a node which is not a "+"table: "+this.nodeName);return;}
oSettings.oInstance=_that;oSettings.nTable=this;oSettings.oApi=_that.oApi;oSettings.sDestroyWidth=$(this).width();if(typeof oInit!='undefined'&&oInit!==null)
{oSettings.oInit=oInit;_fnMap(oSettings.oFeatures,oInit,"bPaginate");_fnMap(oSettings.oFeatures,oInit,"bLengthChange");_fnMap(oSettings.oFeatures,oInit,"bFilter");_fnMap(oSettings.oFeatures,oInit,"bSort");_fnMap(oSettings.oFeatures,oInit,"bInfo");_fnMap(oSettings.oFeatures,oInit,"bProcessing");_fnMap(oSettings.oFeatures,oInit,"bAutoWidth");_fnMap(oSettings.oFeatures,oInit,"bSortClasses");_fnMap(oSettings.oFeatures,oInit,"bServerSide");_fnMap(oSettings.oScroll,oInit,"sScrollX","sX");_fnMap(oSettings.oScroll,oInit,"sScrollXInner","sXInner");_fnMap(oSettings.oScroll,oInit,"sScrollY","sY");_fnMap(oSettings.oScroll,oInit,"bScrollCollapse","bCollapse");_fnMap(oSettings.oScroll,oInit,"bScrollInfinite","bInfinite");_fnMap(oSettings.oScroll,oInit,"iScrollLoadGap","iLoadGap");_fnMap(oSettings,oInit,"asStripClasses");_fnMap(oSettings,oInit,"fnRowCallback");_fnMap(oSettings,oInit,"fnHeaderCallback");_fnMap(oSettings,oInit,"fnFooterCallback");_fnMap(oSettings,oInit,"fnCookieCallback");_fnMap(oSettings,oInit,"fnInitComplete");_fnMap(oSettings,oInit,"fnServerData");_fnMap(oSettings,oInit,"fnFormatNumber");_fnMap(oSettings,oInit,"aaSorting");_fnMap(oSettings,oInit,"aaSortingFixed");_fnMap(oSettings,oInit,"aLengthMenu");_fnMap(oSettings,oInit,"sPaginationType");_fnMap(oSettings,oInit,"sAjaxSource");_fnMap(oSettings,oInit,"iCookieDuration");_fnMap(oSettings,oInit,"sCookiePrefix");_fnMap(oSettings,oInit,"sDom");_fnMap(oSettings,oInit,"oSearch","oPreviousSearch");_fnMap(oSettings,oInit,"aoSearchCols","aoPreSearchCols");_fnMap(oSettings,oInit,"iDisplayLength","_iDisplayLength");_fnMap(oSettings,oInit,"bJQueryUI","bJUI");_fnMap(oSettings.oLanguage,oInit,"fnInfoCallback");if(typeof oInit.fnDrawCallback=='function')
{oSettings.aoDrawCallback.push({"fn":oInit.fnDrawCallback,"sName":"user"});}
if(typeof oInit.fnStateSaveCallback=='function')
{oSettings.aoStateSave.push({"fn":oInit.fnStateSaveCallback,"sName":"user"});}
if(typeof oInit.fnStateLoadCallback=='function')
{oSettings.aoStateLoad.push({"fn":oInit.fnStateLoadCallback,"sName":"user"});}
if(oSettings.oFeatures.bServerSide&&oSettings.oFeatures.bSort&&oSettings.oFeatures.bSortClasses)
{oSettings.aoDrawCallback.push({"fn":_fnSortingClasses,"sName":"server_side_sort_classes"});}
if(typeof oInit.bJQueryUI!='undefined'&&oInit.bJQueryUI)
{oSettings.oClasses=_oExt.oJUIClasses;if(typeof oInit.sDom=='undefined')
{oSettings.sDom='<"H"lfr>t<"F"ip>';}}
if(oSettings.oScroll.sX!==""||oSettings.oScroll.sY!=="")
{oSettings.oScroll.iBarWidth=_fnScrollBarWidth();}
if(typeof oInit.iDisplayStart!='undefined'&&typeof oSettings.iInitDisplayStart=='undefined')
{oSettings.iInitDisplayStart=oInit.iDisplayStart;oSettings._iDisplayStart=oInit.iDisplayStart;}
if(typeof oInit.bStateSave!='undefined')
{oSettings.oFeatures.bStateSave=oInit.bStateSave;_fnLoadState(oSettings,oInit);oSettings.aoDrawCallback.push({"fn":_fnSaveState,"sName":"state_save"});}
if(typeof oInit.aaData!='undefined')
{bUsePassedData=true;}
if(typeof oInit!='undefined'&&typeof oInit.aoData!='undefined')
{oInit.aoColumns=oInit.aoData;}
if(typeof oInit.oLanguage!='undefined')
{if(typeof oInit.oLanguage.sUrl!='undefined'&&oInit.oLanguage.sUrl!=="")
{oSettings.oLanguage.sUrl=oInit.oLanguage.sUrl;$.getJSON(oSettings.oLanguage.sUrl,null,function(json){_fnLanguageProcess(oSettings,json,true);});bInitHandedOff=true;}
else
{_fnLanguageProcess(oSettings,oInit.oLanguage,false);}}}
else
{oInit={};}
if(typeof oInit.asStripClasses=='undefined')
{oSettings.asStripClasses.push(oSettings.oClasses.sStripOdd);oSettings.asStripClasses.push(oSettings.oClasses.sStripEven);}
var bStripeRemove=false;var anRows=$('tbody>tr',this);for(i=0,iLen=oSettings.asStripClasses.length;i<iLen;i++)
{if(anRows.filter(":lt(2)").hasClass(oSettings.asStripClasses[i]))
{bStripeRemove=true;break;}}
if(bStripeRemove)
{oSettings.asDestoryStrips=['',''];if($(anRows[0]).hasClass(oSettings.oClasses.sStripOdd))
{oSettings.asDestoryStrips[0]+=oSettings.oClasses.sStripOdd+" ";}
if($(anRows[0]).hasClass(oSettings.oClasses.sStripEven))
{oSettings.asDestoryStrips[0]+=oSettings.oClasses.sStripEven;}
if($(anRows[1]).hasClass(oSettings.oClasses.sStripOdd))
{oSettings.asDestoryStrips[1]+=oSettings.oClasses.sStripOdd+" ";}
if($(anRows[1]).hasClass(oSettings.oClasses.sStripEven))
{oSettings.asDestoryStrips[1]+=oSettings.oClasses.sStripEven;}
anRows.removeClass(oSettings.asStripClasses.join(' '));}
var nThead=this.getElementsByTagName('thead');var anThs=nThead.length===0?[]:_fnGetUniqueThs(nThead[0]);var aoColumnsInit;if(typeof oInit.aoColumns=='undefined')
{aoColumnsInit=[];for(i=0,iLen=anThs.length;i<iLen;i++)
{aoColumnsInit.push(null);}}
else
{aoColumnsInit=oInit.aoColumns;}
for(i=0,iLen=aoColumnsInit.length;i<iLen;i++)
{if(typeof oInit.saved_aoColumns!='undefined'&&oInit.saved_aoColumns.length==iLen)
{if(aoColumnsInit[i]===null)
{aoColumnsInit[i]={};}
aoColumnsInit[i].bVisible=oInit.saved_aoColumns[i].bVisible;}
_fnAddColumn(oSettings,anThs?anThs[i]:null);}
if(typeof oInit.aoColumnDefs!='undefined')
{for(i=oInit.aoColumnDefs.length-1;i>=0;i--)
{var aTargets=oInit.aoColumnDefs[i].aTargets;if(!$.isArray(aTargets))
{_fnLog(oSettings,1,'aTargets must be an array of targets, not a '+(typeof aTargets));}
for(j=0,jLen=aTargets.length;j<jLen;j++)
{if(typeof aTargets[j]=='number'&&aTargets[j]>=0)
{while(oSettings.aoColumns.length<=aTargets[j])
{_fnAddColumn(oSettings);}
_fnColumnOptions(oSettings,aTargets[j],oInit.aoColumnDefs[i]);}
else if(typeof aTargets[j]=='number'&&aTargets[j]<0)
{_fnColumnOptions(oSettings,oSettings.aoColumns.length+aTargets[j],oInit.aoColumnDefs[i]);}
else if(typeof aTargets[j]=='string')
{for(k=0,kLen=oSettings.aoColumns.length;k<kLen;k++)
{if(aTargets[j]=="_all"||oSettings.aoColumns[k].nTh.className.indexOf(aTargets[j])!=-1)
{_fnColumnOptions(oSettings,k,oInit.aoColumnDefs[i]);}}}}}}
if(typeof aoColumnsInit!='undefined')
{for(i=0,iLen=aoColumnsInit.length;i<iLen;i++)
{_fnColumnOptions(oSettings,i,aoColumnsInit[i]);}}
for(i=0,iLen=oSettings.aaSorting.length;i<iLen;i++)
{if(oSettings.aaSorting[i][0]>=oSettings.aoColumns.length)
{oSettings.aaSorting[i][0]=0;}
var oColumn=oSettings.aoColumns[oSettings.aaSorting[i][0]];if(typeof oSettings.aaSorting[i][2]=='undefined')
{oSettings.aaSorting[i][2]=0;}
if(typeof oInit.aaSorting=="undefined"&&typeof oSettings.saved_aaSorting=="undefined")
{oSettings.aaSorting[i][1]=oColumn.asSorting[0];}
for(j=0,jLen=oColumn.asSorting.length;j<jLen;j++)
{if(oSettings.aaSorting[i][1]==oColumn.asSorting[j])
{oSettings.aaSorting[i][2]=j;break;}}}
_fnSortingClasses(oSettings);if(this.getElementsByTagName('thead').length===0)
{this.appendChild(document.createElement('thead'));}
if(this.getElementsByTagName('tbody').length===0)
{this.appendChild(document.createElement('tbody'));}
oSettings.nTHead=this.getElementsByTagName('thead')[0];oSettings.nTBody=this.getElementsByTagName('tbody')[0];if(this.getElementsByTagName('tfoot').length>0)
{oSettings.nTFoot=this.getElementsByTagName('tfoot')[0];}
if(bUsePassedData)
{for(i=0;i<oInit.aaData.length;i++)
{_fnAddData(oSettings,oInit.aaData[i]);}}
else
{_fnGatherData(oSettings);}
oSettings.aiDisplay=oSettings.aiDisplayMaster.slice();oSettings.bInitialised=true;if(bInitHandedOff===false)
{_fnInitalise(oSettings);}});};})(jQuery,window,document);var Base=function(){};Base.extend=function(_instance,_static){var extend=Base.prototype.extend;Base._prototyping=true;var proto=new this;extend.call(proto,_instance);proto.base=function(){};delete Base._prototyping;var constructor=proto.constructor;var klass=proto.constructor=function(){if(!Base._prototyping){if(this._constructing||this.constructor==klass){this._constructing=true;constructor.apply(this,arguments);delete this._constructing;}else if(arguments[0]!=null){return(arguments[0].extend||extend).call(arguments[0],proto);}}};klass.ancestor=this;klass.extend=this.extend;klass.forEach=this.forEach;klass.implement=this.implement;klass.prototype=proto;klass.toString=this.toString;klass.valueOf=function(type){return(type=="object")?klass:constructor.valueOf();};extend.call(klass,_static);if(typeof klass.init=="function")klass.init();return klass;};Base.prototype={extend:function(source,value){if(arguments.length>1){var ancestor=this[source];if(ancestor&&(typeof value=="function")&&(!ancestor.valueOf||ancestor.valueOf()!=value.valueOf())&&/\bbase\b/.test(value)){var method=value.valueOf();value=function(){var previous=this.base||Base.prototype.base;this.base=ancestor;var returnValue=method.apply(this,arguments);this.base=previous;return returnValue;};value.valueOf=function(type){return(type=="object")?value:method;};value.toString=Base.toString;}
this[source]=value;}else if(source){var extend=Base.prototype.extend;if(!Base._prototyping&&typeof this!="function"){extend=this.extend||extend;}
var proto={toSource:null};var hidden=["constructor","toString","valueOf"];var i=Base._prototyping?0:1;while(key=hidden[i++]){if(source[key]!=proto[key]){extend.call(this,key,source[key]);}}
for(var key in source){if(!proto[key])extend.call(this,key,source[key]);}}
return this;}};Base=Base.extend({constructor:function(){this.extend(arguments[0]);}},{ancestor:Object,version:"1.1",forEach:function(object,block,context){for(var key in object){if(this.prototype[key]===undefined){block.call(context,object[key],key,object);}}},implement:function(){for(var i=0;i<arguments.length;i++){if(typeof arguments[i]=="function"){arguments[i](this.prototype);}else{this.prototype.extend(arguments[i]);}}
return this;},toString:function(){return String(this.valueOf());}});$.ajaxSetup({type:"POST",async:false,traditional:true,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=UTF-8",dataFilter:function(data,dtype){Dashboards.lastServerResponse=Date.now();return data;}});var pathArray=window.location.pathname.split('/');var webAppPath;if(!(typeof(CONTEXT_PATH)=='undefined')){webAppPath=CONTEXT_PATH;}
if(webAppPath==undefined){webAppPath="/"+pathArray[1];}
if(webAppPath.endsWith("/")){webAppPath=webAppPath.substr(0,webAppPath.length-1);}
var GB_ANIMATION=true;var CDF_CHILDREN=1;var CDF_SELF=2;var ERROR_IMAGE=webAppPath+"/content/pentaho-cdf/resources/style/images/error.png";var CDF_ERROR_DIV='cdfErrorDiv';if($.blockUI){$.blockUI.defaults.fadeIn=0;$.blockUI.defaults.message='<div style="padding: 0px;"><img src="'+webAppPath+'/content/pentaho-cdf/resources/style/images/processing_transparent.gif" />';$.blockUI.defaults.css.left='50%';$.blockUI.defaults.css.top='40%';$.blockUI.defaults.css.marginLeft='-16px';$.blockUI.defaults.css.width='32px';$.blockUI.defaults.css.background='none';$.blockUI.defaults.overlayCSS={backgroundColor:"#FFFFFF",opacity:0.8,cursor:"wait"};$.blockUI.defaults.css.border="none";}
if(typeof $.SetImpromptuDefaults=='function')
$.SetImpromptuDefaults({prefix:'colsJqi',show:'slideDown'});var Dashboards={ERROR_CODES:{'QUERY_TIMEOUT':{msg:"Query timeout reached"},"COMPONENT_ERROR":{msg:"Error processing component"}},CDF_BASE_PATH:webAppPath+"/content/pentaho-cdf/",parameterModel:new Backbone.Model(),TRAFFIC_RED:webAppPath+"/content/pentaho-cdf/resources/style/images/traffic_red.png",TRAFFIC_YELLOW:webAppPath+"/content/pentaho-cdf/resources/style/images/traffic_yellow.png",TRAFFIC_GREEN:webAppPath+"/content/pentaho-cdf/resources/style/images/traffic_green.png",viewFlags:{UNUSED:"unused",UNBOUND:"unbound",VIEW:"view"},globalContext:true,escapeParameterValues:true,runningCalls:0,components:[],parameters:[],context:{},legacyPriority:-1000,logLifecycle:true,args:[],monthNames:['January','February','March','April','May','June','July','August','September','October','November','December'],lastServerResponse:Date.now(),serverCheckResponseTimeout:1800000,i18nCurrentLanguageCode:null,i18nSupport:null};_.extend(Dashboards,Backbone.Events);Dashboards.log=function(m,type){if(typeof console!="undefined"){if(type&&console[type]){console[type]("CDF: "+m);}else if(type==='exception'&&!console.exception){console.error(m.stack);}
else{console.log("CDF: "+m);}}};Dashboards.error=function(m){this.log(m,'error');}
Dashboards.RefreshEngine=function(){var NO_REFRESH=0;var refreshQueue=new Array();var activeTimer=null;var globalRefreshPeriod=NO_REFRESH;var globalTimer=null;Dashboards.RefreshEngine.QueueItem=function(){return{nextRefresh:0,component:null};};var startGlobalRefresh=function(refreshPeriod){if(globalTimer!=null){clearInterval(globalTimer);globalTimer=null;}
globalRefreshPeriod=(refreshPeriod>0)?refreshPeriod:NO_REFRESH;if(globalRefreshPeriod!=NO_REFRESH){globalTimer=setInterval("Dashboards.refreshEngine.fireGlobalRefresh()",globalRefreshPeriod*1000);}};var clearFromQueue=function(component){for(var i=0;i<refreshQueue.length;i++){if(refreshQueue[i].component==component){refreshQueue.splice(i,1);i--;}}};var clearQueue=function(){if(refreshQueue.length>0)refreshQueue.splice(0,refreshQueue.length);};var getSortedInsertPosition=function(coll,elem){var high=coll.length-1;var low=0;var mid;while(low<=high){mid=parseInt((low+high)/2)
if(coll[mid].nextRefresh>elem.nextRefresh){high=mid-1;}else if(coll[mid].nextRefresh<elem.nextRefresh){low=mid+1;}else{return mid;}}
return low;};var sortedInsert=function(rtArray,rtInfo){var pos=getSortedInsertPosition(rtArray,rtInfo);rtArray.splice(pos,0,rtInfo);};var stopTimer=function(){if(activeTimer!=null){clearTimeout(activeTimer);activeTimer=null;}};var restartTimer=function(){stopTimer();Dashboards.refreshEngine.fireRefresh();};var getCurrentTime=function(){var date=new Date();return date.getTime();};var isFirstInQueue=function(component){return refreshQueue.length>0&&refreshQueue[0].component==component;};var refreshComponent=function(component){Dashboards.update(component);};var insertInQueue=function(component){var time=getCurrentTime();if(!(component.refreshPeriod>0)){component.refreshPeriod=NO_REFRESH;}
if(component.refreshPeriod!=NO_REFRESH){var info=new Dashboards.RefreshEngine.QueueItem();info.nextRefresh=time+(component.refreshPeriod*1000);info.component=component;sortedInsert(refreshQueue,info);}};return{registerComponent:function(component,refreshPeriod){if(!component)return false;component.refreshPeriod=(refreshPeriod>0)?refreshPeriod:NO_REFRESH;var wasFirst=isFirstInQueue(component);clearFromQueue(component);if(wasFirst)restartTimer();return true;},getRefreshPeriod:function(component){if(component&&component.refreshPeriod>0)return component.refreshPeriod;else return NO_REFRESH;},processComponent:function(component){clearFromQueue(component);insertInQueue(component);if(isFirstInQueue(component))restartTimer();return true;},processComponents:function(){clearQueue();for(var i=0;i<Dashboards.components.length;i++){insertInQueue(Dashboards.components[i]);}
restartTimer();return true;},fireRefresh:function(){activeTimer=null;var currentTime=getCurrentTime();while(refreshQueue.length>0&&refreshQueue[0].nextRefresh<=currentTime){var info=refreshQueue.shift();refreshComponent(info.component);}
if(refreshQueue.length>0){activeTimer=setTimeout("Dashboards.refreshEngine.fireRefresh()",refreshQueue[0].nextRefresh-currentTime);}},fireGlobalRefresh:function(){for(i=0;i<Dashboards.components.length;i++){var comp=Dashboards.components[i];if(!(comp.refreshPeriod>0)&&comp.type!="select"){refreshComponent(comp);}}},setGlobalRefresh:function(refreshPeriod){startGlobalRefresh(refreshPeriod);},getQueue:function(){return refreshQueue;}};};Dashboards.refreshEngine=new Dashboards.RefreshEngine();Dashboards.setGlobalContext=function(globalContext){this.globalContext=globalContext;};Dashboards.showProgressIndicator=function(){this.blockUIwithDrag();};Dashboards.hideProgressIndicator=function(){$.unblockUI();this.showErrorTooltip();};Dashboards.resetRunningCalls=function(){this.runningCalls=0;setTimeout(_.bind(function(){this.hideProgressIndicator();},this),10);};Dashboards.getRunningCalls=function(){return this.runningCalls;};Dashboards.incrementRunningCalls=function(){this.runningCalls++;this.showProgressIndicator();};Dashboards.decrementRunningCalls=function(){this.runningCalls--;setTimeout(_.bind(function(){if(this.runningCalls<=0){this.hideProgressIndicator();this.runningCalls=0;}},this),10);};Dashboards.bindControl=function(control){var Class=this._getControlClass(control);if(!Class){this.log("Object type "+control["type"]+" can't be mapped to a valid class","error");}else{this._castControlToClass(control,Class);}
this.bindExistingControl(control,Class);};Dashboards.bindExistingControl=function(control,Class){if(!control.dashboard){control.dashboard=this;this._castControlToComponent(control,Class);if(typeof control.off==="function"){control.off("all");}
$.extend(control,Backbone.Events);this._addLogLifecycleToControl(control);if(control.priority==null||control.priority===""){control.priority=this.legacyPriority++;}}
return control;};Dashboards._castControlToClass=function(control,Class){if(!(control instanceof Class)){var controlImpl=this._makeInstance(Class);$.extend(control,controlImpl);}};Dashboards._getControlClass=function(control){var typeName=control.type;if(typeof typeName==='function'){typeName=typeName.call(control);}
var TypeName=typeName.substring(0,1).toUpperCase()+typeName.substring(1);var typeNames=[TypeName+'Component',typeName,TypeName];for(var i=0,N=typeNames.length;i<N;i++){var Class=window[typeNames[i]];if(Class&&typeof Class==='function'){return Class;}}};Dashboards._makeInstance=function(Class,args){var o=Object.create(Class.prototype);if(args){Class.apply(o,args);}else{Class.apply(o);}
return o;};Dashboards._castControlToComponent=function(control,Class){if(!(control instanceof BaseComponent)&&(!Class||!(Class.prototype instanceof BaseComponent))){var baseProto=BaseComponent.prototype;for(var p in baseProto){if(baseProto.hasOwnProperty(p)&&(control[p]===undefined)&&(typeof baseProto[p]==='function')){switch(p){case'base':break;default:control[p]=baseProto[p];break;}}}}};Dashboards._addLogLifecycleToControl=function(control){var myself=this;control.on("all",function(e){if(myself.logLifecycle&&e!=="cdf"&&this.name!=="PostInitMarker"&&typeof console!=="undefined"){var eventStr;var eventName=e.substr(4);switch(eventName){case"preExecution":eventStr=">Start";break;case"postExecution":eventStr="<End  ";break;case"error":eventStr="!Error";break;default:eventStr="      ";break;}
var timeInfo=Mustache.render("Timing: {{elapsedSinceStartDesc}} since start, {{elapsedSinceStartDesc}} since last event",this.splitTimer());console.log("%c          [Lifecycle "+eventStr+"] "+this.name+" (P: "+this.priority+" ): "+
e.substr(4)+" "+timeInfo+" (Running: "+this.dashboard.runningCalls+")","color: "+this.getLogColor());}});};Dashboards.getErrorObj=function(errorCode){return Dashboards.ERROR_CODES[errorCode]||{};};Dashboards.parseServerError=function(resp,txtStatus,error){var out={};var regexs=[{match:/Query timeout/,msg:Dashboards.getErrorObj('QUERY_TIMEOUT').msg}];out.error=error;out.msg=Dashboards.getErrorObj('COMPONENT_ERROR').msg;var str=$('<div/>').html(resp.responseText).find('h1').text();_.find(regexs,function(el){if(str.match(el.match)){out.msg=el.msg;return true}else{return false}});out.errorStatus=txtStatus;return out};Dashboards.handleServerError=function(){var err=Dashboards.parseServerError.apply(this,arguments);Dashboards.errorNotification(err);Dashboards.trigger('cdf cdf:serverError',this);Dashboards.resetRunningCalls();};Dashboards.errorNotification=function(err,ph){if(ph){wd.cdf.notifications.component.render($(ph),{title:err.msg,desc:""});}else{wd.cdf.notifications.growl.render({title:err.msg,desc:''});}};Dashboards.loginAlert=function(newOpts){var opts={header:"Warning",desc:"You are no longer logged in or the connection to the server timed out",button:"Click to reload this page",callback:function(){window.location.reload(true);}};opts=_.extend({},opts,newOpts);wd.cdf.popups.okPopup.show(opts);this.trigger('cdf cdf:loginError',this);};Dashboards.checkServer=function(){var retVal=false;$.ajax({type:'POST',async:false,dataType:'json',url:Dashboards.CDF_BASE_PATH+'ping',success:function(result){if(result&&result.ping=='ok'){retVal=true;}
else{retVal=false;}},error:function(){retVal=false;}});return retVal;};Dashboards.restoreDuplicates=function(){var dupes=this.components.filter(function(c){return c.type=='duplicate'}),suffixes={},params=this.getBookmarkState().params||{};Object.keys(params).filter(function(e){return/(_[0-9]+)+$/.test(e);}).map(function(e){var parts=e.match(/(.*?)((_[0-9]+)+)$/),name=parts[1],suffix=parts[2];if(!suffixes[suffix]){suffixes[suffix]={}}
suffixes[suffix][name]=params[e];return e;});var myself=this;for(var s in suffixes)if(suffixes.hasOwnProperty(s)){var params=suffixes[s];$.each(dupes,function(i,e){var p;for(p=0;p<e.parameters.length;p++){if(!params.hasOwnProperty(e.parameters[p])&&myself.isBookmarkable(e.parameters[p])){return;}}
e.duplicate(params);});}}
Dashboards.blockUIwithDrag=function(){if(typeof this.i18nSupport!=="undefined"&&this.i18nSupport!=null){$.blockUI.defaults.message='<div style="padding: 0px;"><img src="'+webAppPath+'/content/pentaho-cdf/resources/style/images/processing_transparent.gif" /></div>';}
$.blockUI();var handle=$('<div id="blockUIDragHandle"></div>')
$("div.blockUI.blockMsg").prepend(handle);$("div.blockUI.blockMsg").draggable({handle:"#blockUIDragHandle"});};Dashboards.updateLifecycle=function(object){var silent=object.lifecycle?!!object.lifecycle.silent:false;if(object.disabled){return;}
if(!silent){this.incrementRunningCalls();}
var handler=_.bind(function(){try{var shouldExecute;if(!(typeof(object.preExecution)=='undefined')){shouldExecute=object.preExecution.apply(object);}
shouldExecute=typeof shouldExecute!="undefined"?!!shouldExecute:true;object.trigger('cdf cdf:preExecution',object,shouldExecute);if(!shouldExecute){return;}
if(object.tooltip!=undefined){object._tooltip=typeof object["tooltip"]=='function'?object.tooltip():object.tooltip;}
if((object.update!=undefined)&&(typeof object['update']=='function')){object.update();this.refreshEngine.processComponent(object);}else{}
if(!(typeof(object.postExecution)=='undefined')){object.postExecution.apply(object);}
if(object._tooltip!=undefined){$("#"+object.htmlObject).attr("title",object._tooltip).tooltip({delay:0,track:true,fade:250});}}catch(e){var ph=(object.htmlObject)?$('#'+object.htmlObject):undefined,msg=Dashboards.getErrorObj('COMPONENT_ERROR').msg
+' ('+object.name.replace('render_','')+')';this.errorNotification({msg:msg},ph);this.log("Error updating "+object.name+":",'error');this.log(e,'exception');}finally{if(!silent){this.decrementRunningCalls();}}
object.trigger('cdf cdf:postExecution',object);},this);setTimeout(handler,1);};Dashboards.update=function(component){if(!this.updateQueue){this.updateQueue=[];}
this.updateQueue.push(component);if(this.updateTimeout){clearTimeout(this.updateTimeout);}
var handler=_.bind(function(){this.updateAll(this.updateQueue);delete this.updateQueue;},this);this.updateTimeout=setTimeout(handler,5);};Dashboards.updateComponent=function(object){if(Date.now()-Dashboards.lastServerResponse>Dashboards.serverCheckResponseTimeout){if(!Dashboards.checkServer()){Dashboards.hideProgressIndicator();Dashboards.loginAlert();throw"not logged in";}}
if(object.isManaged===false&&object.update){object.update();this.refreshEngine.processComponent(object);}else{this.updateLifecycle(object);}};Dashboards.createAndCleanErrorDiv=function(){if($("#"+CDF_ERROR_DIV).length==0){$("body").append("<div id='"+CDF_ERROR_DIV+"'></div>");}
$("#"+CDF_ERROR_DIV).empty();};Dashboards.showErrorTooltip=function(){$(function(){$(".cdf_error").tooltip({delay:0,track:true,fade:250,showBody:" -- "})});};Dashboards.getComponent=function(name){for(var i in this.components){if(this.components[i].name==name)
return this.components[i];}};Dashboards.getComponentByName=function(name){if(this.globalContext){return eval(name);}else{return this.getComponent(name);}};Dashboards.addComponents=function(components){components.forEach(function(component){this.bindControl(component);this.components.push(component);},this);};Dashboards.addComponent=function(component,options){this.removeComponent(component);this.bindControl(component);var index=options&&options.index;var L=this.components.length;if(index==null||index<0||index>L){index=L;}
this.components[index]=component;};Dashboards.getComponentIndex=function(compOrNameOrIndex){if(compOrNameOrIndex!=null){switch(typeof compOrNameOrIndex){case'string':for(var i=0,cs=this.components,L=cs.length;i<L;i++){if(cs[i].name===compOrNameOrIndex){return i;}}
break;case'number':if(compOrNameOrIndex>=0&&compOrNameOrIndex<this.components.length){return compOrNameOrIndex;}
break;default:return this.components.indexOf(compOrNameOrIndex);}}
return-1;};Dashboards.removeComponent=function(compOrNameOrIndex){var index=this.getComponentIndex(compOrNameOrIndex);var comp=null;if(index>=0){var cs=this.components;comp=cs[index];comp.dashboard=null;cs.splice(index,1);}
return comp;};Dashboards.registerEvent=function(ev,callback){if(typeof this.events=='undefined'){this.events={};}
this.events[ev]=callback;};Dashboards.addArgs=function(url){if(url!=undefined)
this.args=getURLParameters(url);};Dashboards.setI18nSupport=function(lc,i18nRef){if(i18nRef!=="undefined"&&lc!=="undefined"){this.i18nCurrentLanguageCode=lc;this.i18nSupport=i18nRef;}};Dashboards.init=function(components){var myself=this;if(this.initialStorage){_.extend(this.storage,this.initialStorage);}else{this.loadStorage();}
if(this.context!=null&&this.context.sessionTimeout!=null){Dashboards.serverCheckResponseTimeout=this.context.sessionTimeout*900;}
this.restoreBookmarkables();this.restoreView();this.syncParametersInit();if($.isArray(components)){this.addComponents(components);}
$(function(){myself.initEngine();});};Dashboards.syncParameters=function(master,slave){this.setParameter(slave,this.getParameterValue(master));this.parameterModel.change();this.parameterModel.on("change:"+master,function(m,v){this.fireChange(slave,v)},this);this.parameterModel.on("change:"+slave,function(m,v){this.fireChange(master,v)},this);}
Dashboards.chains=[];Dashboards.syncedParameters={};Dashboards.syncParametersOnInit=function(master,slave){var parameters=this.syncedParameters,currChain,masterChain,slaveChain,slaveChainIdx,i;if(!parameters[master])parameters[master]=[];parameters[master].push(slave);for(i=0;i<this.chains.length;i++){currChain=this.chains[i];if(currChain.indexOf(master)>-1){masterChain=currChain;}
if(currChain.indexOf(slave)>-1){slaveChain=currChain;slaveChainIdx=i;}}
if(slaveChain&&masterChain){if(masterChain!=slaveChain){args=slaveChain.slice();args.unshift(0);args.unshift(masterChain.length);[].splice.apply(masterChain,args);this.chains.splice(slaveChainIdx,1);}}else if(slaveChain){slaveChain.unshift(master);}else if(masterChain){masterChain.push(slave)}else{this.chains.push([master,slave]);}}
Dashboards.syncParametersInit=function(){var parameters=this.syncedParameters,i,j,k,master,slave;for(i=0;i<this.chains.length;i++){for(j=0;j<this.chains[i].length;j++){var master=this.chains[i][j];if(!parameters[master])continue;for(k=0;k<parameters[master].length;k++){slave=parameters[master][k];this.syncParameters(master,slave);}}}}
Dashboards.initEngine=function(){var myself=this;var components=this.components;this.incrementRunningCalls();if(this.logLifecycle&&typeof console!="undefined"){console.log("%c          [Lifecycle >Start] Init (Running: "+this.getRunningCalls()+")","color: #ddd ");}
this.createAndCleanErrorDiv();if(typeof this.preInit=='function'){this.preInit();}
this.trigger("cdf cdf:preInit",this);$(window).trigger('cdfAboutToLoad');var myself=this;var updating=[],i;for(i=0;i<components.length;i++){if(components[i].executeAtStart){updating.push(components[i]);}}
if(!updating.length){this.handlePostInit();return;}
var postInitComponent={name:"PostInitMarker",type:"unmanaged",lifecycle:{silent:true},executeAtStart:true,priority:999999999};this.bindControl(postInitComponent)
updating.push(postInitComponent);this.waitingForInit=updating.slice();var callback=function(comp,isExecuting){if(arguments.length==2&&isExecuting){return;}
this.waitingForInit=_(this.waitingForInit).without(comp);comp.off('cdf:postExecution',callback);comp.off('cdf:preExecution',callback);comp.off('cdf:error',callback);this.handlePostInit();}
for(var i=0,len=updating.length;i<len;i++){var component=updating[i];component.on('cdf:postExecution cdf:preExecution cdf:error',callback,myself);}
Dashboards.updateAll(updating);if(components.length>0){myself.handlePostInit();}};Dashboards.handlePostInit=function(){if(!this.waitingForInit||this.waitingForInit.length===0){this.trigger("cdf cdf:postInit",this);$(window).trigger('cdfLoaded');if(typeof this.postInit=="function"){this.postInit();}
this.restoreDuplicates();this.finishedInit=true;this.decrementRunningCalls();if(this.logLifecycle&&typeof console!="undefined"){console.log("%c          [Lifecycle <End  ] Init (Running: "+this.getRunningCalls()+")","color: #ddd ");}}};Dashboards.resetAll=function(){this.createAndCleanErrorDiv();var compCount=this.components.length;for(var i=0,len=this.components.length;i<len;i++){this.components[i].clear();}
var compCount=this.components.length;for(var i=0,len=this.components.length;i<len;i++){if(this.components[i].executeAtStart){this.update(this.components[i]);}}};Dashboards.processChange=function(object_name){var object=this.getComponentByName(object_name);var parameter=object.parameter;var value;if(typeof object['getValue']=='function'){value=object.getValue();}
if(value==null)
return;if(!(typeof(object.preChange)=='undefined')){var preChangeResult=object.preChange(value);value=preChangeResult!=undefined?preChangeResult:value;}
if(parameter){this.fireChange(parameter,value);}
if(!(typeof(object.postChange)=='undefined')){object.postChange(value);}};Dashboards.fireChange=function(parameter,value){var myself=this;this.createAndCleanErrorDiv();this.setParameter(parameter,value);this.parameterModel.change();var toUpdate=[];var workDone=false;for(var i=0,len=this.components.length;i<len;i++){if($.isArray(this.components[i].listeners)){for(var j=0;j<this.components[i].listeners.length;j++){var comp=this.components[i];if(comp.listeners[j]==parameter&&!comp.disabled){toUpdate.push(comp);break;}}}}
myself.updateAll(toUpdate);};Dashboards.updateAll=function(components){if(!this.updating){this.updating={tiers:{},current:null};}
if(components&&_.isArray(components)&&!_.isArray(components[0])){var comps={};_.each(components,function(c){var prio=c.priority||0;if(!comps[prio]){comps[prio]=[];}
comps[prio].push(c);});components=comps;}
this.mergePriorityLists(this.updating.tiers,components);var updating=this.updating.current;if(updating===null||updating.components.length==0){var toUpdate=this.getFirstTier(this.updating.tiers);if(!toUpdate)return;this.updating.current=toUpdate;var postExec=function(component,isExecuting){if(arguments.length==2&&typeof isExecuting=="boolean"&&isExecuting){return;}
component.off("cdf:postExecution",postExec);component.off("cdf:preExecution",postExec);component.off("cdf:error",postExec);var current=this.updating.current;current.components=_.without(current.components,component);var tiers=this.updating.tiers;tiers[current.priority]=_.without(tiers[current.priority],component);this.updateAll();}
var comps=this.updating.current.components.slice();for(var i=0;i<comps.length;i++){component=comps[i];component.startTimer();component.on("cdf:postExecution cdf:preExecution cdf:error",postExec,this);this.updateComponent(component);}}}
Dashboards.getFirstTier=function(tiers){var keys=_.keys(tiers).sort(function(a,b){return parseInt(a,10)-parseInt(b,10);}),i,tier;for(i=0;i<keys.length;i++){tier=tiers[keys[i]];if(tier.length>0){return{priority:keys[i],components:tier.slice()};}}
return null;}
Dashboards.mergePriorityLists=function(target,source){if(!source){return;}
for(var key in source)if(source.hasOwnProperty(key)){if(_.isArray(target[key])){target[key]=_.union(target[key],source[key]);}else{target[key]=source[key];}}}
Dashboards.restoreView=function(){var p,params;if(!this.view)return;params=JSON.parse(Base64.decode(this.view.params));for(p in params)if(params.hasOwnProperty(p)){this.setParameter(p,params[p]);}};Dashboards.getHashValue=function(key){var hash=window.location.hash,obj;try{obj=JSON.parse(hash.slice(1));}catch(e){obj={};}
if(arguments.length===0){return obj;}else{return obj[key];}}
Dashboards.setHashValue=function(key,value){var obj=this.getHashValue(),json;if(arguments.length==1){obj=key;}else{obj[key]=value;}
json=JSON.stringify(obj);if(json!="{}"){window.location.hash=json;}else{if(window.location.hash){window.location.hash='';}}}
Dashboards.deleteHashValue=function(key){var obj=this.getHashValue();if(arguments.length===0){window.location.hash="";}else{delete obj[key];this.setHashValue(obj);}}
Dashboards.setBookmarkable=function(parameter,value){if(!this.bookmarkables)this.bookmarkables={};if(arguments.length===1)value=true;this.bookmarkables[parameter]=value;};Dashboards.isBookmarkable=function(parameter){if(!this.bookmarkables){return false;}
return Boolean(this.bookmarkables[parameter]);};Dashboards.generateBookmarkState=function(){var params={},bookmarkables=this.bookmarkables;for(var k in bookmarkables)if(bookmarkables.hasOwnProperty(k)){if(bookmarkables[k]){params[k]=this.getParameterValue(k);}}
return params;};Dashboards.persistBookmarkables=function(param){var bookmarkables=this.bookmarkables,params={};if(!bookmarkables||!bookmarkables[param]){return;}
if(!this.finishedInit){return;}
params=this.generateBookmarkState();this.setBookmarkState({impl:'client',params:params});}
Dashboards.setBookmarkState=function(state){if(window.history&&window.history.replaceState){var method=window.location.pathname.split('/').pop(),query=window.location.search.slice(1).split('&').map(function(e){var entry=e.split('=');entry[1]=decodeURIComponent(entry[1]);return entry;}),url;query=this.propertiesArrayToObject(query);query.bookmarkState=JSON.stringify(state);url=method+'?'+$.param(query);window.history.replaceState({},'',url);this.deleteHashValue('bookmark');}else{this.setHashValue('bookmark',state);}};Dashboards.getBookmarkState=function(){if(window.location.hash.length>1){try{return this.getHashValue('bookmark')||{};}catch(e){}}
var query=window.location.search.slice(1).split('&').map(function(e){var pair=e.split('=');pair[1]=decodeURIComponent(pair[1]);return pair;}),params=this.propertiesArrayToObject(query);if(params.bookmarkState){return JSON.parse(decodeURIComponent(params.bookmarkState.replace(/\+/g,' ')))||{};}else{return{};}};Dashboards.restoreBookmarkables=function(){var state;this.bookmarkables=this.bookmarkables||{};try{state=this.getBookmarkState().params;for(var k in state)if(state.hasOwnProperty(k)){this.setParameter(k,state[k]);}}catch(e){this.log(e,'error');}}
Dashboards.setParameterViewMode=function(parameter,value){if(!this.viewParameters)this.viewParameters={};if(arguments.length===1)value=this.viewFlags.VIEW;this.viewParameters[parameter]=value;};Dashboards.isViewParameter=function(parameter){if(!this.viewParameters){return false;}
return this.viewParameters[parameter];};Dashboards.getViewParameters=function(){if(!this.viewParameters)return{};var params=this.viewParameters,ret={};for(var p in params)if(params.hasOwnProperty(p)){if(params[p]==this.viewFlags.VIEW||params[p]==this.viewFlags.UNBOUND){ret[p]=this.getParameterValue(p);}}
return ret;};Dashboards.getUnboundParameters=function(){if(!this.viewParameters)return[];var params=this.viewParameters,ret=[]
for(var p in params)if(params.hasOwnProperty(p)){if(params[p]==this.viewFlags.UNBOUND){ret.push(p);}
return ret;}};Dashboards.getParameterValue=function(parameterName){if(this.globalContext){try{return eval(parameterName);}
catch(e){this.error(e);}}else{return this.parameters[parameterName];}};Dashboards.getQueryParameter=function(parameterName){var queryString=window.location.search.substring(1);var parameterName=parameterName+"=";if(queryString.length>0){var begin=queryString.indexOf(parameterName);if(begin!=-1){begin+=parameterName.length;var end=queryString.indexOf("&",begin);if(end==-1){end=queryString.length}
return decodeURIComponent(queryString.substring(begin,end));}
return"";}};Dashboards.setParameter=function(parameterName,parameterValue){if(parameterName==undefined||parameterName=="undefined"){this.log('Dashboards.setParameter: trying to set undefined!!','warn');return;}
if(this.globalContext){eval(parameterName+" = "+JSON.stringify(parameterValue));}else{if(this.escapeParameterValues){this.parameters[parameterName]=encode_prepare_arr(parameterValue);}else{this.parameters[parameterName]=parameterValue;}}
this.parameterModel.set(parameterName,parameterValue,{silent:true});this.persistBookmarkables(parameterName);};Dashboards.post=function(url,obj){var form='<form action="'+url+'" method="post">';for(var o in obj){var v=(typeof obj[o]=='function'?obj[o]():obj[o]);if(typeof v=='string'){v=v.replace(/"/g,"\'")}
form+='"<input type="hidden" name="'+o+'" value="'+v+'"/>';}
form+='</form>';jQuery(form).appendTo('body').submit().remove();};Dashboards.clone=function clone(obj){var c=obj instanceof Array?[]:{};for(var i in obj){var prop=obj[i];if(typeof prop=='object'){if(prop instanceof Array){c[i]=[];for(var j=0;j<prop.length;j++){if(typeof prop[j]!='object'){c[i].push(prop[j]);}else{c[i].push(this.clone(prop[j]));}}}else{c[i]=this.clone(prop);}}else{c[i]=prop;}}
return c;};Dashboards.getArgValue=function(key)
{for(i=0;i<this.args.length;i++){if(this.args[i][0]==key){return this.args[i][1];}}
return undefined;};Dashboards.ev=function(o){return typeof o=='function'?o():o};Dashboards.callPentahoAction=function(obj,solution,path,action,parameters,callback){var myself=this;if(typeof callback=='function'){return this.pentahoAction(solution,path,action,parameters,function(json){callback(myself.parseXActionResult(obj,json));});}
else{return this.parseXActionResult(obj,this.pentahoAction(solution,path,action,parameters,callback));}};Dashboards.urlAction=function(url,params,func){return this.executeAjax('xml',url,params,func);};Dashboards.executeAjax=function(returnType,url,params,func){var myself=this;if(typeof func=="function"){return $.ajax({url:url,type:"POST",dataType:returnType,async:true,data:params,complete:function(XMLHttpRequest,textStatus){func(XMLHttpRequest.responseXML);},error:function(XMLHttpRequest,textStatus,errorThrown){myself.log("Found error: "+XMLHttpRequest+" - "+textStatus+", Error: "+errorThrown,"error");}});}
var result=$.ajax({url:url,type:"POST",dataType:returnType,async:false,data:params,error:function(XMLHttpRequest,textStatus,errorThrown){myself.log("Found error: "+XMLHttpRequest+" - "+textStatus+", Error: "+errorThrown,"error");}});if(returnType=='xml'){return result.responseXML;}else{return result.responseText;}};Dashboards.pentahoAction=function(solution,path,action,params,func){return this.pentahoServiceAction('ServiceAction','xml',solution,path,action,params,func);};Dashboards.pentahoServiceAction=function(serviceMethod,returntype,solution,path,action,params,func){var url=webAppPath+"/"+serviceMethod;var arr={};arr.wrapper=false;arr.solution=solution;arr.path=path;arr.action=action;$.each(params,function(i,val){arr[val[0]]=val[1];});return this.executeAjax(returntype,url,arr,func);};Dashboards.parseXActionResult=function(obj,html){var jXML=$(html);var error=jXML.find("SOAP-ENV\\:Fault");if(error.length==0){return jXML;}
var errorMessage="Error executing component "+obj.name;var errorDetails=new Array();errorDetails[0]=" Error details for component execution "+obj.name+" -- ";errorDetails[1]=error.find("SOAP-ENV\\:faultstring").find("SOAP-ENV\\:Text:eq(0)").text();error.find("SOAP-ENV\\:Detail").find("message").each(function(){errorDetails.push($(this).text())});if(errorDetails.length>8){errorDetails=errorDetails.slice(0,7);errorDetails.push("...");}
var out="<table class='errorMessageTable' border='0'><tr><td><img src='"+ERROR_IMAGE+"'></td><td><span class=\"cdf_error\" title=\" "+errorDetails.join('<br/>').replace(/"/g,"'")+"\" >"+errorMessage+" </span></td></tr></table/>";if(obj.visible==false){$("#"+CDF_ERROR_DIV).append("<br />"+out);}
else{$('#'+obj.htmlObject).html(out);}
return null;};Dashboards.setSettingsValue=function(name,object){var data={method:"set",key:name,value:JSON.stringify(object)};$.post("Settings",data,function(){});};Dashboards.getSettingsValue=function(key,value){var callback=typeof value=='function'?value:function(json){value=json;};$.getJSON("Settings?method=get&key="+key,callback);};Dashboards.fetchData=function(cd,params,callback){this.log('Dashboards.fetchData() is deprecated. Use Query objects instead','warn');if(cd!=undefined&&cd.dataAccessId!=undefined){for(var param in params){cd['param'+params[param][0]]=this.getParameterValue(params[param][1]);}
$.post(webAppPath+"/content/cda/doQuery?",cd,function(json){callback(json);},'json').error(Dashboards.handleServerError);}
else if(cd!=undefined){var xactionFile=(cd.queryType=='cda')?"jtable-cda.xaction":"jtable.xaction";$.post(webAppPath+"/ViewAction?solution=system&path=pentaho-cdf/actions&action="+xactionFile,cd,function(result){callback(result.values);},'json');}
else{callback([]);}};Dashboards.escapeHtml=function(input){var escaped=input.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&#34;");return escaped;};Dashboards.storage={};Dashboards.loadStorage=function(){var myself=this;if(this.context&&this.context.user==="anonymousUser"){return;}
var args={action:"read",_:(new Date()).getTime()};$.getJSON(webAppPath+"/content/pentaho-cdf/Storage",args,function(json){$.extend(myself.storage,json);});};Dashboards.saveStorage=function(){var myself=this;if(this.context&&this.context.user==="anonymousUser"){return;}
var args={action:"store",storageValue:JSON.stringify(this.storage),_:(new Date()).getTime()};$.getJSON(webAppPath+"/content/pentaho-cdf/Storage",args,function(json){if(json.result!=true){myself.log("Error saving storage",'error');}});};Dashboards.cleanStorage=function(){var myself=this;this.storage={};if(this.context&&this.context.user==="anonymousUser"){return;}
var args={action:"delete"};$.getJSON(webAppPath+"/content/pentaho-cdf/Storage",args,function(json){if(json.result!=true){myself.log("Error deleting storage",'error');}});};Dashboards.propertiesArrayToObject=function(pArray){var obj={};for(var p in pArray)if(pArray.hasOwnProperty(p)){var prop=pArray[p];obj[prop[0]]=prop[1];}
return obj;}
Dashboards.objectToPropertiesArray=function(obj){var pArray=[];for(var key in obj)if(obj.hasOwnProperty(key)){pArray.push([key,obj[key]]);}
return pArray;}
Dashboards.hsvToRgb=function(h,s,v){s=s/100;v=v/100;var hi=Math.floor((h/60)%6);var f=(h/60)-hi;var p=v*(1-s);var q=v*(1-f*s);var t=v*(1-(1-f)*s);var rgb=[];switch(hi){case 0:rgb=[v,t,p];break;case 1:rgb=[q,v,p];break;case 2:rgb=[p,v,t];break;case 3:rgb=[p,q,v];break;case 4:rgb=[t,p,v];break;case 5:rgb=[v,p,q];break;}
var r=Math.min(255,Math.round(rgb[0]*256)),g=Math.min(255,Math.round(rgb[1]*256)),b=Math.min(255,Math.round(rgb[2]*256));return"rgb("+[r,g,b].join(",")+")";}
function encode_prepare_arr(value){if(typeof value=="number"){return value;}else if($.isArray(value)){var a=new Array(value.length);$.each(value,function(i,val){a[i]=encode_prepare(val);});return a;}
else{return encode_prepare(value);}};function encode_prepare(s)
{if(s!=null){s=s.replace(/\+/g," ");if($.browser=="msie"||$.browser=="opera"){return Utf8.decode(s);}}
return s;};var Utf8={encode:function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c);}
else if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128);}
else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128);}}
return utftext;},decode:function(utftext){var string="";var i=0;var c=0,c2=0,c3=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++;}
else if((c>191)&&(c<224)){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode(((c&31)<<6)|(c2&63));i+=2;}
else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode(((c&15)<<12)|((c2&63)<<6)|(c3&63));i+=3;}}
return string;}}
function getURLParameters(sURL)
{if(sURL.indexOf("?")>0){var arrParams=sURL.split("?");var arrURLParams=arrParams[1].split("&");var arrParam=[];for(var i=0;i<arrURLParams.length;i++){var sParam=arrURLParams[i].split("=");if(sParam[0].indexOf("param",0)==0){var parameter=[sParam[0].substring(5,sParam[0].length),unescape(sParam[1])];arrParam.push(parameter);}}}
return arrParam;}
function toFormatedString(value){value+='';var x=value.split('.');var x1=x[0];var x2=x.length>1?'.'+x[1]:'';var rgx=/(\d+)(\d{3})/;while(rgx.test(x1))
x1=x1.replace(rgx,'$1'+','+'$2');return x1+x2;}
function doCsvQuoting(value,separator,alwaysEscape){var QUOTE_CHAR='"';if(separator==null){return value;}
if(value==null){return null;}
if(value.indexOf(QUOTE_CHAR)>=0){value=value.replace(QUOTE_CHAR,QUOTE_CHAR.concat(QUOTE_CHAR));}
if(alwaysEscape||value.indexOf(separator)>=0){value=QUOTE_CHAR.concat(value,QUOTE_CHAR);}
return value;}
sprintfWrapper={init:function(){if(typeof arguments=='undefined'){return null;}
if(arguments.length<1){return null;}
if(typeof arguments[0]!='string'){return null;}
if(typeof RegExp=='undefined'){return null;}
var string=arguments[0];var exp=new RegExp(/(%([%]|(\-)?(\+|\x20)?(0)?(\d+)?(\.(\d)?)?([bcdfosxX])))/g);var matches=new Array();var strings=new Array();var convCount=0;var stringPosStart=0;var stringPosEnd=0;var matchPosEnd=0;var newString='';var match=null;while((match=exp.exec(string))){if(match[9]){convCount+=1;}
stringPosStart=matchPosEnd;stringPosEnd=exp.lastIndex-match[0].length;strings[strings.length]=string.substring(stringPosStart,stringPosEnd);matchPosEnd=exp.lastIndex;var negative=parseInt(arguments[convCount])<0;if(!negative)negative=parseFloat(arguments[convCount])<0;matches[matches.length]={match:match[0],left:match[3]?true:false,sign:match[4]||'',pad:match[5]||' ',min:match[6]||0,precision:match[8],code:match[9]||'%',negative:negative,argument:String(arguments[convCount])};}
strings[strings.length]=string.substring(matchPosEnd);if(matches.length==0){return string;}
if((arguments.length-1)<convCount){return null;}
match=null;var i=null;for(i=0;i<matches.length;i++){var m=matches[i];var substitution;if(m.code=='%'){substitution='%'}
else if(m.code=='b'){m.argument=String(Math.abs(parseInt(m.argument)).toString(2));substitution=sprintfWrapper.convert(m,true);}
else if(m.code=='c'){m.argument=String(String.fromCharCode(parseInt(Math.abs(parseInt(m.argument)))));substitution=sprintfWrapper.convert(m,true);}
else if(m.code=='d'){m.argument=toFormatedString(String(Math.abs(parseInt(m.argument))));substitution=sprintfWrapper.convert(m);}
else if(m.code=='f'){m.argument=toFormatedString(String(Math.abs(parseFloat(m.argument)).toFixed(m.precision?m.precision:6)));substitution=sprintfWrapper.convert(m);}
else if(m.code=='o'){m.argument=String(Math.abs(parseInt(m.argument)).toString(8));substitution=sprintfWrapper.convert(m);}
else if(m.code=='s'){m.argument=m.argument.substring(0,m.precision?m.precision:m.argument.length)
substitution=sprintfWrapper.convert(m,true);}
else if(m.code=='x'){m.argument=String(Math.abs(parseInt(m.argument)).toString(16));substitution=sprintfWrapper.convert(m);}
else if(m.code=='X'){m.argument=String(Math.abs(parseInt(m.argument)).toString(16));substitution=sprintfWrapper.convert(m).toUpperCase();}
else{substitution=m.match;}
newString+=strings[i];newString+=substitution;}
newString+=strings[i];return newString;},convert:function(match,nosign){if(nosign){match.sign='';}else{match.sign=match.negative?'-':match.sign;}
var l=match.min-match.argument.length+1-match.sign.length;var pad=new Array(l<0?0:l).join(match.pad);if(!match.left){if(match.pad=='0'||nosign){return match.sign+pad+match.argument;}else{return pad+match.sign+match.argument;}}else{if(match.pad=='0'||nosign){return match.sign+match.argument+pad.replace(/0/g,' ');}else{return match.sign+match.argument+pad;}}}}
sprintf=sprintfWrapper.init;Dashboards.normalizeAddInKey=function(key){if(key.indexOf('Component',key.length-'Component'.length)!==-1)
key=key.substring(0,key.length-'Component'.length);return key.charAt(0).toUpperCase()+key.substring(1);}
Dashboards.registerAddIn=function(component,slot,addIn){if(!this.addIns){this.addIns={};}
var key=this.normalizeAddInKey(component);if(!this.addIns[key]){this.addIns[key]={};}
if(!this.addIns[key][slot]){this.addIns[key][slot]={};}
this.addIns[key][slot][addIn.getName()]=addIn;};Dashboards.hasAddIn=function(component,slot,addIn){var key=this.normalizeAddInKey(component);return Boolean(this.addIns&&this.addIns[key]&&this.addIns[key][slot]&&this.addIns[key][slot][addIn]);};Dashboards.getAddIn=function(component,slot,addIn){var key=this.normalizeAddInKey(component);try{return this.addIns[key][slot][addIn];}catch(e){return null;}};Dashboards.setAddInDefaults=function(component,slot,addInName,defaults){var key=this.normalizeAddInKey(component);var addIn=this.getAddIn(key,slot,addInName);if(addIn){addIn.setDefaults(defaults);}};Dashboards.listAddIns=function(component,slot){var key=this.normalizeAddInKey(component);var addInList=[];try{slot=this.addIns[key][slot];for(var addIn in slot)if(slot.hasOwnProperty(addIn)){addInList.push([addIn,slot[addIn].getLabel()]);}
return addInList;}catch(e){return[];}};Dashboards.safeClone=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2;}
if(typeof target!=="object"&&!jQuery.isFunction(target)){target={};}
for(;i<length;i++){if((options=arguments[i])!=null){for(name in options)if(options.hasOwnProperty(name)){src=target[name];copy=options[name];if(target===copy){continue;}
if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[];}else{clone=src&&jQuery.isPlainObject(src)?src:{};}
target[name]=this.safeClone(deep,clone,copy);}else if(copy!==undefined){target[name]=copy;}}}}
return target;}
Query=function(){var CDA_PATH=webAppPath+"/content/cda/doQuery?";var LEGACY_QUERY_PATH=webAppPath+"/ViewAction?solution=system&path=pentaho-cdf/actions&action=jtable.xaction";var _ajaxOptions={type:"POST",async:false};var _mode='CDA';var _file='';var _id='';var _outputIdx='1';var _query='';var _callback=null;var _errorCallback=Dashboards.handleServerError;var _lastResultSet=null;var _page=0;var _pageSize=0;var _sortBy="";var _exportIframe=null;var _params=[];(function(args){switch(args.length){case 1:var cd=args[0];if(typeof cd.query!='undefined'){_mode='Legacy';_query=args[0];}else if(typeof cd.path!='undefined'&&typeof cd.dataAccessId!='undefined'){_mode='CDA';_file=cd.path;_id=cd.dataAccessId;if(typeof cd.sortBy=='string'&&cd.sortBy.match("^(?:[0-9]+[adAD]?,?)*$")){_sortBy=cd.sortBy;}
if(cd.pageSize!=null){_pageSize=cd.pageSize;}
if(cd.outputIndexId!=null){_outputIdx=cd.outputIndexId;}}else{throw'InvalidQuery';}
break;case 2:_mode='CDA';var file=args[0];var id=args[1];if(typeof file!='string'||typeof id!='string'){throw'InvalidQuery';}else{_id=id;_file=file;}
break;default:throw"InvalidQuery";}}(arguments));function doQuery(outsideCallback){if(typeof _callback!='function'){throw'QueryNotInitialized';}
var url;var queryDefinition;var callback=(outsideCallback?outsideCallback:_callback);var errorCallback=_errorCallback;if(_mode=='CDA'){url=CDA_PATH;queryDefinition=buildQueryDefinition();}else if(_mode=='Legacy'){queryDefinition=_query;url=LEGACY_QUERY_PATH;}
var successHandler=function(json){if(_mode=='Legacy'){try{json=eval("("+json+")");}catch(e){if(this.async){var msg=Dashboards.getErrorObj('COMPONENT_ERROR').msg+":"+e.message;Dashboards.error(msg);json={"metadata":[msg],"values":[]};}else{throw e;}}}
_lastResultSet=json;var clone=Dashboards.safeClone(true,{},_lastResultSet);if(_mode=='Legacy'){var newMetadata=[{"colIndex":0,"colType":"String","colName":"Name"}];for(var i=0;i<clone.metadata.length;i++){var x=i;newMetadata.push({"colIndex":x+1,"colType":"String","colName":clone.metadata[x]});}
clone.resultset=clone.values;clone.metadata=newMetadata;clone.values=null;}
callback(clone);};var errorHandler=function(resp,txtStatus,error){if(errorCallback){errorCallback(resp,txtStatus,error);}};var settings=_.extend({},_ajaxOptions,{data:queryDefinition,url:url,success:successHandler,error:errorHandler});$.ajax(settings);}
function buildQueryDefinition(overrides){overrides=overrides||{};var queryDefinition={};var p=Dashboards.objectToPropertiesArray(Dashboards.safeClone({},Dashboards.propertiesArrayToObject(_params),overrides))
for(var param in p){if(p.hasOwnProperty(param)){var value;var name=p[param][0];value=Dashboards.getParameterValue(p[param][1]);if($.isArray(value)&&value.length==1&&(''+value[0]).indexOf(';')>=0){value=doCsvQuoting(value[0],';');}
if(typeof value=='function')value=value();queryDefinition['param'+name]=value;}}
queryDefinition.path=_file;queryDefinition.dataAccessId=_id;queryDefinition.outputIndexId=_outputIdx;queryDefinition.pageSize=_pageSize;queryDefinition.pageStart=_page;queryDefinition.sortBy=_sortBy;return queryDefinition;}
this.exportData=function(outputType,overrides,options){if(_mode!='CDA'){throw"UnsupportedOperation";}
if(!options){options={};}
var queryDefinition=buildQueryDefinition(overrides);queryDefinition.outputType=outputType;if(outputType=='csv'&&options.separator){queryDefinition.settingcsvSeparator=options.separator;}
if(options.filename){queryDefinition.settingattachmentName=options.filename;}
if(outputType=='xls'&&options.template){queryDefinition.settingtemplateName=options.template;}
if(options.columnHeaders){queryDefinition.settingcolumnHeaders=options.columnHeaders;}
if(options.dtFilter!=null){queryDefinition.settingdtFilter=options.dtFilter;if(options.dtSearchableColumns!=null){queryDefinition.settingdtSearchableColumns=options.dtSearchableColumns;}}
var theDoQuery=CDA_PATH+'wrapItUp=wrapit';var x=$.ajaxSettings.async;$.ajaxSetup({async:false});$.post(theDoQuery,queryDefinition,function(uuid){var _exportIframe=$('<iframe style="display:none">');_exportIframe.detach();_exportIframe[0].src=webAppPath+'/content/cda/unwrapQuery?'+$.param({"path":queryDefinition.path,"uuid":uuid});_exportIframe.appendTo($('body'));});$.ajaxSetup({async:x});};this.setAjaxOptions=function(newOptions){if(typeof newOptions=="object"){_.extend(_ajaxOptions,newOptions);}};this.fetchData=function(params,successCallback,errorCallback){switch(arguments.length){case 0:if(_params&&_callback){return doQuery();}
break;case 1:if(typeof arguments[0]=="function"){return doQuery(arguments[0]);}else if(arguments[0]instanceof Array){_params=arguments[0];return doQuery();}
break;case 2:if(typeof arguments[0]=="function"){_callback=arguments[0];_errorCallback=arguments[1];return doQuery();}else{_params=arguments[0];_callback=arguments[1];return doQuery();}
break;default:_params=params;_callback=successCallback;_errorCallback=errorCallback;return doQuery();}
throw"InvalidInput";};this.lastResults=function(){if(_lastResultSet!==null){return Dashboards.safeClone(true,{},_lastResultSet);}else{throw"NoCachedResults";}};this.reprocessLastResults=function(outerCallback){if(_lastResultSet!==null){var clone=Dashboards.safeClone(true,{},_lastResultSet);var callback=outerCallback||_callback;return callback(clone);}else{throw"NoCachedResults";}};this.reprocessResults=function(outsideCallback){if(_lastResultSet!==null){var clone=Dashboards.safeClone(true,{},_lastResultSet);var callback=(outsideCallback?outsideCallback:_callback);callback(_mode=='CDA'?clone:clone.values);}else{throw"NoCachedResults";}};this.setSortBy=function(sortBy){var newSort;if(sortBy===null||sortBy===undefined||sortBy===''){newSort='';}
else if(typeof sortBy=="string"){if(!sortBy.match("^(?:[0-9]+[adAD]?,?)*$")){throw"InvalidSortExpression";}
newSort=sortBy.toUpperCase().split(',').filter(function(e){return e!=="";});}else if(sortBy instanceof Array){newSort=sortBy.map(function(d){return d.toUpperCase();});var invalidEntries=newSort.filter(function(e){return!e.match("^[0-9]+[adAD]?,?$")});if(invalidEntries.length>0){throw"InvalidSortExpression";}}
var same;if(newSort instanceof Array){same=newSort.length!=_sortBy.length;$.each(newSort,function(i,d){same=(same&&d==_sortBy[i]);if(!same){return false;}});}else{same=(newSort===_sortBy);}
_sortBy=newSort;return!same;};this.sortBy=function(sortBy,outsideCallback){var changed=this.setSortBy(sortBy);if(!changed){return false;}else if(_callback!==null){return doQuery(outsideCallback);}};this.setParameters=function(params){if((params instanceof Array)){_params=params;}else{throw"InvalidParameters";}};this.setCallback=function(callback){if(typeof callback=="function"){_callback=callback;}else{throw"InvalidCallback";}};this.nextPage=function(outsideCallback){if(_pageSize>0){_page+=_pageSize;return doQuery(outsideCallback);}else{throw"InvalidPageSize";}};this.prevPage=function(outsideCallback){if(_page>_pageSize){_page-=_pageSize;return doQuery(outsideCallback);}else if(_pageSize>0){_page=0;return doQuery(outsideCallback);}else{throw"AtBeggining";}};this.getPage=function(page,outsideCallback){if(page*_pageSize==_page){return false;}else if(typeof page=='number'&&page>=0){_page=page*_pageSize;return doQuery(outsideCallback);}else{throw"InvalidPage";}};this.setPageStartingAt=function(page){if(page==_page){return false;}else if(typeof page=='number'&&page>=0){_page=page;}else{throw"InvalidPage";}};this.pageStartingAt=function(page,outsideCallback){if(this.setPageStartingAt(page)!==false){return doQuery(outsideCallback);}else{return false;}};this.setPageSize=function(pageSize){if(typeof pageSize=='number'&&pageSize>0){_pageSize=pageSize;}else{throw"InvalidPageSize";}};this.initPage=function(pageSize,outsideCallback){if(pageSize==_pageSize&&_page==0){return false;}else if(typeof pageSize=='number'&&pageSize>0){_page=0;_pageSize=pageSize;return doQuery(outsideCallback);}else{throw"InvalidPageSize";}};};(function(){function accessorDescriptor(field,fun)
{var desc={enumerable:true,configurable:true};desc[field]=fun;return desc;}
this.defineGetter=function defineGetter(obj,prop,get)
{if(Object.prototype.__defineGetter__)
return obj.__defineGetter__(prop,get);if(Object.defineProperty)
return Object.defineProperty(obj,prop,accessorDescriptor("get",get));throw new Error("browser does not support getters");}
this.defineSetter=function defineSetter(obj,prop,set)
{if(Object.prototype.__defineSetter__)
return obj.__defineSetter__(prop,set);if(Object.defineProperty)
return Object.defineProperty(obj,prop,accessorDescriptor("set",set));throw new Error("browser does not support setters");}})();var wd=wd||{};wd.cdf=wd.cdf||{};wd.cdf.popups=wd.cdf.popups||{};wd.cdf.popups.okPopup={template:Mustache.compile("<div class='cdfPopup'>"+"  <div class='cdfPopupHeader'>{{{header}}}</div>"+"  <div class='cdfPopupBody'>"+"    <div class='cdfPopupDesc'>{{{desc}}}</div>"+"    <div class='cdfPopupButton'>{{{button}}}</div>"+"  </div>"+"</div>"),defaults:{header:"Title",desc:"Description Text",button:"Button Text",callback:function(){return true}},$el:undefined,show:function(opts){if(opts||this.firstRender){this.render(opts);}
this.$el.show();},hide:function(){this.$el.hide();},render:function(newOpts){var opts=_.extend({},this.defaults,newOpts);var myself=this;if(this.firstRender){this.$el=$('<div/>').addClass('cdfPopupContainer').hide().appendTo('body');this.firstRender=false;};this.$el.empty().html(this.template(opts));this.$el.find('.cdfPopupButton').click(function(){opts.callback();myself.hide();});},firstRender:true};wd.cdf.notifications=wd.cdf.notifications||{};wd.cdf.notifications.component={template:Mustache.compile("<div class='cdfNotification component {{#isSmallComponent}}small{{/isSmallComponent}}'>"+"  <div class='cdfNotificationBody'>"+"    <div class='cdfNotificationImg'>&nbsp;</div>"+"    <div class='cdfNotificationTitle' title='{{title}}'>{{{title}}}</div>"+"    <div class='cdfNotificationDesc' title='{{desc}}'>{{{desc}}}</div>"+"  </div>"+"</div>"),defaults:{title:"Component Error",desc:"Error processing component."},render:function(ph,newOpts){var opts=_.extend({},this.defaults,newOpts);opts.isSmallComponent=($(ph).width()<300);$(ph).empty().html(this.template(opts));var $nt=$(ph).find('.cdfNotification');$nt.css({'line-height':$nt.height()+'px'});}};wd.cdf.notifications.growl={template:Mustache.compile("<div class='cdfNotification growl'>"+"  <div class='cdfNotificationBody'>"+"    <h1 class='cdfNotificationTitle' title='{{title}}'>{{{title}}}</h1>"+"    <h2 class='cdfNotificationDesc' title='{{desc}}'>{{{desc}}}</h2>"+"  </div>"+"</div>"),defaults:{title:'Title',desc:'Default CDF notification.',timeout:4000,onUnblock:function(){return true},css:$.extend({},$.blockUI.defaults.growlCSS,{position:'absolute',width:'100%',top:'10px'}),showOverlay:false,fadeIn:700,fadeOut:1000,centerY:false},render:function(newOpts){var opts=_.extend({},this.defaults,newOpts),$m=$(this.template(opts)),myself=this;opts.message=$m;var outerUnblock=opts.onUnblock;opts.onUnblock=function(){myself.$el.hide();outerUnblock.call(this);};if(this.firstRender){this.$el=$('<div/>').addClass('cdfNotificationContainer').hide().appendTo('body');this.firstRender=false;}
this.$el.show().block(opts);},firstRender:true};function AddIn(options){var myself=options;if(typeof options!="object"){throw TypeError;}
if(!options.label||!options.name||(!options.implementation&&!options.value)){throw TypeError;}
var _name=options.name,_label=options.label,_type=options.implementation?"scriptable":"static",_implementation=options.implementation,_defaults=options.defaults,_value=options.options;if(typeof options.init==='function'){options.init.call(myself);}
this.getLabel=function(){return _label;}
this.getName=function(){return _name;}
this.call=function(target,state,options){if(!_implementation){return Dashboards.clone(_value);}
options=typeof options=="function"?options(state):options;var evaluatedDefaults=typeof _defaults=="function"?_defaults(state):_defaults;var compiledOptions=jQuery.extend(true,{},evaluatedDefaults,options);try{return _implementation.call(myself,target,state,compiledOptions);}
catch(e){Dashboards.log("Addin Error ["+this.getName()+"]: "+e,"error");}};this.setDefaults=function(defaults){if(typeof defaults=='function'){_defaults=defaults;}
else{_defaults=jQuery.extend(true,{},_defaults,defaults);}};};(function(){var sparkline={name:"sparkline",label:"Sparkline",defaults:{type:'line'},init:function(){var myself=this;$.fn.dataTableExt.oSort[this.name+'-asc']=function(a,b){return myself.sort(a,b)};$.fn.dataTableExt.oSort[this.name+'-desc']=function(a,b){return myself.sort(b,a)};},sort:function(a,b){return this.sumStrArray(a)-this.sumStrArray(b);},sumStrArray:function(arr){return arr.split(',').reduce(function(prev,curr,index,array){Dashboards.log("Current "+curr+"; prev "+prev);return parseFloat(curr)+(typeof(prev)==='number'?prev:parseFloat(prev));});},implementation:function(tgt,st,opt){var t=$(tgt);t.sparkline(st.value.split(/,/),opt);t.removeClass("sparkline");}};Dashboards.registerAddIn("Table","colType",new AddIn(sparkline));var pvSparkline={name:"pvSparkline",label:"Protovis Sparkline",defaults:{height:10,strokeStyle:"#000",lineWidth:1,width:undefined,canvasMargin:2},init:function(){var myself=this;$.fn.dataTableExt.oSort[this.name+'-asc']=function(a,b){return myself.sort(a,b)};$.fn.dataTableExt.oSort[this.name+'-desc']=function(a,b){return myself.sort(b,a)};},sort:function(a,b){return this.sumStrArray(a)-this.sumStrArray(b);},sumStrArray:function(arr){return arr.split(',').reduce(function(prev,curr,index,array){Dashboards.log("Current "+curr+"; prev "+prev);return parseFloat(curr)+(typeof(prev)==='number'?prev:parseFloat(prev));});},implementation:function(tgt,st,opt){var ph=$(tgt),sparklineData=st.value,data=sparklineData.split(",");n=data.length,w=opt.width||ph.width(),h=opt.height,min=pv.min.index(data),max=pv.max.index(data);ph.empty();var container=$("<div></div>").appendTo(ph);var vis=new pv.Panel().canvas(container.get(0)).width(w).height(h).margin(opt.canvasMargin);vis.add(pv.Line).data(data).left(pv.Scale.linear(0,n-1).range(0,w).by(pv.index)).bottom(pv.Scale.linear(data).range(0,h)).strokeStyle(opt.strokeStyle).lineWidth(opt.lineWidth);vis.render();}};Dashboards.registerAddIn("Table","colType",new AddIn(pvSparkline));var dataBar={name:"dataBar",label:"Data Bar",defaults:{width:undefined,widthRatio:1,height:10,startColor:"#55A4D6",endColor:"#448FC8",backgroundImage:undefined,stroke:null,max:undefined,min:undefined,includeValue:false,absValue:true,valueFormat:function(v,format,st){return""+sprintf(format||"%.1f",v);}},init:function(){$.fn.dataTableExt.oSort[this.name+'-asc']=$.fn.dataTableExt.oSort['numeric-asc'];$.fn.dataTableExt.oSort[this.name+'-desc']=$.fn.dataTableExt.oSort['numeric-desc'];},implementation:function(tgt,st,opt){var tblMax=Math.max.apply(Math,st.tableData.map(function(e){return e[st.colIdx];})),tblMin=Math.min.apply(Math,st.tableData.map(function(e){return e[st.colIdx];}));if(opt.absValue){var max=opt.max||Math.max(Math.abs(tblMax),Math.abs(tblMin)),min=opt.min||0,val=Math.abs(parseFloat(st.value));min=Math.max(min,0);}else{var max=opt.max||Math.max(0,tblMax),min=opt.min||Math.min(0,tblMin),val=parseFloat(st.value);}
var maxTotal=max-min;var cell=$(tgt);cell.empty();var ph=$("<div>&nbsp;</div>").addClass('dataBarContainer').appendTo(cell);var wtmp=opt.width||ph.width();wtmp*=opt.widthRatio;var htmp=opt.height;var leftVal=Math.min(val,0),rightVal=Math.max(val,0);var xx=pv.Scale.linear(min,max).range(0,wtmp);var paperSize=xx(Math.min(rightVal,max))-xx(min);paperSize=(paperSize>1)?paperSize:1;var paper=Raphael(ph.get(0),paperSize,htmp);var c=paper.rect(xx(leftVal),0,xx(rightVal)-xx(leftVal),htmp);c.attr({fill:opt.backgroundImage?"url('"+opt.backgroundImage+"')":"90-"+opt.startColor+"-"+opt.endColor,stroke:opt.stroke,title:"Value: "+st.value});if(opt.includeValue){var valph=$("<span></span>").addClass('value').append(opt.valueFormat(st.value,st.colFormat,st));valph.appendTo(ph);}}};Dashboards.registerAddIn("Table","colType",new AddIn(dataBar));var trendArrow={name:"trendArrow",label:"Trend Arrows",defaults:{good:true,includeValue:false,valueFormat:function(v,format,st){return sprintf(format||"%.1f",v);},thresholds:{up:0,down:0}},init:function(){$.fn.dataTableExt.oSort[this.name+'-asc']=$.fn.dataTableExt.oSort['numeric-asc'];$.fn.dataTableExt.oSort[this.name+'-desc']=$.fn.dataTableExt.oSort['numeric-desc'];},implementation:function(tgt,st,opt){var ph=$(tgt),qualityClass=opt.good?"good":"bad",isNumeric=typeof st.value=="number"||(typeof st.value=="string"&&Number(st.value).toString()!='NaN'),trendClass=!isNumeric?"invalid":(st.value>opt.thresholds.up?"up":st.value<opt.thresholds.down?"down":"neutral");var trend=$("<div>&nbsp;</div>");trend.addClass('trend '+trendClass+' '+qualityClass);ph.empty();if(opt.includeValue){var valph=$("<div class='value'></div>").append(opt.valueFormat(st.value,st.colFormat,st));valph.appendTo(ph);}
ph.append(trend);}};Dashboards.registerAddIn("Table","colType",new AddIn(trendArrow));var link={name:"hyperlink",label:"Hyperlink",defaults:{openInNewTab:true,prependHttpIfNeeded:true,regexp:null,pattern:null,urlReference:2,labelReference:1},init:function(){$.fn.dataTableExt.oSort[this.name+'-asc']=$.fn.dataTableExt.oSort['string-asc'];$.fn.dataTableExt.oSort[this.name+'-desc']=$.fn.dataTableExt.oSort['string-desc'];},implementation:function(tgt,st,opt){var ph=$(tgt);var link,label;if(opt.pattern){var re=new RegExp(opt.pattern),results=re.exec(st.value);link=results[opt.urlReference];label=results[opt.labelReference];}else{link=st.value;label=st.value;}
if(opt.prependHttpIfNeeded&&!/^https?:\/\//.test(link)){link="http://"+link;}
if(opt.regexp==null||(new RegExp(opt.regexp).test(st.value))){var a=$("<a></a>").attr("href",link).addClass("hyperlinkAddIn");a.text(label);if(opt.openInNewTab){a.attr("target","_blank");}
ph.empty().append(a);}}};Dashboards.registerAddIn("Table","colType",new AddIn(link));var circle={name:"circle",label:"Circle",defaults:{canvasSize:10,radius:4,color:'black',title:function(st){return"Value: "+st.value;}},implementation:function(tgt,st,opt){var p=$(tgt).empty(),v=st.value,op,options={},w,paper;for(key in opt)if(opt.hasOwnProperty(key)){op=opt[key];options[key]=typeof op=='function'?op.call(this,st):op;}
w=options.canvasSize;paper=Raphael(tgt,options.canvasSize,options.canvasSize);var r=paper.circle(w/2,w/2,options.radius);r.attr({fill:options.color,opacity:1,"stroke":"none","title":options.title});}};Dashboards.registerAddIn("Table","colType",new AddIn(circle));var bullet={name:"cccBulletChart",label:"Bullet Chart",defaults:{height:40,animate:false,orientation:"horizontal",bulletSize:16,bulletSpacing:150,bulletMargin:5,bulletRanges:[30,80,100],extensionPoints:{"bulletMarker_shape":"triangle","bulletTitle_textStyle":"green","bulletMeasure_fillStyle":"black","bulletRuleLabel_font":"8px sans-serif","bulletRule_height":5}},init:function(){$.fn.dataTableExt.oSort[this.name+'-asc']=$.fn.dataTableExt.oSort['string-asc'];$.fn.dataTableExt.oSort[this.name+'-desc']=$.fn.dataTableExt.oSort['string-desc'];},sort:function(){},implementation:function(tgt,st,opt){var chartOptions=$.extend(true,{},opt);var $tgt=$(tgt);var target=$("<span></span>").appendTo($tgt.empty());var values=st.value.split(",");var data=this.getData(values);chartOptions.canvas=target.get(0);chartOptions.width=chartOptions.width||$tgt.width();chartOptions.bulletMeasures=[values[0]];chartOptions.bulletMarkers=[values[1]];var chart=new pvc.BulletChart(chartOptions);chart.setData(data,{});chart.render();},getData:function(values){var dataSet={resultset:[values],metadata:[]},i;for(i=0;i<values.length;i++){dataSet.metadata.push({colIndex:i,colType:"String",colName:""});}
return dataSet;}};Dashboards.registerAddIn("Table","colType",new AddIn(bullet));var formattedText={name:"formattedText",label:"Formatted Text",defaults:{textFormat:function(v,st){return st.colFormat?sprintf(st.colFormat,v):v;}},init:function(){$.fn.dataTableExt.oSort[this.name+'-asc']=$.fn.dataTableExt.oSort['string-asc'];$.fn.dataTableExt.oSort[this.name+'-desc']=$.fn.dataTableExt.oSort['string-desc'];},implementation:function(tgt,st,opt){var text=opt.textFormat.call(this,st.value,st,opt);$(tgt).empty().append(text);}};Dashboards.registerAddIn("Table","colType",new AddIn(formattedText));var localizedText={name:"localizedText",label:"Localized Text",defaults:{localize:function(v){return Dashboards.i18nSupport.prop(v);}},init:function(){$.fn.dataTableExt.oSort[this.name+'-asc']=$.fn.dataTableExt.oSort['string-asc'];$.fn.dataTableExt.oSort[this.name+'-desc']=$.fn.dataTableExt.oSort['string-desc'];},implementation:function(tgt,st,opt){if(typeof Dashboards.i18nSupport!=="undefined"&&Dashboards.i18nSupport!=null){var text=this.defaults.localize(st.value);$(tgt).empty().append(text);st.tableData[st.rowIdx][st.colIdx]=text;}}};Dashboards.registerAddIn("Table","colType",new AddIn(localizedText));var groupHeaders={name:"groupHeaders",label:"Group Headers",defaults:{hide:true,columnHeadersInGroups:false,replaceFirstHeader:true,textFormat:function(v,st){return st.colFormat?sprintf(st.colFormat,v):v;}},init:function(){$.fn.dataTableExt.oSort[this.name+'-asc']=$.fn.dataTableExt.oSort['string-asc'];$.fn.dataTableExt.oSort[this.name+'-desc']=$.fn.dataTableExt.oSort['string-desc'];},implementation:function(tgt,st,opt){var dt=$(tgt).parents('table').eq(0).dataTable(),visColIdx=$(tgt).index();if(opt.hide){dt.find('.groupHeaders:nth-child('+(visColIdx+1)+')').addClass('hiddenCol');}
if(opt.columnHeadersInGroups){var header=dt.find("thead").eq(0);header.find("tr").clone}
var $row=$(dt.fnGetNodes(st.rowIdx)),visRowIdx=$row.index(),count=$row.children().length,$group;if(visRowIdx===0||$row.prev().hasClass('groupHeader')||(st.value!=dt.fnGetData($row.prev().get(0))[st.colIdx])){$group=this.buildHeader(tgt,st,opt);$group.insertBefore($row);}},buildHeader:function(tgt,st,opt){var $header,$dt=$(tgt).parents('table').eq(0).dataTable(),$theader,headerText=opt.textFormat.call(this,st.value,st,opt);if(opt.columnHeadersInGroups){$theader=$dt.find("thead").eq(0);$theader.hide();$header=$("<tr>");$theader.find("tr th").each(function(i,e){var $e=$(e),newCell=$("<td>").text($e.text()).width(e.style.width);newCell.addClass($(e).hasClass("hiddenCol")?"hiddenCol":"");$header.append(newCell);});$header.find("td").eq($(tgt).index()+1).empty().append(headerText).addClass("groupName");}else{$header=$("<tr/>");$("<td/>").addClass("groupName").empty().append(headerText).attr("colspan",$(tgt).siblings().length+1).appendTo($header);}
$header.addClass("groupHeader group"+$(tgt).index());var $preSpace=$("<td>").attr("colspan",$(tgt).siblings().length+1).wrap("<tr>").parent().addClass("groupHeader preSpace");var $postSpace=$("<td>").attr("colspan",$(tgt).siblings().length+1).wrap("<tr>").parent().addClass("groupHeader postSpace");var $response=$preSpace.add($header).add($postSpace);return $response;}};Dashboards.registerAddIn("Table","colType",new AddIn(groupHeaders));var clippedText={name:"clippedText",label:"Clipped Text",defaults:{showTooltip:true,useTipsy:false,style:{}},init:function(){$.fn.dataTableExt.oSort[this.name+'-asc']=$.fn.dataTableExt.oSort['string-asc'];$.fn.dataTableExt.oSort[this.name+'-desc']=$.fn.dataTableExt.oSort['string-desc'];},implementation:function(tgt,st,opt){var $tgt=$(tgt),$container=$("<div>");$tgt.empty().append($container);$container.text(st.value).addClass("clippedText").attr("title",opt.showTooltip?st.value:"");$container.css(opt.style);if(opt.useTipsy){$container.tipsy({gravity:'s',html:false});}}};Dashboards.registerAddIn("Table","colType",new AddIn(clippedText));})();var OlapUtils={};var OlapUtils={mdxGroups:{},evolutionType:"Week"}
OlapUtils.initMdxQueryGroup=function(obj){var mdxQueryGroup=new OlapUtils.mdxQueryGroup(obj.name);for(m in obj.mdxQueries){mdxQueryGroup.addMdxQuery(obj.mdxQueries[m].name,obj.mdxQueries[m].query,obj.mdxQueries[m].dimension,obj.mdxQueries[m].axis,obj.mdxQueries[m].chart);}
OlapUtils.mdxGroups[obj.name]=mdxQueryGroup;if(("#"+obj.htmlObject+"_evolutionType")!=undefined)
$("#"+obj.htmlObject+"_evolutionType").html(mdxQueryGroup.printEvolutionType(obj.htmlObject+"_evolutionType"));return mdxQueryGroup;}
OlapUtils.updateMdxQueryGroup=function(obj){var mdxGroup=OlapUtils.mdxGroups[obj.name];if(mdxGroup==undefined){mdxGroup=OlapUtils.initMdxQueryGroup(obj);}
$("#"+obj.htmlObject).html(mdxGroup.printConditions());}
OlapUtils.buttonsDescription={"Drill Down":'Drill down to the selected value and add the condition to the other charts',"Drill Up":'Drill up and add the condition to the other charts','Focus':"Focus on this value, adding the conditions to the other charts",'Exclude':"Exclude this value from the chart","Expand":'Expand the depth of the chart, showing an extra sublevel',"Collapse":'Collapse all previous expansions to the top most level',"Reset All":'Reset all filters and conditions from this chart group, returning to the original conditions',"Cancel":"Cancel"}
OlapUtils.fireMdxGroupAction=function(mdxQueryGroup,idx,param1,param2,param3){if(param2!=undefined&&param3!=undefined){cType=Dashboards.ev(param1.chartType);if(cType=="AreaChart")
value=encode_prepare(param3);else
value=encode_prepare(param2);}
else
value=encode_prepare(param1);var mdxQueryGroup=OlapUtils.mdxGroups[mdxQueryGroup];if(value=='Others')
return;OlapUtils.lastClickedMdxQueryGroup=mdxQueryGroup;mdxQueryGroup.clickedIdx=idx;mdxQueryGroup.clickedValue=value;var clickedObj=mdxQueryGroup.mdxQueries[idx];var buttonsHash={"Drill Down":'drilldown',"Drill Up":'drillup','Focus':"focus",'Exclude':"filter","Expand":'expand',"Collapse":'collapse',"Reset All":'resetall',"Cancel":"cancel"};if(clickedObj.mdxQuery.axisDepth==0)
delete buttonsHash.Collapse;var rl=clickedObj.mdxQuery.query.rowLevels;var d=typeof rl=="function"?rl():rl;if(clickedObj.mdxQuery.axisPos+clickedObj.mdxQuery.axisDepth>=d.length-1){delete buttonsHash["Drill Down"];delete buttonsHash.Expand;}
else{delete buttonsHash.Focus;}
if(clickedObj.mdxQuery.axisPos==0)
delete buttonsHash["Drill Up"];if(clickedObj.mdxQuery.axisDepth>0){delete buttonsHash["Drill Down"];delete buttonsHash.Focus;delete buttonsHash.Exclude;}
var msg="Available conditions: <br/> <ul>";$.each(buttonsHash,function(key,value){msg+="<li>"+OlapUtils.buttonsDescription[key]+"</li>"});msg+="</ul>";$.prompt(msg,{buttons:buttonsHash,callback:OlapUtils.mdxQueryGroupActionCallback});}
OlapUtils.mdxQuery=function(hash){this.query={};this.originalHash={};this.update(hash);this.axisPos=0;this.axisDepth=0;};OlapUtils.mdxQuery.prototype.reset=function(){this.update(this.originalHash);};OlapUtils.mdxQuery.prototype.resetFilter=function(value){var rf=this.query["filters"]["rows"];var index=rf.indexOf(value);rf.splice(index,1);return index;}
OlapUtils.mdxQuery.prototype.resetFilters=function(){this.query["filters"]=Dashboards.clone((this.originalHash["filters"]||{rows:[],columns:[]}));}
OlapUtils.mdxQuery.prototype.resetCondition=function(key){delete this.query["members"][key];delete this.query["sets"][key];if(this.query["conditions"][key+"InitialValue"]!=undefined)
this.query["where"][key]=this.query["conditions"][key+"InitialValue"];else
delete this.query["where"][key];}
OlapUtils.mdxQuery.prototype.update=function(hash){this.originalHash=Dashboards.clone(hash);this.query["members"]=hash["members"]||[];this.query["sets"]=hash["sets"]||[];this.query["rows"]=hash["rows"]||"";this.query["rowDrill"]=hash["rowDrill"]||false;this.query["rowLevels"]=hash["rowLevels"]||[];this.query["orderBy"]=hash["orderBy"]||"";this.query["from"]=hash["from"]||"";this.query["columns"]=hash["columns"];this.query["columnDrill"]=hash["columnDrill"]||false;this.query["columnLevels"]=hash["columnLevels"]||[];this.query["nonEmptyRows"]=hash["nonEmptyRows"]&&true;this.query["nonEmptyColumns"]=hash["nonEmptyColumns"]&&true;this.query["swapRowsAndColumns"]=hash["swapRowsAndColumns"]||false;this.query["filters"]=hash["filters"]||{rows:[],columns:[]};this.query["where"]=hash["where"]||{};this.query["extra"]=hash["extra"]||{};this.query["conditions"]=[];this.query["drills"]=[];};OlapUtils.mdxQuery.prototype.clone=function(){var c=Dashboards.clone(this);return c;};OlapUtils.mdxQuery.prototype.generateAxisPart=function(axisDrill,axis,axisLevels,orderBy){if(axisDrill==false){return axis;}
var dim=axis.indexOf("].")==-1?axis:axis.substr(0,axis.indexOf("].")+1);var axisLevel=this.axisPos+this.axisDepth;if(axisLevel>axisLevels.length-1){axisLevel=axisLevels.length-1}
var q="Descendants("+axis+", "+dim+".["+axisLevels[axisLevel]+"],SELF)"
if(orderBy=="")
return q;return"Order("+q+", "+orderBy+" , BDESC)";}
OlapUtils.mdxQuery.prototype.getQuery=function(){var query="with ";var _eh=[];for(p in this.query){var key=p;var value=typeof this.query[p]=='function'?this.query[p]():this.query[p];_eh[key]=value;}
if(typeof _eh["sets"]=='object'||typeof _eh["members"]=='object'){for(s in _eh["sets"]){var value=typeof _eh["sets"][s]=='function'?_eh["sets"][s]():_eh["sets"][s];query+=" set "+value+" \n";}
for(m in _eh["members"]){var value=typeof _eh["members"][m]=='function'?_eh["members"][m]():_eh["members"][m];query+=" member "+value+" \n";}}
var columns=_eh["swapRowsAndColumns"]?_eh["rows"]:_eh["columns"];var columnLevels=_eh["swapRowsAndColumns"]?_eh["rowLevels"]:_eh["columnLevels"];var columnDrill=_eh["swapRowsAndColumns"]?_eh["rowDrill"]:_eh["columnDrill"];var rows=_eh["swapRowsAndColumns"]?_eh["columns"]:_eh["rows"];var rowLevels=_eh["swapRowsAndColumns"]?_eh["columnLevels"]:_eh["rowLevels"];var rowDrill=_eh["swapRowsAndColumns"]?_eh["columnDrill"]:_eh["rowDrill"];query+=" set rowSet as {"+this.generateAxisPart(rowDrill,rows,rowLevels,_eh.orderBy)+"} \n";query+=" set colSet as {"+this.generateAxisPart(columnDrill,columns,columnLevels,_eh.orderBy)+"} \n";var colFilter=[];var rowFilter=[];$.each(_eh["filters"]["rows"],function(j,k){rowFilter.push(_eh["rows"]+".Dimension.currentMember.Name <> '"+k+"' ");});if(_eh["swapRowsAndColumns"]){query+=" set rowFilter as "+(colFilter.length>0?"Filter(rowSet,"+colFilter.join(" and ")+" )":"rowSet")+"\n";query+=" set colFilter as "+(rowFilter.length>0?"Filter(colSet,"+rowFilter.join(" and ")+" )":"colSet")+"\n";}
else{query+=" set rowFilter as "+(rowFilter.length>0?"Filter(rowSet,"+rowFilter.join(" and ")+" )":"rowSet")+"\n";query+=" set colFilter as "+(colFilter.length>0?"Filter(colSet,"+colFilter.join(" and ")+" )":"colSet")+"\n";}
query+="select "+(_eh["nonEmptyRows"]?" NON EMPTY ":"")+" rowFilter on rows,\n ";query+=" "+(_eh["nonEmptyColumns"]?" NON EMPTY ":"")+" colFilter on columns\n ";query+=" from "+_eh["from"]+"\n";var whereArray=[];$.each(_eh["where"],function(key,obj){var el=typeof obj=='function'?obj():obj
if(el.length>0)whereArray.push(el);});if(whereArray.length>0){query+=" where ( "+whereArray.join(' , ')+" )";}
return query;}
OlapUtils.mdxQuery.prototype.exclude=function(value){this.query["filters"]["rows"].push(value);}
OlapUtils.mdxQuery.prototype.drillDown=function(value){this.resetFilters();this.query["drills"].push(this.query.rows);this.query.rows=value;this.axisPos++;}
OlapUtils.mdxQuery.prototype.drillUp=function(){this.axisPos--;return(this.query.rows=this.query["drills"].pop());}
OlapUtils.mdxQuery.prototype.addCondition=function(key,value){return this.addConditionAux(key,value,'focus');}
OlapUtils.mdxQuery.prototype.addInitialCondition=function(key,value){this.addConditionAux(key,value);}
OlapUtils.mdxQuery.prototype.removeFilter=function(key,value){this.removeCondition(key,value,'exclude');var lastExclude=true
for(v in this.query["conditions"][key]){lastExclude=false;break;}
if(lastExclude&&this.query["conditions"][key+"previousDrillValue"]!=undefined){this.addCondition(key,this.query["conditions"][key+"previousDrillValue"]);delete this.query["conditions"][key+"previousDrillValue"];}}
OlapUtils.mdxQuery.prototype.removeCondition=function(key,value,op){if(this.query["conditions"][key]!=undefined){if(this.query["conditions"][key][value]!=undefined)
delete this.query["conditions"][key][value];else{delete this.query["conditions"][key];this.resetCondition(key);return true;}}
var condition=value.substr(0,value.indexOf("]")+1)+".[Filter]";this.setCondition(key,condition,op);return false;}
OlapUtils.mdxQuery.prototype.removeConditions=function(key){this.query["conditions"][key]=[];this.resetCondition(key);}
OlapUtils.mdxQuery.prototype.replaceConditionsByDrill=function(key,value){if(this.query["conditions"][key]!=undefined)
this.query["conditions"][key]=[];return this.addConditionAux(key,value,'drill');}
OlapUtils.mdxQuery.prototype.replaceConditionByExclude=function(key,value){return this.addConditionAux(key,value,'exclude');}
OlapUtils.mdxQuery.prototype.addConditionAux=function(key,value,op){if(op==undefined){this.query["where"][key]=value;return;}
var condition=value.substr(0,value.indexOf("]")+1)+".[Filter]";if(this.query["conditions"][key]==undefined){this.query["conditions"][key]=[];if(this.query["where"][key]!=undefined)
this.query["conditions"][key+"InitialValue"]=this.query["where"][key];}
if(this.query["members"][key]==undefined){if(op=='exclude'){}
else
this.addMember(key,condition+" as Aggregate("+key+"Filter)");}
this.query["conditions"][key][value]=op
if(op!='exclude')
delete this.query["conditions"][key+"previousDrillValue"];if(op!='drill'){var aux=[];for(v in this.query["conditions"][key]){if(op=='exclude'&&this.query["conditions"][key+"previousDrillValue"]==undefined&&this.query["conditions"][key][v]=='drill'){this.query["conditions"][key+"previousDrillValue"]=v;}
if(this.query["conditions"][key][v]==op)aux[v]=op;}
this.query["conditions"][key]=aux;}
return this.setCondition(key,condition,op);}
OlapUtils.mdxQuery.prototype.setCondition=function(key,condition,op)
{var set=[];for(v in this.query["conditions"][key])
set.push(v);if(set.length>0){if(op=="focus"||op=="drill")
this.addSet(key,key+"Filter as {"+set.join(",")+"}");else{this.addMember(key,condition+" as ( ( "+set[0]+".parent) - ("+set.join(") - (")+"))");}
if(condition!=undefined)
this.query["where"][key]=condition;}
else
this.resetCondition(key);return set;}
OlapUtils.mdxQuery.prototype.addSet=function(key,set){this.query["sets"][key]=set;}
OlapUtils.mdxQuery.prototype.addMember=function(key,member){this.query["members"][key]=member;}
OlapUtils.lastClickedMdxQueryGroup;OlapUtils.mdxQueryGroup=function(name){this.name=name;this.mdxQueries={};this.clickedIdx=-1;this.clickedValue="";this.activeFilters={};this.activeConditions={};};OlapUtils.mdxQueryGroup.prototype.addMdxQuery=function(idx,mdxQuery,filterDimension,filterAxis,chartObject){this.mdxQueries[idx]={mdxQuery:mdxQuery,filterDimension:filterDimension,filterAxis:filterAxis,chartObject:chartObject};};OlapUtils.mdxQueryGroup.prototype.removeMdxQuery=function(idx){delete this.mdxQueries.idx;};OlapUtils.mdxQueryGroup.prototype.printConditions=function(){var out="";var filters=0;var conds=0;for(i in this.activeFilters){var a=this.activeFilters[i];if(a.length>0&&++filters==1)
out+="<i>Exclusions: </i>";var mdxGroupName=this.name;var o=[];$.each(a,function(j,k){o.push(k[1]+" <a class=\"resetFilterButton\" href='javascript:OlapUtils.mdxGroups[\""+mdxGroupName+"\"].removeFilter(\""+i+"\",\""+k[0]+"\")'>X</a>");++filters;});if(o.length>0)
out+=o.join(" , ")+" ;";}
for(i in this.activeConditions){var a=this.activeConditions[i];if(a.length>0&&++conds==1)
out+=" <i>Focus: </i>";var mdxGroupName=this.name;var o=[];$.each(a,function(j,k){o.push(k+" <a class=\"resetFilterButton\" href='javascript:OlapUtils.mdxGroups[\""+mdxGroupName+"\"].removeCondition(\""+i+"\",\""+k+"\")'>X</a>");++conds;});if(o.length>0)
out+=o.join(" , ")+"; ";}
if((conds+filters)>2)
out+=" <a  style=\"padding-left:15px;\" href='javascript:OlapUtils.mdxGroups[\""+this.name+"\"].resetAll()'>Reset All</a>";return out;}
OlapUtils.mdxQueryGroup.prototype.printEvolutionType=function(object){var out="";var myArray=[["Week","Week"],["Month","Month"],["Year","Year"]];for(var i=0,len=myArray.length;i<len;i++){out+="<input onclick='OlapUtils.changeEvolutionType(\""+object+"radio\")'";if(i==0){out+=" CHECKED ";}
out+="type='radio' id='"+object+"radio' name='"+object+"radio' value="+myArray[i][1]+" /> "+myArray[i][1]+(object.separator==undefined?"":object.separator);}
return out;}
OlapUtils.mdxQueryGroup.prototype.drillDown=function(key,value){Dashboards.incrementRunningCalls();var conditions=[];if(this.activeFilters!=undefined)delete this.activeFilters[key];if(this.activeConditions!=undefined)delete this.activeConditions[key];for(i in this.mdxQueries){var obj=this.mdxQueries[i];if(i==key){obj.mdxQuery.drillDown(value);}
else
conditions=obj.mdxQuery.replaceConditionsByDrill(key,value);Dashboards.update(obj.chartObject);}
if(conditions.length>0)
this.activeConditions[key]=conditions;Dashboards.update(Dashboards.getComponent(this.name));Dashboards.decrementRunningCalls();}
OlapUtils.mdxQueryGroup.prototype.drillUp=function(key){Dashboards.incrementRunningCalls();var conditions=[];if(this.activeFilters!=undefined)delete this.activeFilters[key];if(this.activeConditions!=undefined)delete this.activeConditions[key];var keyObj=this.mdxQueries[key];var value=keyObj.mdxQuery.drillUp();for(i in this.mdxQueries){var obj=this.mdxQueries[i];if(i!=key){if(keyObj.mdxQuery.axisPos>0)
conditions=obj.mdxQuery.replaceConditionsByDrill(key,value);else
obj.mdxQuery.removeCondition(key,value,'drill');}
Dashboards.update(obj.chartObject);}
if(conditions.length>0)
this.activeConditions[key]=conditions;Dashboards.update(Dashboards.getComponent(this.name));Dashboards.decrementRunningCalls();}
OlapUtils.mdxQueryGroup.prototype.replaceFocus=function(key,values){for(i in this.mdxQueries)
if(i!=key)
this.mdxQueries[i].mdxQuery.removeConditions(key);this.focus(key,values);}
OlapUtils.mdxQueryGroup.prototype.focus=function(key,values){var conditions=[];Dashboards.incrementRunningCalls();if(this.activeFilters!=undefined)delete this.activeFilters[key];if(this.activeConditions!=undefined)delete this.activeConditions[key];for(i in this.mdxQueries){if(i!=key){var obj=this.mdxQueries[i];for(i=0;i<values.length;i++){conditions=obj.mdxQuery.addCondition(key,values[i]);}
Dashboards.update(obj.chartObject);}}
if(conditions.length>0)
this.activeConditions[key]=conditions;Dashboards.update(Dashboards.getComponent(this.name));Dashboards.decrementRunningCalls();}
OlapUtils.mdxQueryGroup.prototype.exclude=function(key,value){Dashboards.incrementRunningCalls();var members=value.split("].[");var memberValue=members[members.length-1].replace("]","");this.mdxQueries[key].mdxQuery.exclude(memberValue)
Dashboards.update(this.mdxQueries[key].chartObject);var a=this.activeFilters[key]||[];a.push([memberValue,value]);this.activeFilters[key]=a;for(i in this.mdxQueries){var query=this.mdxQueries[i];if(i!=key){query.mdxQuery.replaceConditionByExclude(key,value);Dashboards.update(query.chartObject);}}
if(this.activeConditions[key]!=undefined)
var indexCondition=this.activeConditions[key].indexOf(value);if(indexCondition>=0)
this.activeConditions[key].splice(indexCondition,1);Dashboards.decrementRunningCalls();}
OlapUtils.mdxQueryGroup.prototype.expand=function(key){this.mdxQueries[key].mdxQuery.axisDepth++;Dashboards.update(this.mdxQueries[key].chartObject);}
OlapUtils.mdxQueryGroup.prototype.collapse=function(key){this.mdxQueries[key].mdxQuery.axisDepth--;Dashboards.update(this.mdxQueries[key].chartObject);}
OlapUtils.mdxQueryGroup.prototype.resetAll=function(){Dashboards.incrementRunningCalls();for(i in this.mdxQueries){var obj=this.mdxQueries[i];obj.mdxQuery.reset();obj.mdxQuery.axisPos=0;obj.mdxQuery.axisDepth=0;Dashboards.update(obj.chartObject);}
this.activeFilters={};this.activeConditions={};Dashboards.update(Dashboards.getComponent(this.name));Dashboards.decrementRunningCalls();}
OlapUtils.mdxQueryGroup.prototype.removeCondition=function(key,value){Dashboards.incrementRunningCalls();for(i in this.mdxQueries){var obj=this.mdxQueries[i];if(i!=key){if(obj.mdxQuery.removeCondition(key,value,'focus')&&this.activeFilters[key]!=undefined)
delete this.activeFilters[key];}
else{obj.mdxQuery.query.rows=typeof obj.mdxQuery.originalHash.rows=='function'?obj.mdxQuery.originalHash.rows():obj.mdxQuery.originalHash.rows;obj.mdxQuery.axisPos=0;obj.mdxQuery.resetFilters();}
Dashboards.update(obj.chartObject);}
this.activeConditions[key].splice(this.activeConditions[key].indexOf(value),1);Dashboards.update(Dashboards.getComponent(this.name));Dashboards.decrementRunningCalls();}
OlapUtils.mdxQueryGroup.prototype.removeFilter=function(key,value){Dashboards.incrementRunningCalls();var index=this.mdxQueries[key].mdxQuery.resetFilter(value);for(i in this.mdxQueries){var obj=this.mdxQueries[i];if(i!=key)
obj.mdxQuery.removeFilter(key,this.activeFilters[key][index][1]);Dashboards.update(obj.chartObject);}
this.activeFilters[key].splice(index,1);if(this.activeFilters[key].length==0)
delete this.activeFilters[key];Dashboards.update(Dashboards.getComponent(this.name));Dashboards.decrementRunningCalls();}
OlapUtils.mdxQueryGroupActionCallback=function(value,m){if(value=="cancel")
return;Dashboards.incrementRunningCalls();var mqg=OlapUtils.lastClickedMdxQueryGroup;var clickedObj=mqg.mdxQueries[mqg.clickedIdx];var axis=typeof clickedObj.mdxQuery.query.rows=='function'?clickedObj.mdxQuery.query.rows():clickedObj.mdxQuery.query.rows;if(value=="drilldown"){mqg.drillDown(mqg.clickedIdx,axis+".["+mqg.clickedValue+"]");}
else if(value=="drillup"){mqg.drillUp(mqg.clickedIdx,axis+".["+mqg.clickedValue+"]");}
else if(value=="focus"){mqg.focus(mqg.clickedIdx,[axis+".["+mqg.clickedValue+"]"]);}
else if(value=="filter"){mqg.exclude(mqg.clickedIdx,axis+".["+mqg.clickedValue+"]");}
else if(value=="expand"){mqg.expand(mqg.clickedIdx);}
else if(value=="collapse"){mqg.collapse(mqg.clickedIdx);}
else if(value=="resetall"){mqg.resetAll();}
Dashboards.update(Dashboards.getComponent(mqg.name));Dashboards.decrementRunningCalls();}
OlapUtils.getAxisPathString=function(axis,axisPath){var a=[];$.each(axisPath,function(i,v){a.push("["+v+"]");});return axis+"."+a.join(".");}
OlapUtils.changeEvolutionType=function(object){var value="";var selector=document.getElementsByName(object);for(var i=0,len=selector.length;i<len;i++){if(selector[i].checked){value=selector[i].value;continue;};}
this.fireChange("OlapUtils.evolutionType",value);}
OlapUtils.GenericMdxQuery=Base.extend({mdxQuery:undefined,options:{},tableDefaults:{},chartDefaults:{},genericDefaults:{dateDim:'[Date]',dateLevel:'[Date]',dateLevelMonth:'[Month]',from:'[CubeName]',nonEmptyRows:true,rowDrill:true,measuresDim:'[Measures]',orderBy:undefined,debug:false},constructor:function(options){},getQuery:function(){this.query=this.mdxQuery.getQuery();if(this.options.debug==true){alert(this.query);}
return this.query;},getDataTableOptions:function(options){$.extend(this.tableDefaults,options);return TableComponent.getDataTableOptions(this.tableDefaults);},getChartOptions:function(options){$.extend(this.chartDefaults,options);return this.chartDefaults;}});OlapUtils.EvolutionQuery=OlapUtils.GenericMdxQuery.extend({mdxQuery:undefined,thisMonth:"",lastMonth:"",lastYearMonth:"",specificDefaults:{baseDate:'2008-10-01',rows:'[Locale Codes]',rowLevels:['Code'],measure:'[Total Month Requests]',debug:false},tableDefaults:{colHeaders:["Dimension",'Total','% m/m','% m/m-12','Last 12 months'],colTypes:['string','numeric','numeric','numeric','sparkline'],colFormats:[null,'%.0f','%.2f','%.2f',null],colWidths:['100px','50px','50px','50px','80px'],displayLength:10,sparklineType:"line",sortBy:[[1,'desc']]},constructor:function(options,object){this.options=jQuery.extend({},this.genericDefaults,this.specificDefaults,options);var options=this.options;var thisPeriod=options.dateDim+".[This Period]";var lastPeriod=options.dateDim+".[Previous Period]";var lastYearPeriod=options.dateDim+".[Last Year Period]";var nonEmptyMeasure=".[Not Null Measure]";this.queryBase={from:options.from,rows:options.rows,rowLevels:options.rowLevels,rowDrill:options.rowDrill,nonEmptyRows:options.nonEmptyRows,columns:""+options.measuresDim+nonEmptyMeasure+","+options.measuresDim+".[% m/m],"+options.measuresDim+".[% m/m-12],"+options.measuresDim+".[sparkdatamonths]",swapRowsAndColumns:false,orderBy:options.orderBy,sets:{"now":function(){return"now as [Date].[Date].["+Dashboards.ev(options.baseDate)+"].Lag(30.0)"+":"+" [Date].[Date].["+Dashboards.ev(options.baseDate)+"]"},"oneMonthAgo":function(){return"oneMonthAgo as [Date].[Date].["+Dashboards.ev(options.baseDate)+"].Lag(60.0)"+":"+" [Date].[Date].["+Dashboards.ev(options.baseDate)+"].Lag(30.0)"},"oneYearAgo":function(){return"oneYearAgo as [Date].[Date].["+Dashboards.ev(options.baseDate)+"].Lag(395.0)"+":"+" [Date].[Date].["+Dashboards.ev(options.baseDate)+"].Lag(365.0)"},"last12Months":function(){return"last12Months as LastPeriods(12.0, Ancestor("+options.dateDim+"."+options.dateLevel+".["+Dashboards.ev(options.baseDate)+"],"+options.dateDim+"."+options.dateLevelMonth+")) "}},members:{todaysMonth:function(){return"[Date].[TodaysMonth] as Aggregate( now )"},notNullMeasure:function(){return""+options.measuresDim+nonEmptyMeasure+" as Iif(isEmpty("+options.measuresDim+"."+options.measure+"), 0 , "+options.measuresDim+"."+options.measure+") "},thisPeriodMeasure:function(){return""+options.measuresDim+".[This Period] as Aggregate(now*"+options.measuresDim+nonEmptyMeasure+") "},previousPeriodMeasure:function(){return""+options.measuresDim+".[Previous Period] as Aggregate(oneMonthAgo*"+options.measuresDim+nonEmptyMeasure+") "},lastYearPeriodMeasure:function(){return""+options.measuresDim+".[Last Year Period] as Aggregate(oneYearAgo*"+options.measuresDim+nonEmptyMeasure+") "},mmMeasure:function(){return""+options.measuresDim+".[% m/m] as 100.0*("+options.measuresDim+nonEmptyMeasure+" / "+options.measuresDim+".[Previous Period] - 1.0)  "},mm12Measure:function(){return""+options.measuresDim+".[% m/m-12] as 100.0*("+options.measuresDim+nonEmptyMeasure+" / "+options.measuresDim+".[Last Year Period] - 1.0)  "},sparkdatamonths:function(){return""+options.measuresDim+".[sparkdatamonths] as Generate([last12Months], Cast(("+options.measuresDim+nonEmptyMeasure+") + 0.0 as String), \" , \") "}},where:{dateBase:""+options.dateDim+".[TodaysMonth]"}};this.mdxQuery=new OlapUtils.mdxQuery(this.queryBase);},queryBase:{}});OlapUtils.DimensionAnalysisQuery=OlapUtils.GenericMdxQuery.extend({chartTypesTranslation:{},translationHash:{},mdxQuery:undefined,thisMonth:"",lastMonth:"",lastYearMonth:"",specificDefaults:{startDate:'2008-10-01',endDate:'2008-11-01',rows:'[Product Operating Systems]',rowLevels:["Platform","Version"],measure:'[Total Requests]',defaultChartType:"bar",debug:false,where:{}},tableDefaults:{colHeaders:['Name','Value'],colTypes:['string','numeric'],colFormats:[null,'%.0f'],sortBy:[[1,'desc']],lengthChange:false},chartDefaults:{domainLabelRotationDir:"up",domainLabelRotation:"0",orientation:"horizontal",title:"",isStacked:"true",is3d:false,foregroundAlpha:0.8,showValues:true,chartType:function(){return this.parent.queryBase.extra.translationHash.chartType;},datasetType:function(){return this.parent.queryBase.extra.translationHash.datasetType;},includeLegend:function(){return this.parent.queryBase.extra.translationHash.includeLegend;},topCountAxis:function(){return this.parent.queryBase.extra.translationHash.axis[1];}},constructor:function(options,object){this.options=jQuery.extend({},this.genericDefaults,this.specificDefaults,options);var options=this.options;this.chartTypesTranslation={"pie":{type:"jFreeChartComponent",chartType:"PieChart",datasetType:"CategoryDataset",axis:["columns","rows"],member:"("+options.dateDim+".[Date Range], "+options.measuresDim+".[Avg])",includeLegend:false},"bar":{type:"jFreeChartComponent",chartType:"BarChart",datasetType:"CategoryDataset",axis:["columns","rows"],member:"("+options.dateDim+".[Date Range], "+options.measuresDim+".[Avg])",includeLegend:false},"table":{type:"tableComponent",chartType:"PieChart",datasetType:"CategoryDataset",axis:["columns","rows"],member:"("+options.dateDim+".[Date Range], "+options.measuresDim+".[Avg])",includeLegend:false},"trend":{type:"jFreeChartComponent",chartType:"AreaChart",datasetType:"TimeSeriesCollection",axis:["rows","columns"],member:"a",includeLegend:true}};this.queryBase={from:options.from,rows:options.rows,rowLevels:options.rowLevels,rowDrill:options.rowDrill,nonEmptyRows:options.nonEmptyRows,columns:function(){return this.extra.translationHash["member"]},swapRowsAndColumns:function(){return this.extra.translationHash["axis"][0]=="rows"},orderBy:"Avg(a,"+options.measuresDim+"."+options.measure+")",sets:{"a":function(){return"a as '("+options.dateDim+"."+options.dateLevel+".["+Dashboards.ev(options.startDate)+"]:"+options.dateDim+"."+options.dateLevel+".["+Dashboards.ev(options.endDate)+"])'"}},members:{daterange:""+options.dateDim+".[Date Range] as Aggregate(a)",average:""+options.measuresDim+".[Avg] as 'Avg(a,"+options.measuresDim+"."+options.measure+")'"},where:options.where,extra:{}};var _chart=Dashboards.clone(this);delete _chart.chartDefaults;this.chartDefaults.parent=_chart;this.setChartType(options.defaultChartType);this.mdxQuery=new OlapUtils.mdxQuery(this.queryBase);},setChartType:function(chartType){this.queryBase.extra.translationHash=this.chartTypesTranslation[chartType];this.chartDefaults.parent.queryBase.extra.translationHash=this.chartTypesTranslation[chartType];},getComponentType:function(){return this.chartDefaults.parent.queryBase.extra.translationHash.type;},queryBase:{}});if(!this.JSON){this.JSON={};}
(function(){function f(n){return n<10?'0'+n:n;}
if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+
f(this.getUTCMonth()+1)+'-'+
f(this.getUTCDate())+'T'+
f(this.getUTCHours())+':'+
f(this.getUTCMinutes())+':'+
f(this.getUTCSeconds())+'Z':null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}
var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}
function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key);}
if(typeof rep==='function'){value=rep.call(holder,key,value);}
switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null';}
gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}
v=partial.length===0?'[]':gap?'[\n'+gap+
partial.join(',\n'+gap)+'\n'+
mind+']':'['+partial.join(',')+']';gap=mind;return v;}
if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==='string'){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}
v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+
mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}
if(typeof JSON.stringify!=='function'){JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}}else if(typeof space==='string'){indent=space;}
rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify');}
return str('',{'':value});};}
if(typeof JSON.parse!=='function'){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}
return reviver.call(holder,key,value);}
text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+
('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}
if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j;}
throw new SyntaxError('JSON.parse');};}}());var MetaLayer={getCurrentDate:function(){var currentDate=new Date();return MetaLayer.toDateString(currentDate);},getYesterdayDate:function(){var currentDate=new Date();currentDate.setDate(currentDate.getDate()-1);return MetaLayer.toDateString(currentDate);},getFirstDayOfYearDate:function(){var currentDate=new Date();return currentDate.getFullYear()+"-01-01";},getFirstDayOfLastMonth:function(){var currentDate=new Date();currentDate.setMonth(currentDate.getMonth()-1);currentDate.setDate(1);return MetaLayer.toDateString(currentDate);},getLastDayOfLastMonth:function(){var currentDate=new Date();currentDate.setDate(0);return MetaLayer.toDateString(currentDate);},getLastMonthDate:function(){var currentDate=new Date();var prevDate=new Date(currentDate.getFullYear(),currentDate.getMonth(),currentDate.getDate()-30);var prevMonth="0"+(prevDate.getMonth()+1);var prevDay="0"+(prevDate.getDate());var prevDateStr=prevDate.getFullYear()+"-"+(prevMonth.substring(prevMonth.length-2,prevMonth.length))+"-"+(prevDay.substring(prevDay.length-2,prevDay.length));return prevDateStr;},toDateString:function(d){var currentMonth="0"+(d.getMonth()+1);var currentDay="0"+(d.getDate());var dStr=d.getFullYear()+"-"+(currentMonth.substring(currentMonth.length-2,currentMonth.length))+"-"+(currentDay.substring(currentDay.length-2,currentDay.length));return dStr;},getMonth:function(){var currentDate=new Date();var currentMonth="0"+(currentDate.getMonth()+1);var currentDateStr=currentDate.getFullYear()+"-"+(currentMonth.substring(currentMonth.length-2,currentMonth.length));return currentDateStr;},getMdxMonth:function(){var currentDate=new Date();var currentDateStr="[Date].["+currentDate.getFullYear()+"].["+currentDate.getMonth()+"]";return currentDateStr;},getInitialMonth:function(){var c=new Date();c.setMonth(c.getMonth()-1);return c;},allValues:[["All","All"]]};jQuery.fn.check=function(mode){var mode=mode||'on';return this.each(function(){switch(mode){case'on':this.checked=true;break;case'off':this.checked=false;break;case'toggle':this.checked=!this.checked;break;}});};jQuery.fn.extend({captify:function(o,object){var o=$.extend({speedOver:'fast',speedOut:'normal',hideDelay:4000,animation:'slide',prefix:'',opacity:'0.35',className:'caption-bottom',position:'bottom',spanWidth:'100%'},o);$(this).each(function(){var img=this;$(this).load(function(){$this=img;if(this.hasInit){return false;}
this.hasInit=true;var close=0;var invoker;var captionLabelSrc=$('#'+$(this).attr('rel'));var captionLabelHTML=!captionLabelSrc.length?$(this).attr('alt'):captionLabelSrc.html();captionLabelSrc.remove();var toWrap=this.parent&&this.parent.tagName=='a'?this.parent:$(this);var wrapper=toWrap.wrap('<div></div>').parent();wrapper.css({overflow:'hidden',padding:0,fontSize:0.1})
wrapper.addClass('caption-wrapper');wrapper.width($(this).width());wrapper.height($(this).height());$.map(['top','right','bottom','left'],function(i){wrapper.css('margin-'+i,$(img).css('margin-'+i));$.map(['style','width','color'],function(j){var key='border-'+i+'-'+j;wrapper.css(key,$(img).css(key));});});$(img).css({border:'0 none'});var button=$('<div></div>').addClass('caption-button');if(o.hasButton){toWrap.parent().parent().prepend(button);}
var caption=$('div:last',wrapper.append('<div></div>')).addClass(o.className);var captionContent=$('div:last',wrapper.append('<div></div>')).addClass(o.className).append(o.prefix).append(captionLabelHTML);$('*',wrapper).css({margin:0}).show();var captionPositioning=jQuery.browser.msie?'static':'relative';caption.css({zIndex:1,position:captionPositioning,opacity:o.animation=='fade'?0:o.opacity,width:o.spanWidth});if(o.position=='bottom'){var vLabelOffset=parseInt(caption.css('border-top-width').replace('px',''))+parseInt(captionContent.css('padding-top').replace('px',''))-1;captionContent.css('paddingTop',vLabelOffset);}
captionContent.css({position:captionPositioning,zIndex:2,background:'none',border:'1 none',opacity:o.animation=='fade'?1:1,width:o.spanWidth});caption.width(captionContent.outerWidth());caption.height(captionContent.height());button.width($(img).outerWidth());var topBorderAdj=(o.position=='bottom'&&jQuery.browser.msie)?-4:0;var captionPosition=(o.position=='top')?{hide:-$(img).height()-caption.outerHeight()-1,show:-$(img).height()}:{hide:0,show:-caption.outerHeight()+topBorderAdj};captionContent.css('marginTop',-caption.outerHeight());caption.css('marginTop',captionPosition[o.animation=='fade'||o.animation=='always-on'?'show':'hide']);var cHide=function(){if(close){var props=o.animation=='fade'?{opacity:0}:{marginTop:captionPosition.hide};caption.animate(props,250,null,function(){close=false});invoker.animate(props,250);if(o.animation=='fade'){captionContent.animate({opacity:0},o.speedOver,null,function(){close=false});}}};if(o.animation!='always-on'){$(this).bind("detailsClick",function(e,obj){if(!close){close=true;invoker=$(obj);var props=o.animation=='fade'?{opacity:o.opacity}:{marginTop:captionPosition.show};caption.animate(props,o.speedOver);invoker.animate(props,o.speedOver);if(o.animation=='fade'){captionContent.animate({opacity:1},o.speedOver/2);}
window.setTimeout(cHide,o.hideDelay);}});}
o.bDetails.trigger('capityFinished',[this]);});});}});var pvc=(function(def,pv){var pvc=def.globalSpace('pvc',{debug:0});(function(){if((typeof window.location)!=='undefined'){var url=window.location.href;if(url&&(/\bdebug=true\b/).test(url)){var m=/\bdebugLevel=(\d+)/.exec(url);pvc.debug=m?(+m[1]):3;}}}());var pv_Mark=pv.Mark;pvc.invisibleFill='rgba(127,127,127,0.00001)';pvc.logSeparator="------------------------------------------";var pvc_arraySlice=Array.prototype.slice;pvc.setDebug=function(level){level=+level;pvc.debug=isNaN(level)?0:level;pvc_syncLog();pvc_syncTipsyLog();return pvc.debug;};function pvc_syncLog(){if(pvc.debug&&typeof console!=="undefined"){['log','info',['trace','debug'],'error','warn',['group','groupCollapsed'],'groupEnd'].forEach(function(ps){ps=ps instanceof Array?ps:[ps,ps];pvc_installLog(pvc,ps[0],ps[1],'[pvChart]');});}else{if(pvc.debug>1){pvc.debug=1;}
['log','info','trace','warn','group','groupEnd'].forEach(function(p){pvc[p]=def.noop;});var _errorPrefix="[pvChart ERROR]: ";pvc.error=function(e){if(e&&typeof e==='object'&&e.message){e=e.message;}
e=''+def.nullyTo(e,'');if(e.indexOf(_errorPrefix)<0){e=_errorPrefix+e;}
throw new Error(e);};}
pvc.logError=pvc.error;pv.error=pvc.error;}
function pvc_syncTipsyLog(){var tip=pv.Behavior.tipsy;if(tip&&tip.setDebug){tip.setDebug(pvc.debug);tip.log=pvc.log;}}
function pvc_installLog(o,pto,pfrom,prompt){if(!pfrom){pfrom=pto;}
var c=console;var m=c[pfrom]||c.log;var fun;if(m){var mask=prompt+": %s";if(!def.fun.is(m)){var apply=Function.prototype.apply;fun=function(){apply.call(m,c,def.array.append([mask],arguments));};}else{fun=m.bind(c,mask);}}
o[pto]=fun;}
pvc.setDebug(pvc.debug);pvc.defaultCompatVersion=function(compatVersion){var defaults=pvc.BaseChart.prototype.defaults;if(compatVersion!=null){return defaults.compatVersion=compatVersion;}
return defaults.compatVersion;};pvc.cloneMatrix=function(m){return m.map(function(d){return d.slice();});};pvc.stringify=function(t,keyArgs){var maxLevel=def.get(keyArgs,'maxLevel')||5;var out=[];pvc.stringifyRecursive(out,t,maxLevel,keyArgs);return out.join('');};pvc.stringifyRecursive=function(out,t,remLevels,keyArgs){if(remLevels>0){remLevels--;switch(typeof t){case'undefined':return out.push('undefined');case'object':if(!t){out.push('null');return true;}
if(def.fun.is(t.stringify)){return t.stringify(out,remLevels,keyArgs);}
if(t instanceof Array){out.push('[');t.forEach(function(item,index){if(index){out.push(', ');}
if(!pvc.stringifyRecursive(out,item,remLevels,keyArgs)){out.pop();}});out.push(']');}else{var ownOnly=def.get(keyArgs,'ownOnly',true);if(t===def.global){out.push('<window>');return true;}
if(def.fun.is(t.cloneNode)){out.push('<dom #'+(t.id||t.name||'?')+'>');return true;}
if(remLevels>1&&t.constructor!==Object){remLevels=1;ownOnly=true;}
out.push('{');var first=true;for(var p in t){if(!ownOnly||def.hasOwnProp.call(t,p)){if(!first){out.push(', ');}
out.push(p+': ');if(!pvc.stringifyRecursive(out,t[p],remLevels,keyArgs)){out.pop();if(!first){out.pop();}}else if(first){first=false;}}}
if(first){var s=''+t;if(s!=='[object Object]'){out.push('{'+s+'}');}}
out.push('}');}
return true;case'number':out.push(''+(Math.round(100000*t)/100000));return true;case'boolean':out.push(''+t);return true;case'string':out.push(JSON.stringify(t));return true;case'function':if(def.get(keyArgs,'funs',false)){out.push(JSON.stringify(t.toString().substr(0,13)+'...'));return true;}
return false;}
out.push("'new ???'");return true;}};pvc.orientation={vertical:'vertical',horizontal:'horizontal'};pvc.extensionTag='extension';pvc.extendType=function(type,exts,names){if(exts){var exts2;var sceneVars=type.prototype._vars;var addExtension=function(ext,n){if(ext!==undefined){if(!exts2){exts2={};}
if(sceneVars&&sceneVars[n]){n='_'+n+'EvalCore';}
exts2[n]=def.fun.to(ext);}};if(names){names.forEach(function(n){addExtension(exts[n],n);});}else{def.each(addExtension);}
if(exts2){type.add(exts2);}}};pv.Color.prototype.stringify=function(out,remLevels,keyArgs){return pvc.stringifyRecursive(out,this.key,remLevels,keyArgs);};pv_Mark.prototype.hasDelegateValue=function(name,tag){var p=this.$propertiesMap[name];if(p){return(!tag||p.tag===tag);}
if(this.proto){return this.proto.hasDelegateValue(name,tag);}
return false;};pvc.defaultColorScheme=null;pvc.brighterColorTransform=function(color){return(color.rgb?color:pv.color(color)).brighter(0.6);};pvc.setDefaultColorScheme=function(colors){return pvc.defaultColorScheme=pvc.colorScheme(colors);};pvc.defaultColor=pv.Colors.category10()('?');pvc.colorScheme=function(colors){if(colors==null){return null;}
if(typeof colors==='function'){if(!colors.hasOwnProperty('range')){return colors;}
colors=colors.range();}else{colors=def.array.as(colors);}
if(!colors.length){return null;}
return function(){var scale=pv.colors(colors);scale.domain.apply(scale,arguments);return scale;};},pvc.createColorScheme=function(colors){return pvc.colorScheme(colors)||pvc.defaultColorScheme||pv.Colors.category10;};pvc.toGrayScale=function(color,alpha,maxGrayLevel,minGrayLevel){color=pv.color(color);var avg=0.299*color.r+0.587*color.g+0.114*color.b;if(maxGrayLevel===undefined){maxGrayLevel=200;}else if(maxGrayLevel==null){maxGrayLevel=255;}
if(minGrayLevel===undefined){minGrayLevel=30;}else if(minGrayLevel==null){minGrayLevel=0;}
var delta=(maxGrayLevel-minGrayLevel);if(delta<=0){avg=maxGrayLevel;}else{avg=minGrayLevel+(avg/255)*delta;}
if(alpha==null){alpha=color.opacity;}else if(alpha<0){alpha=(-alpha)*color.opacity;}
avg=Math.round(avg);return pv.rgb(avg,avg,avg,alpha);};pvc.removeTipsyLegends=function(){try{$('.tipsy').remove();}catch(e){}};pvc.createDateComparer=function(parser,key){if(!key){key=pv.identity;}
return function(a,b){return parser.parse(key(a))-parser.parse(key(b));};};pvc.time={intervals:{'y':31536e6,'m':2592e6,'d30':2592e6,'w':6048e5,'d7':6048e5,'d':864e5,'h':36e5,'M':6e4,'s':1e3,'ms':1},withoutTime:function(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate());},weekday:{previousOrSelf:function(t,toWd){var wd=t.getDay();var difDays=wd-toWd;if(difDays){var previousOffset=difDays<0?(7+difDays):difDays;t=new Date(t-previousOffset*pvc.time.intervals.d);}
return t;},nextOrSelf:function(t,toWd){var wd=t.getDay();var difDays=wd-toWd;if(difDays){var nextOffset=difDays>0?(7-difDays):-difDays;t=new Date(t+nextOffset*pvc.time.intervals.d);}
return t;},closestOrSelf:function(t,toWd){var wd=t.getDay();var difDays=wd-toWd;if(difDays){var D=pvc.time.intervals.d;var sign=difDays>0?1:-1;difDays=Math.abs(difDays);if(difDays>=4){t=new Date(t.getTime()+sign*(7-difDays)*D);}else{t=new Date(t.getTime()-sign*difDays*D);}}
return t;}}};pv.Format.createParser=function(pvFormat){function parse(value){return pvFormat.parse(value);}
return parse;};pv.Format.createFormatter=function(pvFormat){function format(value){return value!=null?pvFormat.format(value):"";}
return format;};pvc.buildTitleFromName=function(name){return def.firstUpperCase(name).replace(/([a-z\d])([A-Z])/,"$1 $2");};pvc.buildIndexedId=function(prefix,index){if(index>0){return prefix+""+(index+1);}
return prefix;};pvc.splitIndexedId=function(indexedId){var match=/^(.*?)(\d*)$/.exec(indexedId);var index=null;if(match[2]){index=Number(match[2]);if(index<=1){index=1;}else{index--;}}
return[match[1],index];};function pvc_unwrapExtensionOne(id,prefix){if(id){if(def.object.is(id)){return id.abs;}
return prefix?(prefix+def.firstUpperCase(id)):id;}
return prefix;}
var pvc_oneNullArray=[null];pvc.makeExtensionAbsId=function(id,prefix){if(!id){return prefix;}
return def.query(prefix||pvc_oneNullArray).selectMany(function(oneprefix){return def.query(id).select(function(oneid){return pvc_unwrapExtensionOne(oneid,oneprefix);});}).where(def.truthy).array();};pvc.makeEnumParser=function(enumName,keys,dk){var keySet={};keys.forEach(function(k){if(k){keySet[k.toLowerCase()]=k;}});if(dk){dk=dk.toLowerCase();}
return function(k){if(k){k=(''+k).toLowerCase();}
if(!def.hasOwn(keySet,k)){if(k&&pvc.debug>=2){pvc.log("[Warning] Invalid '"+enumName+"' value: '"+k+"'. Assuming '"+dk+"'.");}
k=dk;}
return k;};};pvc.parseDistinctIndexArray=function(value,min,max){value=def.array.as(value);if(value==null){return null;}
if(min==null){min=0;}
if(max==null){max=Infinity;}
var a=def.query(value).select(function(index){return+index;}).where(function(index){return!isNaN(index)&&index>=min&&index<=max;}).distinct().array();return a.length?a:null;};pvc.parseLegendClickMode=pvc.makeEnumParser('legendClickMode',['toggleSelected','toggleVisible','none'],'toggleVisible');pvc.parseTooltipAutoContent=pvc.makeEnumParser('tooltipAutoContent',['summary','value'],'value');pvc.parseSelectionMode=pvc.makeEnumParser('selectionMode',['rubberBand','focusWindow'],'rubberBand');pvc.parseClearSelectionMode=pvc.makeEnumParser('clearSelectionMode',['emptySpaceClick','manual'],'emptySpaceClick');pvc.parseShape=pvc.makeEnumParser('shape',['square','circle','diamond','triangle','cross','bar'],null);pvc.parseTreemapColorMode=pvc.makeEnumParser('colorMode',['byParent','bySelf'],'byParent');pvc.parseTreemapLayoutMode=pvc.makeEnumParser('layoutMode',['squarify','slice-and-dice','slice','dice'],'squarify');pvc.parseContinuousColorScaleType=function(scaleType){if(scaleType){scaleType=(''+scaleType).toLowerCase();switch(scaleType){case'linear':case'normal':case'discrete':break;default:if(pvc.debug>=2){pvc.log("[Warning] Invalid 'ScaleType' option value: '"+scaleType+"'.");}
scaleType=null;break;}}
return scaleType;};pvc.parseDomainScope=function(scope,orientation){if(scope){scope=(''+scope).toLowerCase();switch(scope){case'cell':case'global':break;case'section':if(!orientation){throw def.error.argumentRequired('orientation');}
scope=orientation==='y'?'row':'column';break;case'column':case'row':if(orientation&&orientation!==(scope==='row'?'y':'x')){scope='section';if(pvc.debug>=2){pvc.log("[Warning] Invalid 'DomainScope' option value: '"+scope+"' for the orientation: '"+orientation+"'.");}}
break;default:if(pvc.debug>=2){pvc.log("[Warning] Invalid 'DomainScope' option value: '"+scope+"'.");}
scope=null;break;}}
return scope;};pvc.parseDomainRoundingMode=function(mode){if(mode){mode=(''+mode).toLowerCase();switch(mode){case'none':case'nice':case'tick':break;default:if(pvc.debug>=2){pvc.log("[Warning] Invalid 'DomainRoundMode' value: '"+mode+"'.");}
mode=null;break;}}
return mode;};pvc.parseOverlappedLabelsMode=function(mode){if(mode){mode=(''+mode).toLowerCase();switch(mode){case'leave':case'hide':case'rotatethenhide':break;default:if(pvc.debug>=2){pvc.log("[Warning] Invalid 'OverlappedLabelsMode' option value: '"+mode+"'.");}
mode=null;break;}}
return mode;};pvc.castNumber=function(value){if(value!=null){value=+value;if(isNaN(value)){value=null;}}
return value;};pvc.parseWaterDirection=function(value){if(value){value=(''+value).toLowerCase();switch(value){case'up':case'down':return value;}
if(pvc.debug>=2){pvc.log("[Warning] Invalid 'WaterDirection' value: '"+value+"'.");}}};pvc.parseTrendType=function(value){if(value){value=(''+value).toLowerCase();if(value==='none'){return value;}
if(pvc.trends.has(value)){return value;}
if(pvc.debug>=2){pvc.log("[Warning] Invalid 'TrendType' value: '"+value+"'.");}}};pvc.parseNullInterpolationMode=function(value){if(value){value=(''+value).toLowerCase();switch(value){case'none':case'linear':case'zero':return value;}
if(pvc.debug>=2){pvc.log("[Warning] Invalid 'NullInterpolationMode' value: '"+value+"'.");}}};pvc.parseAlign=function(side,align){if(align){align=(''+align).toLowerCase();}
var align2,isInvalid;if(side==='left'||side==='right'){align2=align&&pvc.BasePanel.verticalAlign[align];if(!align2){align2='middle';isInvalid=!!align;}}else{align2=align&&pvc.BasePanel.horizontalAlign[align];if(!align2){align2='center';isInvalid=!!align;}}
if(isInvalid&&pvc.debug>=2){pvc.log(def.format("Invalid alignment value '{0}'. Assuming '{1}'.",[align,align2]));}
return align2;};pvc.parseAnchor=function(anchor){if(anchor){anchor=(''+anchor).toLowerCase();switch(anchor){case'top':case'left':case'center':case'bottom':case'right':return anchor;}
if(pvc.debug>=2){pvc.log(def.format("Invalid anchor value '{0}'.",[anchor]));}}};pvc.parseAnchorWedge=function(anchor){if(anchor){anchor=(''+anchor).toLowerCase();switch(anchor){case'outer':case'inner':case'center':case'start':case'end':return anchor;}
if(pvc.debug>=2){pvc.log(def.format("Invalid wedge anchor value '{0}'.",[anchor]));}}};pvc.unionExtents=function(result,range){if(!result){if(!range){return null;}
result={min:range.min,max:range.max};}else if(range){if(range.min<result.min){result.min=range.min;}
if(range.max>result.max){result.max=range.max;}}
return result;};var pvc_Sides=pvc.Sides=function(sides){if(sides!=null){this.setSides(sides);}};pvc_Sides.hnames='left right'.split(' ');pvc_Sides.vnames='top bottom'.split(' ');pvc_Sides.names='left right top bottom'.split(' ');pvc_Sides.namesSet=pv.dict(pvc_Sides.names,def.retTrue);pvc.parsePosition=function(side,defaultSide){if(side){side=(''+side).toLowerCase();if(!def.hasOwn(pvc_Sides.namesSet,side)){var newSide=defaultSide||'left';if(pvc.debug>=2){pvc.log(def.format("Invalid position value '{0}. Assuming '{1}'.",[side,newSide]));}
side=newSide;}}
return side||defaultSide||'left';};pvc_Sides.as=function(v){if(v!=null&&!(v instanceof pvc_Sides)){v=new pvc_Sides().setSides(v);}
return v;};pvc_Sides.prototype.stringify=function(out,remLevels,keyArgs){return pvc.stringifyRecursive(out,def.copyOwn(this),remLevels,keyArgs);};pvc_Sides.prototype.setSides=function(sides){if(typeof sides==='string'){var comps=sides.split(/\s+/).map(function(comp){return pvc_PercentValue.parse(comp);});switch(comps.length){case 1:this.set('all',comps[0]);return this;case 2:this.set('top',comps[0]);this.set('left',comps[1]);this.set('right',comps[1]);this.set('bottom',comps[0]);return this;case 3:this.set('top',comps[0]);this.set('left',comps[1]);this.set('right',comps[1]);this.set('bottom',comps[2]);return this;case 4:this.set('top',comps[0]);this.set('right',comps[1]);this.set('bottom',comps[2]);this.set('left',comps[3]);return this;case 0:return this;}}else if(typeof sides==='number'){this.set('all',sides);return this;}else if(typeof sides==='object'){if(sides instanceof pvc_PercentValue){this.set('all',sides);}else{this.set('all',sides.all);for(var p in sides){if(p!=='all'&&pvc_Sides.namesSet.hasOwnProperty(p)){this.set(p,sides[p]);}}}
return this;}
if(pvc.debug){pvc.log("Invalid 'sides' value: "+pvc.stringify(sides));}
return this;};pvc_Sides.prototype.set=function(prop,value){value=pvc_PercentValue.parse(value);if(value!=null){if(prop==='all'){pvc_Sides.names.forEach(function(p){this[p]=value;},this);}else if(def.hasOwn(pvc_Sides.namesSet,prop)){this[prop]=value;}}};pvc_Sides.prototype.resolve=function(width,height){if(typeof width==='object'){height=width.height;width=width.width;}
var sides={};pvc_Sides.names.forEach(function(side){var value=0;var sideValue=this[side];if(sideValue!=null){if(typeof(sideValue)==='number'){value=sideValue;}else{value=sideValue.resolve((side==='left'||side==='right')?width:height);}}
sides[side]=value;},this);return pvc_Sides.updateSize(sides);};pvc_Sides.updateSize=function(sides){sides.width=(sides.left||0)+(sides.right||0);sides.height=(sides.bottom||0)+(sides.top||0);return sides;};pvc_Sides.resolvedMax=function(a,b){var sides={};pvc_Sides.names.forEach(function(side){sides[side]=Math.max(a[side]||0,b[side]||0);});return sides;};pvc_Sides.inflate=function(sides,by){var sidesOut={};pvc_Sides.names.forEach(function(side){sidesOut[side]=(sides[side]||0)+by;});return pvc_Sides.updateSize(sidesOut);};var pvc_PercentValue=pvc.PercentValue=function(pct){this.percent=pct;};pvc_PercentValue.prototype.resolve=function(total){return this.percent*total;};pvc_PercentValue.parse=function(value){if(value!=null&&value!==''){switch(typeof value){case'number':return value;case'string':var match=value.match(/^(.+?)\s*(%)?$/);if(match){var n=+match[1];if(!isNaN(n)){if(match[2]){if(n>=0){return new pvc_PercentValue(n/100);}}else{return n;}}}
break;case'object':if(value instanceof pvc_PercentValue){return value;}
break;}
if(pvc.debug){pvc.log(def.format("Invalid margins component '{0}'",[''+value]));}}};pvc_PercentValue.resolve=function(value,total){return(value instanceof pvc_PercentValue)?value.resolve(total):value;};var pvc_markRenderCore=pv_Mark.prototype.renderCore,pvc_markZOrder=pv_Mark.prototype.zOrder;pv_Mark.prototype.zOrder=function(zOrder){var borderPanel=this.borderPanel;if(borderPanel&&borderPanel!==this){return pvc_markZOrder.call(borderPanel,zOrder);}
return pvc_markZOrder.call(this,zOrder);};pv_Mark.prototype.renderCore=function(){var root=this.root;root._renderId=(root._renderId||0)+1;if(pvc.debug>=25){pvc.log("BEGIN RENDER "+root._renderId);}
pvc_markRenderCore.call(this);if(pvc.debug>=25){pvc.log("END RENDER "+root._renderId);}};pv_Mark.prototype.renderId=function(){return this.root._renderId;};pv_Mark.prototype.wrapper=function(wrapper){this._wrapper=wrapper;return this;};pv_Mark.prototype.wrap=function(f,m){if(f&&def.fun.is(f)&&this._wrapper&&!f._cccWrapped){f=this._wrapper(f,m);f._cccWrapped=true;}
return f;};pv_Mark.prototype.lock=function(prop,value){if(value!==undefined){this[prop](value);}
(this._locked||(this._locked={}))[prop]=true;return this;};pv_Mark.prototype.isIntercepted=function(prop){return this._intercepted&&this._intercepted[prop];};pv_Mark.prototype.isLocked=function(prop){return this._locked&&this._locked[prop];};pv_Mark.prototype.ensureEvents=function(defEvs){var events=this.propertyValue('events',true);if(!events||events==='none'){this.events(defEvs||'all');}
return this;};pv_Mark.prototype.addMargin=function(name,margin){if(margin!==0){var staticValue=def.nullyTo(this.propertyValue(name),0),fMeasure=pv.functor(staticValue);this[name](function(){return margin+fMeasure.apply(this,pvc_arraySlice.call(arguments));});}
return this;};pv_Mark.prototype.addMargins=function(margins){var all=def.get(margins,'all',0);this.addMargin('left',def.get(margins,'left',all));this.addMargin('right',def.get(margins,'right',all));this.addMargin('top',def.get(margins,'top',all));this.addMargin('bottom',def.get(margins,'bottom',all));return this;};pv_Mark.prototype.eachInstanceWithData=function(fun,ctx){this.eachInstance(function(scenes,index,t){if(scenes.mark.sign&&scenes[index].data){fun.call(ctx,scenes,index,t);}});};pv_Mark.prototype.eachSceneWithDataOnRect=function(rect,fun,ctx,selectionMode){var me=this;var sign=me.sign;if(sign&&!sign.selectable()){return;}
if(selectionMode==null){selectionMode=me.rubberBandSelectionMode||'partial';}
var useCenter=(selectionMode==='center');me.eachInstanceWithData(function(scenes,index,toScreen){var shape=me.getShape(scenes,index,0.15);shape=(useCenter?shape.center():shape).apply(toScreen);processShape(shape,scenes[index],index);});function processShape(shape,instance,index){if(shape.intersectsRect(rect)){var cccScene=instance.data;if(cccScene&&cccScene.datum){fun.call(ctx,cccScene);}}}};pv_Mark.prototype.eachDatumOnRect=function(rect,fun,ctx,selectionMode){var me=this;var sign=me.sign;if(sign&&!sign.selectable()){return;}
if(selectionMode==null){selectionMode=me.rubberBandSelectionMode||'partial';}
var useCenter=(selectionMode==='center');me.eachInstanceWithData(function(scenes,index,toScreen){var shape=me.getShape(scenes,index,0.15);shape=(useCenter?shape.center():shape).apply(toScreen);processShape(shape,scenes[index],index);});function processShape(shape,instance,index){if(shape.intersectsRect(rect)){var cccScene=instance.data;if(cccScene&&cccScene.datum){cccScene.datums().each(function(datum){if(!datum.isNull){fun.call(ctx,datum);}});}}}};pv.Transform.prototype.transformHPosition=function(left){return this.x+(this.k*left);};pv.Transform.prototype.transformVPosition=function(top){return this.y+(this.k*top);};pv.Transform.prototype.transformLength=function(length){return this.k*length;};var pvc_Size=def.type('pvc.Size').init(function(width,height){if(arguments.length===1){if(width!=null){this.setSize(width);}}else{if(width!=null){this.width=width;}
if(height!=null){this.height=height;}}}).add({stringify:function(out,remLevels,keyArgs){return pvc.stringifyRecursive(out,def.copyOwn(this),remLevels,keyArgs);},setSize:function(size,keyArgs){if(typeof size==='string'){var comps=size.split(/\s+/).map(function(comp){return pvc_PercentValue.parse(comp);});switch(comps.length){case 1:this.set(def.get(keyArgs,'singleProp','all'),comps[0]);return this;case 2:this.set('width',comps[0]);this.set('height',comps[1]);return this;case 0:return this;}}else if(typeof size==='number'){this.set(def.get(keyArgs,'singleProp','all'),size);return this;}else if(typeof size==='object'){if(size instanceof pvc_PercentValue){this.set(def.get(keyArgs,'singleProp','all'),size);}else{this.set('all',size.all);for(var p in size){if(p!=='all'){this.set(p,size[p]);}}}
return this;}
if(pvc.debug){pvc.log("Invalid 'size' value: "+pvc.stringify(size));}
return this;},set:function(prop,value){if(value!=null&&(prop==='all'||def.hasOwn(pvc_Size.namesSet,prop))){value=pvc_PercentValue.parse(value);if(value!=null){if(prop==='all'){pvc_Size.names.forEach(function(p){this[p]=value;},this);}else{this[prop]=value;}}}
return this;},clone:function(){return new pvc_Size(this.width,this.height);},intersect:function(size){return new pvc_Size(Math.min(this.width,size.width),Math.min(this.height,size.height));},resolve:function(refSize){var size={};pvc_Size.names.forEach(function(length){var lengthValue=this[length];if(lengthValue!=null){if(typeof(lengthValue)==='number'){size[length]=lengthValue;}else if(refSize){var refLength=refSize[length];if(refLength!=null){size[length]=lengthValue.resolve(refLength);}}}},this);return size;}});pvc_Size.names=['width','height'];pvc_Size.namesSet=pv.dict(pvc_Size.names,def.retTrue);pvc_Size.toOrtho=function(value,anchor){if(value!=null){var a_ol;if(anchor){a_ol=pvc.BasePanel.orthogonalLength[anchor];}
value=pvc_Size.to(value,{singleProp:a_ol});if(anchor){delete value[pvc.BasePanel.oppositeLength[a_ol]];}}
return value;};pvc_Size.to=function(v,keyArgs){if(v!=null&&!(v instanceof pvc_Size)){v=new pvc_Size().setSize(v,keyArgs);}
return v;};var pvc_Offset=def.type('pvc.Offset').init(function(x,y){if(arguments.length===1){if(x!=null){this.setOffset(x);}}else{if(x!=null){this.x=x;}
if(y!=null){this.y=y;}}}).add({stringify:function(out,remLevels,keyArgs){return pvc.stringifyRecursive(out,def.copyOwn(this),remLevels,keyArgs);},setOffset:function(offset,keyArgs){if(typeof offset==='string'){var comps=offset.split(/\s+/).map(function(comp){return pvc_PercentValue.parse(comp);});switch(comps.length){case 1:this.set(def.get(keyArgs,'singleProp','all'),comps[0]);return this;case 2:this.set('x',comps[0]);this.set('y',comps[1]);return this;case 0:return this;}}else if(typeof offset==='number'){this.set(def.get(keyArgs,'singleProp','all'),offset);return this;}else if(typeof offset==='object'){this.set('all',offset.all);for(var p in offset){if(p!=='all'){this.set(p,offset[p]);}}
return this;}
if(pvc.debug){pvc.log("Invalid 'offset' value: "+pvc.stringify(offset));}
return this;},set:function(prop,value){if(value!=null&&def.hasOwn(pvc_Offset.namesSet,prop)){value=pvc_PercentValue.parse(value);if(value!=null){if(prop==='all'){pvc_Offset.names.forEach(function(p){this[p]=value;},this);}else{this[prop]=value;}}}},resolve:function(refSize){var offset={};pvc_Size.names.forEach(function(length){var offsetProp=pvc_Offset.namesSizeToOffset[length];var offsetValue=this[offsetProp];if(offsetValue!=null){if(typeof(offsetValue)==='number'){offset[offsetProp]=offsetValue;}else if(refSize){var refLength=refSize[length];if(refLength!=null){offset[offsetProp]=offsetValue.resolve(refLength);}}}},this);return offset;}});pvc_Offset.addStatic({names:['x','y']}).addStatic({namesSet:pv.dict(pvc_Offset.names,def.retTrue),namesSizeToOffset:{width:'x',height:'y'},namesSidesToOffset:{left:'x',right:'x',top:'y',bottom:'y'},as:function(v){if(v!=null&&!(v instanceof pvc_Offset)){v=new pvc_Offset().setOffset(v);}
return v;}});(function($){jQuery.support.svg=jQuery.support.svg||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1");}(jQuery));pvc.text={getFitInfo:function(w,h,text,font,diagMargin){if(text===''){return{h:true,v:true,d:true};}
var len=pv.Text.measure(text,font).width;return{h:len<=w,v:len<=h,d:len<=Math.sqrt(w*w+h*h)-diagMargin};},trimToWidthB:function(len,text,font,trimTerminator,before){len-=pv.Text.measure(trimTerminator,font).width;return pvc.text.trimToWidth(len,text,font,trimTerminator,before);},trimToWidth:function(len,text,font,trimTerminator,before){if(text===''){return text;}
var textLen=pv.Text.measure(text,font).width;if(textLen<=len){return text;}
if(textLen>len*1.5){return pvc.text.trimToWidthBin(len,text,font,trimTerminator,before);}
while(textLen>len){text=before?text.slice(1):text.slice(0,text.length-1);textLen=pv.Text.measure(text,font).width;}
return before?(trimTerminator+text):(text+trimTerminator);},trimToWidthBin:function(len,text,font,trimTerminator,before){var ilen=text.length,high=ilen-2,low=0,mid,textLen;while(low<=high&&high>0){mid=Math.ceil((low+high)/2);var textMid=before?text.slice(ilen-mid):text.slice(0,mid);textLen=pv.Text.measure(textMid,font).width;if(textLen>len){high=mid-1;}else if(pv.Text.measure(before?text.slice(ilen-mid-1):text.slice(0,mid+1),font).width<len){low=mid+1;}else{return before?(trimTerminator+textMid):(textMid+trimTerminator);}}
return before?(trimTerminator+text.slice(ilen-high)):(text.slice(0,high)+trimTerminator);},justify:function(text,lineWidth,font){var lines=[];if(lineWidth<pv.Text.measure('a',font).width){return lines;}
var words=(text||'').split(/\s+/);var line="";while(words.length){var word=words.shift();if(word){var nextLine=line?(line+" "+word):word;if(pv.Text.measure(nextLine,font).width>lineWidth){if(line){lines.push(line);}
line=word;}else{line=nextLine;}}}
if(line){lines.push(line);}
return lines;},getLabelBBox:function(textWidth,textHeight,align,baseline,angle,margin){var polygon=pv.Label.getPolygon(textWidth,textHeight,align,baseline,angle,margin);var bbox=polygon.bbox();bbox.source=polygon;bbox.sourceAngle=angle;bbox.sourceAlign=align;bbox.sourceTextWidth=textWidth;return bbox;}};pvc.color={scale:pvc_colorScale,scales:pvc_colorScales,toGray:pvc.toGrayScale,isGray:pvc_colorIsGray};function pvc_colorIsGray(color){color=pv.color(color);var r=color.r;var g=color.g;var b=color.b;var avg=(r+g+b)/3;var tol=2;return Math.abs(r-avg)<=tol&&Math.abs(g-avg)<=tol&&Math.abs(b-avg)<=tol;}
function pvc_colorScales(keyArgs){keyArgs||def.fail.argumentRequired('keyArgs');var type=keyArgs.type||def.fail.argumentRequired('keyArgs.type');switch(type){case'linear':return new pvc.color.LinearScalesBuild(keyArgs).buildMap();case'discrete':return new pvc.color.DiscreteScalesBuild(keyArgs).buildMap();case'normal':return new pvc.color.NormalScalesBuild(keyArgs).buildMap();}
throw def.error.argumentInvalid('scaleType',"Unexistent scale type '{0}'.",[type]);}
function pvc_colorScale(keyArgs){keyArgs||def.fail.argumentRequired('keyArgs');var type=keyArgs.type||def.fail.argumentRequired('keyArgs.type');switch(type){case'linear':return new pvc.color.LinearScalesBuild(keyArgs).build();case'discrete':return new pvc.color.DiscreteScalesBuild(keyArgs).build();case'normal':return new pvc.color.NormalScalesBuild(keyArgs).build();}
throw def.error.argumentInvalid('scaleType',"Unexistent scale type '{0}'.",[type]);}
def.type('pvc.color.ScalesBuild').init(function(keyArgs){this.keyArgs=keyArgs;this.data=keyArgs.data||def.fail.argumentRequired('keyArgs.data');this.domainDimName=keyArgs.colorDimension||def.fail.argumentRequired('keyArgs.colorDimension');this.domainDim=this.data.dimensions(this.domainDimName);var dimType=this.domainDim.type;if(!dimType.isComparable){this.domainComparer=null;pvc.log("Color value dimension should be comparable. Generated color scale may be invalid.");}else{this.domainComparer=function(a,b){return dimType.compare(a,b);};}
this.nullRangeValue=keyArgs.colorMissing?pv.color(keyArgs.colorMissing):pv.Color.transparent;this.domainRangeCountDif=0;}).add({build:function(){this.range=this._getRange();this.desiredDomainCount=this.range.length+this.domainRangeCountDif;var domain=this._getDomain();return this._createScale(domain);},buildMap:function(){this.range=this._getRange();this.desiredDomainCount=this.range.length+this.domainRangeCountDif;var createCategoryScale;if(this.keyArgs.normPerBaseCategory){createCategoryScale=function(leafData){var domain=this._ensureDomain(null,false,leafData);return this._createScale(domain);};}else{var domain=this._getDomain(),scale=this._createScale(domain);createCategoryScale=def.fun.constant(scale);}
return this._createCategoryScalesMap(createCategoryScale);},_createScale:def.method({isAbstract:true}),_createCategoryScalesMap:function(createCategoryScale){return this.data.children().object({name:function(leafData){return leafData.absKey;},value:createCategoryScale,context:this});},_getRange:function(){var keyArgs=this.keyArgs,range=keyArgs.colors||['red','yellow','green'];if(keyArgs.colorMin!=null&&keyArgs.colorMax!=null){range=[keyArgs.colorMin,keyArgs.colorMax];}else if(keyArgs.colorMin!=null){range.unshift(keyArgs.colorMin);}else if(keyArgs.colorMax!=null){range.push(keyArgs.colorMax);}
return range.map(function(c){return pv.color(c);});},_getDataExtent:function(data){var extent=data.dimensions(this.domainDimName).extent({visible:true});if(!extent){return null;}
var min=extent.min.value,max=extent.max.value;if(max==min){if(max>=1){min=max-1;}else{max=min+1;}}
return{min:min,max:max};},_getDomain:function(){var domain=this.keyArgs.colorDomain;if(domain!=null){if(this.domainComparer){domain.sort(this.domainComparer);}
if(domain.length>this.desiredDomainCount){domain=domain.slice(0,this.desiredDomainCount);}}else{domain=[];}
return this._ensureDomain(domain,true,this.data);},_ensureDomain:function(domain,doDomainPadding,data){var extent;if(domain&&doDomainPadding){var domainPointsMissing=this.desiredDomainCount-domain.length;if(domainPointsMissing>0){extent=this._getDataExtent(data);if(extent){switch(domainPointsMissing){case 1:if(this.domainComparer){def.array.insert(domain,extent.max,this.domainComparer);}else{domain.push(extent.max);}
break;case 2:if(this.domainComparer){def.array.insert(domain,extent.min,this.domainComparer);def.array.insert(domain,extent.max,this.domainComparer);}else{domain.unshift(extent.min);domain.push(extent.max);}
break;default:if(pvc.debug>=2){pvc.log("Ignoring option 'colorDomain' due to unsupported length."+
def.format(" Should have '{0}', but instead has '{1}'.",[this.desiredDomainCount,domain.length]));}
domain=null;}}}}
if(!domain){extent||(extent=this._getDataExtent(data));if(extent){var min=extent.min,max=extent.max;var step=(max-min)/(this.desiredDomainCount-1);domain=pv.range(min,max+step,step);}}
return domain;}});def.type('pvc.color.LinearScalesBuild',pvc.color.ScalesBuild).add({_createScale:function(domain){var scale=pv.Scale.linear();if(domain){scale.domain.apply(scale,domain);}
scale.range.apply(scale,this.range);return scale;}});def.type('pvc.color.DiscreteScalesBuild',pvc.color.ScalesBuild).init(function(keyArgs){this.base(keyArgs);this.domainRangeCountDif=1;}).add({_createScale:function(domain){var Dl=domain.length-1,range=this.range,nullRangeValue=this.nullRangeValue,Rl=range.length-1;function scale(val){if(val==null){return nullRangeValue;}
for(var i=0;i<Dl;i++){if(val<=domain[i+1]){return range[i];}}
return range[Rl];}
def.copy(scale,pv.Scale.common);scale.domain=function(){return domain;};scale.range=function(){return range;};return scale;}});def.space('pvc.trends',function(trends){var _trends={};def.set(trends,'define',function(type,trendSpec){type||def.fail.argumentRequired('type');trendSpec||def.fail.argumentRequired('trendSpec');def.object.is(trendSpec)||def.fail.argumentInvalid('trendSpec',"Must be a trend specification object.");type=(''+type).toLowerCase();if(pvc.debug>=2&&def.hasOwn(_trends,type)){pvc.log(def.format("[WARNING] A trend type with the name '{0}' is already defined.",[type]));}
var label=trendSpec.label||def.fail.argumentRequired('trendSpec.label');var model=trendSpec.model||def.fail.argumentRequired('trendSpec.model');def.fun.is(model)||def.fail.argumentInvalid('trendSpec.mode',"Must be a function.");var trendInfo={dataPartAtom:{v:'trend',f:label},type:type,label:label,model:model};_trends[type]=trendInfo;},'get',function(type){type||def.fail.argumentRequired('type');return def.getOwn(_trends,type)||def.fail.operationInvalid("Undefined trend type '{0}'.",[type]);},'has',function(type){return def.hasOwn(_trends,type);},'types',function(){return def.ownKeys(_trends);});trends.define('linear',{label:'Linear trend',model:function(options){var rows=def.get(options,'rows');var funX=def.get(options,'x');var funY=def.get(options,'y');var i=0;var N=0;var sumX=0;var sumY=0;var sumXY=0;var sumXX=0;var parseNum=function(value){return value!=null?(+value):NaN;};while(rows.next()){var row=rows.item;var x=funX?parseNum(funX(row)):i;if(!isNaN(x)){var y=parseNum(funY(row));if(!isNaN(y)){N++;sumX+=x;sumY+=y;sumXY+=x*y;sumXX+=x*x;}}
i++;}
var alpha,beta;if(N>=2){var avgX=sumX/N;var avgY=sumY/N;var avgXY=sumXY/N;var avgXX=sumXX/N;var den=(avgXX-avgX*avgX);if(den===0){beta=0;}else{beta=(avgXY-(avgX*avgY))/den;}
alpha=avgY-beta*avgX;return{alpha:alpha,beta:beta,reset:def.noop,sample:function(x){return alpha+beta*(+x);}};}}});trends.define('moving-average',{label:'Moving average',model:function(options){var W=Math.max(+(def.get(options,'periods')||3),2);var sum=0;var avgValues=[];return{reset:function(){sum=0;avgValues.length=0;},sample:function(x,y,i){var L=W;if(y!=null){avgValues.unshift(y);sum+=y;L=avgValues.length;if(L>W){sum-=avgValues.pop();L=W;}}
return sum/L;}};}});trends.define('weighted-moving-average',{label:'Weighted Moving average',model:function(options){var W=Math.max(+(def.get(options,'periods')||3),2);var sum=0;var numer=0;var avgValues=[];var L=0;var denom=0;return{reset:function(){sum=numer=denom=L=0;avgValues.length=0;},sample:function(x,y){if(y!=null){if(L<W){avgValues.push(y);L++;denom+=L;numer+=L*y;sum+=y;}else{numer+=(L*y)-sum;sum+=y-avgValues[0];for(var j=1;j<W;j++){avgValues[j-1]=avgValues[j];}
avgValues[W-1]=y;}}
return numer/denom;}};}});});function pvc_options(specs,context){specs||def.fail.argumentRequired('specs');var _infos={};def.each(specs,function(spec,name){var info=new pvc_OptionInfo(name,option,context,spec);_infos[info.name]=info;});function resolve(name){var info=def.getOwn(_infos,name)||def.fail.operationInvalid("Undefined option '{0}'",[name]);return info.resolve();}
function option(name,noDefault){var info=resolve(name);return noDefault&&!info.isSpecified?undefined:info.value;}
function isSpecified(name){return resolve(name).isSpecified;}
function specified(name){return option(name,true);}
function isDefined(name){return def.hasOwn(_infos,name);}
function specify(opts){return set(opts,false);}
function defaults(opts){return set(opts,true);}
function getDefaultValue(name){return resolve(name)._defaultValue;}
function set(opts,isDefault){for(var name in opts){var info=def.getOwn(_infos,name);if(info){var value=opts[name];if(value!==undefined){info.set(value,isDefault);}}}
return option;}
option.option=option;option.specified=specified;option.isSpecified=isSpecified;option.isDefined=isDefined;option.defaultValue=getDefaultValue;option.specify=specify;option.defaults=defaults;return option;}
function options_resolvers(list){return function(optionInfo){for(var i=0,L=list.length;i<L;i++){var m=list[i];if(def.string.is(m)){m=this[m];}
if(m.call(this,optionInfo)===true){return true;}}};}
function options_constantResolver(value,op){return function(optionInfo){optionInfo.specify(value);return true;};}
function options_specifyResolver(fun,op){return function(optionInfo){var value=fun.call(this,optionInfo);if(value!==undefined){optionInfo.specify(value);return true;}};}
function options_defaultResolver(fun){return function(optionInfo){var value=fun.call(this,optionInfo);if(value!==undefined){optionInfo.defaultValue(value);return true;}};}
pvc_options.resolvers=options_resolvers;pvc_options.constant=options_constantResolver;pvc_options.specify=options_specifyResolver;pvc_options.defaultValue=options_defaultResolver;pvc.options=pvc_options;var pvc_OptionInfo=def.type().init(function(name,option,context,spec){this.name=name;this._context=context;this.option=option;this._cast=def.get(spec,'cast');var value=def.get(spec,'value');if(value!==undefined){this._defaultValue=this.value=value;}
var resolve=def.get(spec,'resolve');if(resolve){this._resolve=resolve;}
else{this.isResolved=true;}
var getDefault=def.get(spec,'getDefault');if(getDefault){this._getDefault=getDefault;}
var data=def.get(spec,'data');if(data!=null){this.data=data;}
this.alias=def.array.to(def.get(spec,'alias'));}).add({isSpecified:false,isResolved:false,value:undefined,_defaultValue:undefined,resolve:function(){if(!this.isResolved){this.isResolved=true;this._getFunProp('_resolve').call(this._context,this);if(this.value==null){var value=this._dynDefault();if(value!=null){delete this.isSpecified;this.value=this._defaultValue=value;}}}
return this;},specify:function(value){return this.set(value,false);},defaultValue:function(defaultValue){if(defaultValue!==undefined){this.set(defaultValue,true);}
return this._defaultValue;},cast:function(value){if(value!=null){var cast=this._getFunProp('_cast');if(cast){value=cast.call(this._context,value,this);}}
return value;},set:function(value,isDefault){if(value!=null){value=this.cast(value);}
if(value==null){value=this._dynDefault();if(value!=null){isDefault=true;}}
if(!isDefault){this.isSpecified=true;this.isResolved=true;this.value=value;}else{delete this.isSpecified;this._defaultValue=value;if(!this.isSpecified){this.value=value;}}
return this;},_dynDefault:function(){var get=this._getFunProp('_getDefault');return get&&this.cast(get.call(this._context,this));},_getFunProp:function(name){var fun=this[name];if(fun){var context=this._context;if(context&&def.string.is(fun)){fun=context[fun];}}
return fun;}});def.global.NoDataException=function(){};pvc.data={visibleKeyArgs:{visible:true}};function data_disposeChildList(list,parentProp){if(list){list.forEach(function(child){if(parentProp){child[parentProp]=null;}
child.dispose();});list.length=0;}}
function data_addColChild(parent,childrenProp,child,parentProp,index){(child&&!child[parentProp])||def.assert("Must not have a '"+parentProp+"'.");child[parentProp]=parent;var col=(parent[childrenProp]||(parent[childrenProp]=[]));if(index==null||index>=col.length){col.push(child);}else{col.splice(index,0,child);}}
function data_removeColChild(parent,childrenProp,child,parentProp){(child&&(!child[parentProp]||child[parentProp]===parent))||def.assert("Not a child");var children=parent[childrenProp];if(children){var index=children.indexOf(child);if(index>=0){def.array.removeAt(children,index);}}
child[parentProp]=null;}
def.type('pvc.data.DimensionType').init(function(complexType,name,keyArgs){this.complexType=complexType;this.name=name;this.label=def.get(keyArgs,'label')||pvc.buildTitleFromName(name);var groupAndLevel=pvc.splitIndexedId(name);this.group=groupAndLevel[0];this.groupLevel=def.nullyTo(groupAndLevel[1],0);if(this.label.indexOf('{')>=0){this.label=def.format(this.label,[this.groupLevel+1]);}
this.playedVisualRoles=new def.Map();this.isHidden=!!def.get(keyArgs,'isHidden');var valueType=def.get(keyArgs,'valueType')||null;var valueTypeName=pvc.data.DimensionType.valueTypeName(valueType);var cast=def.getOwn(pvc.data.DimensionType.cast,valueTypeName,null);this.valueType=valueType;this.valueTypeName=valueTypeName;this.cast=cast;this.isDiscreteValueType=(this.valueType!==Number&&this.valueType!==Date);this.isDiscrete=def.get(keyArgs,'isDiscrete');if(this.isDiscrete==null){this.isDiscrete=this.isDiscreteValueType;}else{this.isDiscrete=!!this.isDiscrete;if(!this.isDiscrete&&this.isDiscreteValueType){throw def.error.argumentInvalid('isDiscrete',"The only supported continuous value types are Number and Date.");}}
this._converter=def.get(keyArgs,'converter')||null;if(!this._converter){var rawFormat=def.get(keyArgs,'rawFormat');if(rawFormat){switch(this.valueType){case Date:this._converter=pv.Format.createParser(pv.Format.date(rawFormat));break;}}}
this._key=def.get(keyArgs,'key')||null;this._comparer=def.get(keyArgs,'comparer');if(this._comparer===undefined){switch(this.valueType){case Number:case Date:this._comparer=def.compare;break;default:this._comparer=null;}}
this.isComparable=this._comparer!=null;this._formatter=def.get(keyArgs,'formatter')||null;if(!this._formatter){switch(this.valueType){case Number:this._formatter=pv.Format.createFormatter(pv.Format.number().fractionDigits(0,2));break;case Date:var format=def.get(keyArgs,'format');if(!format){format=def.get(keyArgs,'rawFormat');if(format){format=format.replace(/-/g,"/");}}
if(!format){format="%Y/%m/%d";}
this._formatter=pv.Format.createFormatter(pv.Format.date(format));break;}}}).add({isCalculated:false,compare:function(a,b){if(a==null){if(b==null){return 0;}
return-1;}else if(b==null){return 1;}
return this._comparer.call(null,a,b);},comparer:function(reverse){if(!this.isComparable){return null;}
var me=this;if(reverse){return this._reverseComparer||(this._reverseComparer=function(a,b){return me.compare(b,a);});}
return this._directComparer||(this._directComparer=function(a,b){return me.compare(a,b);});},atomComparer:function(reverse){if(reverse){return this._reverseAtomComparer||(this._reverseAtomComparer=this._createReverseAtomComparer());}
return this._directAtomComparer||(this._directAtomComparer=this._createDirectAtomComparer());},_toDiscrete:function(){this.isDiscrete=true;},_toCalculated:function(){this.isCalculated=true;},_createReverseAtomComparer:function(){if(!this.isComparable){return atom_idComparerReverse;}
var me=this;function reverseAtomComparer(a,b){if(a===b){return 0;}
return me.compare(b.value,a.value);}
return reverseAtomComparer;},_createDirectAtomComparer:function(){if(!this.isComparable){return atom_idComparer;}
var me=this;function directAtomComparer(a,b){if(a===b){return 0;}
return me.compare(a.value,b.value);}
return directAtomComparer;},formatter:function(){return this._formatter;},converter:function(){return this._converter;},playingPercentVisualRole:function(){return def.query(this.playedVisualRoles.values()).any(function(visualRole){return visualRole.isPercent;});}});pvc.data.DimensionType.cast={'Date':function(value){return value instanceof Date?value:new Date(value);},'Number':function(value){value=Number(value);return isNaN(value)?null:value;},'String':String,'Boolean':Boolean,'Object':Object,'Any':null};pvc.data.DimensionType.dimensionGroupName=function(dimName){return dimName.replace(/^(.*?)(\d*)$/,"$1");};pvc.data.DimensionType.valueTypeName=function(valueType){if(valueType==null){return"Any";}
switch(valueType){case Boolean:return'Boolean';case Number:return'Number';case String:return'String';case Object:return'Object';case Date:return'Date';default:throw def.error.argumentInvalid('valueType',"Invalid valueType function: '{0}'.",[valueType]);}};pvc.data.DimensionType.extendSpec=function(dimName,dimSpec,keyArgs){var dimGroup=pvc.data.DimensionType.dimensionGroupName(dimName),userDimGroupsSpec=def.get(keyArgs,'dimensionGroups');if(userDimGroupsSpec){var groupDimSpec=userDimGroupsSpec[dimGroup];if(groupDimSpec){dimSpec=def.create(groupDimSpec,dimSpec);}}
if(!dimSpec){dimSpec={};}
switch(dimGroup){case'category':var isCategoryTimeSeries=def.get(keyArgs,'isCategoryTimeSeries',false);if(isCategoryTimeSeries){if(dimSpec.valueType===undefined){dimSpec.valueType=Date;}}
break;case'value':if(dimSpec.valueType===undefined){dimSpec.valueType=Number;}
if(dimSpec.valueType===Number){if(dimSpec.formatter===undefined&&!dimSpec.format){dimSpec.formatter=def.get(keyArgs,'valueNumberFormatter');}}
break;}
if(dimSpec.converter===undefined&&dimSpec.valueType===Date&&!dimSpec.rawFormat){dimSpec.rawFormat=def.get(keyArgs,'timeSeriesFormat');}
return dimSpec;};function dimType_addVisualRole(visualRole){this.playedVisualRoles.set(visualRole.name,visualRole);compType_dimensionRolesChanged.call(this.complexType,this);}
function dimType_removeVisualRole(visualRole){this.playedVisualRoles.rem(visualRole.name);compType_dimensionRolesChanged.call(this.complexType,this);}
def.type('pvc.data.ComplexType').init(function(dimTypeSpecs){this._dims={};this._dimsList=[];this._dimsNames=[];this._calculations=[];this._calculatedDimNames={};this._dimsIndexByName=null;this._dimsByGroup={};this._dimsNamesByGroup={};if(dimTypeSpecs){for(var name in dimTypeSpecs){this.addDimension(name,dimTypeSpecs[name]);}}}).add({describe:function(){var out=["COMPLEX TYPE INFORMATION",pvc.logSeparator];this._dimsList.forEach(function(type){var features=[];features.push(type.valueTypeName);if(type.isComparable){features.push("comparable");}
if(!type.isDiscrete){features.push("continuous");}
if(type.isHidden){features.push("hidden");}
out.push("  "+type.name+" ("+features.join(', ')+")");});return out.join("\n");},dimensions:function(name,keyArgs){if(name==null){return this._dims;}
var dimType=def.getOwn(this._dims,name,null);if(!dimType&&def.get(keyArgs,'assertExists',true)){throw def.error.argumentInvalid('name',"Undefined dimension '{0}'",[name]);}
return dimType;},dimensionsList:function(){return this._dimsList;},calculatedDimensionsList:function(){return this._calcDimsList;},dimensionsNames:function(){return this._dimsNames;},groupDimensions:function(group,keyArgs){var dims=def.getOwn(this._dimsByGroup,group);if(!dims&&def.get(keyArgs,'assertExists',true)){throw def.error.operationInvalid("There is no dimension type group with name '{0}'.",[group]);}
return dims;},groupDimensionsNames:function(group,keyArgs){var dimNames=def.getOwn(this._dimsNamesByGroup,group);if(!dimNames&&def.get(keyArgs,'assertExists',true)){throw def.error.operationInvalid("There is no dimension type group with name '{0}'.",[group]);}
return dimNames;},addDimension:function(name,dimTypeSpec){name||def.fail.argumentRequired('name');!def.hasOwn(this._dims,name)||def.fail.operationInvalid("A dimension type with name '{0}' is already defined.",[name]);var dimension=new pvc.data.DimensionType(this,name,dimTypeSpec);this._dims[name]=dimension;this._dimsIndexByName=null;var group=dimension.group;var groupLevel;if(group){var groupDims=def.getOwn(this._dimsByGroup,group),groupDimsNames;if(!groupDims){groupDims=this._dimsByGroup[group]=[];groupDimsNames=this._dimsNamesByGroup[group]=[];}else{groupDimsNames=this._dimsNamesByGroup[group];}
groupLevel=def.array.insert(groupDimsNames,name,def.compare);groupLevel=~groupLevel;def.array.insertAt(groupDims,groupLevel,dimension);}
var index;var L=this._dimsList.length;if(!group){index=L;}else{groupLevel=dimension.groupLevel;for(var i=0;i<L;i++){var dim=this._dimsList[i];if(dim.group===group){if(dim.groupLevel>groupLevel){index=i;break;}
index=i+1;}}
if(index==null){index=L;}}
def.array.insertAt(this._dimsList,index,dimension);def.array.insertAt(this._dimsNames,index,name);if(dimension._calculate){index=def.array.binarySearch(this._calcDimsList,dimension._calculationOrder,def.compare,function(dimType){return dimType._calculationOrder;});if(index>=0){index++;}else{index=~index;}
def.array.insertAt(this._calcDimsList,index,dimension);}
this._isPctRoleDimTypeMap=null;return dimension;},addCalculation:function(calcSpec,dimsOptions){calcSpec||def.fail.argumentRequired('calcSpec');var calculation=calcSpec.calculation||def.fail.argumentRequired('calculations[i].calculation');var dimNames=calcSpec.names;if(typeof dimNames==='string'){dimNames=dimNames.split(/\s*\,\s*/);}else{dimNames=def.array.as(dimNames);}
if(dimNames&&dimNames.length){var calcDimNames=this._calculatedDimNames;dimNames.forEach(function(name){if(name){name=name.replace(/^\s*(.+?)\s*$/,"$1");!def.hasOwn(calcDimNames,name)||def.fail.argumentInvalid('calculations[i].names',"Dimension name '{0}' is already being calculated.",[name]);var dimType=this._dims[name];if(!dimType){var dimSpec=pvc.data.DimensionType.extendSpec(name,null,dimsOptions);this.addDimension(name,dimSpec);}
calcDimNames[name]=true;dimType._toCalculated();}},this);}
this._calculations.push(calculation);},isCalculated:function(dimName){return def.hasOwn(this._calculatedDimNames,dimName);},_calculate:function(complex){var calcs=this._calculations;if(calcs.length){var valuesByName={};calcs.forEach(function(calc){calc(complex,valuesByName);});return valuesByName;}},getPlayingPercentVisualRoleDimensionMap:function(){var map=this._isPctRoleDimTypeMap;if(!map){map=this._isPctRoleDimTypeMap=new def.Map(def.query(def.own(this._dims)).where(function(dimType){return dimType.playingPercentVisualRole();}).object({name:function(dimType){return dimType.name;}}));}
return map;},sortDimensionNames:function(dims,nameKey){var dimsIndexByName=this._dimsIndexByName;if(!dimsIndexByName){dimsIndexByName=def.query(this._dimsList).object({name:function(dim){return dim.name;},value:function(dim,index){return index;}});this._dimsIndexByName=dimsIndexByName;}
dims.sort(function(da,db){return def.compare(dimsIndexByName[nameKey?nameKey(da):da],dimsIndexByName[nameKey?nameKey(db):db]);});return dims;}});function compType_dimensionRolesChanged(dimType){this._isPctRoleDimTypeMap=null;}
def.type('pvc.data.ComplexTypeProject').init(function(dimGroupSpecs){this._dims={};this._dimList=[];this._dimGroupsDims={};this._dimGroupSpecs=dimGroupSpecs||{};this._calcList=[];}).add({_ensureDim:function(name,spec){name||def.fail.argumentInvalid('name',"Invalid dimension name '{0}'.",[name]);var info=def.getOwn(this._dims,name);if(!info){info=this._dims[name]=this._createDim(name,spec);this._dimList.push(info);var groupDimsNames=def.array.lazy(this._dimGroupsDims,info.groupName);def.array.insert(groupDimsNames,name,def.compare);}else if(spec){def.setUDefaults(info.spec,spec);}
return info;},hasDim:function(name){return def.hasOwn(this._dims,name);},setDim:function(name,spec){var _=this._ensureDim(name).spec;if(spec){def.copy(_,spec);}
return this;},setDimDefaults:function(name,spec){def.setUDefaults(this._ensureDim(name).spec,spec);return this;},_createDim:function(name,spec){var dimGroupName=pvc.data.DimensionType.dimensionGroupName(name);var dimGroupSpec=this._dimGroupSpecs[dimGroupName];if(dimGroupSpec){spec=def.create(dimGroupSpec,spec);}
return{name:name,groupName:dimGroupName,spec:spec||{}};},readDim:function(name,spec){var info=this._ensureDim(name,spec);if(info.isRead){throw def.error.operationInvalid("Dimension '{0}' already is the target of a reader.",[name]);}
if(info.isCalc){throw def.error.operationInvalid("Dimension '{0}' is being calculated, so it cannot be the target of a reader.",[name]);}
info.isRead=true;},calcDim:function(name,spec){var info=this._ensureDim(name,spec);if(info.isCalc){throw def.error.operationInvalid("Dimension '{0}' already is being calculated.",[name]);}
if(info.isRead){throw def.error.operationInvalid("Dimension '{0}' is the target of a reader, so it cannot be calculated.",[name]);}
info.isCalc=true;},isReadOrCalc:function(name){if(name){var info=def.getOwn(this._dims,name);if(info){return info.isRead||info.isCalc;}}
return false;},groupDimensionsNames:function(groupDimName){return this._dimGroupsDims[groupDimName];},setCalc:function(calcSpec){calcSpec||def.fail.argumentRequired('calculations[i]');calcSpec.calculation||def.fail.argumentRequired('calculations[i].calculation');var dimNames=calcSpec.names;if(typeof dimNames==='string'){dimNames=dimNames.split(/\s*\,\s*/);}
else{dimNames=def.array.as(dimNames);}
if(dimNames&&dimNames.length){dimNames.forEach(this.calcDim,this);}
this._calcList.push(calcSpec);},configureComplexType:function(complexType,translOptions){this._dimList.forEach(function(dimInfo){var dimName=dimInfo.name;var spec=dimInfo.spec;spec=pvc.data.DimensionType.extendSpec(dimName,spec,translOptions);complexType.addDimension(dimName,spec);});this._calcList.forEach(function(calcSpec){complexType.addCalculation(calcSpec);});}});def.type('pvc.data.TranslationOper').init(function(chart,complexTypeProj,source,metadata,options){this.chart=chart;this.complexTypeProj=complexTypeProj;this.source=source;this.metadata=metadata||{};this.options=options||{};this._initType();if(pvc.debug>=4){this._logItems=true;this._logItemCount=0;}}).add({_logItems:false,logSource:def.method({isAbstract:true}),logVItem:def.method({isAbstract:true}),_translType:"Unknown",logTranslatorType:function(){return this._translType+" data source translator";},virtualItemSize:function(){return this.metadata.length;},freeVirtualItemSize:function(){return this.virtualItemSize()-this._userUsedIndexesCount;},setSource:function(source){if(!source){throw def.error.argumentRequired('source');}
this.source=source;},defReader:function(dimReaderSpec){dimReaderSpec||def.fail.argumentRequired('readerSpec');var dimNames;if(def.string.is(dimReaderSpec)){dimNames=dimReaderSpec;}
else{dimNames=dimReaderSpec.names;}
if(def.string.is(dimNames)){dimNames=dimNames.split(/\s*\,\s*/);}
else{dimNames=def.array.as(dimNames);}
var indexes=def.array.as(dimReaderSpec.indexes);if(indexes){indexes.forEach(this._userUseIndex,this);}
var hasDims=!!(dimNames&&dimNames.length);var reader=dimReaderSpec.reader;if(!reader){if(hasDims){return this._userCreateReaders(dimNames,indexes);}
if(indexes){indexes.forEach(function(index){this._userIndexesToSingleDim[index]=null;},this);}}else{hasDims||def.fail.argumentRequired('reader.names',"Required argument when a reader function is specified.");this._userRead(reader,dimNames);}
return indexes;},configureType:function(){this._configureTypeCore();},_configureTypeCore:def.method({isAbstract:true}),_initType:function(){this._userDimsReaders=[];this._userDimsReadersByDim={};this._userItem=[];this._userUsedIndexes={};this._userUsedIndexesCount=0;this._userIndexesToSingleDim=[];var userDimReaders=this.options.readers;if(userDimReaders){userDimReaders.forEach(this.defReader,this);}
var multiChartIndexes=pvc.parseDistinctIndexArray(this.options.multiChartIndexes);if(multiChartIndexes){this._multiChartIndexes=this.defReader({names:'multiChart',indexes:multiChartIndexes});}},_userUseIndex:function(index){index=+index;if(index<0){throw def.error.argumentInvalid('index',"Invalid reader index: '{0}'.",[index]);}
if(def.hasOwn(this._userUsedIndexes,index)){throw def.error.argumentInvalid('index',"Virtual item index '{0}' is already assigned.",[index]);}
this._userUsedIndexes[index]=true;this._userUsedIndexesCount++;this._userItem[index]=true;return index;},_userCreateReaders:function(dimNames,indexes){if(!indexes){indexes=[];}else{indexes.forEach(function(index,j){indexes[j]=+index;});}
var I=indexes.length,N=dimNames.length,dimName;if(N>I){var nextIndex=I>0?(indexes[I-1]+1):0;do{nextIndex=this._nextAvailableItemIndex(nextIndex);indexes[I]=nextIndex;this._userUseIndex(nextIndex);I++;}while(N>I);}
var L=(I===N)?N:(N-1);var index;for(var n=0;n<L;n++){dimName=dimNames[n];index=indexes[n];this._userIndexesToSingleDim[index]=dimName;this._userRead(this._propGet(dimName,index),dimName);}
if(L<N){var splitGroupName=pvc.splitIndexedId(dimNames[N-1]),groupName=splitGroupName[0],level=def.nullyTo(splitGroupName[1],0);for(var i=L;i<I;i++,level++){dimName=pvc.buildIndexedId(groupName,level);index=indexes[i];this._userIndexesToSingleDim[index]=dimName;this._userRead(this._propGet(dimName,index),dimName);}}
return indexes;},_userRead:function(reader,dimNames){def.fun.is(reader)||def.fail.argumentInvalid('reader',"Reader must be a function.");if(def.array.is(dimNames)){dimNames.forEach(function(name){this._readDim(name,reader);},this);}else{this._readDim(dimNames,reader);}
this._userDimsReaders.push(reader);},_readDim:function(name,reader){var info,spec;var index=this._userIndexesToSingleDim.indexOf(name);if(index>=0){info=this._itemInfos[index];if(info&&!this.options.ignoreMetadataLabels){var label=info.label||info.name;if(label){spec={label:label};}}}
this.complexTypeProj.readDim(name,spec);this._userDimsReadersByDim[name]=reader;},execute:function(data){this.data=data;return this._executeCore();},_executeCore:function(){var dimsReaders=this._getDimensionsReaders();return def.query(this._getItems()).select(function(item){return this._readItem(item,dimsReaders);},this);},_getItems:function(){return this.source;},_getDimensionsReaders:function(){return this._userDimsReaders;},_readItem:function(item,dimsReaders){var logItem=this._logItems;if(logItem){var logItemCount=this._logItemCount;if(logItemCount<10){pvc.log('virtual item ['+this._logItemCount+']: '+pvc.stringify(item));this._logItemCount++;}else{pvc.log('...');logItem=this._logItems=false;}}
var r=0,R=dimsReaders.length,a=0,data=this.data,valuesByDimName={};while(r<R){dimsReaders[r++].call(data,item,valuesByDimName);}
if(logItem){var atoms={};for(var dimName in valuesByDimName){var atom=valuesByDimName[dimName];if(def.object.is(atom)){atom=('v'in atom)?atom.v:('value'in atom)?atom.value:'...';}
atoms[dimName]=atom;}
pvc.log('-> read: '+pvc.stringify(atoms));}
return valuesByDimName;},_propGet:function(dimName,prop){function propGet(item,atoms){atoms[dimName]=item[prop];}
return propGet;},_nextAvailableItemIndex:function(index,L){if(index==null){index=0;}
if(L==null){L=Infinity;}
while(index<L&&def.hasOwn(this._userItem,index)){index++;}
return index<L?index:-1;},_getUnboundRoleDefaultDimNames:function(roleName,count,dims,level){var role=this.chart.visualRoles[roleName];if(role&&!role.isPreBound()){var dimGroupName=role.defaultDimensionName;if(dimGroupName){dimGroupName=dimGroupName.match(/^(.*?)(\*)?$/)[1];if(!dims){dims=[];}
if(level==null){level=0;}
if(count==null){count=1;}
while(count--){var dimName=pvc.buildIndexedId(dimGroupName,level++);if(!this.complexTypeProj.isReadOrCalc(dimName)){dims.push(dimName);}}
return dims.length?dims:null;}}},collectFreeDiscreteAndConstinuousIndexes:function(freeDisIndexes,freeMeaIndexes){this._itemInfos.forEach(function(info,index){if(!this._userUsedIndexes[index]){var indexes=info.type===1?freeMeaIndexes:freeDisIndexes;if(indexes){indexes.push(index);}}},this);}});def.type('pvc.data.MatrixTranslationOper',pvc.data.TranslationOper).add({_initType:function(){this.J=this.metadata.length;this.I=this.source.length;this._processMetadata();this.base();},setSource:function(source){this.base(source);this.I=this.source.length;},_knownContinuousColTypes:{'numeric':1,'number':1,'integer':1},_processMetadata:function(){var knownContinColTypes=this._knownContinuousColTypes;var columns=def.query(this.metadata).select(function(colDef,colIndex){colDef.colIndex=colIndex;return colDef;}).where(function(colDef){var colType=colDef.colType;return!colType||knownContinColTypes[colType.toLowerCase()]!==1;}).select(function(colDef){return colDef.colIndex;}).array();var columnTypes=def.array.create(this.J,1);var I=this.I;var source=this.source;var J=columns.length;for(var i=0;i<I&&J>0;i++){var row=source[i];var m=0;while(m<J){var j=columns[m];var value=row[j];if(value!=null){columnTypes[j]=this._getSourceValueType(value);columns.splice(m,1);J--;}else{m++;}}}
this._columnTypes=columnTypes;},_buildItemInfoFromMetadata:function(index){var meta=this.metadata[index];return{type:this._columnTypes[index],name:meta.colName,label:meta.colLabel};},_getSourceValueType:function(value){switch(typeof value){case'number':return 1;case'object':if(value instanceof Date){return 1;}}
return 0;},logSource:function(){var out=["DATA SOURCE SUMMARY",pvc.logSeparator,"ROWS ("+Math.min(10,this.I)+"/"+this.I+")"];def.query(this.source).take(10).each(function(row,index){out.push("  ["+index+"] "+pvc.stringify(row));});if(this.I>10){out.push('  ...');}
out.push("COLS ("+this.J+")");var colTypes=this._columnTypes;this.metadata.forEach(function(col,j){out.push("  ["+j+"] "+"'"+col.colName+"' ("+"type: "+col.colType+", "+"inspected: "+(colTypes[j]?'number':'string')+
(col.colLabel?(", label: '"+col.colLabel+"'"):"")+")");});out.push("");return out.join('\n');},_logVItem:function(kindList,kindScope){var out=["VIRTUAL ITEM ARRAY",pvc.logSeparator];var maxName=4;var maxLabel=5;var maxDim=9;this._itemInfos.forEach(function(info,index){maxName=Math.max(maxName,(info.name||'').length);maxLabel=Math.max(maxLabel,(info.label||'').length);var dimName=this._userIndexesToSingleDim[index];if(dimName){maxDim=Math.max(maxDim,dimName.length);}},this);out.push("Index | Kind | Type   | "+
def.string.padRight("Name",maxName)+" | "+
def.string.padRight("Label",maxLabel)+" > "+"Dimension","------+------+--------+-"+
def.string.padRight("",maxName,"-")+"-+-"+
def.string.padRight("",maxLabel,"-")+"-+-"+
def.string.padRight("",maxDim,"-")+"-");var index=0;kindList.forEach(function(kind){for(var i=0,L=kindScope[kind];i<L;i++){var info=this._itemInfos[index];var dimName=this._userIndexesToSingleDim[index];if(dimName===undefined){dimName='';}
out.push(" "+index+"    | "+
kind+"    | "+
(info.type?'number':'string')+" | "+
def.string.padRight(info.name||'',maxName)+" | "+
def.string.padRight(info.label||'',maxLabel)+" | "+
dimName);index++;}},this);out.push("");return out.join("\n");},_createPlot2SeriesKeySet:function(plot2DataSeriesIndexes,seriesKeys){var plot2SeriesKeySet=null,seriesCount=seriesKeys.length;def.query(plot2DataSeriesIndexes).each(function(indexText){var seriesIndex=+indexText;if(isNaN(seriesIndex)){throw def.error.argumentInvalid('plot2DataSeriesIndexes',"Element is not a number '{0}'.",[indexText]);}
if(seriesIndex<0){if(seriesIndex<=-seriesCount){throw def.error.argumentInvalid('plot2DataSeriesIndexes',"Index is out of range '{0}'.",[seriesIndex]);}
seriesIndex=seriesCount+seriesIndex;}else if(seriesIndex>=seriesCount){throw def.error.argumentInvalid('plot2DataSeriesIndexes',"Index is out of range '{0}'.",[seriesIndex]);}
if(!plot2SeriesKeySet){plot2SeriesKeySet={};}
plot2SeriesKeySet[seriesKeys[seriesIndex]]=true;});return plot2SeriesKeySet;},_dataPartGet:function(calcAxis2SeriesKeySet,seriesReader){var me=this;var dataPartDimName=this.options.dataPartDimName;var dataPartDimension,plot2SeriesKeySet,part1Atom,part2Atom,outAtomsSeries={};function dataPartGet(item,outAtoms){if(!dataPartDimension){plot2SeriesKeySet=calcAxis2SeriesKeySet();dataPartDimension=me.data.dimensions(dataPartDimName);if(pvc.debug>=3&&plot2SeriesKeySet){pvc.log("Second axis series values: "+pvc.stringify(def.keys(plot2SeriesKeySet)));}}
var partAtom;seriesReader(item,outAtomsSeries);var series=outAtomsSeries.series;if(series!=null&&series.v!=null){series=series.v;}
if(def.hasOwn(plot2SeriesKeySet,series)){partAtom=part2Atom||(part2Atom=dataPartDimension.intern("1"));}else{partAtom=part1Atom||(part1Atom=dataPartDimension.intern("0"));}
outAtoms[dataPartDimName]=partAtom;}
return dataPartGet;}});def.type('pvc.data.CrosstabTranslationOper',pvc.data.MatrixTranslationOper).add({_translType:"Crosstab",virtualItemSize:function(){return this.R+this.C+this.M;},_executeCore:function(){if(!this.metadata.length){return def.query();}
var dimsReaders=this._getDimensionsReaders();var item=new Array(this.virtualItemSize()),itemCrossGroupIndex=this._itemCrossGroupIndex,me=this;function updateVItemCrossGroup(crossGroupId,source){var itemIndex=itemCrossGroupIndex[crossGroupId],sourceIndex=0,depth=me[crossGroupId];while((depth--)>0){item[itemIndex++]=source[sourceIndex++];}}
function updateVItemMeasure(line,cg){var itemIndex=itemCrossGroupIndex.M;var cgIndexes=me._colGroupsIndexes[cg];var depth=me.M;for(var i=0;i<depth;i++){var lineIndex=cgIndexes[i];item[itemIndex++]=lineIndex!=null?line[lineIndex]:null;}}
function expandLine(line){updateVItemCrossGroup('R',line);return def.query(this._colGroups).select(function(colGroup,cg){updateVItemCrossGroup('C',colGroup);updateVItemMeasure(line,cg);return this._readItem(item,dimsReaders);},this);}
return def.query(this.source).selectMany(expandLine,this);},_processMetadata:function(){this.base();this._separator=this.options.separator||'~';var R=this.R=1;this.C=1;this.M=1;this.measuresDirection=null;var colNames;var metadata=this.metadata;if(this.options.seriesInRows){colNames=metadata.map(function(d){return d.colName;});}else if(this.options.compatVersion<=1){colNames=metadata.map(function(d){return{v:d.colName};});}else{colNames=metadata.map(function(d){return{v:d.colName,f:d.colLabel};});}
var itemCrossGroupInfos=this._itemCrossGroupInfos={};if(!this.options.isMultiValued){R=this.R=this._getCategoriesCount();this._colGroups=colNames.slice(R);this._colGroupsIndexes=new Array(this._colGroups.length);this._colGroups.forEach(function(colGroup,cg){this._colGroups[cg]=[colGroup];this._colGroupsIndexes[cg]=[R+cg];},this);itemCrossGroupInfos.C=[{type:0}];itemCrossGroupInfos.M=[{type:this._columnTypes[R]}];}else{var measuresInColumns=def.get(this.options,'measuresInColumns',true);if(measuresInColumns||this.options.measuresIndex==null){R=this.R=this._getCategoriesCount();var encodedColGroups=colNames.slice(R);var L=encodedColGroups.length;if(L>0){if(!measuresInColumns){this._colGroups=encodedColGroups;this._colGroupsIndexes=[];this._colGroups.forEach(function(colGroup,cg){this._colGroups[cg]=this._splitEncodedColGroupCell(colGroup);this._colGroupsIndexes[cg]=[this.R+cg];},this);itemCrossGroupInfos.M=[this._buildItemInfoFromMetadata(R)];}else{this.measuresDirection='columns';this._processEncodedColGroups(encodedColGroups);}
this.C=this._colGroups[0].length;itemCrossGroupInfos.C=def.range(0,this.C).select(function(){return{type:0};}).array();}else{this.C=this.M=0;itemCrossGroupInfos.M=[];itemCrossGroupInfos.C=[];}}else{this.measuresDirection='rows';this.R=+this.options.measuresIndex;var measuresCount=this.options.measuresCount;if(measuresCount==null){measuresCount=1;}
this.M=measuresCount;this._colGroups=colNames.slice(this.R+1);this._colGroups.forEach(function(colGroup,cg){this._colGroups[cg]=[colGroup];},this);}}
itemCrossGroupInfos.R=def.range(0,this.R).select(this._buildItemInfoFromMetadata,this).array();var seriesInRows=this.options.seriesInRows;var itemGroupIndex=this._itemCrossGroupIndex={'C':!seriesInRows?0:this.R,'R':!seriesInRows?this.C:0,'M':this.C+this.R};var itemInfos=this._itemInfos=new Array(this.virtualItemSize());def.eachOwn(itemGroupIndex,function(groupStartIndex,crossGroup){itemCrossGroupInfos[crossGroup].forEach(function(info,groupIndex){itemInfos[groupStartIndex+groupIndex]=info;});});this._itemLogicalGroup={'series':seriesInRows?this.R:this.C,'category':seriesInRows?this.C:this.R,'value':this.M};this._itemLogicalGroupIndex={'series':0,'category':this._itemLogicalGroup.series,'value':this.C+this.R};},logVItem:function(){return this._logVItem(['C','R','M'],{C:this.C,R:this.R,M:this.M});},_getCategoriesCount:function(){var R=this.options.categoriesCount;if(R!=null&&(!isFinite(R)||R<0)){R=null;}
if(R==null){R=def.query(this._columnTypes).whayl(function(type){return type===0;}).count();if(!R){R=1;}}
return R;},_splitEncodedColGroupCell:function(colGroup){var values=colGroup.v;var labels;if(values==null){values=[];}else{values=values.split(this._separator);labels=colGroup.f;if(labels){labels=labels.split(this._separator);}}
return values.map(function(value,index){return{v:value,f:labels&&labels[index]};});},_processEncodedColGroups:function(encodedColGroups){var L=encodedColGroups.length||def.assert("Must have columns"),R=this.R,colGroups=[],currColGroup,measuresInfo={},measuresInfoList=[];for(var i=0;i<L;i++){var colGroupCell=encodedColGroups[i];var encColGroupValues=colGroupCell.v;var encColGroupLabels=colGroupCell.f;var sepIndex=encColGroupValues.lastIndexOf(this._separator);var meaName,meaLabel,colGroupValues,colGroupLabels;if(sepIndex<0){meaName=encColGroupValues;meaLabel=encColGroupLabels;encColGroupValues='';colGroupValues=[];}else{meaName=encColGroupValues.substring(sepIndex+1);encColGroupValues=encColGroupValues.substring(0,sepIndex);colGroupValues=encColGroupValues.split(this._separator);if(encColGroupLabels!=null){colGroupLabels=encColGroupLabels.split(this._separator);meaLabel=colGroupLabels.pop();}
colGroupValues.forEach(function(value,index){var label=colGroupLabels&&colGroupLabels[index];colGroupValues[index]={v:value,f:label};});}
if(!currColGroup||currColGroup.encValues!==encColGroupValues){currColGroup={startIndex:i,encValues:encColGroupValues,values:colGroupValues,measureNames:[meaName]};colGroups.push(currColGroup);}else{currColGroup.measureNames.push(meaName);}
var currMeaIndex=(i-currColGroup.startIndex),meaInfo=def.getOwn(measuresInfo,meaName);if(!meaInfo){measuresInfo[meaName]=meaInfo={name:meaName,label:meaLabel,type:this._columnTypes[R+i],groupIndex:currMeaIndex,index:i};measuresInfoList.push(meaInfo);}else if(currMeaIndex>meaInfo.groupIndex){meaInfo.groupIndex=currMeaIndex;}}
measuresInfoList.sort(function(meaInfoA,meaInfoB){return def.compare(meaInfoA.groupIndex,meaInfoB.groupIndex)||def.compare(meaInfoA.index,meaInfoB.index);});measuresInfoList.forEach(function(meaInfoA,index){meaInfoA.groupIndex=index;});var CG=colGroups.length,colGroupsValues=new Array(CG),colGroupsIndexes=new Array(CG),M=measuresInfoList.length;colGroups.map(function(colGroup,cg){colGroupsValues[cg]=colGroup.values;var colGroupStartIndex=colGroup.startIndex;var meaIndexes=colGroupsIndexes[cg]=new Array(M);colGroup.measureNames.forEach(function(meaName2,localMeaIndex){var meaIndex=measuresInfo[meaName2].groupIndex;meaIndexes[meaIndex]=R+colGroupStartIndex+localMeaIndex;});});this._colGroups=colGroupsValues;this._colGroupsIndexes=colGroupsIndexes;this._itemCrossGroupInfos.M=measuresInfoList;this.M=M;},configureType:function(){if(this.measuresDirection==='rows'){throw def.error.notImplemented();}
this.base();},_configureTypeCore:function(){var me=this;var itemLogicalGroup=me._itemLogicalGroup;var itemLogicalGroupIndex=me._itemLogicalGroupIndex;var index=0;var dimsReaders=[];function add(dimGroupName,level,count){var crossEndIndex=itemLogicalGroupIndex[dimGroupName]+count;while(count>0){var dimName=pvc.buildIndexedId(dimGroupName,level);if(!me.complexTypeProj.isReadOrCalc(dimName)){index=me._nextAvailableItemIndex(index);if(index>=crossEndIndex){return;}
dimsReaders.push({names:dimName,indexes:index});index++;count--;}
level++;}}
var dataPartDimName=this.options.dataPartDimName;if(dataPartDimName&&this.C===1&&!this.complexTypeProj.isReadOrCalc(dataPartDimName)){var plot2DataSeriesIndexes=this.options.plot2DataSeriesIndexes;if(plot2DataSeriesIndexes!=null){var seriesKeys=this._colGroups.map(function(colGroup){return''+colGroup[0].v;});this._plot2SeriesKeySet=this._createPlot2SeriesKeySet(plot2DataSeriesIndexes,seriesKeys);}}
['series','category','value'].forEach(function(dimGroupName){var L=itemLogicalGroup[dimGroupName];if(L>0){add(dimGroupName,0,L);}});if(dimsReaders){dimsReaders.forEach(this.defReader,this);}
if(this._plot2SeriesKeySet){var seriesReader=this._userDimsReadersByDim.series;if(seriesReader){var calcAxis2SeriesKeySet=def.fun.constant(this._plot2SeriesKeySet);this._userRead(this._dataPartGet(calcAxis2SeriesKeySet,seriesReader),dataPartDimName);}}}});def.type('pvc.data.RelationalTranslationOper',pvc.data.MatrixTranslationOper).add({M:0,C:0,S:0,_translType:"Relational",_processMetadata:function(){this.base();var metadata=this.metadata;var J=this.J;var C=this.options.categoriesCount;if(C!=null&&(!isFinite(C)||C<0)){C=0;}
var S;var valuesColIndexes,M;if(this.options.isMultiValued){valuesColIndexes=pvc.parseDistinctIndexArray(this.options.measuresIndexes,0,J-1);M=valuesColIndexes?valuesColIndexes.length:0;}
var D;if(M==null){if(J>0&&J<=3&&(C==null||C===1)&&S==null){M=1;valuesColIndexes=[J-1];C=J>=2?1:0;S=J>=3?1:0;D=C+S;}else if(C!=null&&C>=J){D=J;C=J;S=0;M=0;}else{var Mmax=C!=null?(J-C):Infinity;valuesColIndexes=def.query(metadata).where(function(colDef,index){return this._columnTypes[index]!==0;},this).select(function(colDef){return colDef.colIndex;}).take(Mmax).array();M=valuesColIndexes.length;}}
if(D==null){D=J-M;if(D===0){S=C=0;}else if(C!=null){if(C>D){C=D;S=0;}else{S=D-C;}}else{S=D>1?1:0;C=D-S;}}
var seriesInRows=this.options.seriesInRows;var colGroupSpecs=[];if(D){if(S&&!seriesInRows){colGroupSpecs.push({name:'S',count:S});}
if(C){colGroupSpecs.push({name:'C',count:C});}
if(S&&seriesInRows){colGroupSpecs.push({name:'S',count:S});}}
if(M){colGroupSpecs.push({name:'M',count:M});}
var availableInputIndexes=def.range(0,J).array();if(valuesColIndexes){valuesColIndexes.forEach(function(inputIndex){availableInputIndexes.splice(inputIndex,1);});}
var specsByName={};colGroupSpecs.forEach(function(groupSpec){var count=groupSpec.count;var name=groupSpec.name;specsByName[name]=groupSpec;if(valuesColIndexes&&name==='M'){groupSpec.indexes=valuesColIndexes;}
else{groupSpec.indexes=availableInputIndexes.splice(0,count);}});this.M=M;this.S=S;this.C=C;var itemPerm=[];['S','C','M'].forEach(function(name){var groupSpec=specsByName[name];if(groupSpec){def.array.append(itemPerm,groupSpec.indexes);}});this._itemInfos=itemPerm.map(this._buildItemInfoFromMetadata,this);this._itemCrossGroupIndex={S:0,C:this.S,M:this.S+this.C};this._itemPerm=itemPerm;},logVItem:function(){return this._logVItem(['S','C','M'],{S:this.S,C:this.C,M:this.M});},_configureTypeCore:function(){var me=this;var index=0;var dimsReaders=[];function add(dimGroupName,colGroupName,level,count){var groupEndIndex=me._itemCrossGroupIndex[colGroupName]+count;while(count>0){var dimName=pvc.buildIndexedId(dimGroupName,level);if(!me.complexTypeProj.isReadOrCalc(dimName)){index=me._nextAvailableItemIndex(index);if(index>=groupEndIndex){return;}
dimsReaders.push({names:dimName,indexes:index});index++;count--;}
level++;}}
if(this.S>0){add('series','S',0,this.S);}
if(this.C>0){add('category','C',0,this.C);}
if(this.M>0){add('value','M',0,this.M);}
if(dimsReaders){dimsReaders.forEach(this.defReader,this);}
var plot2DataSeriesIndexes=this.options.plot2DataSeriesIndexes;if(plot2DataSeriesIndexes!=null){var seriesReader=this._userDimsReadersByDim.series;if(seriesReader){var dataPartDimName=this.options.dataPartDimName;this._userRead(relTransl_dataPartGet.call(this,plot2DataSeriesIndexes,seriesReader),dataPartDimName);}}},_executeCore:function(){var dimsReaders=this._getDimensionsReaders();var permIndexes=this._itemPerm;return def.query(this._getItems()).select(function(item){item=pv.permute(item,permIndexes);return this._readItem(item,dimsReaders);},this);}});function relTransl_dataPartGet(plot2DataSeriesIndexes,seriesReader){var me=this;function calcAxis2SeriesKeySet(){var atoms={};var seriesKeys=def.query(me.source).select(function(item){seriesReader(item,atoms);var value=atoms.series;if(value!=null&&value.v!=null){value=value.v;}
return value||null;}).distinct().array();return me._createPlot2SeriesKeySet(plot2DataSeriesIndexes,seriesKeys);}
return this._dataPartGet(calcAxis2SeriesKeySet,seriesReader);}
def.type('pvc.data.Atom').init(function(dimension,value,label,rawValue,key){this.dimension=dimension;this.id=(value==null?-def.nextId():def.nextId());this.value=value;this.label=label;if(rawValue!==undefined){this.rawValue=rawValue;}
this.key=key;}).add({isVirtual:false,rawValue:undefined,toString:function(){var label=this.label;if(label!=null){return label;}
label=this.value;return label!=null?(""+label):"";}});function atom_idComparer(a,b){return a.id-b.id;}
function atom_idComparerReverse(a,b){return b.id-a.id;}
var complex_nextId=1;def.type('pvc.data.Complex').init(function(source,atomsByName,dimNames,atomsBase,wantLabel,calculate){this.id=complex_nextId++;var owner;if(source){owner=source.owner;if(!atomsBase){atomsBase=source.atoms;}}
this.owner=owner||this;this.atoms=atomsBase?Object.create(atomsBase):{};var hadDimNames=!!dimNames;if(!dimNames){dimNames=owner.type._dimsNames;}
var atomsMap=this.atoms;var D=dimNames.length;var i,dimName;if(atomsByName){var ownerDims=owner._dimensions;var addAtom=function(dimName,value){var dimension=def.getOwn(ownerDims,dimName);if(value!=null){var atom=dimension.intern(value);if(!atomsBase||atom!==atomsBase[dimName]){atomsMap[dimName]=atom;}}else{dimension.intern(null);}};if(!hadDimNames){for(dimName in atomsByName){addAtom(dimName,atomsByName[dimName]);}}else{for(i=0;i<D;i++){dimName=dimNames[i];addAtom(dimName,atomsByName[dimName]);}}
if(calculate){var newAtomsByName=owner.type._calculate(this);for(dimName in newAtomsByName){if(!def.hasOwnProp.call(atomsMap,dimName)){addAtom(dimName,newAtomsByName[dimName]);}}}}
if(!D){this.value=null;this.key='';if(wantLabel){this.label="";}}else if(D===1){var singleAtom=atomsMap[dimNames[0]];this.value=singleAtom.value;this.rawValue=singleAtom.rawValue;this.key=singleAtom.key;if(wantLabel){this.label=singleAtom.label;}}else{var key,label;var labelSep=owner.labelSep;var keySep=owner.keySep;for(i=0;i<D;i++){dimName=dimNames[i];var atom=atomsMap[dimName];if(!i){key=atom.key;}else{key+=keySep+atom.key;}
if(wantLabel){var atomLabel=atom.label;if(atomLabel){if(!label){label=atomLabel;}else{label+=labelSep+atomLabel;}}}}
this.value=this.rawValue=this.key=key;if(wantLabel){this.label=label;}}}).add({labelSep:" ~ ",keySep:'~',label:null,rawValue:undefined,ensureLabel:function(){var label=this.label;if(label==null){label="";var labelSep=this.owner.labelSep;def.eachOwn(this.atoms,function(atom){var alabel=atom.label;if(alabel){if(label){label+=labelSep+alabel;}else{label=alabel;}}});this.label=label;}
return label;},view:function(dimNames){return new pvc.data.ComplexView(this,dimNames);},toString:function(){var s=[''+this.constructor.typeName];if(this.index!=null){s.push("#"+this.index);}
this.owner.type.dimensionsNames().forEach(function(name){s.push(name+": "+pvc.stringify(this.atoms[name].value));},this);return s.join(" ");}});pvc.data.Complex.values=function(complex,dimNames){var atoms=complex.atoms;return dimNames.map(function(dimName){return atoms[dimName].value;});};pvc.data.Complex.compositeKey=function(complex,dimNames){var atoms=complex.atoms;return dimNames.map(function(dimName){return atoms[dimName].key;}).join(complex.owner.keySep);};pvc.data.Complex.labels=function(complex,dimNames){var atoms=complex.atoms;return dimNames.map(function(dimName){return atoms[dimName].label;});};def.type('pvc.data.ComplexView',pvc.data.Complex).init(function(source,viewDimNames){this.source=source;this.viewDimNames=viewDimNames;this.base(source,source.atoms,viewDimNames,source.owner.atoms,true);}).add({values:function(){return pvc.data.Complex.values(this,this.viewDimNames);},labels:function(){return pvc.data.Complex.labels(this,this.viewDimNames);}});def.type('pvc.data.Datum',pvc.data.Complex).init(function(data,atomsByName){this.base(data,atomsByName,null,null,false,true);}).add({isSelected:false,isVisible:true,isNull:false,isVirtual:false,isTrend:false,trendType:null,isInterpolated:false,interpolation:null,setSelected:function(select){if(this.isNull){return false;}
select=(select==null)||!!select;var changed=this.isSelected!==select;if(changed){if(!select){delete this.isSelected;}
else{this.isSelected=true;}
data_onDatumSelectedChanged.call(this.owner,this,select);}
return changed;},toggleSelected:function(){return this.setSelected(!this.isSelected);},setVisible:function(visible){if(this.isNull){return false;}
visible=(visible==null)||!!visible;var changed=this.isVisible!==visible;if(changed){this.isVisible=visible;data_onDatumVisibleChanged.call(this.owner,this,visible);}
return changed;},toggleVisible:function(){return this.setVisible(!this.isVisible);}});function datum_deselect(){delete this.isSelected;}
def.type('pvc.data.Dimension').init(function(data,type){this.data=data;this.type=type;this.root=this;this.owner=this;var name=type.name;this.name=name;this._atomComparer=type.atomComparer();this._atomsByKey={};if(data.isOwner()){this._atoms=[];dim_createVirtualNullAtom.call(this);}else{var parentData=data.parent;var source;if(parentData){source=parentData._dimensions[name];dim_addChild.call(source,this);this.root=data.parent.root;}else{parentData=data.linkParent;parentData||def.assert("Data must have a linkParent");source=parentData._dimensions[name];dim_addLinkChild.call(source,this);}
this._nullAtom=this.owner._nullAtom;this._lazyInit=function(){this._lazyInit=null;var datums=this.data._datums;var L=datums.length;var atomsByKey=this._atomsByKey;for(var i=0;i<L;i++){var atom=datums[i].atoms[name];atomsByKey[atom.key]=atom;}
this._atoms=source.atoms().filter(function(atom){return def.hasOwnProp.call(atomsByKey,atom.key);});};}}).add({parent:null,linkParent:null,_children:null,_linkChildren:null,_atomsByKey:null,_atomVisibleDatumsCount:null,_disposed:false,_nullAtom:null,_virtualNullAtom:null,_visibleAtoms:null,_visibleIndexes:null,_atomComparer:null,_atoms:null,_sumCache:null,count:function(){if(this._lazyInit){this._lazyInit();}
return this._atoms.length;},isVisible:function(atom){if(this._lazyInit){this._lazyInit();}
def.hasOwn(this._atomsByKey,atom.key)||def.assert("Atom must exist in this dimension.");return dim_getVisibleDatumsCountMap.call(this)[atom.key]>0;},atoms:function(keyArgs){if(this._lazyInit){this._lazyInit();}
var visible=def.get(keyArgs,'visible');if(visible==null){return this._atoms;}
visible=!!visible;this._visibleAtoms||(this._visibleAtoms={});return this._visibleAtoms[visible]||(this._visibleAtoms[visible]=dim_calcVisibleAtoms.call(this,visible));},indexes:function(keyArgs){if(this._lazyInit){this._lazyInit();}
var visible=def.get(keyArgs,'visible');if(visible==null){return pv.range(0,this._atoms.length);}
visible=!!visible;this._visibleIndexes||(this._visibleIndexes={});return this._visibleIndexes[visible]||(this._visibleIndexes[visible]=dim_calcVisibleIndexes.call(this,visible));},atom:function(value){if(value==null||value===''){return this._nullAtom;}
if(value instanceof pvc.data.Atom){return value;}
if(this._lazyInit){this._lazyInit();}
var key=this.type._key?this.type._key.call(null,value):value;return this._atomsByKey[key]||null;},extent:function(keyArgs){var atoms=this.atoms(keyArgs);var L=atoms.length;if(!L){return undefined;}
var offset=this._nullAtom&&atoms[0].value==null?1:0;var countWithoutNull=L-offset;if(countWithoutNull>0){var min=atoms[offset];var max=atoms[L-1];var tmp;if(min!==max&&def.get(keyArgs,'abs',false)){var minSign=min.value<0?-1:1;var maxSign=max.value<0?-1:1;if(minSign===maxSign){if(maxSign<0){tmp=max;max=min;min=tmp;}}else if(countWithoutNull>2){if(max.value<-min.value){max=min;}
var zeroIndex=def.array.binarySearch(atoms,0,this.type.comparer(),function(a){return a.value;});if(zeroIndex<0){zeroIndex=~zeroIndex;var negAtom=atoms[zeroIndex-1];var posAtom=atoms[zeroIndex];if(-negAtom.value<posAtom.value){min=negAtom;}else{min=posAtom;}}else{min=atoms[zeroIndex];}}else if(max.value<-min.value){tmp=max;max=min;min=tmp;}}
return{min:min,max:max};}
return undefined;},min:function(keyArgs){var atoms=this.atoms(keyArgs);var L=atoms.length;if(!L){return undefined;}
var offset=this._nullAtom&&atoms[0].value==null?1:0;return(L>offset)?atoms[offset]:undefined;},max:function(keyArgs){var atoms=this.atoms(keyArgs);var L=atoms.length;return L&&atoms[L-1].value!=null?atoms[L-1]:undefined;},sum:function(keyArgs){var isAbs=!!def.get(keyArgs,'abs',false),zeroIfNone=def.get(keyArgs,'zeroIfNone',true),key=dim_buildDatumsFilterKey(keyArgs)+':'+isAbs;var sum=def.getOwn(this._sumCache,key);if(sum===undefined){var dimName=this.name;sum=this.data.datums(null,keyArgs).reduce(function(sum2,datum){var value=datum.atoms[dimName].value;if(isAbs&&value<0){value=-value;}
return sum2!=null?(sum2+value):value;},null);(this._sumCache||(this._sumCache={}))[key]=sum;}
return zeroIfNone?(sum||0):sum;},percent:function(atomOrValue,keyArgs){var value=(atomOrValue instanceof pvc.data.Atom)?atomOrValue.value:atomOrValue;if(!value){return 0;}
var sum=this.sum(def.create(keyArgs,{abs:true}));return sum?(Math.abs(value)/sum):0;},percentOverParent:function(keyArgs){var value=this.sum(keyArgs);if(!value){return 0;}
var parentData=this.data.parent;if(!parentData){return 1;}
var sum=parentData.dimensionsSumAbs(this.name,keyArgs);return sum?(Math.abs(value)/sum):0;},format:function(value,sourceValue){return""+(this.type._formatter?this.type._formatter.call(null,value,sourceValue):"");},intern:function(sourceValue,isVirtual){if(sourceValue==null||sourceValue===''){return this._nullAtom||dim_createNullAtom.call(this,sourceValue);}
if(sourceValue instanceof pvc.data.Atom){if(sourceValue.dimension!==this){throw def.error.operationInvalid("Atom is of a different dimension.");}
return sourceValue;}
var value,label;var type=this.type;if(typeof sourceValue==='object'&&('v'in sourceValue)){label=sourceValue.f;sourceValue=sourceValue.v;if(sourceValue==null||sourceValue===''){return this._nullAtom||dim_createNullAtom.call(this);}}
if(!isVirtual){var converter=type._converter;if(!converter){value=sourceValue;}else{value=converter(sourceValue);if(value==null||value===''){return this._nullAtom||dim_createNullAtom.call(this,sourceValue);}}}else{value=sourceValue;}
var cast=type.cast;if(cast){value=cast(value);if(value==null||value===''){return this._nullAtom||dim_createNullAtom.call(this);}}
var keyFun=type._key;var key=''+(keyFun?keyFun(value):value);key||def.fail.operationInvalid("Only a null value can have an empty key.");var atom=this._atomsByKey[key];if(atom){if(!isVirtual&&atom.isVirtual){delete atom.isVirtual;}
return atom;}
return dim_createAtom.call(this,type,sourceValue,key,value,label,isVirtual);},read:function(sourceValue,label){if(sourceValue==null||sourceValue===''){return null;}
var value;var type=this.type;if(typeof sourceValue==='object'&&('v'in sourceValue)){label=sourceValue.f;sourceValue=sourceValue.v;if(sourceValue==null||sourceValue===''){return null;}}
var converter=type._converter;value=converter?converter(sourceValue):sourceValue;if(value==null||value===''){return null;}
var cast=type.cast;if(cast){value=cast(value);if(value==null||value===''){return null;}}
var keyFun=type._key;var key=''+(keyFun?keyFun(value):value);var atom=this._atomsByKey[key];if(atom){return{rawValue:sourceValue,key:key,value:atom.value,label:''+(label==null?atom.label:label)};}
if(label==null){var formatter=type._formatter;label=formatter?formatter(value,sourceValue):value;}
label=""+label;return{rawValue:sourceValue,key:key,value:value,label:label};},dispose:function(){if(!this._disposed){data_disposeChildList(this._children,'parent');data_disposeChildList(this._linkChildren,'linkParent');if(this.parent){dim_removeChild.call(this.parent,this);}
if(this.linkParent){dim_removeLinkChild.call(this.linkParent,this);}
dim_clearVisiblesCache.call(this);this._lazyInit=null;this._atoms=this._nullAtom=this._virtualNullAtom=null;this._disposed=true;}}});function dim_createAtom(type,sourceValue,key,value,label,isVirtual){var atom;if(this.owner===this){if(label==null){var formatter=type._formatter;if(formatter){label=formatter(value,sourceValue);}else{label=value;}}
label=""+label;if(!label&&pvc.debug>=2){pvc.log("Only the null value should have an empty label.");}
atom=new pvc.data.Atom(this,value,label,sourceValue,key);if(isVirtual){atom.isVirtual=true;}}else{var source=this.parent||this.linkParent;atom=source._atomsByKey[key]||dim_createAtom.call(source,type,sourceValue,key,value,label,isVirtual);}
def.array.insert(this._atoms,atom,this._atomComparer);dim_clearVisiblesCache.call(this);this._atomsByKey[key]=atom;return atom;}
function dim_internAtom(atom){var key=atom.key;if(atom.dimension===this){(this.owner===this)||def.assert("Should be an owner dimension");if(!key&&atom===this._virtualNullAtom){atom=this.intern(null);}
return atom;}
if(!this._lazyInit){var localAtom=this._atomsByKey[key];if(localAtom){if(localAtom!==atom){throw def.error.operationInvalid("Atom is from a different root data.");}
return atom;}
if(this.owner===this){throw def.error.operationInvalid("Atom is from a different root data.");}}
dim_internAtom.call(this.parent||this.linkParent,atom);if(!this._lazyInit){this._atomsByKey[key]=atom;if(!key){this._nullAtom=atom;this._atoms.unshift(atom);}else{def.array.insert(this._atoms,atom,this._atomComparer);}
dim_clearVisiblesCache.call(this);}
return atom;}
function dim_buildDatumsFilterKey(keyArgs){var visible=def.get(keyArgs,'visible'),selected=def.get(keyArgs,'selected');return(visible==null?null:!!visible)+':'+(selected==null?null:!!selected);}
function dim_createNullAtom(sourceValue){var nullAtom=this._nullAtom;if(!nullAtom){if(this.owner===this){var typeFormatter=this.type._formatter;var label=""+(typeFormatter?typeFormatter.call(null,null,sourceValue):"");nullAtom=new pvc.data.Atom(this,null,label,null,'');this.data._atomsBase[this.name]=nullAtom;}else{nullAtom=dim_createNullAtom.call(this.parent||this.linkParent,sourceValue);}
this._atomsByKey['']=this._nullAtom=nullAtom;this._atoms.unshift(nullAtom);}
return nullAtom;}
function dim_createVirtualNullAtom(){(this.owner===this)||def.assert("Can only create atoms on an owner dimension.");if(!this._virtualNullAtom){this._virtualNullAtom=new pvc.data.Atom(this,null,"",null,'');this.data._atomsBase[this.name]=this._virtualNullAtom;}
return this._virtualNullAtom;}
function dim_unintern(atom){(this.owner===this)||def.assert("Can only unintern atoms on an owner dimension.");(atom&&atom.dimension===this)||def.assert("Not an interned atom");if(atom===this._virtualNullAtom){return;}
var key=atom.key;if(this._atomsByKey[key]===atom){def.array.remove(this._atoms,atom,this._atomComparer);delete this._atomsByKey[key];if(!key){delete this._nullAtom;this.data._atomsBase[this.name]=this._virtualNullAtom;}}
dim_clearVisiblesCache.call(this);}
function dim_uninternUnvisitedAtoms(){(this.owner===this)||def.assert("Can only unintern atoms of an owner dimension.");var atoms=this._atoms;if(atoms){var atomsByKey=this._atomsByKey;var i=0;var L=atoms.length;while(i<L){var atom=atoms[i];if(atom.visited){delete atom.visited;i++;}else if(atom!==this._virtualNullAtom){atoms.splice(i,1);L--;var key=atom.key;delete atomsByKey[key];if(!key){delete this._nullAtom;this.data._atomsBase[this.name]=this._virtualNullAtom;}}}
dim_clearVisiblesCache.call(this);}}
function dim_uninternVirtualAtoms(){var atoms=this._atoms;if(atoms){var atomsByKey=this._atomsByKey;var i=0;var L=atoms.length;var removed;while(i<L){var atom=atoms[i];if(!atom.isVirtual){i++;}else{atoms.splice(i,1);L--;removed=true;var key=atom.key||def.assert("Cannot be the null or virtual null atom.");delete atomsByKey[key];}}
if(removed){dim_clearVisiblesCache.call(this);}}}
function dim_clearVisiblesCache(){this._atomVisibleDatumsCount=this._sumCache=this._visibleAtoms=this._visibleIndexes=null;}
function dim_onDatumsChanged(){dim_clearVisiblesCache.call(this);}
function dim_addChild(child){data_addColChild(this,'_children',child,'parent');child.owner=this.owner;}
function dim_removeChild(child){data_removeColChild(this,'_children',child,'parent');}
function dim_addLinkChild(linkChild){data_addColChild(this,'_linkChildren',linkChild,'linkParent');linkChild.owner=this.owner;}
function dim_removeLinkChild(linkChild){data_removeColChild(this,'_linkChildren',linkChild,'linkParent');}
function dim_onDatumVisibleChanged(datum,visible){var map;if(!this._disposed&&(map=this._atomVisibleDatumsCount)){var atom=datum.atoms[this.name],key=atom.key;def.hasOwn(this._atomsByKey,key)||def.assert("Atom must exist in this dimension.");var count=map[key];(visible||(count>0))||def.assert("Must have had accounted for at least one visible datum.");map[key]=(count||0)+(visible?1:-1);this._visibleAtoms=this._sumCache=this._visibleIndexes=null;}}
function dim_getVisibleDatumsCountMap(){var map=this._atomVisibleDatumsCount;if(!map){map={};this.data.datums(null,{visible:true}).each(function(datum){var atom=datum.atoms[this.name],key=atom.key;map[key]=(map[key]||0)+1;},this);this._atomVisibleDatumsCount=map;}
return map;}
function dim_calcVisibleIndexes(visible){var indexes=[];this._atoms.forEach(function(atom,index){if(this.isVisible(atom)===visible){indexes.push(index);}},this);return indexes;}
function dim_calcVisibleAtoms(visible){return def.query(this._atoms).where(function(atom){return this.isVisible(atom)===visible;},this).array();}
def.type('pvc.data.Data',pvc.data.Complex).init(function(keyArgs){keyArgs||def.fail.argumentRequired('keyArgs');this._visibleNotNullDatums=new def.Map();var owner,atoms,atomsBase,dimNames,datums,index,parent=this.parent=keyArgs.parent||null;if(parent){this.root=parent.root;this.depth=parent.depth+1;this.type=parent.type;datums=keyArgs.datums||def.fail.argumentRequired('datums');owner=parent.owner;atoms=keyArgs.atoms||def.fail.argumentRequired('atoms');dimNames=keyArgs.dimNames||def.fail.argumentRequired('dimNames');atomsBase=parent.atoms;}else{this.root=this;dimNames=[];var linkParent=keyArgs.linkParent||null;if(linkParent){owner=linkParent.owner;this.type=owner.type;datums=keyArgs.datums||def.fail.argumentRequired('datums');this._leafs=[];atomsBase=linkParent.atoms;index=def.get(keyArgs,'index',null);data_addLinkChild.call(linkParent,this,index);}else{owner=this;atomsBase={};if(keyArgs.labelSep){this.labelSep=keyArgs.labelSep;}
if(keyArgs.keySep){this.keySep=keyArgs.keySep;}
this.type=keyArgs.type||def.fail.argumentRequired('type');this._selectedNotNullDatums=new def.Map();}}
if(datums){data_setDatums.call(this,datums);}
this.owner=owner;this._atomsBase=atomsBase;this._dimensions={};this.type.dimensionsList().forEach(this._initDimension,this);this.base(owner,atoms,dimNames,atomsBase,true);pv.Dom.Node.call(this,null);delete this.nodeValue;this._children=this.childNodes;if(parent){index=def.get(keyArgs,'index',null);data_addChild.call(parent,this,index);if(parent.absLabel){this.absLabel=def.string.join(owner.labelSep,parent.absLabel,this.label);}else{this.absLabel=this.label;}
if(parent.absKey){this.absKey=def.string.join(owner.keySep,parent.absKey,this.key);}else{this.absKey=this.key;}}else{this.absLabel=this.label;this.absKey=this.key;}}).add(pv.Dom.Node).add({parent:null,linkParent:null,_dimensions:null,_freeDimensionNames:null,_children:null,_linkChildren:null,_leafs:null,_childrenByKey:null,_visibleNotNullDatums:null,_selectedNotNullDatums:null,_groupByCache:null,_sumAbsCache:null,treeHeight:null,_groupOper:null,_groupSpec:null,_groupLevel:null,_datums:null,_datumsById:null,depth:0,label:"",absLabel:"",_disposed:false,_isFlattenGroup:false,_isDegenerateFlattenGroup:false,_initDimension:function(dimType){this._dimensions[dimType.name]=new pvc.data.Dimension(this,dimType);},dimensions:function(name,keyArgs){if(name==null){return this._dimensions;}
var dim=def.getOwn(this._dimensions,name);if(!dim&&def.get(keyArgs,'assertExists',true)){throw def.error.argumentInvalid('name',"Undefined dimension '{0}'.",[name]);}
return dim;},freeDimensionNames:function(){if(!this._freeDimensionNames){var free=this._freeDimensionNames=[];def.eachOwn(this._dimensions,function(dim,dimName){var atom=this.atoms[dimName];if(!(atom instanceof pvc.data.Atom)||atom.value==null){free.push(dimName);}},this);}
return this._freeDimensionNames;},isOwner:function(){return this.owner===this;},children:function(){return this._children?def.query(this._children):def.query();},child:function(key){return this._childrenByKey?(this._childrenByKey[key]||null):null;},childCount:function(){return this._children?this._children.length:0;},leafs:function(){return def.query(this._leafs);},count:function(){return this._datums.length;},firstDatum:function(){return this._datums.length?this._datums[0]:null;},singleDatum:function(){var datums=this._datums;return datums.length===1?datums[0]:null;},dispose:function(){if(!this._disposed){data_disposeChildLists.call(this);if(this._selectedNotNullDatums){this._selectedNotNullDatums.clear();}
this._visibleNotNullDatums.clear();def.eachOwn(this._dimensions,function(dimension){dimension.dispose();});if(this.parent){this.parent.removeChild(this);this.parent=null;}
if(this.linkParent){data_removeLinkChild.call(this.linkParent,this);}
this._disposed=true;}},disposeChildren:function(){data_disposeChildLists.call(this);}});function data_addChild(child,index){this.insertAt(child,index);def.lazy(this,'_childrenByKey')[child.key]=child;}
function data_addLinkChild(linkChild,index){data_addColChild(this,'_linkChildren',linkChild,'linkParent',index);}
function data_removeLinkChild(linkChild){data_removeColChild(this,'_linkChildren',linkChild,'linkParent');}
function data_disposeChildLists(){data_disposeChildList(this._children,'parent');this._childrenByKey=null;data_disposeChildList(this._linkChildren,'linkParent');this._groupByCache=null;this._sumAbsCache=null;}
function data_assertIsOwner(){this.isOwner()||def.fail("Can only be called on the owner data.");}
pvc.data.Data.add({selectedCount:function(){if(!this.isOwner()){return this.datums(null,{selected:true}).count();}
return this._selectedNotNullDatums.count;},selectedDatums:function(){if(!this.isOwner()){return this.datums(null,{selected:true}).array();}
return this._selectedNotNullDatums.values();},selectedDatumMap:function(){if(!this.isOwner()){var datums=this.datums(null,{selected:true}).object({name:def.propGet('id')});return new def.Set(datums);}
return this._selectedNotNullDatums.clone();},visibleCount:function(){return this._visibleNotNullDatums.count;},replaceSelected:function(datums){if(!def.array.is(datums)){datums=datums.array();}
var alreadySelectedById=def.query(datums).where(def.propGet('isSelected')).object({name:def.propGet('id')});var changed=this.owner.clearSelected(function(datum){return!def.hasOwn(alreadySelectedById,datum.id);});changed|=pvc.data.Data.setSelected(datums,true);return changed;},clearSelected:function(funFilter){if(this.owner!==this){return this.owner.clearSelected(funFilter);}
if(!this._selectedNotNullDatums.count){return false;}
var changed;if(funFilter){changed=false;this._selectedNotNullDatums.values().filter(funFilter).forEach(function(datum){changed=true;datum_deselect.call(datum);this._selectedNotNullDatums.rem(datum.id);},this);}else{changed=true;this._selectedNotNullDatums.values().forEach(function(datum){datum_deselect.call(datum);});this._selectedNotNullDatums.clear();}
return changed;}});function data_onDatumSelectedChanged(datum,selected){!datum.isNull||def.assert("Null datums do not notify selected changes");if(selected){this._selectedNotNullDatums.set(datum.id,datum);}
else{this._selectedNotNullDatums.rem(datum.id);}
this._sumAbsCache=null;}
function data_onDatumVisibleChanged(datum,visible){if(def.hasOwn(this._datumsById,datum.id)){!datum.isNull||def.assert("Null datums do not notify visible changes");if(visible){this._visibleNotNullDatums.set(datum.id,datum);}
else{this._visibleNotNullDatums.rem(datum.id);}
this._sumAbsCache=null;def.eachOwn(this._dimensions,function(dimension){dim_onDatumVisibleChanged.call(dimension,datum,visible);});this._children.forEach(function(data){data_onDatumVisibleChanged.call(data,datum,visible);});if(this._linkChildren){this._linkChildren.forEach(function(data){data_onDatumVisibleChanged.call(data,datum,visible);});}}}
pvc.data.Data.setSelected=function(datums,selected){var anyChanged=0;if(datums){def.query(datums).each(function(datum){anyChanged|=datum.setSelected(selected);});}
return!!anyChanged;};pvc.data.Data.toggleSelected=function(datums){if(!def.array.isLike(datums)){datums=def.query(datums).array();}
var allSelected=def.query(datums).all(function(datum){return datum.isNull||datum.isSelected;});return this.setSelected(datums,!allSelected);};pvc.data.Data.setVisible=function(datums,visible){var anyChanged=0;if(datums){def.query(datums).each(function(datum){anyChanged|=datum.setVisible(visible);});}
return!!anyChanged;};pvc.data.Data.toggleVisible=function(datums){if(!def.array.isLike(datums)){datums=def.query(datums).array();}
var allVisible=def.query(datums).all(def.propGet('isVisible'));return pvc.data.Data.setVisible(datums,!allVisible);};def.space('pvc.data').FlatteningMode=def.set(def.makeEnum(['DfsPre','DfsPost']),'None',0);def.type('pvc.data.GroupingSpec').init(function(levelSpecs,type,ka){this.type=type||null;var ids=[];this.hasCompositeLevels=false;var dimNames=[];this.levels=def.query(levelSpecs||undefined).where(function(levelSpec){return levelSpec.dimensions.length>0;}).select(function(levelSpec){ids.push(levelSpec.id);def.array.append(dimNames,levelSpec.dimensionNames());if(!this.hasCompositeLevels&&levelSpec.dimensions.length>1){this.hasCompositeLevels=true;}
levelSpec._setAccDimNames(dimNames.slice(0));return levelSpec;},this).array();this._dimNames=dimNames;this.depth=this.levels.length;this.isSingleLevel=this.depth===1;this.isSingleDimension=this.isSingleLevel&&!this.hasCompositeLevels;this.firstDimension=this.depth>0?this.levels[0].dimensions[0]:null;this.rootLabel=def.get(ka,'rootLabel')||"";this.flatteningMode=def.get(ka,'flatteningMode')||pvc.data.FlatteningMode.None;this._cacheKey=this._calcCacheKey();this.id=this._cacheKey+"##"+ids.join('||');}).add({_calcCacheKey:function(ka){return[def.get(ka,'flatteningMode')||this.flatteningMode,def.get(ka,'reverse')||'false',def.get(ka,'isSingleLevel')||this.isSingleLevel,def.get(ka,'rootLabel')||this.rootLabel].join('#');},bind:function(type){this.type=type||def.fail.argumentRequired('type');this.levels.forEach(function(levelSpec){levelSpec.bind(type);});},dimensions:function(){return def.query(this.levels).prop('dimensions').selectMany();},dimensionNames:function(){return this._dimNames;},view:function(complex){return complex.view(this.dimensionNames());},isDiscrete:function(){var d;return!this.isSingleDimension||(!!(d=this.firstDimension)&&d.type.isDiscrete);},firstDimensionType:function(){var d=this.firstDimension;return d&&d.type;},firstDimensionName:function(){var dt=this.firstDimensionType();return dt&&dt.name;},firstDimensionValueType:function(){var dt=this.firstDimensionType();return dt&&dt.valueType;},isNull:function(){return!this.levels.length;},ensure:function(ka){var result;if(ka){var cacheKey=this._calcCacheKey(ka);if(cacheKey!==this._cacheKey){var cache=def.lazy(this,'_groupingCache');result=def.getOwn(cache,cacheKey);if(!result){result=cache[cacheKey]=this._ensure(ka);}}}
return result||this;},_ensure:function(ka){var me=this;if(def.get(ka,'isSingleLevel')&&!me.isSingleLevel){return me._singleLevelGrouping(ka);}
if(def.get(ka,'reverse')){return me._reverse(ka);}
var flatteningMode=def.get(ka,'flatteningMode')||me.flatteningMode;var rootLabel=def.get(ka,'rootLabel')||me.rootLabel;if(flatteningMode!==me.flatteningMode||rootLabel!==me.rootLabel){return new pvc.data.GroupingSpec(me.levels,me.type,{flatteningMode:flatteningMode,rootLabel:rootLabel});}
return me;},_singleLevelGrouping:function(ka){var reverse=!!def.get(ka,'reverse');var dimSpecs=this.dimensions().select(function(dimSpec){return reverse?new pvc.data.GroupingDimensionSpec(dimSpec.name,!dimSpec.reverse,dimSpec.type.complexType):dimSpec;});var levelSpec=new pvc.data.GroupingLevelSpec(dimSpecs,this.type);return new pvc.data.GroupingSpec([levelSpec],this.type,{flatteningMode:null,rootLabel:def.get(ka,'rootLabel')||this.rootLabel});},_reverse:function(ka){var levelSpecs=def.query(this.levels).select(function(levelSpec){var dimSpecs=def.query(levelSpec.dimensions).select(function(dimSpec){return new pvc.data.GroupingDimensionSpec(dimSpec.name,!dimSpec.reverse,dimSpec.type.complexType);});return new pvc.data.GroupingLevelSpec(dimSpecs,this.type);});return new pvc.data.GroupingSpec(levelSpecs,this.type,{flatteningMode:def.get(ka,'flatteningMode')||this.flatteningMode,rootLabel:def.get(ka,'rootLabel')||this.rootLabel});},toString:function(){return def.query(this.levels).select(function(level){return''+level;}).array().join(', ');}});def.type('pvc.data.GroupingLevelSpec').init(function(dimSpecs,type){var ids=[];var dimNames=[];this.dimensions=def.query(dimSpecs).select(function(dimSpec){ids.push(dimSpec.id);dimNames.push(dimSpec.name);return dimSpec;}).array();this._dimNames=dimNames;this.dimensionsInDefOrder=this.dimensions.slice(0);if(type){this._sortDimensions(type);}
this.id=ids.join(',');this.depth=this.dimensions.length;var me=this;this.comparer=function(a,b){return me.compare(a,b);};}).add({_sortDimensions:function(type){type.sortDimensionNames(this.dimensionsInDefOrder,function(d){return d.name;});},_setAccDimNames:function(accDimNames){this._accDimNames=accDimNames;},accDimensionNames:function(){return this._accDimNames;},dimensionNames:function(){return this._dimNames;},bind:function(type){this._sortDimensions(type);this.dimensions.forEach(function(dimSpec){dimSpec.bind(type);});},compare:function(a,b){for(var i=0,D=this.depth;i<D;i++){var result=this.dimensions[i].compareDatums(a,b);if(result!==0){return result;}}
return 0;},key:function(datum){var key='';var atoms={};var datoms=datum.atoms;var dimNames=this._dimNames;var keySep=datum.owner.keySep;for(var i=0,D=this.depth;i<D;i++){var dimName=dimNames[i];var atom=datoms[dimName];atoms[dimName]=atom;if(!i){key=atom.key;}
else{key+=keySep+atom.key;}}
return{key:key,atoms:atoms,dimNames:dimNames};},toString:function(){return def.query(this.dimensions).select(function(dimSpec){return''+dimSpec;}).array().join('|');}});def.type('pvc.data.GroupingDimensionSpec').init(function(name,reverse,type){this.name=name;this.reverse=!!reverse;this.id=this.name+":"+(this.reverse?'0':'1');if(type){this.bind(type);}}).add({type:null,comparer:null,bind:function(type){type||def.fail.argumentRequired('type');this.type=type.dimensions(this.name);this.comparer=this.type.atomComparer(this.reverse);},compareDatums:function(a,b){return this.comparer(a.atoms[this.name],b.atoms[this.name]);},toString:function(){return this.name+(this.reverse?' desc':'');}});pvc.data.GroupingSpec.parse=function(specText,type){if(!specText){return new pvc.data.GroupingSpec(null,type);}
var levels;if(def.array.is(specText)){levels=specText;}else if(def.string.is(specText)){levels=specText.split(/\s*,\s*/);}
var levelSpecs=def.query(levels).select(function(levelText){var dimSpecs=groupSpec_parseGroupingLevel(levelText,type);return new pvc.data.GroupingLevelSpec(dimSpecs,type);});return new pvc.data.GroupingSpec(levelSpecs,type);};var groupSpec_matchDimSpec=/^\s*(.+?)(?:\s+(asc|desc))?\s*$/i;function groupSpec_parseGroupingLevel(groupLevelText,type){def.string.is(groupLevelText)||def.fail.argumentInvalid('groupLevelText',"Invalid grouping specification.");return def.query(groupLevelText.split(/\s*\|\s*/)).where(def.truthy).select(function(dimSpecText){var match=groupSpec_matchDimSpec.exec(dimSpecText)||def.fail.argumentInvalid('groupLevelText',"Invalid grouping level syntax '{0}'.",[dimSpecText]),name=match[1],order=(match[2]||'').toLowerCase(),reverse=order==='desc';return new pvc.data.GroupingDimensionSpec(name,reverse,type);});}
def.type('pvc.data.DataOper').init(function(linkParent,keyArgs){linkParent||def.fail.argumentRequired('linkParent');this._linkParent=linkParent;}).add({key:null,execute:def.method({isAbstract:true})});def.type('pvc.data.GroupingOper',pvc.data.DataOper).init(function(linkParent,groupingSpecs,keyArgs){groupingSpecs||def.fail.argumentRequired('groupingSpecs');this.base(linkParent,keyArgs);this._where=def.get(keyArgs,'where');this._visible=def.get(keyArgs,'visible',null);this._selected=def.get(keyArgs,'selected',null);this._isNull=def.get(keyArgs,'isNull',null);var hasKey=this._selected==null,whereKey='';if(this._where){whereKey=def.get(keyArgs,'whereKey');if(!whereKey){if(!keyArgs||whereKey===null){hasKey=false;}else{whereKey=''+def.nextId('dataOperWhereKey');keyArgs.whereKey=whereKey;}}}
var ids=[];this._groupSpecs=def.array.as(groupingSpecs).map(function(groupSpec){if(groupSpec instanceof pvc.data.GroupingSpec){if(groupSpec.type!==linkParent.type){throw def.error.argumentInvalid('groupingSpecText',"Invalid associated complex type.");}}else{groupSpec=pvc.data.GroupingSpec.parse(groupSpec,linkParent.type);}
ids.push(groupSpec.id);return groupSpec;});if(hasKey){this.key=ids.join('!!')+"||visible:"+this._visible+"||isNull:"+this._isNull+"||where:"+whereKey;}}).add({execute:function(){var datumsQuery=data_whereState(def.query(this._linkParent._datums),{visible:this._visible,selected:this._selected,isNull:this._isNull,where:this._where});var rootNode=this._group(datumsQuery);return this._generateData(rootNode,null,this._linkParent);},executeAdd:function(rootData,datums){var datumsQuery=data_whereState(def.query(datums),{visible:this._visible,selected:this._selected,isNull:this._isNull,where:this._where});var rootNode=this._group(datumsQuery);this._generateData(rootNode,null,this._linkParent,rootData);return rootNode.datums;},_group:function(datumsQuery){var rootNode={isRoot:true,treeHeight:def.query(this._groupSpecs).select(function(spec){var levelCount=spec.levels.length;if(!levelCount){return 0;}
return!!spec.flatteningMode?1:levelCount;}).reduce(def.add,0),datums:[]};if(rootNode.treeHeight>0){this._groupSpecRecursive(rootNode,datumsQuery,0);}
return rootNode;},_groupSpecRecursive:function(specParentNode,specDatumsQuery,specIndex){var groupSpec=this._groupSpecs[specIndex];var levelSpecs=groupSpec.levels;var L=levelSpecs.length;var doFlatten=!!groupSpec.flatteningMode;var nextSpecIndex=specIndex+1;var isLastSpec=(nextSpecIndex>=this._groupSpecs.length);var isPostOrder=doFlatten&&(groupSpec.flatteningMode===pvc.data.FlatteningMode.DfsPost);var specGroupParent;if(doFlatten){specParentNode.children=[];specParentNode.childrenByKey={};specGroupParent={key:'',absKey:'',atoms:{},datums:[],label:groupSpec.rootLabel,dimNames:[]};if(!isPostOrder){specParentNode.children.push(specGroupParent);specParentNode.childrenByKey['']=specGroupParent;}}else{if(specParentNode.isRoot){specParentNode.label=groupSpec.rootLabel;}
specGroupParent=specParentNode;}
groupLevelRecursive.call(this,specGroupParent,specDatumsQuery,0);if(doFlatten){if(isPostOrder){specParentNode.children.push(specGroupParent);}
specParentNode.datums=specGroupParent.datums;}
function groupLevelRecursive(levelParentNode,levelDatums,levelIndex){var levelSpec=levelSpecs[levelIndex];if(!doFlatten){levelParentNode.children=[];levelParentNode.groupSpec=groupSpec;levelParentNode.groupLevelSpec=levelSpec;}
var childNodes=this._groupDatums(levelSpec,levelParentNode,levelDatums,doFlatten);var isLastSpecLevel=levelIndex===L-1;var willRecurseParent=doFlatten&&!isLastSpec;var levelParentDatums=willRecurseParent?[]:levelParentNode.datums;childNodes.forEach(function(child){var childDatums=child.datums;if(!(isLastSpec&&isLastSpecLevel)){child.datums=[];}
var specParentChildIndex;if(!doFlatten){levelParentNode.children.push(child);}else{def.array.lazy(levelParentNode,'_children').push(child);if(def.hasOwn(specParentNode.childrenByKey,child.key)){def.array.append(levelParentDatums,childDatums);return;}
specParentChildIndex=specParentNode.children.length;if(!isPostOrder){specParentNode.children.push(child);specParentNode.childrenByKey[child.key]=child;levelParentNode.isFlattenGroup=true;}}
if(!isLastSpecLevel){groupLevelRecursive.call(this,child,childDatums,levelIndex+1);}else if(!isLastSpec){this._groupSpecRecursive(child,childDatums,nextSpecIndex);}
def.array.append(levelParentDatums,child.datums);if(doFlatten&&isPostOrder){if(def.hasOwn(specParentNode.childrenByKey,child.key)){child.isFlattenGroup||def.assert("Must be a parent for duplicate keys to exist.");if(child._children.length===1){specParentNode.children.splice(specParentChildIndex,specParentNode.children.length-specParentChildIndex);child.isDegenerateFlattenGroup=true;}}
specParentNode.children.push(child);specParentNode.childrenByKey[child.key]=child;levelParentNode.isFlattenGroup=true;}},this);if(willRecurseParent){this._groupSpecRecursive(levelParentNode,levelParentDatums,nextSpecIndex);}}},_groupDatums:function(levelSpec,levelParentNode,levelDatums,doFlatten){var firstDatums=[];var childNodes=new def.OrderedMap();def.query(levelDatums).each(function(datum){var newChild=levelSpec.key(datum);var key=newChild.key;var child=childNodes.get(key);if(child){child.datums.push(datum);}else{child=newChild;child.datums=[datum];if(doFlatten){def.copy(child.atoms,levelParentNode.atoms);if(levelParentNode.dimNames.length){var keySep=datum.owner.keySep;var K=keySep.length;var trimKey=child.absKey=levelParentNode.absKey+
keySep+
key;while(trimKey.lastIndexOf(keySep)===trimKey.length-K){trimKey=trimKey.substr(0,trimKey.length-K);}
child.key=trimKey;}else{child.absKey=key;}
child.dimNames=levelSpec.accDimensionNames();}
var datumIndex=def.array.insert(firstDatums,datum,levelSpec.comparer);childNodes.add(key,child,~datumIndex);}});return childNodes;},_generateData:function(node,parentNode,parentData,rootData){var data,isNew;if(node.isRoot){if(rootData){data=rootData;data_addDatumsLocal.call(data,node.datums);}else{isNew=true;data=new pvc.data.Data({linkParent:parentData,datums:node.datums});data.treeHeight=node.treeHeight;data._groupOper=this;}}else{if(rootData){data=def.get(parentData._childrenByKey,node.key);if(data){data_addDatumsSimple.call(data,node.datums);}}
if(!data){isNew=true;var index,siblings;if(rootData&&(siblings=parentData._children)){index=~def.array.binarySearch(siblings,node.datums[0],parentNode.groupLevelSpec.comparer);}
data=new pvc.data.Data({parent:parentData,atoms:node.atoms,dimNames:node.dimNames,datums:node.datums,index:index});}}
if(isNew){if(node.isFlattenGroup){data._isFlattenGroup=true;data._isDegenerateFlattenGroup=!!node.isDegenerateFlattenGroup;}
var label=node.label;if(label){data.label+=label;data.absLabel+=label;}}
var childNodes=node.children;if(childNodes&&childNodes.length){if(isNew){data._groupSpec=node.groupSpec;data._groupLevelSpec=node.groupLevelSpec;}
childNodes.forEach(function(childNode){this._generateData(childNode,node,data,rootData);},this);}else if(isNew&&!node.isRoot){var leafs=data.root._leafs;data.leafIndex=leafs.length;leafs.push(data);}
return data;}});def.type('pvc.data.LinearInterpolationOper').init(function(allPartsData,data,catRole,serRole,valRole,stretchEnds){this._newDatums=[];this._data=data;var allCatDataRoot=catRole.flatten(allPartsData,{ignoreNulls:false});var allCatDatas=allCatDataRoot._children;var serDatas1=this._serDatas1=serRole.isBound()?serRole.flatten(data).children().array():[null];this._isCatDiscrete=catRole.grouping.isDiscrete();this._firstCatDim=!this._isCatDiscrete?data.owner.dimensions(catRole.firstDimensionName()):null;this._stretchEnds=stretchEnds;var valDim=this._valDim=data.owner.dimensions(valRole.firstDimensionName());var visibleKeyArgs={visible:true,zeroIfNone:false};this._catInfos=allCatDatas.map(function(allCatData,catIndex){var catData=data._childrenByKey[allCatData.key];var catInfo={data:catData||allCatData,value:allCatData.value,isInterpolated:false,serInfos:null,index:catIndex};catInfo.serInfos=serDatas1.map(function(serData1){var group=catData;if(group&&serData1){group=group._childrenByKey[serData1.key];}
var value=group?group.dimensions(valDim.name).sum(visibleKeyArgs):null;return{data:serData1,group:group,value:value,isNull:value==null,catInfo:catInfo};},this);return catInfo;});this._serCount=serDatas1.length;this._serStates=def.range(0,this._serCount).select(function(serIndex){return new pvc.data.LinearInterpolationOperSeriesState(this,serIndex);},this).array();}).add({interpolate:function(){var catInfo;while((catInfo=this._catInfos.shift())){catInfo.serInfos.forEach(this._visitSeries,this);}
var newDatums=this._newDatums;if(newDatums.length){this._data.owner.add(newDatums);}},_visitSeries:function(catSerInfo,serIndex){this._serStates[serIndex].visit(catSerInfo);},nextUnprocessedNonNullCategOfSeries:function(serIndex){var catIndex=0,catCount=this._catInfos.length;while(catIndex<catCount){var catInfo=this._catInfos[catIndex++];var catSerInfo=catInfo.serInfos[serIndex];if(!catSerInfo.isNull){return catSerInfo;}}}});def.type('pvc.data.LinearInterpolationOperSeriesState').init(function(interpolation,serIndex){this.interpolation=interpolation;this.index=serIndex;this._lastNonNull(null);}).add({visit:function(catSeriesInfo){if(catSeriesInfo.isNull){this._interpolate(catSeriesInfo);}
else{this._lastNonNull(catSeriesInfo);}},_lastNonNull:function(catSerInfo){if(arguments.length){this.__lastNonNull=catSerInfo;this.__nextNonNull=undefined;}
return this.__lastNonNull;},_nextNonNull:function(){return this.__nextNonNull;},_initInterpData:function(){if(this.__nextNonNull!==undefined){return;}
var last=this.__lastNonNull;var next=this.__nextNonNull=this.interpolation.nextUnprocessedNonNullCategOfSeries(this.index)||null;if(next&&last){var fromValue=last.value;var toValue=next.value;var deltaValue=toValue-fromValue;if(this.interpolation._isCatDiscrete){var stepCount=next.catInfo.index-last.catInfo.index;(stepCount>=2)||def.assert("Must have at least one interpolation point.");this._stepValue=deltaValue/stepCount;this._middleIndex=~~(stepCount/2);var dotCount=(stepCount-1);this._isOdd=(dotCount%2)>0;}else{var fromCat=+last.catInfo.value;var toCat=+next.catInfo.value;var deltaCat=toCat-fromCat;this._steep=deltaValue/deltaCat;this._middleCat=(toCat+fromCat)/2;}}},_interpolate:function(catSerInfo){this._initInterpData();var next=this.__nextNonNull;var last=this.__lastNonNull;var one=next||last;if(!one){return;}
var value,group;var interpolation=this.interpolation;var catInfo=catSerInfo.catInfo;if(next&&last){if(interpolation._isCatDiscrete){var groupIndex=(catInfo.index-last.catInfo.index);value=last.value+this._stepValue*groupIndex;if(this._isOdd){group=groupIndex<this._middleIndex?last.group:next.group;}else{group=groupIndex<=this._middleIndex?last.group:next.group;}}else{var cat=+catInfo.value;var lastCat=+last.catInfo.value;value=last.value+this._steep*(cat-lastCat);group=cat<this._middleCat?last.group:next.group;}}else{if(!interpolation._stretchEnds){return;}
value=one.value;group=one.group;}
var atoms=Object.create(group._datums[0].atoms);def.copyOwn(atoms,catInfo.data.atoms);var valueAtom=interpolation._valDim.intern(value,true);atoms[valueAtom.dimension.name]=valueAtom;var newDatum=new pvc.data.Datum(group.owner,atoms);newDatum.isVirtual=true;newDatum.isInterpolated=true;newDatum.interpolation='linear';interpolation._newDatums.push(newDatum);}});def.type('pvc.data.ZeroInterpolationOper').init(function(allPartsData,data,catRole,serRole,valRole,stretchEnds){this._newDatums=[];this._data=data;var allCatDataRoot=catRole.flatten(allPartsData,{ignoreNulls:false});var allCatDatas=allCatDataRoot._children;var serDatas1=this._serDatas1=serRole.isBound()?serRole.flatten(data).children().array():[null];this._isCatDiscrete=catRole.grouping.isDiscrete();this._firstCatDim=!this._isCatDiscrete?data.owner.dimensions(catRole.firstDimensionName()):null;this._stretchEnds=stretchEnds;var valDim=this._valDim=data.owner.dimensions(valRole.firstDimensionName());var visibleKeyArgs={visible:true,zeroIfNone:false};this._catInfos=allCatDatas.map(function(allCatData,catIndex){var catData=data._childrenByKey[allCatData.key];var catInfo={data:catData||allCatData,value:allCatData.value,isInterpolated:false,serInfos:null,index:catIndex};catInfo.serInfos=serDatas1.map(function(serData1){var group=catData;if(group&&serData1){group=group._childrenByKey[serData1.key];}
var value=group?group.dimensions(valDim.name).sum(visibleKeyArgs):null;return{data:serData1,group:group,value:value,isNull:value==null,catInfo:catInfo};},this);return catInfo;});this._serCount=serDatas1.length;this._serStates=def.range(0,this._serCount).select(function(serIndex){return new pvc.data.ZeroInterpolationOperSeriesState(this,serIndex);},this).array();}).add({interpolate:function(){var catInfo;while((catInfo=this._catInfos.shift())){catInfo.serInfos.forEach(this._visitSeries,this);}
var newDatums=this._newDatums;if(newDatums.length){this._data.owner.add(newDatums);}},_visitSeries:function(catSerInfo,serIndex){this._serStates[serIndex].visit(catSerInfo);},nextUnprocessedNonNullCategOfSeries:function(serIndex){var catIndex=0,catCount=this._catInfos.length;while(catIndex<catCount){var catInfo=this._catInfos[catIndex++];var catSerInfo=catInfo.serInfos[serIndex];if(!catSerInfo.isNull){return catSerInfo;}}}});def.type('pvc.data.ZeroInterpolationOperSeriesState').init(function(interpolation,serIndex){this.interpolation=interpolation;this.index=serIndex;this._lastNonNull(null);}).add({visit:function(catSeriesInfo){if(catSeriesInfo.isNull){this._interpolate(catSeriesInfo);}else{this._lastNonNull(catSeriesInfo);}},_lastNonNull:function(catSerInfo){if(arguments.length){this.__lastNonNull=catSerInfo;this.__nextNonNull=undefined;}
return this.__lastNonNull;},_nextNonNull:function(){return this.__nextNonNull;},_initInterpData:function(){if(this.__nextNonNull!==undefined){return;}
var last=this.__lastNonNull;var next=this.__nextNonNull=this.interpolation.nextUnprocessedNonNullCategOfSeries(this.index)||null;if(next&&last){var fromValue=last.value;var toValue=next.value;var deltaValue=toValue-fromValue;if(this.interpolation._isCatDiscrete){var stepCount=next.catInfo.index-last.catInfo.index;(stepCount>=2)||def.assert("Must have at least one interpolation point.");this._middleIndex=~~(stepCount/2);var dotCount=(stepCount-1);this._isOdd=(dotCount%2)>0;}else{var fromCat=+last.catInfo.value;var toCat=+next.catInfo.value;this._middleCat=(toCat+fromCat)/2;}}},_interpolate:function(catSerInfo){this._initInterpData();var next=this.__nextNonNull;var last=this.__lastNonNull;var one=next||last;if(!one){return;}
var group;var interpolation=this.interpolation;var catInfo=catSerInfo.catInfo;if(next&&last){if(interpolation._isCatDiscrete){var groupIndex=(catInfo.index-last.catInfo.index);if(this._isOdd){group=groupIndex<this._middleIndex?last.group:next.group;}else{group=groupIndex<=this._middleIndex?last.group:next.group;}}else{var cat=+catInfo.value;group=cat<this._middleCat?last.group:next.group;}}else{if(!interpolation._stretchEnds){return;}
group=one.group;}
var atoms=Object.create(group._datums[0].atoms);def.copyOwn(atoms,catInfo.data.atoms);var zeroAtom=interpolation._zeroAtom||(interpolation._zeroAtom=interpolation._valDim.intern(0,true));atoms[zeroAtom.dimension.name]=zeroAtom;var newDatum=new pvc.data.Datum(group.owner,atoms);newDatum.isVirtual=true;newDatum.isInterpolated=true;newDatum.interpolation='zero';interpolation._newDatums.push(newDatum);}});pvc.data.Data.add({load:function(atomz,keyArgs){data_assertIsOwner.call(this);var whereFun=def.get(keyArgs,'where');var isNullFun=def.get(keyArgs,'isNull');var datums=def.query(atomz).select(function(atoms){var datum=new pvc.data.Datum(this,atoms);if(isNullFun&&isNullFun(datum)){datum.isNull=true;}
if(whereFun&&!whereFun(datum)){return null;}
return datum;},this);data_setDatums.call(this,datums,{doAtomGC:true});},clearVirtuals:function(){var datums=this._datums;if(datums){this._sumAbsCache=null;var visibleNotNullDatums=this._visibleNotNullDatums;var selectedNotNullDatums=this._selectedNotNullDatums;var i=0;var L=datums.length;var removed;while(i<L){var datum=datums[i];if(datum.isVirtual){var id=datum.id;if(selectedNotNullDatums&&datum.isSelected){selectedNotNullDatums.rem(id);}
if(datum.isVisible){visibleNotNullDatums.rem(id);}
datums.splice(i,1);L--;removed=true;}else{i++;}}
if(removed){if(!datums.length&&this.parent){this.dispose();return;}
var children=this._children;if(children){i=0;L=children.length;while(i<L){var childData=children[i];childData.clearVirtuals();if(!childData.parent){L--;}else{i++;}}}
if(this._linkChildren){this._linkChildren.forEach(function(linkChildData){linkChildData.clearVirtuals();});}}}
def.eachOwn(this._dimensions,function(dim){dim_uninternVirtualAtoms.call(dim);});},add:function(datums){data_assertIsOwner.call(this);data_setDatums.call(this,datums,{isAdditive:true,doAtomGC:true});},groupBy:function(groupingSpecText,keyArgs){var groupOper=new pvc.data.GroupingOper(this,groupingSpecText,keyArgs),cacheKey=groupOper.key,groupByCache,data;if(cacheKey){groupByCache=this._groupByCache;data=groupByCache&&groupByCache[cacheKey];}
if(!data){if(pvc.debug>=7){pvc.log("[GroupBy] "+(cacheKey?("Cache key not found: '"+cacheKey+"'"):"No Cache key"));}
data=groupOper.execute();if(cacheKey){(groupByCache||(this._groupByCache={}))[cacheKey]=data;}}else if(pvc.debug>=7){pvc.log("[GroupBy] Cache key hit '"+cacheKey+"'");}
return data;},where:function(whereSpec,keyArgs){var datums=this.datums(whereSpec,keyArgs);return new pvc.data.Data({linkParent:this,datums:datums});},datums:function(whereSpec,keyArgs){if(!whereSpec){if(!keyArgs){return def.query(this._datums);}
return data_whereState(def.query(this._datums),keyArgs);}
whereSpec=data_processWhereSpec.call(this,whereSpec,keyArgs);return data_where.call(this,whereSpec,keyArgs);},datum:function(whereSpec,keyArgs){whereSpec||def.fail.argumentRequired('whereSpec');whereSpec=data_processWhereSpec.call(this,whereSpec,keyArgs);return data_where.call(this,whereSpec,keyArgs).first()||null;},dimensionsSumAbs:function(dimName,keyArgs){var key=dimName+":"+dim_buildDatumsFilterKey(keyArgs),sum=def.getOwn(this._sumAbsCache,key);if(sum==null){sum=this.children().where(function(childData){return!childData._isFlattenGroup||childData._isDegenerateFlattenGroup;}).select(function(childData){return Math.abs(childData.dimensions(dimName).sum(keyArgs));},this).reduce(def.add,0);(this._sumAbsCache||(this._sumAbsCache={}))[key]=sum;}
return sum;}});function data_setDatums(newDatums,keyArgs){newDatums||def.fail.argumentRequired('newDatums');var doAtomGC=def.get(keyArgs,'doAtomGC',false);var isAdditive=def.get(keyArgs,'isAdditive',false);var visibleNotNullDatums=this._visibleNotNullDatums;var selectedNotNullDatums=this._selectedNotNullDatums;var newDatumsByKey={};var prevDatumsByKey;var prevDatums=this._datums;if(prevDatums){var processPrevAtoms=isAdditive&&doAtomGC;prevDatumsByKey=def.query(prevDatums).uniqueIndex(function(datum){if(processPrevAtoms){data_processDatumAtoms.call(this,datum,false,true);}
return datum.key;},this);if(isAdditive){this._sumAbsCache=null;}else{data_disposeChildLists.call(this);if(selectedNotNullDatums){selectedNotNullDatums.clear();}
visibleNotNullDatums.clear();}}else{isAdditive=false;}
var datumsById;if(isAdditive){datumsById=this._datumsById;}
else{datumsById=this._datumsById={};}
if(def.array.is(newDatums)){var i=0;var L=newDatums.length;while(i<L){var inDatum=newDatums[i];var outDatum=setDatum.call(this,inDatum);if(!outDatum){newDatums.splice(i,1);L--;}else{if(outDatum!==inDatum){newDatums[i]=outDatum;}
i++;}}}else if(newDatums instanceof def.Query){newDatums=newDatums.select(setDatum,this).where(def.notNully).array();}else{throw def.error.argumentInvalid('newDatums',"Argument is of invalid type.");}
if(doAtomGC){def.eachOwn(this._dimensions,function(dimension){dim_uninternUnvisitedAtoms.call(dimension);});}
if(isAdditive){def.array.append(prevDatums,newDatums);if(this._linkChildren){this._linkChildren.forEach(function(linkChildData){data_addDatumsSimple.call(linkChildData,newDatums);});}}else{this._datums=newDatums;}
function setDatum(newDatum){if(!newDatum){return;}
var key=newDatum.key;if(def.hasOwnProp.call(newDatumsByKey,key)){return;}
if(prevDatumsByKey){var prevDatum=def.getOwn(prevDatumsByKey,key);if(prevDatum){if(isAdditive){return;}
newDatum=prevDatum;}}
newDatumsByKey[key]=newDatum;var id=newDatum.id;datumsById[id]=newDatum;data_processDatumAtoms.call(this,newDatum,!!this._dimensions,doAtomGC);if(!newDatum.isNull){if(selectedNotNullDatums&&newDatum.isSelected){selectedNotNullDatums.set(id,newDatum);}
if(newDatum.isVisible){visibleNotNullDatums.set(id,newDatum);}}
return newDatum;}}
function data_processDatumAtoms(datum,intern,markVisited){var dims=this._dimensions;if(!dims){intern=false;}
if(intern||markVisited){var atoms=datum.atoms;for(var dimName in atoms){var atom=atoms[dimName];if(intern){var localDim=def.getOwn(dims,dimName)||def.fail.argumentInvalid("Datum has atoms of foreign dimension.");dim_internAtom.call(localDim,atom);}
if(markVisited){atom.visited=true;}}}}
function data_addDatumsSimple(newDatums){newDatums||def.fail.argumentRequired('newDatums');var groupOper=this._groupOper;if(groupOper){newDatums=groupOper.executeAdd(this,newDatums);}else{data_addDatumsLocal.call(this,newDatums);}
if(this._linkChildren){this._linkChildren.forEach(function(linkChildData){data_addDatumsSimple.call(linkChildData,newDatums);});}}
function data_addDatumsLocal(newDatums){var visibleNotNullDatums=this._visibleNotNullDatums;var selectedNotNullDatums=this._selectedNotNullDatums;this._sumAbsCache=null;var datumsById=this._datumsById;var datums=this._datums;newDatums.forEach(addDatum,this);function addDatum(newDatum){var id=newDatum.id;datumsById[id]=newDatum;data_processDatumAtoms.call(this,newDatum,true,false);if(!newDatum.isNull){if(selectedNotNullDatums&&newDatum.isSelected){selectedNotNullDatums.set(id,newDatum);}
if(newDatum.isVisible){visibleNotNullDatums.set(id,newDatum);}}
datums.push(newDatum);}}
function data_processWhereSpec(whereSpec){var whereProcSpec=[];whereSpec=def.array.as(whereSpec);if(whereSpec){whereSpec.forEach(processDatumFilter,this);}
return whereProcSpec;function processDatumFilter(datumFilter){if(datumFilter!=null){(typeof datumFilter==='object')||def.fail.invalidArgument('datumFilter');var datumProcFilter={},any=false;for(var dimName in datumFilter){var atoms=processDimensionFilter.call(this,dimName,datumFilter[dimName]);if(atoms){any=true;datumProcFilter[dimName]=atoms;}}
if(any){whereProcSpec.push(datumProcFilter);}}}
function processDimensionFilter(dimName,values){var dimension=this.dimensions(dimName);var getAtom=function(value){return dimension.atom(value);};var atoms=def.query(values).select(getAtom).where(def.notNully).distinct(def.propGet('key')).array();return atoms.length?atoms:null;}}
function data_whereState(q,keyArgs){var selected=def.get(keyArgs,'selected'),visible=def.get(keyArgs,'visible'),where=def.get(keyArgs,'where'),isNull=def.get(keyArgs,'isNull');if(visible!=null){q=q.where(function(d){return d.isVisible===visible;});}
if(isNull!=null){q=q.where(function(d){return d.isNull===isNull;});}
if(selected!=null){q=q.where(function(d){return d.isSelected===selected;});}
if(where){q=q.where(where);}
return q;}
function data_where(whereSpec,keyArgs){var orderBys=def.array.as(def.get(keyArgs,'orderBy')),datumKeyArgs=def.create(keyArgs||{},{orderBy:null});var query=def.query(whereSpec).selectMany(function(datumFilter,index){if(orderBys){datumKeyArgs.orderBy=orderBys[index];}
return data_whereDatumFilter.call(this,datumFilter,datumKeyArgs);},this);return query.distinct(def.propGet('id'));}
function data_whereDatumFilter(datumFilter,keyArgs){var groupingSpecText=keyArgs.orderBy;if(!groupingSpecText){groupingSpecText=Object.keys(datumFilter).sort().join(',');}else{if(groupingSpecText.indexOf("|")>=0){throw def.error.argumentInvalid('keyArgs.orderBy',"Multi-dimension order by is not supported.");}}
var rootData=this.groupBy(groupingSpecText,keyArgs),H=rootData.treeHeight;var stateStack=[];return def.query(function(){var state;if(!this._data){this._data=rootData;this._dimAtomsOrQuery=def.query(datumFilter[rootData._groupLevelSpec.dimensions[0].name]);}else if(this._datumsQuery){this._data||def.assert("Must have a current data");stateStack.length||def.assert("Must have a parent data");!this._dimAtomsOrQuery||def.assert();if(this._datumsQuery.next()){this.item=this._datumsQuery.item;return 1;}
this._datumsQuery=null;state=stateStack.pop();this._data=state.data;this._dimAtomsOrQuery=state.dimAtomsOrQuery;}
this._dimAtomsOrQuery||def.assert("Invalid programmer");this._data||def.assert("Must have a current data");var depth=stateStack.length;do{while(this._dimAtomsOrQuery.next()){var dimAtomOr=this._dimAtomsOrQuery.item,childData=this._data._childrenByKey[dimAtomOr.key];if(childData&&(depth<H-1||childData._datums.length)){stateStack.push({data:this._data,dimAtomsOrQuery:this._dimAtomsOrQuery});this._data=childData;if(depth<H-1){this._dimAtomsOrQuery=def.query(datumFilter[childData._groupLevelSpec.dimensions[0].name]);depth++;}else{this._dimAtomsOrQuery=null;this._datumsQuery=def.query(childData._datums);this._datumsQuery.next();this.item=this._datumsQuery.item;return 1;}}}
if(!depth){return 0;}
state=stateStack.pop();this._data=state.data;this._dimAtomsOrQuery=state.dimAtomsOrQuery;depth--;}while(true);return 0;});}
pvc.data.Data.add({getInfo:function(){var out=["DATA SUMMARY",pvc.logSeparator,"  Dimension",pvc.logSeparator];def.eachOwn(this.dimensions(),function(dimension,name){var count=dimension.count(),type=dimension.type,features=[];features.push('"'+type.label+'"');features.push(type.valueTypeName);if(type.isComparable){features.push("comparable");}
if(!type.isDiscrete){features.push("continuous");}
if(type.isHidden){features.push("hidden");}
out.push("  "+
name+" ("+features.join(', ')+")"+" ("+count+")\n\t"+
dimension.atoms().slice(0,10).map(function(atom){return atom.label;}).join(", ")+
(count>10?"...":""));});return out.join("\n");},getValues:function(){return pv.range(0,this.getCategoriesSize()).map(function(categIndex){return this._getValuesForCategoryIndex(categIndex);},this);},_getDimensionValues:function(name){return this.dimensions(name).atoms().map(function(atom){return atom.value;});},_getDimensionVisibleValues:function(name){return this.dimensions(name).atoms({visible:true}).map(function(atom){return atom.value;});},getSeries:function(){return this._getDimensionValues('series');},getVisibleSeriesIndexes:function(){return this.dimensions('series').indexes({visible:true});},getVisibleCategoriesIndexes:function(){return this.dimensions('category').indexes({visible:true});},getVisibleSeries:function(){return this._getDimensionVisibleValues('series');},getCategories:function(){return this._getDimensionValues('category');},getVisibleCategories:function(){return this._getDimensionVisibleValues('category');},_getValuesForCategoryIndex:function(categIdx){var categAtom=this.dimensions('category').atoms()[categIdx];var datumsBySeriesKey=this.datums({category:categAtom}).uniqueIndex(function(datum){return datum.atoms.series.key;});return this.dimensions('series').atoms().map(function(atom){var datum=def.getOwn(datumsBySeriesKey,atom.key);return datum?datum.atoms.value.value:null;});},getSeriesSize:function(){var dim=this.dimensions('series',{assertExists:false});return dim?dim.count():0;},getCategoriesSize:function(){var dim=this.dimensions('category',{assertExists:false});return dim?dim.count():0;}});def.scope(function(){var I=def.makeEnum(['Interactive','ShowsActivity','ShowsSelection','ShowsTooltip','Selectable','Unselectable','Hoverable','Clickable','DoubleClickable','SelectableByClick','SelectableByRubberband','SelectableByFocusWindow','Animatable']);I.ShowsInteraction=I.ShowsActivity|I.ShowsSelection;I.Actionable=I.Hoverable|I.Clickable|I.DoubleClickable|I.SelectableByClick;I.HandlesEvents=I.Actionable|I.ShowsTooltip;I.HandlesClickEvent=I.Clickable|I.SelectableByClick;def.type('pvc.visual.Interactive').addStatic(I).addStatic({ShowsAny:I.ShowsInteraction|I.ShowsTooltip,SelectableAny:I.Selectable|I.SelectableByClick|I.SelectableByRubberband|I.SelectableByFocusWindow}).add({_ibits:-1}).add(def.query(def.ownKeys(I)).object({name:def.firstLowerCase,value:function(p){var mask=I[p];return function(){return!!(this._ibits&mask);};}}));});def.type('pvc.visual.Scene').init(function(parent,keyArgs){if(pvc.debug>=4){this.id=def.nextId('scene');}
this._renderId=0;this.renderState={};pv.Dom.Node.call(this,null);this.parent=parent||null;if(parent){this.root=parent.root;var index=def.get(keyArgs,'index',null);parent.insertAt(this,index);}else{this.root=this;this._active=null;this._panel=def.get(keyArgs,'panel')||def.fail.argumentRequired('panel',"Argument is required on root scene.");}
var first,group,datum,datums,groups,atoms,firstAtoms;var dataSource=def.array.to(def.get(keyArgs,'source'));if(dataSource&&dataSource.length){this.source=dataSource;first=dataSource[0];if(first instanceof pvc.data.Data){group=first;groups=dataSource;datum=group.firstDatum()||def.query(groups).select(function(g){return g.firstDatum();}).first(def.notNully);}else{(first instanceof pvc.data.Datum)||def.assert("not a datum");datum=first;datums=dataSource;}
atoms=first.atoms;firstAtoms=(datum&&datum.atoms)||first.atoms;}else if(parent){atoms=firstAtoms=Object.create(parent.atoms);}else{atoms=firstAtoms={};}
this.atoms=atoms;this.firstAtoms=firstAtoms;groups&&(this.groups=groups);group&&(this.group=group);datums&&(this._datums=datums);datum&&(this.datum=datum);if(!first||first.isNull){this.isNull=true;}
this.vars=parent?Object.create(parent.vars):{};}).add(pv.Dom.Node).add(pvc.visual.Interactive).add({source:null,groups:null,group:null,_datums:null,datum:null,isNull:false,data:function(){var data=this.group;if(!data){var scene=this;while(!data&&(scene=scene.parent)){data=scene.group;}
if(!data){data=this.panel.data;}}
return data;},datums:function(){return this.groups?def.query(this.groups).selectMany(function(g){return g.datums();}):this._datums?def.query(this._datums):def.query();},format:function(mask){return def.format(mask,this._formatScope,this);},_formatScope:function(prop){if(prop.charAt(0)==='#'){prop=prop.substr(1).split('.');if(prop.length>2){throw def.error.operationInvalid("Scene format mask is invalid.");}
var atom=this.firstAtoms[prop[0]];if(atom){if(prop.length>1){switch(prop[1]){case'value':return atom.value;case'label':break;default:throw def.error.operationInvalid("Scene format mask is invalid.");}}
return atom;}
return null;}
return def.getPath(this.vars,prop);},isRoot:function(){return this.root===this;},panel:function(){return this.root._panel;},chart:function(){return this.root._panel.chart;},compatVersion:function(){return this.root._panel.compatVersion();},children:function(){return this.childNodes?def.query(this.childNodes):def.query();},leafs:function(){function getFirstLeafFrom(leaf){while(leaf.childNodes.length){leaf=leaf.childNodes[0];}
return leaf;}
var root=this;return def.query(function(nextIndex){if(!nextIndex){var item=getFirstLeafFrom(root);if(item===root){return 0;}
this.item=item;return 1;}
var next=this.item.nextSibling;if(next){this.item=next;return 1;}
var current=this.item;while((current!==root)&&(current=current.parentNode)){if((next=current.nextSibling)){this.item=getFirstLeafFrom(next);return 1;}}
return 0;});},anyInteraction:function(){return(!!this.root._active||this.anySelected());},isActive:false,setActive:function(isActive){isActive=!!isActive;if(this.isActive!==isActive){rootScene_setActive.call(this.root,this.isActive?null:this);}},clearActive:function(){return rootScene_setActive.call(this.root,null);},anyActive:function(){return!!this.root._active;},active:function(){return this.root._active;},activeSeries:function(){var active=this.active();var seriesVar;return active&&(seriesVar=active.vars.series)&&seriesVar.value;},isActiveSeries:function(){if(this.isActive){return true;}
var isActiveSeries=this.renderState.isActiveSeries;if(isActiveSeries==null){var activeSeries;isActiveSeries=(activeSeries=this.activeSeries())!=null&&(activeSeries===this.vars.series.value);this.renderState.isActiveSeries=isActiveSeries;}
return isActiveSeries;},isActiveDatum:function(){if(this.isActive){return true;}
var isActiveDatum=this.renderState.isActiveDatum;if(isActiveDatum==null){var activeScene=this.active();if(activeScene){isActiveDatum=(this.group&&activeScene.group===this.group)||(this.datum&&activeScene.datum===this.datum);}else{isActiveDatum=false;}
this.renderState.isActiveDatum=isActiveDatum;}
return isActiveDatum;},isActiveDescendantOrSelf:function(){if(this.isActive){return true;}
return def.lazy(this.renderState,'isActiveDescOrSelf',this._calcIsActiveDescOrSelf,this);},_calcIsActiveDescOrSelf:function(){var scene=this.active();if(scene){while((scene=scene.parent)){if(scene===this){return true;}}}
return false;},isVisible:function(){return this._visibleData().is;},anyVisible:function(){return this._visibleData().any;},_visibleData:function(){return def.lazy(this.renderState,'_visibleData',this._createVisibleData,this);},_createVisibleData:function(){var any=this.chart().data.owner.visibleCount()>0,isSelected=any&&this.datums().any(def.propGet('isVisible'));return{any:any,is:isSelected};},isSelected:function(){return this._selectedData().is;},anySelected:function(){return this._selectedData().any;},_selectedData:function(){return def.lazy(this.renderState,'_selectedData',this._createSelectedData,this);},_createSelectedData:function(){var any=this.chart().data.owner.selectedCount()>0,isSelected=any&&this.datums().any(def.propGet('isSelected'));return{any:any,is:isSelected};},select:function(ka){var me=this;var datums=me.datums().array();if(datums.length){var chart=me.chart();chart._updatingSelections(function(){datums=chart._onUserSelection(datums);if(datums&&datums.length){if(chart.options.ctrlSelectMode&&def.get(ka,'replace',true)){chart.data.replaceSelected(datums);}else{pvc.data.Data.toggleSelected(datums);}}});}},isSelectedDescendantOrSelf:function(){if(this.isSelected()){return true;}
return def.lazy(this.renderState,'isSelectedDescOrSelf',this._calcIsSelectedDescOrSelf,this);},_calcIsSelectedDescOrSelf:function(){var child=this.firstChild;if(child){do{if(child.isSelectedDescendantOrSelf()){return true;}}while((child=child.nextSibling));}
return false;},toggleVisible:function(){if(pvc.data.Data.toggleVisible(this.datums())){this.chart().render(true,true,false);}}});function scene_renderId(renderId){if(this._renderId!==renderId){this._renderId=renderId;this.renderState={};}}
function rootScene_setActive(scene){var ownerScene;if(scene&&(ownerScene=scene.ownerScene)){scene=ownerScene;}
if(this._active!==scene){if(this._active){scene_setActive.call(this._active,false);}
this._active=scene||null;if(this._active){scene_setActive.call(this._active,true);}
return true;}
return false;}
function scene_setActive(isActive){if(this.isActive!==isActive){if(!isActive){delete this.isActive;}
else{this.isActive=true;}}}
pvc.visual.Scene.prototype.variable=function(name,impl){var proto=this;var methods;if(!(name in proto)){if(!(proto.hasOwnProperty('_vars'))){proto._vars=def.create(proto._vars);}
proto._vars[name]=true;methods={};var nameEval='_'+name+'Eval';methods[name]=scene_createVarMainMethod(name,nameEval);var nameEvalCore=nameEval+'Core';if(!def.hasOwn(proto,nameEval)){methods[nameEval]=def.methodCaller(nameEvalCore);}
if(!def.hasOwn(proto,nameEvalCore)){methods[nameEvalCore]=def.fun.to(impl===undefined?null:impl);}}else if(impl!==undefined){methods=def.set({},'_'+name+'EvalCore',def.fun.to(impl));}
if(methods){proto.constructor.add(methods);}
return proto;};function scene_createVarMainMethod(name,nameEval){return function(){var vb=this.vars[name];if(vb===undefined){vb=this[nameEval]();if(vb===undefined){vb=null;}
this.vars[name]=vb;}
return vb;};}
var pvc_ValueLabelVar=pvc.visual.ValueLabelVar=function(value,label,rawValue,absLabel){this.value=value;this.label=label;if(rawValue!==undefined){this.rawValue=rawValue;}
if(absLabel!==undefined){this.absLabel=absLabel;}};def.set(pvc_ValueLabelVar.prototype,'rawValue',undefined,'absLabel',undefined,'setValue',function(v){this.value=v;return this;},'setLabel',function(v){this.label=v;return this;},'clone',function(){return new pvc_ValueLabelVar(this.value,this.label,this.rawValue);},'toString',function(){var label=this.label||this.value;return label==null?"":(typeof label!=='string')?(''+label):label;});pvc_ValueLabelVar.fromComplex=function(complex){return complex?new pvc_ValueLabelVar(complex.value,complex.label,complex.rawValue,complex.absLabel):new pvc_ValueLabelVar(null,"",null);};pvc_ValueLabelVar.fromAtom=pvc_ValueLabelVar.fromComplex;def.type('pvc.visual.Context').init(function(panel,mark,event){this.chart=panel.chart;this.panel=panel;visualContext_update.call(this,mark,event);}).add({isPinned:false,pin:function(){this.isPinned=true;return this;},compatVersion:function(){return this.panel.compatVersion();},finished:function(v){return this.sign.finished(v);},delegate:function(dv){return this.sign.delegate(dv);},getV1Series:function(){var s;return def.nullyTo(this.scene.firstAtoms&&(s=this.scene.firstAtoms[this.panel._getV1DimName('series')])&&s.rawValue,'Series');},getV1Category:function(){var c;return this.scene.firstAtoms&&(c=this.scene.firstAtoms[this.panel._getV1DimName('category')])&&c.rawValue;},getV1Value:function(){var v;return this.scene.firstAtoms&&(v=this.scene.firstAtoms[this.panel._getV1DimName('value')])&&v.value;},getV1Datum:function(){return this.panel._getV1Datum(this.scene);},select:function(ka){return this.scene.select(ka);},toggleVisible:function(){return this.scene.toggleVisible();},click:function(){var me=this;if(me.clickable()){me.panel._onClick(me);}
if(me.selectableByClick()){var ev=me.event;me.select({replace:!ev||!ev.ctrlKey});}},doubleClick:function(){if(this.doubleClickable()){this.panel._onDoubleClick(this);}},clickable:function(){var me=this;return(me.sign?me.sign.clickable():me.panel.clickable())&&(!me.scene||me.scene.clickable());},selectableByClick:function(){var me=this;return(me.sign?me.sign.selectableByClick():me.panel.selectableByClick())&&(!me.scene||me.scene.selectableByClick());},doubleClickable:function(){var me=this;return(me.sign?me.sign.doubleClickable():me.panel.doubleClickable())&&(!me.scene||me.scene.doubleClickable());},hoverable:function(){var me=this;return(me.sign?me.sign.hoverable():me.panel.hoverable())&&(!me.scene||me.scene.hoverable());}});if(Object.defineProperty){try{Object.defineProperty(pvc.visual.Context.prototype,'parent',{get:function(){throw def.error.operationInvalid("The 'this.parent.index' idiom has no equivalent in this version. Please try 'this.pvMark.parent.index'.");}});}catch(ex){}}
function visualContext_update(pvMark,ev){this.event=ev||pv.event;this.pvMark=pvMark;var scene;if(pvMark){var sign=this.sign=pvMark.sign||null;if(sign){scene=pvMark.instance().data;}
if(!scene){this.index=null;scene=new pvc.visual.Scene(null,{panel:this.panel});}else{this.index=scene.childIndex();}}else{this.sign=null;this.index=null;scene=new pvc.visual.Scene(null,{panel:this.panel,source:this.chart.root.data});}
this.scene=scene;}
def.space('pvc.visual').TraversalMode=def.makeEnum(['Tree','FlattenedSingleLevel','FlattenDfsPre','FlattenDfsPost']);def.type('pvc.visual.Role').init(function(name,keyArgs){this.name=name;this.label=def.get(keyArgs,'label')||pvc.buildTitleFromName(name);this.index=def.get(keyArgs,'index')||0;this.dimensionDefaults=def.get(keyArgs,'dimensionDefaults')||{};if(def.get(keyArgs,'isRequired',false)){this.isRequired=true;}
if(def.get(keyArgs,'autoCreateDimension',false)){this.autoCreateDimension=true;}
var defaultSourceRoleName=def.get(keyArgs,'defaultSourceRole');if(defaultSourceRoleName){this.defaultSourceRoleName=defaultSourceRoleName;}
var defaultDimensionName=def.get(keyArgs,'defaultDimension');if(defaultDimensionName){this.defaultDimensionName=defaultDimensionName;}
if(!defaultDimensionName&&this.autoCreateDimension){throw def.error.argumentRequired('defaultDimension');}
var requireSingleDimension;var requireIsDiscrete=def.get(keyArgs,'requireIsDiscrete');if(requireIsDiscrete!=null){if(!requireIsDiscrete){requireSingleDimension=true;}}
if(requireSingleDimension!=null){requireSingleDimension=def.get(keyArgs,'requireSingleDimension',false);if(requireSingleDimension){if(def.get(keyArgs,'isMeasure',false)){this.isMeasure=true;if(def.get(keyArgs,'isPercent',false)){this.isPercent=true;}}
var valueType=def.get(keyArgs,'valueType',null);if(valueType!==this.valueType){this.valueType=valueType;this.dimensionDefaults.valueType=valueType;}}}
if(requireSingleDimension!==this.requireSingleDimension){this.requireSingleDimension=requireSingleDimension;}
if(requireIsDiscrete!=this.requireIsDiscrete){this.requireIsDiscrete=!!requireIsDiscrete;this.dimensionDefaults.isDiscrete=this.requireIsDiscrete;}
var traversalMode=def.get(keyArgs,'traversalMode');if(traversalMode!=null&&traversalMode!==this.traversalMode){this.traversalMode=traversalMode;}}).add({isRequired:false,requireSingleDimension:false,valueType:null,requireIsDiscrete:null,isMeasure:false,isPercent:false,defaultSourceRoleName:null,defaultDimensionName:null,grouping:null,traversalMode:pvc.visual.TraversalMode.FlattenedSingleLevel,rootLabel:'',autoCreateDimension:false,isReversed:false,label:null,sourceRole:null,isDefaultSourceRole:false,firstDimensionType:function(){var g=this.grouping;return g&&g.firstDimensionType();},firstDimensionName:function(){var g=this.grouping;return g&&g.firstDimensionName();},firstDimensionValueType:function(){var g=this.grouping;return g&&g.firstDimensionValueType();},isDiscrete:function(){var g=this.grouping;return g&&g.isDiscrete();},setSourceRole:function(sourceRole,isDefault){this.sourceRole=sourceRole;this.isDefaultSourceRole=!!isDefault;},setIsReversed:function(isReversed){if(!isReversed){delete this.isReversed;}
else{this.isReversed=true;}},setTraversalMode:function(travMode){var T=pvc.visual.TraversalMode;travMode=def.nullyTo(travMode,T.FlattenedSingleLevel);if(travMode!==this.traversalMode){if(travMode===T.FlattenedSingleLevel){delete this.traversalMode;}else{this.traversalMode=travMode;}}},setRootLabel:function(rootLabel){if(rootLabel!==this.rootLabel){if(!rootLabel){delete this.rootLabel;}
else{this.rootLabel=rootLabel;}
if(this.grouping){this._updateBind(this.grouping);}}},flatten:function(data,keyArgs){var grouping=this.flattenedGrouping(keyArgs)||def.fail.operationInvalid("Role is unbound.");return data.groupBy(grouping,keyArgs);},flattenedGrouping:function(keyArgs){var grouping=this.grouping;if(grouping){if(!keyArgs){keyArgs={};}
var flatMode=keyArgs.flatteningMode;if(flatMode==null){flatMode=keyArgs.flatteningMode=this._flatteningMode();}
if(keyArgs.isSingleLevel==null&&!flatMode){keyArgs.isSingleLevel=true;}
if(keyArgs.flatteningMode==null){keyArgs.flatteningMode=this._flatteningMode();}
return grouping.ensure(keyArgs);}},_flatteningMode:function(){var T=pvc.visual.TraversalMode;var F=pvc.data.FlatteningMode;switch(this.traversalMode){case T.FlattenDfsPre:return F.DfsPre;case T.FlattenDfsPost:return F.DfsPost;}
return T.None;},select:function(data,keyArgs){var grouping=this.grouping;if(grouping){def.setUDefaults(keyArgs,'flatteningMode',pvc.data.FlatteningMode.None);return data.groupBy(grouping.ensure(keyArgs),keyArgs);}},view:function(complex){var grouping=this.grouping;if(grouping){return grouping.view(complex);}},preBind:function(groupingSpec){this.__grouping=groupingSpec;return this;},isPreBound:function(){return!!this.__grouping;},preBoundGrouping:function(){return this.__grouping;},isBound:function(){return!!this.grouping;},postBind:function(type){var grouping=this.__grouping;if(grouping){delete this.__grouping;grouping.bind(type);this.bind(grouping);}
return this;},bind:function(groupingSpec){groupingSpec=this._validateBind(groupingSpec);this._updateBind(groupingSpec);return this;},_validateBind:function(groupingSpec){if(groupingSpec){if(groupingSpec.isNull()){groupingSpec=null;}else{if(this.requireSingleDimension&&!groupingSpec.isSingleDimension){throw def.error.operationInvalid("Role '{0}' only accepts a single dimension.",[this.name]);}
var valueType=this.valueType;var requireIsDiscrete=this.requireIsDiscrete;groupingSpec.dimensions().each(function(dimSpec){var dimType=dimSpec.type;if(valueType&&dimType.valueType!==valueType){throw def.error.operationInvalid("Role '{0}' cannot be bound to dimension '{1}'. \nIt only accepts dimensions of type '{2}' and not of type '{3}'.",[this.name,dimType.name,pvc.data.DimensionType.valueTypeName(valueType),dimType.valueTypeName]);}
if(requireIsDiscrete!=null&&dimType.isDiscrete!==requireIsDiscrete){if(requireIsDiscrete){dimType._toDiscrete();}else{throw def.error.operationInvalid("Role '{0}' cannot be bound to dimension '{1}'. \nIt only accepts {2} dimensions.",[this.name,dimType.name,requireIsDiscrete?'discrete':'continuous']);}}},this);}}
return groupingSpec;},_updateBind:function(groupingSpec){if(this.grouping){this.grouping.dimensions().each(function(dimSpec){if(dimSpec.type){dimType_removeVisualRole.call(dimSpec.type,this);}},this);}
this.grouping=groupingSpec;if(this.grouping){this.grouping=this.grouping.ensure({reverse:this.isReversed,rootLabel:this.rootLabel});this.grouping.dimensions().each(function(dimSpec){dimType_addVisualRole.call(dimSpec.type,this);},this);}}});def.type('pvc.visual.RoleVarHelper').init(function(rootScene,role,keyArgs){var hasPercentSubVar=def.get(keyArgs,'hasPercentSubVar',false);var roleVarName=def.get(keyArgs,'roleVar');var g=this.grouping=role&&role.grouping;if(g){this.role=role;this.sourceRoleName=role.sourceRole&&role.sourceRole.name;var panel=rootScene.panel();this.panel=panel;if(!g.isDiscrete()){this.rootContDim=panel.data.owner.dimensions(g.firstDimensionName());if(hasPercentSubVar){this.percentFormatter=panel.chart.options.percentValueFormat;}}}
if(!roleVarName){if(!role){throw def.error.operationInvalid("Role is not defined, so the roleVar argument is required.");}
roleVarName=role.name;}
if(!g){var roleVar=rootScene.vars[roleVarName]=new pvc_ValueLabelVar(null,"");if(hasPercentSubVar){roleVar.percent=new pvc_ValueLabelVar(null,"");}}
this.roleVarName=roleVarName;rootScene['is'+def.firstUpperCase(roleVarName)+'Bound']=!!g;if(def.get(keyArgs,'allowNestedVars')){this.allowNestedVars=true;}}).add({allowNestedVars:false,isBound:function(){return!!this.grouping;},onNewScene:function(scene,isLeaf){if(!this.grouping){return;}
var roleVarName=this.roleVarName;if(this.allowNestedVars?def.hasOwnProp.call(scene.vars,roleVarName):scene.vars[roleVarName]){return;}
var sourceName=this.sourceRoleName;if(sourceName){var sourceVar=def.getOwn(scene.vars,sourceName);if(sourceVar){scene.vars[roleVarName]=sourceVar.clone();return;}}
if(isLeaf){var roleVar;var rootContDim=this.rootContDim;if(!rootContDim){var firstDatum=scene.datum;if(firstDatum&&!firstDatum.isNull){var view=this.grouping.view(firstDatum);roleVar=pvc_ValueLabelVar.fromComplex(view);}}else{var valuePct,valueDim;var group=scene.group;var singleDatum=group?group.singleDatum():scene.datum;if(singleDatum){if(!singleDatum.isNull){roleVar=pvc_ValueLabelVar.fromAtom(singleDatum.atoms[rootContDim.name]);if(roleVar.value!=null&&this.percentFormatter){if(group){valueDim=group.dimensions(rootContDim.name);valuePct=valueDim.percentOverParent({visible:true});}else{valuePct=scene.data().dimensions(rootContDim.name).percent(roleVar.value);}}}}else if(group){valueDim=group.dimensions(rootContDim.name);var value=valueDim.sum({visible:true,zeroIfNone:false});if(value!=null){var label=rootContDim.format(value);roleVar=new pvc_ValueLabelVar(value,label,value);if(this.percentFormatter){valuePct=valueDim.percentOverParent({visible:true});}}}
if(roleVar&&this.percentFormatter){if(roleVar.value==null){roleVar.percent=new pvc_ValueLabelVar(null,"");}else{roleVar.percent=new pvc_ValueLabelVar(valuePct,this.percentFormatter.call(null,valuePct));}}}
if(!roleVar){roleVar=new pvc_ValueLabelVar(null,"");if(this.percentFormatter){roleVar.percent=new pvc_ValueLabelVar(null,"");}}
scene.vars[roleVarName]=roleVar;}}});function sign_createBasic(pvMark){var as=mark_getAncestorSign(pvMark)||def.assert("There must exist an ancestor sign");var bs=new pvc.visual.BasicSign(as.panel,pvMark);var s=pvMark.scene;var i,pvInstance;if(s&&(i=pvMark.index)!=null&&i>=0&&(pvInstance=s[i])){bs._inContext(pvInstance.data,pvInstance);}
return bs;}
function mark_getAncestorSign(pvMark){var sign;do{pvMark=pvMark.parent;}
while(pvMark&&!(sign=pvMark.sign)&&(!pvMark.proto||!(sign=pvMark.proto.sign)));return sign;}
pv_Mark.prototype.getSign=function(){return this.sign||sign_createBasic(this);};pv_Mark.prototype.getScene=function(){return this.getSign().scene;};pv_Mark.prototype.getContext=function(){return this.getSign().context();};def.type('pvc.visual.BasicSign').init(function(panel,pvMark){this.chart=panel.chart;this.panel=panel;this.pvMark=pvMark;!pvMark.sign||def.assert("Mark already has an attached Sign.");pvMark.sign=this;pvMark.__buildInstance=pvMark.buildInstance;pvMark.buildInstance=this._dispatchBuildInstance;}).add({compatVersion:function(){return this.chart.compatVersion();},localProperty:function(name,type){this.pvMark.localProperty(name,type);return this;},lock:function(pvName,value){return this.lockMark(pvName,this._bindWhenFun(value,pvName));},optional:function(pvName,value,tag){return this.optionalMark(pvName,this._bindWhenFun(value,pvName),tag);},lockMark:function(name,value){this.pvMark.lock(name,value);return this;},optionalMark:function(name,value,tag){this.pvMark[name](value,tag);return this;},delegate:function(dv,tag){return this.pvMark.delegate(dv,tag);},delegateExtension:function(dv){return this.pvMark.delegate(dv,pvc.extensionTag);},hasDelegate:function(tag){return this.pvMark.hasDelegate(tag);},_createPropInterceptor:function(pvName,fun){var me=this;var isDataProp=pvName==='data';return function(){var sign=this.sign;if(!sign||sign!==me){return me._getPvSceneProp(pvName,this.index);}
if(!isDataProp){var pvInstance=this.scene[this.index];if(!sign.scene||sign.scene!==pvInstance.data){me._inContext(pvInstance.data,pvInstance);}}
return fun.apply(me,arguments);};},_getPvSceneProp:function(prop,defaultIndex){var pvMark=this.pvMark;var pvScenes=pvMark.scene;if(pvScenes){var index=pvMark.hasOwnProperty('index')?pvMark.index:Math.min(defaultIndex,pvScenes.length-1);if(index!=null){return pvScenes[index][prop];}}
throw def.error.operationInvalid("Cannot evaluate inherited property.");},_bindWhenFun:function(value,pvName){if(def.fun.is(value)){var me=this;return me._createPropInterceptor(pvName,function(scene){return value.call(me,scene);});}
return value;},_lockDynamic:function(pvName,method){var me=this;return me.lockMark(pvName,me._createPropInterceptor(pvName,function(scene){return me[method].call(me,scene);}));},_dispatchBuildInstance:function(pvInstance){function callBuildInstanceInContext(){this.__buildInstance(pvInstance);}
this.sign._inContext(pvInstance.data,pvInstance,callBuildInstanceInContext,this);},_inContext:function(scene,pvInstance,f,x){var pvMark=this.pvMark;if(!pvInstance){pvInstance=pvMark.scene[pvMark.index];}
if(!scene){scene=pvInstance.data||def.assert("A scene is required!");}
var index=scene.childIndex();var oldScene,oldIndex,oldState;var oldPvInstance=this.pvInstance;if(oldPvInstance){oldScene=this.scene;oldIndex=this.index;oldState=this.state;}
this.pvInstance=pvInstance;this.scene=scene;this.index=index<0?0:index;scene_renderId.call(scene,pvMark.renderId());this.state={};if(f){try{return f.call(x,pvInstance);}finally{this.state=oldState;this.pvInstance=oldPvInstance;this.scene=oldScene;this.index=oldIndex;}}},context:function(createNew){var state;if(createNew||!(state=this.state)){return this._createContext();}
return state.context||(state.context=this._createContext());},_createContext:function(){return new pvc.visual.Context(this.panel,this.pvMark);}});def.type('pvc.visual.Sign',pvc.visual.BasicSign).init(function(panel,pvMark,keyArgs){var me=this;me.base(panel,pvMark,keyArgs);me._ibits=panel._ibits;var extensionIds=def.get(keyArgs,'extensionId');if(extensionIds!=null){me.extensionAbsIds=def.array.to(panel._makeExtensionAbsId(extensionIds));}
me.isActiveSeriesAware=def.get(keyArgs,'activeSeriesAware',true);if(me.isActiveSeriesAware){var roles=panel.visualRoles;var seriesRole=roles&&roles.series;if(!seriesRole||!seriesRole.isBound()){me.isActiveSeriesAware=false;}}
pvMark.wrapper(def.get(keyArgs,'wrapper')||me.createDefaultWrapper());if(!def.get(keyArgs,'freeColor',true)){me._bindProperty('fillStyle','fillColor','color')._bindProperty('strokeStyle','strokeColor','color');}}).postInit(function(panel,pvMark,keyArgs){this._addInteractive(keyArgs);panel._addSign(this);}).add({createDefaultWrapper:function(){var me=this;return function(f){return function(scene){return f.call(me.context(),scene);};};},property:function(name){var upperName=def.firstUpperCase(name);var baseName='base'+upperName;var defName='default'+upperName;var normalName='normal'+upperName;var interName='interactive'+upperName;var methods={};methods[name]=function(arg){this._finished=false;this._arg=arg;var value=this[baseName](arg);if(value==null){return null;}
if(this._finished){return value;}
if(this.showsInteraction()&&this.anyInteraction()){value=this[interName](value,arg);}else{value=this[normalName](value,arg);}
this._arg=null;return value;};methods[baseName]=function(){return this.delegateExtension();};methods[defName]=function(){return;};methods[normalName]=function(value){return value;};methods[interName]=function(value){return value;};this.constructor.add(methods);return this;},anyInteraction:function(){return this.scene.anyInteraction();},finished:function(value){this._finished=true;return value;},applyExtensions:function(){if(!this._extended){this._extended=true;var extensionAbsIds=this.extensionAbsIds;if(extensionAbsIds){extensionAbsIds.forEach(function(extensionAbsId){this.panel.extendAbs(this.pvMark,extensionAbsId);},this);}}
return this;},intercept:function(pvName,fun){var interceptor=this._createPropInterceptor(pvName,fun);return this._intercept(pvName,interceptor);},lockDimensions:function(){this.pvMark.lock('left').lock('right').lock('top').lock('bottom').lock('width').lock('height');return this;},_extensionKeyArgs:{tag:pvc.extensionTag},_bindProperty:function(pvName,prop,realProp){var me=this;if(!realProp){realProp=prop;}
var defaultPropName="default"+def.firstUpperCase(realProp);if(def.fun.is(me[defaultPropName])){if(!me.pvMark.hasDelegateValue(pvName,pvc.extensionTag)){var defaultPropMethod=function(){return me[defaultPropName](me._arg);};me.pvMark.intercept(pvName,defaultPropMethod,me._extensionKeyArgs);}}
var mainPropMethod=this._createPropInterceptor(pvName,function(){return me[prop]();});return me._intercept(pvName,mainPropMethod);},_intercept:function(name,fun){var mark=this.pvMark;var extensionAbsIds=this.extensionAbsIds;if(extensionAbsIds){def.query(extensionAbsIds).select(function(extensionAbsId){return this.panel._getExtensionAbs(extensionAbsId,name);},this).where(def.notUndef).each(function(extValue){extValue=mark.wrap(extValue,name);mark.intercept(name,extValue,this._extensionKeyArgs);},this);}
(mark._intercepted||(mark._intercepted={}))[name]=true;mark.intercept(name,fun);return this;}}).prototype.property('color').constructor.add(pvc.visual.Interactive).add({extensionAbsIds:null,_addInteractive:function(ka){var me=this,get=def.get;if(me.interactive()){var bits=me._ibits,I=pvc.visual.Interactive;if(get(ka,'noTooltip')){bits&=~I.ShowsTooltip;}
if(get(ka,'noHover')){bits&=~I.Hoverable;}
if(get(ka,'noClick')){bits&=~I.Clickable;}
if(get(ka,'noDoubleClick')){bits&=~I.DoubleClickable;}
if(get(ka,'noSelect')){bits&=~I.SelectableAny;}
else if(this.selectable()){if(get(ka,'noClickSelect')){bits&=~I.SelectableByClick;}
if(get(ka,'noRubberSelect')){bits&=~I.SelectableByRubberband;}}
if(me.showsInteraction()){if(get(ka,'showsInteraction')===false){bits&=~I.ShowsInteraction;}
if(me.showsActivity()){if(get(ka,'showsActivity')===false){bits&=~I.ShowsActivity;}}
if(me.showsSelection()){if(get(ka,'showsSelection')===false){bits&=~I.ShowsSelection;}}}
me._ibits=bits;}
if(!me.handlesEvents()){me.pvMark.events('none');}else{if(me.showsTooltip()){me._addPropTooltip(get(ka,'tooltipArgs'));}
if(me.hoverable()){me._addPropHoverable();}
if(me.handlesClickEvent()){me._addPropClick();}
if(me.doubleClickable()){me._addPropDoubleClick();}}},fillColor:function(){return this.color('fill');},strokeColor:function(){return this.color('stroke');},defaultColor:function(){return this.defaultColorSceneScale()(this.scene);},dimColor:function(color,type){if(type==='text'){return pvc.toGrayScale(color,-0.75,null,null);}
return pvc.toGrayScale(color,-0.3,null,null);},defaultColorSceneScale:function(){return def.lazy(this,'_defaultColorSceneScale',this._initDefColorScale,this);},_initDefColorScale:function(){var colorAxis=this.panel.axes.color;return colorAxis?colorAxis.sceneScale({sceneVarName:'color'}):def.fun.constant(pvc.defaultColor);},mayShowActive:function(noSeries){if(!this.showsActivity()){return false;}
var scene=this.scene;return scene.isActive||(!noSeries&&this.isActiveSeriesAware&&scene.isActiveSeries())||scene.isActiveDatum();},mayShowNotAmongSelected:function(){return this.mayShowAnySelected()&&!this.scene.isSelected();},mayShowSelected:function(){return this.showsSelection()&&this.scene.isSelected();},mayShowAnySelected:function(){return this.showsSelection()&&this.scene.anySelected();},_addPropTooltip:function(ka){if(this.pvMark.hasTooltip){return;}
var tipOptions=def.create(this.chart._tooltipOptions,def.get(ka,'options'));tipOptions.isLazy=def.get(ka,'isLazy',true);var tooltipFormatter=def.get(ka,'buildTooltip')||this._getTooltipFormatter(tipOptions);if(!tooltipFormatter){return;}
tipOptions.isEnabled=this._isTooltipEnabled.bind(this);var tipsyEvent=def.get(ka,'tipsyEvent');if(!tipsyEvent){tipsyEvent='mouseover';}
this.pvMark.localProperty('tooltip').tooltip(this._createTooltipProp(tooltipFormatter,tipOptions.isLazy)).title(def.fun.constant('')).ensureEvents().event(tipsyEvent,pv.Behavior.tipsy(tipOptions)).hasTooltip=true;},_getTooltipFormatter:function(tipOptions){return this.panel._getTooltipFormatter(tipOptions);},_isTooltipEnabled:function(){return this.panel._isTooltipEnabled();},_createTooltipProp:function(tooltipFormatter,isLazy){var me=this;var formatTooltip;if(!isLazy){formatTooltip=function(){var context=me.context();return tooltipFormatter(context);};}else{formatTooltip=function(){var context=me.context(true);var tooltip;return function(){if(context){tooltip=tooltipFormatter(context);context=null;}
return tooltip;};};}
return function(){var scene=me.scene;if(scene&&!scene.isIntermediate&&scene.showsTooltip()){return formatTooltip();}};},_addPropHoverable:function(){var panel=this.panel;var onEvent;var offEvent;onEvent='mouseover';offEvent='mouseout';this.pvMark.ensureEvents().event(onEvent,function(scene){if(scene.hoverable()&&!panel.selectingByRubberband()&&!panel.animating()){scene.setActive(true);panel.renderInteractive();}}).event(offEvent,function(scene){if(scene.hoverable()&&!panel.selectingByRubberband()&&!panel.animating()){if(scene.clearActive()){panel.renderInteractive();}}});},_ignoreClicks:0,_propCursorClick:function(s){var ibits=(this._ibits&s._ibits);var I=pvc.visual.Interactive;return(ibits&I.HandlesClickEvent)||(ibits&I.DoubleClickable)?'pointer':null;},_addPropClick:function(){var me=this;me.pvMark.cursor(me._propCursorClick.bind(me)).ensureEvents().event('click',me._handleClick.bind(me));},_addPropDoubleClick:function(){var me=this;me.pvMark.cursor(me._propCursorClick.bind(me)).ensureEvents().event('dblclick',me._handleDoubleClick.bind(me));},_handleClick:function(){var me=this;var pvMark=me.pvMark;var pvInstance=pvMark.instance();var scene=pvInstance.data;var wait=me.doubleClickable()&&scene.doubleClickable();if(!wait){if(me._ignoreClicks){me._ignoreClicks--;}
else{me._handleClickCore();}}else{var pvScene=pvMark.scene;var pvIndex=pvMark.index;var pvEvent=pv.event;window.setTimeout(function(){if(me._ignoreClicks){me._ignoreClicks--;}
else{try{pv.event=pvEvent;pvMark.context(pvScene,pvIndex,function(){me._handleClickCore();});}catch(ex){pv.error(ex);}finally{delete pv.event;}}},me.chart.options.doubleClickMaxDelay||300);}},_handleClickCore:function(){var me=this;var pvInstance=me.pvMark.instance();me._inContext(pvInstance.data,pvInstance,function(){me._onClick(me.context());},me);},_handleDoubleClick:function(){var me=this;var pvInstance=me.pvMark.instance();var scene=pvInstance.data;if(scene.doubleClickable()){me._ignoreClicks=2;me._inContext(pvInstance.data,pvInstance,function(){me._onDoubleClick(me.context());},me);}},_onClick:function(context){context.click();},_onDoubleClick:function(context){context.doubleClick();}});def.type('pvc.visual.Panel',pvc.visual.Sign).init(function(panel,protoMark,keyArgs){var pvPanel=def.get(keyArgs,'panel');if(!pvPanel){var pvPanelType=def.get(keyArgs,'panelType')||pv.Panel;pvPanel=protoMark.add(pvPanelType);}
this.base(panel,pvPanel,keyArgs);}).add({_addInteractive:function(keyArgs){var t=true;keyArgs=def.setDefaults(keyArgs,'noSelect',t,'noHover',t,'noTooltip',t,'noClick',t,'noDoubleClick',t);this.base(keyArgs);}});def.type('pvc.visual.Label',pvc.visual.Sign).init(function(panel,protoMark,keyArgs){var pvMark=protoMark.add(pv.Label);this.base(panel,pvMark,keyArgs);}).add({_addInteractive:function(keyArgs){var t=true;keyArgs=def.setDefaults(keyArgs,'noSelect',t,'noHover',t,'noTooltip',t,'noClick',t,'noDoubleClick',t,'showsInteraction',false);this.base(keyArgs);},defaultColor:def.fun.constant(pv.Color.names.black)});def.type('pvc.visual.ValueLabel',pvc.visual.Label).init(function(panel,anchorMark,keyArgs){var protoMark;if(!def.get(keyArgs,'noAnchor',false)){protoMark=anchorMark.anchor(panel.valuesAnchor);}else{protoMark=anchorMark;}
if(keyArgs&&keyArgs.extensionId==null){keyArgs.extensionId='label';}
this.base(panel,protoMark,keyArgs);this._bindProperty('text','text');this.pvMark.font(panel.valuesFont);this._bindProperty('textStyle','textColor','color');}).prototype.property('text').property('textStyle').constructor.addStatic({maybeCreate:function(panel,anchorMark,keyArgs){return panel.valuesVisible&&panel.valuesMask?new pvc.visual.ValueLabel(panel,anchorMark,keyArgs):null;},isNeeded:function(panel){return panel.valuesVisible&&panel.valuesMask;}}).add({_addInteractive:function(keyArgs){keyArgs=def.setDefaults(keyArgs,'showsInteraction',true,'noSelect',true,'noTooltip',true,'noClick',true,'noDoubleClick',true,'noHover',true);this.base(keyArgs);},defaultText:function(){return this.scene.format(this.panel.valuesMask);},normalText:function(text){return this.trimText(text);},interactiveText:function(text){return this.showsActivity()&&this.scene.isActive?text:this.trimText(text);},trimText:function(text){return text;},textColor:function(){return this.color('text');},backgroundColor:function(type){var state=this.state;if(!state){return this.calcBackgroundColor(type);}
var cache=def.lazy(state,'bgColorCache');var color=def.getOwn(cache,type);if(!color){color=cache[type]=this.calcBackgroundColor(type);}
return color;},calcBackgroundColor:def.fun.constant(pv.Color.names.white),optimizeLegibilityColor:function(color,type){if(this.panel.valuesOptimizeLegibility){var bgColor=this.backgroundColor();return bgColor.isDark()?color.complementary().alpha(0.9):color;}
return color;},normalColor:function(color,type){return this.optimizeLegibilityColor(color,type);},interactiveColor:function(color,type){if(!this.mayShowActive()&&this.mayShowNotAmongSelected()){return this.dimColor(color,type);}
return this.optimizeLegibilityColor(color,type);}});def.type('pvc.visual.Dot',pvc.visual.Sign).init(function(panel,parentMark,keyArgs){var pvMark=parentMark.add(pv.Dot);var protoMark=def.get(keyArgs,'proto');if(protoMark){pvMark.extend(protoMark);}
keyArgs=def.setDefaults(keyArgs,'freeColor',false);this.base(panel,pvMark,keyArgs);if(!def.get(keyArgs,'freePosition',false)){var a_left=panel.isOrientationVertical()?'left':'bottom';var a_bottom=panel.anchorOrtho(a_left);this._lockDynamic(a_left,'x')._lockDynamic(a_bottom,'y');}
this._bindProperty('shape','shape')._bindProperty('shapeRadius','radius')._bindProperty('shapeSize','size');this.optional('strokeDasharray',undefined).optional('lineWidth',1.5);}).prototype.property('size').property('shape').constructor.add({y:def.fun.constant(0),x:def.fun.constant(0),radius:function(){this.state.radius=this.delegateExtension();},baseSize:function(){var radius=this.state.radius;return radius!=null?def.sqr(radius):this.base();},defaultSize:function(){return 12;},interactiveSize:function(size){return this.mayShowActive(true)?(Math.max(size,5)*2.5):size;},interactiveColor:function(color,type){if(this.mayShowActive(true)){if(type==='stroke'){return color.brighter(1);}}else if(this.mayShowNotAmongSelected()){if(this.mayShowActive()){return color.alpha(0.8);}
switch(type){case'fill':return this.dimColor(color,type);case'stroke':return color.alpha(0.45);}}
return this.base(color,type);}});def.type('pvc.visual.DotSizeColor',pvc.visual.Dot).init(function(panel,parentMark,keyArgs){this.base(panel,parentMark,keyArgs);var isV1Compat=this.compatVersion()<=1;this._bindProperty('lineWidth','strokeWidth').intercept('visible',function(){if(!this.canShow()){return false;}
var visible=this.delegateExtension();if(visible==null){visible=isV1Compat||this.defaultVisible();}
return visible;});this._initColor();this._initSize();if(this.isSizeBound){var sizeAxis=panel.axes.size;if(sizeAxis.scaleUsesAbs()){this.isSizeAbs=true;var baseSceneDefColor=this._sceneDefColor;this._sceneDefColor=function(scene,type){return type==='stroke'&&scene.vars.size.value<0?pv.Color.names.black:baseSceneDefColor.call(this,scene,type);};this.pvMark.lineCap('round').strokeDasharray(function(scene){return scene.vars.size.value<0?'dash':null;});}}}).prototype.property('strokeWidth').constructor.add({isColorBound:false,isColorDiscrete:false,isSizeBound:false,isSizeAbs:false,canShow:function(){return!this.scene.isIntermediate;},defaultVisible:function(){var scene=this.scene;return!scene.isNull&&((!this.isSizeBound&&!this.isColorBound)||(this.isSizeBound&&scene.vars.size.value!=null)||(this.isColorBound&&(this.isColorDiscrete||scene.vars.color.value!=null)));},_initColor:function(){var colorConstant;var sceneColorScale;var panel=this.panel;var colorRole=panel.visualRoles.color;if(colorRole){this.isColorDiscrete=colorRole.isDiscrete();var colorAxis=panel.axes.color;if(colorRole.isBound()){this.isColorBound=true;sceneColorScale=colorAxis.sceneScale({sceneVarName:'color'});}else if(colorAxis){colorConstant=colorAxis.option('Unbound');}}
if(!sceneColorScale){sceneColorScale=def.fun.constant(colorConstant||pvc.defaultColor);}
this._sceneDefColor=sceneColorScale;},_initSize:function(){var panel=this.panel;var plot=panel.plot;var shape=plot.option('Shape');var nullSizeShape=plot.option('NullShape');var sizeRole=panel.visualRoles.size;var sceneSizeScale,sceneShapeScale;if(sizeRole){var sizeAxis=panel.axes.size;var sizeScale=sizeAxis&&sizeAxis.scale;var isSizeBound=!!sizeScale&&sizeRole.isBound();if(isSizeBound){this.isSizeBound=true;var missingSize=sizeScale.min+(sizeScale.max-sizeScale.min)*0.05;this.nullSizeShapeHasStrokeOnly=(nullSizeShape==='cross');sceneShapeScale=function(scene){return scene.vars.size.value!=null?shape:nullSizeShape;};sceneSizeScale=function(scene){var sizeValue=scene.vars.size.value;return sizeValue!=null?sizeScale(sizeValue):nullSizeShape?missingSize:0;};}}
if(!sceneSizeScale){sceneShapeScale=def.fun.constant(shape);sceneSizeScale=function(scene){return this.base(scene);};}
this._sceneDefSize=sceneSizeScale;this._sceneDefShape=sceneShapeScale;},defaultColor:function(type){return this._sceneDefColor(this.scene,type);},normalColor:function(color,type){return type==='stroke'?color.darker():this.base(color,type);},interactiveColor:function(color,type){var scene=this.scene;if(this.mayShowActive(true)){switch(type){case'fill':return this.isSizeBound?color.alpha(0.75):color;case'stroke':return color.darker();}}else if(this.showsSelection()){var isSelected=scene.isSelected();var notAmongSelected=!isSelected&&scene.anySelected();if(notAmongSelected){if(this.mayShowActive()){return color.alpha(0.8);}
switch(type){case'fill':return this.dimColor(color,type);case'stroke':return color.alpha(0.45);}}
if(isSelected&&pvc_colorIsGray(color)){if(type==='stroke'){color=color.darker(3);}
return color.darker(2);}}
if(type==='stroke'){return color.darker();}
return color;},defaultSize:function(){return this._sceneDefSize(this.scene);},defaultShape:function(){return this._sceneDefShape(this.scene);},interactiveSize:function(size){if(!this.mayShowActive(true)){return size;}
var radius=Math.sqrt(size);var radiusInc=Math.max(1,Math.min(1.1*radius,2));return def.sqr(radius+radiusInc);},defaultStrokeWidth:function(){return(this.nullSizeShapeHasStrokeOnly&&this.scene.vars.size.value==null)?1.8:1;},interactiveStrokeWidth:function(width){return this.mayShowActive(true)?(2*width):this.mayShowSelected()?(1.5*width):width;}});def.type('pvc.visual.Line',pvc.visual.Sign).init(function(panel,protoMark,keyArgs){var pvMark=protoMark.add(pv.Line);this.base(panel,pvMark,keyArgs);this.lock('segmented','smart').lock('antialias',true);if(!def.get(keyArgs,'freePosition',false)){var basePosProp=panel.isOrientationVertical()?"left":"bottom",orthoPosProp=panel.anchorOrtho(basePosProp);this._lockDynamic(orthoPosProp,'y')._lockDynamic(basePosProp,'x');}
this._bindProperty('strokeStyle','strokeColor','color')._bindProperty('lineWidth','strokeWidth');}).prototype.property('strokeWidth').constructor.add({_addInteractive:function(keyArgs){keyArgs=def.setDefaults(keyArgs,'noTooltip',true);this.base(keyArgs);},y:def.fun.constant(0),x:def.fun.constant(0),defaultStrokeWidth:def.fun.constant(1.5),interactiveStrokeWidth:function(strokeWidth){return this.mayShowActive()?Math.max(1,strokeWidth)*2.5:strokeWidth;},interactiveColor:function(color,type){if(this.mayShowNotAmongSelected()){return this.mayShowActive()?pv.Color.names.darkgray.darker().darker():this.dimColor(color,type);}
return this.base(color,type);}});def.type('pvc.visual.Area',pvc.visual.Sign).init(function(panel,protoMark,keyArgs){var pvMark=protoMark.add(pv.Area);if(!keyArgs){keyArgs={};}
keyArgs.freeColor=true;this.base(panel,pvMark,keyArgs);var antialias=def.get(keyArgs,'antialias',true);this.lock('segmented','smart').lock('antialias',antialias);if(!def.get(keyArgs,'freePosition',false)){var basePosProp=panel.isOrientationVertical()?"left":"bottom",orthoPosProp=panel.anchorOrtho(basePosProp),orthoLenProp=panel.anchorOrthoLength(orthoPosProp);this._lockDynamic(basePosProp,'x')._lockDynamic(orthoPosProp,'y')._lockDynamic(orthoLenProp,'dy');}
this._bindProperty('fillStyle','fillColor','color');this.lock('strokeStyle',null).lock('lineWidth',0);}).add({_addInteractive:function(keyArgs){keyArgs=def.setDefaults(keyArgs,'noTooltip',true);this.base(keyArgs);},y:def.fun.constant(0),x:def.fun.constant(0),dy:def.fun.constant(0),interactiveColor:function(color,type){if(type==='fill'&&this.mayShowNotAmongSelected()){return this.dimColor(color,type);}
return this.base(color,type);}});def.type('pvc.visual.Bar',pvc.visual.Sign).init(function(panel,protoMark,keyArgs){var pvMark=protoMark.add(pv.Bar);keyArgs=def.setDefaults(keyArgs,'freeColor',false);this.base(panel,pvMark,keyArgs);this.normalStroke=def.get(keyArgs,'normalStroke',false);this._bindProperty('lineWidth','strokeWidth');}).prototype.property('strokeWidth').constructor.add({normalColor:function(color,type){if(type==='stroke'&&!this.normalStroke){return null;}
return color;},interactiveColor:function(color,type){var scene=this.scene;if(type==='stroke'){if(this.mayShowActive(true)){return color.brighter(1.3).alpha(0.7);}
if(!this.normalStroke){return null;}
if(this.mayShowNotAmongSelected()){if(this.mayShowActive()){return pv.Color.names.darkgray.darker().darker();}
return this.dimColor(color,type);}
if(this.mayShowActive()){return color.brighter(1).alpha(0.7);}}else if(type==='fill'){if(this.mayShowActive(true)){return color.brighter(0.2).alpha(0.8);}
if(this.mayShowNotAmongSelected()){if(this.mayShowActive()){return pv.Color.names.darkgray.darker(2).alpha(0.8);}
return this.dimColor(color,type);}
if(this.mayShowActive()){return color.brighter(0.2).alpha(0.8);}}
return this.base(color,type);},defaultStrokeWidth:function(){return 0.5;},interactiveStrokeWidth:function(strokeWidth){if(this.mayShowActive(true)){return Math.max(1,strokeWidth)*1.3;}
return strokeWidth;}});pv.PieSlice=function(){pv.Wedge.call(this);};pv.PieSlice.prototype=pv.extend(pv.Wedge).property('offsetRadius');pv.PieSlice.prototype.midAngle=function(){var instance=this.instance();return instance.startAngle+(instance.angle/2);};pv.PieSlice.prototype.defaults=new pv.PieSlice().extend(pv.Wedge.prototype.defaults).offsetRadius(0);def.type('pvc.visual.PieSlice',pvc.visual.Sign).init(function(panel,protoMark,keyArgs){var pvMark=protoMark.add(pv.PieSlice);keyArgs=def.setDefaults(keyArgs,'freeColor',false);this.base(panel,pvMark,keyArgs);this._activeOffsetRadius=def.get(keyArgs,'activeOffsetRadius',0);this._maxOffsetRadius=def.get(keyArgs,'maxOffsetRadius',0);this._resolvePctRadius=def.get(keyArgs,'resolvePctRadius');this._center=def.get(keyArgs,'center');this.optional('lineWidth',0.6)._bindProperty('angle','angle')._bindProperty('offsetRadius','offsetRadius')._lockDynamic('bottom','y')._lockDynamic('left','x').lock('top',null).lock('right',null);}).prototype.property('offsetRadius').constructor.add({angle:def.fun.constant(0),x:function(){return this._center.x+this._offsetSlice('cos');},y:function(){return this._center.y-this._offsetSlice('sin');},_offsetSlice:function(fun){var offset=this.pvMark.offsetRadius()||0;if(offset){offset*=Math[fun](this.pvMark.midAngle());}
return offset;},defaultColor:function(type){return type==='stroke'?null:this.base(type);},interactiveColor:function(color,type){if(this.mayShowActive(true)){switch(type){case'fill':return color.brighter(0.2).alpha(0.8);case'stroke':return color.brighter(1.3).alpha(0.7);}}else if(this.mayShowNotAmongSelected()){if(type==='fill'){return this.dimColor(color,type);}}
return this.base(color,type);},offsetRadius:function(){var offsetRadius=this.base();return Math.min(Math.max(0,offsetRadius),this._maxOffsetRadius);},baseOffsetRadius:function(){var offsetRadius=this.base()||0;return this._resolvePctRadius(pvc_PercentValue.parse(offsetRadius));},interactiveOffsetRadius:function(offsetRadius){return offsetRadius+
(this.mayShowActive(true)?this._activeOffsetRadius:0);}});def.type('pvc.visual.Rule',pvc.visual.Sign).init(function(panel,parentMark,keyArgs){var pvMark=parentMark.add(pv.Rule);var protoMark=def.get(keyArgs,'proto');if(protoMark){pvMark.extend(protoMark);}
this.base(panel,pvMark,keyArgs);if(!def.get(keyArgs,'freeStyle')){this._bindProperty('strokeStyle','strokeColor','color')._bindProperty('lineWidth','strokeWidth');}}).prototype.property('strokeWidth').constructor.add({_addInteractive:function(keyArgs){var t=true;keyArgs=def.setDefaults(keyArgs,'noHover',t,'noSelect',t,'noTooltip',t,'noClick',t,'noDoubleClick',t,'showsInteraction',false);this.base(keyArgs);},defaultStrokeWidth:function(){return 1;},interactiveStrokeWidth:function(strokeWidth){if(this.mayShowActive(true)){return Math.max(1,strokeWidth)*2.2;}
return strokeWidth;},interactiveColor:function(color,type){var scene=this.scene;if(scene.datum&&!this.mayShowActive(true)&&this.mayShowNotAmongSelected()){return this.dimColor(color,type);}
return this.base(color,type);}});def.type('pvc.visual.OptionsBase').init(function(chart,type,index,keyArgs){this.chart=chart;this.type=type;this.index=index==null?0:index;this.name=def.get(keyArgs,'name');this.id=this._buildId();this.optionId=this._buildOptionId();var rs=this._resolvers=[];this._registerResolversFull(rs,keyArgs);this.option=pvc.options(this._getOptionsDefinition(),this);}).add({_buildId:function(){return pvc.buildIndexedId(this.type,this.index);},_buildOptionId:function(){return this.id;},_getOptionsDefinition:def.method({isAbstract:true}),_chartOption:function(name){return this.chart.options[name];},_registerResolversFull:function(rs,keyArgs){var fixed=def.get(keyArgs,'fixed');if(fixed){this._fixed=fixed;rs.push(pvc.options.specify(function(optionInfo){return fixed[optionInfo.name];}));}
this._registerResolversNormal(rs,keyArgs);var defaults=def.get(keyArgs,'defaults');if(defaults){this._defaults=defaults;}
rs.push(this._resolveDefault);},_registerResolversNormal:function(rs,keyArgs){if(this.chart.compatVersion()<=1){rs.push(this._resolveByV1OnlyLogic);}
if(this.name){rs.push(pvc.options.specify(function(optionInfo){return this._chartOption(this.name+def.firstUpperCase(optionInfo.name));}));}
rs.push(this._resolveByOptionId);if(def.get(keyArgs,'byNaked',!this.index)){rs.push(this._resolveByNaked);}},_resolveFull:function(optionInfo){var rs=this._resolvers;for(var i=0,L=rs.length;i<L;i++){if(rs[i].call(this,optionInfo)){return true;}}
return false;},_resolveFixed:pvc.options.specify(function(optionInfo){if(this._fixed){return this._fixed[optionInfo.name];}}),_resolveByV1OnlyLogic:function(optionInfo){var data=optionInfo.data;var resolverV1;if(data&&(resolverV1=data.resolveV1)){return resolverV1.call(this,optionInfo);}},_resolveByName:pvc.options.specify(function(optionInfo){if(this.name){return this._chartOption(this.name+def.firstUpperCase(optionInfo.name));}}),_resolveByOptionId:pvc.options.specify(function(optionInfo){return this._chartOption(this.optionId+def.firstUpperCase(optionInfo.name));}),_resolveByNaked:pvc.options.specify(function(optionInfo){if(!this.index){return this._chartOption(def.firstLowerCase(optionInfo.name));}}),_resolveDefault:function(optionInfo){var data=optionInfo.data;var resolverDefault;if(data&&(resolverDefault=data.resolveDefault)){if(resolverDefault.call(this,optionInfo)){return true;}}
if(this._defaults){var value=this._defaults[optionInfo.name];if(value!==undefined){optionInfo.defaultValue(value);return true;}}},_specifyChartOption:function(optionInfo,asName){var value=this._chartOption(asName);if(value!=null){optionInfo.specify(value);return true;}}});var pvc_Axis=def.type('pvc.visual.Axis',pvc.visual.OptionsBase).init(function(chart,type,index,keyArgs){this.base(chart,type,index,keyArgs);chart._addAxis(this);}).add({isVisible:true,scaleTreatsNullAs:function(){return'null';},scaleNullRangeValue:function(){return null;},scaleUsesAbs:function(){return false;},bind:function(dataCells){var me=this;dataCells||def.fail.argumentRequired('dataCells');!me.dataCells||def.fail.operationInvalid('Axis is already bound.');me.dataCells=def.array.to(dataCells);me.dataCell=me.dataCells[0];me.role=me.dataCell&&me.dataCell.role;me.scaleType=axis_groupingScaleType(me.role.grouping);me._checkRoleCompatibility();return this;},isDiscrete:function(){return this.role&&this.role.isDiscrete();},isBound:function(){return!!this.role;},setScale:function(scale,noWrap){this.role||def.fail.operationInvalid('Axis is unbound.');this.scale=scale?(noWrap?scale:this._wrapScale(scale)):null;return this;},_wrapScale:function(scale){scale.type=this.scaleType;var by;if(scale.type!=='discrete'){var useAbs=this.scaleUsesAbs();var nullAs=this.scaleTreatsNullAs();if(nullAs&&nullAs!=='null'){var nullIsMin=nullAs==='min';if(useAbs){by=function(v){return scale(v==null?(nullIsMin?scale.domain()[0]:0):(v<0?-v:v));};}else{by=function(v){return scale(v==null?(nullIsMin?scale.domain()[0]:0):v);};}}else{var nullRangeValue=this.scaleNullRangeValue();if(useAbs){by=function(v){return v==null?nullRangeValue:scale(v<0?-v:v);};}else{by=function(v){return v==null?nullRangeValue:scale(v);};}}}else{by=function(v){return scale(v==null?'':v);};}
return def.copy(by,scale);},sceneScale:function(keyArgs){var varName=def.get(keyArgs,'sceneVarName')||this.role.name,grouping=this.role.grouping;if(grouping.isSingleDimension&&grouping.firstDimensionValueType()===Number){var scale=this.scale,nullToZero=def.get(keyArgs,'nullToZero',true);var by=function(scene){var value=scene.vars[varName].value;if(value==null){if(!nullToZero){return value;}
value=0;}
return scale(value);};def.copy(by,scale);return by;}
return this.scale.by1(function(scene){return scene.vars[varName].value;});},_checkRoleCompatibility:function(){var L=this.dataCells.length;if(L>1){var grouping=this.role.grouping;var i;if(this.scaleType==='discrete'){for(i=1;i<L;i++){if(grouping.id!==this.dataCells[i].role.grouping.id){throw def.error.operationInvalid("Discrete roles on the same axis must have equal groupings.");}}}else{if(!grouping.firstDimensionType().isComparable){throw def.error.operationInvalid("Continuous roles on the same axis must have 'comparable' groupings.");}
for(i=1;i<L;i++){if(this.scaleType!==axis_groupingScaleType(this.dataCells[i].role.grouping)){throw def.error.operationInvalid("Continuous roles on the same axis must have scales of the same type.");}}}}},_getOptionsDefinition:function(){return axis_optionsDef;}});function axis_groupingScaleType(grouping){return grouping.isDiscrete()?'discrete':(grouping.firstDimensionValueType()===Date?'timeSeries':'numeric');}
var axis_optionsDef={};var pvc_CartesianAxis=def.type('pvc.visual.CartesianAxis',pvc_Axis).init(function(chart,type,index,keyArgs){var options=chart.options;this.orientation=pvc_CartesianAxis.getOrientation(type,options.orientation);this.orientedId=pvc_CartesianAxis.getOrientedId(this.orientation,index);if(chart._allowV1SecondAxis&&index===1){this.v1SecondOrientedId='second'+this.orientation.toUpperCase();}
this.base(chart,type,index,keyArgs);var extensions=this.extensionPrefixes=[this.id+'Axis',this.orientedId+'Axis'];if(this.v1SecondOrientedId){extensions.push(this.v1SecondOrientedId+'Axis');}
this._extPrefAxisPosition=extensions.length;extensions.push('axis');}).add({bind:function(dataCells){this.base(dataCells);this._syncExtensionPrefixes();return this;},_syncExtensionPrefixes:function(){var extensions=this.extensionPrefixes;extensions.length=this._extPrefAxisPosition;var st=this.scaleType;if(st){extensions.push(st+'Axis');if(st!=='discrete'){extensions.push('continuousAxis');}}
extensions.push('axis');},setScale:function(scale){var oldScale=this.scale;this.base(scale);if(oldScale){delete this.domain;delete this.ticks;delete this._roundingPaddings;}
if(scale){if(!scale.isNull&&this.scaleType!=='discrete'){this.domain=scale.domain();this.domain.minLocked=!!scale.minLocked;this.domain.maxLocked=!!scale.maxLocked;if(this.scaleType==='numeric'){var roundMode=this.option('DomainRoundMode');if(roundMode==='nice'){scale.nice();}
var tickFormatter=this.option('TickFormatter');if(tickFormatter){scale.tickFormatter(tickFormatter);}}}}
return this;},setTicks:function(ticks){var scale=this.scale;(scale&&!scale.isNull)||def.fail.operationInvalid("Scale must be set and non-null.");this.ticks=ticks;if(scale.type==='numeric'&&this.option('DomainRoundMode')==='tick'){delete this._roundingPaddings;var tickCount=ticks&&ticks.length;if(tickCount){this.scale.domain(ticks[0],ticks[tickCount-1]);}else{this.scale.domain(this.domain[0],this.domain[1]);}}},setScaleRange:function(size){var scale=this.scale;scale.min=0;scale.max=size;scale.size=size;if(scale.type==='discrete'){if(scale.domain().length>0){var bandRatio=this.chart.options.panelSizeRatio||0.8;scale.splitBandedCenter(scale.min,scale.max,bandRatio);}}else{scale.range(scale.min,scale.max);}
return scale;},getScaleRoundingPaddings:function(){var roundingPaddings=this._roundingPaddings;if(!roundingPaddings){roundingPaddings={begin:0,end:0,beginLocked:false,endLocked:false};var scale=this.scale;if(scale&&!scale.isNull&&scale.type!=='discrete'){var originalDomain=this.domain;roundingPaddings.beginLocked=originalDomain.minLocked;roundingPaddings.endLocked=originalDomain.maxLocked;if(scale.type==='numeric'&&this.option('DomainRoundMode')!=='none'){var currDomain=scale.domain();var origDomain=this.domain||def.assert("Original domain must be set");var currLength=currDomain[1]-currDomain[0];if(currLength){var diff=origDomain[0]-currDomain[0];if(diff>0){roundingPaddings.begin=diff/currLength;}
diff=currDomain[1]-origDomain[1];if(diff>0){roundingPaddings.end=diff/currLength;}}}}
this._roundingPaddings=roundingPaddings;}
return roundingPaddings;},calcContinuousTicks:function(desiredTickCount){if(desiredTickCount==null){desiredTickCount=this.option('DesiredTickCount');}
return this.scale.ticks(desiredTickCount,{roundInside:this.option('DomainRoundMode')!=='tick',numberExponentMin:this.option('TickExponentMin'),numberExponentMax:this.option('TickExponentMax')});},_getOptionsDefinition:function(){return cartAxis_optionsDef;},_buildOptionId:function(){return this.id+"Axis";},_registerResolversNormal:function(rs,keyArgs){if(this.chart.compatVersion()<=1){rs.push(this._resolveByV1OnlyLogic);}
rs.push(this._resolveByOptionId,this._resolveByOrientedId);if(this.index===1){rs.push(this._resolveByV1OptionId);}
rs.push(this._resolveByScaleType,this._resolveByCommonId);},_resolveByOrientedId:pvc.options.specify(function(optionInfo){return this._chartOption(this.orientedId+"Axis"+optionInfo.name);}),_resolveByV1OptionId:pvc.options.specify(function(optionInfo){return this._chartOption('secondAxis'+optionInfo.name);}),_resolveByScaleType:pvc.options.specify(function(optionInfo){var st=this.scaleType;if(st){var name=optionInfo.name;var value=this._chartOption(st+'Axis'+name);if(value===undefined&&st!=='discrete'){value=this._chartOption('continuousAxis'+name);}
return value;}}),_resolveByCommonId:pvc.options.specify(function(optionInfo){return this._chartOption('axis'+optionInfo.name);})});pvc_CartesianAxis.getOrientation=function(type,chartOrientation){return((type==='base')===(chartOrientation==='vertical'))?'x':'y';};pvc_CartesianAxis.getOrientedId=function(orientation,index){if(index===0){return orientation;}
return orientation+(index+1);};var cartAxis_fixedMinMaxSpec={resolve:'_resolveFull',data:{resolveV1:function(optionInfo){if(!this.index&&this.type==='ortho'){this._specifyChartOption(optionInfo,this.id+optionInfo.name);}
return true;}},cast:pvc.castNumber};function pvc_castDomainScope(scope,axis){return pvc.parseDomainScope(scope,axis.orientation);}
function pvc_castAxisPosition(side){if(side){if(def.hasOwn(pvc_Sides.namesSet,side)){var mapAlign=pvc.BasePanel[this.orientation==='y'?'horizontalAlign':'verticalAlign2'];return mapAlign[side];}
if(pvc.debug>=2){pvc.log(def.format("Invalid axis position value '{0}'.",[side]));}}
return this.orientation==='x'?'bottom':'left';}
var cartAxis_normalV1Data={resolveV1:function(optionInfo){if(!this.index){if(this._resolveByOrientedId(optionInfo)){return true;}}else if(this._resolveByV1OptionId(optionInfo)){return true;}
this._resolveDefault(optionInfo);return true;}};var defaultPosition=pvc.options.defaultValue(function(optionInfo){if(!this.typeIndex){return this.orientation==='x'?'bottom':'left';}
var firstAxis=this.chart.axesByType[this.type].first;var position=firstAxis.option('Position');return pvc.BasePanel.oppositeAnchor[position];});function cartAxis_castSize(value){var position=this.option('Position');return pvc_Size.toOrtho(value,position);}
function cartAxis_castTitleSize(value){var position=this.option('Position');return pvc_Size.to(value,{singleProp:pvc.BasePanel.orthogonalLength[position]});}
var cartAxis_optionsDef=def.create(axis_optionsDef,{Visible:{resolve:'_resolveFull',data:{resolveV1:function(optionInfo){if(this.index<=1){var v1OptionId=this.index===0?def.firstUpperCase(this.orientation):'Second';this._specifyChartOption(optionInfo,'show'+v1OptionId+'Scale');}
return true;}},cast:Boolean,value:true},Composite:{resolve:function(optionInfo){if(this.index>0){optionInfo.specify(false);return true;}
return this._resolveFull(optionInfo);},data:{resolveV1:function(optionInfo){this._specifyChartOption(optionInfo,'useCompositeAxis');return true;}},cast:Boolean,value:false},Size:{resolve:'_resolveFull',data:cartAxis_normalV1Data,cast:cartAxis_castSize},SizeMax:{resolve:'_resolveFull',cast:cartAxis_castSize},Position:{resolve:'_resolveFull',data:{resolveV1:cartAxis_normalV1Data.resolveV1,resolveDefault:defaultPosition},cast:pvc_castAxisPosition},FixedMin:cartAxis_fixedMinMaxSpec,FixedMax:cartAxis_fixedMinMaxSpec,OriginIsZero:{resolve:'_resolveFull',data:{resolveV1:function(optionInfo){switch(this.index){case 0:this._specifyChartOption(optionInfo,'originIsZero');break;case 1:if(this.chart._allowV1SecondAxis){this._specifyChartOption(optionInfo,'secondAxisOriginIsZero');}
break;}
return true;}},cast:Boolean,value:true},DomainScope:{resolve:'_resolveFull',cast:pvc_castDomainScope,value:'global'},Offset:{resolve:'_resolveFull',data:{resolveV1:function(optionInfo){switch(this.index){case 0:this._specifyChartOption(optionInfo,'axisOffset');break;case 1:if(this.chart._allowV1SecondAxis){this._specifyChartOption(optionInfo,'secondAxisOffset');break;}
break;}
return true;}},cast:pvc.castNumber},LabelSpacingMin:{resolve:'_resolveFull',cast:pvc.castNumber},OverlappedLabelsMode:{resolve:'_resolveFull',cast:pvc.parseOverlappedLabelsMode,value:'rotatethenhide'},Grid:{resolve:'_resolveFull',data:{resolveV1:function(optionInfo){if(!this.index){this._specifyChartOption(optionInfo,this.orientation+'AxisFullGrid');}
return true;}},cast:Boolean,value:false},GridCrossesMargin:{resolve:'_resolveFull',cast:Boolean,value:true},EndLine:{resolve:'_resolveFull',cast:Boolean},ZeroLine:{resolve:'_resolveFull',cast:Boolean,value:true},RuleCrossesMargin:{resolve:'_resolveFull',cast:Boolean,value:true},Ticks:{resolve:'_resolveFull',cast:Boolean},DesiredTickCount:{resolve:'_resolveFull',data:{resolveV1:cartAxis_normalV1Data.resolveV1,resolveDefault:function(optionInfo){if(this.chart.compatVersion()<=1){optionInfo.defaultValue(5);return true;}}},cast:pvc.castNumber},MinorTicks:{resolve:'_resolveFull',data:cartAxis_normalV1Data,cast:Boolean,value:true},TickFormatter:{resolve:'_resolveFull',cast:def.fun.as},DomainRoundMode:{resolve:'_resolveFull',data:{resolveV1:cartAxis_normalV1Data.resolveV1,resolveDefault:function(optionInfo){if(this.chart.compatVersion()<=1){optionInfo.defaultValue('none');return true;}}},cast:pvc.parseDomainRoundingMode,value:'tick'},TickExponentMin:{resolve:'_resolveFull',cast:pvc.castNumber},TickExponentMax:{resolve:'_resolveFull',cast:pvc.castNumber},Title:{resolve:'_resolveFull',cast:String},TitleSize:{resolve:'_resolveFull',cast:cartAxis_castTitleSize},TitleSizeMax:{resolve:'_resolveFull',cast:cartAxis_castTitleSize},TitleFont:{resolve:'_resolveFull',cast:String},TitleMargins:{resolve:'_resolveFull',cast:pvc_Sides.as},TitlePaddings:{resolve:'_resolveFull',cast:pvc_Sides.as},TitleAlign:{resolve:'_resolveFull',cast:function castAlign(align){var position=this.option('Position');return pvc.parseAlign(position,align);}},Font:{resolve:'_resolveFull',cast:String},ClickAction:{resolve:'_resolveFull',data:cartAxis_normalV1Data},DoubleClickAction:{resolve:'_resolveFull',data:cartAxis_normalV1Data},TooltipEnabled:{resolve:'_resolveFull',cast:Boolean,value:true},TooltipFormat:{resolve:'_resolveFull',cast:def.fun.as,value:null},TooltipAutoContent:{resolve:'_resolveFull',cast:pvc.parseTooltipAutoContent,value:'value'}});def.type('pvc.visual.CartesianAxisRootScene',pvc.visual.Scene);def.type('pvc.visual.CartesianAxisTickScene',pvc.visual.Scene).init(function(parent,keyArgs){this.base(parent,keyArgs);this.vars.tick=new pvc_ValueLabelVar(def.get(keyArgs,'tick'),def.get(keyArgs,'tickLabel'),def.get(keyArgs,'tickRaw'));if(def.get(keyArgs,'isHidden')){this.isHidden=true;}}).add({isHidden:false});def.type('pvc.visual.CartesianFocusWindow',pvc.visual.OptionsBase).init(function(chart){this.base(chart,'focusWindow',0,{byNaked:false});var baseAxis=chart.axes.base;this.base=new pvc.visual.CartesianFocusWindowAxis(this,baseAxis);}).add({_getOptionsDefinition:function(){return focusWindow_optionsDef;},_exportData:function(){return{base:def.copyProps(this.base,pvc.visual.CartesianFocusWindow.props)};},_importData:function(data){var baseData=data.base;this.base.option.specify({Begin:baseData.begin,End:baseData.end,Length:baseData.length});},_initFromOptions:function(){this.base._initFromOptions();},_onAxisChanged:function(axis){var changed=this.option('Changed');if(changed){changed.call(this.chart.basePanel.context());}}});var focusWindow_optionsDef=def.create(axis_optionsDef,{Changed:{resolve:'_resolveFull',cast:def.fun.as}});def.type('pvc.visual.CartesianFocusWindowAxis',pvc.visual.OptionsBase).init(function(fw,axis){this.window=fw;this.axis=axis;this.isDiscrete=axis.isDiscrete();this.base(axis.chart,'focusWindow'+def.firstUpperCase(axis.type),0,{byNaked:false});}).addStatic({props:['begin','end','length']}).add({_getOptionsDefinition:function(){return focusWindowAxis_optionsDef;},_initFromOptions:function(){var o=this.option;this.set({begin:o('Begin'),end:o('End'),length:o('Length')});},set:function(keyArgs){var me=this;var render=def.get(keyArgs,'render');var select=def.get(keyArgs,'select',true);var b,e,l;keyArgs=me._readArgs(keyArgs);if(!keyArgs){if(this.begin!=null&&this.end!=null&&this.length!=null){return;}}else{b=keyArgs.begin;e=keyArgs.end;l=keyArgs.length;}
var axis=me.axis;var scale=axis.scale;var isDiscrete=me.isDiscrete;var contCast=!isDiscrete?axis.role.firstDimensionType().cast:null;var domain=scale.domain();var a,L;if(isDiscrete){L=domain.length;var ib,ie,ia;if(b!=null){var nb=+b;if(!isNaN(nb)){if(nb===Infinity){ib=L-1;b=domain[ib];}else if(nb===-Infinity){ib=0;b=domain[ib];}}
if(ib==null){ib=domain.indexOf(''+b);if(ib<0){ib=0;b=domain[ib];}}}
if(e!=null){var ne=+e;if(!isNaN(ne)){if(ne===Infinity){ie=L-1;e=domain[ie];}else if(ne===-Infinity){ie=0;e=domain[ie];}}
if(ie==null){ie=domain.indexOf(''+e);if(ie<0){ie=L-1;e=domain[ie];}}}
if(l!=null){l=+l;if(isNaN(l)){l=null;}else if(l<0&&(b!=null||e!=null)){a=b;ia=ib;b=e,ib=ie,e=a,ie=ia;l=-l;}}
if(b!=null){if(e!=null){if(ib>ie){a=b;ia=ib;b=e,ib=ie,e=a,ie=ia;}
l=ie-ib+1;}else{if(l==null){l=L-ib;}
ie=ib+l-1;if(ie>L-1){ie=L-1;l=ie-ib+1;}
e=domain[ie];}}else{if(e!=null){if(l==null){l=ie;}
ib=ie-l+1;if(ib<0){ib=0;l=ie-ib+1;}
b=domain[ib];}else{if(l==null){l=Math.max(~~(L/3),1);}
if(l>L){l=L;ib=0;ie=L-1;}else{ia=~~(L/2);ib=ia-~~(l/2);ie=ib+l-1;}
b=domain[ib];e=domain[ie];}}}else{if(l!=null){l=+l;if(isNaN(l)){l=null;}else if(l<0&&(b!=null||e!=null)){a=b;b=e,e=a;l=-l;}}
var min=domain[0];var max=domain[1];L=max-min;if(b!=null){if(b<min){b=min;}
if(b>max){b=max;}}
if(e!=null){if(e<min){e=min;}
if(e>max){e=max;}}
if(b!=null){if(e!=null){if(b>e){a=b;b=e,e=a;}
l=e-b;}else{if(l==null){l=max-b;}
e=b+l;if(e>max){e=max;l=e-b;}}}else{if(e!=null){if(l==null){l=e-min;}
b=e-l;if(b<min){b=min;l=e-b;}}else{if(l==null){l=Math.max(~~(L/3),1);}
if(l>L){l=L;b=min;e=max;}else{a=~~(L/2);b=a-~~(l/2);e=(+b)+(+l);}}}
b=contCast(b);e=contCast(e);l=contCast(l);var constraint=me.option('Constraint');if(constraint){var oper2={type:'new',target:'begin',value:b,length:l,length0:l,min:min,max:max,minView:min,maxView:max};constraint(oper2);b=contCast(oper2.value);l=contCast(oper2.length);e=contCast((+b)+(+l));}}
me._set(b,e,l,select,render);},_updatePosition:function(pbeg,pend,select,render){var me=this;var axis=me.axis;var scale=axis.scale;var b,e,l;if(me.isDiscrete){var ib=scale.invertIndex(pbeg);var ie=scale.invertIndex(pend)-1;var domain=scale.domain();b=domain[ib];e=domain[ie];l=ie-ib+1;}else{b=scale.invert(pbeg);e=scale.invert(pend);l=e-b;}
this._set(b,e,l,select,render);},_constraintPosition:function(oper){var me=this;var axis=me.axis;var scale=axis.scale;var constraint;if(me.isDiscrete){var index=Math.floor(scale.invertIndex(oper.point,true));if(index>=0){var r=scale.range();var L=scale.domain().length;var S=(r.max-r.min)/L;if(index>=L&&(oper.type==='new'||oper.type==='resize-begin')){index=L-1;}
oper.point=index*S;}}else if((constraint=me.option('Constraint'))){var contCast=axis.role.firstDimensionType().cast;var v=contCast(scale.invert(oper.point));var sign=oper.target==='begin'?1:-1;var pother=oper.point+sign*oper.length;var vother=contCast(scale.invert(pother));var vlength=contCast(sign*(vother-v));var vlength0,pother0,vother0;if(oper.length===oper.length0){vlength0=vlength;}else{pother0=oper.point+sign*oper.length0;vother0=contCast(scale.invert(pother0));vlength0=sign*(vother0-v);}
var vmin=contCast(scale.invert(oper.min));var vmax=contCast(scale.invert(oper.max));var oper2={type:oper.type,target:oper.target,value:v,length:vlength,length0:vlength0,min:vmin,max:vmax,minView:contCast(scale.invert(oper.minView)),maxView:contCast(scale.invert(oper.maxView))};constraint(oper2);if(+oper2.value!==+v){v=oper2.value;oper.point=scale(v);}
var vlength2=oper2.length;if(+vlength2!==+vlength){if(+vlength2===+vlength0){oper.length=oper.length0;}else{var vother2=(+v)+sign*(+vlength2);var pother2=scale(vother2);oper.length=pother2-sign*oper.point;}}
if(+oper2.min!==+vmin){oper.min=scale(oper2.min);}
if(+oper2.max!==+vmax){oper.max=scale(oper2.max);}}},_compare:function(a,b){return this.isDiscrete?((''+a)===(''+b)):((+a)===(+b));},_set:function(b,e,l,select,render){var me=this;var changed=false;if(!me._compare(b,me.begin)){me.begin=b;changed=true;}
if(!me._compare(e,me.end)){me.end=e;changed=true;}
if(!me._compare(l,me.length)){me.length=l;changed=true;}
if(changed){me.window._onAxisChanged(this);}
if(select){me._updateSelection({render:render});}
return changed;},_readArgs:function(keyArgs){if(keyArgs){var out={};var any=0;var read=function(p){var v=keyArgs[p];if(v!=null){any=true;}else{v=this[p];}
out[p]=v;};pvc.visual.CartesianFocusWindowAxis.props.forEach(read,this);if(any){return out;}}},_updateSelection:function(keyArgs){var me=this;var selectDatums;var axis=me.axis;var isDiscrete=axis.isDiscrete();var chart=axis.chart;var dataCell=axis.dataCell;var role=dataCell.role;var partData=chart.partData(dataCell.dataPartValue,{visible:true});var domainData;if(isDiscrete){domainData=role.flatten(partData);var dataBegin=domainData._childrenByKey[me.begin];var dataEnd=domainData._childrenByKey[me.end];if(dataBegin&&dataEnd){var indexBegin=dataBegin.childIndex();var indexEnd=dataEnd.childIndex();selectDatums=def.range(indexBegin,indexEnd-indexBegin+1).select(function(index){return domainData._children[index];}).selectMany(function(data){return data._datums;}).distinct(function(datum){return datum.key;});}}else{domainData=partData;var dimName=role.firstDimensionName();selectDatums=def.query(partData._datums).where(function(datum){var v=datum.atoms[dimName].value;return v!=null&&v>=me.begin&&v<=me.end;});}
if(selectDatums){chart.data.replaceSelected(selectDatums);chart.root.updateSelections(keyArgs);}}});var focusWindowAxis_optionsDef=def.create(axis_optionsDef,{Resizable:{resolve:'_resolveFull',cast:Boolean,value:true},Movable:{resolve:'_resolveFull',cast:Boolean,value:true},Begin:{resolve:'_resolveFull'},End:{resolve:'_resolveFull'},Length:{resolve:'_resolveFull'},Constraint:{resolve:'_resolveFull',cast:def.fun.as}});def.type('pvc.visual.ColorAxis',pvc_Axis).add({scaleNullRangeValue:function(){return this.option('Missing')||null;},scaleUsesAbs:function(){return this.option('UseAbs');},bind:function(dataCells){this.base(dataCells);this._plotList=def.query(dataCells).select(function(dataCell){return dataCell.plot;}).distinct(function(plot){return plot&&plot.id;}).array();return this;},_wrapScale:function(scale){var applyTransf;if(this.scaleType==='discrete'){applyTransf=this.option.isSpecified('Transform')||(!this.option.isSpecified('Colors')&&!this.option.isSpecified('Map'));}else{applyTransf=true;}
if(applyTransf){var colorTransf=this.option('Transform');if(colorTransf){scale=scale.transform(colorTransf);}}
return this.base(scale);},scheme:function(){return def.lazy(this,'_scheme',this._createScheme,this);},_createColorMapFilter:function(colorMap){var fixedColors=def.uniqueIndex(colorMap,function(c){return c.key;});return{domain:function(k){return!def.hasOwn(colorMap,k);},color:function(c){return!def.hasOwn(fixedColors,c.key);}};},_createScheme:function(){var me=this;var baseScheme=me.option('Colors');if(me.scaleType!=='discrete'){return function(){var scale=baseScheme.apply(null,arguments);return me._wrapScale(scale);};}
var colorMap=me.option('Map');if(!colorMap){return function(){var scale=baseScheme.apply(null,arguments);return me._wrapScale(scale);};}
var filter=this._createColorMapFilter(colorMap);return function(d){var scale;if(!(d instanceof Array)){d=def.array.copy(arguments);}
d=d.filter(filter.domain);var baseScale=baseScheme(d);var r=baseScale.range().filter(filter.color);baseScale.range(r);scale=function(k){var c=def.getOwn(colorMap,k);return c||baseScale(k);};def.copy(scale,baseScale);var dx,rx;scale.domain=function(){if(arguments.length){throw def.operationInvalid("The scale cannot be modified.");}
if(!dx){dx=def.array.append(def.ownKeys(colorMap),d);}
return dx;};scale.range=function(){if(arguments.length){throw def.operationInvalid("The scale cannot be modified.");}
if(!rx){rx=def.array.append(def.own(colorMap),d);}
return rx;};return me._wrapScale(scale);};},sceneScale:function(keyArgs){var varName=def.get(keyArgs,'sceneVarName')||this.role.name;var fillColorScaleByColKey=this.scalesByCateg;if(fillColorScaleByColKey){var colorMissing=this.option('Missing');return function(scene){var colorValue=scene.vars[varName].value;if(colorValue==null){return colorMissing;}
var catAbsKey=scene.group.parent.absKey;return fillColorScaleByColKey[catAbsKey](colorValue);};}
return this.scale.by1(function(scene){return scene&&scene.vars[varName].value;});},_buildOptionId:function(){return this.id+"Axis";},_getOptionsDefinition:function(){return colorAxis_optionsDef;},_resolveByNaked:pvc.options.specify(function(optionInfo){if(!this.index){return this._chartOption(this.id+def.firstUpperCase(optionInfo.name));}}),_specifyV1ChartOption:function(optionInfo,asName){if(!this.index&&this.chart.compatVersion()<=1&&this._specifyChartOption(optionInfo,asName)){return true;}}});function colorAxis_castColorMap(colorMap){var resultMap;if(colorMap){var any;def.eachOwn(colorMap,function(v,k){any=true;colorMap[k]=pv.color(v);});if(any){resultMap=colorMap;}}
return resultMap;}
var colorAxis_legendDataSpec={resolveDefault:function(optionInfo){if(!this.index&&this._specifyChartOption(optionInfo,def.firstLowerCase(optionInfo.name))){return true;}}};var colorAxis_defContColors;function colorAxis_getDefaultColors(){var colors;var scaleType=this.scaleType;if(!scaleType){colors=pvc.createColorScheme();}else if(scaleType==='discrete'){if(this.index===0){colors=pvc.createColorScheme();}else{var me=this;colors=function(){return me.chart._getRoleColorScale(me.role.name);};}}else{if(!colorAxis_defContColors){colorAxis_defContColors=['red','yellow','green'].map(pv.color);}
colors=colorAxis_defContColors.slice();}
return colors;}
var colorAxis_optionsDef=def.create(axis_optionsDef,{Colors:{resolve:'_resolveFull',getDefault:colorAxis_getDefaultColors,data:{resolveV1:function(optionInfo){if(this.scaleType==='discrete'){if(this.index===0){this._specifyChartOption(optionInfo,'colors');}else if(this.index===1&&this.chart._allowV1SecondAxis){this._specifyChartOption(optionInfo,'secondAxisColor');}}else{this._specifyChartOption(optionInfo,'colorRange');}
return true;},resolveDefault:function(optionInfo){if(this.index===0){this._specifyChartOption(optionInfo,'colors');}}},cast:pvc.colorScheme},Map:{resolve:'_resolveFull',cast:colorAxis_castColorMap},Transform:{resolve:'_resolveFull',data:{resolveDefault:function(optionInfo){var plotList=this._plotList;if(plotList.length<=2){var onlyTrendAndPlot2=def.query(plotList).all(function(plot){var name=plot.name;return(name==='plot2'||name==='trend');});if(onlyTrendAndPlot2){optionInfo.defaultValue(pvc.brighterColorTransform);return true;}}}},cast:def.fun.to},NormByCategory:{resolve:function(optionInfo){if(!this.chart._allowColorPerCategory){optionInfo.specify(false);return true;}
return this._resolveFull(optionInfo);},data:{resolveV1:function(optionInfo){this._specifyV1ChartOption(optionInfo,'normPerBaseCategory');return true;}},cast:Boolean,value:false},ScaleType:{resolve:'_resolveFull',data:{resolveV1:function(optionInfo){this._specifyV1ChartOption(optionInfo,'scalingType');return true;}},cast:pvc.parseContinuousColorScaleType,value:'linear'},UseAbs:{resolve:'_resolveFull',cast:Boolean,value:false},Domain:{resolve:'_resolveFull',data:{resolveV1:function(optionInfo){this._specifyV1ChartOption(optionInfo,'colorRangeInterval');return true;}},cast:def.array.to},Min:{resolve:'_resolveFull',data:{resolveV1:function(optionInfo){this._specifyV1ChartOption(optionInfo,'minColor');return true;}},cast:pv.color},Max:{resolve:'_resolveFull',data:{resolveV1:function(optionInfo){this._specifyV1ChartOption(optionInfo,'maxColor');return true;}},cast:pv.color},Missing:{resolve:'_resolveFull',data:{resolveV1:function(optionInfo){this._specifyV1ChartOption(optionInfo,'nullColor');return true;}},cast:pv.color,value:pv.color('lightgray')},Unbound:{resolve:'_resolveFull',getDefault:function(optionInfo){var scheme=this.option('Colors');return scheme().range()[0]||pvc.defaultColor;},cast:pv.color},LegendVisible:{resolve:'_resolveFull',data:colorAxis_legendDataSpec,cast:Boolean,value:true},LegendClickMode:{resolve:'_resolveFull',data:colorAxis_legendDataSpec,cast:pvc.parseLegendClickMode,value:'togglevisible'},LegendDrawLine:{resolve:'_resolveFull',data:colorAxis_legendDataSpec,cast:Boolean,value:false},LegendDrawMarker:{resolve:'_resolveFull',data:colorAxis_legendDataSpec,cast:Boolean,value:true},LegendShape:{resolve:'_resolveFull',data:colorAxis_legendDataSpec,cast:pvc.parseShape}});def.type('pvc.visual.SizeAxis',pvc_Axis).init(function(chart,type,index,keyArgs){keyArgs=def.set(keyArgs,'byNaked',false);this.base(chart,type,index,keyArgs);}).add({_buildOptionId:function(){return this.id+"Axis";},scaleTreatsNullAs:function(){return'min';},scaleUsesAbs:function(){return this.option('UseAbs');},setScaleRange:function(range){var scale=this.scale;scale.min=range.min;scale.max=range.max;scale.size=range.max-range.min;scale.range(scale.min,scale.max);if(pvc.debug>=4){pvc.log("Scale: "+pvc.stringify(def.copyOwn(scale)));}
return this;},_getOptionsDefinition:function(){return sizeAxis_optionsDef;}});var sizeAxis_optionsDef=def.create(axis_optionsDef,{OriginIsZero:{resolve:'_resolveFull',cast:Boolean,value:false},FixedMin:{resolve:'_resolveFull',cast:pvc.castNumber},FixedMax:{resolve:'_resolveFull',cast:pvc.castNumber},UseAbs:{resolve:'_resolveFull',cast:Boolean,value:false}});def.type('pvc.visual.Legend',pvc.visual.OptionsBase).init(function(chart,type,index,keyArgs){keyArgs=def.set(keyArgs,'byNaked',false);this.base(chart,type,index,keyArgs);}).add({_getOptionsDefinition:function(){return legend_optionsDef;}});function legend_castSize(size){if(!def.object.is(size)){var position=this.option('Position');size=new pvc_Size().setSize(size,{singleProp:pvc.BasePanel.orthogonalLength[position]});}
return size;}
function legend_castAlign(align){var position=this.option('Position');return pvc.parseAlign(position,align);}
var legend_optionsDef={Position:{resolve:'_resolveFull',cast:pvc.parsePosition,value:'bottom'},Size:{resolve:'_resolveFull',cast:legend_castSize},SizeMax:{resolve:'_resolveFull',cast:legend_castSize},Align:{resolve:'_resolveFull',data:{resolveDefault:function(optionInfo){var position=this.option('Position');var align;if(position!=='top'&&position!=='bottom'){align='top';}else if(this.chart.compatVersion()<=1){align='left';}
optionInfo.defaultValue(align);return true;}},cast:legend_castAlign},Margins:{resolve:'_resolveFull',data:{resolveDefault:function(optionInfo){if(this.chart.compatVersion()>1){var position=this.option('Position');var margins=def.set({},pvc.BasePanel.oppositeAnchor[position],5);optionInfo.defaultValue(margins);}
return true;}},cast:pvc_Sides.as},Paddings:{resolve:'_resolveFull',cast:pvc_Sides.as,value:5},Font:{resolve:'_resolveFull',cast:String,value:'10px sans-serif'}};def.type('pvc.visual.legend.BulletRootScene',pvc.visual.Scene).init(function(parent,keyArgs){this.base(parent,keyArgs);var markerDiam=def.get(keyArgs,'markerSize',15);var itemPadding=new pvc_Sides(def.get(keyArgs,'itemPadding',5)).resolve(markerDiam,markerDiam);def.set(this.vars,'horizontal',def.get(keyArgs,'horizontal',false),'font',def.get(keyArgs,'font'),'markerSize',markerDiam,'textMargin',def.get(keyArgs,'textMargin',6),'itemPadding',itemPadding);}).add({layout:function(layoutInfo){var clientSize=layoutInfo.clientSize;if(!(clientSize.width>0&&clientSize.height>0)){return new pvc_Size(0,0);}
var desiredClientSize=layoutInfo.desiredClientSize;var markerDiam=this.vars.markerSize;var textLeft=markerDiam+this.vars.textMargin;var itemPadding=this.vars.itemPadding;var a_width=this.vars.horizontal?'width':'height';var a_height=pvc.BasePanel.oppositeLength[a_width];var maxRowWidth=desiredClientSize[a_width];if(!maxRowWidth||maxRowWidth<0){maxRowWidth=clientSize[a_width];}
var row;var rows=[];var contentSize={width:0,height:0};this.childNodes.forEach(function(groupScene){groupScene.childNodes.forEach(layoutItem,this);},this);if(!row){return new pvc_Size(0,0);}
commitRow(true);def.set(this.vars,'rows',rows,'rowCount',row,'size',contentSize);var isV1Compat=this.compatVersion()<=1;var w=isV1Compat?maxRowWidth:contentSize.width;var h=desiredClientSize[a_height];if(!h||h<0){h=contentSize.height;}
return def.set({},a_width,Math.min(w,clientSize[a_width]),a_height,Math.min(h,clientSize[a_height]));function layoutItem(itemScene){var textSize=itemScene.labelTextSize();var hidden=!textSize||!textSize.width||!textSize.height;itemScene.isHidden=hidden;if(hidden){return;}
var widthMargin=0;var itemClientSize={width:textLeft+textSize.width+widthMargin,height:Math.max(textSize.height,markerDiam)};var isFirstInRow;if(!row){row=new pvc.visual.legend.BulletItemSceneRow(0);isFirstInRow=true;}else{isFirstInRow=!row.items.length;}
var newRowWidth=row.size.width+itemClientSize[a_width];if(!isFirstInRow){newRowWidth+=itemPadding[a_width];}
if(!isFirstInRow&&(newRowWidth>maxRowWidth)){commitRow(false);newRowWidth=itemClientSize[a_width];}
var rowSize=row.size;rowSize.width=newRowWidth;rowSize.height=Math.max(rowSize.height,itemClientSize[a_height]);var rowItemIndex=row.items.length;row.items.push(itemScene);def.set(itemScene.vars,'row',row,'rowIndex',rowItemIndex,'clientSize',itemClientSize);}
function commitRow(isLast){var rowSize=row.size;contentSize.height+=rowSize.height;if(rows.length){contentSize.height+=itemPadding[a_height];}
contentSize.width=Math.max(contentSize.width,rowSize.width);rows.push(row);if(!isLast){row=new pvc.visual.legend.BulletItemSceneRow(rows.length);}}},defaultGroupSceneType:function(){var GroupType=this._bulletGroupType;if(!GroupType){GroupType=def.type(pvc.visual.legend.BulletGroupScene);this._bulletGroupType=GroupType;}
return GroupType;},createGroup:function(keyArgs){var GroupType=this.defaultGroupSceneType();return new GroupType(this,keyArgs);}});def.type('pvc.visual.legend.BulletItemSceneRow').init(function(index){this.index=index;this.items=[];this.size={width:0,height:0};});def.type('pvc.visual.legend.BulletGroupScene',pvc.visual.Scene).init(function(rootScene,keyArgs){this.base(rootScene,keyArgs);this.extensionPrefix=def.get(keyArgs,'extensionPrefix')||'';this._renderer=def.get(keyArgs,'renderer');this.colorAxis=def.get(keyArgs,'colorAxis');this.clickMode=def.get(keyArgs,'clickMode');if(!this.clickMode&&this.colorAxis){this.clickMode=this.colorAxis.option('LegendClickMode');}}).add({hasRenderer:function(){return!!this._renderer;},renderer:function(renderer){if(renderer!=null){this._renderer=renderer;}else{renderer=this._renderer;if(!renderer){var keyArgs;var colorAxis=this.colorAxis;if(colorAxis){keyArgs={drawRule:colorAxis.option('LegendDrawLine'),drawMarker:colorAxis.option('LegendDrawMarker'),markerShape:colorAxis.option('LegendShape')};}
renderer=new pvc.visual.legend.BulletItemDefaultRenderer(keyArgs);this._renderer=renderer;}}
return renderer;},itemSceneType:function(){var ItemType=this._itemSceneType;if(!ItemType){ItemType=def.type(pvc.visual.legend.BulletItemScene);var clickMode=this.clickMode;switch(clickMode){case'toggleselected':ItemType.add(pvc.visual.legend.BulletItemSceneSelection);break;case'togglevisible':ItemType.add(pvc.visual.legend.BulletItemSceneVisibility);break;}
var legendPanel=this.panel();legendPanel._extendSceneType('item',ItemType,['isOn','executable','execute','value']);var itemSceneExtIds=pvc.makeExtensionAbsId(pvc.makeExtensionAbsId("ItemScene",[this.extensionPrefix,'$']),legendPanel._getExtensionPrefix());var impl=legendPanel.chart._getExtension(itemSceneExtIds,'value');if(impl!==undefined){ItemType.prototype.variable('value',impl);}
this._itemSceneType=ItemType;}
return ItemType;},createItem:function(keyArgs){var ItemType=this.itemSceneType();return new ItemType(this,keyArgs);}});def.type('pvc.visual.legend.BulletItemScene',pvc.visual.Scene).init(function(bulletGroup,keyArgs){this.base.apply(this,arguments);if(!this.executable()){var I=pvc.visual.Interactive;this._ibits=I.Interactive|I.ShowsInteraction|I.Hoverable|I.SelectableAny;}}).add({isOn:def.fun.constant(true),executable:def.fun.constant(false),execute:def.fun.constant(),labelTextSize:function(){return pv.Text.measure(this.value().label,this.vars.font);},_valueEval:function(){var valueVar=this._valueEvalCore();if(!(valueVar instanceof pvc_ValueLabelVar)){valueVar=new pvc_ValueLabelVar(valueVar,valueVar);}
return valueVar;},_valueEvalCore:function(){var value,rawValue,label;var source=this.group||this.datum;if(source){value=source.value;rawValue=source.rawValue;label=source.ensureLabel()+this._getTrendLineSuffix(source);}
return new pvc_ValueLabelVar(value||null,label||"",rawValue);},_getTrendLineSuffix:function(source){var dataPartDim=this.chart()._getDataPartDimName();if(dataPartDim){var dataPartAtom=source.atoms[dataPartDim];if(isNaN(+dataPartAtom.value)){return" ("+dataPartAtom.label+")";}}
return"";}}).prototype.variable('value');def.type('pvc.visual.legend.BulletItemSceneSelection').add({isOn:function(){var source=(this.group||this.datum);return!source.owner.selectedCount()||this.isSelected();},executable:function(){return this.chart().selectableByClick();},execute:function(){var datums=this.datums().array();if(datums.length){var chart=this.chart();chart._updatingSelections(function(){datums=chart._onUserSelection(datums);if(datums){var on=def.query(datums).any(function(datum){return datum.isSelected;});pvc.data.Data.setSelected(datums,!on);}});}}});def.type('pvc.visual.legend.BulletItemSceneVisibility').add({isOn:function(){return this.datums().any(function(datum){return!datum.isNull&&datum.isVisible;});},executable:def.fun.constant(true),execute:function(){if(pvc.data.Data.toggleVisible(this.datums())){this.chart().render(true,true,false);}}});def.type('pvc.visual.legend.BulletItemRenderer');def.type('pvc.visual.legend.BulletItemDefaultRenderer',pvc.visual.legend.BulletItemRenderer).init(function(keyArgs){this.drawRule=def.get(keyArgs,'drawRule',false);if(this.drawRule){this.rulePvProto=def.get(keyArgs,'rulePvProto');}
this.drawMarker=!this.drawRule||def.get(keyArgs,'drawMarker',true);if(this.drawMarker){this.markerShape=def.get(keyArgs,'markerShape','square');this.markerPvProto=def.get(keyArgs,'markerPvProto');}}).add({drawRule:false,drawMarker:true,markerShape:null,rulePvProto:null,markerPvProto:null,create:function(legendPanel,pvBulletPanel,extensionPrefix,wrapper){var renderInfo={};var drawRule=this.drawRule;var sceneColorProp=function(scene){return scene.color;};if(drawRule){var rulePvBaseProto=new pv_Mark().left(0).top(function(){return this.parent.height()/2;}).width(function(){return this.parent.width();}).lineWidth(1,pvc.extensionTag).strokeStyle(sceneColorProp,pvc.extensionTag);var rp=this.rulePvProto;if(rp){rulePvBaseProto=rp.extend(rulePvBaseProto);}
renderInfo.pvRule=new pvc.visual.Rule(legendPanel,pvBulletPanel,{proto:rulePvBaseProto,noSelect:false,noHover:false,activeSeriesAware:false,extensionId:extensionPrefix+"Rule",showsInteraction:true,wrapper:wrapper}).pvMark;}
if(this.drawMarker){var markerPvBaseProto=new pv_Mark().left(function(){return this.parent.width()/2;}).top(function(){return this.parent.height()/2;}).shapeSize(function(){return this.parent.width();},pvc.extensionTag).lineWidth(2,pvc.extensionTag).fillStyle(sceneColorProp,pvc.extensionTag).strokeStyle(sceneColorProp,pvc.extensionTag).shape(this.markerShape,pvc.extensionTag).angle(drawRule?0:Math.PI/2,pvc.extensionTag).antialias(function(){var cos=Math.abs(Math.cos(this.angle()));if(cos!==0&&cos!==1){switch(this.shape()){case'square':case'bar':return false;}}
return true;},pvc.extensionTag);var mp=this.markerPvProto;if(mp){markerPvBaseProto=mp.extend(markerPvBaseProto);}
renderInfo.pvDot=new pvc.visual.Dot(legendPanel,pvBulletPanel,{proto:markerPvBaseProto,freePosition:true,activeSeriesAware:false,noTooltip:true,noClick:true,extensionId:extensionPrefix+"Dot",wrapper:wrapper}).pvMark;}
return renderInfo;}});def.type('pvc.visual.DataCell').init(function(plot,axisType,axisIndex,roleName,dataPartValue){this.plot=plot;this.axisType=axisType;this.axisIndex=axisIndex;this.role=plot.chart.visualRoles[roleName];this.dataPartValue=dataPartValue;}).add({isBound:function(){return this.role&&this.role.isBound();},domainData:function(){return def.lazy(this,'_domainData',this._resolveDomainData,this);},domainItemDatas:function(){var domainData=this.domainData();return def.query((domainData||undefined)&&domainData.children());},domainItemDataValue:function(itemData){return def.nullyTo(itemData.value,'');},domainItemValues:function(){return this.domainItemDatas().select(this.domainItemDataValue,this).distinct();},_resolveDomainData:function(){var role=this.role;if(role&&role.isBound()){var partData=this.plot.chart.partData(this.dataPartValue);if(partData){return role.flatten(partData);}}
return null;}});def.type('pvc.visual.Plot',pvc.visual.OptionsBase).init(function(chart,keyArgs){var typePlots=def.getPath(chart,['plotsByType',this.type]);var index=typePlots?typePlots.length:0;var globalIndex=chart.plotList.length;keyArgs=def.set(keyArgs,'byNaked',!globalIndex);this.base(chart,this.type,index,keyArgs);chart._addPlot(this);var prefixes=this.extensionPrefixes=[this.id];if(!this.globalIndex){prefixes.push('');}
if(this.name){prefixes.push(this.name);}}).add({_getOptionsDefinition:function(){return pvc.visual.Plot.optionsDef;},_resolveByNaked:pvc.options.specify(function(optionInfo){if(!this.globalIndex){return this._chartOption(def.firstLowerCase(optionInfo.name));}}),collectDataCells:function(dataCells){var dataCell=this._getColorDataCell();if(dataCell){dataCells.push(dataCell);}},_getColorDataCell:function(){var colorRoleName=this.option('ColorRole');if(colorRoleName){return new pvc.visual.DataCell(this,'color',this.option('ColorAxis')-1,colorRoleName,this.option('DataPart'));}}});pvc.visual.Plot.optionsDef={Orientation:{resolve:function(optionInfo){optionInfo.specify(this._chartOption('orientation')||'vertical');return true;},cast:String},ValuesVisible:{resolve:'_resolveFull',data:{resolveV1:function(optionInfo){if(this.globalIndex===0){var show=this._chartOption('showValues');if(show!==undefined){optionInfo.specify(show);}else{show=this.type!=='point';optionInfo.defaultValue(show);}
return true;}}},cast:Boolean,value:false},ValuesAnchor:{resolve:'_resolveFull',cast:pvc.parseAnchor},ValuesFont:{resolve:'_resolveFull',cast:String,value:'10px sans-serif'},ValuesMask:{resolve:'_resolveFull',cast:String,value:"{value}"},ValuesOptimizeLegibility:{resolve:'_resolveFull',cast:Boolean,value:false},DataPart:{resolve:'_resolveFixed',cast:String,value:'0'},ColorRole:{resolve:'_resolveFixed',cast:String,value:'color'},ColorAxis:{resolve:pvc.options.resolvers([function(optionInfo){if(this.globalIndex===0){optionInfo.specify(1);return true;}},'_resolveFull']),cast:function(value){value=pvc.castNumber(value);if(value!=null){value=def.between(value,1,10);}else{value=1;}
return value;},value:1}};def.type('pvc.visual.CartesianPlot',pvc.visual.Plot).add({_getOptionsDefinition:function(){return pvc.visual.CartesianPlot.optionsDef;}});function pvc_castTrend(trend){if(this.name==='trend'){return null;}
var type=this.option('TrendType');if(!type&&trend){type=trend.type;}
if(!type||type==='none'){return null;}
if(!trend){trend={};}else{trend=Object.create(trend);}
trend.type=type;var label=this.option('TrendLabel');if(label!==undefined){trend.label=label;}
return trend;}
pvc.visual.CartesianPlot.optionsDef=def.create(pvc.visual.Plot.optionsDef,{BaseAxis:{value:1},BaseRole:{resolve:'_resolveFixed',cast:String},OrthoAxis:{resolve:function(optionInfo){if(this.globalIndex===0){optionInfo.specify(1);return true;}
return this._resolveFull(optionInfo);},data:{resolveV1:function(optionInfo){if(this.name==='plot2'&&this.chart._allowV1SecondAxis&&this._chartOption('secondAxisIndependentScale')){optionInfo.specify(2);}
return true;}},cast:function(value){value=pvc.castNumber(value);if(value!=null){value=def.between(value,1,10);}else{value=1;}
return value;},value:1},OrthoRole:{resolve:pvc.options.resolvers(['_resolveFixed','_resolveDefault'])},Trend:{resolve:'_resolveFull',data:{resolveDefault:function(optionInfo){var type=this.option('TrendType');if(type){optionInfo.defaultValue({type:type});return true;}}},cast:pvc_castTrend},TrendType:{resolve:'_resolveFull',cast:pvc.parseTrendType},TrendLabel:{resolve:'_resolveFull',cast:String},NullInterpolationMode:{resolve:'_resolveFull',cast:pvc.parseNullInterpolationMode,value:'none'}});def.type('pvc.visual.CategoricalPlot',pvc.visual.CartesianPlot).add({_getOptionsDefinition:function(){return pvc.visual.CategoricalPlot.optionsDef;}});pvc.visual.CategoricalPlot.optionsDef=def.create(pvc.visual.CartesianPlot.optionsDef,{Stacked:{resolve:'_resolveFull',cast:Boolean,value:false},BaseRole:{value:'category'},OrthoRole:{value:'value'}});def.type('pvc.visual.BarPlotAbstract',pvc.visual.CategoricalPlot).add({_getOptionsDefinition:function(){return pvc.visual.BarPlotAbstract.optionsDef;}});pvc.visual.BarPlotAbstract.optionsDef=def.create(pvc.visual.CategoricalPlot.optionsDef,{BarSizeRatio:{resolve:'_resolveFull',cast:function(value){value=pvc.castNumber(value);if(value==null){value=1;}else if(value<0.05){value=0.05;}else if(value>1){value=1;}
return value;},value:0.9},BarSizeMax:{resolve:'_resolveFull',data:{resolveV1:function(optionInfo){this._specifyChartOption(optionInfo,'maxBarSize');return true;}},cast:function(value){value=pvc.castNumber(value);if(value==null){value=Infinity;}else if(value<1){value=1;}
return value;},value:2000},BarStackedMargin:{resolve:'_resolveFull',cast:function(value){value=pvc.castNumber(value);if(value!=null&&value<0){value=0;}
return value;},value:0},OverflowMarkersVisible:{resolve:'_resolveFull',cast:Boolean,value:true},ValuesAnchor:{value:'center'}});def.type('pvc.visual.BarPlot',pvc.visual.BarPlotAbstract).add({type:'bar'});def.type('pvc.visual.NormalizedBarPlot',pvc.visual.BarPlotAbstract).add({type:'bar',_getOptionsDefinition:function(){return pvc.visual.NormalizedBarPlot.optionsDef;}});pvc.visual.NormalizedBarPlot.optionsDef=def.create(pvc.visual.BarPlotAbstract.optionsDef,{Stacked:{resolve:null,value:true}});def.type('pvc.visual.WaterfallPlot',pvc.visual.BarPlotAbstract).add({type:'water',_getOptionsDefinition:function(){return pvc.visual.WaterfallPlot.optionsDef;}});pvc.visual.WaterfallPlot.optionsDef=def.create(pvc.visual.BarPlotAbstract.optionsDef,{Stacked:{resolve:null,value:true},TotalLineLabel:{resolve:'_resolveFull',cast:String,value:"Accumulated"},TotalValuesVisible:{resolve:'_resolveFull',data:{resolveDefault:function(optionInfo){optionInfo.defaultValue(this.option('ValuesVisible'));return true;}},cast:Boolean},Direction:{resolve:'_resolveFull',cast:pvc.parseWaterDirection,value:'down'},AreasVisible:{resolve:'_resolveFull',cast:Boolean,value:true},AllCategoryLabel:{resolve:'_resolveFull',cast:String,value:"All"}});def.type('pvc.visual.PointPlot',pvc.visual.CategoricalPlot).add({type:'point',_getOptionsDefinition:function(){return pvc.visual.PointPlot.optionsDef;}});function pvcPoint_buildVisibleOption(type,dv){return{resolveV1:function(optionInfo){if(this.globalIndex===0){if(!this._specifyChartOption(optionInfo,'show'+type)){optionInfo.defaultValue(dv);}
return true;}}};}
pvc.visual.PointPlot.optionsDef=def.create(pvc.visual.CategoricalPlot.optionsDef,{DotsVisible:{resolve:'_resolveFull',data:pvcPoint_buildVisibleOption('Dots',true),cast:Boolean,value:false},LinesVisible:{resolve:'_resolveFull',data:pvcPoint_buildVisibleOption('Lines',true),cast:Boolean,value:false},AreasVisible:{resolve:'_resolveFull',data:pvcPoint_buildVisibleOption('Areas',false),cast:Boolean,value:false},ValuesAnchor:{value:'right'}});def.type('pvc.visual.MetricXYPlot',pvc.visual.CartesianPlot).add({_getOptionsDefinition:function(){return pvc.visual.MetricXYPlot.optionsDef;}});pvc.visual.MetricXYPlot.optionsDef=def.create(pvc.visual.CartesianPlot.optionsDef,{BaseRole:{value:'x'},OrthoAxis:{resolve:null},OrthoRole:{value:'y'}});def.type('pvc.visual.MetricPointPlot',pvc.visual.MetricXYPlot).add({type:'scatter',_getOptionsDefinition:function(){return pvc.visual.MetricPointPlot.optionsDef;}});function pvcMetricPoint_buildVisibleOption(type){return{resolveV1:function(optionInfo){this._specifyChartOption(optionInfo,'show'+type);return true;}};}
pvc.visual.MetricPointPlot.optionsDef=def.create(pvc.visual.MetricXYPlot.optionsDef,{SizeRole:{resolve:'_resolveFixed',value:'size'},SizeAxis:{resolve:'_resolveFixed',value:1},Shape:{resolve:'_resolveFull',cast:pvc.parseShape,value:'circle'},NullShape:{resolve:'_resolveFull',cast:pvc.parseShape,value:'cross'},DotsVisible:{resolve:'_resolveFull',data:pvcMetricPoint_buildVisibleOption('Dots'),cast:Boolean,value:false},LinesVisible:{resolve:'_resolveFull',data:pvcMetricPoint_buildVisibleOption('Lines'),cast:Boolean,value:false},ValuesAnchor:{value:'right'},ValuesMask:{value:"{x},{y}"}});def.type('pvc.visual.PiePlot',pvc.visual.Plot).add({type:'pie',_getOptionsDefinition:function(){return pvc.visual.PiePlot.optionsDef;}});pvc.visual.PiePlot.optionsDef=def.create(pvc.visual.Plot.optionsDef,{ActiveSliceRadius:{resolve:'_resolveFull',cast:pvc_PercentValue.parse,value:new pvc_PercentValue(0.05)},ExplodedSliceRadius:{resolve:'_resolveFull',cast:pvc_PercentValue.parse,value:0},ExplodedSliceIndex:{resolve:'_resolveFull',cast:pvc.castNumber,value:null},ValuesAnchor:{cast:pvc.parseAnchorWedge,value:'outer'},ValuesVisible:{value:true},ValuesLabelStyle:{resolve:function(optionInfo){var isV1Compat=this.chart.compatVersion()<=1;if(isV1Compat){optionInfo.specify('inside');return true;}
return this._resolveFull(optionInfo);},cast:function(value){switch(value){case'inside':case'linked':return value;}
if(pvc.debug>=2){pvc.log("[Warning] Invalid 'ValuesLabelStyle' value: '"+value+"'.");}
return'linked';},value:'linked'},ValuesMask:{resolve:'_resolveFull',data:{resolveDefault:function(optionInfo){optionInfo.defaultValue(this.option('ValuesLabelStyle')==='linked'?"{value} ({value.percent})":"{value}");return true;}}},LinkInsetRadius:{resolve:'_resolveFull',cast:pvc_PercentValue.parse,value:new pvc_PercentValue(0.05)},LinkOutsetRadius:{resolve:'_resolveFull',cast:pvc_PercentValue.parse,value:new pvc_PercentValue(0.025)},LinkMargin:{resolve:'_resolveFull',cast:pvc_PercentValue.parse,value:new pvc_PercentValue(0.025)},LinkHandleWidth:{resolve:'_resolveFull',cast:pvc.castNumber,value:0.5},LinkLabelSize:{resolve:'_resolveFull',cast:pvc_PercentValue.parse,value:new pvc_PercentValue(0.15)},LinkLabelSpacingMin:{resolve:'_resolveFull',cast:pvc.castNumber,value:0.5}});def.type('pvc.visual.HeatGridPlot',pvc.visual.CategoricalPlot).add({type:'heatGrid',_getOptionsDefinition:function(){return pvc.visual.HeatGridPlot.optionsDef;}});pvc.visual.HeatGridPlot.optionsDef=def.create(pvc.visual.CategoricalPlot.optionsDef,{SizeRole:{value:'size'},SizeAxis:{value:1},UseShapes:{resolve:'_resolveFull',cast:Boolean,value:false},Shape:{resolve:'_resolveFull',cast:pvc.parseShape,value:'square'},NullShape:{resolve:'_resolveFull',cast:pvc.parseShape,value:'cross'},ValuesVisible:{getDefault:function(){return!this.option('UseShapes');},value:null},ValuesMask:{value:null},ValuesAnchor:{value:'center'},OrthoRole:{value:'series'},OrthoAxis:{resolve:null},NullInterpolationMode:{resolve:null,value:'none'},Stacked:{resolve:null,value:false}});def.type('pvc.visual.BoxPlot',pvc.visual.CategoricalPlot).add({type:'box',_getOptionsDefinition:function(){return pvc.visual.BoxPlot.optionsDef;}});pvc.visual.BoxPlot.optionsDef=def.create(pvc.visual.CategoricalPlot.optionsDef,{Stacked:{resolve:null,value:false},OrthoRole:{value:['median','lowerQuartil','upperQuartil','minimum','maximum']},BoxSizeRatio:{resolve:'_resolveFull',cast:function(value){value=pvc.castNumber(value);if(value==null){value=1;}else if(value<0.05){value=0.05;}else if(value>1){value=1;}
return value;},value:1/3},BoxSizeMax:{resolve:'_resolveFull',data:{resolveV1:function(optionInfo){this._specifyChartOption(optionInfo,'maxBoxSize');return true;}},cast:function(value){value=pvc.castNumber(value);if(value==null){value=Infinity;}else if(value<1){value=1;}
return value;},value:Infinity}});def.type('pvc.visual.BulletPlot',pvc.visual.Plot).add({type:'bullet',_getOptionsDefinition:function(){return pvc.visual.BulletPlot.optionsDef;}});pvc.visual.BulletPlot.optionsDef=def.create(pvc.visual.Plot.optionsDef,{ValuesVisible:{value:true},ColorRole:{value:null}});def.type('pvc.visual.TreemapColorDataCell',pvc.visual.DataCell).init(function(){this.base.apply(this,arguments);var g=this.role.grouping;this._valueProp=(!g||g.isSingleDimension)?'value':'absKey';}).add({domainItemDatas:function(){var domainData=this.domainData();var candidates=def.query((domainData||undefined)&&domainData.nodes());if(this.plot.option('ColorMode')==='byparent'){return candidates.where(function(itemData){return(!itemData.parent||itemData.value!=null)&&itemData.children().any(function(child){return child.value!=null&&child.children().prop('value').all(def.nully);});});}
return candidates.where(function(itemData){if(!itemData.childCount()){return!itemData.parent||itemData.value!=null;}
return itemData.value!=null&&!itemData.children().prop('value').any(def.notNully);});},domainItemDataValue:function(itemData){return def.nullyTo(itemData[this._valueProp],'');},_resolveDomainData:function(){var role=this.role;if(role&&role.isBound()){var partData=this.plot.chart.partData(this.dataPartValue);if(partData){return role.select(partData);}}
return null;}});def.type('pvc.visual.TreemapPlot',pvc.visual.Plot).add({type:'treemap',_getOptionsDefinition:function(){return pvc.visual.TreemapPlot.optionsDef;},collectDataCells:function(dataCells){this.base(dataCells);var sizeRoleName=this.option('SizeRole');if(sizeRoleName){dataCells.push(new pvc.visual.DataCell(this,'size',this.option('SizeAxis')-1,sizeRoleName,this.option('DataPart')));}},_getColorDataCell:function(){var colorRoleName=this.option('ColorRole');if(colorRoleName){return new pvc.visual.TreemapColorDataCell(this,'color',this.option('ColorAxis')-1,colorRoleName,this.option('DataPart'));}}});pvc.visual.TreemapPlot.optionsDef=def.create(pvc.visual.Plot.optionsDef,{SizeRole:{resolve:'_resolveFixed',value:'size'},SizeAxis:{resolve:'_resolveFixed',value:1},ValuesAnchor:{cast:pvc.parseAnchor,value:'center'},ValuesVisible:{value:true},ValuesMask:{resolve:'_resolveFull',value:"{category}"},ValuesOptimizeLegibility:{value:true},LayoutMode:{resolve:'_resolveFull',cast:pvc.parseTreemapLayoutMode,value:'squarify'},ColorMode:{resolve:'_resolveFull',cast:pvc.parseTreemapColorMode,value:'byparent'},RootCategoryLabel:{resolve:'_resolveFull',cast:String,value:"All"}});def.type('pvc.Abstract').init(function(){this._syncLog();}).add({invisibleLineWidth:0.001,defaultLineWidth:1.5,_logInstanceId:null,_syncLog:function(){if(pvc.debug&&typeof console!=="undefined"){var logId=this._getLogInstanceId();['log','info',['trace','debug'],'error','warn',['group','groupCollapsed'],'groupEnd'].forEach(function(ps){ps=ps instanceof Array?ps:[ps,ps];pvc_installLog(this,'_'+ps[0],ps[1],logId);},this);}},_getLogInstanceId:function(){return this._logInstanceId||(this._logInstanceId=this._processLogInstanceId(this._createLogInstanceId()));},_createLogInstanceId:function(){return''+this.constructor;},_processLogInstanceId:function(logInstanceId){var L=30;var s=logInstanceId.substr(0,L);if(s.length<L){s+=def.array.create(L-s.length,' ').join('');}
return"["+s+"]";}});def.scope(function(){var o=pvc.Abstract.prototype;var syncLogHook=function(){this._syncLog();};['log','info','trace','error','warn','group','groupEnd'].forEach(function(p){o['_'+p]=syncLogHook;});});def.type('pvc.BaseChart',pvc.Abstract).add(pvc.visual.Interactive).init(function(options){var originalOptions=options;var parent=this.parent=def.get(options,'parent')||null;if(parent){options||def.fail.argumentRequired('options');}else{options=def.mixin.copy({},this.defaults,options);}
this.options=options;if(parent){this.root=parent.root;this.smallColIndex=options.smallColIndex;this.smallRowIndex=options.smallRowIndex;}else{this.root=this;}
this.base();if(pvc.debug>=3){this._info("NEW CHART\n"+pvc.logSeparator.replace(/-/g,'=')+"\n  DebugLevel: "+pvc.debug);}
if(pvc.debug>=3&&!parent&&originalOptions){this._info("OPTIONS:\n",originalOptions);if(pvc.debug>=5){this._trace(pvc.stringify(options,{ownOnly:false,funs:true}));}}
if(parent){parent._addChild(this);}
this._constructData(options);this._constructVisualRoles(options);}).add({_disposed:false,_animatable:false,parent:null,children:null,root:null,isPreRendered:false,_createVersion:0,renderCallback:undefined,multiChartPageCount:null,multiChartPageIndex:null,left:0,top:0,width:null,height:null,margins:null,paddings:null,_allowV1SecondAxis:false,compatVersion:function(options){return(options||this.options).compatVersion;},_createLogInstanceId:function(){return""+
this.constructor+this._createLogChildSuffix();},_createLogChildSuffix:function(){return this.parent?(" ("+(this.smallRowIndex+1)+","+
(this.smallColIndex+1)+")"):"";},_addChild:function(childChart){(childChart.parent===this)||def.assert("Not a child of this chart.");this.children.push(childChart);},_preRender:function(keyArgs){this._preRenderPhase1(keyArgs);this._preRenderPhase2(keyArgs);},_preRenderPhase1:function(keyArgs){this._createVersion++;this.isPreRendered=false;if(pvc.debug>=3){this._log("Prerendering");}
this.children=[];if(!this.parent){pvc.removeTipsyLegends();}
this._processOptions();this._checkNoDataI();if(!this.parent&&!this.data){this._initVisualRoles();this._bindVisualRolesPreI();this._complexTypeProj=this._createComplexTypeProject();this._bindVisualRolesPreII();}
this._initData(keyArgs);this._checkNoDataII();var hasMultiRole=this.visualRoles.multiChart.isBound();this._initPlots(hasMultiRole);this._initAxes(hasMultiRole);this._bindAxes(hasMultiRole);if(this.parent||!hasMultiRole){this._interpolate(hasMultiRole);this._generateTrends(hasMultiRole);}
this._setAxesScales(hasMultiRole);},_preRenderPhase2:function(){var hasMultiRole=this.visualRoles.multiChart.isBound();this._initChartPanels(hasMultiRole);this.isPreRendered=true;},_setSmallLayout:function(keyArgs){if(keyArgs){var basePanel=this.basePanel;if(this._setProp('left',keyArgs)|this._setProp('top',keyArgs)){if(basePanel){def.set(basePanel.position,'left',this.left,'top',this.top);}}
if(this._setProp('width',keyArgs)|this._setProp('height',keyArgs)){if(basePanel){basePanel.size=new pvc_Size(this.width,this.height);}}
if(this._setProp('margins',keyArgs)&&basePanel){basePanel.margins=new pvc_Sides(this.margins);}
if(this._setProp('paddings',keyArgs)&&basePanel){basePanel.paddings=new pvc_Sides(this.paddings);}}},_setProp:function(p,keyArgs){var v=keyArgs[p];if(v!=null){this[p]=v;return true;}},_processOptions:function(){var options=this.options;if(!this.parent){this.width=options.width;this.height=options.height;this.margins=options.margins;this.paddings=options.paddings;}
if(this.compatVersion()<=1){options.plot2=this._allowV1SecondAxis&&!!options.secondAxis;}
this._processOptionsCore(options);this._processExtensionPoints();return options;},_processOptionsCore:function(options){if(!this.parent){var interactive=(pv.renderer()!=='batik');if(interactive){interactive=options.interactive;if(interactive==null){interactive=true;}}
var ibits;if(!interactive){ibits=0;}else{var I=pvc.visual.Interactive;ibits=I.Interactive|I.ShowsInteraction;if(this._processTooltipOptions(options)){ibits|=I.ShowsTooltip;}
if(options.animate&&$.support.svg){ibits|=I.Animatable;}
if(options.selectable){ibits|=I.Selectable;switch(pvc.parseSelectionMode(options.selectionMode)){case'rubberband':ibits|=(I.SelectableByRubberband|I.SelectableByClick);break;case'focuswindow':ibits|=I.SelectableByFocusWindow;break;}}
if(pvc.parseClearSelectionMode(options.clearSelectionMode)==='emptyspaceclick'){ibits|=I.Unselectable;}
if(options.hoverable){ibits|=I.Hoverable;}
if(options.clickable){ibits|=(I.Clickable|I.DoubleClickable);}}
this._ibits=ibits;}else{this._ibits=this.parent._ibits;this._tooltipOptions=this.parent._tooltipOptions;}},_tooltipDefaults:{gravity:'s',delayIn:200,delayOut:80,offset:2,opacity:0.9,html:true,fade:true,useCorners:false,arrowVisible:true,followMouse:false,format:undefined},_processTooltipOptions:function(options){var isV1Compat=this.compatVersion()<=1;var tipOptions=options.tooltip;var tipEnabled=options.tooltipEnabled;if(tipEnabled==null){if(tipOptions){tipEnabled=tipOptions.enabled;}
if(tipEnabled==null){if(isV1Compat){tipEnabled=options.showTooltips;}
if(tipEnabled==null){tipEnabled=true;}}}
if(tipEnabled){if(!tipOptions){tipOptions={};}
if(isV1Compat){this._importV1TooltipOptions(tipOptions,options);}
def.eachOwn(this._tooltipDefaults,function(dv,p){var value=options['tooltip'+def.firstUpperCase(p)];if(value!==undefined){tipOptions[p]=value;}else if(tipOptions[p]===undefined){tipOptions[p]=dv;}});}else{tipOptions={};}
this._tooltipOptions=tipOptions;return tipEnabled;},_importV1TooltipOptions:function(tipOptions,options){var v1TipOptions=options.tipsySettings;if(v1TipOptions){this.extend(v1TipOptions,'tooltip');for(var p in v1TipOptions){if(tipOptions[p]===undefined){tipOptions[p]=v1TipOptions[p];}}
if(tipOptions.html==null){tipOptions.html=false;}}},render:function(bypassAnimation,recreate,reloadData){var hasError;if(pvc.debug>1){pvc.group("CCC RENDER");}
this._suspendSelectionUpdate();try{this.useTextMeasureCache(function(){try{if(!this.isPreRendered||recreate){this._preRender({reloadData:reloadData});}else if(!this.parent&&this.isPreRendered){pvc.removeTipsyLegends();}
this.basePanel.render({bypassAnimation:bypassAnimation,recreate:recreate});}catch(e){if(e instanceof NoDataException){if(pvc.debug>1){this._log("No data found.");}
this._addErrorPanelMessage("No data found",true);}else{hasError=true;pvc.logError(e.message);if(pvc.debug>0){this._addErrorPanelMessage("Error: "+e.message,false);}}}});}finally{if(!hasError){this._resumeSelectionUpdate();}
if(pvc.debug>1){pvc.groupEnd();}}
return this;},_addErrorPanelMessage:function(text,isNoData){var options=this.options,pvPanel=new pv.Panel().canvas(options.canvas).width(this.width).height(this.height),pvMsg=pvPanel.anchor("center").add(pv.Label).text(text);if(isNoData){this.extend(pvMsg,"noDataMessage");}
pvPanel.render();},useTextMeasureCache:function(fun,ctx){var root=this.root;var textMeasureCache=root._textMeasureCache||(root._textMeasureCache=pv.Text.createCache());return pv.Text.usingCache(textMeasureCache,fun,ctx||this);},animate:function(start,end){return this.basePanel.animate(start,end);},animatingStart:function(){return this.basePanel.animatingStart();},animatable:function(){return this._animatable&&this.base();},isOrientationVertical:function(orientation){return(orientation||this.options.orientation)===pvc.orientation.vertical;},isOrientationHorizontal:function(orientation){return(orientation||this.options.orientation)===pvc.orientation.horizontal;},dispose:function(){if(!this._disposed){this._disposed=true;}},defaults:{width:400,height:300,orientation:'vertical',ignoreNulls:true,crosstabMode:true,isMultiValued:false,seriesInRows:false,groupedLabelSep:undefined,animate:true,titlePosition:"top",titleAlign:"center",legend:false,legendPosition:"bottom",v1StyleTooltipFormat:function(s,c,v,datum){return s+", "+c+":  "+this.chart.options.valueFormat(v)+
(datum&&datum.percent?(" ("+datum.percent.label+")"):"");},valueFormat:def.scope(function(){var pvFormat=pv.Format.number().fractionDigits(0,2);return function(d){return pvFormat.format(d);};}),percentValueFormat:def.scope(function(){var pvFormat=pv.Format.number().fractionDigits(0,1);return function(d){return pvFormat.format(d*100)+"%";};}),clickable:false,doubleClickMaxDelay:300,hoverable:false,selectable:false,selectionMode:'rubberband',ctrlSelectMode:true,clearSelectionMode:'emptySpaceClick',compatVersion:Infinity}});pvc.BaseChart.add({visualRoles:null,visualRoleList:null,_serRole:null,_dataPartRole:null,_measureVisualRoles:null,visualRole:function(roleName){var role=def.getOwn(this.visualRoles,roleName);if(!role){throw def.error.operationInvalid('roleName',"There is no visual role with name '{0}'.",[roleName]);}
return role;},measureVisualRoles:function(){return this._measureVisualRoles;},measureDimensionsNames:function(){return def.query(this._measureVisualRoles).select(function(role){return role.firstDimensionName();}).where(def.notNully).array();},_constructVisualRoles:function(){var parent=this.parent;if(parent){this.visualRoles=parent.visualRoles;this.visualRoleList=parent.visualRoleList;this._measureVisualRoles=parent._measureVisualRoles;['_multiChartRole','_serRole','_colorRole','_dataPartRole'].forEach(function(p){var parentRole=parent[p];if(parentRole){this[p]=parentRole;}},this);}else{this.visualRoles={};this.visualRoleList=[];this._measureVisualRoles=[];}},_hasDataPartRole:def.fun.constant(false),_getSeriesRoleSpec:def.fun.constant(null),_getColorRoleSpec:def.fun.constant(null),_addVisualRole:function(name,keyArgs){keyArgs=def.set(keyArgs,'index',this.visualRoleList.length);var role=new pvc.visual.Role(name,keyArgs);this.visualRoleList.push(role);this.visualRoles[name]=role;if(role.isMeasure){this._measureVisualRoles.push(role);}
return role;},_initVisualRoles:function(){this._multiChartRole=this._addVisualRole('multiChart',{defaultDimension:'multiChart*',requireIsDiscrete:true});if(this._hasDataPartRole()){this._dataPartRole=this._addVisualRole('dataPart',{defaultDimension:'dataPart',requireSingleDimension:true,requireIsDiscrete:true,dimensionDefaults:{isHidden:true,comparer:def.compare}});}
var serRoleSpec=this._getSeriesRoleSpec();if(serRoleSpec){this._serRole=this._addVisualRole('series',serRoleSpec);}
var colorRoleSpec=this._getColorRoleSpec();if(colorRoleSpec){this._colorRole=this._addVisualRole('color',colorRoleSpec);}},_assertUnboundRoleIsOptional:function(role){if(role.isRequired){throw def.error.operationInvalid("Chart type requires unassigned role '{0}'.",[role.name]);}},_bindVisualRolesPreI:function(){def.eachOwn(this.visualRoles,function(role){role.setIsReversed(false);});var sourcedRoles=[];var options=this.options;var roleOptions=options.visualRoles;this.visualRoleList.forEach(function(role){var name=role.name;var roleSpec=options[name+'Role'];if(roleSpec!==undefined){if(!roleOptions){roleOptions=options.visualRoles={};}
if(roleOptions[name]===undefined){roleOptions[name]=roleSpec;}}});var dimsBoundToSingleRole;if(roleOptions){dimsBoundToSingleRole={};var rolesWithOptions=def.query(def.keys(roleOptions)).select(this.visualRole,this).array();rolesWithOptions.sort(function(a,b){return a.index-b.index;});rolesWithOptions.forEach(function(role){var name=role.name;var roleSpec=roleOptions[name];var groupingSpec,sourceRoleName;if(def.object.is(roleSpec)){if(def.nullyTo(roleSpec.isReversed,false)){role.setIsReversed(true);}
sourceRoleName=roleSpec.from;if(sourceRoleName&&(sourceRoleName!==name)){var sourceRole=this.visualRoles[sourceRoleName]||def.fail.operationInvalid("Source role '{0}' is not supported by the chart type.",[sourceRoleName]);role.setSourceRole(sourceRole);sourcedRoles.push(role);}else{groupingSpec=roleSpec.dimensions;}}else{groupingSpec=roleSpec;}
if(groupingSpec!==undefined){if(!groupingSpec){this._assertUnboundRoleIsOptional(role);}
var grouping=pvc.data.GroupingSpec.parse(groupingSpec);role.preBind(grouping);grouping.dimensions().each(function(groupDimSpec){if(def.hasOwn(dimsBoundToSingleRole,groupDimSpec.name)){delete dimsBoundToSingleRole[groupDimSpec.name];}else{dimsBoundToSingleRole[groupDimSpec.name]=role;}});}},this);}
this._sourcedRoles=sourcedRoles;this._dimsBoundToSingleRole=dimsBoundToSingleRole;},_bindVisualRolesPreII:function(){var dimsBoundToSingleRole=this._dimsBoundToSingleRole;if(dimsBoundToSingleRole){delete this._dimsBoundToSingleRole;def.eachOwn(dimsBoundToSingleRole,this._setRoleBoundDimensionDefaults,this);}
var sourcedRoles=this._sourcedRoles;delete this._sourcedRoles;def.query(this.visualRoleList).where(function(role){return role.defaultSourceRoleName&&!role.sourceRole&&!role.isPreBound();}).each(function(role){var sourceRole=this.visualRoles[role.defaultSourceRoleName];if(sourceRole){role.setSourceRole(sourceRole,true);sourcedRoles.push(role);}},this);sourcedRoles.forEach(function(role){var sourceRole=role.sourceRole;if(sourceRole.isReversed){role.setIsReversed(!role.isReversed);}
if(!role.defaultDimensionName&&sourceRole.isPreBound()){role.preBind(sourceRole.preBoundGrouping());}});},_setRoleBoundDimensionDefaults:function(role,dimName){this._complexTypeProj.setDimDefaults(dimName,role.dimensionDefaults);},_bindVisualRolesPostI:function(){var me=this;var complexTypeProj=me._complexTypeProj;var boundDimTypes={};var unboundSourcedRoles=[];def.query(me.visualRoleList).where(function(role){return role.isPreBound();}).each(markPreBoundRoleDims);def.query(me.visualRoleList).where(function(role){return!role.isPreBound();}).each(autoBindUnboundRole);unboundSourcedRoles.forEach(tryPreBindSourcedRole);def.query(def.ownKeys(boundDimTypes)).where(function(dimName){return boundDimTypes[dimName].length===1;}).each(function(dimName){var singleRole=boundDimTypes[dimName][0];me._setRoleBoundDimensionDefaults(singleRole,dimName);});function markDimBoundTo(dimName,role){def.array.lazy(boundDimTypes,dimName).push(role);}
function dimIsDefined(dimName){return complexTypeProj.hasDim(dimName);}
function preBindRoleTo(role,dimNames){if(def.array.is(dimNames)){dimNames.forEach(function(dimName){markDimBoundTo(dimName,role);});}else{markDimBoundTo(dimNames,role);}
role.setSourceRole(null);role.preBind(pvc.data.GroupingSpec.parse(dimNames));}
function preBindRoleToGroupDims(role,groupDimNames){if(groupDimNames.length){if(role.requireSingleDimension){preBindRoleTo(role,groupDimNames[0]);}
else{preBindRoleTo(role,groupDimNames);}}}
function preBindRoleToNewDim(role,dimName){complexTypeProj.setDim(dimName,{isHidden:true});preBindRoleTo(role,dimName);}
function roleIsUnbound(role){me._assertUnboundRoleIsOptional(role);role.bind(null);role.setSourceRole(null);}
function markPreBoundRoleDims(role){role.preBoundGrouping().dimensionNames().forEach(markDimBoundTo);}
function autoBindUnboundRole(role){if(role.sourceRole&&!role.isDefaultSourceRole){unboundSourcedRoles.push(role);return;}
var dimName=role.defaultDimensionName;if(!dimName){if(role.sourceRole){unboundSourcedRoles.push(role);}
else{roleIsUnbound(role);}
return;}
var match=dimName.match(/^(.*?)(\*)?$/)||def.fail.argumentInvalid('defaultDimensionName');var defaultName=match[1];var greedy=match[2];if(greedy){var groupDimNames=complexTypeProj.groupDimensionsNames(defaultName);if(groupDimNames){preBindRoleToGroupDims(role,groupDimNames);return;}}else if(dimIsDefined(defaultName)){preBindRoleTo(role,defaultName);return;}
if(role.autoCreateDimension){preBindRoleToNewDim(role,defaultName);return;}
if(role.sourceRole){unboundSourcedRoles.push(role);}
else{roleIsUnbound(role);}}
function tryPreBindSourcedRole(role){var sourceRole=role.sourceRole;if(sourceRole.isPreBound()){role.preBind(sourceRole.preBoundGrouping());}
else{roleIsUnbound(role);}}},_bindVisualRolesPostII:function(complexType){def.query(this.visualRoleList).where(function(role){return role.isPreBound();}).each(function(role){role.postBind(complexType);});},_logVisualRoles:function(){var names=def.ownKeys(this.visualRoles);var maxLen=Math.max(10,def.query(names).select(function(s){return s.length;}).max());var header=def.string.padRight("VisualRole",maxLen)+" < Dimension(s)";var out=["VISUAL ROLES MAP SUMMARY",pvc.logSeparator,header,def.string.padRight('',maxLen+1,'-')+'+--------------'];def.eachOwn(this.visualRoles,function(role,name){out.push(def.string.padRight(name,maxLen)+' | '+(role.grouping||'-'));});out.push("");this._log(out.join("\n"));},_getDataPartDimName:function(){var role=this._dataPartRole;if(role){if(role.isBound()){return role.firstDimensionName();}
var preGrouping=role.preBoundGrouping();if(preGrouping){return preGrouping.firstDimensionName();}
return role.defaultDimensionName;}}});pvc.BaseChart.add({dataEngine:null,data:null,_partData:null,_visibleDataCache:null,resultset:[],metadata:[],_constructData:function(options){if(this.parent){this.dataEngine=this.data=options.data||def.fail.argumentRequired('options.data');}},_checkNoDataI:function(){if(!this.parent&&!this.allowNoData&&this.resultset.length===0){throw new NoDataException();}},_checkNoDataII:function(){if(!this.parent&&!this.allowNoData&&(!this.data||!this.data.count())){this.data=null;throw new NoDataException();}},_initData:function(ka){if(!this.parent){var data=this.data;if(!data){this._onLoadData();}else if(def.get(ka,'reloadData',true)){this._onReloadData();}else{data.clearVirtuals();data.disposeChildren();}}
delete this._partData;delete this._visibleDataCache;if(pvc.debug>=3){this._log(this.data.getInfo());}},_onLoadData:function(){var data=this.data;var translation=this._translation;(!data&&!translation)||def.assert("Invalid state.");var options=this.options;var dataPartDimName=this._getDataPartDimName();var complexTypeProj=this._complexTypeProj||def.assert("Invalid state.");var translOptions=this._createTranslationOptions(dataPartDimName);translation=this._translation=this._createTranslation(translOptions);if(pvc.debug>=3){this._log(translation.logSource());this._log(translation.logTranslatorType());}
translation.configureType();if(dataPartDimName&&!complexTypeProj.isReadOrCalc(dataPartDimName)){this._addDefaultDataPartCalculation(dataPartDimName);}
if(pvc.debug>=3){this._log(translation.logVItem());}
this._bindVisualRolesPostI();var complexType=new pvc.data.ComplexType();complexTypeProj.configureComplexType(complexType,translOptions);this._bindVisualRolesPostII(complexType);if(pvc.debug>=10){this._log(complexType.describe());}
if(pvc.debug>=3){this._logVisualRoles();}
data=this.dataEngine=this.data=new pvc.data.Data({type:complexType,labelSep:options.groupedLabelSep,keySep:translOptions.separator});var loadKeyArgs={where:this._getLoadFilter(),isNull:this._getIsNullDatum()};var resultQuery=translation.execute(data);data.load(resultQuery,loadKeyArgs);},_onReloadData:function(){var data=this.data;var translation=this._translation;(data&&translation)||def.assert("Invalid state.");var options=this.options;translation.setSource(this.resultset);if(pvc.debug>=3){this._log(translation.logSource());}
var loadKeyArgs={where:this._getLoadFilter(),isNull:this._getIsNullDatum()};var resultQuery=translation.execute(data);data.load(resultQuery,loadKeyArgs);},_createComplexTypeProject:function(){var options=this.options;var complexTypeProj=new pvc.data.ComplexTypeProject(options.dimensionGroups);var userDimsSpec=options.dimensions;for(var dimName in userDimsSpec){complexTypeProj.setDim(dimName,userDimsSpec[dimName]);}
var dataPartDimName=this._getDataPartDimName();if(dataPartDimName){complexTypeProj.setDim(dataPartDimName);this._addPlot2SeriesDataPartCalculation(complexTypeProj,dataPartDimName);}
var calcSpecs=options.calculations;if(calcSpecs){calcSpecs.forEach(function(calcSpec){complexTypeProj.setCalc(calcSpec);});}
return complexTypeProj;},_getLoadFilter:function(){if(this.options.ignoreNulls){var me=this;return function(datum){var isNull=datum.isNull;if(isNull&&pvc.debug>=4){me._info("Datum excluded.");}
return!isNull;};}},_getIsNullDatum:function(){var measureDimNames=this.measureDimensionsNames(),M=measureDimNames.length;if(M){return function(datum){var atoms=datum.atoms;for(var i=0;i<M;i++){if(atoms[measureDimNames[i]].value!=null){return false;}}
return true;};}},_createTranslation:function(translOptions){var TranslationClass=this._getTranslationClass(translOptions);return new TranslationClass(this,this._complexTypeProj,this.resultset,this.metadata,translOptions);},_getTranslationClass:function(translOptions){return translOptions.crosstabMode?pvc.data.CrosstabTranslationOper:pvc.data.RelationalTranslationOper;},_createTranslationOptions:function(dataPartDimName){var options=this.options;var dataOptions=options.dataOptions||{};var dataSeparator=options.dataSeparator;if(dataSeparator===undefined){dataSeparator=dataOptions.separator;}
if(!dataSeparator){dataSeparator='~';}
var dataMeasuresInColumns=options.dataMeasuresInColumns;if(dataMeasuresInColumns===undefined){dataMeasuresInColumns=dataOptions.measuresInColumns;}
var dataCategoriesCount=options.dataCategoriesCount;if(dataCategoriesCount===undefined){dataCategoriesCount=dataOptions.categoriesCount;}
var dataIgnoreMetadataLabels=options.dataIgnoreMetadataLabels;if(dataIgnoreMetadataLabels===undefined){dataIgnoreMetadataLabels=dataOptions.ignoreMetadataLabels;}
var plot2=options.plot2;var valueFormat=options.valueFormat,valueFormatter;if(valueFormat&&valueFormat!==this.defaults.valueFormat){valueFormatter=function(v){return v!=null?valueFormat(v):"";};}
var plot2Series,plot2DataSeriesIndexes;if(plot2){if(this._allowV1SecondAxis&&(this.compatVersion()<=1)){plot2DataSeriesIndexes=options.secondAxisIdx;}else{plot2Series=(this._serRole!=null)&&options.plot2Series&&def.array.as(options.plot2Series);if(!plot2Series||!plot2Series.length){plot2Series=null;plot2DataSeriesIndexes=options.plot2SeriesIndexes;}}
if(!plot2Series){plot2DataSeriesIndexes=pvc.parseDistinctIndexArray(plot2DataSeriesIndexes,-Infinity)||-1;}}
return{compatVersion:this.compatVersion(),plot2DataSeriesIndexes:plot2DataSeriesIndexes,seriesInRows:options.seriesInRows,crosstabMode:options.crosstabMode,isMultiValued:options.isMultiValued,dataPartDimName:dataPartDimName,dimensionGroups:options.dimensionGroups,dimensions:options.dimensions,readers:options.readers,measuresIndexes:options.measuresIndexes,multiChartIndexes:options.multiChartIndexes,separator:dataSeparator,measuresInColumns:dataMeasuresInColumns,categoriesCount:dataCategoriesCount,measuresIndex:dataOptions.measuresIndex||dataOptions.measuresIdx,measuresCount:dataOptions.measuresCount||dataOptions.numMeasures,isCategoryTimeSeries:options.timeSeries,timeSeriesFormat:options.timeSeriesFormat,valueNumberFormatter:valueFormatter,ignoreMetadataLabels:dataIgnoreMetadataLabels};},_addPlot2SeriesDataPartCalculation:function(complexTypeProj,dataPartDimName){if(this.compatVersion()<=1){return;}
var options=this.options;var serRole=this._serRole;var plot2Series=(serRole!=null)&&options.plot2&&options.plot2Series&&def.array.as(options.plot2Series);if(!plot2Series||!plot2Series.length){return;}
var inited=false;var plot2SeriesSet=def.query(plot2Series).uniqueIndex();var dimNames,dataPartDim,part1Atom,part2Atom;complexTypeProj.setCalc({names:dataPartDimName,calculation:function(datum,atoms){if(!inited){if(serRole.isBound()){dimNames=serRole.grouping.dimensionNames();dataPartDim=datum.owner.dimensions(dataPartDimName);}
inited=true;}
if(dataPartDim){var seriesKey=pvc.data.Complex.compositeKey(datum,dimNames);atoms[dataPartDimName]=def.hasOwnProp.call(plot2SeriesSet,seriesKey)?(part2Atom||(part2Atom=dataPartDim.intern('1'))):(part1Atom||(part1Atom=dataPartDim.intern('0')));}}});},_addDefaultDataPartCalculation:function(dataPartDimName){var dataPartDim,part1Atom;this._complexTypeProj.setCalc({names:dataPartDimName,calculation:function(datum,atoms){if(!dataPartDim){dataPartDim=datum.owner.dimensions(dataPartDimName);}
atoms[dataPartDimName]=part1Atom||(part1Atom=dataPartDim.intern('0'));}});},partData:function(dataPartValues){var partRole=this._dataPartRole;if(!this._partData){if(!partRole||!partRole.grouping){return this._partData=this.data;}
this._partData=partRole.flatten(this.data);}
if(!dataPartValues||!partRole||!partRole.grouping){return this._partData;}
var dataPartDimName=partRole.firstDimensionName();if(def.array.is(dataPartValues)){if(dataPartValues.length>1){return this._partData.where([def.set({},dataPartDimName,dataPartValues)]);}
dataPartValues=dataPartValues[0];}
var child=this._partData._childrenByKey[dataPartValues+''];if(!child){var dataPartCell={v:dataPartValues};if(dataPartValues==='trend'){var firstTrendAtom=this._firstTrendAtomProto;if(firstTrendAtom){dataPartCell.f=firstTrendAtom.f;}}
child=new pvc.data.Data({parent:this._partData,atoms:def.set({},dataPartDimName,dataPartCell),dimNames:[dataPartDimName],datums:[]});}
return child;},visibleData:function(dataPartValue,ka){var ignoreNulls=def.get(ka,'ignoreNulls',true);var inverted=def.get(ka,'inverted',false);if(ignoreNulls&&this.options.ignoreNulls){ignoreNulls=false;}
var cache=def.lazy(this,'_visibleDataCache');var key=inverted+'|'+ignoreNulls+'|'+dataPartValue;var data=cache[key];if(!data){ka=ka?Object.create(ka):{};ka.ignoreNulls=ignoreNulls;data=cache[key]=this._createVisibleData(dataPartValue,ka);}
return data;},_createVisibleData:function(dataPartValue,ka){var partData=this.partData(dataPartValue);if(!partData){return null;}
var ignoreNulls=def.get(ka,'ignoreNulls');var serRole=this._serRole;return serRole&&serRole.grouping?serRole.flatten(partData,{visible:true,isNull:ignoreNulls?false:null}):partData;},_generateTrends:function(){if(this._dataPartRole){def.query(def.own(this.axes)).selectMany(def.propGet('dataCells')).where(def.propGet('trend')).distinct(function(dataCell){return dataCell.role.name+'|'+(dataCell.dataPartValue||'');}).each(this._generateTrendsDataCell,this);}},_interpolate:function(){def.query(def.own(this.axes)).selectMany(def.propGet('dataCells')).where(function(dataCell){var nim=dataCell.nullInterpolationMode;return!!nim&&nim!=='none';}).distinct(function(dataCell){return dataCell.role.name+'|'+(dataCell.dataPartValue||'');}).each(this._interpolateDataCell,this);},_interpolateDataCell:function(){},_generateTrendsDataCell:function(){},setData:function(data,options){this.setResultset(data.resultset);this.setMetadata(data.metadata);$.extend(this.options,options);return this;},setResultset:function(resultset){!this.parent||def.fail.operationInvalid("Can only set resultset on root chart.");this.resultset=resultset;if(!resultset.length){this._log("Warning: Resultset is empty");}
return this;},setMetadata:function(metadata){!this.parent||def.fail.operationInvalid("Can only set resultset on root chart.");this.metadata=metadata;if(!metadata.length){this._log("Warning: Metadata is empty");}
return this;}});pvc.BaseChart.add({_initPlots:function(hasMultiRole){this.plotPanelList=null;if(!this.parent){this.plots={};this.plotList=[];this.plotsByType={};this._initPlotsCore(hasMultiRole);}else{var root=this.root;this.plots=root.plots;this.plotList=root.plotList;this.plotsByType=root.plotsByType;}},_initPlotsCore:function(){},_addPlot:function(plot){var plotsByType=this.plotsByType;var plots=this.plots;var plotType=plot.type;var plotIndex=plot.index;var plotName=plot.name;var plotId=plot.id;if(plotName&&def.hasOwn(plots,plotName)){throw def.error.operationInvalid("Plot name '{0}' already taken.",[plotName]);}
if(def.hasOwn(plots,plotId)){throw def.error.operationInvalid("Plot id '{0}' already taken.",[plotId]);}
var typePlots=def.array.lazy(plotsByType,plotType);if(def.hasOwn(typePlots,plotIndex)){throw def.error.operationInvalid("Plot index '{0}' of type '{1}' already taken.",[plotIndex,plotType]);}
plot.globalIndex=this.plotList.length;typePlots[plotIndex]=plot;this.plotList.push(plot);plots[plotId]=plot;if(plotName){plots[plotName]=plot;}},_collectPlotAxesDataCells:function(plot,dataCellsByAxisTypeThenIndex){var dataCells=[];plot.collectDataCells(dataCells);if(dataCells.length){def.query(dataCells).where(function(dataCell){return dataCell.isBound();}).each(function(dataCell){var dataCellsByAxisIndex=def.array.lazy(dataCellsByAxisTypeThenIndex,dataCell.axisType);def.array.lazy(dataCellsByAxisIndex,dataCell.axisIndex).push(dataCell);});}},_addPlotPanel:function(plotPanel){def.lazy(this,'plotPanels')[plotPanel.plot.id]=plotPanel;def.array.lazy(this,'plotPanelList').push(plotPanel);},_createPlotPanels:function(){throw def.error.notImplemented();}});pvc.BaseChart.add({colors:null,axes:null,axesList:null,axesByType:null,_axisClassByType:{'color':pvc.visual.ColorAxis,'size':pvc.visual.SizeAxis,'base':pvc_CartesianAxis,'ortho':pvc_CartesianAxis},_axisCreateWhere:{'color':1,'size':2,'base':3,'ortho':3},_axisCreationOrder:['color','size','base','ortho'],_axisCreateIfUnbound:{},_initAxes:function(hasMultiRole){this.axes={};this.axesList=[];this.axesByType={};delete this._rolesColorScale;var dataCellsByAxisTypeThenIndex;if(!this.parent){dataCellsByAxisTypeThenIndex={};this.plotList.forEach(function(plot){this._collectPlotAxesDataCells(plot,dataCellsByAxisTypeThenIndex);},this);this._fixTrendsLabel(dataCellsByAxisTypeThenIndex);}else{dataCellsByAxisTypeThenIndex=this.root._dataCellsByAxisTypeThenIndex;}
this._dataCellsByAxisTypeThenIndex=dataCellsByAxisTypeThenIndex;var here=0;if(!this.parent){here|=1;}
if(this.parent||!hasMultiRole){here|=2;}
this._axisCreateHere=here;this._axisCreationOrder.forEach(function(type){if((this._axisCreateWhere[type]&here)!==0){var AxisClass;var dataCellsByAxisIndex=dataCellsByAxisTypeThenIndex[type];if(dataCellsByAxisIndex){AxisClass=this._axisClassByType[type];if(AxisClass){dataCellsByAxisIndex.forEach(function(dataCells,axisIndex){new AxisClass(this,type,axisIndex);},this);}}else if(this._axisCreateIfUnbound[type]){AxisClass=this._axisClassByType[type];if(AxisClass){new AxisClass(this,type,0);}}}},this);if(this.parent){this.root.axesList.forEach(function(axis){if(!def.hasOwn(this.axes,axis.id)){this._addAxis(axis);}},this);}},_fixTrendsLabel:function(dataCellsByAxisTypeThenIndex){var dataPartDimName=this._getDataPartDimName();if(dataPartDimName){var firstDataCell=def.query(def.ownKeys(dataCellsByAxisTypeThenIndex)).selectMany(function(axisType){return dataCellsByAxisTypeThenIndex[axisType];}).selectMany().first(function(dataCell){return!!dataCell.trend;});if(firstDataCell){var trendInfo=pvc.trends.get(firstDataCell.trend.type);var dataPartAtom=trendInfo.dataPartAtom;var trendLabel=firstDataCell.trend.label;if(trendLabel===undefined){trendLabel=dataPartAtom.f;}
this._firstTrendAtomProto={v:dataPartAtom.v,f:trendLabel};}else{delete this._firstTrendAtomProto;}}},_addAxis:function(axis){this.axes[axis.id]=axis;if(axis.chart===this){axis.axisIndex=this.axesList.length;}
this.axesList.push(axis);var typeAxes=def.array.lazy(this.axesByType,axis.type);var typeIndex=typeAxes.count||0;axis.typeIndex=typeIndex;typeAxes[axis.index]=axis;if(!typeIndex){typeAxes.first=axis;}
typeAxes.count=typeIndex+1;if(axis.type==='color'&&axis.isBound()){this._onColorAxisScaleSet(axis);}
return this;},_getAxis:function(type,index){var typeAxes=this.axesByType[type];if(typeAxes&&index!=null&&(+index>=0)){return typeAxes[index];}},_bindAxes:function(){var here=this._axisCreateHere;def.eachOwn(this._dataCellsByAxisTypeThenIndex,function(dataCellsByAxisIndex,type){if((this._axisCreateWhere[type]&here)){dataCellsByAxisIndex.forEach(function(dataCells,index){var axis=this.axes[pvc.buildIndexedId(type,index)];if(!axis.isBound()){axis.bind(dataCells);}},this);}},this);},_setAxesScales:function(){if(!this.parent){var colorAxes=this.axesByType.color;if(colorAxes){colorAxes.forEach(function(axis){if(axis.isBound()){this._createColorAxisScale(axis);this._onColorAxisScaleSet(axis);}},this);}}},_createAxisScale:function(axis){var scale=this._createScaleByAxis(axis);if(scale.isNull&&pvc.debug>=3){this._log(def.format("{0} scale for axis '{1}'- no data",[axis.scaleType,axis.id]));}
return axis.setScale(scale).scale;},_createScaleByAxis:function(axis){var createScale=this['_create'+def.firstUpperCase(axis.scaleType)+'ScaleByAxis'];return createScale.call(this,axis);},_createDiscreteScaleByAxis:function(axis){var dataPartValues=axis.dataCells.map(function(dataCell){return dataCell.dataPartValue;});var baseData=this.visibleData(dataPartValues,{ignoreNulls:false});var data=baseData&&axis.role.flatten(baseData);var scale=new pv.Scale.ordinal();if(!data||!data.count()){scale.isNull=true;}else{var values=data.children().select(function(child){return def.nullyTo(child.value,"");}).array();scale.domain(values);}
return scale;},_createTimeSeriesScaleByAxis:function(axis){var extent=this._getContinuousVisibleExtent(axis);var scale=new pv.Scale.linear();if(!extent){scale.isNull=true;}else{var dMin=extent.min;var dMax=extent.max;if((dMax-dMin)===0){dMax=new Date(dMax.getTime()+3600000);}
scale.domain(dMin,dMax);scale.minLocked=extent.minLocked;scale.maxLocked=extent.maxLocked;}
return scale;},_createNumericScaleByAxis:function(axis){var extent=this._getContinuousVisibleExtentConstrained(axis);var scale=new pv.Scale.linear();if(!extent){scale.isNull=true;}else{var tmp;var dMin=extent.min;var dMax=extent.max;var epsi=1e-10;var normalize=function(){var d=dMax-dMin;if(d&&Math.abs(d)<=epsi){dMin=(dMin+dMax)/2;dMin=dMax=+dMin.toFixed(10);d=0;}
if(!d){if(!extent.minLocked){dMin=Math.abs(dMin)>epsi?(dMin*0.99):-0.1;}
if(!extent.maxLocked||extent.minLocked){dMax=Math.abs(dMax)>epsi?(dMax*1.01):+0.1;}}else if(d<0){if(!extent.maxLocked||extent.minLocked){dMax=Math.abs(dMin)>epsi?dMin*1.01:+0.1;}else{dMin=Math.abs(dMax)>epsi?dMax*0.99:-0.1;}}};normalize();var originIsZero=axis.option('OriginIsZero');if(originIsZero){if(dMin===0){extent.minLocked=true;}else if(dMax===0){extent.maxLocked=true;}else if((dMin*dMax)>0){if(dMin>0){if(!extent.minLocked){extent.minLocked=true;dMin=0;}}else{if(!extent.maxLocked){extent.maxLocked=true;dMax=0;}}}}
normalize();scale.domain(dMin,dMax);scale.minLocked=extent.minLocked;scale.maxLocked=extent.maxLocked;}
return scale;},_warnSingleContinuousValueRole:function(valueRole){if(!valueRole.grouping.isSingleDimension){this._warn("A linear scale can only be obtained for a single dimension role.");}
if(valueRole.grouping.isDiscrete()){this._warn(def.format("The single dimension of role '{0}' should be continuous.",[valueRole.name]));}},_getContinuousVisibleExtentConstrained:function(axis,min,max){var minLocked=false;var maxLocked=false;if(min==null){min=axis.option('FixedMin');minLocked=(min!=null);}
if(max==null){max=axis.option('FixedMax');maxLocked=(max!=null);}
if(min==null||max==null){var baseExtent=this._getContinuousVisibleExtent(axis);if(!baseExtent){return null;}
if(min==null){min=baseExtent.min;}
if(max==null){max=baseExtent.max;}}
return{min:min,max:max,minLocked:minLocked,maxLocked:maxLocked};},_getContinuousVisibleExtent:function(valueAxis){var dataCells=valueAxis.dataCells;if(dataCells.length===1){return this._getContinuousVisibleCellExtent(valueAxis,dataCells[0]);}
return def.query(dataCells).select(function(dataCell){return this._getContinuousVisibleCellExtent(valueAxis,dataCell);},this).reduce(pvc.unionExtents,null);},_getContinuousVisibleCellExtent:function(valueAxis,valueDataCell){var valueRole=valueDataCell.role;this._warnSingleContinuousValueRole(valueRole);if(valueRole.name==='series'){throw def.error.notImplemented();}
var useAbs=valueAxis.scaleUsesAbs();var data=this.visibleData(valueDataCell.dataPartValue);var extent=data&&data.dimensions(valueRole.firstDimensionName()).extent({abs:useAbs});if(extent){var minValue=extent.min.value;var maxValue=extent.max.value;return{min:(useAbs?Math.abs(minValue):minValue),max:(useAbs?Math.abs(maxValue):maxValue)};}},_createColorAxisScale:function(axis){var setScaleArgs;var dataCells=axis.dataCells;if(dataCells){var me=this;if(axis.scaleType==='discrete'){setScaleArgs=this._createDiscreteColorAxisScale(axis);}else{setScaleArgs=this._createContinuousColorAxisScale(axis);}}
return axis.setScale.apply(axis,setScaleArgs);},_createDiscreteColorAxisScale:function(axis){var domainValues=def.query(axis.dataCells).selectMany(function(dataCell){return dataCell.domainItemValues();}).array();axis.domainValues=domainValues;return[axis.scheme()(domainValues),true];},_createContinuousColorAxisScale:function(axis){if(axis.dataCells.length===1){this._warnSingleContinuousValueRole(axis.role);var visibleDomainData=this.root.visibleData(axis.dataCell.dataPartValue);var normByCateg=axis.option('NormByCategory');var scaleOptions={type:axis.option('ScaleType'),colors:axis.option('Colors')().range(),colorDomain:axis.option('Domain'),colorMin:axis.option('Min'),colorMax:axis.option('Max'),colorMissing:axis.option('Missing'),data:visibleDomainData,colorDimension:axis.role.firstDimensionName(),normPerBaseCategory:normByCateg};if(!normByCateg){return[pvc_colorScale(scaleOptions)];}
axis.scalesByCateg=pvc_colorScales(scaleOptions);}
return[];},_onColorAxisScaleSet:function(axis){switch(axis.index){case 0:this.colors=axis.scheme();break;case 1:if(this._allowV1SecondAxis){this.secondAxisColor=axis.scheme();}
break;}},_getRoleColorScale:function(roleName){return def.lazy(def.lazy(this,'_rolesColorScale'),roleName,this._createRoleColorScale,this);},_createRoleColorScale:function(roleName){var firstScale,scale;var valueToColorMap={};this.axesByType.color.forEach(function(axis){var axisRole=axis.role;var isRoleCompatible=(axisRole.name===roleName)||(axisRole.sourceRole&&axisRole.sourceRole.name===roleName);if(isRoleCompatible&&axis.scale&&(axis.index===0||axis.option.isSpecified('Colors')||axis.option.isSpecified('Map'))){scale=axis.scale;if(!firstScale){firstScale=scale;}
axis.domainValues.forEach(addDomainValue);}},this);function addDomainValue(value){var key=''+value;if(!def.hasOwnProp.call(valueToColorMap,key)){valueToColorMap[key]=scale(value);}}
if(!firstScale){return pvc.createColorScheme()();}
scale=function(value){var key=''+value;if(def.hasOwnProp.call(valueToColorMap,key)){return valueToColorMap[key];}
var color=firstScale(value);valueToColorMap[key]=color;return color;};def.copy(scale,firstScale);return scale;},_onLaidOut:function(){}});pvc.BaseChart.add({basePanel:null,titlePanel:null,legendPanel:null,_multiChartPanel:null,_initChartPanels:function(hasMultiRole){this._initBasePanel();this._initTitlePanel();var isMultichartRoot=hasMultiRole&&!this.parent;var legendPanel=this._initLegendPanel();if(isMultichartRoot){this._initMultiChartPanel();}
if(legendPanel){this._initLegendScenes(legendPanel);}
if(!isMultichartRoot){var o=this.options;this._preRenderContent({margins:hasMultiRole?o.smallContentMargins:o.contentMargins,paddings:hasMultiRole?o.smallContentPaddings:o.contentPaddings,clickAction:o.clickAction,doubleClickAction:o.doubleClickAction});}},_preRenderContent:function(){},_initBasePanel:function(){var p=this.parent;this.basePanel=new pvc.BasePanel(this,p&&p._multiChartPanel,{margins:this.margins,paddings:this.paddings,size:{width:this.width,height:this.height}});},_initTitlePanel:function(){var me=this;var o=me.options;var title=o.title;if(!def.empty(title)){var isRoot=!me.parent;this.titlePanel=new pvc.TitlePanel(me,me.basePanel,{title:title,font:o.titleFont,anchor:o.titlePosition,align:o.titleAlign,alignTo:o.titleAlignTo,offset:o.titleOffset,keepInBounds:o.titleKeepInBounds,margins:o.titleMargins,paddings:o.titlePaddings,titleSize:o.titleSize,titleSizeMax:o.titleSizeMax});}},_initLegendPanel:function(){var o=this.options;if(o.legend){var legend=new pvc.visual.Legend(this,'legend',0);return this.legendPanel=new pvc.LegendPanel(this,this.basePanel,{anchor:legend.option('Position'),align:legend.option('Align'),alignTo:o.legendAlignTo,offset:o.legendOffset,keepInBounds:o.legendKeepInBounds,size:legend.option('Size'),sizeMax:legend.option('SizeMax'),margins:legend.option('Margins'),paddings:legend.option('Paddings'),font:legend.option('Font'),scenes:def.getPath(o,'legend.scenes'),textMargin:o.legendTextMargin,itemPadding:o.legendItemPadding,markerSize:o.legendMarkerSize});}},_getLegendBulletRootScene:function(){return this.legendPanel&&this.legendPanel._getBulletRootScene();},_initMultiChartPanel:function(){var basePanel=this.basePanel;var options=this.options;this._multiChartPanel=new pvc.MultiChartPanel(this,basePanel,{margins:options.contentMargins,paddings:options.contentPaddings});this._multiChartPanel.createSmallCharts();basePanel._children.unshift(basePanel._children.pop());},_coordinateSmallChartsLayout:function(){},_initLegendScenes:function(legendPanel){var colorAxes=this.axesByType.color;if(!colorAxes){return;}
var rootScene;var legendIndex=0;var dataPartDimName=this._getDataPartDimName();def.query(colorAxes).where(function(axis){return axis.option('LegendVisible');}).each(function(axis){if(axis.dataCells){axis.dataCells.forEach(function(dataCell){if(dataCell.role.isDiscrete()){createLegendGroup(dataCell,axis);}});}});function createLegendGroup(dataCell,colorAxis){var isToggleVisible=colorAxis.option('LegendClickMode')==='togglevisible';var domainData=dataCell.domainData();if(!rootScene){rootScene=legendPanel._getBulletRootScene();}
var clickMode;if(isToggleVisible){var dataPartAtom=domainData.atoms[dataPartDimName];if(dataPartAtom&&dataPartAtom.value==='trend'){clickMode='none';}}
var groupScene=rootScene.createGroup({source:domainData,colorAxis:colorAxis,clickMode:clickMode,extensionPrefix:pvc.buildIndexedId('',legendIndex++)});dataCell.legendBulletGroupScene=groupScene;dataCell.domainItemDatas().each(function(itemData){var itemScene=groupScene.createItem({source:itemData});var colorValue=dataCell.domainItemDataValue(itemData);itemScene.color=colorAxis.scale(colorValue);});}}});pvc.BaseChart.add({_updateSelectionSuspendCount:0,_lastSelectedDatums:null,clearSelections:function(){if(this.data.owner.clearSelected()){this.updateSelections();}
return this;},_updatingSelections:function(method,context){this._suspendSelectionUpdate();try{method.call(context||this);}
finally{this._resumeSelectionUpdate();}},_suspendSelectionUpdate:function(){if(this===this.root){this._updateSelectionSuspendCount++;}
else{this.root._suspendSelectionUpdate();}},_resumeSelectionUpdate:function(){if(this===this.root){if(this._updateSelectionSuspendCount>0){if(!(--this._updateSelectionSuspendCount)){this.updateSelections();}}}else{this.root._resumeSelectionUpdate();}},updateSelections:function(keyArgs){if(this===this.root){if(this._inUpdateSelections||this._updateSelectionSuspendCount){return this;}
var selectedChangedDatumMap=this._calcSelectedChangedDatums();if(!selectedChangedDatumMap){return this;}
pvc.removeTipsyLegends();this._inUpdateSelections=true;try{var action=this.options.selectionChangedAction;if(action){var selectedDatums=this.data.selectedDatums();var selectedChangedDatums=selectedChangedDatumMap.values();action.call(this.basePanel.context(),selectedDatums,selectedChangedDatums);}
if(def.get(keyArgs,'render',true)){this.useTextMeasureCache(function(){this.basePanel.renderInteractive();},this);}}finally{this._inUpdateSelections=false;}}else{this.root.updateSelections();}
return this;},_calcSelectedChangedDatums:function(){if(!this.data){return;}
var selectedChangedDatums;var nowSelectedDatums=this.data.selectedDatumMap();var lastSelectedDatums=this._lastSelectedDatums;if(!lastSelectedDatums){if(!nowSelectedDatums.count){return;}
selectedChangedDatums=nowSelectedDatums.clone();}else{selectedChangedDatums=lastSelectedDatums.symmetricDifference(nowSelectedDatums);if(!selectedChangedDatums.count){return;}}
this._lastSelectedDatums=nowSelectedDatums;return selectedChangedDatums;},_onUserSelection:function(datums){if(!datums||!datums.length){return datums;}
if(this===this.root){var action=this.options.userSelectionAction;return action?(action.call(null,datums)||datums):datums;}
return this.root._onUserSelection(datums);}});pvc.BaseChart.add({_processExtensionPoints:function(){var components;if(!this.parent){var points=this.options.extensionPoints;components={};if(points){for(var p in points){var id,prop;var splitIndex=p.indexOf("_");if(splitIndex>0){id=p.substring(0,splitIndex);prop=p.substr(splitIndex+1);if(id&&prop){var component=def.getOwn(components,id)||(components[id]=new def.OrderedMap());component.add(prop,points[p]);}}}}}else{components=this.parent._components;}
this._components=components;},extend:function(mark,ids,keyArgs){if(def.array.is(ids)){ids.forEach(function(id){this._extendCore(mark,id,keyArgs);},this);}else{this._extendCore(mark,ids,keyArgs);}},_extendCore:function(mark,id,keyArgs){if(mark){var component=def.getOwn(this._components,id);if(component){if(mark.borderPanel){mark=mark.borderPanel;}
var logOut=pvc.debug>=3?[]:null;var constOnly=def.get(keyArgs,'constOnly',false);var wrap=mark.wrap;var keyArgs2={tag:pvc.extensionTag};var isRealMark=mark instanceof pv_Mark;component.forEach(function(v,m){if(mark.isLocked&&mark.isLocked(m)){if(logOut){logOut.push(m+": locked extension point!");}}else if(mark.isIntercepted&&mark.isIntercepted(m)){if(logOut){logOut.push(m+":"+pvc.stringify(v)+" (controlled)");}}else{if(logOut){logOut.push(m+": "+pvc.stringify(v));}
if(v!=null){var type=typeof v;if(type==='object'){if(m==='svg'||m==='css'){var v2=mark.propertyValue(m);if(v2){v=def.copy(v2,v);}}}else if(isRealMark&&(wrap||constOnly)&&type==='function'){if(constOnly){return;}
if(m!=='add'){v=wrap.call(mark,v,m);}}}
if(typeof mark[m]==="function"){if(m!='add'&&mark.intercept){mark.intercept(m,v,keyArgs2);}else{mark[m](v);}}else{mark[m]=v;}}});if(logOut){if(logOut.length){this._log("Applying Extension Points for: '"+id+"'\n\t* "+logOut.join("\n\t* "));}else if(pvc.debug>=5){this._log("No Extension Points for: '"+id+"'");}}}}else if(pvc.debug>=4){this._log("Applying Extension Points for: '"+id+"' (target mark does not exist)");}},_getExtension:function(id,prop){var component;if(!def.array.is(id)){component=def.getOwn(this._components,id);if(component){return component.get(prop);}}else{var i=id.length-1,value;while(i>=0){component=def.getOwn(this._components,id[i--]);if(component&&(value=component.get(prop))!==undefined){return value;}}}},_getComponentExtensions:function(id){return def.getOwn(this._components,id);},_getConstantExtension:function(id,prop){var value=this._getExtension(id,prop);if(!def.fun.is(value)){return value;}}});def.type('pvc.BasePanel',pvc.Abstract).add(pvc.visual.Interactive).init(function(chart,parent,options){this.chart=chart;this.base();this.axes={};if(options){if(options.scenes){this._sceneTypeExtensions=options.scenes;delete options.scenes;}
var axes=options.axes;if(axes){def.copy(this.axes,axes);delete options.axes;}}
$.extend(this,options);if(!this.axes.color){this.axes.color=chart.axes.color;}
this.position={};var margins=options&&options.margins;if(!parent&&margins===undefined){margins=3;}
this.margins=new pvc_Sides(margins);this.paddings=new pvc_Sides(options&&options.paddings);this.size=new pvc_Size(options&&options.size);this.sizeMax=new pvc_Size(options&&options.sizeMax);if(!parent){this.parent=null;this.root=this;this.topRoot=this;this.isRoot=true;this.isTopRoot=true;this._ibits=chart._ibits;}else{this.parent=parent;this.isTopRoot=false;this.isRoot=(parent.chart!==chart);this.root=this.isRoot?this:parent.root;this.topRoot=parent.topRoot;this._ibits=parent._ibits;if(this.isRoot){this.position.left=chart.left;this.position.top=chart.top;}
parent._addChild(this);}
this.data=(this.isRoot?chart:parent).data;if(this.isRoot){this.anchor=null;this.align=null;this.alignTo=null;this.offset=null;}else{this.align=pvc.parseAlign(this.anchor,this.align);var alignTo=this.alignTo;var side=this.anchor;if(alignTo!=null&&alignTo!==''&&(side==='left'||side==='right')){if(alignTo!=='page-middle'){if(!isNaN(+alignTo.charAt(0))){alignTo=pvc_PercentValue.parse(alignTo);}else{alignTo=pvc.parseAlign(side,alignTo);}}}else{alignTo=this.align;}
this.alignTo=alignTo;this.offset=new pvc_Offset(this.offset);}
if(this.borderWidth==null){var borderWidth;var extensionId=this._getExtensionId();if(extensionId){var strokeStyle=this._getExtension(extensionId,'strokeStyle');if(strokeStyle!=null){borderWidth=+this._getConstantExtension(extensionId,'lineWidth');if(isNaN(borderWidth)||!isFinite(borderWidth)){borderWidth=null;}}}
this.borderWidth=borderWidth==null?0:1.5;}
var I=pvc.visual.Interactive;var ibits=this._ibits;ibits=def.bit.set(ibits,I.Clickable,(chart._ibits&I.Clickable)&&!!this.clickAction);ibits=def.bit.set(ibits,I.DoubleClickable,(chart._ibits&I.DoubleClickable)&&!!this.doubleClickAction);this._ibits=ibits;}).add({chart:null,parent:null,_children:null,type:pv.Panel,_extensionPrefix:'',_rubberSelectableMarks:null,height:null,width:null,borderWidth:null,anchor:"top",pvPanel:null,margins:null,paddings:null,isRoot:false,isTopRoot:false,root:null,topRoot:null,_layoutInfo:null,_signs:null,data:null,dataPartValue:null,_animating:0,_selectingByRubberband:false,_v1DimRoleName:{'series':'series','category':'category','value':'value'},_sceneTypeExtensions:null,clickAction:null,doubleClickAction:null,compatVersion:function(options){return this.chart.compatVersion(options);},_createLogInstanceId:function(){return""+
this.constructor+this.chart._createLogChildSuffix();},defaultVisibleBulletGroupScene:function(){var colorAxis=this.axes.color;if(colorAxis&&colorAxis.option('LegendVisible')){var dataPartValue=this.dataPartValue;return def.query(colorAxis.dataCells).where(function(dataCell){return dataCell.dataPartValue===dataPartValue;}).select(function(dataCell){return dataCell.legendBulletGroupScene;}).first(def.truthy);}
return null;},_getLegendBulletRootScene:function(){return this.chart._getLegendBulletRootScene();},_addChild:function(child){child.parent===this||def.assert("Child has a != parent.");(this._children||(this._children=[])).push(child);},_addSign:function(sign){def.array.lazy(this,'_signs').push(sign);if(sign.selectableByRubberband()){def.array.lazy(this,'_rubberSelectableMarks').push(sign.pvMark);}},visibleData:function(ka){return this.chart.visibleData(this.dataPartValue,ka);},partData:function(){return this.chart.partData(this.dataPartValue);},layout:function(availableSize,ka){if(!this._layoutInfo||def.get(ka,'force',false)){var referenceSize=def.get(ka,'referenceSize');if(!referenceSize&&availableSize){referenceSize=def.copyOwn(availableSize);}
var desiredSize=this.size.resolve(referenceSize);var sizeMax=this.sizeMax.resolve(referenceSize);if(!availableSize){if(desiredSize.width==null||desiredSize.height==null){throw def.error.operationInvalid("Panel layout without width or height set.");}
availableSize=def.copyOwn(desiredSize);}
if(!referenceSize&&availableSize){referenceSize=def.copyOwn(availableSize);}
if(sizeMax.width!=null&&availableSize.width>sizeMax.width){availableSize.width=sizeMax.width;}
if(sizeMax.height!=null&&availableSize.height>sizeMax.height){availableSize.height=sizeMax.height;}
var halfBorder=this.borderWidth/2;var realMargins=(def.get(ka,'margins')||this.margins).resolve(referenceSize);var realPaddings=(def.get(ka,'paddings')||this.paddings).resolve(referenceSize);var margins=pvc_Sides.inflate(realMargins,halfBorder);var paddings=pvc_Sides.inflate(realPaddings,halfBorder);var spaceWidth=margins.width+paddings.width;var spaceHeight=margins.height+paddings.height;var availableClientSize=new pvc_Size(Math.max(availableSize.width-spaceWidth,0),Math.max(availableSize.height-spaceHeight,0));var desiredClientSize=def.copyOwn(desiredSize);if(desiredClientSize.width!=null){desiredClientSize.width=Math.max(desiredClientSize.width-spaceWidth,0);}
if(desiredClientSize.height!=null){desiredClientSize.height=Math.max(desiredClientSize.height-spaceHeight,0);}
var prevLayoutInfo=this._layoutInfo||null;var canChange=def.get(ka,'canChange',true);var layoutInfo=this._layoutInfo={canChange:canChange,referenceSize:referenceSize,realMargins:realMargins,realPaddings:realPaddings,borderWidth:this.borderWidth,margins:margins,paddings:paddings,desiredClientSize:desiredClientSize,clientSize:availableClientSize,pageClientSize:prevLayoutInfo?prevLayoutInfo.pageClientSize:availableClientSize.clone(),previous:prevLayoutInfo};if(prevLayoutInfo){delete prevLayoutInfo.previous;delete prevLayoutInfo.pageClientSize;}
var clientSize=this._calcLayout(layoutInfo);var size;if(!clientSize){size=availableSize;clientSize=availableClientSize;}else{layoutInfo.clientSize=clientSize;size={width:clientSize.width+spaceWidth,height:clientSize.height+spaceHeight};}
this.isVisible=(clientSize.width>0&&clientSize.height>0);delete layoutInfo.desiredClientSize;this.width=size.width;this.height=size.height;if(!canChange&&prevLayoutInfo){delete layoutInfo.previous;}
if(pvc.debug>=5){this._log("Size       = "+pvc.stringify(size));this._log("Margins    = "+pvc.stringify(layoutInfo.margins));this._log("Paddings   = "+pvc.stringify(layoutInfo.paddings));this._log("ClientSize = "+pvc.stringify(layoutInfo.clientSize));}
this._onLaidOut();}},_onLaidOut:function(){if(this.isRoot){this.chart._onLaidOut();}},_calcLayout:function(layoutInfo){var clientSize;var me=this;var margins,remSize,useLog;if(me._children){var aolMap=pvc.BasePanel.orthogonalLength;var aoMap=pvc.BasePanel.relativeAnchor;var altMap=pvc.BasePanel.leftTopAnchor;var aofMap=pvc_Offset.namesSidesToOffset;var fillChildren=[];var sideChildren=[];me._children.forEach(function(child){var a=child.anchor;if(a){if(a==='fill'){fillChildren.push(child);}else{def.hasOwn(aoMap,a)||def.fail.operationInvalid("Unknown anchor value '{0}'",[a]);sideChildren.push(child);}}});useLog=pvc.debug>=5;clientSize=def.copyOwn(layoutInfo.clientSize);var childKeyArgs={force:true,referenceSize:clientSize};if(useLog){me._group("CCC DOCK LAYOUT clientSize = "+pvc.stringify(clientSize));}
try{doMaxTimes(5,layoutCycle,me);}finally{if(useLog){me._groupEnd();}}}
return clientSize;function doMaxTimes(maxTimes,fun,ctx){var index=0;while(maxTimes--){if(fun.call(ctx,maxTimes,index)===false){return true;}
index++;}
return false;}
function layoutCycle(remTimes,iteration){if(useLog){me._group("LayoutCycle #"+(iteration+1)+" (remaining: "+remTimes+")");}
try{var canResize=(remTimes>0);margins=new pvc_Sides(0);remSize=def.copyOwn(clientSize);var child;var index=0;var count=sideChildren.length;while(index<count){child=sideChildren[index];if(useLog){me._group("SIDE Child #"+(index+1)+" at "+child.anchor);}
try{if(layoutChild.call(this,child,canResize)){return true;}}finally{if(useLog){me._groupEnd();}}
index++;}
index=0;count=fillChildren.length;while(index<count){child=fillChildren[index];if(useLog){me._group("FILL Child #"+(index+1));}
try{if(layoutChild.call(this,child,canResize)){return true;}}finally{if(useLog){me._groupEnd();}}
index++;}
return false;}finally{if(useLog){me._groupEnd();}}}
function layoutChild(child,canResize){var resized=false;var paddings;childKeyArgs.canChange=canResize;doMaxTimes(3,function(remTimes,iteration){if(useLog){me._group("Attempt #"+(iteration+1));}
try{childKeyArgs.paddings=paddings;childKeyArgs.canChange=remTimes>0;child.layout(new pvc_Size(remSize),childKeyArgs);if(child.isVisible){resized=checkChildResize.call(this,child,canResize);if(resized){return false;}
var requestPaddings=child._layoutInfo.requestPaddings;if(checkPaddingsChanged(paddings,requestPaddings)){paddings=requestPaddings;if(remTimes>0){paddings=new pvc_Sides(paddings);if(useLog){this._log("Child requested paddings change: "+pvc.stringify(paddings));}
return true;}
if(pvc.debug>=2){this._warn("Child requests paddings change but iterations limit has been reached.");}}
positionChild.call(this,child);if(child.anchor!=='fill'){updateSide.call(this,child);}}
return false;}finally{if(useLog){me._groupEnd();}}},this);return resized;}
function checkPaddingsChanged(paddings,newPaddings){if(!newPaddings){return false;}
return def.query(pvc_Sides.names).each(function(side){var curPad=(paddings&&paddings[side])||0;var newPad=(newPaddings&&newPaddings[side])||0;if(Math.abs(newPad-curPad)>=0.1){return false;}});}
function checkChildResize(child,canResize){var resized=false;var addWidth=child.width-remSize.width;if(addWidth>0){if(pvc.debug>=3){this._log("Child added width = "+addWidth);}
if(!canResize){if(pvc.debug>=2){this._warn("Child wanted more width, but layout iterations limit has been reached.");}}else{resized=true;remSize.width+=addWidth;clientSize.width+=addWidth;}}
var addHeight=child.height-remSize.height;if(addHeight>0){if(pvc.debug>=3){this._log("Child added height ="+addHeight);}
if(!canResize){if(pvc.debug>=2){this._warn("Child wanted more height, but layout iterations limit has been reached.");}}else{resized=true;remSize.height+=addHeight;clientSize.height+=addHeight;}}
return resized;}
function positionChild(child){var side=child.anchor;var align=child.align;var alignTo=child.alignTo;var sidePos;if(side==='fill'){side='left';sidePos=margins.left+remSize.width/2-(child.width/2);align=alignTo='middle';}else{sidePos=margins[side];}
var sideo,sideOPosChildOffset;switch(align){case'top':case'bottom':case'left':case'right':sideo=align;sideOPosChildOffset=0;break;case'center':case'middle':sideo=altMap[aoMap[side]];sideOPosChildOffset=-child[aolMap[sideo]]/2;break;}
var sideOPosParentOffset;var sideOTo;switch(alignTo){case'top':case'bottom':case'left':case'right':sideOTo=alignTo;sideOPosParentOffset=(sideOTo!==sideo)?remSize[aolMap[sideo]]:0;break;case'center':case'middle':sideOTo=altMap[aoMap[side]];sideOPosParentOffset=remSize[aolMap[sideo]]/2;break;case'page-center':case'page-middle':sideOTo=altMap[aoMap[side]];var lenProp=aolMap[sideo];var pageLen=Math.min(remSize[lenProp],layoutInfo.pageClientSize[lenProp]);sideOPosParentOffset=pageLen/2;break;}
var sideOPos=margins[sideOTo]+sideOPosParentOffset+sideOPosChildOffset;var resolvedOffset=child.offset.resolve(remSize);if(resolvedOffset){sidePos+=resolvedOffset[aofMap[side]]||0;sideOPos+=resolvedOffset[aofMap[sideo]]||0;}
if(child.keepInBounds){if(sidePos<0){sidePos=0;}
if(sideOPos<0){sideOPos=0;}}
child.setPosition(def.set({},side,sidePos,sideo,sideOPos));}
function updateSide(child){var side=child.anchor;var sideol=aolMap[side];var olen=child[sideol];margins[side]+=olen;remSize[sideol]-=olen;}},invalidateLayout:function(){this._layoutInfo=null;if(this._children){this._children.forEach(function(child){child.invalidateLayout();});}},_create:function(force){if(!this.pvPanel||force){this.pvPanel=null;delete this._signs;this.layout();if(!this.isVisible){return;}
if(this.isRoot){this._creating();}
var margins=this._layoutInfo.margins;var paddings=this._layoutInfo.paddings;if(this.isTopRoot){this.pvRootPanel=this.pvPanel=new pv.Panel().canvas(this.chart.options.canvas);var scene=new pvc.visual.Scene(null,{panel:this});this.pvRootPanel.lock('data',[scene]);if(margins.width>0||margins.height>0){this.pvPanel.width(this.width).height(this.height);this.pvPanel=this.pvPanel.add(pv.Panel);}}else{this.pvPanel=this.parent.pvPanel.add(this.type);}
var pvBorderPanel=this.pvPanel;var width=this.width-margins.width;var height=this.height-margins.height;pvBorderPanel.width(width).height(height);if(pvc.debug>=15&&(margins.width>0||margins.height>0)){(this.isTopRoot?this.pvRootPanel:this.parent.pvPanel).add(this.type).width(this.width).height(this.height).left(this.position.left!=null?this.position.left:null).right(this.position.right!=null?this.position.right:null).top(this.position.top!=null?this.position.top:null).bottom(this.position.bottom!=null?this.position.bottom:null).strokeStyle('orange').lineWidth(1).strokeDasharray('- .');}
var hasPositions={};def.eachOwn(this.position,function(v,side){pvBorderPanel[side](v+margins[side]);hasPositions[this.anchorLength(side)]=true;},this);if(!hasPositions.width){if(margins.left>0){pvBorderPanel.left(margins.left);}
if(margins.right>0){pvBorderPanel.right(margins.right);}}
if(!hasPositions.height){if(margins.top>0){pvBorderPanel.top(margins.top);}
if(margins.bottom>0){pvBorderPanel.bottom(margins.bottom);}}
if(paddings.width>0||paddings.height>0){this.pvPanel=pvBorderPanel.add(pv.Panel).width(width-paddings.width).height(height-paddings.height).left(paddings.left).top(paddings.top);}
pvBorderPanel.borderPanel=pvBorderPanel;pvBorderPanel.paddingPanel=this.pvPanel;this.pvPanel.paddingPanel=this.pvPanel;this.pvPanel.borderPanel=pvBorderPanel;if(pvc.debug>=15){this.pvPanel.strokeStyle('lightgreen').lineWidth(1).strokeDasharray('- ');if(this.pvPanel!==pvBorderPanel){pvBorderPanel.strokeStyle('blue').lineWidth(1).strokeDasharray('. ');}}
var extensionId=this._getExtensionId();new pvc.visual.Panel(this,null,{panel:pvBorderPanel,extensionId:extensionId});this._createCore(this._layoutInfo);if(this.isTopRoot){this._initRubberBand();}
this.applyExtensions();if(this.isRoot&&pvc.debug>5){var out=["SCALES SUMMARY",pvc.logSeparator];this.chart.axesList.forEach(function(axis){var scale=axis.scale;if(scale){var d=scale.domain&&scale.domain();var r=scale.range&&scale.range();out.push(axis.id);out.push("    domain: "+(!d?'?':pvc.stringify(d)));out.push("    range : "+(!r?'?':pvc.stringify(r)));}},this);this._log(out.join("\n"));}}},_creating:function(){if(this._children){this._children.forEach(function(child){child._creating();});}},_createCore:function(){if(this._children){this._children.forEach(function(child){child._create();});}},render:function(ka){if(!this.isTopRoot){return this.topRoot.render(ka);}
this._create(def.get(ka,'recreate',false));if(!this.isVisible){return;}
this._onRender();var options=this.chart.options;var pvPanel=this.pvRootPanel;var animate=this.chart.animatable();this._animating=animate&&!def.get(ka,'bypassAnimation',false)?1:0;try{pvPanel.render();if(this._animating){this._animating=2;var me=this;pvPanel.transition().duration(2000).ease("cubic-in-out").start(function(){me._animating=0;me._onRenderEnd(true);});}else{this._onRenderEnd(false);}}finally{this._animating=0;}},_onRender:function(){var renderCallback=this.chart.options.renderCallback;if(renderCallback){if(this.compatVersion()<=1){renderCallback.call(this.chart);}else{var context=this.context();renderCallback.call(context,context.scene);}}},_onRenderEnd:function(animated){if(this._children){this._children.forEach(function(child){child._onRenderEnd(animated);});}},renderInteractive:function(){if(this.isVisible){var pvMarks=this._getSelectableMarks();if(pvMarks&&pvMarks.length){pvMarks.forEach(function(pvMark){pvMark.render();});}else if(!this._children){this.pvPanel.render();return;}
if(this._children){this._children.forEach(function(child){child.renderInteractive();});}}},_getSelectableMarks:function(){return this._rubberSelectableMarks;},animate:function(start,end){return(this.topRoot._animating===1)?start:end;},animatingStart:function(){return(this.topRoot._animating===1);},animating:function(){return(this.topRoot._animating>0);},setPosition:function(position){for(var side in position){if(def.hasOwn(pvc_Sides.namesSet,side)){var s=position[side];if(s===null){delete this.position[side];}else{s=+s;if(!isNaN(s)&&isFinite(s)){this.position[side]=s;}}}}},createAnchoredSize:function(anchorLength,size){if(this.isAnchorTopOrBottom()){return new pvc_Size(size.width,Math.min(size.height,anchorLength));}
return new pvc_Size(Math.min(size.width,anchorLength),size.height);},applyExtensions:function(){if(this._signs){this._signs.forEach(function(sign){sign.applyExtensions();});}},extend:function(mark,id,ka){this.chart.extend(mark,this._makeExtensionAbsId(id),ka);},extendAbs:function(mark,absId,ka){this.chart.extend(mark,absId,ka);},_extendSceneType:function(typeKey,type,names){var typeExts=def.get(this._sceneTypeExtensions,typeKey);if(typeExts){pvc.extendType(type,typeExts,names);}},_absBaseExtId:{abs:'base'},_absSmallBaseExtId:{abs:'smallBase'},_getExtensionId:function(){if(this.isRoot){return!this.chart.parent?this._absBaseExtId:this._absSmallBaseExtId;}},_getExtensionPrefix:function(){return this._extensionPrefix;},_makeExtensionAbsId:function(id){return pvc.makeExtensionAbsId(id,this._getExtensionPrefix());},_getExtension:function(id,prop){return this.chart._getExtension(this._makeExtensionAbsId(id),prop);},_getExtensionAbs:function(absId,prop){return this.chart._getExtension(absId,prop);},_getConstantExtension:function(id,prop){return this.chart._getConstantExtension(this._makeExtensionAbsId(id),prop);},getPvPanel:function(layer){var mainPvPanel=this.pvPanel;if(!layer){return mainPvPanel;}
if(!this.parent){throw def.error.operationInvalid("Layers are not possible in a root panel.");}
if(!mainPvPanel){throw def.error.operationInvalid("Cannot access layer panels without having created the main panel.");}
var pvPanel=null;if(!this._layers){this._layers={};}else{pvPanel=this._layers[layer];}
if(!pvPanel){var pvParentPanel=this.parent.pvPanel;pvPanel=pvParentPanel.borderPanel.add(this.type).extend(mainPvPanel.borderPanel);var pvBorderPanel=pvPanel;if(mainPvPanel!==mainPvPanel.borderPanel){pvPanel=pvBorderPanel.add(pv.Panel).extend(mainPvPanel);}
pvBorderPanel.borderPanel=pvBorderPanel;pvBorderPanel.paddingPanel=pvPanel;pvPanel.paddingPanel=pvPanel;pvPanel.borderPanel=pvBorderPanel;this.initLayerPanel(pvPanel,layer);this._layers[layer]=pvPanel;}
return pvPanel;},initLayerPanel:function(){},_getV1DimName:function(v1Dim){var dimNames=this._v1DimName||(this._v1DimNameCache={});var dimName=dimNames[v1Dim];if(dimName==null){var role=this.chart.visualRoles[this._v1DimRoleName[v1Dim]];dimName=role?role.firstDimensionName():'';dimNames[v1Dim]=dimName;}
return dimName;},_getV1Datum:function(scene){return scene.datum;},context:function(){var context=this._context;if(!context||context.isPinned){context=this._context=new pvc.visual.Context(this);}else{visualContext_update.call(context);}
return context;},_isTooltipEnabled:function(){return!this.selectingByRubberband()&&!this.animating();},_getTooltipFormatter:function(tipOptions){var isV1Compat=this.compatVersion()<=1;var tooltipFormat=tipOptions.format;if(!tooltipFormat){if(!isV1Compat){return this._summaryTooltipFormatter;}
tooltipFormat=this.chart.options.v1StyleTooltipFormat;if(!tooltipFormat){return;}}
if(isV1Compat){return function(context){return tooltipFormat.call(context.panel,context.getV1Series(),context.getV1Category(),context.getV1Value()||'',context.getV1Datum());};}
return function(context){return tooltipFormat.call(context,context.scene);};},_summaryTooltipFormatter:function(context){var scene=context.scene;if(!scene.datum){return"";}
var group=scene.group;var isMultiDatumGroup=group&&group.count()>1;var firstDatum=scene.datum;if(!isMultiDatumGroup&&(!firstDatum||firstDatum.isNull)){return"";}
var data=scene.data();var visibleKeyArgs={visible:true};var tooltip=[];if(firstDatum.isInterpolated){tooltip.push('<i>Interpolation</i>: '+def.html.escape(firstDatum.interpolation)+'<br/>');}else if(firstDatum.isTrend){tooltip.push('<i>Trend</i>: '+def.html.escape(firstDatum.trendType)+'<br/>');}
var complexType=data.type;var playingPercentMap=context.panel.stacked===false?null:complexType.getPlayingPercentVisualRoleDimensionMap();var percentValueFormat=playingPercentMap?context.chart.options.percentValueFormat:null;var commonAtoms=isMultiDatumGroup?group.atoms:scene.datum.atoms;var commonAtomsKeys=complexType.sortDimensionNames(def.keys(commonAtoms));function addDim(escapedDimLabel,label){tooltip.push('<b>'+escapedDimLabel+"</b>: "+(def.html.escape(label)||" - ")+'<br/>');}
function calcPercent(atom,dimName){var pct;if(group){pct=group.dimensions(dimName).percentOverParent(visibleKeyArgs);}else{pct=data.dimensions(dimName).percent(atom.value,visibleKeyArgs);}
return percentValueFormat(pct);}
var anyCommonAtom=false;commonAtomsKeys.forEach(function(dimName){var atom=commonAtoms[dimName];var dimType=atom.dimension.type;if(!dimType.isHidden){if(!isMultiDatumGroup||atom.value!=null){anyCommonAtom=true;var valueLabel=atom.label;if(playingPercentMap&&playingPercentMap.has(dimName)){valueLabel+=" ("+calcPercent(atom,dimName)+")";}
addDim(def.html.escape(atom.dimension.type.label),valueLabel);}}});if(isMultiDatumGroup){if(anyCommonAtom){tooltip.push('<hr />');}
tooltip.push("<b>#</b>: "+group._datums.length+'<br/>');complexType.sortDimensionNames(group.freeDimensionNames()).forEach(function(dimName){var dim=group.dimensions(dimName);if(!dim.type.isHidden){var dimLabel=def.html.escape(dim.type.label),valueLabel;if(dim.type.valueType===Number){valueLabel=dim.format(dim.sum(visibleKeyArgs));if(playingPercentMap&&playingPercentMap.has(dimName)){valueLabel+=" ("+calcPercent(null,dimName)+")";}
dimLabel="&sum; "+dimLabel;}else{valueLabel=dim.atoms(visibleKeyArgs).map(function(atom){return atom.label||"- ";}).join(", ");}
addDim(dimLabel,valueLabel);}});}
return'<div style="text-align: left;">'+tooltip.join('\n')+'</div>';},_onClick:function(context){var handler=this.clickAction;if(handler){if(this.compatVersion()<=1){this._onV1Click(context,handler);}else{handler.call(context,context.scene);}}},_onDoubleClick:function(context){var handler=this.doubleClickAction;if(handler){if(this.compatVersion()<=1){this._onV1DoubleClick(context,handler);}else{handler.call(context,context.scene);}}},_onV1Click:function(context,handler){handler.call(context.pvMark,context.getV1Series(),context.getV1Category(),context.getV1Value(),context.event,context.getV1Datum());},_onV1DoubleClick:function(context,handler){handler.call(context.pvMark,context.getV1Series(),context.getV1Category(),context.getV1Value(),context.event,context.getV1Datum());},selectingByRubberband:function(){return this.topRoot._selectingByRubberband;},_initRubberBand:function(){var me=this,chart=me.chart;if(!chart.interactive()){return;}
var options=chart.options,clickClearsSelection=options.clearSelectionMode==='emptySpaceClick',useRubberband=this.chart.selectableByRubberband();if(!useRubberband&&!clickClearsSelection){return;}
var data=chart.data,pvParentPanel=me.pvRootPanel||me.pvPanel.paddingPanel;if(!me._getExtensionAbs('base','fillStyle')){pvParentPanel.fillStyle(pvc.invisibleFill);}
pvParentPanel.lock('events','all');if(!useRubberband){if(clickClearsSelection){pvParentPanel.event("click",function(){data.owner.clearSelected()&&chart.updateSelections();});}
return;}
var dMin2=4;this._selectingByRubberband=false;var toScreen,rb;var selectBar=this.selectBar=new pvc.visual.Bar(this,pvParentPanel,{extensionId:'rubberBand',normalStroke:true,noHover:true,noSelect:true,noClick:true,noDoubleClick:true,noTooltip:true}).override('defaultStrokeWidth',def.fun.constant(1.5)).override('defaultColor',function(type){return type==='stroke'?'#86fe00':'rgba(203, 239, 163, 0.6)';}).override('interactiveColor',function(color){return color;}).pvMark.lock('visible',function(){return!!rb;}).lock('left',function(){return rb.x;}).lock('right').lock('top',function(){return rb.y;}).lock('bottom').lock('width',function(){return rb.dx;}).lock('height',function(){return rb.dy;}).lock('cursor').lock('events','none');var selectionEndedDate;pvParentPanel.intercept('data',function(){var scenes=this.delegate();if(scenes){scenes.forEach(function(scene){if(scene.x==null){scene.x=scene.y=scene.dx=scene.dy=0;}});}
return scenes;}).event('mousedown',pv.Behavior.select().autoRender(false)).event('select',function(scene){if(!rb){if(me.animating()){return;}
if(scene.dx*scene.dx+scene.dy*scene.dy<=dMin2){return;}
rb=new pv.Shape.Rect(scene.x,scene.y,scene.dx,scene.dy);me._selectingByRubberband=true;if(!toScreen){toScreen=pvParentPanel.toScreenTransform();}
me.rubberBand=rb.apply(toScreen);}else{rb=new pv.Shape.Rect(scene.x,scene.y,scene.dx,scene.dy);}
selectBar.render();}).event('selectend',function(){if(rb){var ev=arguments[arguments.length-1];if(!toScreen){toScreen=pvParentPanel.toScreenTransform();}
var rbs=rb.apply(toScreen);rb=null;me._selectingByRubberband=false;selectBar.render();try{me._processRubberBand(rbs,ev,{allowAdditive:true});}
finally{selectionEndedDate=new Date();}}});if(clickClearsSelection){pvParentPanel.event("click",function(){if(selectionEndedDate){var timeSpan=new Date()-selectionEndedDate;if(timeSpan<300){selectionEndedDate=null;return;}}
if(data.owner.clearSelected()){chart.updateSelections();}});}},_processRubberBand:function(rb,ev,ka){this.rubberBand=rb;try{this._onRubberBandSelectionEnd(ev,ka);}
finally{this.rubberBand=null;}},_onRubberBandSelectionEnd:function(ev,ka){if(pvc.debug>=20){this._log("rubberBand "+pvc.stringify(this.rubberBand));}
ka=Object.create(ka||{});ka.toggle=false;var datums=this._getDatumsOnRubberBand(ev,ka);if(datums){var allowAdditive=def.get(ka,'allowAdditive',true);var chart=this.chart;chart._updatingSelections(function(){var clearBefore=!allowAdditive||(!ev.ctrlKey&&chart.options.ctrlSelectMode);if(clearBefore){chart.data.owner.clearSelected();pvc.data.Data.setSelected(datums,true);}else if(ka.toggle){pvc.data.Data.toggleSelected(datums);}else{pvc.data.Data.setSelected(datums,true);}});}},_getDatumsOnRubberBand:function(ev,ka){var datumMap=new def.Map();this._getDatumsOnRect(datumMap,this.rubberBand,ka);var datums=datumMap.values();if(datums.length){datums=this.chart._onUserSelection(datums);if(datums&&!datums.length){datums=null;}}
return datums;},_getDatumsOnRect:function(datumMap,rect,ka){this._getOwnDatumsOnRect(datumMap,rect,ka);var cs=this._children;if(cs){cs.forEach(function(c){c._getDatumsOnRect(datumMap,rect,ka);});}},_getOwnDatumsOnRect:function(datumMap,rect,ka){var me=this;if(!me.isVisible){return false;}
var pvMarks=me._getSelectableMarks();if(!pvMarks||!pvMarks.length){return false;}
var inCount=datumMap.count;var selectionMode=def.get(ka,'markSelectionMode');var processDatum=function(datum){if(!datum.isNull){datumMap.set(datum.id,datum);}};var processScene=function(scene){if(scene.selectableByRubberband()){scene.datums().each(processDatum);}};var processMark=function(pvMark){pvMark.eachSceneWithDataOnRect(rect,processScene,null,selectionMode);};pvMarks.forEach(processMark);return inCount<datumMap.count;},isAnchorTopOrBottom:function(anchor){if(!anchor){anchor=this.anchor;}
return anchor==="top"||anchor==="bottom";},isOrientationVertical:function(o){return this.chart.isOrientationVertical(o);},isOrientationHorizontal:function(o){return this.chart.isOrientationHorizontal(o);}}).addStatic({relativeAnchor:{top:"left",bottom:"left",left:"bottom",right:"bottom"},leftBottomAnchor:{top:"bottom",bottom:"bottom",left:"left",right:"left"},leftTopAnchor:{top:"top",bottom:"top",left:"left",right:"left"},horizontalAlign:{top:"right",bottom:"left",middle:"center",right:"right",left:"left",center:"center"},verticalAlign:{top:"top",bottom:"bottom",middle:"middle",right:"bottom",left:"top",center:"middle"},verticalAlign2:{top:"top",bottom:"bottom",middle:"middle",right:"top",left:"bottom",center:"middle"},relativeAnchorMirror:{top:"right",bottom:"right",left:"top",right:"top"},oppositeAnchor:{top:"bottom",bottom:"top",left:"right",right:"left"},parallelLength:{top:"width",bottom:"width",right:"height",left:"height"},orthogonalLength:{top:"height",bottom:"height",right:"width",left:"width"},oppositeLength:{width:"height",height:"width"}});def.scope(function(){var BasePanel=pvc.BasePanel;var methods={};var anchorDicts={anchorOrtho:'relativeAnchor',anchorOrthoMirror:'relativeAnchorMirror',anchorOpposite:'oppositeAnchor',anchorLength:'parallelLength',anchorOrthoLength:'orthogonalLength'};def.eachOwn(anchorDicts,function(d,am){var dict=BasePanel[d];methods[am]=function(a){return dict[a||this.anchor];};});BasePanel.add(methods);});def.type('pvc.PlotPanel',pvc.BasePanel).init(function(chart,parent,plot,options){this.base(chart,parent,options);this.plot=plot;this._extensionPrefix=plot.extensionPrefixes;this.dataPartValue=plot.option('DataPart');this.axes.color=chart._getAxis('color',(plot.option('ColorAxis')||0)-1);this.orientation=plot.option('Orientation');this.valuesVisible=plot.option('ValuesVisible');this.valuesAnchor=plot.option('ValuesAnchor');this.valuesMask=plot.option('ValuesMask');this.valuesFont=plot.option('ValuesFont');this.valuesOptimizeLegibility=plot.option('ValuesOptimizeLegibility');var roles=this.visualRoles=Object.create(chart.visualRoles);var colorRoleName=plot.option('ColorRole');roles.color=colorRoleName?chart.visualRole(colorRoleName):null;this.chart._addPlotPanel(this);}).add({anchor:'fill',visualRoles:null,_getExtensionId:function(){var extensionIds=['chart','plot'];if(this.plotName){extensionIds.push(this.plotName);}
return extensionIds;},isOrientationVertical:function(){return this.orientation===pvc.orientation.vertical;},isOrientationHorizontal:function(){return this.orientation===pvc.orientation.horizontal;}});def.type('pvc.MultiChartPanel',pvc.BasePanel).add({anchor:'fill',_multiInfo:null,createSmallCharts:function(){var chart=this.chart;var options=chart.options;var multiChartMax=Number(options.multiChartMax);if(isNaN(multiChartMax)||multiChartMax<1){multiChartMax=Infinity;}
var multiChartRole=chart.visualRoles.multiChart;var data=multiChartRole.flatten(chart.data,{visible:true});var leafCount=data._children.length;var count=Math.min(leafCount,multiChartMax);if(count===0){return;}
var multiChartColumnsMax=+options.multiChartColumnsMax;if(isNaN(multiChartColumnsMax)||multiChartMax<1){multiChartColumnsMax=3;}
var colCount=Math.min(count,multiChartColumnsMax);colCount>=1&&isFinite(colCount)||def.assert("Must be at least 1 and finite");var rowCount=Math.ceil(count/colCount);rowCount>=1||def.assert("Must be at least 1");var coordRootAxesByScopeType=this._getCoordinatedRootAxesByScopeType();var coordScopesByType,addChartToScope,indexChartByScope;if(coordRootAxesByScopeType){coordScopesByType={};addChartToScope=function(childChart,scopeType,scopeIndex){var scopes=def.array.lazy(coordScopesByType,scopeType);def.array.lazy(scopes,scopeIndex).push(childChart);};indexChartByScope=function(childChart){if(coordRootAxesByScopeType.row){addChartToScope(childChart,'row',childChart.smallRowIndex);}
if(coordRootAxesByScopeType.column){addChartToScope(childChart,'column',childChart.smallColIndex);}
if(coordRootAxesByScopeType.global){addChartToScope(childChart,'global',0);}};}
var childOptionsBase=this._buildSmallChartsBaseOptions();var ChildClass=chart.constructor;for(var index=0;index<count;index++){var childData=data._children[index];var colIndex=(index%colCount);var rowIndex=Math.floor(index/colCount);var childOptions=def.set(Object.create(childOptionsBase),'smallColIndex',colIndex,'smallRowIndex',rowIndex,'title',childData.absLabel,'data',childData);var childChart=new ChildClass(childOptions);if(!coordRootAxesByScopeType){childChart._preRender();}else{childChart._preRenderPhase1();indexChartByScope(childChart);}}
if(coordRootAxesByScopeType){def.eachOwn(coordRootAxesByScopeType,function(axes,scopeType){axes.forEach(function(axis){coordScopesByType[scopeType].forEach(function(scopeCharts){this._coordinateScopeAxes(axis.id,scopeCharts);},this);},this);},this);chart.children.forEach(function(childChart){childChart._preRenderPhase2();});}
this._multiInfo={data:data,count:count,rowCount:rowCount,colCount:colCount,multiChartColumnsMax:multiChartColumnsMax,coordScopesByType:coordScopesByType};},_getCoordinatedRootAxesByScopeType:function(){var hasCoordination=false;var rootAxesByScopeType=def.query(this.chart.axesList).multipleIndex(function(axis){if(axis.scaleType!=='discrete'&&axis.option.isDefined('DomainScope')){var scopeType=axis.option('DomainScope');if(scopeType!=='cell'){hasCoordination=true;return scopeType;}}});return hasCoordination?rootAxesByScopeType:null;},_coordinateScopeAxes:function(axisId,scopeCharts){var unionExtent=def.query(scopeCharts).select(function(childChart){var scale=childChart.axes[axisId].scale;if(!scale.isNull){var domain=scale.domain();return{min:domain[0],max:domain[1]};}}).reduce(pvc.unionExtents,null);if(unionExtent){scopeCharts.forEach(function(childChart){var axis=childChart.axes[axisId];var scale=axis.scale;if(!scale.isNull){scale.domain(unionExtent.min,unionExtent.max);axis.setScale(scale);}});}},_buildSmallChartsBaseOptions:function(){var chart=this.chart;var options=chart.options;return def.set(Object.create(options),'parent',chart,'legend',false,'titleFont',options.smallTitleFont,'titlePosition',options.smallTitlePosition,'titleAlign',options.smallTitleAlign,'titleAlignTo',options.smallTitleAlignTo,'titleOffset',options.smallTitleOffset,'titleKeepInBounds',options.smallTitleKeepInBounds,'titleMargins',options.smallTitleMargins,'titlePaddings',options.smallTitlePaddings,'titleSize',options.smallTitleSize,'titleSizeMax',options.smallTitleSizeMax);},_calcLayout:function(layoutInfo){var multiInfo=this._multiInfo;if(!multiInfo){return;}
var chart=this.chart;var options=chart.options;var clientSize=layoutInfo.clientSize;var prevLayoutInfo=layoutInfo.previous;var initialClientWidth=prevLayoutInfo?prevLayoutInfo.initialClientWidth:clientSize.width;var initialClientHeight=prevLayoutInfo?prevLayoutInfo.initialClientHeight:clientSize.height;var smallWidth=pvc_PercentValue.parse(options.smallWidth);if(smallWidth!=null){smallWidth=pvc_PercentValue.resolve(smallWidth,initialClientWidth);}
var smallHeight=pvc_PercentValue.parse(options.smallHeight);if(smallHeight!=null){smallHeight=pvc_PercentValue.resolve(smallHeight,initialClientHeight);}
var ar=+options.smallAspectRatio;if(isNaN(ar)||ar<=0){ar=this._calulateDefaultAspectRatio();}
if(smallWidth==null){if(isFinite(multiInfo.multiChartColumnsMax)){smallWidth=clientSize.width/multiInfo.colCount;}else{if(smallHeight==null){smallHeight=initialClientHeight;}
smallWidth=ar*smallHeight;}}
if(smallHeight==null){if((multiInfo.rowCount===1&&def.get(options,'multiChartSingleRowFillsHeight',true))||(multiInfo.colCount===1&&def.get(options,'multiChartSingleColFillsHeight',true))){smallHeight=initialClientHeight;}else{smallHeight=smallWidth/ar;}}
def.set(layoutInfo,'initialClientWidth',initialClientWidth,'initialClientHeight',initialClientHeight,'width',smallWidth,'height',smallHeight);return{width:smallWidth*multiInfo.colCount,height:Math.max(clientSize.height,smallHeight*multiInfo.rowCount)};},_calulateDefaultAspectRatio:function(){if(this.chart instanceof pvc.PieChart){return 10/7;}
return 5/4;},_getExtensionId:function(){return'content';},_createCore:function(li){var mi=this._multiInfo;if(!mi){return;}
var chart=this.chart;var options=chart.options;var smallMargins=options.smallMargins;if(smallMargins==null){smallMargins=new pvc_Sides(new pvc_PercentValue(0.02));}else{smallMargins=new pvc_Sides(smallMargins);}
var smallPaddings=new pvc_Sides(options.smallPaddings);chart.children.forEach(function(childChart){childChart._setSmallLayout({left:childChart.smallColIndex*li.width,top:childChart.smallRowIndex*li.height,width:li.width,height:li.height,margins:this._buildSmallMargins(childChart,smallMargins),paddings:smallPaddings});},this);var coordScopesByType=mi.coordScopesByType;if(coordScopesByType){chart._coordinateSmallChartsLayout(coordScopesByType);}
this.base(li);},_buildSmallMargins:function(childChart,smallMargins){var mi=this._multiInfo;var lastColIndex=mi.colCount-1;var lastRowIndex=mi.rowCount-1;var colIndex=childChart.smallColIndex;var rowIndex=childChart.smallRowIndex;var margins={};if(colIndex>0){margins.left=smallMargins.left;}
if(colIndex<lastColIndex){margins.right=smallMargins.right;}
if(rowIndex>0){margins.top=smallMargins.top;}
if(rowIndex<lastRowIndex){margins.bottom=smallMargins.bottom;}
return margins;}});def.type('pvc.TitlePanelAbstract',pvc.BasePanel).init(function(chart,parent,options){if(!options){options={};}
var anchor=options.anchor||this.anchor;if(options.size==null){var size=options.titleSize;if(size!=null){options.size=new pvc_Size().setSize(size,{singleProp:this.anchorOrthoLength(anchor)});}}
if(options.sizeMax==null){var sizeMax=options.titleSizeMax;if(sizeMax!=null){options.sizeMax=new pvc_Size().setSize(sizeMax,{singleProp:this.anchorOrthoLength(anchor)});}}
if(options.paddings==null){options.paddings=this.defaultPaddings;}
this.base(chart,parent,options);if(options.font===undefined){var extensionFont=this._getExtension('label','font');if(typeof extensionFont==='string'){this.font=extensionFont;}}}).add({pvLabel:null,anchor:'top',title:null,titleSize:undefined,font:"12px sans-serif",defaultPaddings:2,_extensionPrefix:'title',_calcLayout:function(layoutInfo){var requestSize=new pvc_Size();var a=this.anchor;var a_width=this.anchorLength(a);var a_height=this.anchorOrthoLength(a);var textWidth=pv.Text.measure(this.title,this.font).width+2;var clientWidth=layoutInfo.clientSize[a_width];var desiredWidth=layoutInfo.desiredClientSize[a_width];if(desiredWidth==null){desiredWidth=textWidth>clientWidth?clientWidth:textWidth;}else if(desiredWidth>clientWidth){desiredWidth=clientWidth;}
var lines;if(textWidth>desiredWidth){lines=pvc.text.justify(this.title,desiredWidth,this.font);}else{lines=this.title?[this.title]:[];}
var lineHeight=pv.Text.fontHeight(this.font);var realHeight=lines.length*lineHeight;var availableHeight=layoutInfo.clientSize[a_height];var desiredHeight=layoutInfo.desiredClientSize[a_height];if(desiredHeight==null){desiredHeight=realHeight;}else if(desiredHeight>availableHeight){desiredHeight=availableHeight;}
if(realHeight>desiredHeight){var maxLineCount=Math.max(1,Math.floor(desiredHeight/lineHeight));if(lines.length>maxLineCount){var firstCroppedLine=lines[maxLineCount];lines.length=maxLineCount;realHeight=desiredHeight=maxLineCount*lineHeight;var lastLine=lines[maxLineCount-1]+" "+firstCroppedLine;lines[maxLineCount-1]=pvc.text.trimToWidthB(desiredWidth,lastLine,this.font,"..");}}
layoutInfo.lines=lines;layoutInfo.topOffset=(desiredHeight-realHeight)/2;layoutInfo.lineSize={width:desiredWidth,height:lineHeight};layoutInfo.a_width=a_width;layoutInfo.a_height=a_height;requestSize[a_width]=desiredWidth;requestSize[a_height]=desiredHeight;return requestSize;},_createCore:function(layoutInfo){var rootScene=this._buildScene(layoutInfo);var rotationByAnchor={top:0,right:Math.PI/2,bottom:0,left:-Math.PI/2};var textAlign=pvc.BasePanel.horizontalAlign[this.align];var textAnchor=pvc.BasePanel.leftTopAnchor[this.anchor];var wrapper;if(this.compatVersion()<=1){wrapper=function(v1f){return function(itemScene){return v1f.call(this);};};}
this.pvLabel=new pvc.visual.Label(this,this.pvPanel,{extensionId:'label',wrapper:wrapper}).lock('data',rootScene.lineScenes).pvMark
[textAnchor](function(lineScene){return layoutInfo.topOffset+
lineScene.vars.size.height/2+
this.index*lineScene.vars.size.height;}).textAlign(textAlign)
[this.anchorOrtho(textAnchor)](function(lineScene){switch(this.textAlign()){case'center':return lineScene.vars.size.width/2;case'left':return 0;case'right':return lineScene.vars.size.width;}}).text(function(lineScene){return lineScene.vars.textLines[this.index];}).font(this.font).textBaseline('middle').textAngle(rotationByAnchor[this.anchor]);},_buildScene:function(layoutInfo){var rootScene=new pvc.visual.Scene(null,{panel:this,source:this.chart.data});var textLines=layoutInfo.lines;rootScene.vars.size=layoutInfo.lineSize;rootScene.vars.textLines=textLines;rootScene.lineScenes=def.array.create(textLines.length,rootScene);return rootScene;},_getExtensionId:def.fun.constant('')});def.type('pvc.TitlePanel',pvc.TitlePanelAbstract).init(function(chart,parent,options){if(!options){options={};}
var isV1Compat=chart.compatVersion()<=1;if(isV1Compat){var size=options.titleSize;if(size==null){options.titleSize=25;}}
this._extensionPrefix=!chart.parent?"title":"smallTitle";this.base(chart,parent,options);}).add({font:"14px sans-serif",defaultPaddings:4});def.type('pvc.LegendPanel',pvc.BasePanel).init(function(chart,parent,options){this.base(chart,parent,options);var I=pvc.visual.Interactive;if(this._ibits&I.Interactive){this._ibits|=I.Clickable;}}).add({pvRule:null,pvDot:null,pvLabel:null,anchor:'bottom',pvLegendPanel:null,textMargin:6,itemPadding:2.5,markerSize:15,font:'10px sans-serif',_calcLayout:function(layoutInfo){return this._getBulletRootScene().layout(layoutInfo);},_createCore:function(layoutInfo){var clientSize=layoutInfo.clientSize,rootScene=this._getBulletRootScene(),itemPadding=rootScene.vars.itemPadding,contentSize=rootScene.vars.size;var isHorizontal=this.isAnchorTopOrBottom();var a_top=isHorizontal?'top':'left';var a_bottom=this.anchorOpposite(a_top);var a_width=this.anchorLength(a_top);var a_height=this.anchorOrthoLength(a_top);var a_center=isHorizontal?'center':'middle';var a_left=isHorizontal?'left':'top';var a_right=this.anchorOpposite(a_left);var leftOffset=0;switch(this.align){case a_right:leftOffset=clientSize[a_width]-contentSize.width;break;case a_center:leftOffset=(clientSize[a_width]-contentSize.width)/2;break;}
this.pvPanel.overflow("hidden");var pvLegendRowPanel=this.pvPanel.add(pv.Panel).data(rootScene.vars.rows)
[a_left](leftOffset)
[a_top](function(){var prevRow=this.sibling();return prevRow?(prevRow[a_top]+prevRow[a_height]+itemPadding[a_height]):0;})
[a_width](function(row){return row.size.width;})
[a_height](function(row){return row.size.height;});var wrapper;if(this.compatVersion()<=1){wrapper=function(v1f){return function(itemScene){return v1f.call(this,itemScene.vars.value.rawValue);};};}
this.pvLegendPanel=new pvc.visual.Panel(this,pvLegendRowPanel,{extensionId:'panel',wrapper:wrapper,noSelect:false,noHover:true,noClick:false,noClickSelect:true}).lockMark('data',function(row){return row.items;}).lock(a_right,null).lock(a_bottom,null).lockMark(a_left,function(clientScene){var itemPadding=clientScene.vars.itemPadding;var prevItem=this.sibling();return prevItem?(prevItem[a_left]+prevItem[a_width]+itemPadding[a_width]):0;}).lockMark('height',function(itemScene){return itemScene.vars.clientSize.height;}).lockMark(a_top,isHorizontal?function(itemScene){var vars=itemScene.vars;return vars.row.size.height/2-vars.clientSize.height/2;}:0).lockMark('width',isHorizontal?function(itemScene){return itemScene.vars.clientSize.width;}:function(){return this.parent.width();}).pvMark.def("hidden","false").fillStyle(function(){return this.hidden()=="true"?"rgba(200,200,200,1)":"rgba(200,200,200,0.0001)";});var pvLegendMarkerPanel=new pvc.visual.Panel(this,this.pvLegendPanel).pvMark.left(0).top(0).right(null).bottom(null).width(function(itemScene){return itemScene.vars.markerSize;}).height(function(itemScene){return itemScene.vars.clientSize.height;});if(pvc.debug>=20){pvLegendRowPanel.strokeStyle('red');this.pvLegendPanel.strokeStyle('green');pvLegendMarkerPanel.strokeStyle('blue');}
rootScene.childNodes.forEach(function(groupScene){var pvGroupPanel=new pvc.visual.Panel(this,pvLegendMarkerPanel).pvMark.visible(function(itemScene){return itemScene.parent===groupScene;});groupScene.renderer().create(this,pvGroupPanel,groupScene.extensionPrefix,wrapper);},this);this.pvLabel=new pvc.visual.Label(this,pvLegendMarkerPanel.anchor("right"),{extensionId:'label',wrapper:wrapper}).intercept('textStyle',function(itemScene){var baseTextStyle=this.delegateExtension()||"black";return itemScene.isOn()?baseTextStyle:pvc.toGrayScale(baseTextStyle,null,undefined,150);}).pvMark.textAlign('left').text(function(itemScene){return itemScene.vars.value.label;}).lock('textMargin',function(itemScene){return itemScene.vars.textMargin-4;}).font(function(itemScene){return itemScene.vars.font;}).textDecoration(function(itemScene){return itemScene.isOn()?"":"line-through";});if(pvc.debug>=16){var font=this.font;var textHeight=pv.Text.fontHeight(font)*2/3;pvLegendMarkerPanel.anchor("right").add(pv.Panel)
[this.anchorLength()](0)
[this.anchorOrthoLength()](0).fillStyle(null).strokeStyle(null).lineWidth(0).add(pv.Line).data(function(scene){var labelBBox=pvc.text.getLabelBBox(pv.Text.measure(scene.vars.value.label,font).width,textHeight,'left','middle',0,2);var corners=labelBBox.source.points();if(corners.length>1){corners=corners.concat(corners[0]);}
return corners;}).left(function(p){return p.x;}).top(function(p){return p.y;}).strokeStyle('red').lineWidth(0.5).strokeDasharray('-');}},_onClick:function(context){var scene=context.scene;if(def.fun.is(scene.execute)&&scene.executable()){scene.execute();}},_getExtensionPrefix:function(){return'legend';},_getExtensionId:function(){return'area';},_getSelectableMarks:function(){return[this.pvLegendPanel];},_getBulletRootScene:function(){var rootScene=this._rootScene;if(!rootScene){rootScene=new pvc.visual.legend.BulletRootScene(null,{panel:this,source:this.chart.data,horizontal:this.isAnchorTopOrBottom(),font:this.font,markerSize:this.markerSize,textMargin:this.textMargin,itemPadding:this.itemPadding});this._rootScene=rootScene;}
return rootScene;}});def.type('pvc.CartesianAbstract',pvc.BaseChart).init(function(options){this.axesPanels={};this.base(options);}).add({_gridDockPanel:null,axesPanels:null,yAxisPanel:null,xAxisPanel:null,secondXAxisPanel:null,secondYAxisPanel:null,yScale:null,xScale:null,_getSeriesRoleSpec:function(){return{isRequired:true,defaultDimension:'series*',autoCreateDimension:true,requireIsDiscrete:true};},_getColorRoleSpec:function(){return{isRequired:true,defaultDimension:'color*',defaultSourceRole:'series',requireIsDiscrete:true};},_collectPlotAxesDataCells:function(plot,dataCellsByAxisTypeThenIndex){this.base(plot,dataCellsByAxisTypeThenIndex);if(plot.option.isDefined('BaseAxis')){var baseDataCellsByAxisIndex=def.array.lazy(dataCellsByAxisTypeThenIndex,'base');def.array.lazy(baseDataCellsByAxisIndex,plot.option('BaseAxis')-1).push({plot:plot,role:this.visualRole(plot.option('BaseRole')),dataPartValue:plot.option('DataPart')});}
if(plot.option.isDefined('OrthoAxis')){var trend=plot.option('Trend');var isStacked=plot.option.isDefined('Stacked')?plot.option('Stacked'):undefined;var orthoDataCellsByAxisIndex=def.array.lazy(dataCellsByAxisTypeThenIndex,'ortho');var orthoRoleNames=def.array.to(plot.option('OrthoRole'));var dataCellBase={dataPartValue:plot.option('DataPart'),isStacked:isStacked,trend:trend,nullInterpolationMode:plot.option('NullInterpolationMode')};var orthoDataCells=def.array.lazy(orthoDataCellsByAxisIndex,plot.option('OrthoAxis')-1);orthoRoleNames.forEach(function(orthoRoleName){var dataCell=Object.create(dataCellBase);dataCell.role=this.visualRole(orthoRoleName);orthoDataCells.push(dataCell);},this);}},_addAxis:function(axis){this.base(axis);switch(axis.type){case'base':case'ortho':this.axes[axis.orientedId]=axis;if(axis.v1SecondOrientedId){this.axes[axis.v1SecondOrientedId]=axis;}
break;}
return this;},_generateTrendsDataCell:function(dataCell){var trend=dataCell.trend;if(trend){var trendInfo=pvc.trends.get(trend.type);var newDatums=[];this._generateTrendsDataCellCore(newDatums,dataCell,trendInfo);if(newDatums.length){this.data.owner.add(newDatums);}}},_generateTrendsDataCellCore:function(){},_setAxesScales:function(hasMultiRole){this.base(hasMultiRole);if(!hasMultiRole||this.parent){['base','ortho'].forEach(function(type){var axisOfType=this.axesByType[type];if(axisOfType){axisOfType.forEach(this._createAxisScale,this);}},this);}},_createAxisScale:function(axis){var scale=this.base(axis);var isOrtho=axis.type==='ortho';var isCart=isOrtho||axis.type==='base';if(isCart){if(isOrtho&&axis.index===1){this.secondScale=scale;}else if(!axis.index){this[axis.orientation+'Scale']=scale;}}
return scale;},_preRenderContent:function(contentOptions){this._createFocusWindow();this._gridDockPanel=new pvc.CartesianGridDockingPanel(this,this.basePanel,{margins:contentOptions.margins,paddings:contentOptions.paddings});['base','ortho'].forEach(function(type){var typeAxes=this.axesByType[type];if(typeAxes){def.query(typeAxes).reverse().each(function(axis){this._createAxisPanel(axis);},this);}},this);this._createPlotPanels(this._gridDockPanel,{clickAction:contentOptions.clickAction,doubleClickAction:contentOptions.doubleClickAction});},_createFocusWindow:function(){if(this.selectableByFocusWindow()){var fwData;var fw=this.focusWindow;if(fw){fwData=fw._exportData();}
fw=this.focusWindow=new pvc.visual.CartesianFocusWindow(this);if(fwData){fw._importData(fwData);}
fw._initFromOptions();}else if(this.focusWindow){delete this.focusWindow;}},_createAxisPanel:function(axis){if(axis.option('Visible')){var titlePanel;var title=axis.option('Title');if(!def.empty(title)){titlePanel=new pvc.AxisTitlePanel(this,this._gridDockPanel,axis,{title:title,font:axis.option('TitleFont')||axis.option('Font'),anchor:axis.option('Position'),align:axis.option('TitleAlign'),margins:axis.option('TitleMargins'),paddings:axis.option('TitlePaddings'),titleSize:axis.option('TitleSize'),titleSizeMax:axis.option('TitleSizeMax')});}
var panel=new pvc.AxisPanel(this,this._gridDockPanel,axis,{anchor:axis.option('Position'),size:axis.option('Size'),sizeMax:axis.option('SizeMax'),clickAction:axis.option('ClickAction'),doubleClickAction:axis.option('DoubleClickAction'),useCompositeAxis:axis.option('Composite'),font:axis.option('Font'),labelSpacingMin:axis.option('LabelSpacingMin'),grid:axis.option('Grid'),gridCrossesMargin:axis.option('GridCrossesMargin'),ruleCrossesMargin:axis.option('RuleCrossesMargin'),zeroLine:axis.option('ZeroLine'),desiredTickCount:axis.option('DesiredTickCount'),showTicks:axis.option('Ticks'),showMinorTicks:axis.option('MinorTicks')});if(titlePanel){panel.titlePanel=titlePanel;}
this.axesPanels[axis.id]=panel;this.axesPanels[axis.orientedId]=panel;if(axis.index<=1&&axis.v1SecondOrientedId){this[axis.v1SecondOrientedId+'AxisPanel']=panel;}
return panel;}},_onLaidOut:function(){if(this.plotPanelList&&this.plotPanelList[0]){['base','ortho'].forEach(function(type){var axes=this.axesByType[type];if(axes){axes.forEach(this._setCartAxisScaleRange,this);}},this);}},_setCartAxisScaleRange:function(axis){var info=this.plotPanelList[0]._layoutInfo;var size=info.clientSize;var length=(axis.orientation==='x')?size.width:size.height;axis.setScaleRange(length);return axis.scale;},_getAxesRoundingPaddings:function(){var axesPaddings={};var axesByType=this.axesByType;['base','ortho'].forEach(function(type){var typeAxes=axesByType[type];if(typeAxes){typeAxes.forEach(processAxis);}});return axesPaddings;function setSide(side,pct,locked){var value=axesPaddings[side];if(value==null||pct>value){axesPaddings[side]=pct;axesPaddings[side+'Locked']=locked;}else if(locked){axesPaddings[side+'Locked']=locked;}}
function processAxis(axis){if(axis){var tickRoundPads=axis.getScaleRoundingPaddings();if(tickRoundPads){var isX=axis.orientation==='x';setSide(isX?'left':'bottom',tickRoundPads.begin,tickRoundPads.beginLocked);setSide(isX?'right':'top',tickRoundPads.end,tickRoundPads.endLocked);}}}},markEventDefaults:{strokeStyle:"#5BCBF5",lineWidth:"0.5",textStyle:"#5BCBF5",verticalOffset:10,verticalAnchor:"bottom",horizontalAnchor:"right",forceHorizontalAnchor:false,horizontalAnchorSwapLimit:80,font:'10px sans-serif'},markEvent:function(sourceValue,label,options){var me=this;var baseAxis=me.axes.base;var orthoAxis=me.axes.ortho;var baseRole=baseAxis.role;var baseScale=baseAxis.scale;var baseDim=me.data.owner.dimensions(baseRole.grouping.firstDimensionName());var baseDimType=baseDim.type;if(baseAxis.isDiscrete()){me._warn("Can only mark events in charts with a continuous base scale.");return me;}
var o=$.extend({},me.markEventDefaults,options);var pseudoAtom=baseDim.read(sourceValue,label);var basePos=baseScale(pseudoAtom.value);var baseRange=baseScale.range();var baseEndPos=baseRange[1];if(basePos<baseRange[0]||basePos>baseEndPos){this._warn("Cannot mark event because it is outside the base scale's domain.");return this;}
var pvPanel=this.plotPanelList[0].pvPanel;var h=orthoAxis.scale.range()[1];var ha=o.horizontalAnchor;if(!o.forceHorizontalAnchor){var alignRight=ha==="right";var availableSize=alignRight?(baseEndPos-basePos):basePos;var labelSize=pv.Text.measure(pseudoAtom.label,o.font).width;if(availableSize<labelSize){ha=alignRight?"left":"right";}}
var topPos=o.verticalAnchor==="top"?o.verticalOffset:(h-o.verticalOffset);var line=pvPanel.add(pv.Line).data([0,h]).bottom(def.identity).left(basePos).lineWidth(o.lineWidth).strokeStyle(o.strokeStyle);line.anchor(ha).visible(function(){return!this.index;}).top(topPos).add(pv.Label).font(o.font).text(pseudoAtom.label).textStyle(o.textStyle);return me;},defaults:{panelSizeRatio:0.9,timeSeries:false,timeSeriesFormat:"%Y-%m-%d"}});def.type('pvc.GridDockingPanel',pvc.BasePanel).add({anchor:'fill',_calcLayout:function(layoutInfo){var me=this;if(!me._children){return;}
var useLog=pvc.debug>=5;var margins=new pvc_Sides(0);var paddings=new pvc_Sides(0);var remSize=def.copyOwn(layoutInfo.clientSize);var aolMap=pvc.BasePanel.orthogonalLength;var aoMap=pvc.BasePanel.relativeAnchor;var alMap=pvc.BasePanel.parallelLength;var childKeyArgs={force:true,referenceSize:layoutInfo.clientSize};var fillChildren=[];var sideChildren=[];var paddingHistory={};var LoopDetected=1;var NormalPaddingsChanged=2;var OverflowPaddingsChanged=4;var emptyNewPaddings=new pvc_Sides();var isDisasterRecovery=false;if(useLog){me._group("CCC GRID LAYOUT clientSize = "+pvc.stringify(remSize));}
try{this._children.forEach(initChild);if(useLog){me._group("Phase 1 - Determine MARGINS and FILL SIZE from SIDE panels");}
try{sideChildren.forEach(layoutChild1Side);}finally{if(useLog){me._groupEnd();me._log("Final FILL margins = "+pvc.stringify(margins));me._log("Final FILL border size = "+pvc.stringify(remSize));}}
if(useLog){me._group("Phase 2 - Determine COMMON PADDINGS");}
try{doMaxTimes(9,layoutCycle);}finally{if(useLog){me._groupEnd();me._log("Final FILL clientSize = "+pvc.stringify({width:(remSize.width-paddings.width),height:(remSize.height-paddings.height)}));me._log("Final COMMON paddings = "+pvc.stringify(paddings));}}
layoutInfo.gridMargins=new pvc_Sides(margins);layoutInfo.gridPaddings=new pvc_Sides(paddings);layoutInfo.gridSize=new pvc_Size(remSize);}finally{if(useLog){me._groupEnd();}}
function layoutCycle(remTimes,iteration){if(useLog){me._group("LayoutCycle "+(isDisasterRecovery?"- Disaster MODE":("#"+(iteration+1))));}
try{var index,count;var canChange=layoutInfo.canChange!==false&&!isDisasterRecovery&&(remTimes>0);var paddingsChanged;var ownPaddingsChanged=false;var breakAndRepeat;index=0;count=sideChildren.length;while(index<count){if(useLog){me._group("SIDE Child #"+(index+1));}
try{paddingsChanged=layoutChild2Side(sideChildren[index],canChange);if(!isDisasterRecovery&&paddingsChanged){breakAndRepeat=false;if((paddingsChanged&OverflowPaddingsChanged)!==0){if(useLog){me._log("SIDE Child #"+(index+1)+" changed overflow paddings");}
if(!ownPaddingsChanged){ownPaddingsChanged=true;layoutInfo.requestPaddings=layoutInfo.paddings;}}
if((paddingsChanged&NormalPaddingsChanged)!==0){if(remTimes>0){if(useLog){me._log("SIDE Child #"+(index+1)+" changed normal paddings");}
breakAndRepeat=true;}else if(pvc.debug>=2){me._warn("SIDE Child #"+(index+1)+" changed paddings but no more iterations possible.");}}
if((paddingsChanged&LoopDetected)!==0){isDisasterRecovery=true;layoutCycle(0);return false;}
if(breakAndRepeat){return true;}}}finally{if(useLog){me._groupEnd();}}
index++;}
if(ownPaddingsChanged){if(useLog){me._log("Restarting due to overflowPaddings change");}
return false;}
index=0;count=fillChildren.length;while(index<count){if(useLog){me._group("FILL Child #"+(index+1));}
try{paddingsChanged=layoutChildFill(fillChildren[index],canChange);if(!isDisasterRecovery&&paddingsChanged){breakAndRepeat=false;if((paddingsChanged&NormalPaddingsChanged)!==0){if(remTimes>0){if(pvc.debug>=5){me._log("FILL Child #"+(index+1)+" increased paddings");}
breakAndRepeat=true;}else if(pvc.debug>=2){me._warn("FILL Child #"+(index+1)+" increased paddings but no more iterations possible.");}}
if((paddingsChanged&LoopDetected)!==0){isDisasterRecovery=true;layoutCycle(0);return false;}
if(breakAndRepeat){return true;}}}finally{if(useLog){me._groupEnd();}}
index++;}
return false;}finally{if(useLog){me._groupEnd();}}}
function doMaxTimes(maxTimes,fun){var index=0;while(maxTimes--){if(fun(maxTimes,index)===false){return true;}
index++;}
return false;}
function initChild(child){var a=child.anchor;if(a){if(a==='fill'){fillChildren.push(child);var childPaddings=child.paddings.resolve(childKeyArgs.referenceSize);paddings=pvc_Sides.resolvedMax(paddings,childPaddings);}else{def.hasOwn(aoMap,a)||def.fail.operationInvalid("Unknown anchor value '{0}'",[a]);sideChildren.push(child);}}}
function layoutChild1Side(child,index){if(useLog){me._group("SIDE Child #"+(index+1));}
try{var paddingsChanged=0;var a=child.anchor;childKeyArgs.paddings=filterAnchorPaddings(a,paddings);child.layout(new pvc_Size(remSize),childKeyArgs);if(child.isVisible){paddingsChanged|=checkAnchorPaddingsChanged(a,paddings,child);positionChildNormal(a,child);updateSide(a,child);}
return paddingsChanged;}finally{if(useLog){me._groupEnd();}}}
function layoutChildFill(child,canChange){var paddingsChanged=0;var a=child.anchor;childKeyArgs.paddings=filterAnchorPaddings(a,paddings);childKeyArgs.canChange=canChange;child.layout(new pvc_Size(remSize),childKeyArgs);if(child.isVisible){paddingsChanged|=checkAnchorPaddingsChanged(a,paddings,child,canChange);positionChildNormal(a,child);positionChildOrtho(child,a);}
return paddingsChanged;}
function layoutChild2Side(child,canChange){var paddingsChanged=0;if(child.isVisible){var a=child.anchor;var al=alMap[a];var aol=aolMap[a];var length=remSize[al];var olength=child[aol];var childSize2=new pvc_Size(def.set({},al,length,aol,olength));childKeyArgs.paddings=filterAnchorPaddings(a,paddings);childKeyArgs.canChange=canChange;child.layout(childSize2,childKeyArgs);if(child.isVisible){paddingsChanged=checkAnchorPaddingsChanged(a,paddings,child,canChange)|checkOverflowPaddingsChanged(a,layoutInfo.paddings,child,canChange);if(!paddingsChanged){positionChildOrtho(child,child.align);}}}
return paddingsChanged;}
function positionChildNormal(side,child){var sidePos;if(side==='fill'){side='left';sidePos=margins.left+remSize.width/2-(child.width/2);}else{sidePos=margins[side];}
child.setPosition(def.set({},side,sidePos));}
function updateSide(side,child){var sideol=aolMap[side],olen=child[sideol];margins[side]+=olen;remSize[sideol]-=olen;}
function positionChildOrtho(child,align){var sideo;if(align==='fill'){align='middle';}
var sideOPos;switch(align){case'top':case'bottom':case'left':case'right':sideo=align;sideOPos=margins[sideo];break;case'middle':sideo='bottom';sideOPos=margins.bottom+(remSize.height/2)-(child.height/2);break;case'center':sideo='left';sideOPos=margins.left+remSize.width/2-(child.width/2);break;}
child.setPosition(def.set({},sideo,sideOPos));}
function filterAnchorPaddings(a,paddings){var filtered=new pvc_Sides();getAnchorPaddingsNames(a).forEach(function(side){filtered.set(side,paddings[side]);});return filtered;}
function checkAnchorPaddingsChanged(a,paddings,child,canChange){var newPaddings=child._layoutInfo.requestPaddings;var changed=0;if(newPaddings){if(useLog&&pvc.debug>=10){me._log("=> clientSize="+pvc.stringify(child._layoutInfo.clientSize));me._log("<= requestPaddings="+pvc.stringify(newPaddings));}
getAnchorPaddingsNames(a).forEach(function(side){var value=paddings[side]||0;var newValue=Math.floor(10000*(newPaddings[side]||0))/10000;var increase=newValue-value;var minChange=Math.max(1,Math.abs(0.01*value));if(increase!==0&&Math.abs(increase)>=minChange){if(!canChange){if(pvc.debug>=2){me._warn("CANNOT change but child wanted to: "+side+"="+newValue);}}else{changed|=NormalPaddingsChanged;paddings[side]=newValue;if(useLog){me._log("Changed padding "+side+" <- "+newValue);}}}});if(changed){var paddingKey=pvc_Sides.names.map(function(side){return(paddings[side]||0).toFixed(0);}).join('|');if(def.hasOwn(paddingHistory,paddingKey)){if(pvc.debug>=2){me._warn("LOOP detected!!!!");}
changed|=LoopDetected;}else{paddingHistory[paddingKey]=true;}
paddings.width=paddings.left+paddings.right;paddings.height=paddings.top+paddings.bottom;}}
return changed;}
function checkOverflowPaddingsChanged(a,ownPaddings,child,canChange){var overflowPaddings=child._layoutInfo.overflowPaddings||emptyNewPaddings;var changed=0;if(useLog&&pvc.debug>=10){me._log("<= overflowPaddings="+pvc.stringify(overflowPaddings));}
getAnchorPaddingsNames(a).forEach(function(side){if(overflowPaddings.hasOwnProperty(side)){var value=ownPaddings[side]||0;var newValue=Math.floor(10000*(overflowPaddings[side]||0))/10000;newValue-=margins[side];var increase=newValue-value;var minChange=Math.max(1,Math.abs(0.05*value));if(increase>=minChange){if(!canChange){if(pvc.debug>=2){me._warn("CANNOT change overflow padding but child wanted to: "+side+"="+newValue);}}else{changed|=OverflowPaddingsChanged;ownPaddings[side]=newValue;if(useLog){me._log("changed overflow padding "+side+" <- "+newValue);}}}}});if(changed){ownPaddings.width=ownPaddings.left+ownPaddings.right;ownPaddings.height=ownPaddings.top+ownPaddings.bottom;}
return changed;}
function getAnchorPaddingsNames(a){switch(a){case'left':case'right':return pvc_Sides.vnames;case'top':case'bottom':return pvc_Sides.hnames;case'fill':return pvc_Sides.names;}}}});def.type('pvc.CartesianGridDockingPanel',pvc.GridDockingPanel).init(function(chart,parent,options){this.base(chart,parent,options);this._plotBgPanel=new pvc.PlotBgPanel(chart,this);}).add({_getExtensionId:function(){return!this.chart.parent?'content':'smallContent';},_createCore:function(layoutInfo){var chart=this.chart;var axes=chart.axes;var xAxis=axes.x;var yAxis=axes.y;if(xAxis.option('Grid')){this.xGridRule=this._createGridRule(xAxis);}
if(yAxis.option('Grid')){this.yGridRule=this._createGridRule(yAxis);}
this.base(layoutInfo);if(chart.focusWindow){this._createFocusWindow(layoutInfo);}
var plotFrameVisible;if(chart.compatVersion()<=1){plotFrameVisible=!!(xAxis.option('EndLine')||yAxis.option('EndLine'));}else{plotFrameVisible=def.get(chart.options,'plotFrameVisible',true);}
if(plotFrameVisible){this.pvFrameBar=this._createFrame(layoutInfo,axes);}
if(xAxis.scaleType!=='discrete'&&xAxis.option('ZeroLine')){this.xZeroLine=this._createZeroLine(xAxis,layoutInfo);}
if(yAxis.scaleType!=='discrete'&&yAxis.option('ZeroLine')){this.yZeroLine=this._createZeroLine(yAxis,layoutInfo);}},_createGridRule:function(axis){var scale=axis.scale;if(scale.isNull){return;}
var isDiscrete=axis.role.grouping.isDiscrete();var rootScene=this._getAxisGridRootScene(axis);if(!rootScene){return;}
var margins=this._layoutInfo.gridMargins;var paddings=this._layoutInfo.gridPaddings;var tick_a=axis.orientation==='x'?'left':'bottom';var len_a=this.anchorLength(tick_a);var obeg_a=this.anchorOrtho(tick_a);var oend_a=this.anchorOpposite(obeg_a);var tick_offset=margins[tick_a]+paddings[tick_a];var obeg=margins[obeg_a];var oend=margins[oend_a];var tickScenes=rootScene.leafs().array();var tickCount=tickScenes.length;if(isDiscrete&&tickCount){tickScenes.push(tickScenes[tickCount-1]);}
var wrapper;if(this.compatVersion()<=1){wrapper=function(v1f){return function(tickScene){return v1f.call(this,tickScene.vars.tick.rawValue);};};}
var pvGridRule=new pvc.visual.Rule(this,this.pvPanel,{extensionId:axis.extensionPrefixes.map(function(prefix){return prefix+'Grid';}),wrapper:wrapper}).lock('data',tickScenes).lock(len_a,null).override('defaultColor',function(){return pv.color("#f0f0f0");}).pvMark.lineWidth(1).antialias(true)
[obeg_a](obeg)
[oend_a](oend).zOrder(-12).events('none');if(isDiscrete){var halfStep=scale.range().step/2;pvGridRule.lock(tick_a,function(tickScene){var tickPosition=tick_offset+scale(tickScene.vars.tick.value);var isLastLine=this.index===tickCount;return tickPosition+(isLastLine?halfStep:-halfStep);});}else{pvGridRule.lock(tick_a,function(tickScene){return tick_offset+scale(tickScene.vars.tick.value);});}
return pvGridRule;},_getAxisGridRootScene:function(axis){var data=this.data;var isDiscrete=axis.isDiscrete();if(isDiscrete){data=axis.role.flatten(data,{visible:true});}
var rootScene=new pvc.visual.CartesianAxisRootScene(null,{panel:this,source:data});if(isDiscrete){data._children.forEach(function(tickData){new pvc.visual.CartesianAxisTickScene(rootScene,{source:tickData,tick:tickData.value,tickRaw:tickData.rawValue,tickLabel:tickData.label});});}else{var ticks=axis.ticks||axis.calcContinuousTicks();ticks.forEach(function(majorTick){new pvc.visual.CartesianAxisTickScene(rootScene,{tick:majorTick,tickRaw:majorTick,tickLabel:axis.scale.tickFormat(majorTick)});},this);}
return rootScene;},_createFrame:function(layoutInfo,axes){if(axes.base.scale.isNull||(axes.ortho.scale.isNull&&(!axes.ortho2||axes.ortho2.scale.isNull))){return;}
var margins=layoutInfo.gridMargins;var left=margins.left;var right=margins.right;var top=margins.top;var bottom=margins.bottom;var extensionIds=[];if(this.compatVersion()<=1){extensionIds.push('xAxisEndLine');extensionIds.push('yAxisEndLine');}
extensionIds.push('plotFrame');return new pvc.visual.Panel(this,this.pvPanel,{extensionId:extensionIds}).pvMark.lock('left',left).lock('right',right).lock('top',top).lock('bottom',bottom).lock('fillStyle',null).events('none').strokeStyle("#666666").lineWidth(1).antialias(false).zOrder(-8);},_createZeroLine:function(axis,layoutInfo){var scale=axis.scale;if(!scale.isNull){var domain=scale.domain();if(domain[0]*domain[1]<-1e-12){var a=axis.orientation==='x'?'left':'bottom';var len_a=this.anchorLength(a);var obeg_a=this.anchorOrtho(a);var oend_a=this.anchorOpposite(obeg_a);var margins=layoutInfo.gridMargins;var paddings=layoutInfo.gridPaddings;var zeroPosition=margins[a]+paddings[a]+scale(0);var obeg=margins[obeg_a];var oend=margins[oend_a];var rootScene=new pvc.visual.Scene(null,{panel:this});return new pvc.visual.Rule(this,this.pvPanel,{extensionId:axis.extensionPrefixes.map(function(prefix){return prefix+'ZeroLine';})}).lock('data',[rootScene]).lock(len_a,null).lock(obeg_a,obeg).lock(oend_a,oend).lock(a,zeroPosition).override('defaultColor',function(){return pv.color("#666666");}).pvMark.events('none').lineWidth(1).antialias(true).zOrder(-9);}}},_createFocusWindow:function(layoutInfo){var me=this;var topRoot=me.topRoot;var chart=me.chart;var focusWindow=chart.focusWindow.base;var axis=focusWindow.axis;var scale=axis.scale;if(scale.isNull){return;}
var resizable=focusWindow.option('Resizable');var movable=focusWindow.option('Movable');var isDiscrete=axis.isDiscrete();var isV=chart.isOrientationVertical();var a_left=isV?'left':'top';var a_top=isV?'top':'left';var a_width=me.anchorOrthoLength(a_left);var a_right=me.anchorOpposite(a_left);var a_height=me.anchorOrthoLength(a_top);var a_bottom=me.anchorOpposite(a_top);var a_x=isV?'x':'y';var a_dx='d'+a_x;var a_y=isV?'y':'x';var a_dy='d'+a_y;var margins=layoutInfo.gridMargins;var paddings=layoutInfo.gridPaddings;var space={left:margins.left+paddings.left,right:margins.right+paddings.right,top:margins.top+paddings.top,bottom:margins.bottom+paddings.bottom};space.width=space.left+space.right;space.height=space.top+space.bottom;var clientSize=layoutInfo.clientSize;var wf=clientSize[a_width];var hf=clientSize[a_height];var w=wf-space[a_width];var h=hf-space[a_height];var padLeft=paddings[a_left];var padRight=paddings[a_right];var scene=new pvc.visual.Scene(null,{panel:this});var band=isDiscrete?scale.range().step:0;var halfBand=band/2;scene[a_x]=scale(focusWindow.begin)-halfBand,scene[a_dx]=band+(scale(focusWindow.end)-halfBand)-scene[a_x],resetSceneY();function resetSceneY(){scene[a_y]=0-paddings[a_top];scene[a_dy]=h+paddings[a_top]+paddings[a_bottom];}
var sceneProp=function(p){return function(){return scene[p];};};var boundLeft=function(){var begin=scene[a_x];return Math.max(0,Math.min(w,begin));};var boundWidth=function(){var begin=boundLeft();var end=scene[a_x]+scene[a_dx];end=Math.max(0,Math.min(w,end));return end-begin;};var addSelBox=function(panel,id){return new pvc.visual.Bar(me,panel,{extensionId:id,normalStroke:true,noHover:true,noSelect:true,noClick:true,noDoubleClick:true,noTooltip:true,showsInteraction:false}).pvMark.lock('data').lock('visible').lock(a_left,boundLeft).lock(a_width,boundWidth).lock(a_top,sceneProp(a_y)).lock(a_height,sceneProp(a_dy)).lock(a_bottom).lock(a_right).sign;};var baseBgPanel=this._plotBgPanel.pvPanel.borderPanel;baseBgPanel.lock('data',[scene]);if(movable&&resizable){baseBgPanel.paddingPanel.lock('events','all').lock('cursor','crosshair').event('mousedown',pv.Behavior.select().autoRender(false).collapse(isV?'y':'x').positionConstraint(function(drag){var op=drag.phase==='start'?'new':'resize-end';return positionConstraint(drag,op);})).event('selectstart',function(ev){resetSceneY();onDrag(ev);}).event('select',onDrag).event('selectend',onDrag);}else{baseBgPanel.paddingPanel.events('all');}
var focusBg=addSelBox(baseBgPanel.paddingPanel,'focusWindowBg').override('defaultColor',function(type){return pvc.invisibleFill;}).pvMark;if(movable){focusBg.lock('events','all').lock('cursor','move').event("mousedown",pv.Behavior.drag().autoRender(false).collapse(isV?'y':'x').positionConstraint(function(drag){positionConstraint(drag,'move');})).event("drag",onDrag).event("dragend",onDrag);}else{focusBg.events('none');}
var baseFgPanel=new pvc.visual.Panel(me,me.pvPanel).pvMark.lock('data',[scene]).lock('visible').lock('fillStyle',pvc.invisibleFill).lock('left',space.left).lock('right',space.right).lock('top',space.top).lock('bottom',space.bottom).lock('zOrder',10).lock('events',function(){var drag=scene.drag;return drag&&drag.phase!=='end'?'all':'none';}).lock('cursor',function(){var drag=scene.drag;return drag&&drag.phase!=='end'?((drag.type==='drag'||(drag.type==='select'&&!resizable))?'move':(isV?'ew-resize':'ns-resize')):null;}).antialias(false);var curtainFillColor='rgba(20, 20, 20, 0.1)';new pvc.visual.Bar(me,baseFgPanel,{extensionId:'focusWindowBaseCurtain',normalStroke:true,noHover:true,noSelect:true,noClick:true,noDoubleClick:true,noTooltip:true,showsInteraction:false}).override('defaultColor',function(type){return type==='stroke'?null:curtainFillColor;}).pvMark.lock('data',[scene,scene]).lock('visible').lock('events','none').lock(a_left,function(){return!this.index?-padLeft:boundLeft()+boundWidth();}).lock(a_right,function(){return!this.index?null:-padRight;}).lock(a_width,function(){return!this.index?padLeft+boundLeft():null;}).lock(a_top,sceneProp(a_y)).lock(a_height,sceneProp(a_dy)).lock(a_bottom);var selectBoxFg=addSelBox(baseFgPanel,'focusWindow').override('defaultColor',function(type){return null;}).pvMark.lock('events','none');var addResizeSideGrip=function(side){var a_begin=(side==='left'||side==='top')?'begin':'end';var opposite=me.anchorOpposite(side);var fillColor='linear-gradient(to '+opposite+', '+curtainFillColor+', #444 90%)';var grip=new pvc.visual.Bar(me,selectBoxFg.anchor(side),{extensionId:focusWindow.id+'Grip'+def.firstUpperCase(a_begin),normalStroke:true,noHover:true,noSelect:true,noClick:true,noDoubleClick:true,noTooltip:true,showsInteraction:false}).override('defaultColor',function(type){return type==='stroke'?null:fillColor;}).pvMark.lock('data').lock('visible')
[a_top](scene[a_y])
[a_height](scene[a_dy]);if(resizable){var opId='resize-'+a_begin;grip.lock('events','all')
[a_width](5).cursor(isV?'ew-resize':'ns-resize').event("mousedown",pv.Behavior.resize(side).autoRender(false).positionConstraint(function(drag){positionConstraint(drag,opId);}).preserveOrtho(true)).event("resize",onDrag).event("resizeend",onDrag);}else{grip.events('none')
[a_width](1);}
return grip;};addResizeSideGrip(a_left);addResizeSideGrip(a_right);function onDrag(){var ev=arguments[arguments.length-1];var isEnd=ev.drag.phase==='end';topRoot._selectingByRubberband=!isEnd;baseBgPanel.render();baseFgPanel.render();var pbeg=scene[a_x];var pend=scene[a_x]+scene[a_dx];if(!isV){var temp=w-pbeg;pbeg=w-pend;pend=temp;}
focusWindow._updatePosition(pbeg,pend,isEnd,true);}
var a_p=a_x;var a_dp=a_dx;function positionConstraint(drag,op){var m=drag.m;var p=m[a_p];var b,e,l;var l0=scene[a_dp];var target;switch(op){case'new':l=0;target='begin';break;case'resize-begin':l=l0;target='begin';break;case'move':l=l0;target='begin';break;case'resize-end':l=p-scene[a_p];target='end';break;}
var min=drag.min[a_p];var max=drag.max[a_p];var oper={type:op,target:target,point:p,length:l,length0:l0,min:min,max:max,minView:0,maxView:w};focusWindow._constraintPosition(oper);m[a_p]=oper.point;switch(op){case'resize-begin':oper.max=Math.min(oper.max,scene[a_p]+scene[a_dp]);break;case'resize-end':oper.min=Math.max(oper.min,scene[a_p]);break;}
drag.min[a_p]=oper.min;drag.max[a_p]=oper.max;}},_getDatumsOnRect:function(datumMap,rect,keyArgs){var chart=this.chart,xAxisPanel=chart.axesPanels.x,yAxisPanel=chart.axesPanels.y,xDatumMap,yDatumMap;if(xAxisPanel){xDatumMap=new def.Map();xAxisPanel._getDatumsOnRect(xDatumMap,rect,keyArgs);if(!xDatumMap.count){xDatumMap=null;}}
if(yAxisPanel){yDatumMap=new def.Map();yAxisPanel._getOwnDatumsOnRect(yDatumMap,rect,keyArgs);if(!yDatumMap.count){yDatumMap=null;}}
if(xDatumMap&&yDatumMap){xDatumMap.intersect(yDatumMap,datumMap);keyArgs.toggle=true;}else if(xDatumMap){datumMap.copy(xDatumMap);}else if(yDatumMap){datumMap.copy(yDatumMap);}else{chart.plotPanelList.forEach(function(plotPanel){plotPanel._getDatumsOnRect(datumMap,rect,keyArgs);},this);}}});def.type('pvc.CartesianAbstractPanel',pvc.PlotPanel).init(function(chart,parent,plot,options){this.base(chart,parent,plot,options);var axes=this.axes;function addAxis(axis){axes[axis.type]=axis;axes[axis.orientedId]=axis;if(axis.v1SecondOrientedId){axes[axis.v1SecondOrientedId]=axis;}}
addAxis(chart._getAxis('base',plot.option('BaseAxis')-1));addAxis(chart._getAxis('ortho',plot.option('OrthoAxis')-1));var pctPaddings={};var hasAny=false;function setSide(side,pct){var value=pctPaddings[side];if(value==null||pct>value){hasAny=true;pctPaddings[side]=pct;}}
function processAxis(axis){var offset=axis&&axis.option('Offset');if(offset!=null&&offset>0&&offset<1){if(axis.orientation==='x'){setSide('left',offset);setSide('right',offset);}else{setSide('top',offset);setSide('bottom',offset);}}}
var chartAxes=chart.axesByType;['base','ortho'].forEach(function(type){var typeAxes=chartAxes[type];if(typeAxes){typeAxes.forEach(processAxis);}});if(hasAny){this.offsetPaddings=pctPaddings;}}).add({offsetPaddings:null,_calcLayout:function(layoutInfo){layoutInfo.requestPaddings=this._calcRequestPaddings(layoutInfo);},_calcRequestPaddings:function(layoutInfo){var reqPads;var offPads=this.offsetPaddings;if(offPads){var tickRoundPads=this.chart._getAxesRoundingPaddings();var clientSize=layoutInfo.clientSize;var pads=layoutInfo.paddings;pvc_Sides.names.forEach(function(side){var len_a=pvc.BasePanel.orthogonalLength[side];var clientLen=clientSize[len_a];var paddingLen=pads[len_a];var len=clientLen+paddingLen;if(!tickRoundPads[side+'Locked']){var offLen=len*(offPads[side]||0);var roundLen=clientLen*(tickRoundPads[side]||0);(reqPads||(reqPads={}))[side]=Math.max(offLen-roundLen,0);}},this);}
return reqPads;},_createCore:function(){this.pvPanel.zOrder(-10);var hideOverflow;var contentOverflow=this.chart.options.leafContentOverflow||'auto';if(contentOverflow==='auto'){hideOverflow=def.query(['ortho','base']).select(function(axisType){return this.axes[axisType];},this).any(function(axis){return axis.option('FixedMin')!=null||axis.option('FixedMax')!=null;});}else{hideOverflow=(contentOverflow==='hidden');}
if(hideOverflow){this.pvPanel.borderPanel.overflow('hidden');}}});def.type('pvc.PlotBgPanel',pvc.BasePanel).init(function(chart,parent,options){this.base(chart,parent,options);}).add({anchor:'fill',_getExtensionId:function(){return'plotBg';},_createCore:function(layoutInfo){this.pvPanel.borderPanel.lock('zOrder',-13).antialias(false);this.base(layoutInfo);}});def.type('pvc.CategoricalAbstract',pvc.CartesianAbstract).init(function(options){this.base(options);var parent=this.parent;if(parent){this._catRole=parent._catRole;}}).add({_initVisualRoles:function(){this.base();this._catRole=this._addVisualRole('category',this._getCategoryRoleSpec());},_getCategoryRoleSpec:function(){return{isRequired:true,defaultDimension:'category*',autoCreateDimension:true};},_generateTrendsDataCellCore:function(newDatums,dataCell,trendInfo){var serRole=this._serRole;var xRole=this._catRole;var yRole=dataCell.role;var trendOptions=dataCell.trend;this._warnSingleContinuousValueRole(yRole);var dataPartDimName=this._dataPartRole.firstDimensionName();var yDimName=yRole.firstDimensionName();var xDimName;var isXDiscrete=xRole.isDiscrete();if(!isXDiscrete){xDimName=xRole.firstDimensionName();}
var sumKeyArgs={zeroIfNone:false};var ignoreNullsKeyArgs={ignoreNulls:false};var data=this.visibleData(dataCell.dataPartValue);var allPartsData=this.visibleData(null,ignoreNullsKeyArgs);var allCatDataRoot=xRole.flatten(allPartsData,ignoreNullsKeyArgs);var allCatDatas=allCatDataRoot._children;def.scope(function(){return(serRole&&serRole.isBound())?serRole.flatten(data).children():def.query([null]);}).each(genSeriesTrend,this);function genSeriesTrend(serData1){var funX=isXDiscrete?null:function(allCatData){return allCatData.atoms[xDimName].value;};var funY=function(allCatData){var group=data._childrenByKey[allCatData.key];if(group&&serData1){group=group._childrenByKey[serData1.key];}
return group?group.dimensions(yDimName).sum(sumKeyArgs):null;};var options=def.create(trendOptions,{rows:def.query(allCatDatas),x:funX,y:funY});var trendModel=trendInfo.model(options);var dataPartAtom=data.owner.dimensions(dataPartDimName).intern(this.root._firstTrendAtomProto);if(trendModel){allCatDatas.forEach(function(allCatData,index){var trendX=isXDiscrete?index:allCatData.atoms[xDimName].value;var trendY=trendModel.sample(trendX,funY(allCatData),index);if(trendY!=null){var catData=data._childrenByKey[allCatData.key];var efCatData=catData||allCatData;var atoms;if(serData1){var catSerData=catData&&catData._childrenByKey[serData1.key];if(catSerData){atoms=Object.create(catSerData._datums[0].atoms);}else{atoms=Object.create(efCatData._datums[0].atoms);def.copyOwn(atoms,serData1.atoms);}}else{atoms=Object.create(efCatData._datums[0].atoms);}
atoms[yDimName]=trendY;atoms[dataPartDimName]=dataPartAtom;newDatums.push(def.set(new pvc.data.Datum(efCatData.owner,atoms),'isVirtual',true,'isTrend',true,'trendType',trendInfo.type));}},this);}}},_interpolateDataCell:function(dataCell){var nullInterpMode=dataCell.nullInterpolationMode;if(nullInterpMode){var InterpType;switch(dataCell.nullInterpolationMode){case'linear':InterpType=pvc.data.LinearInterpolationOper;break;case'zero':InterpType=pvc.data.ZeroInterpolationOper;break;case'none':break;default:throw def.error.argumentInvalid('nullInterpolationMode',''+nullInterpMode);}
if(InterpType){this._warnSingleContinuousValueRole(dataCell.role);var visibleData=this.visibleData(dataCell.dataPartValue);if(visibleData.childCount()>0){var allPartsData=this.visibleData(null,{ignoreNulls:false});new InterpType(allPartsData,visibleData,this._catRole,this._serRole,dataCell.role,true).interpolate();}}}},_createVisibleData:function(dataPartValue,keyArgs){var serGrouping=this._serRole&&this._serRole.flattenedGrouping();var catGrouping=this._catRole.flattenedGrouping();var partData=this.partData(dataPartValue);var ignoreNulls=def.get(keyArgs,'ignoreNulls');var inverted=def.get(keyArgs,'inverted',false);var groupKeyArgs={visible:true,isNull:ignoreNulls?false:null};return serGrouping?partData.groupBy(inverted?[serGrouping,catGrouping]:[catGrouping,serGrouping],groupKeyArgs):partData.groupBy(catGrouping,groupKeyArgs);},_getContinuousVisibleCellExtent:function(valueAxis,valueDataCell){var valueRole=valueDataCell.role;switch(valueRole.name){case'series':case'category':return this.base(valueAxis,valueDataCell);}
this._warnSingleContinuousValueRole(valueRole);var dataPartValue=valueDataCell.dataPartValue;var valueDimName=valueRole.firstDimensionName();var data=this.visibleData(dataPartValue);var useAbs=valueAxis.scaleUsesAbs();if(valueAxis.type!=='ortho'||!valueDataCell.isStacked){return data.leafs().select(function(serGroup){var value=serGroup.dimensions(valueDimName).sum();return useAbs&&value<0?-value:value;}).range();}
return data.children().select(function(catGroup){var range=this._getStackedCategoryValueExtent(catGroup,valueDimName,useAbs);if(range){return{range:range,group:catGroup};}},this).where(def.notNully).reduce(function(result,rangeInfo){return this._reduceStackedCategoryValueExtent(result,rangeInfo.range,rangeInfo.group);}.bind(this),null);},_getStackedCategoryValueExtent:function(catGroup,valueDimName,useAbs){var posSum=null,negSum=null;catGroup.children().select(function(serGroup){var value=serGroup.dimensions(valueDimName).sum();return useAbs&&value<0?-value:value;}).each(function(value){if(value!=null){if(value>=0){posSum+=value;}
else{negSum+=value;}}});if(posSum==null&&negSum==null){return null;}
return{max:posSum||0,min:negSum||0};},_reduceStackedCategoryValueExtent:function(result,catRange,catGroup){return pvc.unionExtents(result,catRange);},_coordinateSmallChartsLayout:function(scopesByType){this.base(scopesByType);var titleSizeMax=0;var titleOrthoLen;var axisIds=null;var sizesMaxByAxisId={};this.children.forEach(function(childChart){childChart.basePanel.layout();var size;var panel=childChart.titlePanel;if(panel){if(!titleOrthoLen){titleOrthoLen=panel.anchorOrthoLength();}
size=panel[titleOrthoLen];if(size>titleSizeMax){titleSizeMax=size;}}
var axesPanels=childChart.axesPanels;if(!axisIds){axisIds=def.query(def.ownKeys(axesPanels)).where(function(alias){return alias===axesPanels[alias].axis.id;}).select(function(id){sizesMaxByAxisId[id]={axis:0,title:0};return id;}).array();}
axisIds.forEach(function(id){var axisPanel=axesPanels[id];var sizes=sizesMaxByAxisId[id];var ol=axisPanel.axis.orientation==='x'?'height':'width';size=axisPanel[ol];if(size>sizes.axis){sizes.axis=size;}
var titlePanel=axisPanel.titlePanel;if(titlePanel){size=titlePanel[ol];if(size>sizes.title){sizes.title=size;}}});},this);this.children.forEach(function(childChart){if(titleSizeMax>0){var panel=childChart.titlePanel;panel.size=panel.size.clone().set(titleOrthoLen,titleSizeMax);}
var axesPanels=childChart.axesPanels;axisIds.forEach(function(id){var axisPanel=axesPanels[id];var sizes=sizesMaxByAxisId[id];var ol=axisPanel.axis.orientation==='x'?'height':'width';axisPanel.size=axisPanel.size.clone().set(ol,sizes.axis);var titlePanel=axisPanel.titlePanel;if(titlePanel){titlePanel.size=titlePanel.size.clone().set(ol,sizes.title);}});childChart.basePanel.invalidateLayout();},this);},defaults:{orthoAxisOrdinal:false}});def.type('pvc.CategoricalAbstractPanel',pvc.CartesianAbstractPanel).init(function(chart,parent,plot,options){this.base(chart,parent,plot,options);this.stacked=plot.option('Stacked');});def.type('pvc.AxisPanel',pvc.BasePanel).init(function(chart,parent,axis,options){options=def.create(options,{anchor:axis.option('Position')});var anchor=options.anchor||this.anchor;this.axis=axis;this.base(chart,parent,options);this.roleName=axis.role.name;this.isDiscrete=axis.role.isDiscrete();this._extensionPrefix=axis.extensionPrefixes;if(this.labelSpacingMin==null){this.labelSpacingMin=this.isDiscrete?0.25:1.5;}
if(this.showTicks==null){this.showTicks=!this.isDiscrete;}
if(options.font===undefined){var extFont=this._getConstantExtension('label','font');if(extFont){this.font=extFont;}}
if(options.tickLength===undefined){var tickLength=+this._getConstantExtension('ticks',this.anchorOrthoLength(anchor));if(!isNaN(tickLength)&&isFinite(tickLength)){this.tickLength=tickLength;}}}).add({pvRule:null,pvTicks:null,pvLabel:null,pvRuleGrid:null,pvScale:null,isDiscrete:false,roleName:null,axis:null,anchor:"bottom",tickLength:6,scale:null,ruleCrossesMargin:true,font:'9px sans-serif',labelSpacingMin:null,desiredTickCount:null,showMinorTicks:true,showTicks:null,hiddenLabelText:"\u00B7",_isScaleSetup:false,_createLogInstanceId:function(){return this.base()+" - "+this.axis.id;},getTicks:function(){return this._layoutInfo&&this._layoutInfo.ticks;},_calcLayout:function(layoutInfo){var scale=this.axis.scale;if(!this._isScaleSetup){this.pvScale=scale;this.scale=scale;this.extend(scale,"scale");this._isScaleSetup=true;}
if(scale.isNull){layoutInfo.axisSize=0;}else{this._calcLayoutCore(layoutInfo);}
return this.createAnchoredSize(layoutInfo.axisSize,layoutInfo.clientSize);},_calcLayoutCore:function(layoutInfo){var axisSize=layoutInfo.desiredClientSize[this.anchorOrthoLength()];layoutInfo.axisSize=axisSize;if(this.isDiscrete&&this.useCompositeAxis){if(layoutInfo.axisSize==null){layoutInfo.axisSize=50;}}else{this._readTextProperties(layoutInfo);this._calcTicks();if(this.scale.type==='discrete'){this._tickIncludeModulo=this._calcDiscreteTicksIncludeModulo();}
this._calcAxisSizeFromLabel(layoutInfo);if(layoutInfo.axisSize==null){layoutInfo.axisSize=layoutInfo.requiredAxisSize;}
this._calcMaxTextLengthThatFits();this._calcOverflowPaddings();}},_calcAxisSizeFromLabel:function(layoutInfo){this._calcTicksLabelBBoxes(layoutInfo);this._calcAxisSizeFromLabelBBox(layoutInfo);},_readTextProperties:function(layoutInfo){var textAngle=this._getExtension('label','textAngle');layoutInfo.isTextAngleFixed=(textAngle!=null);layoutInfo.textAngle=def.number.as(textAngle,0);layoutInfo.textMargin=def.number.as(this._getExtension('label','textMargin'),3);var align=this._getExtension('label','textAlign');if(typeof align!=='string'){align=this.isAnchorTopOrBottom()?"center":(this.anchor=="left")?"right":"left";}
layoutInfo.textAlign=align;var baseline=this._getExtension('label','textBaseline');if(typeof baseline!=='string'){switch(this.anchor){case"right":case"left":case"center":baseline="middle";break;case"bottom":baseline="top";break;default:baseline="bottom";}}
layoutInfo.textBaseline=baseline;},_calcAxisSizeFromLabelBBox:function(layoutInfo){var maxLabelBBox=layoutInfo.maxLabelBBox;var length=this._getLabelBBoxQuadrantLength(maxLabelBBox,this.anchor);var axisSize=this.tickLength+length;var angle=maxLabelBBox.sourceAngle;if(!(angle===0&&this.isAnchorTopOrBottom())){axisSize+=this.tickLength;}
layoutInfo.requiredAxisSize=axisSize;},_getLabelBBoxQuadrantLength:function(labelBBox,quadrantSide){var length;switch(quadrantSide){case'left':length=-labelBBox.x;break;case'right':length=labelBBox.x2;break;case'top':length=-labelBBox.y;break;case'bottom':length=labelBBox.y2;break;}
return Math.max(length,0);},_calcOverflowPaddings:function(){if(!this._layoutInfo.canChange){if(pvc.debug>=2){this._warn("Layout cannot change. Skipping calculation of overflow paddings.");}
return;}
this._calcOverflowPaddingsFromLabelBBox();},_calcOverflowPaddingsFromLabelBBox:function(){var overflowPaddings=null;var me=this;var li=me._layoutInfo;var ticks=li.ticks;var tickCount=ticks.length;if(tickCount){var ticksBBoxes=li.ticksBBoxes;var paddings=li.paddings;var isTopOrBottom=me.isAnchorTopOrBottom();var begSide=isTopOrBottom?'left':'bottom';var endSide=isTopOrBottom?'right':'top';var scale=me.scale;var isDiscrete=scale.type==='discrete';var clientLength=li.clientSize[me.anchorLength()];this.axis.setScaleRange(clientLength);var evalLabelSideOverflow=function(labelBBox,side,isBegin,index){var sideLength=me._getLabelBBoxQuadrantLength(labelBBox,side);if(sideLength>1){var anchorPosition=scale(isDiscrete?ticks[index].value:ticks[index]);var sidePosition=isBegin?(anchorPosition-sideLength):(anchorPosition+sideLength);var sideOverflow=Math.max(0,isBegin?-sidePosition:(sidePosition-clientLength));if(sideOverflow>1){sideOverflow-=(paddings[side]||0);if(sideOverflow>1){if(isDiscrete){sideOverflow*=1.05;}
if(!overflowPaddings){overflowPaddings=def.set({},side,sideOverflow);}else{var currrOverflowPadding=overflowPaddings[side];if(currrOverflowPadding==null||(currrOverflowPadding<sideOverflow)){overflowPaddings[side]=sideOverflow;}}}}}};ticksBBoxes.forEach(function(labelBBox,index){evalLabelSideOverflow(labelBBox,begSide,true,index);evalLabelSideOverflow(labelBBox,endSide,false,index);});if(pvc.debug>=6&&overflowPaddings){me._log("OverflowPaddings = "+pvc.stringify(overflowPaddings));}}
li.overflowPaddings=overflowPaddings;},_calcMaxTextLengthThatFits:function(){var layoutInfo=this._layoutInfo;if(this.compatVersion()<=1){layoutInfo.maxTextWidth=null;return;}
var availableClientLength=layoutInfo.clientSize[this.anchorOrthoLength()];var efSize=Math.min(layoutInfo.axisSize,availableClientLength);if(efSize>=(layoutInfo.requiredAxisSize-this.tickLength)){layoutInfo.maxTextWidth=null;}else{var maxLabelBBox=layoutInfo.maxLabelBBox;var maxOrthoLength=efSize-2*this.tickLength;var mostOrthoDistantPoint;var parallelDirection;switch(this.anchor){case'left':parallelDirection=pv.vector(0,1);mostOrthoDistantPoint=pv.vector(-maxOrthoLength,0);break;case'right':parallelDirection=pv.vector(0,1);mostOrthoDistantPoint=pv.vector(maxOrthoLength,0);break;case'top':parallelDirection=pv.vector(1,0);mostOrthoDistantPoint=pv.vector(0,-maxOrthoLength);break;case'bottom':parallelDirection=pv.vector(1,0);mostOrthoDistantPoint=pv.vector(0,maxOrthoLength);break;}
var orthoOutwardsDir=mostOrthoDistantPoint.norm();var corners=maxLabelBBox.source.points();var botL=corners[0];var botR=corners[1];var topR=corners[2];var topL=corners[3];var topLRSideDir=topR.minus(topL);var botLRSideDir=botR.minus(botL);var intersect=pv.SvgScene.lineIntersect;var botI=intersect(mostOrthoDistantPoint,parallelDirection,botL,botLRSideDir);var topI=intersect(mostOrthoDistantPoint,parallelDirection,topL,topLRSideDir);var sideLRWidth=maxLabelBBox.sourceTextWidth;var maxTextWidth=sideLRWidth;var botLI=botI.minus(botL);var botLILen=botLI.length();if(botLILen<=sideLRWidth&&botLI.dot(topLRSideDir)>=0){if(botL.dot(orthoOutwardsDir)<botR.dot(orthoOutwardsDir)){maxTextWidth=botLILen;}else{maxTextWidth=botI.minus(botR).length();}}
var topLI=topI.minus(topL);var topLILen=topLI.length();if(topLILen<=sideLRWidth&&topLI.dot(topLRSideDir)>=0){if(topL.dot(orthoOutwardsDir)<topR.dot(orthoOutwardsDir)){maxTextWidth=Math.min(maxTextWidth,topLILen);}else{maxTextWidth=Math.min(maxTextWidth,topI.minus(topR).length());}}
if(maxLabelBBox.sourceAlign==='center'){var cutWidth=sideLRWidth-maxTextWidth;maxTextWidth-=cutWidth;}
layoutInfo.maxTextWidth=maxTextWidth;if(pvc.debug>=3){this._log("Trimming labels' text at length "+maxTextWidth.toFixed(2)+"px maxOrthoLength="+maxOrthoLength.toFixed(2)+"px");}}},_calcTicks:function(){var layoutInfo=this._layoutInfo;layoutInfo.textHeight=pv.Text.fontHeight(this.font)*2/3;layoutInfo.maxTextWidth=null;this.axis.setTicks(null);switch(this.scale.type){case'discrete':this._calcDiscreteTicks();break;case'timeSeries':this._calcTimeSeriesTicks();break;case'numeric':this._calcNumberTicks(layoutInfo);break;default:throw def.error.operationInvalid("Undefined axis scale type");}
this.axis.setTicks(layoutInfo.ticks);var clientLength=layoutInfo.clientSize[this.anchorLength()];this.axis.setScaleRange(clientLength);if(layoutInfo.maxTextWidth==null){this._calcTicksTextLength(layoutInfo);}},_calcDiscreteTicks:function(){var layoutInfo=this._layoutInfo;var role=this.axis.role;var data=role.flatten(this.data,{visible:true});layoutInfo.data=data;layoutInfo.ticks=data._children;var format,dimType;var grouping=role.grouping;if(grouping.isSingleDimension&&(dimType=grouping.firstDimensionType())&&(dimType.valueType===Date)){var extent=data.dimensions(dimType.name).extent();if(extent&&extent.min!==extent.max){var scale=new pv.Scale.linear(extent.min.value,extent.max.value);scale.ticks();var tickFormatter=this.axis.option('TickFormatter');if(tickFormatter){scale.tickFormatter(tickFormatter);}
format=function(child){return scale.tickFormat(child.value);};}}
if(!format){format=function(child){return child.absLabel;};}
layoutInfo.ticksText=data._children.map(format);this._clearTicksTextDeps(layoutInfo);},_clearTicksTextDeps:function(ticksInfo){ticksInfo.maxTextWidth=ticksInfo.ticksTextLength=ticksInfo.ticksBBoxes=null;},_calcTimeSeriesTicks:function(){this._calcContinuousTicks(this._layoutInfo);},_calcNumberTicks:function(){var desiredTickCount=this.desiredTickCount;if(desiredTickCount==null){if(this.isAnchorTopOrBottom()){this._calcNumberHTicks();return;}
desiredTickCount=this._calcNumberVDesiredTickCount();}
this._calcContinuousTicks(this._layoutInfo,desiredTickCount);},_calcContinuousTicks:function(ticksInfo,desiredTickCount){this._calcContinuousTicksValue(ticksInfo,desiredTickCount);this._calcContinuousTicksText(ticksInfo);},_calcContinuousTicksValue:function(ticksInfo,desiredTickCount){ticksInfo.ticks=this.axis.calcContinuousTicks(desiredTickCount);if(pvc.debug>4){this._log("DOMAIN: "+pvc.stringify(this.scale.domain()));this._log("TICKS:  "+pvc.stringify(ticksInfo.ticks));}},_calcContinuousTicksText:function(ticksInfo){var ticksText=ticksInfo.ticksText=ticksInfo.ticks.map(function(tick){return this.scale.tickFormat(tick);},this);this._clearTicksTextDeps(ticksInfo);return ticksText;},_calcTicksTextLength:function(ticksInfo){var max=0;var font=this.font;var ticksText=ticksInfo.ticksText||this._calcContinuousTicksText(ticksInfo);var ticksTextLength=ticksInfo.ticksTextLength=ticksText.map(function(text){var len=pv.Text.measure(text,font).width;if(len>max){max=len;}
return len;});ticksInfo.maxTextWidth=max;ticksInfo.ticksBBoxes=null;return ticksTextLength;},_calcTicksLabelBBoxes:function(ticksInfo){var me=this;var li=me._layoutInfo;var ticksTextLength=ticksInfo.ticksTextLength||me._calcTicksTextLength(ticksInfo);var maxBBox;var maxLen=li.maxTextWidth;ticksInfo.ticksBBoxes=ticksTextLength.map(function(len){var labelBBox=me._calcLabelBBox(len);if(!maxBBox&&len===maxLen){maxBBox=labelBBox;}
return labelBBox;},me);li.maxLabelBBox=maxBBox;},_calcLabelBBox:function(textWidth){var li=this._layoutInfo;return pvc.text.getLabelBBox(textWidth,li.textHeight,li.textAlign,li.textBaseline,li.textAngle,li.textMargin);},_calcDiscreteTicksIncludeModulo:function(){var mode=this.axis.option('OverlappedLabelsMode');if(mode!=='hide'&&mode!=='rotatethenhide'){return 1;}
var li=this._layoutInfo;var ticks=li.ticks;var tickCount=ticks.length;if(tickCount<=2){return 1;}
var b=this.scale.range().step;var h=li.textHeight;var w=li.maxTextWidth;if(!(w>0&&h>0&&b>0)){return 1;}
var sMin=h*this.labelSpacingMin;var sMinH=sMin;var spaceW=pv.Text.measure('x',this.font).width;var sMinW=spaceW+sMin;var a=li.textAngle;var isH=this.isAnchorTopOrBottom();var sinOrCos=Math.abs(Math[isH?'sin':'cos'](a));var cosOrSin=Math.abs(Math[isH?'cos':'sin'](a));var timh=sinOrCos<1e-8?Infinity:Math.ceil((sMinH+h)/(b*sinOrCos));var timw=cosOrSin<1e-8?Infinity:Math.ceil((sMinW+w)/(b*cosOrSin));var tim=Math.min(timh,timw);if(!isFinite(tim)||tim<1||Math.ceil(tickCount/tim)<2){tim=1;}
if(tim>1&&pvc.debug>=3){this._info("Showing only one in every "+tim+" tick labels");}
return tim;},_tickMultipliers:[1,2,5,10],_calcNumberVDesiredTickCount:function(){var li=this._layoutInfo;var lineHeight=li.textHeight*(1+Math.max(0,this.labelSpacingMin));var clientLength=li.clientSize[this.anchorLength()];var tickCountMax=Math.max(1,~~(clientLength/lineHeight));if(tickCountMax<=1){return 1;}
var domain=this.scale.domain();var span=domain[1]-domain[0];if(span<=0){return tickCountMax;}
var stepMin=span/tickCountMax;var exponMin=Math.floor(pv.log(stepMin,10));var stepBase=Math.pow(10,exponMin);var step;var ms=this._tickMultipliers;for(var i=0;i<ms.length;i++){step=ms[i]*stepBase;if(step>=stepMin){break;}}
return Math.max(1,Math.floor(span/step));},_calcNumberHTicks:function(){var layoutInfo=this._layoutInfo;var clientLength=layoutInfo.clientSize[this.anchorLength()];var spacing=layoutInfo.textHeight*Math.max(0,this.labelSpacingMin);var desiredTickCount=this._calcNumberHDesiredTickCount(spacing);var doLog=(pvc.debug>=7);var dir,prevResultTickCount;var ticksInfo,lastBelow,lastAbove;do{if(doLog){this._log("calculateNumberHTicks TickCount IN desired = "+desiredTickCount);}
ticksInfo={};this._calcContinuousTicksValue(ticksInfo,desiredTickCount);var ticks=ticksInfo.ticks;var resultTickCount=ticks.length;if(ticks.exponentOverflow){if(dir==null){if(ticks.exponent===this.exponentMin){lastBelow=ticksInfo;dir=1;}else{lastAbove=ticksInfo;dir=-1;}}else if(dir===1){if(lastBelow){ticksInfo=lastBelow;}
break;}else{if(lastAbove){ticksInfo=lastAbove;}
break;}}else if(prevResultTickCount==null||resultTickCount!==prevResultTickCount){if(doLog){this._log("calculateNumberHTicks TickCount desired/resulting = "+desiredTickCount+" -> "+resultTickCount);}
prevResultTickCount=resultTickCount;this._calcContinuousTicksText(ticksInfo);var length=this._calcNumberHLength(ticksInfo,spacing);var excessLength=ticksInfo.excessLength=length-clientLength;var pctError=ticksInfo.error=Math.abs(excessLength/clientLength);if(doLog){this._log("calculateNumberHTicks error="+(excessLength>=0?"+":"-")+(ticksInfo.error*100).toFixed(0)+"% count="+resultTickCount+" step="+ticks.step);this._log("calculateNumberHTicks Length client/resulting = "+clientLength+" / "+length+" spacing = "+spacing);}
if(excessLength>0){if(desiredTickCount===1){if(resultTickCount===3&&pctError<=1){ticksInfo.ticks.splice(1,1);ticksInfo.ticksText.splice(1,1);ticksInfo.ticks.step*=2;}else{ticksInfo.ticks.length=1;ticksInfo.ticksText.length=1;}
delete ticksInfo.maxTextWidth;break;}
if(lastBelow){ticksInfo=lastBelow;break;}
lastAbove=ticksInfo;dir=-1;}else{if(pctError<=0.05||dir===-1){break;}
lastBelow=ticksInfo;dir=+1;}}
desiredTickCount+=dir;}while(true);if(ticksInfo){layoutInfo.ticks=ticksInfo.ticks;layoutInfo.ticksText=ticksInfo.ticksText;layoutInfo.maxTextWidth=ticksInfo.maxTextWidth;if(pvc.debug>=5){this._log("calculateNumberHTicks RESULT error="+(ticksInfo.excessLength>=0?"+":"-")+(ticksInfo.error*100).toFixed(0)+"% count="+ticksInfo.ticks.length+" step="+ticksInfo.ticks.step);}}
if(doLog){this._log("calculateNumberHTicks END");}},_calcNumberHDesiredTickCount:function(spacing){var layoutInfo=this._layoutInfo;var domainTextLength=this.scale.domain().map(function(tick){tick=+tick.toFixed(2);var text=this.scale.tickFormat(tick);return pv.Text.measure(text,this.font).width;},this);var avgTextLength=Math.max((domainTextLength[1]+domainTextLength[0])/2,layoutInfo.textHeight);var clientLength=layoutInfo.clientSize[this.anchorLength()];return Math.max(1,~~(clientLength/(avgTextLength+spacing)));},_calcNumberHLength:function(ticksInfo,spacing){var ticksText=ticksInfo.ticksText;var maxTextWidth=def.query(ticksText).select(function(text){return pv.Text.measure(text,this.font).width;},this).max();return Math.max(maxTextWidth,(ticksText.length-1)*(maxTextWidth+spacing));},_createCore:function(){if(this.scale.isNull){return;}
var clientSize=this._layoutInfo.clientSize;var paddings=this._layoutInfo.paddings;var begin_a=this.anchorOrtho();var end_a=this.anchorOpposite(begin_a);var size_a=this.anchorOrthoLength(begin_a);var rMin=this.ruleCrossesMargin?-paddings[begin_a]:0;var rMax=clientSize[size_a]+(this.ruleCrossesMargin?paddings[end_a]:0);var rSize=rMax-rMin;this._rSize=rSize;var rootScene=this._getRootScene();this.pvRule=new pvc.visual.Rule(this,this.pvPanel,{extensionId:'rule'}).lock('data',[rootScene]).override('defaultColor',def.fun.constant("#666666")).lock(this.anchorOpposite(),0).lock(begin_a,rMin).lock(size_a,rSize).pvMark.zOrder(30).strokeDasharray(null).lineCap('square');if(this.isDiscrete){if(this.useCompositeAxis){this.renderCompositeOrdinalAxis();}else{this.renderOrdinalAxis();}}else{this.renderLinearAxis();}},_getExtensionId:function(){return'';},_getRootScene:function(){if(!this._rootScene){var rootScene=this._rootScene=new pvc.visual.CartesianAxisRootScene(null,{panel:this,source:this._getRootData()});var layoutInfo=this._layoutInfo;var ticks=layoutInfo.ticks;var ticksText=layoutInfo.ticksText;if(this.isDiscrete){if(this.useCompositeAxis){this._buildCompositeScene(rootScene);}else{var includeModulo=this._tickIncludeModulo;var hiddenLabelText=this.hiddenLabelText;rootScene.vars.tickIncludeModulo=includeModulo;rootScene.vars.hiddenLabelText=hiddenLabelText;var hiddenDatas,hiddenTexts,createHiddenScene,hiddenIndex;if(includeModulo>2){var keySep=rootScene.group.owner.keySep;createHiddenScene=function(){var k=hiddenDatas.map(function(d){return d.key;}).join(keySep);var l=hiddenTexts.slice(0,10).join(', ')+(hiddenTexts.length>10?', ...':'');var scene=new pvc.visual.CartesianAxisTickScene(rootScene,{source:hiddenDatas,tick:k,tickRaw:k,tickLabel:l,isHidden:true});scene.dataIndex=hiddenIndex;hiddenDatas=hiddenTexts=hiddenIndex=null;};}
ticks.forEach(function(tickData,index){var isHidden=(index%includeModulo)!==0;if(isHidden&&includeModulo>2){if(hiddenIndex==null){hiddenIndex=index;}
(hiddenDatas||(hiddenDatas=[])).push(tickData);(hiddenTexts||(hiddenTexts=[])).push(ticksText[index]);}else{if(hiddenDatas){createHiddenScene();}
var scene=new pvc.visual.CartesianAxisTickScene(rootScene,{source:tickData,tick:tickData.value,tickRaw:tickData.rawValue,tickLabel:ticksText[index],isHidden:isHidden});scene.dataIndex=index;}});if(hiddenDatas){createHiddenScene();}}}else{ticks.forEach(function(majorTick,index){var scene=new pvc.visual.CartesianAxisTickScene(rootScene,{tick:majorTick,tickRaw:majorTick,tickLabel:ticksText[index]});scene.dataIndex=index;},this);}}
return this._rootScene;},_buildCompositeScene:function(rootScene){var isV1Compat=this.compatVersion()<=1;rootScene.vars.tick=new pvc_ValueLabelVar('',"");recursive(rootScene);function recursive(scene){var data=scene.group;if(isV1Compat){var tickVar=scene.vars.tick;scene.nodeValue=scene.value=tickVar.rawValue;scene.nodeLabel=scene.label=tickVar.label;}
if(data.childCount()){data.children().each(function(childData){var childScene=new pvc.visual.CartesianAxisTickScene(scene,{source:childData,tick:childData.value,tickRaw:childData.rawValue,tickLabel:childData.label});childScene.dataIndex=childData.childIndex();recursive(childScene);});}}},_getRootData:function(){var chart=this.chart;var data=chart.data;if(this.isDiscrete&&this.useCompositeAxis){var orientation=this.anchor;var reverse=orientation=='bottom'||orientation=='left';data=chart.visualRoles[this.roleName].select(data,{visible:true,reverse:reverse});}
return data;},renderOrdinalAxis:function(){var scale=this.scale,hiddenLabelText=this.hiddenLabelText,includeModulo=this._tickIncludeModulo,hiddenStep2=includeModulo*scale.range().step/2,anchorOpposite=this.anchorOpposite(),anchorLength=this.anchorLength(),anchorOrtho=this.anchorOrtho(),anchorOrthoLength=this.anchorOrthoLength(),pvRule=this.pvRule,rootScene=this._getRootScene(),layoutInfo=this._layoutInfo,isV1Compat=this.compatVersion()<=1;var wrapper;if(isV1Compat){var DataElement=function(tickVar){this.value=this.absValue=tickVar.rawValue;this.nodeName=''+(this.value||'');this.path=this.nodeName?[this.nodeName]:[];this.label=this.absLabel=tickVar.label;};DataElement.prototype.toString=function(){return''+this.value;};wrapper=function(v1f){return function(tickScene){var markWrapped=Object.create(this);markWrapped.index=this.parent.index;return v1f.call(markWrapped,new DataElement(tickScene.vars.tick));};};}
var pvTicksPanel=new pvc.visual.Panel(this,this.pvPanel,{extensionId:'ticksPanel'}).lock('data',rootScene.childNodes).lock(anchorOpposite,0).lockMark(anchorOrtho,function(tickScene){return tickScene.isHidden?scale(tickScene.previousSibling.vars.tick.value)+hiddenStep2:scale(tickScene.vars.tick.value);}).lock('strokeDasharray',null).lock('strokeStyle',null).lock('fillStyle',null).lock('lineWidth',0).pvMark.zOrder(20);if(isV1Compat||this.showTicks){var pvTicks=this.pvTicks=new pvc.visual.Rule(this,pvTicksPanel,{extensionId:'ticks',wrapper:wrapper}).lock('data').intercept('visible',function(){return!this.scene.isHidden&&this.delegateExtension(true);}).optional('lineWidth',1).lock(anchorOpposite,0).lock(anchorOrtho,0).lock(anchorLength,null).optional(anchorOrthoLength,this.tickLength*2/3).override('defaultColor',function(type){if(isV1Compat){return pv.Color.names.transparent;}
return pvRule.scene?pvRule.scene[0].strokeStyle:"#666666";}).pvMark;}
var font=this.font;var maxTextWidth=this._layoutInfo.maxTextWidth;if(!isFinite(maxTextWidth)){maxTextWidth=0;}
this.pvLabel=new pvc.visual.Label(this,pvTicksPanel,{extensionId:'label',showsInteraction:true,noClick:false,noDoubleClick:false,noSelect:false,noTooltip:false,noHover:false,wrapper:wrapper}).intercept('visible',function(tickScene){return!tickScene.isHidden?this.delegateExtension(true):!!tickScene.vars.hiddenLabelText;}).intercept('text',function(tickScene){var text;if(tickScene.isHidden){text=hiddenLabelText;}else{text=this.delegateExtension();if(text===undefined){text=tickScene.vars.tick.label;}
if(maxTextWidth&&(!this.showsInteraction()||!this.scene.isActive)){text=pvc.text.trimToWidthB(maxTextWidth,text,font,"..",false);}}
return text;}).pvMark.zOrder(40).lock(anchorOpposite,this.tickLength).lock(anchorOrtho,0).font(font).textStyle("#666666").textAlign(layoutInfo.textAlign).textBaseline(layoutInfo.textBaseline);this._debugTicksPanel(pvTicksPanel);},_getTooltipFormatter:function(tipOptions){if(this.axis.option('TooltipEnabled')){tipOptions.gravity=this._calcTipsyGravity();var tooltipFormat=this.axis.option('TooltipFormat');if(tooltipFormat){return function(context){return tooltipFormat.call(context,context.scene);};}
var autoContent=this.axis.option('TooltipAutoContent');if(autoContent==='summary'){return this._summaryTooltipFormatter;}
if(autoContent==='value'){tipOptions.isLazy=false;return function(context){return context.scene.vars.tick.label;};}}},_debugTicksPanel:function(pvTicksPanel){if(pvc.debug>=16){var font=this.font;var li=this._layoutInfo;var ticksBBoxes=li.ticksBBoxes||this._calcTicksLabelBBoxes(li);pvTicksPanel.add(pv.Panel)
[this.anchorOpposite()](this.tickLength)
[this.anchorOrtho()](0)
[this.anchorLength()](0)
[this.anchorOrthoLength()](0).fillStyle(null).strokeStyle(null).lineWidth(0).visible(function(tickScene){return!tickScene.isHidden;}).add(pv.Line).data(function(scene){var labelBBox=ticksBBoxes[scene.dataIndex];var corners=labelBBox.source.points();if(corners.length>1){corners=corners.concat(corners[0]);}
return corners;}).left(function(p){return p.x;}).top(function(p){return p.y;}).strokeStyle('red').lineWidth(0.5).strokeDasharray('-');}},renderLinearAxis:function(){var scale=this.scale,pvRule=this.pvRule,anchorOpposite=this.anchorOpposite(),anchorLength=this.anchorLength(),anchorOrtho=this.anchorOrtho(),anchorOrthoLength=this.anchorOrthoLength(),rootScene=this._getRootScene();var wrapper;if(this.compatVersion()<=1){wrapper=function(v1f){return function(tickScene){var markWrapped=Object.create(this);markWrapped.index=this.parent.index;return v1f.call(markWrapped,tickScene.vars.tick.rawValue);};};}
var pvTicksPanel=new pvc.visual.Panel(this,this.pvPanel,{extensionId:'ticksPanel'}).lock('data',rootScene.childNodes).lock(anchorOpposite,0).lockMark(anchorOrtho,function(tickScene){return scale(tickScene.vars.tick.value);}).lock('strokeStyle',null).lock('fillStyle',null).lock('lineWidth',0).pvMark.zOrder(20);if(this.showTicks){var pvTicks=this.pvTicks=new pvc.visual.Rule(this,pvTicksPanel,{extensionId:'ticks',wrapper:wrapper}).lock('data').override('defaultColor',function(){return pvRule.scene?pvRule.scene[0].strokeStyle:"#666666";}).lock(anchorOpposite,0).lock(anchorOrtho,0).lock(anchorLength,null).optional(anchorOrthoLength,this.tickLength).pvMark;if(this.showMinorTicks){var layoutInfo=this._layoutInfo;var ticks=layoutInfo.ticks;var tickCount=ticks.length;var minorTickOffset=tickCount>1?Math.abs(scale(ticks[1])-scale(ticks[0]))/2:0;this.pvMinorTicks=new pvc.visual.Rule(this,this.pvTicks,{extensionId:'minorTicks',wrapper:wrapper}).lock('data').intercept('visible',function(){var visible=(this.index<tickCount-1)&&(!pvTicks.scene||pvTicks.scene[0].visible);return visible&&this.delegateExtension(true);}).override('defaultColor',function(){return pvTicks.scene?pvTicks.scene[0].strokeStyle:pv.Color.names.d;}).lock(anchorOpposite,0).lock(anchorLength,null).optional(anchorOrthoLength,this.tickLength/2).lockMark(anchorOrtho,minorTickOffset).pvMark;}}
this.renderLinearAxisLabel(pvTicksPanel,wrapper);this._debugTicksPanel(pvTicksPanel);},renderLinearAxisLabel:function(pvTicksPanel,wrapper){var pvTicks=this.pvTicks;var anchorOpposite=this.anchorOpposite();var anchorOrtho=this.anchorOrtho();var scale=this.scale;var font=this.font;var maxTextWidth=this._layoutInfo.maxTextWidth;if(!isFinite(maxTextWidth)){maxTextWidth=0;}
var label=this.pvLabel=new pvc.visual.Label(this,pvTicksPanel,{extensionId:'label',noHover:false,showsInteraction:true,wrapper:wrapper}).lock('data').intercept('text',function(tickScene){var text=tickScene.vars.tick.label;if(maxTextWidth&&(!this.showsInteraction()||!this.scene.isActive)){text=pvc.text.trimToWidthB(maxTextWidth,text,font,'..',false);}
return text;}).pvMark.lock(anchorOpposite,this.tickLength).lock(anchorOrtho,0).zOrder(40).font(this.font).textStyle("#666666");var rootPanel=this.pvPanel.root;if(this.isAnchorTopOrBottom()){label.textBaseline(anchorOpposite).textAlign(function(tickScene){var absLeft;if(this.index===0){absLeft=label.toScreenTransform().transformHPosition(label.left());if(absLeft<=0){return'left';}}else if(this.index===tickScene.parent.childNodes.length-1){absLeft=label.toScreenTransform().transformHPosition(label.left());if(absLeft>=rootPanel.width()){return'right';}}
return'center';});}else{label.textAlign(anchorOpposite).textBaseline(function(tickScene){var absTop;if(this.index===0){absTop=label.toScreenTransform().transformVPosition(label.top());if(absTop>=rootPanel.height()){return'bottom';}}else if(this.index===tickScene.parent.childNodes.length-1){absTop=label.toScreenTransform().transformVPosition(label.top());if(absTop<=0){return'top';}}
return'middle';});}},_onV1Click:function(context,handler){if(this.isDiscrete&&this.useCompositeAxis){handler.call(context.pvMark,context.scene,context.event);}},_onV1DoubleClick:function(context,handler){if(this.isDiscrete&&this.useCompositeAxis){handler.call(context.pvMark,context.scene,context.event);}},_getSelectableMarks:function(){if(this.isDiscrete&&this.isVisible&&this.pvLabel){return this.base();}},renderCompositeOrdinalAxis:function(){var isTopOrBottom=this.isAnchorTopOrBottom(),axisDirection=isTopOrBottom?'h':'v',diagDepthCutoff=2,vertDepthCutoff=2,font=this.font;var diagMargin=pv.Text.fontHeight(font)/2;var layout=this._pvLayout=this.getLayoutSingleCluster();layout.node.def("fitInfo",null).height(function(tickScene,e,f){var fitInfo=pvc.text.getFitInfo(tickScene.dx,tickScene.dy,tickScene.vars.tick.label,font,diagMargin);if(!fitInfo.h){if(axisDirection==='v'&&fitInfo.v){vertDepthCutoff=Math.min(diagDepthCutoff,tickScene.depth);}else{diagDepthCutoff=Math.min(diagDepthCutoff,tickScene.depth);}}
this.fitInfo(fitInfo);return tickScene.dy;});layout.node.add(pv.Bar).fillStyle('rgba(127,127,127,.001)').strokeStyle(function(tickScene){if(tickScene.maxDepth===1||!tickScene.maxDepth){return null;}
return"rgba(127,127,127,0.3)";}).lineWidth(function(tickScene){if(tickScene.maxDepth===1||!tickScene.maxDepth){return 0;}
return 0.5;}).text(function(tickScene){return tickScene.vars.tick.label;});var H_CUTOFF_ANG=0.30,V_CUTOFF_ANG=1.27;var align=isTopOrBottom?"center":(this.anchor=="left")?"right":"left";var wrapper;if(this.compatVersion()<=1){wrapper=function(v1f){return function(tickScene){return v1f.call(this,tickScene);};};}
this.pvLabel=new pvc.visual.Label(this,layout.label,{extensionId:'label',noClick:false,noDoubleClick:false,noSelect:false,noTooltip:false,noHover:false,showsInteraction:true,wrapper:wrapper,tooltipArgs:{options:{offset:diagMargin*2}}}).pvMark.def('lblDirection','h').textAngle(function(tickScene){if(tickScene.depth>=vertDepthCutoff&&tickScene.depth<diagDepthCutoff){this.lblDirection('v');return-Math.PI/2;}
if(tickScene.depth>=diagDepthCutoff){var tan=tickScene.dy/tickScene.dx;var angle=Math.atan(tan);if(angle>V_CUTOFF_ANG){this.lblDirection('v');return-Math.PI/2;}
if(angle>H_CUTOFF_ANG){this.lblDirection('d');return-angle;}}
this.lblDirection('h');return 0;}).textMargin(1).textAlign(function(tickScene){return(axisDirection!='v'||tickScene.depth>=vertDepthCutoff||tickScene.depth>=diagDepthCutoff)?'center':align;}).left(function(tickScene){return(axisDirection!='v'||tickScene.depth>=vertDepthCutoff||tickScene.depth>=diagDepthCutoff)?tickScene.x+tickScene.dx/2:((align=='right')?tickScene.x+tickScene.dx:tickScene.x);}).font(font).textStyle("#666666").text(function(tickScene){var label=tickScene.vars.tick.label;var sign=this.sign;if(!sign.scene.isActive||!sign.showsInteraction()){var fitInfo=this.fitInfo();switch(this.lblDirection()){case'h':if(!fitInfo.h){return pvc.text.trimToWidthB(tickScene.dx,label,font,'..');}
break;case'v':if(!fitInfo.v){return pvc.text.trimToWidthB(tickScene.dy,label,font,'..');}
break;case'd':if(!fitInfo.d){var diagonalLength=Math.sqrt(def.sqr(tickScene.dy)+def.sqr(tickScene.dx));return pvc.text.trimToWidthB(diagonalLength-diagMargin,label,font,'..');}
break;}}
return label;});},getLayoutSingleCluster:function(){var rootScene=this._getRootScene(),orientation=this.anchor,maxDepth=rootScene.group.treeHeight,depthLength=this._layoutInfo.axisSize;maxDepth++;var baseDisplacement=depthLength/maxDepth,margin=maxDepth>2?((1/12)*depthLength):0;baseDisplacement-=margin;var scaleFactor=maxDepth/(maxDepth-1),orthoLength=pvc.BasePanel.orthogonalLength[orientation];var displacement=(orthoLength=='width')?(orientation==='left'?[-baseDisplacement,0]:[baseDisplacement,0]):(orientation==='top'?[0,-baseDisplacement]:[0,baseDisplacement]);this.pvRule.sign.override('defaultColor',def.fun.constant(null)).override('defaultStrokeWidth',def.fun.constant(0));var panel=this.pvRule.add(pv.Panel)
[orthoLength](depthLength).strokeStyle(null).lineWidth(0).add(pv.Panel)
[orthoLength](depthLength*scaleFactor).strokeStyle(null).lineWidth(0);panel.transform(pv.Transform.identity.translate(displacement[0],displacement[1]));return panel.add(pv.Layout.Cluster.Fill).nodes(rootScene.nodes()).orient(orientation);},_calcTipsyGravity:function(){switch(this.anchor){case'bottom':return's';case'top':return'n';case'left':return'w';case'right':return'e';}
return's';}});def.type('pvc.AxisTitlePanel',pvc.TitlePanelAbstract).init(function(chart,parent,axis,options){this.axis=axis;this.base(chart,parent,options);this._extensionPrefix=axis.extensionPrefixes.map(function(prefix){return prefix+'Title';});}).add({_calcLayout:function(layoutInfo){var scale=this.axis.scale;if(!scale||scale.isNull){return new pvc_Size(0,0);}
return this.base(layoutInfo);},_createCore:function(layoutInfo){var scale=this.axis.scale;if(!scale||scale.isNull){return;}
return this.base(layoutInfo);}});def.type('pvc.PiePanel',pvc.PlotPanel).init(function(chart,parent,plot,options){var labelStyle=plot.option('ValuesLabelStyle');this.base(chart,parent,plot,options);this.explodedOffsetRadius=plot.option('ExplodedSliceRadius');this.explodedSliceIndex=plot.option('ExplodedSliceIndex');this.activeOffsetRadius=plot.option('ActiveSliceRadius');this.labelStyle=labelStyle;if(labelStyle==='linked'){this.linkInsetRadius=plot.option('LinkInsetRadius');this.linkOutsetRadius=plot.option('LinkOutsetRadius');this.linkMargin=plot.option('LinkMargin');this.linkHandleWidth=plot.option('LinkHandleWidth');this.linkLabelSize=plot.option('LinkLabelSize');this.linkLabelSpacingMin=plot.option('LinkLabelSpacingMin');}}).add({pvPie:null,pvPieLabel:null,valueRoleName:'value',_getV1Datum:function(scene){var datum=scene.datum;if(datum){var datumEx=Object.create(datum);datumEx.percent=scene.vars.value.percent;datum=datumEx;}
return datum;},_calcLayout:function(layoutInfo){var clientSize=layoutInfo.clientSize;var clientWidth=clientSize.width;var clientRadius=Math.min(clientWidth,clientSize.height)/2;if(!clientRadius){return new pvc_Size(0,0);}
var center=pv.vector(clientSize.width/2,clientSize.height/2);function resolvePercentRadius(radius){return def.between(pvc_PercentValue.resolve(radius,clientRadius),0,clientRadius);}
function resolvePercentWidth(width){return def.between(pvc_PercentValue.resolve(width,clientWidth),0,clientWidth);}
var labelFont=this._getConstantExtension('label','font');if(!def.string.is(labelFont)){labelFont=this.valuesFont;}
var maxPieRadius=clientRadius;if(this.valuesVisible&&this.labelStyle==='linked'){var linkInsetRadius=resolvePercentRadius(this.linkInsetRadius);var linkOutsetRadius=resolvePercentRadius(this.linkOutsetRadius);var linkMargin=resolvePercentWidth(this.linkMargin);var linkLabelSize=resolvePercentWidth(this.linkLabelSize);var textMargin=def.number.to(this._getConstantExtension('label','textMargin'),3);var textHeight=pv.Text.fontHeight(labelFont)*2/3;var linkHandleWidth=this.linkHandleWidth*textHeight;linkMargin+=linkHandleWidth;var linkLabelSpacingMin=this.linkLabelSpacingMin*textHeight;var freeWidthSpace=Math.max(0,clientWidth/2-clientRadius);var spaceH=Math.max(0,linkOutsetRadius+linkMargin+linkLabelSize-freeWidthSpace);var spaceV=linkOutsetRadius+textHeight;var linkAndLabelRadius=Math.max(0,spaceV,spaceH);if(linkAndLabelRadius>=maxPieRadius){this.valuesVisible=false;if(pvc.debug>=2){this._log("Hiding linked labels due to insufficient space.");}}else{maxPieRadius-=linkAndLabelRadius;layoutInfo.link={insetRadius:linkInsetRadius,outsetRadius:linkOutsetRadius,elbowRadius:maxPieRadius+linkOutsetRadius,linkMargin:linkMargin,handleWidth:linkHandleWidth,labelSize:linkLabelSize,maxTextWidth:linkLabelSize-textMargin,labelSpacingMin:linkLabelSpacingMin,textMargin:textMargin,lineHeight:textHeight};}}
var explodedOffsetRadius=resolvePercentRadius(this.explodedOffsetRadius);var activeOffsetRadius=0;if(this.hoverable()){activeOffsetRadius=resolvePercentRadius(this.activeOffsetRadius);}
var maxOffsetRadius=explodedOffsetRadius+activeOffsetRadius;var normalPieRadius=maxPieRadius-maxOffsetRadius;if(normalPieRadius<0){return new pvc_Size(0,0);}
layoutInfo.resolvePctRadius=resolvePercentRadius;layoutInfo.center=center;layoutInfo.clientRadius=clientRadius;layoutInfo.normalRadius=normalPieRadius;layoutInfo.explodedOffsetRadius=explodedOffsetRadius;layoutInfo.activeOffsetRadius=activeOffsetRadius;layoutInfo.maxOffsetRadius=maxOffsetRadius;layoutInfo.labelFont=labelFont;},_createCore:function(layoutInfo){var me=this;var chart=me.chart;var rootScene=this._buildScene();var center=layoutInfo.center;var normalRadius=layoutInfo.normalRadius;var wrapper;var extensionIds=['slice'];if(this.compatVersion()<=1){extensionIds.push('');wrapper=function(v1f){return function(pieCatScene){return v1f.call(this,pieCatScene.vars.value.value);};};}
this.pvPie=new pvc.visual.PieSlice(this,this.pvPanel,{extensionId:extensionIds,center:center,activeOffsetRadius:layoutInfo.activeOffsetRadius,maxOffsetRadius:layoutInfo.maxOffsetRadius,resolvePctRadius:layoutInfo.resolvePctRadius,wrapper:wrapper,tooltipArgs:{options:{useCorners:true,gravity:function(){var ma=this.midAngle();var isRightPlane=Math.cos(ma)>=0;var isTopPlane=Math.sin(ma)>=0;return isRightPlane?(isTopPlane?'nw':'sw'):(isTopPlane?'ne':'se');}}}}).lock('data',rootScene.childNodes).override('angle',function(){return this.scene.vars.value.angle;}).override('defaultOffsetRadius',function(){var explodeIndex=me.explodedSliceIndex;if(explodeIndex==null||explodeIndex==this.pvMark.index){return layoutInfo.explodedOffsetRadius;}
return 0;}).lock('outerRadius',function(){return chart.animate(0,normalRadius);}).localProperty('innerRadiusEx',pvc_PercentValue.parse).intercept('innerRadius',function(scene){var innerRadius=this.delegateExtension();if(innerRadius==null){var innerRadiusPct=this.pvMark.innerRadiusEx();if(innerRadiusPct!=null){innerRadius=pvc_PercentValue.resolve(innerRadiusPct,this.pvMark.outerRadius())||0;}else{innerRadius=0;}}
return innerRadius>0?chart.animate(0,innerRadius):0;}).pvMark;if(this.valuesVisible){this.valuesFont=layoutInfo.labelFont;if(this.labelStyle==='inside'){this.pvPieLabel=pvc.visual.ValueLabel.maybeCreate(this,this.pvPie,{wrapper:wrapper}).intercept('visible',function(scene){return(scene.vars.value.angle>=0.001)&&this.delegateExtension(true);}).override('defaultText',function(){return this.scene.vars.value.sliceLabel;}).pvMark.textMargin(10);}else if(this.labelStyle==='linked'){var linkLayout=layoutInfo.link;rootScene.layoutLinkLabels(layoutInfo);this.pvLinkPanel=this.pvPanel.add(pv.Panel).data(rootScene.childNodes).localProperty('pieSlice').pieSlice(function(){return me.pvPie.scene[this.index];});var f=false,t=true;this.pvLinkLine=new pvc.visual.Line(this,this.pvLinkPanel,{extensionId:'linkLine',freePosition:t,noClick:t,noDoubleClick:t,noSelect:t,noTooltip:t,noHover:t,showsActivity:f}).lockMark('data',function(scene){var pieSlice=this.parent.pieSlice();var midAngle=pieSlice.startAngle+pieSlice.angle/2;var outerRadius=pieSlice.outerRadius-linkLayout.insetRadius;var x=pieSlice.left+outerRadius*Math.cos(midAngle);var y=pieSlice.top+outerRadius*Math.sin(midAngle);var firstDotScene=scene.childNodes[0];if(!firstDotScene||!firstDotScene._isFirstDynamicScene){firstDotScene=new pvc.visual.PieLinkLineScene(scene,x,y,0);firstDotScene._isFirstDynamicScene=t;}else{firstDotScene.x=x;firstDotScene.y=y;}
return scene.childNodes;}).override('defaultColor',function(type){return type==='stroke'?'black':this.base(type);}).override('defaultStrokeWidth',def.fun.constant(0.5)).pvMark.lock('visible').lock('top',function(dot){return dot.y;}).lock('left',function(dot){return dot.x;});this.pvPieLabel=new pvc.visual.Label(this,this.pvLinkPanel,{extensionId:'label',noClick:f,noDoubleClick:f,noSelect:f,noHover:f,showsInteraction:t}).lockMark('data',function(scene){return scene.lineScenes;}).intercept('textStyle',function(){this._finished=f;var style=this.delegate();if(style&&!this._finished&&!this.mayShowActive()&&this.mayShowNotAmongSelected()){style=this.dimColor(style,'text');}
return style;}).pvMark.lock('visible').left(function(scene){return scene.vars.link.labelX;}).top(function(scene){return scene.vars.link.labelY+((this.index+1)*linkLayout.lineHeight);}).textAlign(function(scene){return scene.vars.link.labelAnchor;}).textMargin(linkLayout.textMargin).textBaseline('bottom').text(function(scene){return scene.vars.link.labelLines[this.index];});if(pvc.debug>=20){this.pvPanel.add(pv.Panel).zOrder(-10).left(center.x-layoutInfo.clientRadius).top(center.y-layoutInfo.clientRadius).width(layoutInfo.clientRadius*2).height(layoutInfo.clientRadius*2).strokeStyle('red');this.pvPanel.strokeStyle('green');var linkColors=pv.Colors.category10();this.pvLinkLine.segmented(t).strokeStyle(function(){return linkColors(this.index);});}}
this.pvPieLabel.font(layoutInfo.labelFont);}},_getExtensionId:function(){var extensionIds=[{abs:'content'}];if(this.chart.parent){extensionIds.push({abs:'smallContent'});}
return extensionIds.concat(this.base());},renderInteractive:function(){this.pvPanel.render();},_buildScene:function(){var rootScene=new pvc.visual.PieRootScene(this);this.sum=rootScene.vars.sumAbs.value;return rootScene;}});def.type('pvc.visual.PieRootScene',pvc.visual.Scene).init(function(panel){var data=panel.visualRoles.category.flatten(panel.data,pvc.data.visibleKeyArgs);this.base(null,{panel:panel,source:data});var colorVarHelper=new pvc.visual.RoleVarHelper(this,panel.visualRoles.color,{roleVar:'color'});var valueRoleName=panel.valueRoleName;var valueDimName=panel.visualRoles[valueRoleName].firstDimensionName();var valueDim=data.dimensions(valueDimName);var options=panel.chart.options;var percentValueFormat=options.percentValueFormat;var rootScene=this;var sumAbs=0;var CategSceneClass=def.type(pvc.visual.PieCategoryScene).init(function(categData,value){this.base(rootScene,{source:categData});this.vars.category=pvc_ValueLabelVar.fromComplex(categData);sumAbs+=Math.abs(value);this.vars.value=new pvc_ValueLabelVar(value,formatValue(value,categData));colorVarHelper.onNewScene(this,true);});panel._extendSceneType('category',CategSceneClass,['sliceLabel','sliceLabelMask']);data.children().each(function(categData){var value=categData.dimensions(valueDimName).sum(pvc.data.visibleKeyArgs);if(value!==0){new CategSceneClass(categData,value);}});this.angleScale=pv.Scale.linear(0,sumAbs).range(0,2*Math.PI).by1(Math.abs);this.vars.sumAbs=new pvc_ValueLabelVar(sumAbs,formatValue(sumAbs));this.childNodes.forEach(function(categScene){completeBuildCategScene.call(categScene);});function formatValue(value,categData){if(categData){var datums=categData._datums;if(datums.length===1){return datums[0].atoms[valueDimName].label;}}
return valueDim.format(value);}
function completeBuildCategScene(){var valueVar=this.vars.value;valueVar.angle=this.parent.angleScale(valueVar.value);var percent=Math.abs(valueVar.value)/sumAbs;valueVar.percent=new pvc_ValueLabelVar(percent,percentValueFormat(percent));valueVar.sliceLabel=this.sliceLabel();}}).add({layoutLinkLabels:function(layoutInfo){var startAngle=-Math.PI/2;var leftScenes=[];var rightScenes=[];this.childNodes.forEach(function(categScene){startAngle=categScene.layoutI(layoutInfo,startAngle);(categScene.vars.link.dir>0?rightScenes:leftScenes).push(categScene);});this._distributeLabels(-1,leftScenes,layoutInfo);this._distributeLabels(+1,rightScenes,layoutInfo);},_distributeLabels:function(dir,scenes,layoutInfo){scenes.sort(function(sceneA,sceneB){return def.compare(sceneA.vars.link.targetY,sceneB.vars.link.targetY);});this._distributeLabelsDownwards(scenes,layoutInfo)&&this._distributeLabelsUpwards(scenes,layoutInfo)&&this._distributeLabelsEvenly(scenes,layoutInfo);scenes.forEach(function(categScene){categScene.layoutII(layoutInfo);});},_distributeLabelsDownwards:function(scenes,layoutInfo){var linkLayout=layoutInfo.link;var labelSpacingMin=linkLayout.labelSpacingMin;var yMax=layoutInfo.clientSize.height;var overlapping=false;for(var i=0,J=scenes.length-1;i<J;i++){var linkVar0=scenes[i].vars.link;if(!i&&linkVar0.labelTop()<0){overlapping=true;}
var linkVar1=scenes[i+1].vars.link;var labelTopMin1=linkVar0.labelBottom()+labelSpacingMin;if(linkVar1.labelTop()<labelTopMin1){var halfLabelHeight1=linkVar1.labelHeight/2;var targetY1=labelTopMin1+halfLabelHeight1;var targetYMax=yMax-halfLabelHeight1;if(targetY1>targetYMax){overlapping=true;linkVar1.targetY=targetYMax;}else{linkVar1.targetY=targetY1;}}}
return overlapping;},_distributeLabelsUpwards:function(scenes,layoutInfo){var linkLayout=layoutInfo.link;var labelSpacingMin=linkLayout.labelSpacingMin;var overlapping=false;for(var i=scenes.length-1;i>0;i--){var linkVar1=scenes[i-1].vars.link;var linkVar0=scenes[i].vars.link;if(i===1&&linkVar1.labelTop()<0){overlapping=true;}
var labelBottomMax1=linkVar0.labelTop()-labelSpacingMin;if(linkVar1.labelBottom()>labelBottomMax1){var halfLabelHeight1=linkVar1.labelHeight/2;var targetY1=labelBottomMax1-halfLabelHeight1;var targetYMin=halfLabelHeight1;if(targetY1<targetYMin){overlapping=true;linkVar1.targetY=targetYMin;}else{linkVar1.targetY=targetY1;}}}
return overlapping;},_distributeLabelsEvenly:function(scenes,layoutInfo){var totalHeight=0;scenes.forEach(function(categScene){totalHeight+=categScene.vars.link.labelHeight;});var freeSpace=layoutInfo.clientSize.height-totalHeight;var labelSpacing=freeSpace;if(scenes.length>1){labelSpacing/=(scenes.length-1);}
var y=0;scenes.forEach(function(scene){var linkVar=scene.vars.link;var halfLabelHeight=linkVar.labelHeight/2;y+=halfLabelHeight;linkVar.targetY=y;y+=halfLabelHeight+labelSpacing;});return true;}});def.type('pvc.visual.PieLinkLabelVar').add({labelTop:function(){return this.targetY-this.labelHeight/2;},labelBottom:function(){return this.targetY+this.labelHeight/2;}});def.type('pvc.visual.PieCategoryScene',pvc.visual.Scene).add({sliceLabelMask:function(){return this.panel().valuesMask;},sliceLabel:function(){return this.format(this.sliceLabelMask());},layoutI:function(layoutInfo,startAngle){var valueVar=this.vars.value;var endAngle=startAngle+valueVar.angle;var midAngle=(startAngle+endAngle)/2;var linkVar=(this.vars.link=new pvc.visual.PieLinkLabelVar());var linkLayout=layoutInfo.link;var labelLines=pvc.text.justify(valueVar.sliceLabel,linkLayout.maxTextWidth,layoutInfo.labelFont);var lineCount=labelLines.length;linkVar.labelLines=labelLines;linkVar.labelHeight=lineCount*linkLayout.lineHeight;this.lineScenes=def.array.create(lineCount,this);var cosMid=Math.cos(midAngle);var sinMid=Math.sin(midAngle);var isAtRight=cosMid>=0;var dir=isAtRight?1:-1;linkVar.labelAnchor=isAtRight?'left':'right';var center=layoutInfo.center;var elbowRadius=linkLayout.elbowRadius;var elbowX=center.x+elbowRadius*cosMid;var elbowY=center.y+elbowRadius*sinMid;var anchorX=center.x+dir*elbowRadius;var targetX=anchorX+dir*linkLayout.linkMargin;new pvc.visual.PieLinkLineScene(this,elbowX,elbowY);new pvc.visual.PieLinkLineScene(this,anchorX,elbowY);linkVar.elbowY=elbowY;linkVar.targetY=elbowY+0;linkVar.targetX=targetX;linkVar.dir=dir;return endAngle;},layoutII:function(layoutInfo){var linkVar=this.vars.link;var targetY=linkVar.targetY;var targetX=linkVar.targetX;var handleWidth=layoutInfo.link.handleWidth;if(handleWidth>0){new pvc.visual.PieLinkLineScene(this,targetX-linkVar.dir*handleWidth,targetY);}
new pvc.visual.PieLinkLineScene(this,targetX,targetY);linkVar.labelX=targetX;linkVar.labelY=targetY-linkVar.labelHeight/2;}});def.type('pvc.visual.PieLinkLineScene',pvc.visual.Scene).init(function(catScene,x,y,index){this.base(catScene,{source:catScene.group,index:index});this.x=x;this.y=y;}).add(pv.Vector);def.type('pvc.PieChart',pvc.BaseChart).add({_animatable:true,pieChartPanel:null,_getColorRoleSpec:function(){return{isRequired:true,defaultSourceRole:'category',defaultDimension:'color*',requireIsDiscrete:true};},_initVisualRoles:function(){this.base();this._addVisualRole('category',{isRequired:true,defaultDimension:'category*',autoCreateDimension:true});this._addVisualRole('value',{isMeasure:true,isRequired:true,isPercent:true,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number,defaultDimension:'value'});},_initPlotsCore:function(){new pvc.visual.PiePlot(this);},_preRenderContent:function(contentOptions){this.base();var isV1Compat=this.compatVersion()<=1;if(isV1Compat){var innerGap=pvc.castNumber(this.options.innerGap)||0.95;innerGap=def.between(innerGap,0.1,1);contentOptions.paddings=((1-innerGap)*100/2).toFixed(2)+"%";}else if(contentOptions.paddings==null){contentOptions.paddings=new pvc_PercentValue(0.025);}
var piePlot=this.plots.pie;this.pieChartPanel=new pvc.PiePanel(this,this.basePanel,piePlot,def.create(contentOptions,{scenes:def.getPath(this.options,'pie.scenes')}));}});def.type('pvc.BarAbstractPanel',pvc.CategoricalAbstractPanel).add({pvBar:null,pvBarLabel:null,pvCategoryPanel:null,pvSecondLine:null,pvSecondDot:null,_creating:function(){var groupScene=this.defaultVisibleBulletGroupScene();if(groupScene&&!groupScene.hasRenderer()){var colorAxis=groupScene.colorAxis;var drawLine=colorAxis.option('LegendDrawLine');var drawMarker=!drawLine||colorAxis.option('LegendDrawMarker');if(drawMarker){var keyArgs={drawMarker:true,markerShape:colorAxis.option('LegendShape'),drawRule:drawLine,markerPvProto:new pv_Mark()};this.extend(keyArgs.markerPvProto,'',{constOnly:true});groupScene.renderer(new pvc.visual.legend.BulletItemDefaultRenderer(keyArgs));}}},_createCore:function(){this.base();var me=this,chart=me.chart,plot=me.plot,isStacked=!!me.stacked,isVertical=me.isOrientationVertical(),data=me.visibleData({ignoreNulls:false}),seriesData=me.visualRoles.series.flatten(data),rootScene=me._buildScene(data,seriesData),orthoAxis=me.axes.ortho,baseAxis=me.axes.base,orthoScale=orthoAxis.scale,orthoZero=orthoScale(0),sceneOrthoScale=orthoAxis.sceneScale({sceneVarName:'value',nullToZero:false}),sceneBaseScale=baseAxis.sceneScale({sceneVarName:'category'}),barSizeRatio=plot.option('BarSizeRatio'),barSizeMax=plot.option('BarSizeMax'),barStackedMargin=plot.option('BarStackedMargin'),baseRange=baseAxis.scale.range(),bandWidth=baseRange.band,barStepWidth=baseRange.step,barWidth,reverseSeries=isVertical===isStacked;if(isStacked){barWidth=bandWidth;}else{var S=seriesData.childCount();barWidth=S>0?(bandWidth*barSizeRatio/S):0;}
if(barWidth>barSizeMax){barWidth=barSizeMax;}
me.barWidth=barWidth;me.barStepWidth=barStepWidth;var wrapper;if(me.compatVersion()<=1){wrapper=function(v1f){return function(scene){var markParent=Object.create(this.parent);var mark=Object.create(this);mark.parent=markParent;var serIndex=scene.parent.childIndex();var catIndex=scene.childIndex();if(isStacked){markParent.index=serIndex;mark.index=catIndex;}else{markParent.index=catIndex;mark.index=serIndex;}
return v1f.call(mark,scene.vars.value.rawValue);};};}
me.pvBarPanel=new pvc.visual.Panel(me,me.pvPanel,{panelType:pv.Layout.Band,extensionId:'panel'}).lock('layers',rootScene.childNodes).lockMark('values',function(seriesScene){return seriesScene.childNodes;}).lockMark('orient',isVertical?'bottom-left':'left-bottom').lockMark('layout',isStacked?'stacked':'grouped').lockMark('verticalMode',me._barVerticalMode()).lockMark('yZero',orthoZero).pvMark.band.x(sceneBaseScale).w(bandWidth).differentialControl(me._barDifferentialControl()).item.order(reverseSeries?"reverse":null).h(function(scene){var y=sceneOrthoScale(scene);return y!=null?chart.animate(0,y-orthoZero):null;}).w(barWidth).horizontalRatio(barSizeRatio).verticalMargin(barStackedMargin).end;this.pvBar=new pvc.visual.Bar(me,me.pvBarPanel.item,{extensionId:'',freePosition:true,wrapper:wrapper}).lockDimensions().pvMark.antialias(false);if(plot.option('OverflowMarkersVisible')){this._addOverflowMarkers(wrapper);}
var label=pvc.visual.ValueLabel.maybeCreate(me,me.pvBar,{wrapper:wrapper});if(label){me.pvBarLabel=label.pvMark.visible(function(){var length=this.scene.target[this.index][isVertical?'height':'width'];return length>=4;});}},_barVerticalMode:function(){return null;},_barDifferentialControl:function(){return null;},_getV1Datum:function(scene){var datum=scene.datum;if(datum){var datumEx=Object.create(datum);datumEx.percent=scene.vars.value.percent;datum=datumEx;}
return datum;},_addOverflowMarkers:function(wrapper){var orthoAxis=this.axes.ortho;if(orthoAxis.option('FixedMax')!=null){this.pvOverflowMarker=this._addOverflowMarker(false,orthoAxis.scale,wrapper);}
if(orthoAxis.option('FixedMin')!=null){this.pvUnderflowMarker=this._addOverflowMarker(true,orthoAxis.scale,wrapper);}},_addOverflowMarker:function(isMin,orthoScale,wrapper){var isVertical=this.isOrientationVertical(),a_bottom=isVertical?"bottom":"left",a_top=this.anchorOpposite(a_bottom),a_height=this.anchorOrthoLength(a_bottom),a_width=this.anchorLength(a_bottom),paddings=this._layoutInfo.paddings,rOrthoBound=isMin?(orthoScale.min-paddings[a_bottom]):(orthoScale.max+paddings[a_top]),angle;if(!isMin){angle=isVertical?Math.PI:-Math.PI/2;}else{angle=isVertical?0:Math.PI/2;}
return new pvc.visual.Dot(this,this.pvBar.anchor('center'),{noSelect:true,noHover:true,noClick:true,noDoubleClick:true,noTooltip:true,freePosition:true,extensionId:isMin?'underflowMarker':'overflowMarker',wrapper:wrapper}).intercept('visible',function(scene){var visible=this.delegateExtension();if(visible!==undefined&&!visible){return false;}
var value=scene.vars.value.value;if(value==null){return false;}
var targetInstance=this.pvMark.scene.target[this.index];var orthoMaxPos=targetInstance[a_bottom]+
(value>0?targetInstance[a_height]:0);return isMin?(orthoMaxPos<rOrthoBound):(orthoMaxPos>rOrthoBound);}).lock(a_top,null).lock('shapeSize').pvMark.shape("triangle").shapeRadius(function(){return Math.min(Math.sqrt(10),this.scene.target[this.index][a_width]/2);}).shapeAngle(angle).lineWidth(1.5).strokeStyle("red").fillStyle("white")
[a_bottom](function(){return rOrthoBound+(isMin?1:-1)*(this.shapeRadius()+2);});},renderInteractive:function(){this.pvPanel.render();},_buildScene:function(data,seriesData){var rootScene=new pvc.visual.Scene(null,{panel:this,source:data});var categDatas=data._children;var roles=this.visualRoles;var valueVarHelper=new pvc.visual.RoleVarHelper(rootScene,roles.value,{roleVar:'value',hasPercentSubVar:this.stacked});var colorVarHelper=new pvc.visual.RoleVarHelper(rootScene,roles.color,{roleVar:'color'});seriesData.children().each(createSeriesScene);return rootScene;function createSeriesScene(seriesData1){var seriesScene=new pvc.visual.Scene(rootScene,{source:seriesData1}),seriesKey=seriesData1.key;seriesScene.vars.series=pvc_ValueLabelVar.fromComplex(seriesData1);colorVarHelper.onNewScene(seriesScene,false);categDatas.forEach(function(categData1){var group=data._childrenByKey[categData1.key]._childrenByKey[seriesKey],scene=new pvc.visual.Scene(seriesScene,{source:group});var categVar=scene.vars.category=pvc_ValueLabelVar.fromComplex(categData1);categVar.group=categData1;valueVarHelper.onNewScene(scene,true);colorVarHelper.onNewScene(scene,true);});}}});def.type('pvc.BarAbstract',pvc.CategoricalAbstract).init(function(options){this.base(options);var parent=this.parent;if(parent){this._valueRole=parent._valueRole;}}).add({_initVisualRoles:function(){this.base();this._addVisualRole('value',{isMeasure:true,isRequired:true,isPercent:this.options.stacked,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number,defaultDimension:'value'});this._valueRole=this.visualRoles.value;},_getCategoryRoleSpec:function(){var catRoleSpec=this.base();catRoleSpec.requireIsDiscrete=true;return catRoleSpec;},_initData:function(){this.base.apply(this,arguments);var data=this.data;this._valueDim=data.dimensions(this._valueRole.firstDimensionName());}});def.type('pvc.BarPanel',pvc.BarAbstractPanel).add({});def.type('pvc.BarChart',pvc.BarAbstract).add({_animatable:true,_allowV1SecondAxis:true,_initPlotsCore:function(){var options=this.options;var barPlot=new pvc.visual.BarPlot(this);var trend=barPlot.option('Trend');if(options.plot2){var plot2Plot=new pvc.visual.PointPlot(this,{name:'plot2',fixed:{DataPart:'1'},defaults:{ColorAxis:2,LinesVisible:true,DotsVisible:true}});if(!trend){trend=plot2Plot.option('Trend');}}
if(trend){new pvc.visual.PointPlot(this,{name:'trend',fixed:{DataPart:'trend',TrendType:'none',ColorRole:'series',NullInterpolatioMode:'none'},defaults:{ColorAxis:2,LinesVisible:true,DotsVisible:false}});}},_hasDataPartRole:function(){return true;},_createPlotPanels:function(parentPanel,baseOptions){var plots=this.plots;var barPlot=plots.bar;var barPanel=new pvc.BarPanel(this,parentPanel,barPlot,Object.create(baseOptions));this.barChartPanel=barPanel;var plot2Plot=plots.plot2;if(plot2Plot){if(pvc.debug>=3){this._log("Creating Point panel.");}
var pointPanel=new pvc.PointPanel(this,parentPanel,plot2Plot,Object.create(baseOptions));barPanel.pvSecondLine=pointPanel.pvLine;barPanel.pvSecondDot=pointPanel.pvDot;pointPanel._applyV1BarSecondExtensions=true;}
var trendPlot=plots.trend;if(trendPlot){if(pvc.debug>=3){this._log("Creating Trends Point panel.");}
new pvc.PointPanel(this,parentPanel,trendPlot,Object.create(baseOptions));}}});def.type('pvc.NormalizedBarPanel',pvc.BarAbstractPanel).add({_barVerticalMode:function(){return'expand';}});def.type('pvc.NormalizedBarChart',pvc.BarAbstract).add({_processOptionsCore:function(options){options.stacked=true;this.base(options);},_getContinuousVisibleExtentConstrained:function(axis,min,max){if(axis.type==='ortho'){return{min:0,max:100,minLocked:true,maxLocked:true};}
return this.base(axis,min,max);},_initPlotsCore:function(hasMultiRole){new pvc.visual.NormalizedBarPlot(this);},_createPlotPanels:function(parentPanel,baseOptions){var barPlot=this.plots.bar;this.barChartPanel=new pvc.NormalizedBarPanel(this,parentPanel,barPlot,Object.create(baseOptions));}});def.type('pvc.visual.legend.WaterfallBulletGroupScene',pvc.visual.legend.BulletGroupScene).init(function(rootScene,keyArgs){keyArgs=def.set(keyArgs,'clickMode','none');this.base(rootScene,keyArgs);this.createItem(keyArgs);}).add({renderer:function(renderer){if(renderer!=null){this._renderer=renderer;}
return this._renderer;},itemSceneType:function(){return pvc.visual.legend.WaterfallBulletItemScene;}});def.type('pvc.visual.legend.WaterfallBulletItemScene',pvc.visual.legend.BulletItemScene).init(function(bulletGroup,keyArgs){this.base.apply(this,arguments);var I=pvc.visual.Interactive;this._ibits=I.Interactive|I.ShowsInteraction;this.color=def.get(keyArgs,'color');this.vars.value=new pvc_ValueLabelVar(null,def.get(keyArgs,'label'));});def.type('pvc.WaterfallPanel',pvc.BarAbstractPanel).add({pvWaterfallLine:null,ruleData:null,_barDifferentialControl:function(){var isFalling=this.chart._isFalling;return function(scene){if(isFalling&&!this.index){return 1;}
var group=scene.vars.category.group;var isProperGroup=group._isFlattenGroup&&!group._isDegenerateFlattenGroup;if(isProperGroup){return-2;}
return isFalling?-1:1;};},_creating:function(){var rootScene=this._getLegendBulletRootScene();if(rootScene){var waterfallGroupScene=rootScene.firstChild;if(waterfallGroupScene&&!waterfallGroupScene.hasRenderer()){var keyArgs={drawRule:true,drawMarker:false,rulePvProto:new pv_Mark()};this.extend(keyArgs.rulePvProto,'line',{constOnly:true});waterfallGroupScene.renderer(new pvc.visual.legend.BulletItemDefaultRenderer(keyArgs));}}},_createCore:function(){this.base();var chart=this.chart,isVertical=this.isOrientationVertical(),anchor=isVertical?"bottom":"left",ao=this.anchorOrtho(anchor),ruleRootScene=this._buildRuleScene(),orthoScale=chart.axes.ortho.scale,orthoZero=orthoScale(0),sceneOrthoScale=chart.axes.ortho.sceneScale({sceneVarName:'value'}),sceneBaseScale=chart.axes.base.sceneScale({sceneVarName:'category'}),baseScale=chart.axes.base.scale,barWidth2=this.barWidth/2,barWidth=this.barWidth,barStepWidth=this.barStepWidth,isFalling=chart._isFalling,waterColor=chart._waterColor;if(this.plot.option('AreasVisible')){var panelColors=pv.Colors.category10();var waterGroupRootScene=this._buildWaterGroupScene();var orthoRange=orthoScale.range();var orthoPanelMargin=0.04*(orthoRange[1]-orthoRange[0]);this.pvWaterfallGroupPanel=new pvc.visual.Panel(this,this.pvPanel,{extensionId:'group'}).lock('data',waterGroupRootScene.childNodes).pvMark.zOrder(-1).fillStyle(function(){return panelColors(0).alpha(0.15);})
[ao](function(scene){var c=scene.vars.category;return baseScale(c.valueLeft)-barStepWidth/2;})
[this.anchorLength(anchor)](function(scene){var c=scene.vars.category;var len=Math.abs(baseScale(c.valueRight)-baseScale(c.valueLeft));return len+barStepWidth;})
[anchor](function(scene){var v=scene.vars.value;var b=orthoScale(v.valueBottom)-orthoPanelMargin/2;return chart.animate(orthoZero,b);})
[this.anchorOrthoLength(anchor)](function(scene){var v=scene.vars.value;var h=orthoScale(v.valueTop)-orthoScale(v.valueBottom)+orthoPanelMargin;return chart.animate(0,h);});}
this.pvBar.sign.override('baseColor',function(type){var color=this.base(type);if(type==='fill'){if(!this.scene.vars.category.group._isFlattenGroup){return pv.color(color).alpha(0.5);}}
return color;});this.pvWaterfallLine=new pvc.visual.Rule(this,this.pvPanel,{extensionId:'line',noTooltip:false,noHover:false,noSelect:false,noClick:false,noDoubleClick:false}).lock('data',ruleRootScene.childNodes).optional('visible',function(){return(isFalling&&!!this.scene.previousSibling)||(!isFalling&&!!this.scene.nextSibling);}).optional(anchor,function(){return orthoZero+chart.animate(0,sceneOrthoScale(this.scene)-orthoZero);}).optional(this.anchorLength(anchor),barStepWidth+barWidth).optional(ao,isFalling?function(){return sceneBaseScale(this.scene)-barStepWidth-barWidth2;}:function(){return sceneBaseScale(this.scene)-barWidth2;}).override('defaultColor',function(){return waterColor;}).pvMark.antialias(true).lineCap('butt');if(this.plot.option('TotalValuesVisible')){this.pvWaterfallLabel=new pvc.visual.Label(this,this.pvWaterfallLine,{extensionId:'lineLabel'}).intercept('visible',function(scene){if(scene.vars.category.group._isFlattenGroup){return false;}
return isFalling||!!scene.nextSibling;}).pvMark
[anchor](function(scene){return orthoZero+chart.animate(0,sceneOrthoScale(scene)-orthoZero);})
[this.anchorOrtho(anchor)](sceneBaseScale).textAlign(isVertical?'center':'left').textBaseline(function(categScene){if(!isVertical){return'middle';}
var direction=categScene.vars.direction;if(direction==null){return'bottom';}
var isRising=!isFalling;return isRising===(direction==='up')?'bottom':'top';}).textStyle(pv.Color.names.darkgray.darker(2)).textMargin(5).text(function(scene){return scene.vars.value.label;});}},_buildRuleScene:function(){var rootScene=new pvc.visual.Scene(null,{panel:this,source:this.visibleData({ignoreNulls:false})});var prevValue,isClimbing;var ris=this.chart._ruleInfos;if(ris){ris.forEach(createCategScene,this);var q=def.query(rootScene.childNodes);isClimbing=!this.chart._isFalling;if(!isClimbing){q=q.reverse();}
q.each(completeCategScene,this);}
return rootScene;function createCategScene(ruleInfo){var categData1=ruleInfo.group;var categScene=new pvc.visual.Scene(rootScene,{source:categData1});var categVar=categScene.vars.category=pvc_ValueLabelVar.fromComplex(categData1);categVar.group=categData1;var value=ruleInfo.offset;categScene.vars.value=new pvc_ValueLabelVar(value,this.chart._valueDim.format(value));}
function completeCategScene(categScene,index){var value=categScene.vars.value.value;categScene.vars.direction=(!index||prevValue===value)?null:(isClimbing===(prevValue<value))?'up':'down';prevValue=value;}},_buildWaterGroupScene:function(){var chart=this.chart;var rootCatData=chart._catRole.select(chart.partData(this.dataPartValue),{visible:true});var rootScene=new pvc.visual.Scene(null,{panel:this,source:rootCatData});var ruleInfoByCategKey,isFalling;var ris=chart._ruleInfos;if(ris){ruleInfoByCategKey=def.query(ris).object({name:function(ri){return ri.group.absKey;}});isFalling=chart._isFalling;createRectangleSceneRecursive(rootCatData,0);}
return rootScene;function createRectangleSceneRecursive(catData,level){var q=catData.children().where(function(c){return c.key!=="";});if(q.next()){if(level){createRectangleScene(catData,level);}
level++;do{createRectangleSceneRecursive(q.item,level);}while(q.next());}}
function createRectangleScene(catData,level){var rectScene=new pvc.visual.Scene(rootScene,{source:catData});var categVar=rectScene.vars.category=pvc_ValueLabelVar.fromComplex(catData);categVar.group=catData;categVar.level=level;var valueVar=rectScene.vars.value={};var ri=ruleInfoByCategKey[catData.absKey];var offset=ri.offset;var range=ri.range;var height=-range.min+range.max;var leafData,leafRuleInfo,lc,rc,bv;if(isFalling){leafData=lastLeaf(catData);leafRuleInfo=ruleInfoByCategKey[leafData.absKey];lc=ri.group.value;rc=leafRuleInfo.group.value;bv=offset-range.max;}else{leafData=firstLeaf(catData);leafRuleInfo=ruleInfoByCategKey[leafData.absKey];lc=leafRuleInfo.group.value;rc=ri.group.value;bv=offset-range.max;}
categVar.valueLeft=lc;categVar.valueRight=rc;valueVar.valueHeight=height;valueVar.valueBottom=bv;valueVar.valueTop=bv+height;}
function firstLeaf(data){var children=data._children;var first=children&&children[0];return first?firstLeaf(first):data;}
function lastLeaf(data){var children=data._children;var last=children&&children[children.length-1];return last?lastLeaf(last):data;}}});def.type('pvc.WaterfallChart',pvc.BarAbstract).init(function(options){this.base(options);var parent=this.parent;if(parent){this._isFalling=parent._isFalling;}}).add({_animatable:true,_isFalling:true,_ruleInfos:null,_waterColor:pv.color("#1f77b4").darker(),_processOptionsCore:function(options){options.stacked=true;options.baseAxisComposite=false;this.base(options);options.plot2=false;},_initPlotsCore:function(){var options=this.options;var waterPlot=new pvc.visual.WaterfallPlot(this);this._isFalling=waterPlot.option('Direction')==='down';var travProp=this._isFalling?'FlattenDfsPre':'FlattenDfsPost';this._catRole.setTraversalMode(pvc.visual.TraversalMode[travProp]);this._catRole.setRootLabel(waterPlot.option('AllCategoryLabel'));},_initLegendScenes:function(legendPanel){var waterPlot=this.plots.water;var extAbsId=pvc.makeExtensionAbsId('line',waterPlot.extensionPrefixes);var strokeStyle=this._getConstantExtension(extAbsId,'strokeStyle');if(strokeStyle){this._waterColor=pv.color(strokeStyle);}
var rootScene=legendPanel._getBulletRootScene();new pvc.visual.legend.WaterfallBulletGroupScene(rootScene,{extensionPrefix:pvc.buildIndexedId('',1),label:waterPlot.option('TotalLineLabel'),color:this._waterColor});this.base(legendPanel);},_reduceStackedCategoryValueExtent:function(result,catRange,catGroup){var offsetPrev=result?result.offset:0;var offsetDelta=catRange.min+catRange.max;var offsetNext;if(!result){if(catRange){offsetNext=offsetPrev+offsetDelta;this._ruleInfos=[{offset:offsetNext,group:catGroup,range:catRange}];return{min:catRange.min,max:catRange.max,offset:offsetNext};}
return null;}
var isFalling=this._isFalling;var isProperGroup=catGroup._isFlattenGroup&&!catGroup._isDegenerateFlattenGroup;if(!isProperGroup){var dir=isFalling?-1:1;offsetNext=result.offset=offsetPrev+dir*offsetDelta;if(offsetNext>result.max){result.max=offsetNext;}
else
if(offsetNext<result.min){result.min=offsetNext;}}else{var deltaUp=-catRange.min;if(deltaUp>0){var top=offsetPrev+deltaUp;if(top>result.max){result.max=top;}}
var deltaDown=-catRange.max;if(deltaDown<0){var bottom=offsetPrev+deltaDown;if(bottom<result.min){result.min=bottom;}}}
this._ruleInfos.push({offset:isFalling?offsetPrev:result.offset,group:catGroup,range:catRange});return result;},_createPlotPanels:function(parentPanel,baseOptions){this.wfChartPanel=new pvc.WaterfallPanel(this,parentPanel,this.plots.water,def.create(baseOptions,{waterfall:this.options.waterfall}));}});def.type('pvc.PointPanel',pvc.CategoricalAbstractPanel).init(function(chart,parent,plot,options){this.base(chart,parent,plot,options);this.linesVisible=plot.option('LinesVisible');this.dotsVisible=plot.option('DotsVisible');this.areasVisible=plot.option('AreasVisible');if(!this.linesVisible&&!this.dotsVisible&&!this.areasVisible){this.linesVisible=true;plot.option.specify({'LinesVisible':true});}
this.visualRoles.value=chart.visualRole(plot.option('OrthoRole'));}).add({pvLine:null,pvArea:null,pvDot:null,pvLabel:null,pvScatterPanel:null,_creating:function(){var groupScene=this.defaultVisibleBulletGroupScene();if(groupScene&&!groupScene.hasRenderer()){var colorAxis=groupScene.colorAxis;var drawMarker=def.nullyTo(colorAxis.option('LegendDrawMarker',true),this.dotsVisible||this.areasVisible);var drawRule=!drawMarker||def.nullyTo(colorAxis.option('LegendDrawLine',true),this.linesVisible&&!this.areasVisible);if(drawMarker||drawRule){var keyArgs={drawMarker:drawMarker,drawRule:drawRule};if(drawMarker){var markerShape=colorAxis.option('LegendShape',true);if(this.dotsVisible){if(!markerShape){markerShape='circle';}
keyArgs.markerPvProto=new pv.Dot().lineWidth(1.5,pvc.extensionTag).shapeSize(12,pvc.extensionTag);}else{keyArgs.markerPvProto=new pv_Mark();}
keyArgs.markerShape=markerShape;if(this._applyV1BarSecondExtensions){this.chart.extend(keyArgs.markerPvProto,'barSecondDot',{constOnly:true});}
this.extend(keyArgs.markerPvProto,'dot',{constOnly:true});}
if(drawRule){keyArgs.rulePvProto=new pv.Line().lineWidth(1.5,pvc.extensionTag);if(this._applyV1BarSecondExtensions){this.chart.extend(keyArgs.rulePvProto,'barSecondLine',{constOnly:true});}
this.extend(keyArgs.rulePvProto,'line',{constOnly:true});}
groupScene.renderer(new pvc.visual.legend.BulletItemDefaultRenderer(keyArgs));}}},_createCore:function(){this.base();var myself=this;var chart=this.chart;var isStacked=this.stacked;var dotsVisible=this.dotsVisible;var areasVisible=this.areasVisible;var linesVisible=this.linesVisible;var anchor=this.isOrientationVertical()?"bottom":"left";var isBaseDiscrete=this.axes.base.role.grouping.isDiscrete();var data=this.visibleData({ignoreNulls:false});var rootScene=this._buildScene(data,isBaseDiscrete);if(areasVisible){this.pvPanel.zOrder(-7);}else{this.pvPanel.zOrder(1);}
this.pvScatterPanel=new pvc.visual.Panel(this,this.pvPanel,{extensionId:'panel'}).lock('data',rootScene.childNodes).pvMark;var areaFillColorAlpha=areasVisible&&linesVisible&&!isStacked?0.5:null;var wrapper;if(this.compatVersion()<=1){if(isStacked){wrapper=function(v1f){return function(dotScene){return v1f.call(this,dotScene.vars.value.rawValue);};};}else{wrapper=function(v1f){return function(dotScene){var d={category:dotScene.vars.category.rawValue,value:dotScene.vars.value.rawValue};var pseudo=Object.create(this);pseudo.index=dotScene.dataIndex;return v1f.call(pseudo,d);};};}}
var lineAreaVisibleProp=isBaseDiscrete&&isStacked?function(scene){return!scene.isNull||scene.isIntermediate;}:function(scene){return!scene.isNull;};var isLineAreaNoSelect=chart.selectableByFocusWindow();this.pvArea=new pvc.visual.Area(this,this.pvScatterPanel,{extensionId:'area',noTooltip:false,wrapper:wrapper,noSelect:isLineAreaNoSelect,noRubberSelect:true,showsSelection:!isLineAreaNoSelect}).lockMark('data',function(seriesScene){return seriesScene.childNodes;}).lockMark('visible',lineAreaVisibleProp).override('x',function(){return this.scene.basePosition;}).override('y',function(){return this.scene.orthoPosition;}).override('dy',function(){return chart.animate(0,this.scene.orthoLength);}).override('color',function(type){return areasVisible?this.base(type):null;}).override('baseColor',function(type){var color=this.base(type);if(!this._finished&&color&&areaFillColorAlpha!=null){color=color.alpha(areaFillColorAlpha);}
return color;}).override('dimColor',function(color,type){return isStacked?pvc.toGrayScale(color,1,null,null).brighter():this.base(color,type);}).lock('events',areasVisible?'painted':'none').pvMark;var dotsVisibleOnly=dotsVisible&&!linesVisible&&!areasVisible;var darkerLineAndDotColor=isStacked&&areasVisible;var extensionIds=['line'];if(this._applyV1BarSecondExtensions){extensionIds.push({abs:'barSecondLine'});}
var lineVisibleProp=!dotsVisibleOnly&&lineAreaVisibleProp;var noLineInteraction=areasVisible&&!linesVisible;this.pvLine=new pvc.visual.Line(this,this.pvArea.anchor(this.anchorOpposite(anchor)),{extensionId:extensionIds,freePosition:true,wrapper:wrapper,noTooltip:noLineInteraction,noDoubleClick:noLineInteraction,noClick:noLineInteraction,noHover:noLineInteraction,noSelect:noLineInteraction||isLineAreaNoSelect,showsSelection:!isLineAreaNoSelect}).lockMark('visible',lineVisibleProp).override('defaultColor',function(type){var color=this.base(type);if(!this._finished&&darkerLineAndDotColor&&color){color=color.darker(0.6);}
return color;}).override('normalColor',function(color){return linesVisible?color:null;}).override('interactiveColor',function(color,type){if(!linesVisible&&!this.mayShowAnySelected()&&!this.mayShowActive()){return null;}
return this.base(color,type);}).override('baseStrokeWidth',function(){var strokeWidth;if(linesVisible){strokeWidth=this.base();}
return strokeWidth==null?1.5:strokeWidth;}).intercept('strokeDasharray',function(){var dashArray=this.delegateExtension();if(dashArray===undefined){var scene=this.scene;var useDash=scene.isInterpolated;if(!useDash){var next=scene.nextSibling;useDash=next&&next.isIntermediate&&next.isInterpolated;if(!useDash){var previous=scene.previousSibling;useDash=previous&&scene.isIntermediate&&previous.isInterpolated;}}
dashArray=useDash?'. ':null;}
return dashArray;}).pvMark;var showAloneDots=!(areasVisible&&isBaseDiscrete&&isStacked);extensionIds=['dot'];if(this._applyV1BarSecondExtensions){extensionIds.push({abs:'barSecondDot'});}
this.pvDot=new pvc.visual.Dot(this,this.pvLine,{extensionId:extensionIds,freePosition:true,wrapper:wrapper}).intercept('visible',function(){var scene=this.scene;return(!scene.isNull&&!scene.isIntermediate)&&this.delegateExtension(true);}).override('color',function(type){if(!dotsVisible){var visible=this.scene.isActive||(!showAloneDots&&this.scene.isSingle)||(showAloneDots&&this.scene.isAlone);if(!visible){return pvc.invisibleFill;}}
var color=this.base(type);if(this.scene.isInterpolated&&type==='fill'){return color&&pv.color(color).brighter(0.5);}
return color;}).override('defaultColor',function(type){var color=this.base(type);if(!this._finished&&darkerLineAndDotColor&&color){color=color.darker(0.6);}
return color;}).override('baseSize',function(){if(!dotsVisible){var visible=this.scene.isActive||(!showAloneDots&&this.scene.isSingle)||(showAloneDots&&this.scene.isAlone);if(visible&&!this.scene.isActive){var lineWidth=Math.max(myself.pvLine.lineWidth(),0.2)/2;return def.sqr(lineWidth);}}
if(this.scene.isInterpolated){return 0.8*this.base();}
return this.base();}).pvMark;var label=pvc.visual.ValueLabel.maybeCreate(this,this.pvDot,{wrapper:wrapper});if(label){this.pvLabel=label.pvMark;}},renderInteractive:function(){this.pvScatterPanel.render();},_buildScene:function(data,isBaseDiscrete){var rootScene=new pvc.visual.Scene(null,{panel:this,source:data});var categDatas=data._children;var chart=this.chart;var serRole=this.visualRoles.series;var valueRole=this.visualRoles.value;var isStacked=this.stacked;var valueVarHelper=new pvc.visual.RoleVarHelper(rootScene,valueRole,{roleVar:'value',hasPercentSubVar:isStacked});var colorVarHelper=new pvc.visual.RoleVarHelper(rootScene,this.visualRoles.color,{roleVar:'color'});var valueDimName=valueRole.firstDimensionName();var valueDim=data.owner.dimensions(valueDimName);var orthoScale=this.axes.ortho.scale;var orthoNullValue=def.scope(function(){var domain=orthoScale.domain(),dmin=domain[0],dmax=domain[1];if(dmin*dmax>=0){return dmin>=0?dmin:dmax;}
return 0;});var orthoZero=orthoScale(orthoNullValue);var sceneBaseScale=this.axes.base.sceneScale({sceneVarName:'category'});def.scope(function(){return(serRole&&serRole.grouping)?serRole.flatten(data).children():def.query([null]);}).each(function(seriesData1){var seriesScene=new pvc.visual.Scene(rootScene,{source:seriesData1||data});seriesScene.vars.series=pvc_ValueLabelVar.fromComplex(seriesData1);colorVarHelper.onNewScene(seriesScene,false);categDatas.forEach(function(categData,categIndex){var group=categData;if(seriesData1){group=group._childrenByKey[seriesData1.key];}
var serCatScene=new pvc.visual.Scene(seriesScene,{source:group});serCatScene.dataIndex=categIndex;serCatScene.vars.category=pvc_ValueLabelVar.fromComplex(categData);valueVarHelper.onNewScene(serCatScene,true);var valueVar=serCatScene.vars.value;var value=valueVar.value;valueVar.accValue=value!=null?value:orthoNullValue;colorVarHelper.onNewScene(serCatScene,true);var isInterpolated=group!=null&&group.datums().prop('isInterpolated').any(def.truthy);serCatScene.isInterpolated=isInterpolated;serCatScene.isNull=value==null;serCatScene.isIntermediate=false;},this);},this);var reversedSeriesScenes=rootScene.children().reverse().array();var belowSeriesScenes2;reversedSeriesScenes.forEach(completeSeriesScenes,this);reversedSeriesScenes.forEach(trimNullSeriesScenes,this);return rootScene;function completeSeriesScenes(seriesScene){var seriesScenes2=[],seriesScenes=seriesScene.childNodes,fromScene,notNullCount=0,firstAloneScene=null;for(var c=0,toChildIndex=0,categCount=seriesScenes.length;c<categCount;c++,toChildIndex++){var toScene=seriesScenes[toChildIndex],c2=c*2;seriesScenes2[c2]=toScene;completeMainScene.call(this,fromScene,toScene,belowSeriesScenes2&&belowSeriesScenes2[c2]);if(toScene.isAlone&&!firstAloneScene){firstAloneScene=toScene;}
if(!toScene.isNull){notNullCount++;}
if(fromScene){var interScene=createIntermediateScene.call(this,seriesScene,fromScene,toScene,toChildIndex,belowSeriesScenes2&&belowSeriesScenes2[c2-1]);if(interScene){seriesScenes2[c2-1]=interScene;toChildIndex++;}}
fromScene=toScene;}
if(notNullCount===1&&firstAloneScene&&categCount===1){firstAloneScene.isSingle=true;}
if(isStacked){belowSeriesScenes2=seriesScenes2;}}
function completeMainScene(fromScene,toScene,belowScene){var toAccValue=toScene.vars.value.accValue;if(belowScene){if(toScene.isNull&&!isBaseDiscrete){toAccValue=orthoNullValue;}
else{toAccValue+=belowScene.vars.value.accValue;}
toScene.vars.value.accValue=toAccValue;}
toScene.basePosition=sceneBaseScale(toScene);toScene.orthoPosition=orthoZero;toScene.orthoLength=orthoScale(toAccValue)-orthoZero;var isNullFrom=(!fromScene||fromScene.isNull),isAlone=isNullFrom&&!toScene.isNull;if(isAlone){var nextScene=toScene.nextSibling;isAlone=!nextScene||nextScene.isNull;}
toScene.isAlone=isAlone;toScene.isSingle=false;}
function createIntermediateScene(seriesScene,fromScene,toScene,toChildIndex,belowScene){var interIsNull=fromScene.isNull||toScene.isNull;if(interIsNull&&!this.areasVisible){return null;}
var interValue,interAccValue,interBasePosition;if(interIsNull){if(belowScene&&isBaseDiscrete){var belowValueVar=belowScene.vars.value;interAccValue=belowValueVar.accValue;interValue=belowValueVar[valueRole.name];}else{interValue=interAccValue=orthoNullValue;}
if(isStacked&&isBaseDiscrete){interBasePosition=toScene.basePosition-(sceneBaseScale.range().step/2);}else if(fromScene.isNull){interBasePosition=toScene.basePosition;}else{interBasePosition=fromScene.basePosition;}}else{var fromValueVar=fromScene.vars.value,toValueVar=toScene.vars.value;interValue=(toValueVar.value+fromValueVar.value)/2;interAccValue=(toValueVar.accValue+fromValueVar.accValue)/2;interBasePosition=(toScene.basePosition+fromScene.basePosition)/2;}
var interScene=new pvc.visual.Scene(seriesScene,{index:toChildIndex,source:toScene.source});interScene.dataIndex=toScene.dataIndex;interScene.vars.category=toScene.vars.category;var interValueVar=new pvc_ValueLabelVar(interValue,valueDim.format(interValue),interValue);interValueVar.accValue=interAccValue;interScene.vars.value=interValueVar;interScene.ownerScene=toScene;interScene.isInterpolated=toScene.isInterpolated;interScene.isIntermediate=true;interScene.isSingle=false;interScene.isNull=interIsNull;interScene.isAlone=interIsNull&&toScene.isNull&&fromScene.isNull;interScene.basePosition=interBasePosition;interScene.orthoPosition=orthoZero;interScene.orthoLength=orthoScale(interAccValue)-orthoZero;colorVarHelper.onNewScene(interScene,true);return interScene;}
function trimNullSeriesScenes(seriesScene){var seriesScenes=seriesScene.childNodes,L=seriesScenes.length;var scene,siblingScene;while(L&&(scene=seriesScenes[0]).isNull){siblingScene=scene.nextSibling;if(siblingScene&&!siblingScene.isNull){break;}
seriesScene.removeAt(0);L--;}
while(L&&(scene=seriesScenes[L-1]).isNull){siblingScene=scene.previousSibling;if(siblingScene&&!siblingScene.isNull){break;}
seriesScene.removeAt(L-1);L--;}}}});def.type('pvc.PointAbstract',pvc.CategoricalAbstract).add({_animatable:true,_processOptionsCore:function(options){options.panelSizeRatio=1;this.base(options);},_hasDataPartRole:function(){return true;},_initVisualRoles:function(){this.base();this._addVisualRole('value',{isMeasure:true,isRequired:true,isPercent:this.options.stacked,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number,defaultDimension:'value'});},_initPlotsCore:function(){var options=this.options;var pointPlot=this._createPointPlot();var trend=pointPlot.option('Trend');if(options.plot2){var plot2Plot=new pvc.visual.PointPlot(this,{name:'plot2',fixed:{DataPart:'1'},defaults:{ColorAxis:2,LinesVisible:true,DotsVisible:true}});if(!trend){trend=plot2Plot.option('Trend');}}
if(trend){new pvc.visual.PointPlot(this,{name:'trend',fixed:{DataPart:'trend',TrendType:'none',ColorRole:'series',NullInterpolatioMode:'none'},defaults:{ColorAxis:2,LinesVisible:true,DotsVisible:false}});}},_bindAxes:function(hasMultiRole){this.base(hasMultiRole);var typeAxes=this.axesByType.base;if(typeAxes){typeAxes.forEach(function(axis){var isDiscrete=axis.scaleType==='discrete';if(!isDiscrete){axis.option.defaults({Offset:0.01});}});}
typeAxes=this.axesByType.ortho;if(typeAxes){typeAxes.forEach(function(axis){axis.option.defaults({Offset:0.04});});}},_createPlotPanels:function(parentPanel,baseOptions){var plots=this.plots;var pointPlot=plots.point;this.scatterChartPanel=new pvc.PointPanel(this,parentPanel,pointPlot,Object.create(baseOptions));var plot2Plot=plots.plot2;if(plot2Plot){if(pvc.debug>=3){this._log("Creating second Point panel.");}
new pvc.PointPanel(this,parentPanel,plot2Plot,Object.create(baseOptions));}
var trendPlot=plots.trend;if(trendPlot){if(pvc.debug>=3){this._log("Creating Trends Point panel.");}
new pvc.PointPanel(this,parentPanel,trendPlot,Object.create(baseOptions));}},defaults:{tooltipOffset:10}});def.type('pvc.DotChart',pvc.PointAbstract).add({_createPointPlot:function(){return new pvc.visual.PointPlot(this,{fixed:{DotsVisible:true}});}});def.type('pvc.LineChart',pvc.PointAbstract).add({_createPointPlot:function(){return new pvc.visual.PointPlot(this,{fixed:{LinesVisible:true}});}});def.type('pvc.AreaChart',pvc.PointAbstract).add({_createPointPlot:function(){return new pvc.visual.PointPlot(this,{fixed:{AreasVisible:true}});}});pvc.mStackedLineChart=def.type('pvc.StackedLineChart',pvc.PointAbstract).add({_createPointPlot:function(){return new pvc.visual.PointPlot(this,{fixed:{LinesVisible:true,Stacked:true}});}});def.type('pvc.StackedDotChart',pvc.PointAbstract).add({_createPointPlot:function(){return new pvc.visual.PointPlot(this,{fixed:{DotsVisible:true,Stacked:true}});}});pvc.mStackedAreaChart=def.type('pvc.StackedAreaChart',pvc.PointAbstract).add({_createPointPlot:function(){return new pvc.visual.PointPlot(this,{fixed:{AreasVisible:true,Stacked:true},defaults:{LinesVisible:true}});}});def.type('pvc.HeatGridPanel',pvc.CategoricalAbstractPanel).init(function(chart,parent,plot,options){this.base(chart,parent,plot,options);this.axes.size=chart._getAxis('size',plot.option('SizeAxis')-1);var roles=this.visualRoles;var sizeRoleName=plot.option('SizeRole');roles.size=chart.visualRole(sizeRoleName);this.useShapes=plot.option('UseShapes');this.shape=plot.option('Shape');this.nullShape=plot.option('NullShape');}).add({defaultBorder:1,nullBorder:2,selectedBorder:2,_createCore:function(){var me=this;me.base();var cellSize=me._calcCellSize();var a_bottom=me.isOrientationVertical()?"bottom":"left";var a_left=pvc.BasePanel.relativeAnchor[a_bottom];var a_width=pvc.BasePanel.parallelLength[a_bottom];var a_height=pvc.BasePanel.orthogonalLength[a_bottom];var rowRootData=me.visualRoles.series.flatten(me.data,{visible:true});var rootScene=me._buildScene(me.visibleData({ignoreNulls:false}),rowRootData,cellSize);var hasColor=rootScene.isColorBound;var hasSize=rootScene.isSizeBound;var wrapper=me._buildSignsWrapper(rootScene);var isV1Compat=me.compatVersion()<=1;var rowScale=this.axes.base.scale;var colScale=this.axes.ortho.scale;var rowStep=rowScale.range().step;var colStep=colScale.range().step;var rowStep2=rowStep/2;var colStep2=colStep/2;var pvRowPanel=new pvc.visual.Panel(me,me.pvPanel).pvMark.data(rootScene.childNodes)
[a_bottom](function(scene){return colScale(scene.vars.series.value)-colStep2;})
[a_height](colStep);var extensionIds=['panel'];if(isV1Compat){extensionIds.push('');}
var keyArgs={extensionId:extensionIds,wrapper:wrapper};if(!me.useShapes){var f=false;def.copy(keyArgs,{noSelect:f,noHover:f,noClick:f,noDoubleClick:f,freeColor:f,noTooltip:isV1Compat});}
me.pvHeatGrid=new pvc.visual.Panel(me,pvRowPanel,keyArgs).lock('data',function(serScene){return serScene.childNodes;}).pvMark.lock(a_left,function(scene){return rowScale(scene.vars.category.value)-rowStep2;}).lock(a_width,rowStep).antialias(false);me.shapes=me.useShapes?me._createShapesHeatMap(cellSize,wrapper,hasColor,hasSize):me._createNoShapesHeatMap(hasColor);if(me.valuesVisible&&!me.valuesMask){me.valuesMask=me._getDefaultValuesMask(hasColor,hasSize);}
var label=pvc.visual.ValueLabel.maybeCreate(me,me.pvHeatGrid,{wrapper:wrapper});if(label){me.pvHeatGridLabel=label.pvMark;}},_calcCellSize:function(){var xScale=this.axes.x.scale;var yScale=this.axes.y.scale;var w=(xScale.max-xScale.min)/xScale.domain().length;var h=(yScale.max-yScale.min)/yScale.domain().length;if(!this.isOrientationVertical()){var tmp=w;w=h;h=tmp;}
return{width:w,height:h};},_buildSignsWrapper:function(rootScene){if(this.compatVersion()>1){return null;}
var colorValuesBySerAndCat=def.query(rootScene.childNodes).object({name:function(serScene){return''+serScene.vars.series.value;},value:function(serScene){return def.query(serScene.childNodes).object({name:function(leafScene){return''+leafScene.vars.category.value;},value:function(leafScene){var colorVar=leafScene.vars.color;return colorVar?(''+colorVar.value):null;}});}});return function(v1f){return function(leafScene){var colorValuesByCat=colorValuesBySerAndCat[leafScene.vars.series.value];var cat=leafScene.vars.category.rawValue;var wrapperParent=Object.create(this.parent);var wrapper=Object.create(this);wrapper.parent=wrapperParent;var catIndex=leafScene.childIndex();var serIndex=leafScene.parent.childIndex();wrapperParent.index=catIndex;wrapper.index=serIndex;return v1f.call(wrapper,colorValuesByCat,cat);};};},_getDefaultValuesMask:function(hasColor,hasSize){var roles=this.visualRoles;var roleName=hasColor?'color':hasSize?'size':null;if(roleName){var valueDimName=roles[roleName].firstDimensionName();return"{#"+valueDimName+"}";}},_createNoShapesHeatMap:function(hasColor){var getBaseColor=this._buildGetBaseFillColor(hasColor);return this.pvHeatGrid.sign.override('defaultColor',function(type){if(type==='stroke'){return null;}
return getBaseColor.call(this.pvMark,this.scene);}).override('interactiveColor',function(color,type){var scene=this.scene;if(scene.isActive){return color.alpha(0.6);}
if(scene.anySelected()&&!scene.isSelected()){return this.dimColor(color,type);}
return this.base(color,type);}).override('dimColor',function(color){return pvc.toGrayScale(color,0.6);}).pvMark.lineWidth(1.5);},_buildGetBaseFillColor:function(hasColor){var colorAxis=this.axes.color;return hasColor?colorAxis.sceneScale({sceneVarName:'color'}):def.fun.constant(colorAxis.option('Unbound'));},_createShapesHeatMap:function(cellSize,wrapper,hasColor,hasSize){var me=this;var areaRange=me._calcDotAreaRange(cellSize);if(hasSize){me.axes.size.setScaleRange(areaRange);}
var keyArgs={extensionId:'dot',freePosition:true,activeSeriesAware:false,wrapper:wrapper,tooltipArgs:me._buildShapesTooltipArgs(hasColor,hasSize)};var pvDot=new pvc.visual.DotSizeColor(me,me.pvHeatGrid,keyArgs).override('dimColor',function(color){return pvc.toGrayScale(color,0.6);}).pvMark.lock('shapeAngle');if(!hasSize){pvDot.sign.override('defaultSize',def.fun.constant(areaRange.max));}
return pvDot;},_calcDotAreaRange:function(cellSize){var w=cellSize.width;var h=cellSize.height;var maxRadius=Math.min(w,h)/2;if(this.shape==='diamond'){maxRadius/=Math.SQRT2;}
maxRadius-=2;var maxArea=def.sqr(maxRadius),minArea=12,areaSpan=maxArea-minArea;if(areaSpan<=1){maxArea=Math.max(maxArea,2);minArea=1;areaSpan=maxArea-minArea;if(pvc.debug>=2){this._warn("Using rescue mode dot area calculation due to insufficient space.");}}
return{min:minArea,max:maxArea,span:areaSpan};},_buildShapesTooltipArgs:function(hasColor,hasSize){var chart=this.chart;if(this.compatVersion()<=1&&this.showsTooltip()){var options=chart.options;var customTooltip=options.customTooltip;if(!customTooltip){customTooltip=function(s,c,d){if(d!=null&&d[0]!==undefined){return d.join(', ');}
return d;};}
var roles=this.visualRoles;var seriesDimsNames=roles.series.grouping.dimensionNames();var categDimsNames=roles.category.grouping.dimensionNames();return{buildTooltip:options.isMultiValued?function(context){var group=context.scene.group;if(!group){return"";}
var s=pvc.data.Complex.values(group,seriesDimsNames);var c=pvc.data.Complex.values(group,categDimsNames);var d=[];var vars=context.scene.vars;if(hasSize){d[options.sizeValIdx||0]=vars.size.value;}
if(hasColor){d[options.colorValIdx||0]=vars.color.value;}
return customTooltip.call(options,s,c,d);}:function(context){var vars=context.scene.vars;var s=vars.series.rawValue;var c=vars.category.rawValue;var valueVar=vars[hasColor?'color':'size'];var d=valueVar?valueVar.value:null;return customTooltip.call(options,s,c,d);}};}},renderInteractive:function(){this.pvPanel.render();},_buildScene:function(data,seriesRootData,cellSize){var me=this;var rootScene=new pvc.visual.Scene(null,{panel:me,source:data});var categDatas=data._children;var roles=me.visualRoles;var colorVarHelper=new pvc.visual.RoleVarHelper(rootScene,roles.color,{roleVar:'color'});var sizeVarHelper=new pvc.visual.RoleVarHelper(rootScene,roles.size,{roleVar:'size'});rootScene.cellSize=cellSize;seriesRootData.children().each(createSeriesScene);return rootScene;function createSeriesScene(serData1){var serScene=new pvc.visual.Scene(rootScene,{source:serData1});serScene.vars.series=pvc_ValueLabelVar.fromComplex(serData1);categDatas.forEach(function(catData1){createSeriesCategoryScene.call(me,serScene,catData1,serData1);});}
function createSeriesCategoryScene(serScene,catData1,serData1){var group=data._childrenByKey[catData1.key]._childrenByKey[serData1.key];var serCatScene=new pvc.visual.Scene(serScene,{source:group});serCatScene.vars.category=pvc_ValueLabelVar.fromComplex(catData1);colorVarHelper.onNewScene(serCatScene,true);sizeVarHelper.onNewScene(serCatScene,true);}}});def.type('pvc.HeatGridChart',pvc.CategoricalAbstract).add({_allowColorPerCategory:true,_axisCreateIfUnbound:{'color':true},_processOptionsCore:function(options){this.base(options);def.set(options,'orthoAxisOrdinal',true,'legend',false,'panelSizeRatio',1);var colorDimName='value',sizeDimName='value2';if(this.compatVersion()<=1){switch(this.options.colorValIdx){case 0:colorDimName='value';break;case 1:colorDimName='value2';break;default:colorDimName='value';}
switch(this.options.sizeValIdx){case 0:sizeDimName='value';break;case 1:sizeDimName='value2';break;default:sizeDimName='value';}}
this._colorDimName=colorDimName;this._sizeDimName=sizeDimName;},_getCategoryRoleSpec:function(){var catRoleSpec=this.base();catRoleSpec.requireIsDiscrete=true;return catRoleSpec;},_getColorRoleSpec:function(){return{isMeasure:true,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number,defaultDimension:this._colorDimName};},_initVisualRoles:function(){this.base();this._addVisualRole('size',{isMeasure:true,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number,defaultDimension:this._sizeDimName});},_initPlotsCore:function(){new pvc.visual.HeatGridPlot(this);},_collectPlotAxesDataCells:function(plot,dataCellsByAxisTypeThenIndex){this.base(plot,dataCellsByAxisTypeThenIndex);if(plot.type==='heatGrid'&&plot.option('UseShapes')){var sizeRole=this.visualRole(plot.option('SizeRole'));if(sizeRole.isBound()){var sizeDataCellsByAxisIndex=def.array.lazy(dataCellsByAxisTypeThenIndex,'size');def.array.lazy(sizeDataCellsByAxisIndex,plot.option('SizeAxis')-1).push({plot:plot,role:sizeRole,dataPartValue:plot.option('DataPart')});}}},_setAxesScales:function(hasMultiRole){this.base(hasMultiRole);if(!hasMultiRole||this.parent){var sizeAxis=this.axes.size;if(sizeAxis&&sizeAxis.isBound()){this._createAxisScale(sizeAxis);}}},_createPlotPanels:function(parentPanel,baseOptions){var heatGridPlot=this.plots.heatGrid;this.heatGridChartPanel=new pvc.HeatGridPanel(this,parentPanel,heatGridPlot,Object.create(baseOptions));},defaults:{colorValIdx:0,sizeValIdx:1,measuresIndexes:[2],axisOffset:0,plotFrameVisible:false,colorNormByCategory:true,numSD:2}});def.type('pvc.MetricXYAbstract',pvc.CartesianAbstract).add({_processOptionsCore:function(options){this.base(options);options.panelSizeRatio=1;},_initVisualRoles:function(){this.base();this._addVisualRole('x',{isMeasure:true,isRequired:true,requireSingleDimension:true,requireIsDiscrete:false,defaultDimension:'x',dimensionDefaults:{valueType:this.options.timeSeries?Date:Number}});this._addVisualRole('y',{isMeasure:true,isRequired:true,requireSingleDimension:true,requireIsDiscrete:false,defaultDimension:'y',dimensionDefaults:{valueType:Number}});},_generateTrendsDataCellCore:function(newDatums,dataCell,trendInfo){var serRole=this._serRole;var xRole=this.visualRoles.x;var yRole=dataCell.role;var trendOptions=dataCell.trend;this._warnSingleContinuousValueRole(yRole);var dataPartDimName=this._dataPartRole.firstDimensionName();var xDimName=xRole.firstDimensionName();var yDimName=yRole.firstDimensionName();var data=this.visibleData(dataCell.dataPartValue);def.scope(function(){return serRole.isBound()?data.children():def.query([data]);}).each(genSeriesTrend,this);function genSeriesTrend(serData){var funX=function(datum){return datum.atoms[xDimName].value;};var funY=function(datum){return datum.atoms[yDimName].value;};var datums=serData.datums().sort(null,funX).array();var options=def.create(trendOptions,{rows:def.query(datums),x:funX,y:funY});var trendModel=trendInfo.model(options);if(trendModel){var dataPartAtom=data.owner.dimensions(dataPartDimName).intern(this.root._firstTrendAtomProto);datums.forEach(function(datum,index){var trendX=funX(datum);if(trendX){var trendY=trendModel.sample(trendX,funY(datum),index);if(trendY!=null){var atoms=def.set(Object.create(serData.atoms),xDimName,trendX,yDimName,trendY,dataPartDimName,dataPartAtom);newDatums.push(def.set(new pvc.data.Datum(data.owner,atoms),'isVirtual',true,'isTrend',true,'trendType',trendInfo.type));}}});}}}});def.type('pvc.data.MetricPointChartTranslationOper').add({_meaLayoutRoles:['x','y','color','size'],configureType:function(){var freeMeaIndexes=[];var freeDisIndexes=[];this.collectFreeDiscreteAndConstinuousIndexes(freeDisIndexes,freeMeaIndexes);var N;var autoDimNames=[];var F=freeMeaIndexes.length;if(F>0){var R=this._meaLayoutRoles.length;var i=0;while(i<R&&autoDimNames.length<F){this._getUnboundRoleDefaultDimNames(this._meaLayoutRoles[i],1,autoDimNames);i++;}
N=autoDimNames.length;if(N>0){freeMeaIndexes.length=N;this.defReader({names:autoDimNames,indexes:freeMeaIndexes});}}
F=freeDisIndexes.length;if(F>0){autoDimNames.length=0;this._getUnboundRoleDefaultDimNames('series',F,autoDimNames);N=autoDimNames.length;if(N>0){freeDisIndexes.length=N;this.defReader({names:autoDimNames,indexes:freeDisIndexes});}}}});def.type('pvc.MetricPointPanel',pvc.CartesianAbstractPanel).init(function(chart,parent,plot,options){this.base(chart,parent,plot,options);this.axes.size=chart._getAxis('size',(plot.option('SizeAxis')||0)-1);var sizeRoleName=plot.option('SizeRole');this.visualRoles.size=sizeRoleName?chart.visualRole(sizeRoleName):null;this.linesVisible=plot.option('LinesVisible');this.dotsVisible=plot.option('DotsVisible');if(!this.linesVisible&&!this.dotsVisible){this.linesVisible=true;plot.option.specify({'LinesVisible':true});}
if(!this.offsetPaddings){this.offsetPaddings=new pvc_Sides(0.01);}}).add({sizeAxisRatio:1/5,sizeAxisRatioTo:'minWidthHeight',autoPaddingByDotSize:true,_v1DimRoleName:{'category':'x','value':'y'},_creating:function(){var groupScene=this.defaultVisibleBulletGroupScene();if(groupScene&&!groupScene.hasRenderer()){var colorAxis=groupScene.colorAxis;var drawMarker=def.nullyTo(colorAxis.option('LegendDrawMarker',true),this.dotsVisible);var drawRule=def.nullyTo(colorAxis.option('LegendDrawLine',true),this.linesVisible);if(drawMarker||drawRule){var keyArgs={drawMarker:drawMarker,drawRule:drawRule};if(drawMarker){keyArgs.markerShape=colorAxis.option('LegendShape',true)||'circle';keyArgs.markerPvProto=new pv.Dot().lineWidth(1.5,pvc.extensionTag).shapeSize(12,pvc.extensionTag);this.extend(keyArgs.markerPvProto,'dot',{constOnly:true});}
if(drawRule){keyArgs.rulePvProto=new pv.Line().lineWidth(1.5,pvc.extensionTag);this.extend(keyArgs.rulePvProto,'line',{constOnly:true});}
groupScene.renderer(new pvc.visual.legend.BulletItemDefaultRenderer(keyArgs));}}},_getRootScene:function(){return def.lazy(this,'_rootScene',this._buildScene,this);},_calcLayout:function(layoutInfo){var rootScene=this._getRootScene();if(rootScene.isSizeBound){this.axes.size.setScaleRange(this._calcDotAreaRange(layoutInfo));}
this._calcAxesPadding(layoutInfo,rootScene);},_getDotDiameterRefLength:function(layoutInfo){var clientSize=layoutInfo.clientSize;var paddings=layoutInfo.paddings;switch(this.sizeAxisRatioTo){case'minWidthHeight':return Math.min(clientSize.width+paddings.width,clientSize.height+paddings.height);case'width':return clientSize.width+paddings.width;case'height':return clientSize.height+paddings.height;}
if(pvc.debug>=2){this._log(def.format("Invalid option 'sizeAxisRatioTo' value. Assuming 'minWidthHeight'.",[this.sizeAxisRatioTo]));}
this.sizeRatioTo='minWidthHeight';return this._getDotDiameterRefLength(layoutInfo);},_calcDotRadiusRange:function(layoutInfo){var refLength=this._getDotDiameterRefLength(layoutInfo);var max=(this.sizeAxisRatio/2)*refLength;var min=Math.sqrt(12);return{min:min,max:max};},_calcDotAreaRange:function(layoutInfo){var radiusRange=this._calcDotRadiusRange(layoutInfo);if(this.shape==='diamond'){radiusRange.max/=Math.SQRT2;radiusRange.min/=Math.SQRT2;}
var maxArea=def.sqr(radiusRange.max),minArea=def.sqr(radiusRange.min),areaSpan=maxArea-minArea;if(areaSpan<=1){maxArea=Math.max(maxArea,2);minArea=1;areaSpan=maxArea-minArea;radiusRange={min:Math.sqrt(minArea),max:Math.sqrt(maxArea)};if(pvc.debug>=3){this._log("Using rescue mode dot area calculation due to insufficient space.");}}
return{min:minArea,max:maxArea,span:areaSpan};},_calcAxesPadding:function(layoutInfo,rootScene){var requestPaddings;if(!this.autoPaddingByDotSize){requestPaddings=this._calcRequestPaddings(layoutInfo);}else{var axes=this.axes;var clientSize=layoutInfo.clientSize;var paddings=layoutInfo.paddings;requestPaddings={};axes.x.setScaleRange(clientSize.width);axes.y.setScaleRange(clientSize.height);var sceneXScale=axes.base.sceneScale({sceneVarName:'x'});var sceneYScale=axes.ortho.sceneScale({sceneVarName:'y'});var xLength=axes.base.scale.max;var yLength=axes.ortho.scale.max;var hasSizeRole=rootScene.isSizeBound;var sizeScale=hasSizeRole?this.axes.size.scale:null;if(!sizeScale){var defaultSize=def.number.as(this._getExtension('dot','shapeRadius'),0);if(defaultSize<=0){defaultSize=def.number.as(this._getExtension('dot','shapeSize'),0);if(defaultSize<=0){defaultSize=12;}}else{defaultSize=def.sqr(defaultSize);}
sizeScale=def.fun.constant(defaultSize);}
requestPaddings={};var op;if(this.offsetPaddings){op={};pvc_Sides.names.forEach(function(side){var len_a=pvc.BasePanel.orthogonalLength[side];op[side]=(this.offsetPaddings[side]||0)*(clientSize[len_a]+paddings[len_a]);},this);}
var setSide=function(side,padding){if(op){padding+=(op[side]||0);}
if(padding<0){padding=0;}
var value=requestPaddings[side];if(value==null||padding>value){requestPaddings[side]=padding;}};var processScene=function(scene){var x=sceneXScale(scene);var y=sceneYScale(scene);var r=Math.sqrt(sizeScale(hasSizeRole?scene.vars.size.value:0));setSide('left',r-x);setSide('bottom',r-y);setSide('right',x+r-xLength);setSide('top',y+r-yLength);};rootScene.children().selectMany(function(seriesScene){return seriesScene.childNodes;}).each(processScene);}
layoutInfo.requestPaddings=requestPaddings;},_createCore:function(){var me=this;me.base();var chart=me.chart;var rootScene=me._getRootScene();var wrapper=me._buildSignsWrapper();var isV1Compat=me.compatVersion()<=1;this._finalizeScene(rootScene);me.pvPanel.zOrder(1);this.pvScatterPanel=new pvc.visual.Panel(me,me.pvPanel,{extensionId:'panel'}).lock('data',rootScene.childNodes).pvMark;var isLineNoSelect=chart.selectableByFocusWindow();var isColorDiscrete=rootScene.isColorBound&&this.visualRoles.color.isDiscrete();var line=new pvc.visual.Line(me,me.pvScatterPanel,{extensionId:'line',wrapper:wrapper,noTooltip:false,noSelect:isLineNoSelect,showsSelection:!isLineNoSelect}).lockMark('data',function(seriesScene){return seriesScene.childNodes;}).intercept('visible',function(scene){if(!me.linesVisible){return false;}
var visible=this.delegateExtension();if(visible==null){visible=!scene.isNull&&((!rootScene.isSizeBound&&!rootScene.isColorBound)||(rootScene.isSizeBound&&scene.vars.size.value!=null)||(rootScene.isColorBound&&(isColorDiscrete||scene.vars.color.value!=null)));}
return visible;}).override('x',function(){return this.scene.basePosition;}).override('y',function(){return this.scene.orthoPosition;});me.pvLine=line.pvMark;var dot=new pvc.visual.DotSizeColor(me,me.pvLine,{extensionId:'dot',wrapper:wrapper,activeSeriesAware:me.linesVisible}).override('x',function(){return this.scene.basePosition;}).override('y',function(){return this.scene.orthoPosition;}).override('color',function(type){if(!me.dotsVisible&&!this.scene.isActive&&!this.scene.isSingle){return pvc.invisibleFill;}
return this.base(type);});if(!rootScene.isSizeBound){dot.override('baseSize',function(){if(!me.dotsVisible){if(this.scene.isSingle){var lineWidth=Math.max(me.pvLine.scene[this.pvMark.index].lineWidth,0.2)/2;return def.sqr(lineWidth);}}
return this.base();});}else if(!(me.autoPaddingByDotSize&&me.sizeAxisRatioTo==='minWidthHeight')){me.pvPanel.borderPanel.overflow("hidden");}
me.pvDot=dot.pvMark;me.pvDot.rubberBandSelectionMode='center';if(pvc.visual.ValueLabel.isNeeded(me)){var extensionIds=['label'];if(isV1Compat){extensionIds.push('lineLabel');}
var label=pvc.visual.ValueLabel.maybeCreate(me,me.pvDot,{extensionId:extensionIds,wrapper:wrapper});if(label){me.pvHeatGridLabel=label.pvMark;}}},_buildSignsWrapper:function(){if(this.compatVersion()>1){return null;}
return function(v1f){return function(scene){var d={category:scene.vars.x.rawValue,value:scene.vars.y.rawValue};var pseudo=Object.create(this);pseudo.index=scene.dataIndex;return v1f.call(pseudo,d);};};},renderInteractive:function(){this.pvScatterPanel.render();},_buildScene:function(){var data=this.visibleData({ignoreNulls:false});var rootScene=new pvc.visual.Scene(null,{panel:this,source:data});var roles=this.visualRoles;var axes=this.axes;var colorVarHelper=new pvc.visual.RoleVarHelper(rootScene,roles.color,{roleVar:'color'});var sizeVarHelper=new pvc.visual.RoleVarHelper(rootScene,roles.size,{roleVar:'size'});var xDim=data.owner.dimensions(roles.x.firstDimensionName());var yDim=data.owner.dimensions(roles.y.firstDimensionName());data.children().each(createSeriesScene,this);rootScene.children().each(completeSeriesScenes,this);return rootScene;function createSeriesScene(seriesGroup){var seriesScene=new pvc.visual.Scene(rootScene,{source:seriesGroup});seriesScene.vars.series=pvc_ValueLabelVar.fromComplex(seriesGroup);colorVarHelper.onNewScene(seriesScene,false);seriesGroup.datums().each(function(datum,dataIndex){var xAtom=datum.atoms[xDim.name];if(xAtom.value==null){return;}
var yAtom=datum.atoms[yDim.name];if(yAtom.value==null){return;}
var scene=new pvc.visual.Scene(seriesScene,{source:datum});scene.dataIndex=dataIndex;scene.vars.x=pvc_ValueLabelVar.fromAtom(xAtom);scene.vars.y=pvc_ValueLabelVar.fromAtom(yAtom);sizeVarHelper.onNewScene(scene,true);colorVarHelper.onNewScene(scene,true);scene.isIntermediate=false;});}
function completeSeriesScenes(seriesScene){var seriesScenes=seriesScene.childNodes,fromScene;for(var c=0,toChildIndex=0,pointCount=seriesScenes.length;c<pointCount;c++,toChildIndex++){var toScene=seriesScenes[toChildIndex];toScene.isSingle=!fromScene&&!toScene.nextSibling;if(fromScene){var interScene=createIntermediateScene(seriesScene,fromScene,toScene,toChildIndex);if(interScene){toChildIndex++;}}
fromScene=toScene;}}
function createIntermediateScene(seriesScene,fromScene,toScene,toChildIndex){var interYValue=yDim.type.cast.call(null,((+toScene.vars.y.value)+(+fromScene.vars.y.value))/2);var interXValue=xDim.type.cast.call(null,((+toScene.vars.x.value)+(+fromScene.vars.x.value))/2);var interScene=new pvc.visual.Scene(seriesScene,{index:toChildIndex,source:toScene.datum});interScene.dataIndex=toScene.dataIndex;interScene.vars.x=new pvc_ValueLabelVar(interXValue,xDim.format(interXValue),interXValue);interScene.vars.y=new pvc_ValueLabelVar(interYValue,yDim.format(interYValue),interYValue);sizeVarHelper.onNewScene(interScene,true);colorVarHelper.onNewScene(interScene,true);interScene.ownerScene=toScene;interScene.isIntermediate=true;interScene.isSingle=false;return interScene;}},_finalizeScene:function(rootScene){var axes=this.axes,sceneBaseScale=axes.base.sceneScale({sceneVarName:'x'}),sceneOrthoScale=axes.ortho.sceneScale({sceneVarName:'y'});rootScene.children().selectMany(function(seriesScene){return seriesScene.childNodes;}).each(function(leafScene){leafScene.basePosition=sceneBaseScale(leafScene);leafScene.orthoPosition=sceneOrthoScale(leafScene);});return rootScene;}});def.type('pvc.MetricPointAbstract',pvc.MetricXYAbstract).add({_initPlotsCore:function(){var pointPlot=this._createPointPlot();var trend=pointPlot.option('Trend');if(trend){new pvc.visual.MetricPointPlot(this,{name:'trend',fixed:{DataPart:'trend',TrendType:'none',NullInterpolatioMode:'none',ColorRole:'series',SizeRole:null,SizeAxis:null,OrthoAxis:1},defaults:{ColorAxis:2,LinesVisible:true,DotsVisible:false}});}},_hasDataPartRole:function(){return true;},_getColorRoleSpec:function(){return{defaultSourceRole:'series',defaultDimension:'color*',dimensionDefaults:{valueType:Number}};},_initVisualRoles:function(){this.base();this._addVisualRole('size',{isMeasure:true,requireSingleDimension:true,requireIsDiscrete:false,defaultDimension:'size',dimensionDefaults:{valueType:Number}});},_getTranslationClass:function(translOptions){return def.type(this.base(translOptions)).add(pvc.data.MetricPointChartTranslationOper);},_collectPlotAxesDataCells:function(plot,dataCellsByAxisTypeThenIndex){this.base(plot,dataCellsByAxisTypeThenIndex);if(plot.type==='scatter'&&plot.option('DotsVisible')){var sizeRoleName=plot.option('SizeRole');if(sizeRoleName){var sizeRole=this.visualRole(sizeRoleName);if(sizeRole.isBound()){var sizeDataCellsByAxisIndex=def.array.lazy(dataCellsByAxisTypeThenIndex,'size');def.array.lazy(sizeDataCellsByAxisIndex,plot.option('SizeAxis')-1).push({plot:plot,role:sizeRole,dataPartValue:plot.option('DataPart')});}}}},_setAxesScales:function(hasMultiRole){this.base(hasMultiRole);if(!hasMultiRole||this.parent){var sizeAxis=this.axes.size;if(sizeAxis&&sizeAxis.isBound()){this._createAxisScale(sizeAxis);}}},_createPlotPanels:function(parentPanel,baseOptions){var options=this.options;var panelOptions=def.set(Object.create(baseOptions),'sizeAxisRatio',options.sizeAxisRatio,'sizeAxisRatioTo',options.sizeAxisRatioTo,'autoPaddingByDotSize',options.autoPaddingByDotSize);var scatterPlot=this.plots.scatter;this.scatterChartPanel=new pvc.MetricPointPanel(this,parentPanel,scatterPlot,panelOptions);var trendPlot=this.plots.trend;if(trendPlot){new pvc.MetricPointPanel(this,parentPanel,trendPlot,Object.create(panelOptions));}},defaults:{axisOriginIsZero:false,tooltipOffset:10}});def.type('pvc.MetricDotChart',pvc.MetricPointAbstract).add({_createPointPlot:function(){return new pvc.visual.MetricPointPlot(this,{fixed:{DotsVisible:true}});}});def.type('pvc.MetricLineChart',pvc.MetricPointAbstract).add({_createPointPlot:function(){return new pvc.visual.MetricPointPlot(this,{fixed:{LinesVisible:true}});}});def.type('pvc.BulletChart',pvc.BaseChart).init(function(options){options=options||{};var dimGroups=options.dimensionGroups||(options.dimensionGroups={});var rangeDimGroup=dimGroups.range||(dimGroups.range={});if(rangeDimGroup.valueType===undefined){rangeDimGroup.valueType=Number;}
var markerDimGroup=dimGroups.marker||(dimGroups.marker={});if(markerDimGroup.valueType===undefined){markerDimGroup.valueType=Number;}
this.base(options);}).add({bulletChartPanel:null,allowNoData:true,_processOptionsCore:function(options){options.legend=false;options.selectable=false;this.base(options);},_initVisualRoles:function(){this.base();this._addVisualRole('title',{defaultDimension:'title*'});this._addVisualRole('subTitle',{defaultDimension:'subTitle*'});this._addVisualRole('value',{isMeasure:true,requireIsDiscrete:false,valueType:Number,defaultDimension:'value*'});this._addVisualRole('marker',{isMeasure:true,requireIsDiscrete:false,valueType:Number,defaultDimension:'marker*'});this._addVisualRole('range',{isMeasure:true,requireIsDiscrete:false,valueType:Number,defaultDimension:'range*'});},_createTranslation:function(translOptions){var translation=this.base(translOptions),size=translation.virtualItemSize();if(size){switch(size){case 1:translation.defReader({names:'value'});break;case 2:translation.defReader({names:['title','value']});break;case 3:translation.defReader({names:['title','value','marker']});break;default:translation.defReader({names:['title','subTitle','value','marker']});if(size>4){translation.defReader({names:'range',indexes:pv.range(4,size)});}
break;}}
return translation;},_initPlotsCore:function(hasMultiRole){new pvc.visual.BulletPlot(this);},_preRenderContent:function(contentOptions){var bulletPlot=this.plots.bullet;this.bulletChartPanel=new pvc.BulletChartPanel(this,this.basePanel,bulletPlot,contentOptions);},defaults:{compatVersion:1,orientation:'horizontal',bulletSize:30,bulletSpacing:50,bulletMargin:100,bulletTitle:"Title",bulletSubtitle:"",bulletTitlePosition:"left",tooltipFormat:function(s,c,v){return this.chart.options.valueFormat(v);},crosstabMode:false,seriesInRows:false}});def.type('pvc.BulletChartPanel',pvc.PlotPanel).add({pvBullets:null,pvBullet:null,data:null,onSelectionChange:null,_createCore:function(layoutInfo){var chart=this.chart,options=chart.options,data=this.buildData();var anchor=options.orientation=="horizontal"?"left":"bottom";var size,angle,align,titleLeftOffset,titleTopOffset,ruleAnchor,leftPos,topPos,titleSpace;if(options.orientation=="horizontal"){size=layoutInfo.clientSize.width-this.chart.options.bulletMargin-20;angle=0;switch(options.bulletTitlePosition){case'top':leftPos=this.chart.options.bulletMargin;titleLeftOffset=0;align='left';titleTopOffset=-12;titleSpace=parseInt(options.titleSize/2,10);break;case'bottom':leftPos=this.chart.options.bulletMargin;titleLeftOffset=0;align='left';titleTopOffset=options.bulletSize+32;titleSpace=0;break;case'right':leftPos=5;titleLeftOffset=size+5;align='left';titleTopOffset=parseInt(options.bulletSize/2,10);titleSpace=0;break;case'left':default:leftPos=this.chart.options.bulletMargin;titleLeftOffset=0;titleTopOffset=parseInt(options.bulletSize/2,10);align='right';titleSpace=0;}
ruleAnchor="bottom";topPos=function(){return(this.index*(options.bulletSize+options.bulletSpacing))+titleSpace;};}else{size=layoutInfo.clientSize.height-this.chart.options.bulletMargin-20;switch(options.bulletTitlePosition){case'top':leftPos=this.chart.options.bulletMargin;titleLeftOffset=0;align='left';titleTopOffset=-20;angle=0;topPos=undefined;break;case'bottom':leftPos=this.chart.options.bulletMargin;titleLeftOffset=0;align='left';titleTopOffset=size+20;angle=0;topPos=20;break;case'right':leftPos=5;titleLeftOffset=this.chart.options.bulletSize+40;align='left';titleTopOffset=size;angle=-Math.PI/2;topPos=undefined;break;case'left':default:leftPos=this.chart.options.bulletMargin;titleLeftOffset=-12;titleTopOffset=this.height-this.chart.options.bulletMargin-20;align='left';angle=-Math.PI/2;topPos=undefined;}
ruleAnchor="right";leftPos=function(){return options.bulletMargin+this.index*(options.bulletSize+options.bulletSpacing);};}
this.pvBullets=this.pvPanel.add(pv.Panel).data(data)
[pvc.BasePanel.orthogonalLength[anchor]](size)
[pvc.BasePanel.parallelLength[anchor]](this.chart.options.bulletSize).margin(20).left(leftPos).top(topPos);this.pvBullet=this.pvBullets.add(pv.Layout.Bullet).orient(anchor).ranges(function(d){return d.ranges;}).measures(function(d){return d.measures;}).markers(function(d){return d.markers;});if(chart.clickable()&&this.clickAction){var me=this;this.pvBullet.cursor("pointer").event("click",function(d){var s=d.title;var c=d.subtitle;var ev=pv.event;return me.clickAction(s,c,d.measures,ev);});}
this.pvBulletRange=this.pvBullet.range.add(pv.Bar);this.pvBulletMeasure=this.pvBullet.measure.add(pv.Bar).text(function(v,d){return d.formattedMeasures[this.index];});this.pvBulletMarker=this.pvBullet.marker.add(pv.Dot).shape("square").fillStyle("white").text(function(v,d){return d.formattedMarkers[this.index];});if(this.showsTooltip()){var myself=this;this.pvBulletMeasure.localProperty('tooltip').tooltip(function(v,d){var s=d.title;var c=d.subtitle;return chart.options.tooltipFormat.call(myself,s,c,v);});this.pvBulletMarker.localProperty('tooltip').tooltip(function(v,d){var s=d.title;var c=d.subtitle;return chart.options.tooltipFormat.call(myself,s,c,v);});this.pvBulletMeasure.event("mouseover",pv.Behavior.tipsy(this.chart._tooltipOptions));this.pvBulletMarker.event("mouseover",pv.Behavior.tipsy(this.chart._tooltipOptions));}
this.pvBulletRule=this.pvBullet.tick.add(pv.Rule);this.pvBulletRuleLabel=this.pvBulletRule.anchor(ruleAnchor).add(pv.Label).text(this.pvBullet.x.tickFormat);this.pvBulletTitle=this.pvBullet.anchor(anchor).add(pv.Label).font("bold 12px sans-serif").textAngle(angle).left(-10).textAlign(align).textBaseline("bottom").left(titleLeftOffset).top(titleTopOffset).text(function(d){return d.formattedTitle;});this.pvBulletSubtitle=this.pvBullet.anchor(anchor).add(pv.Label).textStyle("#666").textAngle(angle).textAlign(align).textBaseline("top").left(titleLeftOffset).top(titleTopOffset).text(function(d){return d.formattedSubtitle;});var doubleClickAction=(typeof(options.axisDoubleClickAction)=='function')?function(d,e){options.axisDoubleClickAction(d,e);}:null;if(chart.doubleClickable()&&doubleClickAction){this.pvBulletTitle.cursor("pointer").events('all').event("dblclick",function(d){doubleClickAction(d,arguments[arguments.length-1]);});this.pvBulletSubtitle.cursor("pointer").events('all').event("dblclick",function(d){doubleClickAction(d,arguments[arguments.length-1]);});}},applyExtensions:function(){this.base();this.extend(this.pvBullets,"bulletsPanel");this.extend(this.pvBullet,"bulletPanel");this.extend(this.pvBulletRange,"bulletRange");this.extend(this.pvBulletMeasure,"bulletMeasure");this.extend(this.pvBulletMarker,"bulletMarker");this.extend(this.pvBulletRule,"bulletRule");this.extend(this.pvBulletRuleLabel,"bulletRuleLabel");this.extend(this.pvBulletTitle,"bulletTitle");this.extend(this.pvBulletSubtitle,"bulletSubtitle");},_getExtensionId:function(){return[{abs:'content'}].concat(this.base());},buildData:function(){var data,chart=this.chart,options=chart.options,titleRole=chart.visualRoles.title,titleGrouping=titleRole.grouping,subTitleRole=chart.visualRoles.subTitle,subTitleGrouping=subTitleRole.grouping,valueRole=chart.visualRoles.value,valueGrouping=valueRole.grouping,markerRole=chart.visualRoles.marker,markerGrouping=markerRole.grouping,rangeRole=chart.visualRoles.range,rangeGrouping=rangeRole.grouping;var defaultData={title:options.bulletTitle,formattedTitle:options.bulletTitle,subtitle:options.bulletSubtitle,formattedSubtitle:options.bulletSubtitle,ranges:def.array.to(options.bulletRanges)||[],measures:def.array.to(options.bulletMeasures)||[],markers:def.array.to(options.bulletMarkers)||[]};def.set(defaultData,'formattedRanges',defaultData.ranges.map(String),'formattedMeasures',defaultData.measures.map(String),'formattedMarkers',defaultData.markers.map(String));if(!valueGrouping&&!titleGrouping&&!markerGrouping&&!subTitleGrouping&&!rangeGrouping){data=[defaultData];}else{data=chart.data.datums().select(function(datum){var d=Object.create(defaultData),view;if(valueGrouping){view=valueGrouping.view(datum);d.measures=view.values();d.formattedMeasures=view.labels();}
if(titleGrouping){view=titleGrouping.view(datum);d.title=view.value;d.formattedTitle=view.label;}
if(subTitleGrouping){view=subTitleGrouping.view(datum);d.subtitle=view.value;d.formattedSubtitle=view.label;}
if(markerGrouping){view=markerGrouping.view(datum);d.markers=view.values();d.formattedMarkers=view.labels();}
if(rangeGrouping){view=rangeGrouping.view(datum);d.ranges=view.values();d.formattedRanges=view.labels();}
return d;},this).array();}
return data;}});def.type('pvc.ParallelCoordinates',pvc.BaseChart).init(function(options){options=options||{};options.dimensions=options.dimensions||{};if(!options.dimensions.value){options.dimensions.value={valueType:null};}
this.base(options);}).add({parCoordPanel:null,_preRenderContent:function(contentOptions){this.parCoordPanel=new pvc.ParCoordPanel(this,this.basePanel,def.create(contentOptions,{topRuleOffset:this.options.topRuleOffset,botRuleOffset:this.options.botRuleOffset,leftRuleOffset:this.options.leftRuleOffset,rightRuleOffset:this.options.rightRuleOffset,sortCategorical:this.options.sortCategorical,mapAllDimensions:this.options.mapAllDimensions,numDigits:this.options.numDigits}));},defaults:def.create(pvc.BaseChart.prototype.defaults,{compatVersion:1,topRuleOffset:30,botRuleOffset:30,leftRuleOffset:60,rightRuleOffset:60,sortCategorical:true,mapAllDimensions:true,numDigits:0})});def.type('pvc.ParCoordPanel',pvc.BasePanel).add({anchor:'fill',pvParCoord:null,dimensions:null,dimensionDescr:null,data:null,retrieveData:function(){var data=this.chart.data;var numDigit=this.chart.options.numDigits;this.dimensions=data.getVisibleCategories();var values=data.getValues();var dataRowIndex=data.getVisibleSeriesIndexes();var pCoordIndex=data.getVisibleCategoriesIndexes();var pCoordKeys=data.getCategories();var pCoordMapping=this.chart.options.mapAllDimensions?pCoordIndex.map(function(d){return isNaN(values[d][0])?{categorical:true,len:0,map:[]}:{categorical:false,len:0,map:[],displayValue:[]};}):pCoordIndex.map(function(d){return isNaN(values[d][0])?{categorical:true,len:0,map:[]}:null;});var coordMapUpdate=function(i,val){var cMap=pCoordMapping[i];var k=null;if(!cMap.categorical){var keyVal=val.toFixed(numDigit);k=cMap.map[keyVal];if(k==null){k=cMap.len;cMap.len++;cMap.map[keyVal]=k;cMap.displayValue[keyVal]=val;}}else{k=cMap.map[val];if(k==null){k=cMap.len;cMap.len++;cMap.map[val]=k;}}
return k;};for(var d in pCoordMapping){if(pCoordMapping.hasOwnProperty(d)&&pCoordMapping[d]&&pCoordMapping[d].categorical){pCoordMapping[d].displayValue=pCoordMapping[d].map;}}
var i,item,k;if(this.chart.options.sortCategorical||this.chart.options.mapAllDimensions){for(i=0;i<pCoordMapping.length;i++){if(pCoordMapping[i]){for(var col=0;col<values[i].length;col++){coordMapUpdate(i,values[i][col]);}
var cMap=pCoordMapping[i].map;var sorted=[];for(item in cMap){if(cMap.hasOwnProperty(item)){sorted.push(item);}}
sorted.sort();if(pCoordMapping[i].categorical){for(k=0;k<sorted.length;k++){cMap[sorted[k]]=k;}}else{for(k=0;k<sorted.length;k++){cMap[sorted[k]].index=k;}}}}}
var generateHashMap=function(col){var record={};for(var j in pCoordIndex){if(pCoordIndex.hasOwnProperty(j)){record[pCoordKeys[j]]=(pCoordMapping[j])?coordMapUpdate(j,values[j][col]):values[j][col];}}
return record;};this.data=dataRowIndex.map(function(col){return generateHashMap(col);});var descrVals=this.dimensions.map(function(cat){var item2={};var elements=cat.split("__");item2.id=cat;item2.name=elements[0];item2.unit=(elements.length>1)?elements[1]:"";return item2;});for(i=0;i<descrVals.length;i++){item=descrVals[i];var index=pCoordIndex[i];item.orgRowIndex=index;var len=values[index].length;var theMin,theMax,theMin2,theMax2;var v;if(pCoordMapping[index]){theMin=theMax=theMin2=theMax2=pCoordMapping[index].displayValue[values[index][0]];for(k=1;k<len;k++){v=pCoordMapping[index].displayValue[values[index][k]];if(v<theMin){theMin2=theMin;theMin=v;}
if(v>theMax){theMax2=theMax;theMax=v;}}}else{theMin=theMax=theMin2=theMax2=values[index][0];for(k=1;k<len;k++){v=values[index][k];if(v<theMin){theMin2=theMin;theMin=v;}
if(v>theMax){theMax2=theMax;theMax=v;}}}
var theStep=((theMax-theMax2)+(theMin2-theMin))/2;item.min=theMin;item.max=theMax;item.step=theStep;item.categorical=false;if(pCoordMapping[index]){item.map=pCoordMapping[index].map;item.mapLength=pCoordMapping[index].len;item.categorical=pCoordMapping[index].categorical;if(!item.categorical){item.orgValue=[];var theMap=pCoordMapping[index].map;for(var key in theMap){if(theMap.hasOwnProperty(key)){item.orgValue[theMap[key]]=0.0+key;}}}}}
var genKeyVal=function(keys,vals){var record={};for(var i=0;i<keys.length;i++){record[keys[i]]=vals[i];}
return record;};this.dimensionDescr=genKeyVal(this.dimensions,descrVals);},_createCore:function(){var myself=this;this.retrieveData();var height=this.height,numDigits=this.chart.options.numDigits,topRuleOffs=this.chart.options.topRuleOffset,botRuleOffs=this.chart.options.botRuleOffset,leftRuleOffs=this.chart.options.leftRuleOffset,rightRulePos=this.width-this.chart.options.rightRuleOffset,topRulePos=this.height-topRuleOffs,ruleHeight=topRulePos-botRuleOffs,labelTopOffs=topRuleOffs-12,dims=this.dimensions,dimDescr=this.dimensionDescr;var getDimSc=function(t,addMargin){var theMin=dimDescr[t].min;var theMax=dimDescr[t].max;var theStep=dimDescr[t].step;if(addMargin){theMin-=theStep;theMax+=theStep;}
return pv.Scale.linear(theMin,theMax).range(botRuleOffs,topRulePos);};var getDimensionScale=function(t){var scale=getDimSc(t,true).range(botRuleOffs,topRulePos);var dd=dimDescr[t];if(dd.orgValue&&!dd.categorical){var func=function(x){var res=scale(dd.orgValue[x]);return res;};func.domain=function(){return scale.domain();};func.invert=function(d){return scale.invert(d);};return func;}
return scale;};var getDimColorScale=function(t){var scale=getDimSc(t,false).range("steelblue","brown");return scale;};var x=pv.Scale.ordinal(dims).splitFlush(leftRuleOffs,rightRulePos);var y=pv.dict(dims,getDimensionScale);var colors=pv.dict(dims,getDimColorScale);var filter=pv.dict(dims,function(t){return{min:y[t].domain()[0],max:y[t].domain()[1]};});var active=dims[0];var selectVisible=this.chart.options.mapAllDimensions?function(d){return dims.every(function(t){var dd=dimDescr[t];var val=(dd.orgValue&&!dd.categorical)?dd.orgValue[d[t]]:d[t];return(val>=filter[t].min)&&(val<=filter[t].max);});}:function(d){return dims.every(function(t){return(d[t]>=filter[t].min)&&(d[t]<=filter[t].max);});};var auxData=null;this.pvParCoord=this.pvPanel.add(pv.Panel).data(myself.data).visible(selectVisible).add(pv.Line).data(dims).left(function(t,d){return x(t);}).bottom(function(t,d){var res=y[t](d[t]);return res;}).strokeStyle("#ddd").lineWidth(1).antialias(false);var rule=this.pvPanel.add(pv.Rule).data(dims).left(x).top(topRuleOffs).bottom(botRuleOffs);rule.anchor("top").add(pv.Label).top(labelTopOffs).font("bold 10px sans-serif").text(function(d){return dimDescr[d].name;});var labels=[];var labelXoffs=6,labelYoffs=3;for(var d in dimDescr){if(dimDescr.hasOwnProperty(d)){var dim=dimDescr[d];if(dim.categorical){var xVal=x(dim.id)+labelXoffs;for(var l in dim.map){if(dim.map.hasOwnProperty(l)){labels[labels.length]={x:xVal,y:y[dim.id](dim.map[l])+labelYoffs,label:l};}}}}}
var dimLabels=this.pvPanel.add(pv.Panel).data(labels).add(pv.Label).left(function(d){return d.x;}).bottom(function(d){return d.y;}).text(function(d){return d.label;}).textAlign("left");var change=this.pvPanel.add(pv.Panel);var line=change.add(pv.Panel).data(myself.data).visible(selectVisible).add(pv.Line).data(dims).left(function(t,d){return x(t);}).bottom(function(t,d){return y[t](d[t]);}).strokeStyle(function(t,d){var dd=dimDescr[active];var val=(dd.orgValue&&!dd.categorical)?dd.orgValue[d[active]]:d[active];return colors[active](val);}).lineWidth(1);function update(d){var t=d.dim;filter[t].min=Math.max(y[t].domain()[0],y[t].invert(height-d.y-d.dy));filter[t].max=Math.min(y[t].domain()[1],y[t].invert(height-d.y));active=t;change.render();return false;}
function selectAll(d){if(d.dy<3){var t=d.dim;filter[t].min=Math.max(y[t].domain()[0],y[t].invert(0));filter[t].max=Math.min(y[t].domain()[1],y[t].invert(height));d.y=botRuleOffs;d.dy=ruleHeight;active=t;change.render();}
return false;}
var handle=change.add(pv.Panel).data(dims.map(function(dim){return{y:botRuleOffs,dy:ruleHeight,dim:dim};})).left(function(t){return x(t.dim)-30;}).width(60).fillStyle("rgba(0,0,0,.001)").cursor("crosshair").event("mousedown",pv.Behavior.select()).event("select",update).event("selectend",selectAll).add(pv.Bar).left(25).top(function(d){return d.y;}).width(10).height(function(d){return d.dy;}).fillStyle(function(t){return(t.dim==active)?colors[t.dim]((filter[t.dim].max+filter[t.dim].min)/2):"hsla(0,0,50%,.5)";}).strokeStyle("white").cursor("move").event("mousedown",pv.Behavior.drag()).event("dragstart",update).event("drag",update);handle.anchor("bottom").add(pv.Label).textBaseline("top").text(function(d){return(dimDescr[d.dim].categorical)?"":filter[d.dim].min.toFixed(numDigits)+dimDescr[d.dim].unit;});handle.anchor("top").add(pv.Label).textBaseline("bottom").text(function(d){return(dimDescr[d.dim].categorical)?"":filter[d.dim].max.toFixed(numDigits)+dimDescr[d.dim].unit;});this.extend(this.pvParCoord,"parCoord");this.extend(this.pvPanel,"chart");}});def.type('pvc.DataTree',pvc.BaseChart).init(function(options){options=options||{};options.dimensionGroups=options.dimensionGroups||{};if(!options.dimensionGroups.value){options.dimensionGroups.value={valueType:null};}
this.base(options);}).add({structEngine:null,structMetadata:null,structDataset:null,DataTreePanel:null,_getColorRoleSpec:function(){return{isRequired:true,defaultSourceRole:'category',requireIsDiscrete:true};},setStructData:function(data){this.structDataset=data.resultset;if(!this.structDataset.length){this._log("Warning: Structure-dataset is empty");}
this.structMetadata=data.metadata;if(!this.structMetadata.length){this._log("Warning: Structure-Metadata is empty");}},_preRenderContent:function(contentOptions){var structEngine=this.structEngine;var structType=structEngine?structEngine.type:new pvc.data.ComplexType();structType.addDimension('value',{});var translOptions={seriesInRows:true,crosstabMode:true};var translation=new pvc.data.CrosstabTranslationOper(structType,this.structDataset,this.structMetadata,translOptions);translation.configureType();if(!structEngine){structEngine=this.structEngine=new pvc.data.Data({type:structType});}
structEngine.load(translation.execute(structEngine));if(pvc.debug>=3){this._log(this.structEngine.getInfo());}
this.dataTreePanel=new pvc.DataTreePanel(this,this.basePanel,def.create(contentOptions,{topRuleOffset:this.options.topRuleOffset,botRuleOffset:this.options.botRuleOffset,leftRuleOffset:this.options.leftRuleOffset,rightRuleOffset:this.options.rightRuleOffset,boxplotColor:this.options.boxplotColor,valueFontsize:this.options.valueFontsize,headerFontsize:this.options.headerFontsize,border:this.options.border,perpConnector:this.options.perpConnector,numDigits:this.options.numDigits,minVerticalSpace:this.options.minVerticalSpace,connectorSpace:this.options.connectorSpace,minAspectRatio:this.options.minAspectRatio}));},defaults:{compatVersion:1,topRuleOffset:30,botRuleOffset:30,leftRuleOffset:60,rightRuleOffset:60,boxplotColor:"grey",headerFontsize:16,valueFontsize:20,border:2,perpConnector:false,numDigits:0,connectorSpace:0.15,minVerticalSpace:0.05,minAspectRatio:2.0}});def.type('pvc.DataTreePanel',pvc.PlotPanel).add({pvDataTree:null,treeElements:null,structMap:null,structArr:null,hRules:null,vRules:null,rules:null,generatePerpConnectors:function(leftLength){this.hRules=[];this.vRules=[];this.rules=[];for(var e in this.structMap){var elem=this.structMap[e];if(elem.children!=null){var min=+10000,max=-10000;var theLeft=elem.left+elem.width;this.hRules.push({"left":theLeft,"width":leftLength,"bottom":elem.bottom+elem.height/2});theLeft+=leftLength;for(var i in elem.children){var child=this.structMap[elem.children[i]];var theBottom=child.bottom+child.height/2;if(theBottom>max){max=theBottom;}
if(theBottom<min){min=theBottom;}
this.hRules.push({"left":theLeft,"width":child.left-theLeft,"bottom":theBottom});}
if(max>min){this.vRules.push({"left":theLeft,"bottom":min,"height":max-min});}}}},generateLineSegment:function(x1,y1,x2,y2){var line=[];line.push({"x":x1,"y":y1});line.push({"x":x2,"y":y2});this.rules.push(line);},generateConnectors:function(leftLength){this.hRules=[];this.vRules=[];if(this.chart.options.perpConnector){this.generatePerpConnectors(leftLength);return;}
this.rules=[];for(var e in this.structMap){var elem=this.structMap[e];if(elem.children!=null){var theCenter,child,i;var min=+10000,max=-10000;for(i in elem.children){child=this.structMap[elem.children[i]];theCenter=child.bottom+child.height/2;if(theCenter>max){max=theCenter;}
if(theCenter<min){min=theCenter;}}
var mid=(max+min)/2;var theLeft1=elem.left+elem.width;var theLeft2=theLeft1+leftLength;this.generateLineSegment(theLeft1,elem.bottom+elem.height/2,theLeft2,mid);for(i in elem.children){child=this.structMap[elem.children[i]];theCenter=child.bottom+child.height/2;this.generateLineSegment(theLeft2,mid,child.left,theCenter);}}}},retrieveStructure:function(){var data=this.chart.structEngine;var options=this.chart.options;var colLabels=data.getVisibleCategories();this.treeElements=data.getVisibleSeries();var values=data.getValues();var bottomHeightSpecified=(colLabels.length>4);var e;for(e in this.treeElements){this.treeElements[e]=$.trim(this.treeElements[e]);}
var bounds=[];bounds.getElement=function(label){if(bounds[label]==null){bounds[label]={"min":+10000,"max":-10000};}
return bounds[label];};bounds.addValue=function(label,value){var bnd=bounds.getElement(label);if(value<bnd.min){bnd.min=value;}
if(value>bnd.max){bnd.max=value;}
return bnd;};var col,colnr,elem,row;for(e in this.treeElements){elem=this.treeElements[e];col=elem[0];colnr=col.charCodeAt(0);row=parseInt(elem.slice(1),10);bounds.addValue("__cols",colnr);bounds.addValue(col,row);}
var bnds=bounds.getElement("__cols");var gridWidth=this.innerWidth/(bnds.max-bnds.min+1);var connectorWidth=options.connectorSpace*gridWidth;var cellWidth=gridWidth-connectorWidth;var maxCellHeight=cellWidth/options.minAspectRatio;var colBase=bnds.min;delete bounds.__cols;for(e in bounds){bnds=bounds[e];if(typeof bnds=="function"){continue;}
var numRows=bnds.max-bnds.min+1;bnds.gridHeight=this.innerHeight/numRows;bnds.cellHeight=bnds.gridHeight*(1.0-options.minVerticalSpace);if(bnds.cellHeight>maxCellHeight){bnds.cellHeight=maxCellHeight;}
bnds.relBottom=(bnds.gridHeight-bnds.cellHeight)/2;bnds.numRows=numRows;}
var whitespaceQuote=new RegExp('[\\s\"\']+',"g");this.structMap={};for(e in this.treeElements){var box={};elem=this.treeElements[e];box.box_id=elem;this.structMap[elem]=box;col=elem[0];colnr=col.charCodeAt(0);row=parseInt(elem.slice(1),10);bnds=bounds.getElement(col);box.colIndex=colnr-colBase;box.rowIndex=bnds.numRows-(row-bnds.min)-1;box.left=this.leftOffs+box.colIndex*gridWidth;box.width=cellWidth;if(bottomHeightSpecified){box.bottom=values[4][e];box.height=values[5][e];}else{box.bottom=this.botOffs+box.rowIndex*bnds.gridHeight+bnds.relBottom;box.height=bnds.cellHeight;}
box.label=values[0][e];box.selector=values[1][e];box.aggregation=values[2][e];var children=(values[3][e]||'').replace(whitespaceQuote," ");box.children=(children===" "||children==="")?null:children.split(" ");}
this.generateConnectors((gridWidth-cellWidth)/2);this.structArr=[];for(e in this.structMap){elem=this.structMap[e];this.structArr.push(elem);}},findDataValue:function(key,data){for(var i=0;i<data[0].length;i++){if(data[0][i]==key){return data[1][i];}}
this._log("Error: value with key : "+key+" not found.");},generateBoxPlots:function(){var options=this.chart.options;for(var e in this.structArr){var elem=this.structArr[e];if(!elem.values.length){continue;}
elem.subplot={};var sp=elem.subplot;var dat=[];var margin=15;var rlMargin=elem.width/6;sp.hRules=[];sp.vRules=[];sp.marks=[];sp.labels=[];dat.push(this.findDataValue("_p5",elem.values));dat.push(this.findDataValue("_p25",elem.values));dat.push(this.findDataValue("_p50",elem.values));dat.push(this.findDataValue("_p75",elem.values));dat.push(this.findDataValue("_p95",elem.values));var noBox=false;if(typeof(dat[2])!="undefined"){if(dat[4]<dat[0]){dat=dat.reverse();this._log(" dataset "+elem.box_id+" repaired (_p95 was smaller than _p5)");}
if(dat[4]>dat[0]){sp.hScale=pv.Scale.linear(dat[0],dat[4]);}else{noBox=true;sp.hScale=pv.Scale.linear(dat[0]-1e-10,dat[0]+1e-10);}
sp.hScale.range(elem.left+rlMargin,elem.left+elem.width-rlMargin);var avLabel=""+dat[2];var i;for(i=0;i<dat.length;i++){dat[i]=sp.hScale(dat[i]);}
sp.bot=elem.bottom+elem.height/3;sp.top=elem.bottom+2*elem.height/3;sp.mid=(sp.top+sp.bot)/2;sp.textBottom=elem.bottom+margin;sp.textBottom=sp.bot-options.valueFontsize-1;var lwa=3;if(noBox){sp.vRules.push({"left":dat[0],"bottom":sp.bot,"lWidth":lwa,"height":sp.top-sp.bot});}else{sp.hRules.push({"left":dat[0],"width":dat[1]-dat[0],"lWidth":1,"bottom":sp.mid});sp.hRules.push({"left":dat[1],"width":dat[3]-dat[1],"lWidth":1,"bottom":sp.bot});sp.hRules.push({"left":dat[1],"width":dat[3]-dat[1],"lWidth":1,"bottom":sp.top});sp.hRules.push({"left":dat[3],"width":dat[4]-dat[3],"lWidth":1,"bottom":sp.mid});for(i=0;i<dat.length;i++){sp.vRules.push({"left":dat[i],"bottom":sp.bot,"lWidth":(i==2)?lwa:1,"height":sp.top-sp.bot});}}
sp.labels.push({left:dat[2],bottom:sp.textBottom,text:this.labelFixedDigits(avLabel),size:options.smValueFont,color:options.boxplotColor});}}},labelFixedDigits:function(value){if(typeof value=="string"){value=parseFloat(value);}
if(typeof value=="number"){var nd=this.chart.options.numDigits;value=value.toFixed(nd);}
return""+value;},addDataPoint:function(key){var options=this.chart.options;for(var e in this.structArr){var elem=this.structArr[e];if(!elem.values.length){continue;}
var value=this.findDataValue(key,elem.values);if(typeof value=="undefined"){continue;}
var sp=elem.subplot;var theLeft=sp.hScale(value);var theColor="green";sp.marks.push({left:theLeft,bottom:sp.mid,color:theColor});sp.labels.push({left:theLeft,bottom:sp.textBottom,text:this.labelFixedDigits(value),size:options.valueFont,color:theColor});}},retrieveData:function(){var data=this.chart.data;var options=this.chart.options;var colLabels=data.getVisibleCategories();var selectors=data.getVisibleSeries();var values=data.getValues();var selMap={};var i;var numCols=values.length;for(var e in this.structArr){var elem=this.structArr[e];elem.values=[];for(i=0;i<numCols;i++){elem.values.push([]);}
selMap[elem.selector]=elem;}
var boxNotFound={};for(i in selectors){var box=selMap[selectors[i]];if(typeof(box)!="undefined"){for(var j in values){box.values[j].push(values[j][i]);}}else{boxNotFound[selectors[i]]=true;}}
for(var sel in boxNotFound){this._log("Could'nt find box for selector: "+sel);}
this.generateBoxPlots();var whitespaceQuote=new RegExp('[\\s\"\']+',"g");if(options.selectParam){var selPar=options.selectParam.replace(whitespaceQuote,'');if((selPar!="undefined")&&(selPar.length>0)&&(typeof window[selPar]!="undefined")){selPar=window[selPar];this.addDataPoint(selPar);}}},_createCore:function(){var myself=this;var options=this.chart.options;options.smValueFontsize=Math.round(0.6*options.valueFontsize);options.smValueFont=""+options.smValueFontsize+"px sans-serif";options.valueFont=""+options.valueFontsize+"px sans-serif";var topRuleOffs=options.topRuleOffset,botRuleOffs=options.botRuleOffset,leftRuleOffs=options.leftRuleOffset;this.innerWidth=this.width-leftRuleOffs-options.rightRuleOffset;this.innerHeight=this.height-topRuleOffs-botRuleOffs;this.botOffs=botRuleOffs;this.leftOffs=leftRuleOffs;this.retrieveStructure();this.retrieveData();var topMargin=options.headerFontsize+3;var rules=this.rules;var i;for(i=0;i<rules.length;i++){this.pvPanel.add(pv.Line).data(rules[i]).left(function(d){return d.x;}).bottom(function(d){return d.y;}).lineWidth(1).strokeStyle("black");}
this.pvDataTree=this.pvPanel.add(pv.Bar).data(myself.structArr).left(function(d){return d.left;}).bottom(function(d){return d.bottom;}).height(function(d){return d.height;}).width(function(d){return d.width;}).fillStyle("green").add(pv.Bar).left(function(d){return d.left+options.border;}).bottom(function(d){return d.bottom+options.border;}).height(function(d){return d.height-options.border-topMargin;}).width(function(d){return d.width-2*options.border;}).fillStyle("white").add(pv.Label).text(function(d){return d.label;}).textAlign("center").left(function(d){return d.left+d.width/2;}).bottom(function(d){return d.bottom+d.height-options.headerFontsize-5+options.headerFontsize/5;}).font(""+options.headerFontsize+"px sans-serif").textStyle("white").fillStyle("blue");for(i=0;i<this.structArr.length;i++){var box=this.structArr[i];this.pvPanel.add(pv.Rule).data(box.subplot.hRules).left(function(d){return d.left;}).width(function(d){return d.width;}).bottom(function(d){return d.bottom;}).lineWidth(function(d){return d.lWidth;}).strokeStyle(myself.chart.options.boxplotColor);this.pvPanel.add(pv.Rule).data(box.subplot.vRules).left(function(d){return d.left;}).height(function(d){return d.height;}).bottom(function(d){return d.bottom;}).lineWidth(function(d){return d.lWidth;}).strokeStyle(myself.chart.options.boxplotColor);this.pvPanel.add(pv.Dot).data(box.subplot.marks).left(function(d){return d.left;}).bottom(function(d){return d.bottom;}).fillStyle(function(d){return d.color;});this.pvPanel.add(pv.Label).data(box.subplot.labels).left(function(d){return d.left;}).bottom(function(d){return d.bottom;}).font(function(d){return d.size;}).text(function(d){return d.text;}).textAlign("center").textStyle(function(d){return d.color;});}
if(options.perpConnector){this.pvPanel.add(pv.Rule).data(myself.vRules).left(function(d){return d.left;}).bottom(function(d){return d.bottom;}).height(function(d){return d.height;}).strokeStyle("black");this.pvPanel.add(pv.Rule).data(myself.hRules).left(function(d){return d.left;}).bottom(function(d){return d.bottom;}).width(function(d){return d.width;}).strokeStyle("black");}},applyExtensions:function(){this.extend(this.pvDataTree,"dataTree");}});def.type('pvc.data.BoxplotChartTranslationOper').add({_configureTypeCore:function(){var autoDimNames=[];var freeMeaIndexes=[];var freeDisIndexes=[];this.collectFreeDiscreteAndConstinuousIndexes(freeDisIndexes,freeMeaIndexes);this._getUnboundRoleDefaultDimNames('category',freeDisIndexes.length,autoDimNames);def.query(pvc.BoxplotChart.measureRolesNames).take(freeMeaIndexes.length).each(function(roleName){this._getUnboundRoleDefaultDimNames(roleName,1,autoDimNames);},this);if(autoDimNames.length){this.defReader({names:autoDimNames});}}});def.type('pvc.BoxplotPanel',pvc.CategoricalAbstractPanel).init(function(chart,parent,plot,options){this.base(chart,parent,plot,options);this.boxSizeRatio=plot.option('BoxSizeRatio');this.maxBoxSize=plot.option('BoxSizeMax');}).add({plotType:'box',anchor:'fill',_v1DimRoleName:{'value':'median'},_createCore:function(){this.base();var rootScene=this._buildScene();var a_bottom=this.isOrientationVertical()?"bottom":"left",a_left=this.anchorOrtho(a_bottom),a_width=this.anchorLength(a_bottom),a_height=this.anchorOrthoLength(a_bottom);function defaultColor(type){var color=this.base(type);return type==='stroke'?color.darker(1):color;}
var extensionIds=['panel'];if(this.compatVersion()<=1){extensionIds.push('');}
this.pvBoxPanel=new pvc.visual.Panel(this,this.pvPanel,{extensionId:extensionIds}).lock('data',rootScene.childNodes).lockMark(a_left,function(scene){var catVar=scene.vars.category;return catVar.x-catVar.width/2;}).pvMark
[a_width](function(scene){return scene.vars.category.width;});function setupRuleWhisker(rule){rule.lock(a_left,function(){return this.pvMark.parent[a_width]()/2;}).override('defaultColor',defaultColor);return rule;}
this.pvRuleWhiskerUpper=setupRuleWhisker(new pvc.visual.Rule(this,this.pvBoxPanel,{extensionId:'boxRuleWhisker',freePosition:true,noHover:false,noSelect:false,noClick:false,noDoubleClick:false,showsInteraction:true})).intercept('visible',function(scene){return scene.vars.category.showRuleWhiskerUpper&&this.delegateExtension(true);}).lock(a_bottom,function(scene){return scene.vars.category.ruleWhiskerUpperBottom;}).lock(a_height,function(scene){return scene.vars.category.ruleWhiskerUpperHeight;}).pvMark;this.pvRuleWhiskerLower=setupRuleWhisker(new pvc.visual.Rule(this,this.pvBoxPanel,{extensionId:'boxRuleWhisker',freePosition:true,noHover:false,noSelect:false,noClick:false,noDoubleClick:false,showsInteraction:true})).intercept('visible',function(scene){return scene.vars.category.showRuleWhiskerBelow&&this.delegateExtension(true);}).lock(a_bottom,function(scene){return scene.vars.category.ruleWhiskerLowerBottom;}).lock(a_height,function(scene){return scene.vars.category.ruleWhiskerLowerHeight;}).pvMark;function setupHCateg(sign){sign.lock(a_left,function(scene){return scene.vars.category.boxLeft;}).lock(a_width,function(scene){return scene.vars.category.boxWidth;});return sign;}
this.pvBar=setupHCateg(new pvc.visual.Bar(this,this.pvBoxPanel,{extensionId:'boxBar',freePosition:true,normalStroke:true})).intercept('visible',function(scene){return scene.vars.category.showBox&&this.delegateExtension(true);}).lock(a_bottom,function(scene){return scene.vars.category.boxBottom;}).lock(a_height,function(scene){return scene.vars.category.boxHeight;}).override('defaultColor',defaultColor).override('defaultStrokeWidth',def.fun.constant(1)).pvMark;function setupHRule(rule){setupHCateg(rule);rule.override('defaultColor',defaultColor);return rule;}
this.pvRuleMin=setupHRule(new pvc.visual.Rule(this,this.pvBoxPanel,{extensionId:'boxRuleMin',freePosition:true,noHover:false,noSelect:false,noClick:false,noDoubleClick:false,showsInteraction:true})).intercept('visible',function(){return this.scene.vars.minimum.value!=null&&this.delegateExtension(true);}).lock(a_bottom,function(){return this.scene.vars.minimum.position;}).pvMark;this.pvRuleMax=setupHRule(new pvc.visual.Rule(this,this.pvBoxPanel,{extensionId:'boxRuleMax',freePosition:true,noHover:false,noSelect:false,noClick:false,noDoubleClick:false,showsInteraction:true})).intercept('visible',function(){return this.scene.vars.maximum.value!=null&&this.delegateExtension(true);}).lock(a_bottom,function(){return this.scene.vars.maximum.position;}).pvMark;this.pvRuleMedian=setupHRule(new pvc.visual.Rule(this,this.pvBoxPanel,{extensionId:'boxRuleMedian',freePosition:true,noHover:false,noSelect:false,noClick:false,noDoubleClick:false,showsInteraction:true})).intercept('visible',function(){return this.scene.vars.median.value!=null&&this.delegateExtension(true);}).lock(a_bottom,function(){return this.scene.vars.median.position;}).override('defaultStrokeWidth',def.fun.constant(2)).pvMark;},renderInteractive:function(){this.pvBoxPanel.render();},_buildScene:function(){var chart=this.chart,measureRolesDimNames=def.query(chart.measureVisualRoles()).object({name:function(role){return role.name;},value:function(role){return role.firstDimensionName();}}),visibleKeyArgs={visible:true,zeroIfNone:false},data=this.visibleData({ignoreNulls:false}),rootScene=new pvc.visual.Scene(null,{panel:this,source:data}),baseScale=this.axes.base.scale,bandWidth=baseScale.range().band,boxWidth=Math.min(bandWidth*this.boxSizeRatio,this.maxBoxSize),orthoScale=this.axes.ortho.scale,colorVarHelper=new pvc.visual.RoleVarHelper(rootScene,this.visualRoles.color,{roleVar:'color'});data.children().each(createCategScene,this);return rootScene;function createCategScene(categData){var categScene=new pvc.visual.Scene(rootScene,{source:categData});var vars=categScene.vars;vars.series=new pvc_ValueLabelVar(null,"");var catVar=vars.category=new pvc_ValueLabelVar(categData.value,categData.label);def.set(catVar,'group',categData,'x',baseScale(categData.value),'width',bandWidth,'boxWidth',boxWidth,'boxLeft',bandWidth/2-boxWidth/2);chart.measureVisualRoles().forEach(function(role){var dimName=measureRolesDimNames[role.name],svar;if(dimName){var dim=categData.dimensions(dimName),value=dim.sum(visibleKeyArgs);svar=new pvc_ValueLabelVar(value,dim.format(value));svar.position=orthoScale(value);}else{svar=new pvc_ValueLabelVar(null,"");svar.position=null;}
vars[role.name]=svar;});colorVarHelper.onNewScene(categScene,true);var hasMin=vars.minimum.value!=null,hasLower=vars.lowerQuartil.value!=null,hasMedian=vars.median.value!=null,hasUpper=vars.upperQuartil.value!=null,bottom,top;var show=hasLower||hasUpper;if(show){bottom=hasLower?vars.lowerQuartil.position:hasMedian?vars.median.position:vars.upperQuartil.position;top=hasUpper?vars.upperQuartil.position:hasMedian?vars.median.position:vars.lowerQuartil.position;show=(top!==bottom);if(show){catVar.boxBottom=bottom;catVar.boxHeight=top-bottom;}}
catVar.showBox=show;show=vars.maximum.value!=null;if(show){bottom=hasUpper?vars.upperQuartil.position:hasMedian?vars.median.position:hasLower?vars.lowerQuartil.position:hasMin?vars.minimum.position:null;show=bottom!=null;if(show){catVar.ruleWhiskerUpperBottom=bottom;catVar.ruleWhiskerUpperHeight=vars.maximum.position-bottom;}}
catVar.showRuleWhiskerUpper=show;show=hasMin;if(show){top=hasLower?vars.lowerQuartil.position:hasMedian?vars.median.position:hasUpper?vars.upperQuartil.position:null;show=top!=null;if(show){bottom=vars.minimum.position;catVar.ruleWhiskerLowerHeight=top-bottom;catVar.ruleWhiskerLowerBottom=bottom;}}
catVar.showRuleWhiskerBelow=show;}}});def.type('pvc.BoxplotChart',pvc.CategoricalAbstract).add({_processOptionsCore:function(options){this.base.apply(this,arguments);options.stacked=false;},_initVisualRoles:function(){this.base();var roleSpecBase={isMeasure:true,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number};[{name:'median',label:'Median',defaultDimension:'median',isRequired:true},{name:'lowerQuartil',label:'Lower Quartil',defaultDimension:'lowerQuartil'},{name:'upperQuartil',label:'Upper Quartil',defaultDimension:'upperQuartil'},{name:'minimum',label:'Minimum',defaultDimension:'minimum'},{name:'maximum',label:'Maximum',defaultDimension:'maximum'}].forEach(function(info){this._addVisualRole(info.name,def.create(roleSpecBase,info));},this);},_getTranslationClass:function(translOptions){return def.type(this.base(translOptions)).add(pvc.data.BoxplotChartTranslationOper);},_initPlotsCore:function(){new pvc.visual.BoxPlot(this);if(this.options.plot2){this._animatable=true;new pvc.visual.PointPlot(this,{name:'plot2',defaults:{LinesVisible:true,DotsVisible:true,OrthoRole:'median',ColorAxis:2},fixed:{OrthoAxis:1}});}},_bindAxes:function(hasMultiRole){this.base(hasMultiRole);var typeAxes=this.axesByType.ortho;if(typeAxes){typeAxes.forEach(function(axis){axis.option.defaults({Offset:0.02});});}},_createPlotPanels:function(parentPanel,baseOptions){var plots=this.plots;var boxPlot=plots.box;var boxPanel=new pvc.BoxplotPanel(this,parentPanel,boxPlot,Object.create(baseOptions));this.bpChartPanel=boxPanel;var plot2Plot=plots.plot2;if(plot2Plot){if(pvc.debug>=3){this._log("Creating Point panel.");}
var pointPanel=new pvc.PointPanel(this,parentPanel,plot2Plot,Object.create(baseOptions));pointPanel._v1DimRoleName.value=plot2Plot.option('OrthoRole');}},defaults:{crosstabMode:false}}).addStatic({measureRolesNames:['median','lowerQuartil','upperQuartil','minimum','maximum']});def.type('pvc.data.TreemapChartTranslationOper').add({_configureTypeCore:function(){var autoDimNames=[];var freeMeaIndexes=[];var freeDisIndexes=[];this.collectFreeDiscreteAndConstinuousIndexes(freeDisIndexes,freeMeaIndexes);var D=freeDisIndexes.length;var M=freeMeaIndexes.length;if(D){this._getUnboundRoleDefaultDimNames('category',D,autoDimNames);}
if(M){def.query(['size','color']).take(M).each(function(roleName){this._getUnboundRoleDefaultDimNames(roleName,1,autoDimNames);},this);}
if(autoDimNames.length){this.defReader({names:autoDimNames});}}});def.type('pvc.TreemapPanel',pvc.PlotPanel).init(function(chart,parent,plot,options){this.base(chart,parent,plot,options);this.axes.size=chart._getAxis('size',(plot.option('SizeAxis')||0)-1);this.visualRoles.size=chart.visualRole(plot.option('SizeRole'));this.layoutMode=plot.option('LayoutMode');}).add({_createCore:function(layoutInfo){var me=this;var cs=layoutInfo.clientSize;var rootScene=me._buildScene();if(!rootScene){return;}
var lw0=def.number.to(me._getConstantExtension('leaf','lineWidth'),1);var lw=lw0;var lw2=lw/2;var sizeProp=me.visualRoles.size.isBound()?me.axes.size.scale.by1(function(scene){return scene.vars.size.value;}):100;var panel=me.pvTreemapPanel=new pvc.visual.Panel(me,me.pvPanel,{panelType:pv.Layout.Treemap,extensionId:'panel'}).pvMark.lock('visible',true).lock('nodes',rootScene.nodes()).lock('left',lw2).lock('top',lw2).lock('width',cs.width-lw).lock('height',cs.height-lw).lock('size',sizeProp).lock('mode',me.layoutMode).lock('order',null).lock('round',false);panel.node.left(function(n){return n.x+lw2;}).top(function(n){return n.y+lw2;}).width(function(n){return n.dx-lw;}).height(function(n){return n.dy-lw;});var colorAxis=me.axes.color;var colorScaleDirect,colorScaleLeaf;if(me.visualRoles.color.isBound()){colorScaleLeaf=colorScaleDirect=colorAxis.sceneScale({sceneVarName:'color'});if(me.plot.option('ColorMode')==='byparent'){colorScaleLeaf=colorScaleLeaf.by(def.propGet('parent'));}}else{colorScaleLeaf=colorScaleDirect=def.fun.constant(colorAxis.option('Unbound'));}
var pvLeafMark=new pvc.visual.Bar(me,panel.leaf,{extensionId:'leaf'}).lockMark('visible').override('defaultColor',function(type){return colorScaleLeaf(this.scene);}).override('defaultStrokeWidth',function(){return lw0;}).pvMark.antialias(false).lineCap('round').strokeDasharray(function(scene){return scene.vars.size.value<0?'dash':null;});new pvc.visual.Bar(me,panel.node,{extensionId:'ascendant',noHover:true,noSelect:true,noClick:true,noDoubleClick:true}).intercept('visible',function(scene){return!!scene.parent&&!!scene.firstChild&&this.delegateExtension(true);}).override('anyInteraction',function(){return this.scene.anyInteraction()||this.scene.isActiveDescendantOrSelf();}).override('defaultStrokeWidth',function(){return 1.5*lw;}).override('interactiveStrokeWidth',function(w){if(this.showsActivity()&&this.scene.isActiveDescendantOrSelf()){w=Math.max(1,w)*1.5;}
return w;}).override('defaultColor',function(type){return colorScaleDirect(this.scene);}).override('normalColor',def.fun.constant(null)).override('interactiveColor',function(color,type){if(type==='stroke'){if(this.showsActivity()){if(this.scene.isActiveDescendantOrSelf()){return pv.color(color).brighter(0.5);}
if(this.scene.anyActive()){return null;}}
if(this.showsSelection()&&this.scene.isSelectedDescendantOrSelf()){return pv.color(color).brighter(0.5);}}
return null;}).pvMark.antialias(false);var label=pvc.visual.ValueLabel.maybeCreate(me,panel.label,{noAnchor:true});if(label){var valuesFont=this.valuesFont;label.override('trimText',function(text){var side=this.pvMark.textAngle()?'dy':'dx';var maxWidth=this.scene[side]-2;return pvc.text.trimToWidthB(maxWidth,text,valuesFont,"..");}).override('calcBackgroundColor',function(){var pvSiblingScenes=pvLeafMark.scene;var pvLeafScene=pvSiblingScenes[this.pvMark.index];return pvLeafScene.fillStyle;});}},_getExtensionId:function(){var extensionIds=[{abs:!this.chart.parent?'content':'smallContent'}];return extensionIds.concat(this.base());},renderInteractive:function(){this.pvTreemapPanel.render();},_buildScene:function(){var data=this.visibleData({ignoreNulls:false});if(!data.childCount()){return null;}
var roles=this.visualRoles;var rootScene=new pvc.visual.Scene(null,{panel:this,source:data});var sizeVarHelper=new pvc.visual.RoleVarHelper(rootScene,roles.size,{roleVar:'size',allowNestedVars:true,hasPercentSubVar:true});var colorGrouping=roles.color&&roles.color.grouping;var recursive=function(scene){var group=scene.group;scene.vars.category=pvc_ValueLabelVar.fromComplex(group);sizeVarHelper.onNewScene(scene,true);if(!colorGrouping){if(!scene.parent){scene.vars.color=new pvc_ValueLabelVar(null,"");}}else{scene.vars.color=new pvc_ValueLabelVar(group.absKey,group.absLabel);}
if(group.childCount()){group.children().each(function(childData){if(childData.value!=null){recursive(new pvc.visual.Scene(scene,{source:childData}));}});}
return scene;};return recursive(rootScene);}});def.type('pvc.TreemapChart',pvc.BaseChart).add({_animatable:false,_axisCreateIfUnbound:{'color':true},_getColorRoleSpec:function(){return{defaultSourceRole:'category',defaultDimension:'color*'};},_initVisualRoles:function(){this.base();this._addVisualRole('category',{isRequired:true,defaultDimension:'category*',autoCreateDimension:true});this._addVisualRole('size',{isMeasure:true,isRequired:false,isPercent:true,requireSingleDimension:true,requireIsDiscrete:false,valueType:Number,defaultDimension:'size'});},_getTranslationClass:function(translOptions){return def.type(this.base(translOptions)).add(pvc.data.TreemapChartTranslationOper);},_getIsNullDatum:def.fun.constant(),_setAxesScales:function(hasMultiRole){this.base(hasMultiRole);if(!hasMultiRole||this.parent){var sizeAxis=this.axes.size;if(sizeAxis&&sizeAxis.isBound()){this._createAxisScale(sizeAxis);sizeAxis.setScaleRange({min:100,max:1000});}}},_initPlotsCore:function(){var treemapPlot=new pvc.visual.TreemapPlot(this);if(this.options.legend==null){this.options.legend=treemapPlot.option('ColorMode')==='byparent';}
var rootCategoryLabel=treemapPlot.option('RootCategoryLabel');this.visualRoles.category.setRootLabel(rootCategoryLabel);this.visualRoles.color.setRootLabel(rootCategoryLabel);},_preRenderContent:function(contentOptions){this.base();var treemapPlot=this.plots.treemap;new pvc.TreemapPanel(this,this.basePanel,treemapPlot,contentOptions);},_createVisibleData:function(dataPartValue,ka){var visibleData=this.base(dataPartValue,ka);return visibleData?this.visualRoles.category.select(visibleData,{visible:true}):null;},defaults:{legend:null}});return pvc;}(def,pv));pvc.defaultCompatVersion(1);BaseComponent=Base.extend({visible:true,isManaged:true,timerStart:0,timerSplit:0,elapsedSinceSplit:-1,elapsedSinceStart:-1,logColor:undefined,clear:function(){$("#"+this.htmlObject).empty();},copyEvents:function(target,events){_.each(events,function(evt,evtName){var e=evt,tail=evt.tail;while((e=e.next)!==tail){target.on(evtName,e.callback,e.context);}})},clone:function(parameterRemap,componentRemap,htmlRemap){var that,dashboard,callbacks;dashboard=this.dashboard;callbacks=this._callbacks;delete this.dashboard;delete this._callbacks;that=$.extend(true,{},this);that.dashboard=this.dashboard=dashboard;this._callbacks=callbacks;this.copyEvents(that,callbacks);if(that.parameters){that.parameters=that.parameters.map(function(param){if(param[1]in parameterRemap){return[param[0],parameterRemap[param[1]]];}else{return param;}});}
if(that.components){that.components=that.components.map(function(comp){if(comp in componentRemap){return componentRemap[comp];}else{return comp;}});}
that.htmlObject=!that.htmlObject?undefined:htmlRemap[that.htmlObject];if(that.listeners){that.listeners=that.listeners.map(function(param){if(param in parameterRemap){return parameterRemap[param];}else{return param;}});}
if(that.parameter&&that.parameter in parameterRemap){that.parameter=parameterRemap[that.parameter];}
return that;},getAddIn:function(slot,addIn){var type=typeof this.type=="function"?this.type():this.type;return Dashboards.getAddIn(type,slot,addIn);},hasAddIn:function(slot,addIn){var type=typeof this.type=="function"?this.type():this.type;return Dashboards.hasAddIn(type,slot,addIn);},getValuesArray:function(){var jXML;if(typeof(this.valuesArray)=='undefined'||this.valuesArray.length==0){if(typeof(this.queryDefinition)!='undefined'){var vid=(this.queryDefinition.queryType=="sql")?"sql":"none";if((this.queryDefinition.queryType=="mdx")&&(!this.valueAsId)){vid="mdx";}else if(this.queryDefinition.dataAccessId!==undefined&&!this.valueAsId){vid='cda';}
QueryComponent.makeQuery(this);var myArray=new Array();for(p in this.result)if(this.result.hasOwnProperty(p)){switch(vid){case"sql":myArray.push([this.result[p][0],this.result[p][1]]);break;case"mdx":myArray.push([this.result[p][1],this.result[p][0]]);break;case'cda':myArray.push([this.result[p][0],this.result[p][1]]);break;default:myArray.push([this.result[p][0],this.result[p][0]]);break;}}
return myArray;}else{var p=new Array(this.parameters?this.parameters.length:0);for(var i=0,len=p.length;i<len;i++){var key=this.parameters[i][0];var value=this.parameters[i][1]==""||this.parameters[i][1]=="NIL"?this.parameters[i][2]:Dashboards.getParameterValue(this.parameters[i][1]);p[i]=[key,value];}
var myself=this;if(this.url){var arr={};$.each(p,function(i,val){arr[val[0]]=val[1];});jXML=Dashboards.parseXActionResult(myself,Dashboards.urlAction(this.url,arr));}else{jXML=Dashboards.callPentahoAction(myself,this.solution,this.path,this.action,p,null);}
var myArray=this.parseArray(jXML,false);return myArray;}}else{return this.valuesArray;}},parseArray:function(jData,includeHeader){if(jData===null){return[];}
if($(jData).find("CdaExport").size()>0){return this.parseArrayCda(jData,includeHeader);}
var myArray=new Array();var jHeaders=$(jData).find("COLUMN-HDR-ITEM");if(includeHeader&&jHeaders.size()>0){var _a=new Array();jHeaders.each(function(){_a.push($(this).text());});myArray.push(_a);}
var jDetails=$(jData).find("DATA-ROW");jDetails.each(function(){var _a=new Array();$(this).children("DATA-ITEM").each(function(){_a.push($(this).text());});myArray.push(_a);});return myArray;},parseArrayCda:function(jData,includeHeader){var myArray=new Array();var jHeaders=$(jData).find("ColumnMetaData");if(jHeaders.size()>0){if(includeHeader){var _a=new Array();jHeaders.each(function(){_a.push($(this).attr("name"));});myArray.push(_a);}}
var jDetails=$(jData).find("Row");jDetails.each(function(){var _a=new Array();$(this).children("Col").each(function(){_a.push($(this).text());});myArray.push(_a);});return myArray;},setAddInDefaults:function(slot,addIn,defaults){var type=typeof this.type=="function"?this.type():this.type;Dashboards.setAddInDefaults(type,slot,addIn,defaults)},setAddInOptions:function(slot,addIn,options){if(!this.addInOptions){this.addInOptions={};}
if(!this.addInOptions[slot]){this.addInOptions[slot]={};}
this.addInOptions[slot][addIn]=options},getAddInOptions:function(slot,addIn){var opts=null;try{opts=this.addInOptions[slot][addIn];}catch(e){}
return opts||{};},startTimer:function(){this.timerStart=new Date();this.timerSplit=new Date();},splitTimer:function(){if(this.elapsedSinceStart===-1||this.elapsedSinceSplit===-1){this.startTimer();}
var now=new Date();this.elapsedSinceStart=now.getTime()-this.timerStart.getTime();this.elapsedSinceSplit=now.getTime()-this.timerSplit.getTime();this.timerSplit=now;return this.getTimerInfo();},formatTimeDisplay:function(t){return Math.log(t)/Math.log(10)>=3?Math.round(t/100)/10+"s":t+"ms";},getTimerInfo:function(){return{timerStart:this.timerStart,timerSplit:this.timerSplit,elapsedSinceStart:this.elapsedSinceStart,elapsedSinceStartDesc:this.formatTimeDisplay(this.elapsedSinceStart),elapsedSinceSplit:this.elapsedSinceSplit,elapsedSinceSplitDesc:this.formatTimeDisplay(this.elapsedSinceSplit)}},getLogColor:function(){if(this.logColor){return this.logColor;}
else{var hashCode=function(str){var hash=0;if(str.length==0)return hash;for(i=0;i<str.length;i++){var chr=str.charCodeAt(i);hash=((hash<<5)-hash)+chr;hash=hash&hash;}
return hash;}
var hash=hashCode(this.name).toString();var hueSeed=hash.substr(hash.length-6,2)||0;var saturationSeed=hash.substr(hash.length-2,2)||0;var valueSeed=hash.substr(hash.length-4,2)||0;this.logColor=Dashboards.hsvToRgb(360/100*hueSeed,75/100*saturationSeed,45+(80-45)/100*valueSeed);return this.logColor;}}});var TextComponent=BaseComponent.extend({update:function(){$("#"+this.htmlObject).html(this.expression());}});var CommentsComponent=BaseComponent.extend({processing:function(){var myself={};myself.defaults={dataTemplates:{comments:'<div class="commentsDetails">'+' {{#user}} {{{user}}}, {{/user}} {{{createdOn}}}'+'</div>'+'<div class="commentsBody">'+' <div class="comment">'+'   {{{comment}}}'+' </div>'+' {{#user}}'+' <div class="operation">'+' {{#permissions.delete}}'+'   <div class="delete">X</div>'+' {{/permissions.delete}}'+' {{#permissions.archive}}'+'  <div class="archive">X</div>'+' {{/permissions.archive}}'+' </div>'+' {{/user}}'+'</div>',addComments:'<div class="commentsAdd">'+'{{#add}}'+' <div class="addComment">Add Comment</div>'+' <div class="addCommentWrapper">'+'   <textarea class=addCommentText></textarea>'+'   <div class="commentsButtons">'+'   <div class="saveComment">Save</div>'+'   <div class="cancelComment">Cancel</div>'+'   </div>'+' </div>'+'{{/add}}'+'</div>',paginateComments:'<div class="paginate commentPaginate"> '+'{{#active}}'+' <div class="navigateRefresh"> Refresh </div>'+' <div class="navigatePrevious"> Newest Comments </div>'+' <div class="navigateNext"> Oldest Comments </div>'+'{{/active}}'+'</div>'}};myself.operations={processOperation:function(operation,comment,collection,callback,defaults){var ajaxOptions={};switch(operation){case'LIST_ALL':ajaxOptions={data:{action:'list',page:defaults.page,firstResult:defaults.paginate.firstResult,maxResults:defaults.paginate.maxResults,where:false}};break;case'LIST_ACTIVE':ajaxOptions={data:{action:'list',page:defaults.page,firstResult:defaults.paginate.firstResult,maxResults:defaults.paginate.maxResults}};break;case'GET_LAST':ajaxOptions={data:{action:'list',page:defaults.page,firstResult:0,maxResults:1}};break;case'DELETE_COMMENT':ajaxOptions={data:{action:'delete',page:defaults.page,commentId:comment}};break;case'ARCHIVE_COMMENT':ajaxOptions={data:{action:'archive',page:defaults.page,commentId:comment}};break;case'ADD_COMMENT':ajaxOptions={data:{action:'add',page:defaults.page,comment:comment}};break;}
this.requestProcessing(ajaxOptions,operation,collection,callback);},requestProcessing:function(overrides,operation,collection,callback){var myself=this;overrides=overrides||{};var ajaxOpts={type:'GET',url:"/pentaho/content/pentaho-cdf/Comments",success:function(data){myself.requestResponse(data,operation,collection,callback)},dataType:'json'};ajaxOpts=_.extend({},ajaxOpts,overrides);$.ajax(ajaxOpts);},resetCollection:function(result){var paginate=myself.options.paginate;var start=paginate.activePageNumber*paginate.pageCommentsSize;var end=((start+paginate.pageCommentsSize)<result.length)?(start+paginate.pageCommentsSize):result.length;var commentsArray=[];for(var idx=start;idx<end;idx++){var singleComment=new myself.CommentModel(result[idx]);commentsArray.push(singleComment)}
return commentsArray;},requestResponse:function(json,operation,collection,callback){if((operation=='LIST_ALL')||(operation=='LIST_ACTIVE')){var paginate=myself.options.paginate;if(paginate.activePageNumber>0){if((paginate.activePageNumber+1)>Math.ceil(json.result.length/paginate.pageCommentsSize))
paginate.activePageNumber--;}
myself.options.queyResult=json.result;collection.reset(this.resetCollection(json.result));if((paginate.activePageNumber==0)&&((json)&&(typeof json.result!='undefined'))&&(json.result.length==0)){json.result=[{id:0,comment:'No Comments to show!',createdOn:'',elapsedMinutes:'',isArchived:false,isDeleted:false,isMe:true,page:'',user:'',permissions:{add:false,archive:false,remove:false}}];if((collection)&&(typeof collection!='undefined')){collection.reset(this.resetCollection(json.result));}}}
if((callback)&&(typeof callback!='undefined')){callback.apply(this,[json,collection]);}}};myself.CommentModel=Backbone.Model.extend({defaults:{id:0,comment:'Guest User',createdOn:'',elapsedMinutes:'',isArchived:false,isDeleted:false,isMe:true,page:'comments',user:'comments',permissions:{}},initialize:function(){this.set('permissions',myself.options.permissions);}});myself.CommentView=Backbone.View.extend({tagName:'div',className:'commentView',events:{"click .delete":"deleteComment","click .archive":"archiveComment"},initialize:function(model){_.bindAll(this,'render','deleteComment','archiveComment');this.model=model;},render:function(){this.$el.append(myself.dataTemplates.comments(this.attributes));return this.$el;},deleteComment:function(){var callback=function(data,collection){myself.operations.processOperation('LIST_ACTIVE',null,collection,null,myself.options);};myself.operations.processOperation('DELETE_COMMENT',this.model.get('id'),this.model.collection,callback,myself.options);},archiveComment:function(){var callback=function(data,collection){myself.operations.processOperation('LIST_ACTIVE',null,collection,null,myself.options);};myself.operations.processOperation('ARCHIVE_COMMENT',this.model.get('id'),this.model.collection,callback,myself.options);}});myself.CommentsCollection=Backbone.Collection.extend({model:myself.CommentModel});myself.CommentsView=Backbone.View.extend({tagName:'div',className:'commentComponent',events:{"click .addComment":"addComment","click .saveComment":"saveComment","click .cancelComment":"cancelComment","click .navigatePrevious":"navigatePrevious","click .navigateNext":"navigateNext","click .navigateRefresh":"navigateRefresh",},initialize:function(collection){_.bindAll(this,'render','addComment','saveComment','cancelComment','renderSingeComment','addComment','saveComment','cancelComment','navigateNext','navigatePrevious','commentsUpdateNotification');this.collection=collection;this.collection.on('reset',this.render);this.collection.on('commentsUpdateNotification',this.commentsUpdateNotification);this.render();},render:function(){var $renderElem=$('#'+myself.options.htmlObject);var $commentsElem=$('<div/>').addClass('commentsGroup');Dashboards.log("Comments Component: Render comments","debug");_(this.collection.models).each(function(comment){$commentsElem.append(this.renderSingeComment(comment));},this);var $add=$(myself.dataTemplates.addComments(myself.options.permissions));var $paginate=$(myself.dataTemplates.paginateComments(myself.options.paginate));this.$el.empty().append($commentsElem,$add,$paginate)
$renderElem.append(this.$el);this.updateNavigateButtons();},renderSingeComment:function(comment){Dashboards.log("Comments Component: Render single comment","debug");var singleCommentView=new myself.CommentView(comment);return singleCommentView.render();},addComment:function(){Dashboards.log("Comments Component: Add comment","debug");this.showAddComment();},saveComment:function(){Dashboards.log("Comments Component: Save comment","debug");var text=this.$el.find('.addCommentText').val();var callback=function(data,collection){var paginate=myself.options.paginate;paginate.activePageNumber=0;myself.operations.processOperation('LIST_ACTIVE',null,collection,null,myself.options);};myself.operations.processOperation('ADD_COMMENT',text,this.collection,callback,myself.options);},cancelComment:function(){Dashboards.log("Comments Component: Cancel comment","debug");this.hideAddComment();},navigateNext:function(){Dashboards.log("Comments Component: Next","debug");var paginate=myself.options.paginate;var start=paginate.activePageNumber*paginate.pageCommentsSize;if((start+paginate.pageCommentsSize)<myself.options.queyResult.length){paginate.activePageNumber++;this.collection.reset(myself.operations.resetCollection(myself.options.queyResult));}
this.commentsUpdateNotification();this.updateNavigateButtons();},navigatePrevious:function(){Dashboards.log("Comments Component: Previous","debug");var paginate=myself.options.paginate;var start=paginate.activePageNumber;if(paginate.activePageNumber>0){paginate.activePageNumber--;this.collection.reset(myself.operations.resetCollection(myself.options.queyResult));}
this.commentsUpdateNotification();this.updateNavigateButtons();},navigateRefresh:function(){Dashboards.log("Comments Component: Refresh","debug");var paginate=myself.options.paginate;myself.options.paginate.activePageNumber=0;myself.operations.processOperation('LIST_ACTIVE',null,this.collection,null,myself.options);$('.tipsy').remove();},updateNavigateButtons:function(){var paginate=myself.options.paginate;$('.navigatePrevious').addClass("disabled");$('.navigateNext').addClass("disabled");if(paginate.activePageNumber>0){$('.navigatePrevious').removeClass("disabled");}
if((paginate.activePageNumber+1)<Math.ceil(myself.options.queyResult.length/paginate.pageCommentsSize)){$('.navigateNext').removeClass("disabled");}},commentsUpdateNotification:function(){Dashboards.log("Comments Component: Comments notification","debug");if(myself.options.queyResult.length>0){var lastCommentDate=myself.options.queyResult[0].createdOn;var callback=function(data){if(data.result.length>0){if(!!(data.result[0].createdOn==lastCommentDate)){Dashboards.log("Comments Component: New Comments? false","debug");}else{Dashboards.log("Comments Component: New Comments? true","debug");var tipsyOptions={html:true,fade:true,trigger:'manual',className:'commentsComponentTipsy',title:function(){return'New comments, please refresh!';}}
$('.commentComponent .navigateRefresh').attr('title','New comments, please refresh!').tipsy(tipsyOptions);$('.commentComponent .navigateRefresh').tipsy('show');}}}
myself.operations.processOperation('GET_LAST',null,null,callback,myself.options);}},showAddComment:function(){this.$el.find('.addCommentWrapper').show();this.$el.find('.paginate').hide();this.$el.find('.addCommentText').val('');},hideAddComment:function(){this.$el.find('.addCommentWrapper').hide();this.$el.find('.paginate').show();this.$el.find('.addCommentText').val('');}});myself.compileTemplates=function(){myself.dataTemplates=myself.dataTemplates||{};_(myself.defaults.dataTemplates).each(function(value,key){myself.dataTemplates[key]=Mustache.compile(value);});};myself.start=function(options){myself.options=options;myself.defaults=_.extend({},myself.defaults,options.defaults);myself.compileTemplates();myself.commentsCollection=new myself.CommentsCollection();myself.operations.processOperation('LIST_ACTIVE',null,myself.commentsCollection,null,myself.options);myself.commentsView=new myself.CommentsView(myself.commentsCollection);if(myself.options.intervalActive){var refresh=function(){Dashboards.log("Comments Component: Refresh","debug");myself.operations.processOperation('LIST_ACTIVE',null,myself.commentsCollection,null,myself.options);}
setInterval(function(){myself.commentsCollection.trigger('commentsUpdateNotification');},myself.options.interval);}};return myself;},update:function(){this.paginateActive=(typeof this.paginate=='undefined')?true:this.paginate;this.pageCommentsSize=(typeof this.pageCommentsSize=='undefined')?10:this.pageCommentsSize;this.firstResult=(typeof this.firstResult=='undefined')?0:this.firstResult;this.maxResults=(typeof this.maxResults=='undefined')?100:this.maxResults;this.interval=(typeof this.interval=='undefined')?5000:this.interval;this.intervalActive=(typeof this.intervalActive=='undefined')?true:this.intervalActive;this.addPermission=(typeof this.addPermission=='undefined')?true:this.addPermission;this.deletePermission=(typeof this.deletePermission=='undefined')?false:this.deletePermission;this.archivePermission=(typeof this.archivePermission=='undefined')?true:this.archivePermission;this.options=(typeof this.options=='undefined')?{}:this.options;if(this.page==undefined){Dashboards.log("Fatal - no page definition passed","error");return;}
options={htmlObject:this.htmlObject,page:this.page,intervalActive:this.intervalActive,interval:this.interval,paginate:{active:this.paginateActive,activePageNumber:0,pageCommentsSize:this.pageCommentsSize,firstResult:this.firstResult,maxResults:this.maxResults},permissions:{add:this.addPermission,delete:this.deletePermission,archive:this.archivePermission},defaults:this.options}
this.processing().start(options);}});var QueryComponent=BaseComponent.extend({visible:false,update:function(){QueryComponent.makeQuery(this);},warnOnce:function(){Dashboards.log("Warning: QueryComponent behaviour is due to change. See "+"http://http://www.webdetails.org/redmine/projects/cdf/wiki/QueryComponent"+" for more information");delete(this.warnOnce);}},{makeQuery:function(object){if(this.warnOnce){this.warnOnce();}
var cd=object.queryDefinition;if(cd==undefined){Dashboards.log("Fatal - No query definition passed","error");return;}
var query=new Query(cd);object.queryState=query;query.fetchData(object.parameters,function(values){changedValues=undefined;object.metadata=values.metadata;object.result=values.resultset!=undefined?values.resultset:values;object.queryInfo=values.queryInfo;if((typeof(object.postFetch)=='function')){changedValues=object.postFetch(values);}
if(changedValues!=undefined){values=changedValues;}
if(object.resultvar!=undefined){Dashboards.setParameter(object.resultvar,object.result);}
object.result=values.resultset!=undefined?values.resultset:values;if(typeof values.resultset!="undefined"){object.metadata=values.metadata;object.queryInfo=values.queryInfo;}});}});var MdxQueryGroupComponent=BaseComponent.extend({visible:false,update:function(){OlapUtils.updateMdxQueryGroup(this);}});var ManagedFreeformComponent=BaseComponent.extend({update:function(){this.customfunction(this.parameters||[]);}});var UnmanagedComponent=BaseComponent.extend({isManaged:false,isRunning:false,preExec:function(){if(typeof this.runCounter=="undefined"){this.runCounter=0;}
var ret;if(typeof this.preExecution=="function"){try{ret=this.preExecution();ret=typeof ret=="undefined"||ret;}catch(e){this.error(Dashboards.getErrorObj('COMPONENT_ERROR').msg,e);this.dashboard.log(e,"error");ret=false;}}else{ret=true;}
this.trigger('cdf cdf:preExecution',this,ret);return ret;},postExec:function(){if(typeof this.postExecution=="function"){this.postExecution();}
this.trigger('cdf cdf:postExecution',this);},drawTooltip:function(){if(this.tooltip){this._tooltip=typeof this.tooltip=="function"?this.tooltip():this.tooltip;}},showTooltip:function(){if(typeof this._tooltip!="undefined"){$("#"+this.htmlObject).attr("title",this._tooltip).tooltip({delay:0,track:true,fade:250});}},synchronous:function(callback,args){if(!this.preExec()){return;}
var silent=this.isSilent();if(!silent){this.block();}
setTimeout(_.bind(function(){try{callback.call(this,args||[]);this.drawTooltip();this.postExec();this.showTooltip();}catch(e){this.error(Dashboards.getErrorObj('COMPONENT_ERROR').msg,e);this.dashboard.log(e,"error");}finally{if(!silent){this.unblock();}}},this),10);},triggerQuery:function(queryDef,callback,userQueryOptions){if(!this.preExec()){return;}
var silent=this.isSilent();if(!silent){this.block();};userQueryOptions=userQueryOptions||{};var success=_.bind(function(data){callback(data);this.postExec();},this);var always=_.bind(function(){if(!silent){this.unblock();}},this);var handler=this.getSuccessHandler(success,always),errorHandler=this.getErrorHandler();var query=this.queryState=this.query=new Query(queryDef);var ajaxOptions={async:true}
if(userQueryOptions.ajax){_.extend(ajaxOptions,userQueryOptions.ajax);}
query.setAjaxOptions(ajaxOptions);if(userQueryOptions.pageSize){query.setPageSize(userQueryOptions.pageSize);}
query.fetchData(this.parameters,handler,errorHandler);},triggerAjax:function(url,params,callback){if(!this.preExec()){return;}
var silent=this.isSilent();if(!silent){this.block();};var ajaxParameters={async:true};if(typeof callback!="function"){callback=params;_.extend(ajaxParameters,url);}else{_.extend(ajaxParameters,{url:url,data:params});}
var success=_.bind(function(data){callback(data);this.trigger('cdf cdf:render',this,data);this.postExec();},this);var always=_.bind(function(){if(!silent){this.unblock();}},this);ajaxParameters.success=this.getSuccessHandler(success,always);ajaxParameters.error=this.getErrorHandler();jQuery.ajax(ajaxParameters);},callCounter:function(){return++this.runCounter;},error:function(msg,cause){msg=msg||Dashboards.getErrorObj('COMPONENT_ERROR').msg;if(!this.isSilent()){this.unblock();};this.errorNotification({error:cause,msg:msg});this.trigger("cdf cdf:error",this,msg,cause||null);},getSuccessHandler:function(counter,success,always){if(arguments.length===1){success=counter;counter=this.callCounter();}else if(typeof counter=='function'){always=success;success=counter;counter=this.callCounter();}
return _.bind(function(data){var newData;if(counter>=this.runCounter){try{if(typeof this.postFetch=="function"){newData=this.postFetch(data);this.trigger('cdf cdf:postFetch',this,data);data=typeof newData=="undefined"?data:newData;}
success(data);}catch(e){this.error(Dashboards.getErrorObj('COMPONENT_ERROR').msg,e);this.dashboard.log(e,"error");}}
if(typeof always=="function"){always();}},this);},getErrorHandler:function(){return _.bind(function(){var err=Dashboards.parseServerError.apply(this,arguments);this.error(err.msg,err.error);},this);},errorNotification:function(err,ph){ph=ph||((this.htmlObject)?$('#'+this.htmlObject):undefined);var name=this.name.replace('render_','');err.msg=err.msg+' ('+name+')';Dashboards.errorNotification(err,ph);},block:function(){if(!this.isRunning){this.dashboard.incrementRunningCalls();this.isRunning=true;}},unblock:function(){if(this.isRunning){this.dashboard.decrementRunningCalls();this.isRunning=false;}},isSilent:function(){return(this.lifecycle)?!!this.lifecycle.silent:false;}});var FreeformComponent=UnmanagedComponent.extend({update:function(){var render=_.bind(this.render,this);if(typeof this.manageCallee=="undefined"||this.manageCallee){this.synchronous(render);}else{render();}},render:function(){var parameters=this.parameters||[];this.customfunction(parameters);}});if($.fn.dataTableExt!=undefined){$.fn.dataTableExt.oApi.fnLengthChange=function(oSettings,iDisplay)
{oSettings._iDisplayLength=iDisplay;oSettings.oApi._fnCalculateEnd(oSettings);if(oSettings._iDisplayEnd==oSettings.aiDisplay.length)
{oSettings._iDisplayStart=oSettings._iDisplayEnd-oSettings._iDisplayLength;if(oSettings._iDisplayStart<0)
{oSettings._iDisplayStart=0;}}
if(oSettings._iDisplayLength==-1)
{oSettings._iDisplayStart=0;}
oSettings.oApi._fnDraw(oSettings);$('select',oSettings.oFeatures.l).val(iDisplay);};}
var TableComponent=UnmanagedComponent.extend({ph:undefined,update:function(){if(!this.preExec()){return;}
if(!this.htmlObject){return this.error("TableComponent requires an htmlObject");}
try{this.block();this.setup();if(this.chartDefinition.paginateServerside){this.paginatingUpdate();}else{var success=_.bind(function(data){this.rawData=data;this.processTableComponentResponse(data)},this);var handler=this.getSuccessHandler(success);this.queryState.setAjaxOptions({async:true});this.queryState.fetchData(this.parameters,handler);}}catch(e){this.dashboard.error(e);this.unblock();}},paginatingUpdate:function(){var cd=this.chartDefinition;this.extraOptions=this.extraOptions||[];this.extraOptions.push(["bServerSide",true]);this.extraOptions.push(["bProcessing",true]);this.queryState.setPageSize(parseInt(cd.displayLength||10));this.queryState.setCallback(_.bind(function(values){changedValues=undefined;if((typeof(this.postFetch)=='function')){changedValues=this.postFetch(values);}
if(changedValues!=undefined){values=changedValues;}
this.processTableComponentResponse(values);},this));this.queryState.setParameters(this.parameters);this.queryState.setAjaxOptions({async:true});this.processTableComponentResponse();},setup:function(){var cd=this.chartDefinition;if(cd==undefined){Dashboards.log("Fatal - No chart definition passed","error");return;}
cd["tableId"]=this.htmlObject+"Table";this.ph=$("#"+this.htmlObject).empty();var croppedCd=$.extend({},cd);croppedCd.drawCallback=undefined;this.queryState=new Query(croppedCd);this.query=this.queryState;var sortBy=this.chartDefinition.sortBy||[],sortOptions=[];for(var i=0;i<sortBy.length;i++){var col=sortBy[i][0];var dir=sortBy[i][1];sortOptions.push(col+(dir=="asc"?"A":"D"));}
this.queryState.setSortBy(sortOptions);},pagingCallback:function(url,params,callback,dataTable){function p(sKey){for(var i=0,iLen=params.length;i<iLen;i++){if(params[i].name==sKey){return params[i].value;}}
return null;}
var sortingCols=p("iSortingCols"),sort=[];if(sortingCols>0){for(var i=0;i<sortingCols;i++){var col=p("iSortCol_"+i);var dir=p("sSortDir_"+i);sort.push(col+(dir=="asc"?"A":"D"));}}
var query=this.queryState,myself=this;query.setSortBy(sort.join(","));query.setPageSize(parseInt(p("iDisplayLength")));query.setPageStartingAt(p("iDisplayStart"));query.fetchData(function(d){if(myself.postFetch){var mod=myself.postFetch(d,dataTable);if(typeof mod!=="undefined"){d=mod;}}
var response={iTotalRecords:d.queryInfo.totalRows,iTotalDisplayRecords:d.queryInfo.totalRows};response.aaData=d.resultset;response.sEcho=p("sEcho");myself.rawData=d;callback(response);});},fnDrawCallback:function(dataTableSettings){var dataTable=dataTableSettings.oInstance,cd=this.chartDefinition,myself=this,handleAddIns=_.bind(this.handleAddIns,this);this.ph.find("tbody tr").each(function(row,tr){if(dataTable.fnGetPosition(tr)==null){return true;}
$(tr).children("td").each(function(col,td){var foundAddIn=handleAddIns(dataTable,td);if(!foundAddIn&&cd.colFormats){var position=dataTable.fnGetPosition(td),rowIdx=position[0],colIdx=position[2],format=cd.colFormats[colIdx],value=myself.rawData.resultset[rowIdx][colIdx];if(format&&(typeof value!="undefined"&&value!==null)){$(td).text(sprintf(format,value));}}});});if(cd.urlTemplate!=undefined){var td=$("#"+myself.htmlObject+" td:nth-child(1)");td.addClass('cdfClickable');td.bind("click",function(e){var regex=new RegExp("{"+cd.parameterName+"}","g");var f=cd.urlTemplate.replace(regex,$(this).text());eval(f);});}
if(typeof cd.drawCallback=='function'){cd.drawCallback.apply(myself,arguments);}},fnInitComplete:function(){this.postExec();this.unblock();},handleAddIns:function(dataTable,td){var cd=this.chartDefinition,position=dataTable.fnGetPosition(td),rowIdx=position[0],colIdx=position[2],colType=cd.colTypes[colIdx],addIn=this.getAddIn("colType",colType),state={},target=$(td),results=this.rawData;if(!addIn){return false;}
try{if(!(target.parents('tbody').length)){return;}else if(target.get(0).tagName!='TD'){target=target.closest('td');}
state.rawData=results;state.tableData=dataTable.fnGetData();state.colIdx=colIdx;state.rowIdx=rowIdx;state.series=results.resultset[state.rowIdx][0];state.category=results.metadata[state.colIdx].colName;state.value=results.resultset[state.rowIdx][state.colIdx];if(cd.colFormats){state.colFormat=cd.colFormats[state.colIdx];}
state.target=target;addIn.call(td,state,this.getAddInOptions("colType",addIn.getName()));return true;}catch(e){this.dashboard.error(e);return false;}},processTableComponentResponse:function(json){var myself=this,cd=this.chartDefinition,extraOptions={};this.ph.trigger('cdfTableComponentProcessResponse');if(typeof cd.colHeaders==="undefined"||cd.colHeaders.length==0)
cd.colHeaders=json.metadata.map(function(i){return i.colName});if(typeof cd.colTypes==="undefined"||cd.colTypes.length==0)
cd.colTypes=json.metadata.map(function(i){return i.colType.toLowerCase()});var dtData0=TableComponent.getDataTableOptions(cd);$.each(this.extraOptions?this.extraOptions:{},function(i,e){extraOptions[e[0]]=e[1];});var dtData=$.extend(cd.dataTableOptions,dtData0,extraOptions);dtData.fnDrawCallback=_.bind(this.fnDrawCallback,this);dtData.fnInitComplete=_.bind(this.fnInitComplete,this);if(dtData.bServerSide){var myself=this;dtData.fnServerData=function(u,p,c){myself.pagingCallback(u,p,c,this);};}
if(json){dtData.aaData=json.resultset;}
this.ph.html("<table id='"+this.htmlObject+"Table' class='tableComponent' width='100%'></table>");this.dataTable=$("#"+this.htmlObject+'Table').dataTable(dtData);this.dataTable.anOpen=[];myself.ph.find('table').bind('click',function(e){if(typeof cd.clickAction==='function'||myself.expandOnClick){var state={},target=$(e.target),results=myself.rawData;if(!(target.parents('tbody').length)){return;}else if(target.get(0).tagName!='TD'){target=target.closest('td');}
var position=myself.dataTable.fnGetPosition(target.get(0));state.rawData=myself.rawData;state.tableData=myself.dataTable.fnGetData();state.colIdx=position[2];state.rowIdx=position[0];state.series=results.resultset[state.rowIdx][0];state.category=results.metadata[state.colIdx].colName;state.value=results.resultset[state.rowIdx][state.colIdx];state.colFormat=cd.colFormats[state.colIdx];state.target=target;if(myself.expandOnClick){myself.handleExpandOnClick(state);}
if(cd.clickAction){cd.clickAction.call(myself,state);}}});myself.ph.trigger('cdfTableComponentFinishRendering');},handleExpandOnClick:function(event){var myself=this,detailContainerObj=myself.expandContainerObject,activeclass="expandingClass";if(typeof activeclass==='undefined'){activeclass="activeRow";}
var obj=event.target.closest("tr"),a=event.target.closest("a");if(a.hasClass('info')){return;}else{var row=obj.get(0),value=event.series,htmlContent=$("#"+detailContainerObj).html(),anOpen=myself.dataTable.anOpen,i=$.inArray(row,anOpen);if(obj.hasClass(activeclass)){obj.removeClass(activeclass);myself.dataTable.fnClose(row);anOpen.splice(i,1);}else{for(var j=0;j<anOpen.length;j++){$(anOpen[j]).removeClass(activeclass);myself.dataTable.fnClose(anOpen[j]);anOpen.splice(j,1);}
obj.addClass(activeclass);anOpen.push(row);myself.dataTable.fnOpen(row,htmlContent,activeclass);var results=myself.queryState.lastResults();$(myself.expandParameters).each(function f(i,elt){Dashboards.fireChange(elt[1],results.resultset[event.rowIdx][parseInt(elt[0],10)]);});};};$("td.expandingClass").click(function(event){event.stopPropagation();return;});}},{getDataTableOptions:function(options){var dtData={};if(options.tableStyle=="themeroller"){dtData.bJQueryUI=true;}
dtData.bInfo=options.info;dtData.iDisplayLength=options.displayLength;dtData.bLengthChange=options.lengthChange;dtData.bPaginate=options.paginate;dtData.bSort=options.sort;dtData.bFilter=options.filter;dtData.sPaginationType=options.paginationType;dtData.sDom=options.sDom;dtData.aaSorting=options.sortBy;if(typeof options.oLanguage=="string"){dtData.oLanguage=eval("("+options.oLanguage+")");}
else{dtData.oLanguage=options.oLanguage;}
if(options.colHeaders!=undefined){dtData.aoColumns=new Array(options.colHeaders.length);for(var i=0;i<options.colHeaders.length;i++){dtData.aoColumns[i]={}
dtData.aoColumns[i].sClass="column"+i;};$.each(options.colHeaders,function(i,val){dtData.aoColumns[i].sTitle=val;if(val=="")dtData.aoColumns[i].bVisible=false;});if(options.colTypes!=undefined){$.each(options.colTypes,function(i,val){var col=dtData.aoColumns[i];if(val=="hidden")col.bVisible=false;col.sClass+=" "+val;col.sType=val;})};if(options.colFormats!=undefined){};var bAutoWidth=true;if(options.colWidths!=undefined){$.each(options.colWidths,function(i,val){if(val!=null){dtData.aoColumns[i].sWidth=val;bAutoWidth=false;}})};dtData.bAutoWidth=bAutoWidth;if(options.colSortable!=undefined){$.each(options.colSortable,function(i,val){if(val!=null&&(!val||val=="false")){dtData.aoColumns[i].bSortable=false}})};if(options.colSearchable!=undefined){$.each(options.colSearchable,function(i,val){if(val!=null&&(!val||val=="false")){dtData.aoColumns[i].bSearchable=false}})};}
return dtData;}});var DashboardsMap={markers:null,data:new Array(),dataIdx:0,messageElementId:null,selectedPointDetails:null,mapExpression:null,useMercator:'true',showToolTip:'false',search:function(object,idx){var record=this.data[idx];var place=record[1];var lat=place[0];var log=place[1];var placeDesc=place[2];var featureClass=object.featureClass!=undefined?'&featureClass='+object.featureClass:'';if(lat==''||log=='')
{placeDesc=placeDesc.replace(/&/g,",");request='http://ws.geonames.org/searchJSON?q='+encodeURIComponent(placeDesc)+'&maxRows=1'+featureClass+'&callback=DashboardsMap.getLocation';}
else
return DashboardsMap.getLocation({totalResultsCount:1,geonames:[{lat:lat,lng:log}]});aObj=new JSONscriptRequest(request);aObj.buildScriptTag();aObj.addScriptTag();},resetSearch:function(){map.removeLayer(markers);markers.destroy();markers=new OpenLayers.Layer.Markers("Markers");map.addLayer(markers);this.cleanMessages();dataIdx=0;this.data=new Array();},getLocation:function(jData){var record=this.data[dataIdx++];if(jData==null||jData.totalResultsCount==0){var placeNotFound=record[0];this.addMessage(placeNotFound);}
else{var geoname=jData.geonames[0];var marker=record[4];var icon=record[5];record[6]=geoname.lng;record[7]=geoname.lat;var marker=this.showMarker(marker,record);record[4]=marker;}
if(dataIdx>=this.data.length&&dataIdx>1){var extent=markers.getDataExtent();map.zoomToExtent(extent);}
if(dataIdx>=this.data.length&&dataIdx==1){map.setCenter(markers.markers[0].lonlat,4,false,false);}},showMarker:function(oldMarker,record){var icon;var size;var lon=record[6];var lat=record[7];if(record[5]instanceof Array){var icon_array=record[5];icon=icon_array[0];size=new OpenLayers.Size(icon_array[1],icon_array[2])}
else{icon=record[5];size=new OpenLayers.Size(21,25);}
var offset=new OpenLayers.Pixel(-(size.w/2),-size.h);var iconObj=new OpenLayers.Icon(icon,size,offset);if(this.useMercator=='true'){marker=new OpenLayers.Marker(lonLatToMercator(new OpenLayers.LonLat(lon,lat)),iconObj);feature=new OpenLayers.Feature(markers,lonLatToMercator(new OpenLayers.LonLat(lon,lat)),record);}else{marker=new OpenLayers.Marker(new OpenLayers.LonLat(lon,lat),iconObj);feature=new OpenLayers.Feature(markers,new OpenLayers.LonLat(lon,lat),record);}
feature.marker=marker;marker.events.register('mousedown',feature,DashboardsMap.marker_click);if(this.showToolTip=='true'){marker.events.register('mouseover',feature,DashboardsMap.marker_over);marker.events.register('mouseout',feature,DashboardsMap.marker_out);ttips=new OpenLayers.Control.ToolTips({bgColor:"black",textColor:"white",bold:true,opacity:0.50});map.addControl(ttips);}
markers.addMarker(marker);return marker;},marker_click:function(evt){click_lonlat=this.lonlat;var record=this.data;if(DashboardsMap.showToolTip=='true'){ttips.hide();};Dashboards.fireChange("selectedPoint",record[0]);},marker_over:function(evt){record=this.data;ttips.show({html:record[0]+': '+record[2]});},marker_out:function(evt){ttips.hide();},updateInfoWindow:function(content){if(content!=null){var html=$(content).text();show_bubble(click_lonlat,html);}},updateMap:function(){var n=this.data.length;for(idx=0;idx<n;idx++){var value=this.data[idx][2];var markers=this.mapMarkers;var icon=eval(this.mapExpression);var marker=this.data[idx][4];this.data[idx][5]=icon;this.data[idx][4]=this.showMarker(marker,this.data[idx]);}},addMessage:function(msg){if(this.messageElementId!=undefined)
document.getElementById(this.messageElementId).innerHTML=document.getElementById(this.messageElementId).innerHTML+msg+"\n <br />";},cleanMessages:function(msg){if(this.messageElementId!=undefined)
document.getElementById(this.messageElementId).innerHTML="";}};var MapComponent=BaseComponent.extend({initMap:true,update:function(){var div='map';if(this.mapDiv!=null){div=this.mapDiv;}
var b_layer_control=true;var b_custom_map=false;var b_use_mercator=true;var str_custom_map="";if(this.showLayerSelector==false){b_layer_control=this.showLayerSelector}
if(this.showCustomMap){b_custom_map='true';str_custom_map=this.customMapCode}
if(this.useMercator==false){b_use_mercator='false'
DashboardsMap.useMercator='false';}
if(this.showToolTip==true){DashboardsMap.showToolTip='true';}else{DashboardsMap.showToolTip='false';}
if(this.initMap){init_map(div,this.initPosLon,this.initPosLat,this.initZoom,b_use_mercator,b_layer_control,b_custom_map,str_custom_map);DashboardsMap.messageElementId=this.messageElementId;this.initMap=false;}
DashboardsMap.resetSearch();var p=new Array(this.parameters.length);for(var i=0,len=p.length;i<len;i++){var key=this.parameters[i][0];var value=Dashboards.getParameterValue(this.parameters[i][1]);p[i]=[key,value];}
html=Dashboards.pentahoAction(this.solution,this.path,this.action,p,null);var myArray=this.parseArray(html,true);var len=myArray.length;if(len>1){var cols=myArray[0];var colslength=cols.length;for(var i=1;i<len;i++){var details;if(colslength>4){details=new Array(colslength-4);for(var j=4;j<colslength;j++){details[j-4]=[cols[j],myArray[i][j]];}}
var value=myArray[i][4];var markers=this.markers;DashboardsMap.mapExpression=this.expression();DashboardsMap.mapMarkers=markers;var icon=eval(this.expression());DashboardsMap.data.push(new Array(myArray[i][0],new Array(myArray[i][1],myArray[i][2],myArray[i][3]),value,details,null,icon,null,null));DashboardsMap.search(this,DashboardsMap.data.length-1);}}}});var MapBubbleComponent=BaseComponent.extend({update:function(){DashboardsMap.selectedPointDetails=null;for(var i=0;i<DashboardsMap.data.length;i++)
{if(Dashboards.getParameterValue("selectedPoint")==DashboardsMap.data[i][0])
{DashboardsMap.selectedPointDetails=DashboardsMap.data[i][3];break;}}
var parameters=Dashboards.clone(DashboardsMap.selectedPointDetails);if(this.parameters!=undefined)
var p=new Array(this.parameters.length);for(var i=0,len=p.length;i<len;i++){var key=this.parameters[i][0];var value=Dashboards.getParameterValue(this.parameters[i][1]);parameters.push([key,value]);}
DashboardsMap.updateInfoWindow(Dashboards.pentahoAction(this.solution,this.path,this.action,parameters,null));}});var NavigatorBaseComponent=BaseComponent.extend({},{path:Dashboards.getQueryParameter("path"),solution:Dashboards.getQueryParameter("solution"),template:Dashboards.getQueryParameter("template"),navigatorResponse:-1,getSolutionJSON:function(solution){var json=NavigatorBaseComponent.navigatorResponse;var files=json.solution.folders;var locationArray;var found=0;for(i=0;i<files.length;i++){var file=files[i];if(NavigatorBaseComponent.solution==""||file.solution==NavigatorBaseComponent.solution){var solutionFiles=[];var subFolders=file.folders;if(subFolders!=undefined&&subFolders.length==undefined){solutionFiles.push(subFolders);}
else if(subFolders!=undefined&&subFolders.length>0){solutionFiles=solutionFiles.concat(subFolders);}
var subFiles=file.files;if(subFiles!=undefined&&subFiles.length==undefined){solutionFiles.push(subFiles);}
else if(subFiles!=undefined&&subFiles.length>0){solutionFiles=solutionFiles.concat(subFiles);}
return solutionFiles;}}
if(found==0){alert("Fatal: Solution "+solution+" not found in navigation object");return;}},browseContent:function(files,currentPath){for(var i=0;i<files.length;i++){var file=files[i];if(file.type=="FOLDER"&&file.path==currentPath){files=file.folders;if(files==undefined){return[];}
if(files.length==undefined){files=[files];}
return files;}}
alert("Fatal: path "+NavigatorBaseComponent.path+" not found in navigation object");return;},getParentSolution:function(){if(NavigatorBaseComponent.path.length>0){return NavigatorBaseComponent.solution;}else{return"";}},getParentPath:function(){var index=NavigatorBaseComponent.path.lastIndexOf("/");if(index==-1){return"";}
var parentPath=NavigatorBaseComponent.path.substring(0,NavigatorBaseComponent.path.lastIndexOf("/"));return parentPath;},isAncestor:function(solution,path){if(solution!=NavigatorBaseComponent.solution){return false;}else{return true;}}});var NavigatorComponent=NavigatorBaseComponent.extend({update:function(){var myself=this;if(NavigatorBaseComponent.navigatorResponse==-1){$.getJSON(webAppPath+"/content/pentaho-cdf/JSONSolution?mode=navigator&solution="+NavigatorBaseComponent.solution+"&path="+NavigatorBaseComponent.path,function(json){myself.processNavigatorResponse(json);});}
else{this.processNavigatorResponse(NavigatorBaseComponent.navigatorResponse);}},processNavigatorResponse:function(json){NavigatorBaseComponent.navigatorResponse=json;var files=this.includeSolutions?json.solution.folders:NavigatorBaseComponent.getSolutionJSON(NavigatorBaseComponent.solution);files.sort(function(a,b){return a.name>b.name});var ret=this.generateMenuFromArray(files,0);$("#"+this.htmlObject).html(ret);$(function(){$('ul.jd_menu').jdMenu({activateDelay:50,showDelay:50,disableLinks:false})});$('ul.jd_menu a').tooltip({showURL:false,track:true,delay:1000,opacity:0.5});},generateMenuFromArray:function(files,depth){var s="";if(files==undefined){return s;}
for(var i=0;i<files.length;i++){var file=files[i];s+=this.generateMenuFromFile(file,depth+1);}
if(s.length>0){var className;if(depth==0){var cls=(this.mode=='vertical')?"jd_menu jd_menu_slate jd_menu_vertical":"jd_menu jd_menu_slate";className="class=\""+cls+"\"";}
s="<ul "+className+">"+s+"</ul>";}
return s;},generateMenuFromFile:function(file,depth){var s="";if(file.visible==true){var classString=NavigatorBaseComponent.isAncestor(file.solution,file.path)?"class=\"ancestor\"":"";var _path="";if(file.path.length>0){_path="path="+file.path;}
var _template=NavigatorBaseComponent.template.length>0?"&amp;template="+NavigatorBaseComponent.template:"";if(file.link!=undefined){s+="<li><a "+classString+" title=\""+file.description+"\"  href=\""+webAppPath+file.link+"\">"+file.title+"</a>";}
else{s+="<li><a "+classString+" title=\""+file.description+"\"  href=\""+webAppPath+"/content/pentaho-cdf/RenderHTML?solution="+file.solution+"&amp;"+_path+_template+"\">"+file.title+"</a>";}
var files=file.folders||[];files.sort(function(a,b){return a.name>b.name});var childFiles=file.files||[];childFiles.sort(function(a,b){return a.name>b.name});var inner=this.generateMenuFromArray(files.concat(childFiles));if(inner.length>0){inner=" &raquo;"+inner;}
s+=inner+"</li>";}
return s;}});var ContentListComponent=NavigatorBaseComponent.extend({update:function(){var myself=this;var path=this.mode!=4?NavigatorBaseComponent.path:NavigatorBaseComponent.getParentPath();$.getJSON(webAppPath+"/content/pentaho-cdf/JSONSolution?mode=contentList&solution="+NavigatorBaseComponent.solution+"&path="+path,function(json){myself.processContentListResponse(json);});},processContentListResponse:function(json){$("#"+this.htmlObject).empty();var files=json.content||[];files.sort(function(a,b){var _a=(a.type=="FOLDER"?"000":"")+a.name;var _b=(b.type=="FOLDER"?"000":"")+b.name;return _a>_b});var container=$("<ul></ul>").attr("id","contentList-"+this.name).appendTo("#"+this.htmlObject);if(this.mode!=1&&this.mode!=4&&NavigatorBaseComponent.path!=""){var parentDir={name:"Up",title:"Up",type:"FOLDER",description:"Go to parent directory",visible:true,solution:NavigatorBaseComponent.getParentSolution(),path:NavigatorBaseComponent.getParentPath()};files.reverse().push(parentDir);files.reverse();}
var myself=this;$.each(files,function(i,val){if(myself.mode==1&&this.type=="FOLDER"){return true;}
if(myself.mode==2&&this.type!="FOLDER"){return true;}
if(this.visible==true){var cls="";var target="";var href="";var template=NavigatorBaseComponent.template.length>0?"&template="+NavigatorBaseComponent.template:"";if(this.type=="FOLDER"){cls="folder";href=webAppPath+"/content/pentaho-cdf/RenderHTML?solution="+this.solution+"&path="+this.path+template;}
else{if(this.url!=undefined){cls="action greybox";href=webAppPath+this.url;}
else
{cls="action greybox";href=webAppPath+this.link;}}
var anchor=$("<a></a>").attr("href",href).attr("target",target).attr("title",this.description).text(this.title)
$("<li></li>").attr("class",cls).appendTo(container).append(anchor);}});$('#contentList-'+this.name+' a').tooltip({showURL:false});$("li.greybox a").click(function(){var t=this.title||this.innerHTML||this.href;var _href=this.href.replace(/'/g,"&#39;");$.fancybox({type:"iframe",href:_href,width:$(window).width(),height:$(window).height()});return false;});}});var PageTitleComponent=NavigatorBaseComponent.extend({update:function(){var myself=this;if(NavigatorBaseComponent.navigatorResponse==-1){$.getJSON(webAppPath+"/content/pentaho-cdf/JSONSolution?mode=navigator&solution="+NavigatorBaseComponent.solution+"&path="+NavigatorBaseComponent.path,function(json){myself.processPageTitleResponse(json);});}
else{this.processPageTitleResponse(NavigatorBaseComponent.navigatorResponse);}},processPageTitleResponse:function(json){NavigatorBaseComponent.navigatorResponse=json;var _id=json.solution.id+"/"+NavigatorBaseComponent.solution+(NavigatorBaseComponent.path.length>1?(NavigatorBaseComponent.path.charAt(0)=='/'?NavigatorBaseComponent.path:'/'+NavigatorBaseComponent.path):"");var file=this.findPageTitleObject(json.solution.folders,_id);if(file.title!=undefined&&file.description!=undefined){$("#"+this.htmlObject).text(file.title+" - "+file.description);}},findPageTitleObject:function(folders,id){for(var i=0;i<folders.length;i++){var file=folders[i];if(file.id==id){return file;}
else if((id+"/").indexOf(file.id+"/")>=0){return this.findPageTitleObject(file.folders,id);}
else{continue;}}}});var ProtovisComponent=UnmanagedComponent.extend({update:function(){if(this.parameters==undefined){this.parameters=[];};this.triggerQuery(this.chartDefinition,_.bind(this.render,this));},render:function(values){$("#"+this.htmlObject).html('<div id="'+this.htmlObject+'protovis"></div>');var vis=new pv.Panel().canvas(this.htmlObject+"protovis").width(this.width).height(this.height);this.customfunction(vis,values);vis.root.render();},processdata:function(values){this.render(values);}});var BaseCccComponent=UnmanagedComponent.extend({query:null,chart:null,exportChart:function(outputType,overrides){var _exportIframe=null;var myself=this;var buildChartDefinition=function(overrides){overrides=overrides||{};var chartDefinition={};var _params=Dashboards.objectToPropertiesArray($.extend({},Dashboards.propertiesArrayToObject(myself.parameters),overrides))
for(var param in _params){if(myself.parameters.hasOwnProperty(param)){var value;var name=myself.parameters[param][0];value=Dashboards.getParameterValue(myself.parameters[param][1]);if($.isArray(value)&&value.length==1&&(''+value[0]).indexOf(';')>=0){value=doCsvQuoting(value[0],';');}
if(typeof value=='function')value=value();chartDefinition['param'+name]=value;}}
var scriptName=myself.name.replace(/render_/,"");chartDefinition.script=("/"+Dashboards.context.solution+"/"+Dashboards.context.path+"/"+scriptName+".js").replace(/\/+/g,'/');chartDefinition.attachmentName=scriptName;return chartDefinition;};var chartDefinition=buildChartDefinition(overrides);chartDefinition.outputType=outputType;_exportIframe=_exportIframe||$('<iframe style="display:none">');_exportIframe.detach();_exportIframe[0].src="../cgg/draw?"+$.param(chartDefinition);_exportIframe.appendTo($('body'));},_preProcessChartDefinition:function(){var chartDef=this.chartDefinition;if(chartDef){var compatVersion=chartDef.compatVersion;if(compatVersion==null){compatVersion=typeof pvc.defaultCompatVersion==='function'?pvc.defaultCompatVersion():1;}
if(compatVersion<=1){if('showLegend'in chartDef){chartDef.legend=chartDef.showLegend;delete chartDef.showLegend;}
for(var p in chartDef){var m=/^barLine(.*)$/.exec(p);if(m){p2='secondAxis'+(m[1]||'');chartDef[p2]=chartDef[p];delete chartDef[p];}}}}}});var CccComponent=BaseCccComponent.extend({query:null,chart:null,update:function(){if(this.parameters==null){this.parameters=[];}
var ph=$("#"+this.htmlObject).empty();var myself=this;if(typeof(this.chartDefinition.width)==="undefined")
this.chartDefinition.width=ph.width();if(typeof(this.chartDefinition.height)==="undefined")
this.chartDefinition.height=ph.height();if(typeof Modernizr!=='undefined'&&Modernizr.svg){this.renderChart();}else{pv.listenForPageLoad(function(){myself.renderChart();});}},renderChart:function(){var myself=this;if(this.chartDefinition.dataAccessId||myself.chartDefinition.query){this.triggerQuery(this.chartDefinition,_.bind(this.render,this));}
else if(this.valuesArray!=undefined){this.synchronous(_.bind(function(){this.render(this.valuesArray)},this));}
else{this.synchronous(_.bind(this.render,this));}},render:function(values){$("#"+this.htmlObject).append('<div id="'+this.htmlObject+'protovis"></div>');this._preProcessChartDefinition();var o=$.extend({},this.chartDefinition);o.canvas=this.htmlObject+'protovis';if(typeof o.extensionPoints!="undefined"){var ep={};o.extensionPoints.forEach(function(a){ep[a[0]]=a[1];});o.extensionPoints=ep;}
this.chart=new this.cccType(o);if(arguments.length>0){this.chart.setData(values,{crosstabMode:this.crosstabMode,seriesInRows:this.seriesInRows});}
this.chart.render();}});var CccComponent2=BaseCccComponent.extend({query:null,sQuery:null,chart:null,update:function(){var dataQuery=null,sDataQuery=null;if(this.parameters==undefined){this.parameters=[];};$("#"+this.htmlObject).empty();var myself=this;this.query=new Query(this.chartDefinition);this.sQuery=new Query({path:this.chartDefinition.path,dataAccessId:this.chartDefinition.structDatasource});var executed=false;var execComponent=function(){if((dataQuery!=null)&&(sDataQuery!=null)&&!executed){myself.render(dataQuery,sDataQuery);executed=true;}};pv.listenForPageLoad(function(){myself.query.fetchData(myself.parameters,function(values){var changedValues=undefined;if((typeof(myself.postFetch)=='function')){changedValues=myself.postFetch(values);$("#"+this.htmlObject).append('<div id="'+this.htmlObject+'protovis"></div>');}
if(changedValues!=undefined){values=changedValues;}
dataQuery=values;execComponent();});});pv.listenForPageLoad(function(){myself.sQuery.fetchData(myself.parameters,function(values){var changedValues=undefined;if((typeof(myself.postFetch)=='function')){changedValues=myself.postFetch(values);$("#"+this.htmlObject).append('<div id="'+this.htmlObject+'protovis"></div>');}
if(changedValues!=undefined){values=changedValues;}
sDataQuery=values;execComponent();});});},render:function(values,sValues){$("#"+this.htmlObject).append('<div id="'+this.htmlObject+'protovis"></div>');this._preProcessChartDefinition();var o=$.extend({},this.chartDefinition);o.canvas=this.htmlObject+'protovis';if(typeof o.extensionPoints!="undefined"){var ep={};o.extensionPoints.forEach(function(a){ep[a[0]]=a[1];});o.extensionPoints=ep;}
this.chart=new this.cccType(o);this.chart.setData(values,{crosstabMode:this.crosstabMode,seriesInRows:this.seriesInRows});this.chart.setStructData(sValues)
this.chart.render();}});var CccAreaChartComponent=CccComponent.extend({cccType:pvc.AreaChart});var CccStackedDotChart=CccComponent.extend({cccType:pvc.StackedDotChart});var CccDotChartComponent=CccComponent.extend({cccType:pvc.DotChart});var CccLineChartComponent=CccComponent.extend({cccType:pvc.LineChart});var CccStackedLineChartComponent=CccComponent.extend({cccType:pvc.StackedLineChart});var CccStackedAreaChartComponent=CccComponent.extend({cccType:pvc.StackedAreaChart});var CccBarChartComponent=CccComponent.extend({cccType:pvc.BarChart});var CccPieChartComponent=CccComponent.extend({cccType:pvc.PieChart});var CccHeatGridChartComponent=CccComponent.extend({cccType:pvc.HeatGridChart});var CccBulletChartComponent=CccComponent.extend({cccType:pvc.BulletChart});var CccWaterfallChartComponent=CccComponent.extend({cccType:pvc.WaterfallChart});var CccMetricDotChartComponent=CccComponent.extend({cccType:pvc.MetricDotChart});var CccMetricLineChartComponent=CccComponent.extend({cccType:pvc.MetricLineChart});var CccParCoordComponent=CccComponent.extend({cccType:pvc.ParallelCoordinates});var CccDataTreeComponent=CccComponent2.extend({cccType:pvc.DataTree});var CccBoxplotChartComponent=CccComponent.extend({cccType:pvc.BoxplotChart});var CccTreemapChartComponent=CccComponent.extend({cccType:pvc.TreemapChart});var CccNormalizedBarChartComponent=CccComponent.extend({cccType:pvc.NormalizedBarChart});var SimpleAutoCompleteComponent=BaseComponent.extend({ph:undefined,completionCallback:undefined,update:function(){var myself=this;if(this.ph==undefined){this.ph=$("#"+this.htmlObject).empty();this.input=$("<input type='text'>").appendTo(this.ph);this.query=new Query(this.queryDefinition);var myself=this;this.input.autocomplete({source:function(obj,callback){return myself.triggerQuery(obj.term,callback);}});this.input.change(function(){Dashboards.processChange(myself.name);}).keyup(function(event){if(event.keyCode==13){Dashboards.processChange(myself.name);}});}},handleQuery:function(callback){var myself=this;return function(values){if(typeof myself.postFetch=="function"){var changedValues=myself.postFetch(values);values=changedValues||values;};var results=values.resultset.map(function(e){return e[0];});callback(results);}},triggerQuery:function(term,callback){var params=$.extend([],this.parameters);var termVal="'"+term+"'";if(this.searchParam){params.push([this.searchParam,termVal]);}
else if(params.length>0){this.parameters[0][1]=termVal;}
if(term.length>=this.minTextLength){this.query.fetchData(params,this.handleQuery(callback));}else{callback([]);}},getValue:function(){return this.input.val();}});var InputBaseComponent=UnmanagedComponent.extend({update:function(){var qd=this.queryDefinition;if(this.valuesArray&&this.valuesArray.length>0){var handler=_.bind(function(){this.draw(this.valuesArray);},this);this.synchronous(handler);}else if(qd&&(qd.dataAccessId||qd.query)){var handler=_.bind(function(data){var filtered;if(this.valueAsId){filtered=data.resultset.map(function(e){return[e[0],e[0]];});}else{filtered=data.resultset;}
this.draw(filtered);},this);this.triggerQuery(qd,handler);}else{var handler=_.bind(function(){var data=this.getValuesArray();this.draw(data);},this);this.synchronous(handler);}}});var SelectBaseComponent=InputBaseComponent.extend({visible:false,draw:function(myArray){var ph=$("#"+this.htmlObject);isMultiple=false;var eo={};if(this.extraOptions!=undefined){for(var i=0;i<this.extraOptions.length;i++){eo[this.extraOptions[i][0]]=this.extraOptions[i][1];}}
selectHTML="<select";if(this.size!=undefined){selectHTML+=" size='"+this.size+"'";}
if(this.type.toLowerCase().indexOf("selectmulti")!=-1){if(typeof(this.isMultiple)=='undefined'||this.isMultiple==true){selectHTML+=" multiple";isMultiple=true;}else
if(!this.isMultiple&&this.size==undefined){selectHTML+=" size='"+myArray.length+"'";}}
if(this.externalPlugin=="chosen"){selectHTML+=" class='chzn-select'";}
if(this.externalPlugin=="hynds"){selectHTML+=" class='hynds-select'";}
selectHTML+=">";var firstVal,currentVal=Dashboards.ev(Dashboards.getParameterValue(this.parameter)),currentIsValid=false;var hasCurrentVal=currentVal!=null;var vid=!!this.valueAsId;var hasValueSelected=false;var isSelected=false;var currentValArray=[];if(currentVal instanceof Array||(currentVal!=null&&typeof(currentVal)=="object"&&currentVal.join)){currentValArray=currentVal;}else if(typeof(currentVal)=="string"){currentValArray=currentVal.split("|");}
for(var i=0,len=myArray.length;i<len;i++){if(myArray[i]!=null&&myArray[i].length>0){var ivid=vid||myArray[i][0]==null;var value,label;if(myArray[i].length>1){value=""+myArray[i][ivid?1:0];label=""+myArray[i][1];}else{value=""+myArray[i][0];label=""+myArray[i][0];}
if(i==0){firstVal=value;}
if(jQuery.inArray(""+value,currentValArray.map(function(v){return""+v;}))>-1){currentIsValid=true;}
selectHTML+="<option value = '"+Dashboards.escapeHtml(value)+"' >"+Dashboards.escapeHtml(label)+"</option>";}}
selectHTML+="</select>";ph.html(selectHTML);if(isMultiple?!currentIsValid&&currentVal!=='':!currentIsValid){var replacementValue=(this.defaultIfEmpty)?firstVal:null;$("select",ph).val(replacementValue);Dashboards.setParameter(this.parameter,replacementValue);Dashboards.processChange(this.name);}else{$("select",ph).val(currentValArray);}
if(this.externalPlugin=="chosen"){ph.find("select.chzn-select").chosen(eo);}
if(this.externalPlugin=="hynds"){ph.find("select.hynds-select").multiselect({multiple:(isMultiple)?true:false});}
var myself=this;$("select",ph).change(function(){Dashboards.processChange(myself.name);});}});var SelectComponent=SelectBaseComponent.extend({defaultIfEmpty:true,getValue:function(){return $("#"+this.htmlObject+" select").val();}});var SelectMultiComponent=SelectBaseComponent.extend({getValue:function(){var ph=$("#"+this.htmlObject+" select");return(ph.val()==null)?[]:ph.val();}});var TextInputComponent=BaseComponent.extend({update:function(){selectHTML="<input";selectHTML+=" type=text id='"+this.name+"' name='"+this.name+"'  value='"+
Dashboards.getParameterValue(this.parameter)+
(this.size?("' size='"+this.size):"")+
(this.maxLength?("' maxlength='"+this.maxLength):"")+"'>";$("#"+this.htmlObject).html(selectHTML);var myself=this;$("#"+this.name).change(function(){Dashboards.processChange(myself.name);}).keyup(function(event){if(event.keyCode==13){Dashboards.processChange(myself.name);}});},getValue:function(){return $("#"+this.name).val();}});var TextareaInputComponent=BaseComponent.extend({update:function(){selectHTML="<textarea";selectHTML+=" id='"+this.name+"' name='"+this.name+
(this.numRows?("' rows='"+this.numRows):"")+
(this.numColumns?("' cols='"+this.numColumns):"")+"'>"+Dashboards.getParameterValue(this.parameter)+'</textarea>';$("#"+this.htmlObject).html(selectHTML);var myself=this;$("#"+this.name).change(function(){Dashboards.processChange(myself.name);}).keyup(function(event){if(event.keyCode==13){Dashboards.processChange(myself.name);}});},getValue:function(){return $("#"+this.name).val();}});if($.datepicker!=null){$(function(){$.datepicker.setDefaults($.datepicker.regional[''])});}
var DateInputComponent=BaseComponent.extend({update:function(){var format=(this.dateFormat==undefined||this.dateFormat==null)?'yy-mm-dd':this.dateFormat;var myself=this;var startDate,endDate;if(this.startDate=='TODAY')startDate=new Date();else if(this.startDate)startDate=$.datepicker.parseDate(format,this.startDate);if(this.endDate=='TODAY')endDate=new Date();else if(this.endDate)endDate=$.datepicker.parseDate(format,this.endDate);$("#"+this.htmlObject).html($("<input/>").attr("id",this.name).attr("value",Dashboards.getParameterValue(this.parameter)).css("width","80px"));$(function(){$("#"+myself.htmlObject+" input").datepicker({dateFormat:format,changeMonth:true,changeYear:true,minDate:startDate,maxDate:endDate,onSelect:function(date,input){Dashboards.processChange(myself.name);}});if(typeof Dashboards.i18nSupport!=="undefined"&&Dashboards.i18nSupport!=null){var $input=$("#"+myself.htmlObject+" input");$input.datepicker('option',$.datepicker.regional[Dashboards.i18nCurrentLanguageCode]);$input.parent().append($('<hidden>').attr("id",myself.name+"_hidden"));$input.datepicker("option","altField","#"+myself.name+"_hidden");$input.datepicker("option","altFormat",format);}});},getValue:function(){if(typeof Dashboards.i18nSupport!=="undefined"&&Dashboards.i18nSupport!=null)
return $("#"+this.name+"_hidden").val();else
return $("#"+this.name).val();}});var DateRangeInputComponent=BaseComponent.extend({update:function(){var dr;if(this.singleInput==undefined||this.singleInput==true){dr=$("<input/>").attr("id",this.name).attr("value",Dashboards.getParameterValue(this.parameter[0])+" > "+Dashboards.getParameterValue(this.parameter[1])).css("width","170px");$("#"+this.htmlObject).html(dr);}else{dr=$("<input/>").attr("id",this.name).attr("value",Dashboards.getParameterValue(this.parameter[0])).css("width","80px");$("#"+this.htmlObject).html(dr);dr.after($("<input/>").attr("id",this.name+"2").attr("value",Dashboards.getParameterValue(this.parameter[1])).css("width","80px"));if(this.inputSeparator!=undefined){dr.after(this.inputSeparator);}}
var offset=dr.offset();var myself=this;var earliestDate=this.earliestDate!=undefined?this.earliestDate:Date.parse('-1years');var latestDate=this.latestDate!=undefined?this.latestDate:Date.parse('+1years');var leftOffset=this.leftOffset!=undefined?this.leftOffset:0;var topOffset=this.topOffset!=undefined?this.topOffset:15;var changed,closed;function triggerWhenDone(){if(changed&&closed){myself.fireInputChange(myself.startValue,myself.endValue);changed=closed=false;}};var format=(myself.dateFormat==undefined||myself.dateFormat==null)?'yy-mm-dd':myself.dateFormat;$(function(){$("#"+myself.htmlObject+" input").daterangepicker({posX:offset.left+leftOffset,posY:offset.top+topOffset,earliestDate:earliestDate,latestDate:latestDate,dateFormat:format,onOpen:function(){changed=closed=false;myself.startValue=null;myself.endValue=null;},onDateSelect:function(rangeA,rangeB){changed=true;myself.storeChanges(rangeA,rangeB);triggerWhenDone();},onClose:function(){closed=true;triggerWhenDone();}});});},fireInputChange:function(start,end){if(this.preChange){this.preChange(start,end);}
if(this.parameter)
{if(this.parameter.length==2)Dashboards.setParameter(this.parameter[1],end);if(this.parameter.length>0)Dashboards.fireChange(this.parameter[0],start);}
if(this.postChange){this.postChange(start,end);}},storeChanges:function(start,end){this.startValue=start;this.endValue=end;}},{fireDateRangeInputChange:function(name,rangeA,rangeB){var object=Dashboards.getComponentByName(name);if(!(typeof(object.preChange)=='undefined')){object.preChange(rangeA,rangeB);}
var parameters=eval(name+".parameter");Dashboards.setParameter(parameters[1],rangeB);Dashboards.fireChange(parameters[0],rangeA);if(!(typeof(object.postChange)=='undefined')){object.postChange(rangeA,rangeB);}}});var MonthPickerComponent=BaseComponent.extend({update:function(){var selectHTML=this.getMonthPicker(this.name,this.size,this.initialDate,this.minDate,this.maxDate,this.months);$("#"+this.htmlObject).html(selectHTML);var myself=this;$("#"+this.name).change(function(){Dashboards.processChange(myself.name);});},getValue:function(){var value=$("#"+this.name).val()
var year=value.substring(0,4);var month=parseInt(value.substring(5,7)-1);var d=new Date(year,month,1);var selectHTML=this.getMonthPicker(this.name,this.size,d,this.minDate,this.maxDate,this.months);$("#"+this.htmlObject).html(selectHTML);var myself=this;$("#"+this.name).change(function(){Dashboards.processChange(myself.name);});return value;},getMonthPicker:function(object_name,object_size,initialDate,minDate,maxDate,monthCount){var selectHTML="<select";selectHTML+=" id='"+object_name+"'";if(minDate==undefined){minDate=new Date();minDate.setYear(1980);}
if(maxDate==undefined){maxDate=new Date();maxDate.setYear(2060);}
if(monthCount==undefined||monthCount==0){var monthsToAdd=(maxDate.getFullYear()-minDate.getFullYear())*12;monthCount=(maxDate.getMonth()-minDate.getMonth())+monthsToAdd;}
if(object_size!=undefined){selectHTML+=" size='"+object_size+"'";}
selectHTML+='>';var currentDate=new Date(+initialDate);currentDate.setMonth(currentDate.getMonth()-monthCount/2-1);for(var i=0;i<=monthCount;i++){currentDate.setMonth(currentDate.getMonth()+1);if(currentDate>=minDate&&currentDate<=maxDate)
{selectHTML+="<option value = '"+currentDate.getFullYear()+"-"+this.zeroPad(currentDate.getMonth()+1,2)+"' ";if(currentDate.getFullYear()==initialDate.getFullYear()&&currentDate.getMonth()==initialDate.getMonth()){selectHTML+="selected='selected'"}
selectHTML+=">"+Dashboards.monthNames[currentDate.getMonth()]+" "+currentDate.getFullYear()+"</option>";}}
selectHTML+="</select>";return selectHTML;},zeroPad:function(num,size){var n="00000000000000"+num;return n.substring(n.length-size,n.length);}});var ToggleButtonBaseComponent=InputBaseComponent.extend({draw:function(myArray){selectHTML="";var currentVal=Dashboards.getParameterValue(this.parameter);currentVal=(typeof currentVal=='function')?currentVal():currentVal;var isSelected=false;var currentValArray=[];if(currentVal instanceof Array||(typeof(currentVal)=="object"&&currentVal.join)){currentValArray=currentVal;}else if(typeof(currentVal)=="string"){currentValArray=currentVal.split("|");}
var vid=this.valueAsId==false?0:1;var hasCurrentVal=false;outer:for(var i=0;i<currentValArray.length;i++){for(var y=0;y<myArray.length;y++){if(currentValArray[i]==myArray[y][vid]){hasCurrentVal=true;break outer;}}}
if(!hasCurrentVal&&this.defaultIfEmpty){currentValArray=[myArray[0][vid]];this.currentVal=currentValArray;Dashboards.setParameter(this.parameter,currentValArray);Dashboards.processChange(this.name);}
selectHTML+="<ul class='"+((this.verticalOrientation)?"toggleGroup vertical":"toggleGroup horizontal")+"'>"
for(var i=0,len=myArray.length;i<len;i++){selectHTML+="<li class='"+((this.verticalOrientation)?"toggleGroup vertical":"toggleGroup horizontal")+"'><label><input onclick='ToggleButtonBaseComponent.prototype.callAjaxAfterRender(\""+this.name+"\")'";isSelected=false;for(var j=0,valLength=currentValArray.length;j<valLength;j++){isSelected=currentValArray[j]==myArray[i][vid];if(isSelected){break;}}
if(this.type=='radio'||this.type=='radioComponent'){if((i==0&&!hasCurrentVal)||(hasCurrentVal&&(myArray[i][vid]==currentVal))){selectHTML+=" CHECKED";}
selectHTML+=" type='radio'";}else{if((i==0&&!hasCurrentVal&&this.defaultIfEmpty)||(hasCurrentVal&&isSelected)){selectHTML+=" CHECKED";}
selectHTML+=" type='checkbox'";}
selectHTML+="class='"+this.name+"' name='"+this.name+"' value='"+myArray[i][vid]+"' /> "+myArray[i][1]+"</label></li>"+((this.separator==undefined||this.separator==null||this.separator=="null")?"":this.separator);}
selectHTML+="</ul>"
$("#"+this.htmlObject).html(selectHTML);this.currentVal=null;},callAjaxAfterRender:function(name){setTimeout(function(){Dashboards.processChange(name)},1);}});var RadioComponent=ToggleButtonBaseComponent.extend({getValue:function(){if(this.currentVal!='undefined'&&this.currentVal!=null){return this.currentVal;}else{return $("#"+this.htmlObject+" ."+this.name+":checked").val()}}});var CheckComponent=ToggleButtonBaseComponent.extend({getValue:function(){if(this.currentVal!='undefined'&&this.currentVal!=null){return this.currentVal;}else{var a=new Array()
$("#"+this.htmlObject+" ."+this.name+":checked").each(function(i,val){a.push($(this).val());});return a;}}});var MultiButtonComponent=ToggleButtonBaseComponent.extend({indexes:[],draw:function(myArray){this.cachedArray=myArray;var cssWrapperClass="pentaho-toggle-button pentaho-toggle-button-up "+((this.verticalOrientation)?"pentaho-toggle-button-vertical":"pentaho-toggle-button-horizontal");selectHTML="";var firstVal;var valIdx=this.valueAsId?1:0;var lblIdx=1;if(this.isMultiple==undefined)this.isMultiple=false;var ph=$("<div>");ph.appendTo($("#"+this.htmlObject).empty());for(var i=0,len=myArray.length;i<len;i++){var value=myArray[i][valIdx],label=myArray[i][lblIdx],classes=cssWrapperClass+this.getExtraCss(i,len,this.verticalOrientation),selector;value=(value==null?null:value.replace('"','&quot;'));label=(label==null?null:label.replace('"','&quot;'));if(i==0){firstVal=value;}
selectHTML="<div class='"+classes+"'><button name='"+this.name+"'>"+label+"</button  >"+"</div>";selector=$(selectHTML);var myself=this;(function(index){selector.click(function(){MultiButtonComponent.prototype.clickButton(myself.htmlObject,myself.name,index,myself.isMultiple,myself.verticalOrientation);});}(i));ph.append(selector);if(!(this.separator==undefined||this.separator==null||this.separator=="null")&&i!=myArray.length-1){ph.append(this.separator);}}
var currentVal=Dashboards.ev(Dashboards.getParameterValue(this.parameter));var isSelected=false;var currentValArray;if(typeof currentVal=="undefined"){currentValArray=[];}else if(currentVal instanceof Array||(typeof(currentVal)=="object"&&currentVal.join)){currentValArray=currentVal;}else{currentValArray=currentVal.toString().split("|");}
var foundDefault=false;this.clearSelections(this.htmlObject,this.name,this.verticalOrientation);for(var i=0;i<myArray.length;i++){isSelected=false;for(var j=0,valLength=currentValArray.length;j<valLength;j++){isSelected=currentValArray[j]==myArray[i][valIdx];if(isSelected){break;}}
if(($.isArray(currentVal)&&isSelected||isSelected)||(myArray[i][valIdx]==currentVal||myArray[i][lblIdx]==currentVal)){MultiButtonComponent.prototype.clickButton(this.htmlObject,this.name,i,this.isMultiple,this.verticalOrientation,true);foundDefault=true;if(!this.isMultiple){break;}}}
if(((!foundDefault&&!this.isMultiple)||(!foundDefault&&this.isMultiple&&this.defaultIfEmpty))&&myArray.length>0){if((currentVal==null||currentVal==""||(typeof(currentVal)=="object"&&currentVal.length==0))&&this.parameter){Dashboards.fireChange(this.parameter,(this.isMultiple)?[firstVal]:firstVal);}
MultiButtonComponent.prototype.clickButton(this.htmlObject,this.name,0,this.isMultiple,this.verticalOrientation,true);}
$(".pentaho-toggle-button").hover(function(){$(this).addClass("pentaho-toggle-button-up-hovering");},function(){$(this).removeClass("pentaho-toggle-button-up-hovering");});$(".pentaho-toggle-button button").hover(function(){$(this).parent().addClass("pentaho-toggle-button-up-hovering");},function(){});},getValue:function(){if(this.isMultiple){var indexes=MultiButtonComponent.prototype.getSelectedIndex(this.name);var a=new Array();if(indexes.length==undefined){a.push(this.getValueByIdx(indexes));}else{for(var i=0;i<indexes.length;i++){a.push(this.getValueByIdx(indexes[i]));}}
return a;}
else{return this.getValueByIdx(MultiButtonComponent.prototype.getSelectedIndex(this.name));}},getValueByIdx:function(idx){return this.cachedArray[idx][this.valueAsId?1:0];},getSelecetedCss:function(verticalOrientation){return"pentaho-toggle-button pentaho-toggle-button-down "+((verticalOrientation)?"pentaho-toggle-button-vertical":"pentaho-toggle-button-horizontal");},getUnselectedCss:function(verticalOrientation){return"pentaho-toggle-button pentaho-toggle-button-up "+((verticalOrientation)?"pentaho-toggle-button-vertical":"pentaho-toggle-button-horizontal");},clickButton:function(htmlObject,name,index,isMultiple,verticalOrientation,updateUIOnly){var cssWrapperClass=this.getUnselectedCss(verticalOrientation);var cssWrapperClassSelected=this.getSelecetedCss(verticalOrientation);var buttons=$("#"+htmlObject+" button");if(isMultiple){if(this.indexes[name]==undefined)this.indexes[name]=[];else if(!$.isArray(this.indexes[name]))this.indexes[name]=[this.indexes[name]];var disable=false;for(var i=0;i<this.indexes[name].length;++i){if(this.indexes[name][i]==index){disable=true;this.indexes[name].splice(i,1);break;}}
if(disable){buttons[index].parentNode.className=cssWrapperClass+this.getExtraCss(index,buttons.length,verticalOrientation);}else{buttons[index].parentNode.className=cssWrapperClassSelected+this.getExtraCss(index,buttons.length,verticalOrientation);this.indexes[name].push(index);}}
else{this.clearSelections(htmlObject,name,verticalOrientation);this.indexes[name]=index;buttons[index].parentNode.className=cssWrapperClassSelected+this.getExtraCss(index,buttons.length,verticalOrientation);}
if(!updateUIOnly){this.callAjaxAfterRender(name);}},clearSelections:function(htmlObject,name,verticalOrientation){var buttons=$("#"+htmlObject+" button");var cssWrapperClass=this.getUnselectedCss(verticalOrientation);for(var i=0;i<buttons.length;i++){buttons[i].parentNode.className=cssWrapperClass+this.getExtraCss(i,buttons.length,verticalOrientation);}
this.indexes[name]=[];},getExtraCss:function(index,count,verticalOrientation){var css="";if(index==0&&count==1){return" pentaho-toggle-button-single";}
if(index==0){css+=" "+((verticalOrientation)?" pentaho-toggle-button-vertical-first":" pentaho-toggle-button-horizontal-first");}else if(index==count-1){css+=" "+((verticalOrientation)?" pentaho-toggle-button-vertical-last":" pentaho-toggle-button-horizontal-last");}
return css;},getSelectedIndex:function(name){return this.indexes[name];}});var AutocompleteBoxComponent=BaseComponent.extend({searchedWord:'',result:[],queryServer:function(searchString){if(!this.parameters)this.parameters=[];if(this.searchParam){this.parameters=[[this.searchParam,this.getInnerParameterName()]];}
else if(this.parameters.length>0){this.parameters[0][1]=this.getInnerParameterName();}
if(this.maxResults){this.queryDefinition.pageSize=this.maxResults;}
Dashboards.setParameter(this.getInnerParameterName(),this.getTextBoxValue());QueryComponent.makeQuery(this);},getTextBoxValue:function(){return this.textbox.val();},getInnerParameterName:function(){return this.parameter+'_textboxValue';},update:function(){$("#"+this.htmlObject).empty();var initialValue=null;if(this.parameter){initialValue=Dashboards.getParameterValue(this.parameter);}
var myself=this;if(!Dashboards.getParameterValue(this.getInnerParameterName)){Dashboards.setParameter(this.getInnerParameterName(),'');}
var processChange=myself.processChange==undefined?function(objName){Dashboards.processChange(objName);}:function(objName){myself.processChange();};var processElementChange=myself.processElementChange==true?function(value){Dashboards.fireChange(myself.parameter,value);}:undefined;if(this.minTextLenght==undefined){this.minTextLenght=0;}
var opt={list:function(){var val=myself.textbox.val();if(val.length>=myself.minTextLenght&&!(val==''||val==myself.searchedWord||((myself.queryInfo!=null&&myself.result.length==myself.queryInfo.totalRows)&&myself.searchedWord!=''&&((myself.matchType=="fromStart")?val.indexOf(myself.searchedWord)==0:val.indexOf(myself.searchedWord)>-1))))
{myself.queryServer(val);myself.searchedWord=val;}
var list=[];for(p in myself.result)if(myself.result.hasOwnProperty(p)){var obj={};obj.text=myself.result[p][0];list.push(obj);}
return list;},matchType:myself.matchType==undefined?"fromStart":myself.matchType,processElementChange:processElementChange,processChange:function(obj,value){obj.value=value;processChange(obj.name);},multiSelection:myself.selectMulti==undefined?false:myself.selectMulti,checkValue:myself.checkValue==undefined?true:myself.checkValue,minTextLenght:myself.minTextLenght==undefined?0:myself.minTextLenght,scrollHeight:myself.scrollHeight,applyButton:myself.showApplyButton==undefined?true:myself.showApplyButton,tooltipMessage:myself.tooltipMessage==undefined?"Click it to Apply":myself.tooltipMessage,addTextElements:myself.addTextElements==undefined?true:myself.addTextElements,externalApplyButtonId:myself.externalApplyButtonId,parent:myself};this.autoBoxOpt=$("#"+this.htmlObject).autobox(opt);this.autoBoxOpt.setInitialValue(this.htmlObject,initialValue,this.name);this.textbox=$('#'+this.htmlObject+' input');},getValue:function(){return this.value;},processAutoBoxChange:function(){this.autoBoxOpt.processAutoBoxChange();}});var ButtonComponent=BaseComponent.extend({update:function(){var myself=this;var b=$("<button type='button'/>").text(this.label).unbind("click").bind("click",function(){return myself.expression.apply(myself,arguments);});if(typeof this.buttonStyle==="undefined"||this.buttonStyle==="themeroller")
b.button();b.appendTo($("#"+this.htmlObject).empty());}});var XactionComponent=BaseComponent.extend({update:function(){var myself=this;try{if(typeof(this.iframe)=='undefined'||!this.iframe){var p=new Array(this.parameters?this.parameters.length:0);for(var i=0,len=p.length;i<len;i++){var key=this.parameters[i][0];var value=this.parameters[i][1]==""?this.parameters[i][2]:Dashboards.getParameterValue(this.parameters[i][1]);if(this.value=="NIL"){this.value=this.parameters[i][2];}
p[i]=[key,value];}
if(typeof(this.serviceMethod)=='undefined'||this.serviceMethod=='ServiceAction'){var jXML=Dashboards.callPentahoAction(myself,this.solution,this.path,this.action,p,null);if(jXML!=null){$('#'+myself.htmlObject).html(jXML.find("ExecuteActivityResponse:first-child").text());}}else{var html=Dashboards.pentahoServiceAction(this.serviceMethod,'html',this.solution,this.path,this.action,p,null);$('#'+myself.htmlObject).html(html);}}else{var xactionIFrameHTML="<iframe id=\"iframe_"+this.htmlObject+"\""+" frameborder=\"0\""+" height=\"100%\""+" width=\"100%\" />";var iframe=$(xactionIFrameHTML);var url=webAppPath+"/ViewAction?wrapper=false"+"&solution="+this.solution+"&path="+this.path+"&action="+this.action;var p=new Array(this.parameters.length);for(var i=0,len=p.length;i<len;i++){var arg="&"+encodeURIComponent(this.parameters[i][0])+"=";var val="";if(this.parameters[i][1]==""){val=encodeURIComponent(this.parameters[i][2]);}else{val=encodeURIComponent(Dashboards.getParameterValue(this.parameters[i][1]));if(val=="NIL"){val=encodeURIComponent(this.parameters[i][2])}}
url+=arg+val;}
if(!this.loading){this.loading=true;Dashboards.incrementRunningCalls();}
iframe.load(function(){if(this.contentWindow.document.body.innerHTML){myself.loading=false;Dashboards.decrementRunningCalls();}});$("#"+this.htmlObject).empty().append(iframe);iframe[0].contentWindow.location=url;}}catch(e){}}});var JpivotComponent=BaseComponent.extend({update:function(){if(this.iframeScrolling==undefined){this.iframeScrolling="no";}
var jpivotHTML="<iframe id=\"jpivot_"+this.htmlObject+"\" scrolling=\""+this.iframeScrolling+"\" onload=\"var dynamicHeight = this.contentWindow.document.body.offsetHeight+50; this.style.height = dynamicHeight + 'px';\" frameborder=\"0\" height=\""+this.iframeHeight+"\" width=\""+this.iframeWidth+"\" src=\"";jpivotHTML+=webAppPath+"/ViewAction?solution="+this.solution+"&path="+this.path+"&action="+this.action;var p=new Array(this.parameters.length);for(var i=0,len=p.length;i<len;i++){var arg="&"+this.parameters[i][0]+"=";jpivotHTML+=arg+Dashboards.getParameterValue(this.parameters[i][1]);}
jpivotHTML+="\"></iframe>";$("#"+this.htmlObject).html(jpivotHTML);}});var PivotLinkComponent=BaseComponent.extend({update:function(){var title=this.tooltip==undefined?"View details in a Pivot table":this.tooltip;var link=$('<a class="pivotLink"> </a>').html(this.content).attr("href","javascript:PivotLinkComponent.openPivotLink("+this.name+")").attr("title",title);$("#"+this.htmlObject).empty();$("#"+this.htmlObject).html(link);$('a.pivotLink').tooltip({showURL:false,track:true,delay:1000,opacity:0.5});}},{openPivotLink:function(object){var url=webAppPath+"/Pivot?solution=system&path=pentaho-cdf/actions&action=jpivot.xaction&";var qd=object.pivotDefinition;var parameters=[];for(p in qd){var key=p;var value=typeof qd[p]=='function'?qd[p]():qd[p];parameters.push(key+"="+encodeURIComponent(value));}
url+=parameters.join("&");var _href=url.replace(/'/g,"&#39;");$.fancybox({type:"iframe",href:_href,width:$(window).width(),height:$(window).height()});}});var PrptComponent=BaseComponent.extend({getIframeName:function(){return this.htmlObject+'_'+'prptFrame';},getIframe:function(){return'<iframe name="'+this.getIframeName()+'" style="width:100%;height:100%;border:0px" frameborder="0"/>';},startLoading:function(){if(!this.loading){this.loading=true;Dashboards.incrementRunningCalls();}},stopLoading:function(){if(this.loading){this.loading=false;Dashboards.decrementRunningCalls();}},update:function(){this.clear();var options=this.getOptions();var downloadMode=this.downloadMode;if(downloadMode==null){var outputTarget=options["output-target"];downloadMode=!((outputTarget.indexOf('html')!=-1&&outputTarget.indexOf('mime-message')==-1)||outputTarget.indexOf('text')!=-1);}
if(options["dashboard-mode"]){var url=webAppPath+'/content/reporting';var myself=this;$.ajax({url:url,data:options,dataType:"html",success:function(resp){$("#"+myself.htmlObject).html(resp);}});}
else{var iframe=$(this.getIframe());var htmlObj=$('#'+this.htmlObject);htmlObj.empty();iframe=iframe.appendTo(htmlObj);if(this.autoResize){if(this._sHeight==null){this._sHeight=htmlObj.height();this._sWidth=htmlObj.width();}
else{htmlObj.height(this._sHeight);htmlObj.width(this._sWidth);}}
if(this.usePost){var url=webAppPath+'/content/reporting';this._postToUrl(htmlObj,iframe,url,options,this.getIframeName());}else{var url=webAppPath+'/content/reporting/reportviewer/report.html'+"?"+$.param(options);if(options.showParameters&&this.autoResize){Dashboards.log('PrptComponent: autoResize disabled because showParameters=true');this.autoResize=false;}
this.startLoading();var myself=this;iframe.load(function(){var jqBody=$(this.contentWindow.document.body);var reportContentFrame=jqBody.find('#reportContent');reportContentFrame.load(function(){if(myself.autoResize){myself._resizeToReportFrame(reportContentFrame[0],htmlObj,options);}
myself.stopLoading();});});iframe[0].contentWindow.location=url;}
if(downloadMode){this.stopLoading();}}},getOptions:function(){var options={paginate:this.paginate||false,showParameters:this.showParameters||false,autoSubmit:(this.autoSubmit||this.executeAtStart)||false,"dashboard-mode":this.iframe==undefined?false:!this.iframe,solution:this.solution,path:this.path,action:this.action};if(this.paginate){options["output-target"]="table/html;page-mode=page";}else{options["output-target"]="table/html;page-mode=stream";}
for(var i=0;i<this.parameters.length;i++){var param=this.parameters[i];var value=Dashboards.getParameterValue(param[1]);if(value==null&&param.length==3){value=param[2];}
options[param[0]]=value;}
return options;},_postToUrl:function(htmlObj,iframe,path,params,target){this.startLoading();var form=this._getParamsAsForm(document,path,params,this.getIframeName());htmlObj[0].appendChild(form);var self=this;iframe.load(function(){if(self.autoResize){self._resizeToReportFrame(iframe[0],htmlObj,params);}
self.stopLoading();});form.submit();},_resizeToReportFrame:function(iframe,htmlObj,options){var outputTarget=options["output-target"];var isHtml=function(outputTarget){return outputTarget.indexOf('html')!=-1&&outputTarget.indexOf('mime')==-1;};var isText=function(outputTarget){return outputTarget.indexOf('text')!=-1;};var isXml=function(outputTarget){return outputTarget.indexOf('xml')!=-1;};try{var idoc=iframe.contentWindow.document;if(iframe.contentWindow.document){var sized=null;if(isHtml(outputTarget)||isText(outputTarget)){sized=idoc.body;}
else if(isXml(outputTarget)){sized=idoc.firstChild;}
if(sized!=null){var hMargin=0,wMargin=0;if(isHtml(outputTarget)){var jsized=$(sized);hMargin=jsized.outerHeight(true)-jsized.outerHeight(false);wMargin=jsized.outerWidth(true)-jsized.outerWidth(false);}
htmlObj.height(sized.scrollHeight+hMargin);htmlObj.width(sized.scrollWidth+wMargin);}}}catch(e){Dashboards.log(e);}},_getParamsAsForm:function(doc,path,params,target){var form=doc.createElement("form");form.setAttribute("method","post");form.setAttribute("action",path);form.setAttribute("target",target);for(var key in params){if(params.hasOwnProperty(key)){var param=params[key];if($.isArray(param)){for(var i=0;i<param.length;i++){var hiddenField=doc.createElement("input");hiddenField.setAttribute("type","hidden");hiddenField.setAttribute("name",key);hiddenField.setAttribute("value",param[i]);form.appendChild(hiddenField);}}
else{var hiddenField=doc.createElement("input");hiddenField.setAttribute("type","hidden");hiddenField.setAttribute("name",key);hiddenField.setAttribute("value",param);form.appendChild(hiddenField);}}}
return form;}});var SchedulePrptComponent=PrptComponent.extend({visible:false,update:function(){var myself=this;var o=$("#"+this.htmlObject);if($.inArray(o[0].tagName.toUpperCase(),["SPAN","DIV"])>-1){o=$("<button/>").appendTo(o.empty());if(o[0].tagName=="DIV")o.wrap("<span/>");if(this.label!=undefined)o.text(this.label);o.button();o.addClass('scheduler_button');}
o.unbind("click");o.bind("click",function(){var success=typeof(myself.preChange)=='undefined'?true:myself.preChange();if(success){myself.schedulePrptComponent();}
typeof(myself.postChange)=='undefined'?true:myself.postChange();});},schedulePrptComponent:function(){var parameters={};var sharedUuid;var error=false;guid=function(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=='x'?r:(r&0x3|0x8);return v.toString(16);});}
triggerError=function(msg,id){error=true;$(id).css("backgroundColor","rgb(255,159,159)");var temp=$(id).val();$(id).val(msg);setTimeout(function(){$(id).css("backgroundColor","white");$(id).val(temp);},2000);}
getHour=function(){var hour=$("#hours").val();if($("#amPm").val()=="pm"){hour=parseInt(hour,10)+12;if(hour==24)
hour=12;}else{if(hour=="12")
hour=0;}
return hour;}
cronThis=function(){var minute=$("#minutes").val();var hour=getHour();var choice=$("#recurrId").val();var dayOfWeek="?";var month="*";var dayOfMonth="?";var year="*";switch(choice)
{case"daily":dayOfWeek="mon-fri";break;case"weekly":var i=0;if($("#monday").is(":checked")){dayOfWeek+=",mon";i++;}
if($("#tuesday").is(":checked")){dayOfWeek+=",tue";i++;}
if($("#wednesday").is(":checked")){dayOfWeek+=",wed";i++;}
if($("#thursday").is(":checked")){dayOfWeek+=",thu";i++;}
if($("#friday").is(":checked")){dayOfWeek+=",fri";i++;}
if($("#saturday").is(":checked")){dayOfWeek+=",sat";i++;}
if($("#sunday").is(":checked")){dayOfWeek+=",sun";i++;}
if(i>0){dayOfWeek=dayOfWeek.replace("\?","");dayOfWeek=dayOfWeek.replace(",","");}else{$("#errWeek").css("color","rgb(255,159,159)");$("#errorCheckboxes").show();setTimeout(function(){$("#errorCheckboxes").hide();},2000);error=true;}
break;case"monthly":if($("#monthRadio").is(":checked"))
{dayOfMonth=$("#recurrPatternIn").val();if(dayOfMonth<1)
triggerError(">0","#recurrPatternIn");else if(dayOfMonth>31)
triggerError("<=31","#recurrPatternIn");}
else
{dayOfMonth="?";dayOfWeek=$("#monthOpt2Select").val().substring(0,3)+"#"+$("#monthOpt1Select").val();}
break;case"yearly":if($("#yearRadio").is(":checked"))
{dayOfWeek="?";month=$("#yearEveryMonth").val();dayOfMonth=$("#yearDayMonth").val();if(dayOfMonth<1)
triggerError(">0","#yearDayMonth");else if(dayOfMonth>31)
triggerError("<=31","#yearDayMonth");}
else
{dayOfMonth="?";dayOfWeek=$("#yearOpt2Select").val().substring(0,3)+"#"+$("#yearOpt1Select").val();month=$("#yearMonthSelect").val();}
break;}
var builtCron="0 "+minute+" "+hour+" "+dayOfMonth+" "+month+" "+dayOfWeek+" "+year;return builtCron;}
getUTC=function(exp){var arr=exp.split("/");return new Date(arr[2],arr[0]-1,arr[1],0,0,0,0).getTime();}
makeSelect=function(min,max,interval,id){var selectHtml='<select id ="'+id+'">';for(var i=min;i<=max;i+=interval){if(i<10)
selectHtml+='<option value="'+i+'">0'+i+'</option>';else selectHtml+='<option value="'+i+'">'+i+'</option>';}
selectHtml+='</select>';return selectHtml;}
validateStartDate=function(mili,id){var now=new Date();if(isNaN(mili)||mili<now.getTime())
triggerError("Incorrect Date, pick date from calendar",id);}
validateEndDate=function(mili,id){if($("#endByRadio").is(":checked")){var now=new Date();var startDate=$("#rangeStartIn").val();var mil=getUTC(startDate);if(isNaN(mil)){}
else if(mil>mili)
triggerError("End Date > Start Date",id);else if(isNaN(mili)||mili<now.getTime())
triggerError("Incorrect Date",id);}}
startTimeGetter=function(){var hours=getHour();var minutes=$("#minutes").val();var mili=(minutes*60000)+(hours*3600000);var start=getUTC($("#rangeStartIn").val());start+=mili;validateStartDate(start,"#rangeStartIn");return start;}
endTimeGetter=function(){var end=getUTC($("#endByIn").val());validateEndDate(end,"#endByIn");return end;}
setParameters=function(){parameters={name:$("#nameIn").val(),title:$("#nameIn").val(),desc:$("#nameIn").val(),schedRef:sharedUuid,group:myself.group?myself.group:"Default Schedule Group",requestedMimeType:"text/xml",actionRefs:myself.solution+"/"+myself.path+"/"+myself.action,schedulerAction:"doAddScheduleAndContent"};error=false;var choice=$("#recurrId").val();var name=$("#nameIn").val();if(name=="")
triggerError("You must choose a name","#nameIn");parameters["name"]=name;switch(choice)
{case"once":var hours=getHour();var minutes=$("#minutes").val();var mili=(minutes*60000)+(hours*3600000);var start=getUTC($("#startDateIn").val());start+=mili;validateStartDate(start,"#startDateIn");parameters["start-date-time"]=start;parameters["repeat-time-millisecs"]=0;parameters["repeat-count"]=0;break;case"seconds":var start=startTimeGetter();parameters["start-date-time"]=start;var repeatSec=$("#recurrPatternInSec").val();if(repeatSec<1)
triggerError(">0","#recurrPatternInSec");parameters["repeat-time-millisecs"]=repeatSec*1000;if($("#endByRadio").is(":checked"))
parameters["end-date-time"]=endTimeGetter()
break;case"minutes":var start=startTimeGetter();parameters["start-date-time"]=start;var repeatMin=$("#recurrPatternInMin").val();if(repeatMin<1)
triggerError(">0","#recurrPatternInMin");parameters["repeat-time-millisecs"]=repeatMin*60000;if($("#endByRadio").is(":checked"))
parameters["end-date-time"]=endTimeGetter()
break;case"hours":var start=startTimeGetter();parameters["start-date-time"]=start;var repeatHour=$("#recurrPatternInHour").val();if(repeatHour<1)
triggerError(">0","#recurrPatternInHour");parameters["repeat-time-millisecs"]=repeatHour*3600000;if($("#endByRadio").is(":checked"))
parameters["end-date-time"]=endTimeGetter();break;case"daily":if($("#endByRadio").is(":checked"))
parameters["end-date-time"]=endTimeGetter();if($("#weekDayRadio").is(":checked")){parameters["cron"]=cronThis();}
else if($("#dayRadio").is(":checked")){var repeatDays=$("#recurrPatternInDay").val();if(repeatDays<1)
triggerError(">0","#recurrPatternInDay");parameters["repeat-time-millisecs"]=repeatDays*86400000;var start=startTimeGetter();parameters["start-date-time"]=start;}
break;case"weekly":parameters["cron"]=cronThis();var start=startTimeGetter();parameters["start-date-time"]=start;if($("#endByRadio").is(":checked"))
parameters["end-date-time"]=endTimeGetter();break;case"monthly":parameters["cron"]=cronThis();var start=startTimeGetter();parameters["start-date-time"]=start;if($("#endByRadio").is(":checked"))
parameters["end-date-time"]=endTimeGetter();break;case"yearly":parameters["cron"]=cronThis();var start=startTimeGetter();parameters["start-date-time"]=start;if($("#endByRadio").is(":checked"))
parameters["end-date-time"]=endTimeGetter();break;case"cron":var cronString=$("#cronString").val();validateCron(cronString);parameters["cron"]=cronString;var start=getUTC($("#rangeStartIn").val());parameters["start-date-time"]=start;if($("#endByRadio").is(":checked"))
parameters["end-date-time"]=endTimeGetter();break;}}
validateCron=function(cron){var arr=cron.split(" ");if(arr.length<7)
triggerError("Cron Expression too short","#cronString");else if(arr.length>7)
triggerError("Cron Expression too long","#cronString");else if((arr[3]!="?"&&arr[3]!="*")&&(arr[5]!="?"&&arr[5]!="*"))
triggerError("M+W unsuported.(M+? or W+?)","#cronString");}
hideAll=function(){$("#rangeOfRecurrDiv").hide();$("#cronDiv").hide();$("#recurrPatternDiv").hide();$("#startTimeDiv").hide();$("#rangeOfRecurrOnceDiv").hide();$("#patternSec").hide();$("#patternMin").hide();$("#patternHour").hide();$("#patternDay").hide();$("#patternWeek").hide();$("#patternMonth").hide();$("#patternYear").hide();}
changeOpts=function(){var choice=$("#recurrId").val();hideAll();switch(choice)
{case"once":$("#startTimeDiv").show();$("#rangeOfRecurrOnceDiv").show();break;case"seconds":$("#startTimeDiv").show();$("#recurrPatternDiv").show();$("#patternSec").show();$("#rangeOfRecurrDiv").show();break;case"minutes":$("#startTimeDiv").show();$("#recurrPatternDiv").show();$("#patternMin").show();$("#rangeOfRecurrDiv").show();break;case"hours":$("#startTimeDiv").show();$("#recurrPatternDiv").show();$("#patternHour").show();$("#rangeOfRecurrDiv").show();break;case"daily":$("#startTimeDiv").show();$("#recurrPatternDiv").show();$("#patternDay").show();$("#rangeOfRecurrDiv").show();break;case"weekly":$("#startTimeDiv").show();$("#recurrPatternDiv").show();$("#patternWeek").show();$("#rangeOfRecurrDiv").show();break;case"monthly":$("#startTimeDiv").show();$("#recurrPatternDiv").show();$("#patternMonth").show();$("#rangeOfRecurrDiv").show();break;case"yearly":$("#startTimeDiv").show();$("#recurrPatternDiv").show();$("#patternYear").show();$("#rangeOfRecurrDiv").show();break;case"cron":$("#cronDiv").show();$("#rangeOfRecurrDiv").show();break;}}
var monthOpts='<option value="1">January</option>'+'<option value="2">February</option>'+'<option value="3">March</option>'+'<option value="4">April</option>'+'<option value="5">May</option>'+'<option value="6">June</option>'+'<option value="7">July</option>'+'<option value="8">August</option>'+'<option value="9">September</option>'+'<option value="10">October</option>'+'<option value="11">November</option>'+'<option value="12">December</option>';var weekOpts='<option value="sunday">sunday</option>'+'<option value="monday">monday</option>'+'<option value="tuesday">tuesday</option>'+'<option value="wednesday">wednesday</option>'+'<option value="thursday">thursday</option>'+'<option value="friday">friday</option>'+'<option value="saturday">saturday</option>';var errorMessage='<label id="err" style="display:none">Incorrect Input</label>';var nameDiv='<div id="nameDiv"><form style="display:inline-block" id="nameForm"><span class="dialog-label">Name:</span><input id="nameIn" type="text" value="'+this.action+' Schedule"></form></div>';var groupDiv='<div id="groupDiv"><form style="display:inline-block" id="groupForm"><span class="dialog-label">Group:</span><input id="groupIn" type="text" value=""></form></div>';var descriptionDiv='<div><form style="display:inline-block" id="descForm"><span class="dialog-label">Description:</span><input id="descIn" type="text" value=""></form></div>';var recurrenceDiv='<div>'+'<br><span class="dialog-title" style="width: 100px; display: inline-block;">Recurrence:</span>'+'<select id="recurrId" onChange="changeOpts()" style="margin-left: 0px;">'+'<option value = "once" selected>Run Once</option>'+'<option value = "seconds">Seconds</option>'+'<option value = "minutes">Minutes</option>'+'<option value = "hours">Hours</option>'+'<option value = "daily">Daily</option>'+'<option value = "weekly">Weekly</option>'+'<option value = "monthly">Monthly</option>'+'<option value = "yearly">Yearly</option>'+'<option value = "cron">Cron</option></select></br></div>';var cronString='<div id="cronDiv"  style="display:none"><form><span class="dialog-label">Cron String:</span><input id="cronString" type="text" value=""></form></div>';var hours=makeSelect(1,12,1,"hours");var minutes=makeSelect(0,59,1,"minutes");var amPm='<select id = "amPm"><option value="am">AM</option><option value="pm">PM</option></select>';var startTime='<div id="startTimeDiv"><br><span class="dialog-title" style="width: 100px; display: inline-block;">Start Time:</span>'+hours+minutes+amPm+'</div>';var recurrencePattern='<div id="recurrPatternDiv" style = "display:none">'+'<div id="patternSec" >'+'<label style="display:inline-block; margin-left: 100px; font-weight: 500;">Every</label>&nbsp;&nbsp;'+'<form style="display:inline-block"><input id= "recurrPatternInSec" type="text" size="3" style="width:30px;"></form>'+'<label style="display:inline-block; font-weight: 500;"> second(s)</label>'+'</div>'+'<div id="patternMin" >'+'<label style="display:inline-block; margin-left: 100px; font-weight: 500;">Every</label>&nbsp;&nbsp;'+'<form style="display:inline-block"><input id= "recurrPatternInMin" type="text" size="3" style="width:30px;"></form>'+'<label style="display:inline-block; font-weight: 500;"> minute(s)</label>'+'</div>'+'<div id="patternHour" >'+'<label style="display:inline-block; margin-left: 100px; font-weight: 500;">Every</label>&nbsp;&nbsp;'+'<form style="display:inline-block"><input id= "recurrPatternInHour" type="text" size="3" style="width:30px;"></form>'+'<label style="display:inline-block; font-weight: 500;"> hour(s)</label>'+'</div>'+'<div id="patternDay" >'+'<input type="radio" name ="day" value="day" id="dayRadio" style="margin-left: 100px; font-weight: 500;" checked> <label style="display:inline-block">Every</label>&nbsp;&nbsp;'+'<form style="display:inline-block"><input id= "recurrPatternInDay" type="text" size="3" style="width:30px;"></form>'+'<label style="display:inline-block; font-weight: 500;"> day(s)</label></br>'+'<input type="radio" name ="day" value="weekDay" id="weekDayRadio" style="margin-left: 100px;"> Every weekday'+'</div>'+'<div id="patternWeek" >'+'<form>'+'<div id="errorCheckboxes" style="display:none"><label id="errWeek">Choose at least one week</label></div>'+'<input type="checkbox" name="weekday" value="monday" id="monday" style="margin-left: 100px;"> Monday'+'<input type="checkbox" name="weekday" value="tuesday" id="tuesday"> Tuesday'+'<input type="checkbox" name="weekday" value="wednesday" id="wednesday"> Wednesday'+'<input type="checkbox" name="weekday" value="thursday" id="thursday"> Thursday'+'</br>'+'<input type="checkbox" name="weekday" value="friday" id="friday" style="margin-left: 100px;"> Friday'+'<input type="checkbox" name="weekday" value="saturday" id="saturday"> Saturday'+'<input type="checkbox" name="weekday" value="sunday" id="sunday"> Sunday'+'</form>'+'</div>'+'<div id="patternMonth" >'+'<input id="monthRadio" type="radio" name ="month" value="day" style="margin-left: 100px;" checked> <label style="display:inline-block; font-weight: 500;">Day</label>&nbsp;&nbsp;'+'<form style="display:inline-block"><input id= "recurrPatternIn" type="text" size="3" style="width:205px;"></form>'+'<label style="display:inline-block; font-weight: 500;"> of every month</label></br>'+'<input type="radio" name ="month" value="the" style="margin-left: 100px;"> <label style="display:inline-block; font-weight: 500;">The</label>&nbsp;&nbsp;'+'<select id="monthOpt1Select">'+'<option value="1">first</option>'+'<option value="2">second</option>'+'<option value="3">third</option>'+'<option value="4">fourth</option>'+'<option value="5">last</option>'+'</select>'+'<select id="monthOpt2Select">'+weekOpts+'</select><label style=" font-weight: 500;"> of every month</label>'+'</div>'+'<div id="patternYear" >'+'<input id ="yearRadio" type="radio" name ="year" value="month" style="margin-left: 100px;" checked> <label style="display:inline-block; font-weight: 500;">Every</label>&nbsp;'+'<select id="yearEveryMonth">'+monthOpts+'</select><input id="yearDayMonth"type="text" size="3">'+'</br>'+'<input type="radio" name ="year" value="the" style="margin-left: 100px;"> <label style="display:inline-block; font-weight: 500;">The</label>&nbsp;'+'<select id="yearOpt1Select">'+'<option value="1">first</option>'+'<option value="2">second</option>'+'<option value="3">third</option>'+'<option value="4">fourth</option>'+'<option value="5">last</option>'+'</select>'+'<select id="yearOpt2Select">'+weekOpts+'</select><label style=" font-weight: 500;">of&nbsp;&nbsp;</label>'+'<select id="yearMonthSelect">'+monthOpts+'</select>'+'</div>'+'</div>';var rangeOfRecurrence='<div id="rangeOfRecurrDiv" style="display:none"><br><span class="dialog-title"><strong>Range of Recurrence:</strong> </span>'+'<form><span class="dialog-label">Start:</span><input type="text" id="rangeStartIn"></form>'+'<form><span class="dialog-label">End:</span><input type="radio" name ="end" value="noEnd" checked> No end date'+'</br><input type="radio" name ="end" value ="endBy" id="endByRadio" style="margin-left:100px;"> End by:&nbsp;&nbsp;'+'<input id= "endByIn" type="text" style="width:187px;"></form>'+'</div>';var rangeOfRecurrenceOnce='<div id="rangeOfRecurrOnceDiv"><form><span class="dialog-label">Start Date:</span><input id= "startDateIn" type="text" value=""></form></div>';var mailInfo='<form><span class="dialog-label">To (Email):</span><input id="to" type="text" value=""></form>';var fullPage="";if($.inArray(this.adminRole?this.adminRole:"Admin",Dashboards.context.roles)>=0)
fullPage=nameDiv+mailInfo+recurrenceDiv+cronString+startTime+recurrencePattern+rangeOfRecurrence+rangeOfRecurrenceOnce;else{var subscriptionSelector="<span class='dialog-label'>Subscription: </span><select name='subscriptionSelector' id='subscriptionSelector'>";var x=$.ajaxSettings.async;$.ajaxSetup({async:false});$.getJSON("getSchedules",{solution:this.solution,path:this.path,action:this.action},function(response){for(var i=0;i<response.length;i++){if(response[i]){subscriptionSelector+="<option value='"+response[i].id+"'>"+response[i].name+"</option>";}}},'text');$.ajaxSetup({async:x});subscriptionSelector+="</select>";fullPage=nameDiv+mailInfo+subscriptionSelector;}
var myself=this;var promp={basicState:{html:fullPage,title:"Schedule Report",buttons:{"Cancel":-1,"Ok":1},submit:function(e,v,m,f){sharedUuid=guid();if(e==-1){$.prompt.close();}
else if(e==1){var sharedUuid=guid();var parameters={};if($.inArray(this.adminRole?this.adminRole:"Admin",Dashboards.context.roles)>=0){parameters={title:$("#nameIn").val(),cron:"00 00 0 ? * 2,7",desc:$("#nameIn").val(),"start-date-time":"1366628400000",schedRef:sharedUuid,group:myself.group?myself.group:"Default Schedule Group",requestedMimeType:"text/xml",actionRefs:myself.solution+"/"+myself.path+"/"+myself.action,schedulerAction:"doAddScheduleAndContent"};}
var parameters2={path:myself.path,solution:myself.solution,name:myself.action,subscribe:true,"subscription-name":$("#nameIn").val(),"schedule-id":sharedUuid,showParameters:myself.showParameters,htmlProportionalWidth:false,"accepted-page":-1,"output-target":myself.outputTarget?myself.outputTarget:"table/html;page-mode=page",renderMode:"SUBSCRIBE"};for(var i=0;i<myself.parameters.length;i++){var param=myself.parameters[i];parameters2[param[0]]=param[1];}
if($("#to").val().length>0){parameters2.destination=$("#to").val();}
var success=false;var x=$.ajaxSettings.async;$.ajaxSetup({async:false});if($.inArray(this.adminRole?this.adminRole:"Admin",Dashboards.context.roles)>=0){$.post("../../SubscriptionAdminService",parameters,function(xml){if(xml&&xml.documentElement&&xml.documentElement.attributes['result']&&xml.documentElement.attributes['result'].nodeValue=='OK'){var scheduleId=sharedUuid;$.getJSON("getSchedules",{solution:myself.solution,path:myself.path,action:myself.action},function(response){for(var i=0;i<response.length;i++){if(response[i]){if(response[i].name==$("#nameIn").val())
scheduleId=response[i].id;}}},'text');parameters2["schedule-id"]=scheduleId;$.get("../../content/reporting",parameters2,function(response){alert(response);success=response=='Public Schedule saved/created';},'text');}else{alert('Error while creating schedule');}},'xml');}else{parameters2["schedule-id"]=$("#subscriptionSelector").val();$.get("../../content/reporting",parameters2,function(response){alert(response);success=response=='Public Schedule saved/created';},'text');}
$.ajaxSetup({async:x});return success;}}}};$.prompt(promp,{classes:'scheduler'});$(".scheduler #jqi").css("width","510px");$(document).ready(function(ev){$("#startDateIn").datepicker({minDate:0});$("#rangeStartIn").datepicker({minDate:0});$("#endByIn").datepicker({minDate:0});$("#startDateIn").datepicker("setDate",new Date());$("#rangeStartIn").datepicker("setDate",new Date());});}});var ExecutePrptComponent=PrptComponent.extend({visible:false,update:function(){var myself=this;var o=$("#"+this.htmlObject);if($.inArray(o[0].tagName.toUpperCase(),["SPAN","DIV"])>-1){o=$("<button/>").appendTo(o.empty());if(o[0].tagName=="DIV")o.wrap("<span/>");if(this.label!=undefined)o.text(this.label);o.button();}
o.unbind("click");o.bind("click",function(){var success=typeof(myself.preChange)=='undefined'?true:myself.preChange();if(success){myself.executePrptComponent();}
typeof(myself.postChange)=='undefined'?true:myself.postChange();});},executePrptComponent:function(){var options=this.getOptions();var url=webAppPath+'/content/reporting/reportviewer/report.html';var a=[];var encodeArray=function(k,v){var arr=[];for(var i=0;i<v.length;i++){arr.push(encodeURIComponent(k)+'='+encodeURIComponent(v[i]));}
return arr;};$.each(options,function(k,v){if(typeof v=='object'){a.push.apply(a,encodeArray(k,v));}else{a.push(encodeURIComponent(k)+"="+encodeURIComponent(v));}});$.fancybox({type:"iframe",href:url+"?"+a.join('&'),width:$(window).width(),height:$(window).height()-50});}});var AnalyzerComponent=BaseComponent.extend({update:function(){this.clear();var options=this.getOptions();var url=webAppPath+'/content/analyzer/';var myself=this;this.viewOnly?url+='viewer':url+='editor';var height=this.height?this.height:"480px";var width=this.width?this.width:"100%";var iFrameHTML=this.generateIframe(this.htmlObject,url,options,height,width);$("#"+this.htmlObject).html(iFrameHTML);},getOptions:function(){var options={solution:this.solution,path:this.path,action:this.action,command:this.command==undefined?"open":this.command,showFieldList:this.showFieldList==undefined?false:this.showFieldList,frameless:this.frameless};$.map(this.parameters,function(k){options[k[0]]=k.length==3?k[2]:Dashboards.getParameterValue(k[1]);});return options;},generateIframe:function(htmlObject,url,parameters,height,width){var iFrameHTML='<iframe id="iframe_'+htmlObject+'"'+' frameborder="0"'+' height="'+height+'"'+' width="'+width+'"'+' src="'+url+"?";iFrameHTML+=$.param(parameters,true);iFrameHTML+="\"></iframe>";return iFrameHTML;}});var ExecuteXactionComponent=BaseComponent.extend({visible:false,update:function(){var myself=this;var o=$("#"+this.htmlObject);if($.inArray(o[0].tagName.toUpperCase(),["SPAN","DIV"])>-1){o=$("<button/>").appendTo(o.empty());if(o[0].tagName=="DIV")o.wrap("<span/>");if(this.label!=undefined)o.text(this.label);o.button();}
o.unbind("click");o.bind("click",function(){var success=typeof(myself.preChange)=='undefined'?true:myself.preChange();if(success){myself.executeXAction();}
typeof(myself.postChange)=='undefined'?true:myself.postChange();});},executeXAction:function(){var url=webAppPath+"/ViewAction?solution="+this.solution+"&path="+this.path+"&action="+this.action+"&";var p=new Array(this.parameters.length);var parameters=[];for(var i=0,len=p.length;i<len;i++){var key=this.parameters[i][0];var value=Dashboards.getParameterValue(this.parameters[i][1]);if($.isArray(value)){$(value).each(function(p){parameters.push(key+"="+encodeURIComponent(this));});}
else{parameters.push(key+"="+encodeURIComponent(value));}}
url+=parameters.join("&");var _href=url.replace(/'/g,"&#39;");$.fancybox({type:"iframe",href:_href,width:$(window).width(),height:$(window).height()-50});}});var JFreeChartComponent=BaseComponent.extend({update:function(){var xactionFile=(this.chartDefinition.queryType=='cda')?"jfreechart-cda.xaction":"jfreechart.xaction";this.callPentahoAction(xactionFile);},getParameters:function(){var cd=this.chartDefinition;if(cd==undefined){Dashboards.log("Fatal - No chartDefinition passed","error");return;}
if(typeof cd.titleKey!=="undefined"&&typeof Dashboards.i18nSupport!=="undefined"&&Dashboards.i18nSupport!=null){cd.title=Dashboards.i18nSupport.prop(cd.titleKey);}
var cdaParameterString=null;if(cd.queryType=="cda"){if($.isArray(this.parameters)){var param;for(var i=0;i<this.parameters.length;i++){param=this.parameters[i];if($.isArray(param)&&param.length>=2){var name=param[0];var value=param[1];if(value){value=doCsvQuoting(value,'=');}
if(i==0)cdaParameterString="";else cdaParameterString+=";";cdaParameterString+=doCsvQuoting(name+"="+value,';');}}}}
var cd0=cd.chartOptions!=undefined?$.extend({},Dashboards.ev(cd.chartOptions),cd):cd;var parameters=[];for(p in cd0){var key=p;var value=typeof cd0[p]=='function'?cd0[p]():cd0[p];parameters.push([key,value]);}
if(cdaParameterString!=null){parameters.push(["cdaParameterString",cdaParameterString]);}
return parameters;},callPentahoAction:function(action){Dashboards.incrementRunningCalls();var myself=this;Dashboards.callPentahoAction(myself,"system","pentaho-cdf/actions",action,this.getParameters(),function(jXML){if(jXML!=null){if(myself.chartDefinition.caption!=undefined){myself.buildCaptionWrapper($(jXML.find("ExecuteActivityResponse:first-child").text()),action);}
else{$('#'+myself.htmlObject).html(jXML.find("ExecuteActivityResponse:first-child").text());}}
Dashboards.decrementRunningCalls();});},buildCaptionWrapper:function(chart,cdfComponent){var exportFile=function(type,cd){var xactionFile=(cd.queryType=='cda')?"jtable-cda.xaction":"jtable.xaction";var obj=$.extend({solution:"system",path:"pentaho-cdf/actions",action:xactionFile,exportType:type},cd);Dashboards.post(webAppPath+'/content/pentaho-cdf/Export',obj);};var myself=this;var cd=myself.chartDefinition;var captionOptions=$.extend({title:{title:cd.title!=undefined?cd.title:"Details",oclass:'title'},chartType:{title:"Chart Type",show:function(){return cd.chartType!='function'&&(cd.chartType=="BarChart"||cd.chartType=="PieChart")},icon:function(){return cd.chartType=="BarChart"?webAppPath+'/content/pentaho-cdf/resources/style/images/pie_icon.png':webAppPath+'/content/pentaho-cdf/resources/style/images/bar_icon.png';},oclass:'options',callback:function(){cd.chartType=cd.chartType=="BarChart"?"PieChart":"BarChart";myself.update();}},excel:{title:"Excel",icon:webAppPath+'/content/pentaho-cdf/resources/style/images/excel_icon.png',oclass:'options',callback:function(){exportFile("excel",cd);}},csv:{title:"CSV",icon:webAppPath+'/content/pentaho-cdf/resources/style/images/csv_icon.gif',oclass:'options',callback:function(){exportFile("csv",cd);}},zoom:{title:'Zoom',icon:webAppPath+'/content/pentaho-cdf/resources/style/images/magnify.png',oclass:'options',callback:function(){Dashboards.incrementRunningCalls();var parameters=myself.getParameters();var width=200,height=200;var urlTemplate,parameterName="";for(p in parameters){if(parameters[p][0]=='width'){width+=parameters[p][1];parameters[p]=['width',width]};if(parameters[p][0]=='height'){height+=parameters[p][1];parameters[p]=['height',height]};if(parameters[p][0]=='parameterName'){parameterName=parameters[p][1];parameters[p]=['parameterName','parameterValue']};if(parameters[p][0]=='urlTemplate'){urlTemplate=parameters[p][1];parameters[p]=['urlTemplate',"javascript:chartClick('"+myself.name+"','{parameterValue}');"]};}
myself.zoomCallBack=function(value){eval(urlTemplate.replace("{"+parameterName+"}",value));};Dashboards.callPentahoAction(myself,"system","pentaho-cdf/actions",cdfComponent,parameters,function(jXML){if(jXML!=null){var openWindow=window.open(webAppPath+"/content/pentaho-cdf/js/captify/zoom.html","_blank",'width='+(width+10)+',height='+(height+10));var maxTries=10;var loadChart=function(){if(openWindow.loadChart!=undefined)openWindow.loadChart(jXML.find("ExecuteActivityResponse:first-child").text())
else if(maxTries>0){maxTries-=1;setTimeout(loadChart,500);}};loadChart();}
Dashboards.decrementRunningCalls();});}},details:{title:'Details',icon:webAppPath+'/content/pentaho-cdf/resources/style/images/table.png',oclass:'options',callback:function(){myself.pivotDefinition={jndi:cd.jndi,catalog:cd.catalog,query:cd.query};PivotLinkComponent.openPivotLink(myself);}}},cd.caption);var captionId=myself.htmlObject+'caption';var caption=$('<div id="'+captionId+'" ></div>');chart.attr("id",myself.htmlObject+'image');chart.attr("rel",myself.htmlObject+"caption");chart.attr("class","captify");for(o in captionOptions){var show=captionOptions[o].show==undefined||(typeof captionOptions[o].show=='function'?captionOptions[o].show():captionOptions[o].show)?true:false;if(this.chartDefinition.queryType!="mdx"&&captionOptions[o].title=="Details"){show=false;};if(show){var icon=captionOptions[o].icon!=undefined?(typeof captionOptions[o].icon=='function'?captionOptions[o].icon():captionOptions[o].icon):undefined;var op=icon!=undefined?$('<image id ="'+captionId+o+'" src = "'+icon+'"></image>'):$('<span id ="'+captionId+o+'">'+captionOptions[o].title+'</span>');op.attr("class",captionOptions[o].oclass!=undefined?captionOptions[o].oclass:"options");op.attr("title",captionOptions[o].title);caption.append(op);}};$("#"+myself.htmlObject).empty();var bDetails=$('<div class="caption-details">Details</div>');$("#"+myself.htmlObject).append(bDetails);$("#"+myself.htmlObject).append(chart);$("#"+myself.htmlObject).append(caption);$('img.captify').captify($.extend({bDetails:bDetails,spanWidth:'95%',hideDelay:3000,hasButton:false,opacity:'0.5'},cd.caption));bDetails.one('capityFinished',function(e,wrapper){var chartOffset=chart.offset();var bDetailsOffset=bDetails.offset();if(chart.length>1){bDetails.bind("mouseenter",function(){$("#"+myself.htmlObject+'image').trigger('detailsClick',[this]);});bDetails.css("left",bDetails.position().left+$(chart[1]).width()-bDetails.width()-5);bDetails.css("top",bDetails.position().top+$(chart[1]).height()-bDetails.height());$(chart[1]).append(chart[0]);}
for(o in captionOptions)
if(captionOptions[o].callback!=undefined)
$("#"+captionId+o).bind("click",captionOptions[o].callback);});}});var DialComponent=JFreeChartComponent.extend({update:function(){var cd=this.chartDefinition;if(cd==undefined){Dashboards.log("Fatal - No chartDefinition passed","error");return;}
cd.chartType='DialChart';var intervals=cd.intervals;var colors=cd.colors;if(colors!=undefined&&intervals.length!=colors.length){Dashboards.log("Fatal - Number of intervals differs from number of colors","error");return;}
this.callPentahoAction(cd.queryType=='cda'?"jfreechartdial-cda.xaction":"jfreechartdial.xaction");}});var OpenFlashChartComponent=JFreeChartComponent.extend({callPentahoAction:function(){Dashboards.incrementRunningCalls();var myself=this;Dashboards.callPentahoAction(myself,"system","pentaho-cdf/actions","openflashchart.xaction",this.getParameters(),function(jXML){if(jXML!=null){var result=jXML.find("ExecuteActivityResponse:first-child").text().replace(/openflashchart/g,webAppPath+"/openflashchart");getDataFuntion=result.match(/getData.*\(\)/gi);$("#"+myself.htmlObject).html(result);}
Dashboards.decrementRunningCalls();});OpenFlashChartComponent.prototype.onClick=function(value){if(getDataFuntion!=null&&myself.chartDefinition.urlTemplate!=undefined&&myself.chartDefinition.parameterName!=undefined){myself.data=myself.data!=undefined?myself.data:eval('('+eval(getDataFuntion[0])+')');if(myself.data.x_axis!=undefined){var urlTemplate=myself.chartDefinition.urlTemplate.replace("{"+myself.chartDefinition.parameterName+"}",myself.data.x_axis.labels.labels[value]);eval(urlTemplate);}}};}});var TrafficComponent=BaseComponent.extend({update:function(){var cd=this.trafficDefinition;if(cd==undefined){Dashboards.log("Fatal - No trafficDefinition passed","error");return;}
var intervals=cd.intervals;if(intervals==undefined){cd.intervals=[-1,1];}
var parameters=[];for(p in cd){var key=p;var value=typeof cd[p]=='function'?cd[p]():cd[p];parameters.push([key,value]);}
Dashboards.incrementRunningCalls();var myself=this;Dashboards.callPentahoAction(myself,"system","pentaho-cdf/actions","traffic.xaction",parameters,function(result){var value=$(result).find("VALUE").text();var i=$("<img>").attr("src",value<=cd.intervals[0]?Dashboards.TRAFFIC_RED:(value>=cd.intervals[1]?Dashboards.TRAFFIC_GREEN:Dashboards.TRAFFIC_YELLOW));$('#'+myself.htmlObject).html(i);if(cd.showValue!=undefined&&cd.showValue==true){var tooltip="Value: "+value+" <br /><img align='middle' src='"+Dashboards.TRAFFIC_RED+"'/> &le; "+cd.intervals[0]+" &lt;  <img align='middle' src='"+Dashboards.TRAFFIC_YELLOW+"'/> &lt; "+cd.intervals[1]+" &le; <img align='middle' src='"+Dashboards.TRAFFIC_GREEN+"'/> <br/>"+(tooltip!=undefined?tooltip:"");$('#'+myself.htmlObject).attr("title",tooltip+(myself._tooltip!=undefined?myself._tooltip:"")).tooltip({delay:0,track:true,fade:250});}
Dashboards.decrementRunningCalls();});}});var TimePlotComponent=BaseComponent.extend({reset:function(){this.timeplot=undefined;this.chartDefinition.dateRangeInput=this.InitialDateRangeInput;this.listeners=this.InitialListeners;},update:function(){var cd=this.chartDefinition;this.InitialListeners=this.InitialListeners==undefined?this.listeners:this.InitialListeners;this.InitialDateRangeInput=this.InitialDateRangeInput==undefined?cd.dateRangeInput:this.InitialDateRangeInput;if(cd.updateOnDateRangeInputChange!=true&&this.timeplot!=undefined&&cd.dateRangeInput!=undefined){if(this.updateTimeplot!=false&&this.timeplot._plots.length>0){var lastEventPlot=this.timeplot._plots[this.timeplot._plots.length-1];if(lastEventPlot._id=="eventPlot")
lastEventPlot._addSelectEvent(Dashboards.getParameterValue(this.startDateParameter)+" 00:00:00",Dashboards.getParameterValue(this.endDateParameter)+" 23:59:59",lastEventPlot._eventSource,"iso8601",this.geometry._earliestDate,this.geometry._latestDate);}
return;}
if(cd.dateRangeInput!=undefined&&this.timeplot==undefined){cd.dateRangeInput=Dashboards.getComponent(cd.dateRangeInput);this.startDateParameter=cd.dateRangeInput.parameter[0];this.endDateParameter=cd.dateRangeInput.parameter[1];this.listeners=this.listeners==undefined?[]:this.listeners;this.listeners=this.listeners.concat(this.startDateParameter).concat(this.endDateParameter);}
if(typeof Timeplot!="undefined"&&Dashboards.timePlotColors==undefined){Dashboards.timePlotColors=[new Timeplot.Color('#820000'),new Timeplot.Color('#13E512'),new Timeplot.Color('#1010E1'),new Timeplot.Color('#E532D1'),new Timeplot.Color('#1D2DE1'),new Timeplot.Color('#83FC24'),new Timeplot.Color('#A1D2FF'),new Timeplot.Color('#73F321')];}
var timePlotTimeGeometry=new Timeplot.DefaultTimeGeometry({gridColor:"#000000",axisLabelsPlacement:"top",gridType:"short",yAxisColor:"rgba(255,255,255,0)",gridColor:"rgba(100,100,100,1)"});var timePlotValueGeometry=new Timeplot.DefaultValueGeometry({gridColor:"#000000",min:0,axisLabelsPlacement:"left",gridType:"short",valueFormat:function(value){return toFormatedString(value);}});var timePlotEventSource=new Timeplot.DefaultEventSource();var eventSource2=new Timeplot.DefaultEventSource();var timePlot;var obj=this;if(cd==undefined){Dashboards.log("Fatal - No chart definition passed","error");return;}
if(cd.showValues==undefined){cd.showValues=true;}
var cols=typeof cd['columns']=='function'?cd['columns']():cd['columns'];if(cols==undefined||cols.length==0){Dashboards.log("Fatal - No 'columns' property passed in chartDefinition","error");return;}
var title=$('<div></div>');if(cd.title!=undefined){title.append('<span style="text-transform: lowercase;">'+cd.title+'&nbsp; &nbsp; &nbsp;</span>');}
var plotInfo=[];for(var i=0,j=0;i<cols.length;i++,j++){j=j>7?0:j;title.append('<span id="'+obj.name+'Plot'+i+'Header" style="color:'+Dashboards.timePlotColors[j].toHexString()+'">'+cols[i]+' &nbsp;&nbsp;</span>');var plotInfoOpts={id:obj.name+"Plot"+i,name:cols[i],dataSource:new Timeplot.ColumnSource(timePlotEventSource,i+1),valueGeometry:timePlotValueGeometry,timeGeometry:timePlotTimeGeometry,lineColor:Dashboards.timePlotColors[j],showValues:cd.showValues,hideZeroToolTipValues:cd.hideZeroToolTipValues!=undefined?cd.hideZeroToolTipValues:false,showValuesMode:cd.showValuesMode!=undefined?cd.showValuesMode:"header",toolTipFormat:function(value,plot){return plot._name+" = "+toFormatedString(value);},headerFormat:function(value,plot){return plot._name+" = "+toFormatedString(value)+"&nbsp;&nbsp;";}};if(cd.dots==true){plotInfoOpts.dotColor=Dashboards.timePlotColors[j];}
if(cd.fill==true){plotInfoOpts.fillColor=Dashboards.timePlotColors[j].transparency(0.5);}
plotInfo.push(new Timeplot.createPlotInfo(plotInfoOpts));}
var eventSource2=undefined;var eventSourcePlot=undefined;if(cd.dateRangeInput!=undefined||(cd.events&&cd.events.show==true)){this.rangeColor="00FF00";eventSource2=new Timeplot.DefaultEventSource();eventSourcePlot=Timeplot.createPlotInfo({id:cd.dateRangeInput!=undefined?"eventPlot":"events",eventSource:eventSource2,timeGeometry:timePlotTimeGeometry,lineColor:"#FF0000",rangeColor:this.rangeColor,getSelectedRegion:function(start,end){myself.updateDateRangeInput(start,end);}});plotInfo.push(eventSourcePlot);}
$("#"+this.htmlObject).html(title);$("#"+this.htmlObject).append("<div class='timeplot'></div>");if(cd.height>0){$("#"+this.htmlObject+" > div.timeplot").css("height",cd.height);}
if(cd.width>0){$("#"+this.htmlObject+" > div.timeplot").css("width",cd.width);}
timeplot=Timeplot.create($("#"+this.htmlObject+" > div.timeplot")[0],plotInfo);obj.timeplot=timeplot;obj.geometry=timePlotTimeGeometry;var parameters=[];for(p in cd){var key=p;var value=typeof cd[p]=='function'?cd[p]():cd[p];parameters.push(key+"="+value);}
var allData=undefined;var timePlotEventSourceUrl=webAppPath+"/ViewAction?solution=system&path=pentaho-cdf/actions&action=timelinefeeder.xaction&"+parameters.join('&');var myself=this;if(cd.events&&cd.events.show==true){var parameters=[];for(p in cd.events){var key=p;var value=typeof cd.events[p]=='function'?cd.events[p]():cd.events[p];parameters.push(key+"="+value);}
var eventUrl=webAppPath+"/ViewAction?solution=system&path=pentaho-cdf/actions&action=timelineeventfeeder.xaction&"+parameters.join('&');timeplot.loadText(timePlotEventSourceUrl,",",timePlotEventSource,null,null,function(range){timeplot.loadJSON(eventUrl,eventSource2,function(data){data.events=myself.filterEvents(data.events,range);if(cd.dateRangeInput){var lastEventPlot=timeplot._plots[timeplot._plots.length-1];if(lastEventPlot._id=="eventPlot")
lastEventPlot._addSelectEvent(Dashboards.getParameterValue(obj.startDateParameter)+" 00:00:00",Dashboards.getParameterValue(obj.endDateParameter)+" 23:59:59",eventSource2,"iso8601",timePlotTimeGeometry._earliestDate,timePlotTimeGeometry._latestDate);}})});}
else
timeplot.loadText(timePlotEventSourceUrl,",",timePlotEventSource,null,null,function(){if(cd.dateRangeInput){var lastEventPlot=timeplot._plots[timeplot._plots.length-1];if(lastEventPlot._id=="eventPlot")
lastEventPlot._addSelectEvent(Dashboards.getParameterValue(obj.startDateParameter)+" 00:00:00",Dashboards.getParameterValue(obj.endDateParameter)+" 23:59:59",eventSource2,"iso8601",timePlotTimeGeometry._earliestDate,timePlotTimeGeometry._latestDate);}});},filterEvents:function(events,range){var result=[];var min=MetaLayer.toDateString(new Date(range.earliestDate));var max=MetaLayer.toDateString(new Date(range.latestDate));for(i=0;i<events.length;i++){if(events[i].start>=min&&((events[i].end==undefined&&events[i].start<=max)||events[i].end<=max)){result.push(events[i]);}}
return result;},updateDateRangeInput:function(start,end){var toDateString=function(d){var currentMonth="0"+(d.getMonth()+1);var currentDay="0"+(d.getDate());return d.getFullYear()+"-"+(currentMonth.substring(currentMonth.length-2,currentMonth.length))+"-"+(currentDay.substring(currentDay.length-2,currentDay.length));};if(this.chartDefinition.dateRangeInput!=undefined){if(start>end){var aux=start;start=end;end=aux;}
Dashboards.setParameter(this.startDateParameter,toDateString(start));Dashboards.setParameter(this.endDateParameter,toDateString(end));this.updateTimeplot=false;Dashboards.update(this.chartDefinition.dateRangeInput);Dashboards.fireChange(this.startDateParameter,toDateString(start));this.updateTimeplot=true;}}});(function(){var $,Chosen,get_side_border_padding,root;var __bind=function(fn,me){return function(){return fn.apply(me,arguments);};};root=this;$=jQuery;$.fn.extend({chosen:function(data,options){if($.browser==="msie"&&($.browser.version==="6.0"||$.browser.version==="7.0")){return this;}
return $(this).each(function(input_field){if(!($(this)).hasClass("chzn-done")){return new Chosen(this,data,options);}});}});Chosen=(function(){function Chosen(elmn){this.set_default_values();this.form_field=elmn;this.form_field_jq=$(this.form_field);this.is_multiple=this.form_field.multiple;this.is_rtl=this.form_field_jq.hasClass("chzn-rtl");this.default_text_default=this.form_field.multiple?"Select Some Options":"Select an Option";this.set_up_html();this.register_observers();this.form_field_jq.addClass("chzn-done");}
Chosen.prototype.set_default_values=function(){this.click_test_action=__bind(function(evt){return this.test_active_click(evt);},this);this.active_field=false;this.mouse_on_container=false;this.results_showing=false;this.result_highlighted=null;this.result_single_selected=null;return this.choices=0;};Chosen.prototype.set_up_html=function(){var container_div,dd_top,dd_width,sf_width;this.container_id=this.form_field.id.length?this.form_field.id.replace(/(:|\.)/g,'_'):this.generate_field_id();this.container_id+="_chzn";this.f_width=this.form_field_jq.width();this.default_text=this.form_field_jq.data('placeholder')?this.form_field_jq.data('placeholder'):this.default_text_default;container_div=$("<div />",{id:this.container_id,"class":"chzn-container "+(this.is_rtl?'chzn-rtl':''),style:'width: '+this.f_width+'px;'});if(this.is_multiple){container_div.html('<ul class="chzn-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chzn-drop" style="left:-9000px;"><ul class="chzn-results"></ul></div>');}else{container_div.html('<a href="javascript:void(0)" class="chzn-single"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chzn-drop" style="left:-9000px;"><div class="chzn-search"><input type="text" autocomplete="off" /></div><ul class="chzn-results"></ul></div>');}
this.form_field_jq.hide().after(container_div);this.container=$('#'+this.container_id);this.container.addClass("chzn-container-"+(this.is_multiple?"multi":"single"));this.dropdown=this.container.find('div.chzn-drop').first();dd_top=this.container.height();dd_width=this.f_width-get_side_border_padding(this.dropdown);this.dropdown.css({"width":dd_width+"px","top":dd_top+"px"});this.search_field=this.container.find('input').first();this.search_results=this.container.find('ul.chzn-results').first();this.search_field_scale();this.search_no_results=this.container.find('li.no-results').first();if(this.is_multiple){this.search_choices=this.container.find('ul.chzn-choices').first();this.search_container=this.container.find('li.search-field').first();}else{this.search_container=this.container.find('div.chzn-search').first();this.selected_item=this.container.find('.chzn-single').first();sf_width=dd_width-get_side_border_padding(this.search_container)-get_side_border_padding(this.search_field);this.search_field.css({"width":sf_width+"px"});}
this.results_build();return this.set_tab_index();};Chosen.prototype.register_observers=function(){this.container.mousedown(__bind(function(evt){return this.container_mousedown(evt);},this));this.container.mouseenter(__bind(function(evt){return this.mouse_enter(evt);},this));this.container.mouseleave(__bind(function(evt){return this.mouse_leave(evt);},this));this.search_results.mouseup(__bind(function(evt){return this.search_results_mouseup(evt);},this));this.search_results.mouseover(__bind(function(evt){return this.search_results_mouseover(evt);},this));this.search_results.mouseout(__bind(function(evt){return this.search_results_mouseout(evt);},this));this.form_field_jq.bind("liszt:updated",__bind(function(evt){return this.results_update_field(evt);},this));this.search_field.blur(__bind(function(evt){return this.input_blur(evt);},this));this.search_field.keyup(__bind(function(evt){return this.keyup_checker(evt);},this));this.search_field.keydown(__bind(function(evt){return this.keydown_checker(evt);},this));if(this.is_multiple){this.search_choices.click(__bind(function(evt){return this.choices_click(evt);},this));return this.search_field.focus(__bind(function(evt){return this.input_focus(evt);},this));}else{return this.selected_item.focus(__bind(function(evt){return this.activate_field(evt);},this));}};Chosen.prototype.container_mousedown=function(evt){if(evt&&evt.type==="mousedown"){evt.stopPropagation();}
if(!this.pending_destroy_click){if(!this.active_field){if(this.is_multiple){this.search_field.val("");}
$(document).click(this.click_test_action);this.results_show();}else if(!this.is_multiple&&evt&&($(evt.target)===this.selected_item||$(evt.target).parents("a.chzn-single").length)){evt.preventDefault();this.results_toggle();}
return this.activate_field();}else{return this.pending_destroy_click=false;}};Chosen.prototype.mouse_enter=function(){return this.mouse_on_container=true;};Chosen.prototype.mouse_leave=function(){return this.mouse_on_container=false;};Chosen.prototype.input_focus=function(evt){if(!this.active_field){return setTimeout((__bind(function(){return this.container_mousedown();},this)),50);}};Chosen.prototype.input_blur=function(evt){if(!this.mouse_on_container){this.active_field=false;return setTimeout((__bind(function(){return this.blur_test();},this)),100);}};Chosen.prototype.blur_test=function(evt){if(!this.active_field&&this.container.hasClass("chzn-container-active")){return this.close_field();}};Chosen.prototype.close_field=function(){$(document).unbind("click",this.click_test_action);if(!this.is_multiple){this.selected_item.attr("tabindex",this.search_field.attr("tabindex"));this.search_field.attr("tabindex",-1);}
this.active_field=false;this.results_hide();this.container.removeClass("chzn-container-active");this.winnow_results_clear();this.clear_backstroke();this.show_search_field_default();return this.search_field_scale();};Chosen.prototype.activate_field=function(){if(!this.is_multiple&&!this.active_field){this.search_field.attr("tabindex",this.selected_item.attr("tabindex"));this.selected_item.attr("tabindex",-1);}
this.container.addClass("chzn-container-active");this.active_field=true;this.search_field.val(this.search_field.val());return this.search_field.focus();};Chosen.prototype.test_active_click=function(evt){if($(evt.target).parents('#'+this.container_id).length){return this.active_field=true;}else{return this.close_field();}};Chosen.prototype.results_build=function(){var content,data,startTime,_i,_len,_ref;startTime=new Date();this.parsing=true;this.results_data=root.SelectParser.select_to_array(this.form_field);if(this.is_multiple&&this.choices>0){this.search_choices.find("li.search-choice").remove();this.choices=0;}else if(!this.is_multiple){this.selected_item.find("span").text(this.default_text);}
content='';_ref=this.results_data;for(_i=0,_len=_ref.length;_i<_len;_i++){data=_ref[_i];if(data.group){content+=this.result_add_group(data);}else if(!data.empty){content+=this.result_add_option(data);if(data.selected&&this.is_multiple){this.choice_build(data);}else if(data.selected&&!this.is_multiple){this.selected_item.find("span").text(data.text);}}}
this.show_search_field_default();this.search_field_scale();this.search_results.html(content);return this.parsing=false;};Chosen.prototype.result_add_group=function(group){if(!group.disabled){group.dom_id=this.container_id+"_g_"+group.array_index;return'<li id="'+group.dom_id+'" class="group-result">'+$("<div />").text(group.label).html()+'</li>';}else{return"";}};Chosen.prototype.result_add_option=function(option){var classes;if(!option.disabled){option.dom_id=this.container_id+"_o_"+option.array_index;classes=option.selected&&this.is_multiple?[]:["active-result"];if(option.selected){classes.push("result-selected");}
if(option.group_array_index!=null){classes.push("group-option");}
return'<li id="'+option.dom_id+'" class="'+classes.join(' ')+'">'+option.html+'</li>';}else{return"";}};Chosen.prototype.results_update_field=function(){this.result_clear_highlight();this.result_single_selected=null;return this.results_build();};Chosen.prototype.result_do_highlight=function(el){var high_bottom,high_top,maxHeight,visible_bottom,visible_top;if(el.length){this.result_clear_highlight();this.result_highlight=el;this.result_highlight.addClass("highlighted");maxHeight=parseInt(this.search_results.css("maxHeight"),10);visible_top=this.search_results.scrollTop();visible_bottom=maxHeight+visible_top;high_top=this.result_highlight.position().top+this.search_results.scrollTop();high_bottom=high_top+this.result_highlight.outerHeight();if(high_bottom>=visible_bottom){return this.search_results.scrollTop((high_bottom-maxHeight)>0?high_bottom-maxHeight:0);}else if(high_top<visible_top){return this.search_results.scrollTop(high_top);}}};Chosen.prototype.result_clear_highlight=function(){if(this.result_highlight){this.result_highlight.removeClass("highlighted");}
return this.result_highlight=null;};Chosen.prototype.results_toggle=function(){if(this.results_showing){return this.results_hide();}else{return this.results_show();}};Chosen.prototype.results_show=function(){var dd_top;if(!this.is_multiple){this.selected_item.addClass("chzn-single-with-drop");if(this.result_single_selected){this.result_do_highlight(this.result_single_selected);}}
dd_top=this.is_multiple?this.container.height():this.container.height()-1;this.dropdown.css({"top":dd_top+"px","left":0});this.results_showing=true;this.search_field.focus();this.search_field.val(this.search_field.val());return this.winnow_results();};Chosen.prototype.results_hide=function(){if(!this.is_multiple){this.selected_item.removeClass("chzn-single-with-drop");}
this.result_clear_highlight();this.dropdown.css({"left":"-9000px"});return this.results_showing=false;};Chosen.prototype.set_tab_index=function(el){var ti;if(this.form_field_jq.attr("tabindex")){ti=this.form_field_jq.attr("tabindex");this.form_field_jq.attr("tabindex",-1);if(this.is_multiple){return this.search_field.attr("tabindex",ti);}else{this.selected_item.attr("tabindex",ti);return this.search_field.attr("tabindex",-1);}}};Chosen.prototype.show_search_field_default=function(){if(this.is_multiple&&this.choices<1&&!this.active_field){this.search_field.val(this.default_text);return this.search_field.addClass("default");}else{this.search_field.val("");return this.search_field.removeClass("default");}};Chosen.prototype.search_results_mouseup=function(evt){var target;target=$(evt.target).hasClass("active-result")?$(evt.target):$(evt.target).parents(".active-result").first();if(target.length){this.result_highlight=target;return this.result_select(evt);}};Chosen.prototype.search_results_mouseover=function(evt){var target;target=$(evt.target).hasClass("active-result")?$(evt.target):$(evt.target).parents(".active-result").first();if(target){return this.result_do_highlight(target);}};Chosen.prototype.search_results_mouseout=function(evt){if($(evt.target).hasClass("active-result"||$(evt.target).parents('.active-result').first())){return this.result_clear_highlight();}};Chosen.prototype.choices_click=function(evt){evt.preventDefault();var tgt=$(evt.target);if(this.active_field&&!(tgt.hasClass("search-choice"||tgt.parents('.search-choice').first))&&!this.results_showing&&!(tgt.siblings("a").first().hasClass("search-choice-close"))){return this.results_show();}};Chosen.prototype.choice_build=function(item){var choice_id,link;choice_id=this.container_id+"_c_"+item.array_index;this.choices+=1;this.search_container.before('<li class="search-choice" id="'+choice_id+'"><span>'+item.html+'</span><a href="javascript:void(0)" class="search-choice-close" rel="'+item.array_index+'"></a></li>');link=$('#'+choice_id);return link.click(__bind(function(evt){return this.choice_destroy_link_click(evt);},this));};Chosen.prototype.choice_destroy_link_click=function(evt){evt.preventDefault();this.pending_destroy_click=true;return this.choice_destroy($(evt.target));};Chosen.prototype.choice_destroy=function(link){this.choices-=1;this.show_search_field_default();if(this.is_multiple&&this.choices>0&&this.search_field.val().length<1){this.results_hide();}
var tmp=link.attr("rel");if(typeof tmp==="undefined"){link=link.siblings("a").first();}
this.result_deselect(link.attr("rel"));return link.parents('li').first().remove();};Chosen.prototype.result_select=function(evt){var high,high_id,item,position;if(this.result_highlight){high=this.result_highlight;high_id=high.attr("id");this.result_clear_highlight();high.addClass("result-selected");if(this.is_multiple){this.result_deactivate(high);}else{this.result_single_selected=high;}
position=high_id.substr(high_id.lastIndexOf("_")+1);item=this.results_data[position];item.selected=true;this.form_field.options[item.options_index].selected=true;if(this.is_multiple){this.choice_build(item);}else{this.selected_item.find("span").first().text(item.text);}
if(!(evt.metaKey&&this.is_multiple)){this.results_hide();}
this.search_field.val("");this.form_field_jq.trigger("change");return this.search_field_scale();}};Chosen.prototype.result_activate=function(el){return el.addClass("active-result").show();};Chosen.prototype.result_deactivate=function(el){return el.removeClass("active-result").hide();};Chosen.prototype.result_deselect=function(pos){var result,result_data;result_data=this.results_data[pos];result_data.selected=false;this.form_field.options[result_data.options_index].selected=false;result=$("#"+this.container_id+"_o_"+pos);result.removeClass("result-selected").addClass("active-result").show();this.result_clear_highlight();this.winnow_results();this.form_field_jq.trigger("change");return this.search_field_scale();};Chosen.prototype.results_search=function(evt){if(this.results_showing){return this.winnow_results();}else{return this.results_show();}};Chosen.prototype.winnow_results=function(){var found,option,part,parts,regex,result_id,results,searchText,startTime,startpos,text,zregex,_i,_j,_len,_len2,_ref;startTime=new Date();this.no_results_clear();results=0;searchText=this.search_field.val()===this.default_text?"":$('<div/>').text($.trim(this.search_field.val())).html();regex=new RegExp('^'+searchText.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),'i');zregex=new RegExp(searchText.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),'i');_ref=this.results_data;for(_i=0,_len=_ref.length;_i<_len;_i++){option=_ref[_i];if(!option.disabled&&!option.empty){if(option.group){$('#'+option.dom_id).hide();}else if(!(this.is_multiple&&option.selected)){found=false;result_id=option.dom_id;if(regex.test(option.html)){found=true;results+=1;}else if(option.html.indexOf(" ")>=0||option.html.indexOf("[")===0){parts=option.html.replace(/\[|\]/g,"").split(" ");if(parts.length){for(_j=0,_len2=parts.length;_j<_len2;_j++){part=parts[_j];if(regex.test(part)){found=true;results+=1;}}}}
if(found){if(searchText.length){startpos=option.html.search(zregex);text=option.html.substr(0,startpos+searchText.length)+'</em>'+option.html.substr(startpos+searchText.length);text=text.substr(0,startpos)+'<em>'+text.substr(startpos);}else{text=option.html;}
if($("#"+result_id).html!==text){$("#"+result_id).html(text);}
this.result_activate($("#"+result_id));if(option.group_array_index!=null){$("#"+this.results_data[option.group_array_index].dom_id).show();}}else{if(this.result_highlight&&result_id===this.result_highlight.attr('id')){this.result_clear_highlight();}
this.result_deactivate($("#"+result_id));}}}}
if(results<1&&searchText.length){return this.no_results(searchText);}else{return this.winnow_results_set_highlight();}};Chosen.prototype.winnow_results_clear=function(){var li,lis,_i,_len,_results;this.search_field.val("");lis=this.search_results.find("li");_results=[];for(_i=0,_len=lis.length;_i<_len;_i++){li=lis[_i];li=$(li);_results.push(li.hasClass("group-result")?li.show():!this.is_multiple||!li.hasClass("result-selected")?this.result_activate(li):void 0);}
return _results;};Chosen.prototype.winnow_results_set_highlight=function(){var do_high,selected_results;if(!this.result_highlight){selected_results=!this.is_multiple?this.search_results.find(".result-selected"):[];do_high=selected_results.length?selected_results.first():this.search_results.find(".active-result").first();if(do_high!=null){return this.result_do_highlight(do_high);}}};Chosen.prototype.no_results=function(terms){var no_results_html;no_results_html=$('<li class="no-results">No results match "<span></span>"</li>');no_results_html.find("span").first().html(terms);return this.search_results.append(no_results_html);};Chosen.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove();};Chosen.prototype.keydown_arrow=function(){var first_active,next_sib;if(!this.result_highlight){first_active=this.search_results.find("li.active-result").first();if(first_active){this.result_do_highlight($(first_active));}}else if(this.results_showing){next_sib=this.result_highlight.nextAll("li.active-result").first();if(next_sib){this.result_do_highlight(next_sib);}}
if(!this.results_showing){return this.results_show();}};Chosen.prototype.keyup_arrow=function(){var prev_sibs;if(!this.results_showing&&!this.is_multiple){return this.results_show();}else if(this.result_highlight){prev_sibs=this.result_highlight.prevAll("li.active-result");if(prev_sibs.length){return this.result_do_highlight(prev_sibs.first());}else{if(this.choices>0){this.results_hide();}
return this.result_clear_highlight();}}};Chosen.prototype.keydown_backstroke=function(){if(this.pending_backstroke){this.choice_destroy(this.pending_backstroke.find("a").first());return this.clear_backstroke();}else{this.pending_backstroke=this.search_container.siblings("li.search-choice").last();return this.pending_backstroke.addClass("search-choice-focus");}};Chosen.prototype.clear_backstroke=function(){if(this.pending_backstroke){this.pending_backstroke.removeClass("search-choice-focus");}
return this.pending_backstroke=null;};Chosen.prototype.keyup_checker=function(evt){var stroke,_ref;stroke=(_ref=evt.which)!=null?_ref:evt.keyCode;this.search_field_scale();switch(stroke){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices>0){return this.keydown_backstroke();}else if(!this.pending_backstroke){this.result_clear_highlight();return this.results_search();}
break;case 13:evt.preventDefault();if(this.results_showing){return this.result_select(evt);}
break;case 27:if(this.results_showing){return this.results_hide();}
break;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search();}};Chosen.prototype.keydown_checker=function(evt){var stroke,_ref;stroke=(_ref=evt.which)!=null?_ref:evt.keyCode;this.search_field_scale();if(stroke!==8&&this.pending_backstroke){this.clear_backstroke();}
switch(stroke){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.mouse_on_container=false;break;case 13:evt.preventDefault();break;case 38:evt.preventDefault();this.keyup_arrow();break;case 40:this.keydown_arrow();break;}};Chosen.prototype.search_field_scale=function(){var dd_top,div,h,style,style_block,styles,w,_i,_len;if(this.is_multiple){h=0;w=0;style_block="position:absolute; left: -1000px; top: -1000px; display:none;";styles=['font-size','font-style','font-weight','font-family','line-height','text-transform','letter-spacing'];for(_i=0,_len=styles.length;_i<_len;_i++){style=styles[_i];style_block+=style+":"+this.search_field.css(style)+";";}
div=$('<div />',{'style':style_block});div.text(this.search_field.val());$('body').append(div);w=div.width()+25;div.remove();if(w>this.f_width-10){w=this.f_width-10;}
this.search_field.css({'width':w+'px'});dd_top=this.container.height();return this.dropdown.css({"top":dd_top+"px"});}};Chosen.prototype.generate_field_id=function(){var new_id;new_id=this.generate_random_id();this.form_field.id=new_id;return new_id;};Chosen.prototype.generate_random_id=function(){var string;string="sel"+this.generate_random_char()+this.generate_random_char()+this.generate_random_char();while($("#"+string).length>0){string+=this.generate_random_char();}
return string;};Chosen.prototype.generate_random_char=function(){var chars,newchar,rand;chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";rand=Math.floor(Math.random()*chars.length);return newchar=chars.substring(rand,rand+1);};return Chosen;})();get_side_border_padding=function(elmt){var side_border_padding;return side_border_padding=elmt.outerWidth()-elmt.width();};root.get_side_border_padding=get_side_border_padding;}).call(this);(function(){var SelectParser;SelectParser=(function(){function SelectParser(){this.options_index=0;this.parsed=[];}
SelectParser.prototype.add_node=function(child){if(child.nodeName==="OPTGROUP"){return this.add_group(child);}else{return this.add_option(child);}};SelectParser.prototype.add_group=function(group){var group_position,option,_i,_len,_ref,_results;group_position=this.parsed.length;this.parsed.push({array_index:group_position,group:true,label:group.label,children:0,disabled:group.disabled});_ref=group.childNodes;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){option=_ref[_i];_results.push(this.add_option(option,group_position,group.disabled));}
return _results;};SelectParser.prototype.add_option=function(option,group_position,group_disabled){if(option.nodeName==="OPTION"){if(option.text!==""){if(group_position!=null){this.parsed[group_position].children+=1;}
this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:option.value,text:option.text,html:option.innerHTML,selected:option.selected,disabled:group_disabled===true?group_disabled:option.disabled,group_array_index:group_position});}else{this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:true});}
return this.options_index+=1;}};return SelectParser;})();SelectParser.select_to_array=function(select){var child,parser,_i,_len,_ref;parser=new SelectParser();_ref=select.childNodes;for(_i=0,_len=_ref.length;_i<_len;_i++){child=_ref[_i];parser.add_node(child);}
return parser.parsed;};this.SelectParser=SelectParser;}).call(this);(function($,undefined){var multiselectID=0;$.widget("ech.multiselect",{options:{header:true,height:175,minWidth:225,classes:'',checkAllText:'Marcar tudo',uncheckAllText:'Desmarcar tudo',noneSelectedText:'Selecione',selectedText:'# Selecionado(s)',selectedList:0,show:'',hide:'',autoOpen:false,multiple:true,position:{}},_create:function(){var el=this.element.hide(),o=this.options;this.speed=$.fx.speeds._default;this._isOpen=false;var
button=(this.button=$('<button type="button"><span class="ui-icon ui-icon-triangle-2-n-s"></span></button>')).addClass('ui-multiselect ui-widget ui-state-default ui-corner-all').addClass(o.classes).attr({'title':el.attr('title'),'aria-haspopup':true,'tabIndex':el.attr('tabIndex')}).insertAfter(el),buttonlabel=(this.buttonlabel=$('<span />')).html(o.noneSelectedText).appendTo(button),menu=(this.menu=$('<div />')).addClass('ui-multiselect-menu ui-widget ui-widget-content ui-corner-all').addClass(o.classes).appendTo(document.body),header=(this.header=$('<div />')).addClass('ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix').appendTo(menu),headerLinkContainer=(this.headerLinkContainer=$('<ul />')).addClass('ui-helper-reset').html(function(){if(o.header===true){return'<li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"></span><span>'+o.checkAllText+'</span></a></li><li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"></span><span>'+o.uncheckAllText+'</span></a></li>';}else if(typeof o.header==="string"){return'<li>'+o.header+'</li>';}else{return'';}}).append('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon ui-icon-circle-close"></span></a></li>').appendTo(header),checkboxContainer=(this.checkboxContainer=$('<ul />')).addClass('ui-multiselect-checkboxes ui-helper-reset').appendTo(menu);this._bindEvents();this.refresh(true);if(!o.multiple){menu.addClass('ui-multiselect-single');}},_init:function(){if(this.options.header===false){this.header.hide();}
if(!this.options.multiple){this.headerLinkContainer.find('.ui-multiselect-all, .ui-multiselect-none').hide();}
if(this.options.autoOpen){this.open();}
if(this.element.is(':disabled')){this.disable();}},refresh:function(init){var el=this.element,o=this.options,menu=this.menu,checkboxContainer=this.checkboxContainer,optgroups=[],html=[],id=el.attr('id')||multiselectID++;el.find('option').each(function(i){var $this=$(this),parent=this.parentNode,title=this.innerHTML,description=this.title,value=this.value,inputID=this.id||'ui-multiselect-'+id+'-option-'+i,isDisabled=this.disabled,isSelected=this.selected,labelClasses=['ui-corner-all'],optLabel;if(parent.tagName.toLowerCase()==='optgroup'){optLabel=parent.getAttribute('label');if($.inArray(optLabel,optgroups)===-1){html.push('<li class="ui-multiselect-optgroup-label"><a href="#">'+optLabel+'</a></li>');optgroups.push(optLabel);}}
if(isDisabled){labelClasses.push('ui-state-disabled');}
if(isSelected&&!o.multiple){labelClasses.push('ui-state-active');}
html.push('<li class="'+(isDisabled?'ui-multiselect-disabled':'')+'">');html.push('<label for="'+inputID+'" title="'+description+'" class="'+labelClasses.join(' ')+'">');html.push('<input id="'+inputID+'" name="multiselect_'+id+'" type="'+(o.multiple?"checkbox":"radio")+'" value="'+value+'" title="'+title+'"');if(isSelected){html.push(' checked="checked"');html.push(' aria-selected="true"');}
if(isDisabled){html.push(' disabled="disabled"');html.push(' aria-disabled="true"');}
html.push(' /><span>'+title+'</span></label></li>');});checkboxContainer.html(html.join(''));this.labels=menu.find('label');this._setButtonWidth();this._setMenuWidth();this.button[0].defaultValue=this.update();if(!init){this._trigger('refresh');}},update:function(){var o=this.options,$inputs=this.labels.find('input'),$checked=$inputs.filter('[checked]'),numChecked=$checked.length,value;if(numChecked===0){value=o.noneSelectedText;}else{if($.isFunction(o.selectedText)){value=o.selectedText.call(this,numChecked,$inputs.length,$checked.get());}else if(/\d/.test(o.selectedList)&&o.selectedList>0&&numChecked<=o.selectedList){value=$checked.map(function(){return $(this).next().text();}).get().join(', ');}else{value=o.selectedText.replace('#',numChecked).replace('#',$inputs.length);}}
this.buttonlabel.html(value);return value;},_bindEvents:function(){var self=this,button=this.button;function clickHandler(){self[self._isOpen?'close':'open']();return false;}
button.find('span').bind('click.multiselect',clickHandler);button.bind({click:clickHandler,keypress:function(e){switch(e.which){case 27:case 38:case 37:self.close();break;case 39:case 40:self.open();break;}},mouseenter:function(){if(!button.hasClass('ui-state-disabled')){$(this).addClass('ui-state-hover');}},mouseleave:function(){$(this).removeClass('ui-state-hover');},focus:function(){if(!button.hasClass('ui-state-disabled')){$(this).addClass('ui-state-focus');}},blur:function(){$(this).removeClass('ui-state-focus');}});this.header.delegate('a','click.multiselect',function(e){if($(this).hasClass('ui-multiselect-close')){self.close();}else{self[$(this).hasClass('ui-multiselect-all')?'checkAll':'uncheckAll']();}
e.preventDefault();});this.menu.delegate('li.ui-multiselect-optgroup-label a','click.multiselect',function(e){e.preventDefault();var $this=$(this),$inputs=$this.parent().nextUntil('li.ui-multiselect-optgroup-label').find('input:visible:not(:disabled)'),nodes=$inputs.get(),label=$this.parent().text();if(self._trigger('beforeoptgrouptoggle',e,{inputs:nodes,label:label})===false){return;}
self._toggleChecked($inputs.filter('[checked]').length!==$inputs.length,$inputs);self._trigger('optgrouptoggle',e,{inputs:nodes,label:label,checked:nodes[0].checked});}).delegate('label','mouseenter.multiselect',function(){if(!$(this).hasClass('ui-state-disabled')){self.labels.removeClass('ui-state-hover');$(this).addClass('ui-state-hover').find('input').focus();}}).delegate('label','keydown.multiselect',function(e){e.preventDefault();switch(e.which){case 9:case 27:self.close();break;case 38:case 40:case 37:case 39:self._traverse(e.which,this);break;case 13:$(this).find('input')[0].click();break;}}).delegate('input[type="checkbox"], input[type="radio"]','click.multiselect',function(e){var $this=$(this),val=this.value,checked=this.checked,tags=self.element.find('option');if(this.disabled||self._trigger('click',e,{value:val,text:this.title,checked:checked})===false){e.preventDefault();return;}
$this.focus();$this.attr('aria-selected',checked);tags.each(function(){if(this.value===val){this.selected=checked;}else if(!self.options.multiple){this.selected=false;}});if(!self.options.multiple){self.labels.removeClass('ui-state-active');$this.closest('label').toggleClass('ui-state-active',checked);self.close();}
self.element.trigger("change");setTimeout($.proxy(self.update,self),10);});$(document).bind('mousedown.multiselect',function(e){if(self._isOpen&&!$.contains(self.menu[0],e.target)&&!$.contains(self.button[0],e.target)&&e.target!==self.button[0]){self.close();}});$(this.element[0].form).bind('reset.multiselect',function(){setTimeout($.proxy(self.refresh,self),10);});},_setButtonWidth:function(){var width=this.element.outerWidth(),o=this.options;if(/\d/.test(o.minWidth)&&width<o.minWidth){width=o.minWidth;}
this.button.width(width);},_setMenuWidth:function(){var m=this.menu,width=this.button.outerWidth()-
parseInt(m.css('padding-left'),10)-
parseInt(m.css('padding-right'),10)-
parseInt(m.css('border-right-width'),10)-
parseInt(m.css('border-left-width'),10);m.width(width||this.button.outerWidth());},_traverse:function(which,start){var $start=$(start),moveToLast=which===38||which===37,$next=$start.parent()[moveToLast?'prevAll':'nextAll']('li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)')[moveToLast?'last':'first']();if(!$next.length){var $container=this.menu.find('ul').last();this.menu.find('label')[moveToLast?'last':'first']().trigger('mouseover');$container.scrollTop(moveToLast?$container.height():0);}else{$next.find('label').trigger('mouseover');}},_toggleState:function(prop,flag){return function(){if(!this.disabled){this[prop]=flag;}
if(flag){this.setAttribute('aria-selected',true);}else{this.removeAttribute('aria-selected');}};},_toggleChecked:function(flag,group){var $inputs=(group&&group.length)?group:this.labels.find('input'),self=this;$inputs.each(this._toggleState('checked',flag));$inputs.eq(0).focus();this.update();var values=$inputs.map(function(){return this.value;}).get();this.element.find('option').each(function(){if(!this.disabled&&$.inArray(this.value,values)>-1){self._toggleState('selected',flag).call(this);}});if($inputs.length){this.element.trigger("change");}},_toggleDisabled:function(flag){this.button.attr({'disabled':flag,'aria-disabled':flag})[flag?'addClass':'removeClass']('ui-state-disabled');this.menu.find('input').attr({'disabled':flag,'aria-disabled':flag}).parent()[flag?'addClass':'removeClass']('ui-state-disabled');this.element.attr({'disabled':flag,'aria-disabled':flag});},open:function(e){var self=this,button=this.button,menu=this.menu,speed=this.speed,o=this.options;if(this._trigger('beforeopen')===false||button.hasClass('ui-state-disabled')||this._isOpen){return;}
var $container=menu.find('ul').last(),effect=o.show,pos=button.offset();if($.isArray(o.show)){effect=o.show[0];speed=o.show[1]||self.speed;}
$container.scrollTop(0).height(o.height);if($.ui.position&&!$.isEmptyObject(o.position)){o.position.of=o.position.of||button;menu.show().position(o.position).hide().show(effect,speed);}else{menu.css({top:pos.top+button.outerHeight(),left:pos.left}).show(effect,speed);}
this.labels.eq(0).trigger('mouseover').trigger('mouseenter').find('input').trigger('focus');button.addClass('ui-state-active');this._isOpen=true;this._trigger('open');},close:function(){if(this._trigger('beforeclose')===false){return;}
var o=this.options,effect=o.hide,speed=this.speed;if($.isArray(o.hide)){effect=o.hide[0];speed=o.hide[1]||this.speed;}
this.menu.hide(effect,speed);this.button.removeClass('ui-state-active').trigger('blur').trigger('mouseleave');this._isOpen=false;this._trigger('close');},enable:function(){this._toggleDisabled(false);},disable:function(){this._toggleDisabled(true);},checkAll:function(e){this._toggleChecked(true);this._trigger('checkAll');},uncheckAll:function(){this._toggleChecked(false);this._trigger('uncheckAll');},getChecked:function(){return this.menu.find('input').filter('[checked]');},destroy:function(){$.Widget.prototype.destroy.call(this);this.button.remove();this.menu.remove();this.element.show();return this;},isOpen:function(){return this._isOpen;},widget:function(){return this.menu;},_setOption:function(key,value){var menu=this.menu;switch(key){case'header':menu.find('div.ui-multiselect-header')[value?'show':'hide']();break;case'checkAllText':menu.find('a.ui-multiselect-all span').eq(-1).text(value);break;case'uncheckAllText':menu.find('a.ui-multiselect-none span').eq(-1).text(value);break;case'height':menu.find('ul').last().height(parseInt(value,10));break;case'minWidth':this.options[key]=parseInt(value,10);this._setButtonWidth();this._setMenuWidth();break;case'selectedText':case'selectedList':case'noneSelectedText':this.options[key]=value;this.update();break;case'classes':menu.add(this.button).removeClass(this.options.classes).addClass(value);break;}
$.Widget.prototype._setOption.apply(this,arguments);}});})(jQuery);