
var AjaxRequestComponent=BaseComponent.extend({visible:false,update:function(){this.executeRequest(this);},parseXML:function(sText){if(!sText){return null;}
var xmlDoc;try{parser=new DOMParser();xmlDoc=parser.parseFromString(sText,"text/xml");return xmlDoc;}catch(e){try{xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(sText);return xmlDoc;}catch(e){}}
alert('XML is invalid or no XML parser found');return null;},executeRequest:function(object){var myself=this;var url=object.url;var ajaxRequestType=object.ajaxRequestType;var params=object.parameters;var asyncCall=object.asyncCall;if(url==undefined){Dashboards.log("Fatal - No url passed","error");return;}
if(ajaxRequestType==undefined){ajaxRequestType="json";}
if(params!=undefined){var containsTime=false;for(var i=0;i<params.length;i++){var value;if(params[i][0]=='time'){value=new Date().getTime();containsTime=true;}
else value=Dashboards.getParameterValue(params[i][0]);params[i][1]=value;}
containsTime?params.push(['time',new Date().getTime()]):0;params=Dashboards.propertiesArrayToObject(params);}else{params={};}
if(asyncCall==undefined)asyncCall=true;$.ajax({url:url,type:"GET",dataType:ajaxRequestType,async:asyncCall,data:params,complete:function(XMLHttpRequest,textStatus){var values=XMLHttpRequest.responseText;var changedValues=undefined;if(values==undefined){Dashboards.log("Found error: Empty Data");return;}
if(this.dataType=="xml"||this.dataType=="html"){var xmlDoc;try{parser=new DOMParser();xmlDoc=parser.parseFromString(values,"text/xml");}catch(e){try{xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(values);values=xmlDoc;}catch(e){Dashboards.log('XML is invalid or no XML parser found');}}
values=xmlDoc;var nodeList=values.getElementsByTagName('return');if(nodeList.length>0&&nodeList[0].firstChild){values=nodeList[0].firstChild.nodeValue;}
else return;values=$.parseJSON(values);}else if(this.dataType=="json"){values=$.parseJSON(values);}else if(this.dataType!="script"&&this.dataType!="text"){Dashboards.log("Found error: Unknown returned format");return;}
if((typeof(object.postFetch)=='function')){changedValues=object.postFetch(values);}
if(changedValues!=undefined){values=changedValues;}
if(object.resultvar!=undefined){Dashboards.setParameter(object.resultvar,values);}},error:function(XMLHttpRequest,textStatus,errorThrown){Dashboards.log("Found error: "+XMLHttpRequest+" - "+textStatus+", Error: "+errorThrown,"error");}});}});var BogusComponent=BaseComponent.extend({update:function(){if(this.parameters==undefined){this.parameters=[];}
$("#"+this.htmlObject).empty();var myself=this;this.customfunction(this.parameters);}});if(typeof pv=='undefined'||typeof pv.listenForPageLoad=='undefined'){window.pv={};pv.renderer=function(){return(typeof window.svgweb==="undefined")?"nativesvg":"svgweb";};pv.listenForPageLoad=function(listener){if(document.readyState==="complete"){listener();}
if(pv.renderer()=="svgweb"){window.addEventListener("SVGLoad",listener,false);}else{if(document.addEventListener){window.addEventListener("load",listener,false);}else if(document.attachEvent){window.attachEvent("onload",listener);}}};}
var CggComponent=BaseComponent.extend({ph:null,relComp:null,update:function(){var url='../cgg/draw',data=this.processParams(),script=this.resourceFile,myself=this,ph=$('#'+myself.htmlObject);pv.listenForPageLoad(function(){$.ajax({url:url,data:data,success:function(xmlData){ph.empty();try{ph[0].appendChild(document.importNode(xmlData.lastChild,true));ph.find("svg").width(myself.width).height(myself.height);}catch(e){var obj=myself.createObj(url,script,data,myself.width,myself.height);ph[0].innerHTML=arguments[2].responseText;ph.find("svg").width(myself.width).height(myself.height);}},error:function(){ph.empty();var obj=myself.createObj(url,script,data,myself.width,myself.height,true);svgweb.appendChild(obj,ph[0]);}});});},processParams:function(){var data={};for(var i=0;i<this.parameters.length;i++){var param=this.parameters[i];data["param"+param[0]]=Dashboards.getParameterValue(param[1]);}
data.script=escape(this.resourceFile);data.outputType='svg';return data;},objectUrl:function(baseUrl,script,params){var objUrl=baseUrl+'?',pArray=[];for(var p in params){if(params.hasOwnProperty(p)){pArray.push(escape(p)+'='+escape(params[p]));}}
objUrl+='&'+pArray.join('&');return objUrl;},createObj:function(url,script,data,width,height,svgweb){var obj=(svgweb?document.createElement('object',true):document.createElement('object'));obj.setAttribute('type','image/svg+xml');obj.setAttribute('data',this.objectUrl(url,script,data));obj.setAttribute('width',width);obj.setAttribute('height',height);return obj;}});CggDialComponent=CggComponent.extend({script:"system/pentaho-cdf-dd/resources/custom/components/cgg/charts/dial.js",processParams:function(){var data={paramvalue:Dashboards.getParameterValue(this.parameter),paramcolors:this.colors,paramscale:this.intervals};data.script=escape(this.script);data.outputType='svg';return data;}});if(typeof pv=='undefined'||typeof pv.listenForPageLoad=='undefined'){window.pv={};pv.renderer=function(){return(typeof window.svgweb==="undefined")?"nativesvg":"svgweb";};pv.listenForPageLoad=function(listener){if(document.readyState==="complete"){listener();}
if(pv.renderer()=="svgweb"){window.addEventListener("SVGLoad",listener,false);}else{if(document.addEventListener){window.addEventListener("load",listener,false);}else if(document.attachEvent){window.attachEvent("onload",listener);}}};}
var CggComponent=BaseComponent.extend({ph:null,relComp:null,update:function(){var url='../cgg/draw',data=this.processParams(),script=this.resourceFile,myself=this,ph=$('#'+myself.htmlObject);pv.listenForPageLoad(function(){$.ajax({url:url,data:data,success:function(xmlData){ph.empty();try{ph[0].appendChild(document.importNode(xmlData.lastChild,true));ph.find("svg").width(myself.width).height(myself.height);}catch(e){var obj=myself.createObj(url,script,data,myself.width,myself.height);ph[0].innerHTML=arguments[2].responseText;ph.find("svg").width(myself.width).height(myself.height);}},error:function(){ph.empty();var obj=myself.createObj(url,script,data,myself.width,myself.height,true);svgweb.appendChild(obj,ph[0]);}});});},processParams:function(){var data={};for(var i=0;i<this.parameters.length;i++){var param=this.parameters[i];data["param"+param[0]]=Dashboards.getParameterValue(param[1]);}
data.script=escape(this.resourceFile);data.outputType='svg';return data;},objectUrl:function(baseUrl,script,params){var objUrl=baseUrl+'?',pArray=[];for(var p in params){if(params.hasOwnProperty(p)){pArray.push(escape(p)+'='+escape(params[p]));}}
objUrl+='&'+pArray.join('&');return objUrl;},createObj:function(url,script,data,width,height,svgweb){var obj=(svgweb?document.createElement('object',true):document.createElement('object'));obj.setAttribute('type','image/svg+xml');obj.setAttribute('data',this.objectUrl(url,script,data));obj.setAttribute('width',width);obj.setAttribute('height',height);return obj;}});CggDialComponent=CggComponent.extend({script:"system/pentaho-cdf-dd/resources/custom/components/cgg/charts/dial.js",processParams:function(){var data={paramvalue:Dashboards.getParameterValue(this.parameter),paramcolors:this.colors,paramscale:this.intervals};data.script=escape(this.script);data.outputType='svg';return data;}});var DuplicateComponent=BaseComponent.extend({update:function(){var ph=$("#"+this.htmlObject).empty(),myself=this,link=$("<a href='javascript:;'>Duplicate</a>");link.click(function(){myself.duplicate();});link.appendTo(ph);},duplicate:function(parameterValues){var cdePrefix="render_";parameterValues=parameterValues||{};if(!Dashboards.duplicateIndex){Dashboards.duplicateIndex=0;}
Dashboards.duplicateIndex+=1;var dIdx=Dashboards.duplicateIndex,suffix="_"+dIdx;var params={}
$.each(this.parameters,function(i,p){var param=p+suffix;Dashboards.setBookmarkable(param,Dashboards.isBookmarkable(p));Dashboards.setParameter(param,parameterValues[p]||Dashboards.getParameterValue(p));params[p]=param;});var comps={}
$.each(this.components,function(i,c){var comp=c+suffix;comps[c]=comp;});var htmlRemap={};htmlRemap[this.targetHtmlObject]=(this.targetHtmlObject+suffix).replace(/([^\\])\$/g,'$1\\$');var newPh=$("#"+this.targetHtmlObject).clone();newPh.attr("id",newPh.attr("id")+suffix);newPh.find("[id]").each(function(i,e){$e=$(e);$e.attr("id",$e.attr("id")+suffix);});if(this.targetContainer){newPh.appendTo('#'+this.targetContainer);}else{newPh.insertAfter("#"+this.targetHtmlObject);}
for(c in this.components){var cName=this.components[c];cName=RegExp("^"+cdePrefix).test(cName)?cName:cdePrefix+cName;var component=Dashboards.getComponent(cName);if(component){htmlRemap[component.htmlObject]=(component.htmlObject+suffix).replace(/([^\\])\$/g,'$1\\$');var clone=component.clone(params,comps,htmlRemap);clone.name=clone.name+suffix;window[clone.name]=clone;Dashboards.addComponents([clone]);Dashboards.update(clone);}}},clone:function(parameterRemap,componentRemap,htmlRemap){var that=this.base(parameterRemap,componentRemap,htmlRemap);that.targetHtmlObject=htmlRemap[that.targetHtmlObject];if(that.parameters){that.parameters=that.parameters.map(function(param){if(param in parameterRemap){return parameterRemap[param];}else{return param;}});}
return that;}});var ExportButtonComponent=BaseComponent.extend({ph:undefined,tc:undefined,update:function(){var myself=this;$.extend(this.options,this);myself.ph=$("#"+myself.htmlObject);myself.ph.empty();var bar=$('<span class="exportButton"></span>').appendTo(myself.ph);var componentName=(myself.componentName.indexOf("render_")==0?"":"render_")+myself.componentName;var comp=Dashboards.getComponentByName(componentName);var overrideParameters=Dashboards.propertiesArrayToObject(myself.parameters);bar.text(this.label).click(function(){component.query.exportData(myself.outputType,overrideParameters);});}});(function($){$.ga={};$.ga.load=function(uid,callback){jQuery.ajax({type:'GET',url:(document.location.protocol=="https:"?"https://ssl":"http://www")+'.google-analytics.com/ga.js',cache:true,success:function(){if(typeof _gat==undefined){throw"_gat has not been defined";}t=_gat._createTracker(uid);bind();if($.isFunction(callback)){callback(t)}t._trackPageview()},dataType:'script',data:null})};var t;var bind=function(){if(noT()){throw"pageTracker has not been defined";}for(var $1 in t){if($1.charAt(0)!='_')continue;$.ga[$1.substr(1)]=t[$1]}};var noT=function(){return t==undefined}})(jQuery);var googleAnalyticsComponent=BaseComponent.extend({update:function(){jQuery.globalEval('$(document).ready( function() { $.ga.load("'+this.gaTrackingId+'"); } );');}});var MobileNavComponent=BaseComponent.extend({update:function(){}});var loadGoogleMaps=(function($){var now=$.now(),promise;return function(version,apiKey){if(promise){return promise;}
var deferred=$.Deferred(),resolve=function(){deferred.resolve(window.google&&google.maps?google.maps:false);},callbackName="loadGoogleMaps_"+(now++),params;if(window.google&&google.maps){resolve();}else if(window.google&&google.load){google.load("maps",version||3,{"other_params":"sensor=false","callback":resolve});}else{params=$.extend({'v':version||3,'sensor':false,'callback':callbackName},apiKey?{"key":apiKey}:{});window[callbackName]=function(){resolve();setTimeout(function(){try{delete window[callbackName];}catch(e){}},20);};$.ajax({dataType:'script',data:params,url:'http://maps.googleapis.com/maps/api/js'});}
promise=deferred.promise();return promise;};}(jQuery));(function(){var geonames={name:"geonames",label:"GeoNames",defaults:{},implementation:function(tgt,st,opt){var location;var name=st.address;var featureClass;if(!name){if(st.city){name=st.city;featureClass='P';}else if(st.county){name=st.county;featureClass='A';}else if(st.region){name=st.region;featureClass='A';}else if(st.state){name=st.state;featureClass='A';}else if(st.country){name=st.country;featureClass='A';}}
var opts={q:name,maxRows:1,dataType:"json",featureClass:featureClass};var callBackName='GeoNameContinuation'+$.now()+st.position;window[callBackName]=function(result){if(result.geonames&&result.geonames.length>0){location=[parseFloat(result.geonames[0].lng),parseFloat(result.geonames[0].lat)];st.continuationFunction(location);}}
name=name.replace(/&/g,",");var request='http://ws.geonames.org/searchJSON?q='+encodeURIComponent(name)+'&maxRows=1&featureClass='+featureClass+'&callback='+callBackName;var aObj=new JSONscriptRequest(request);aObj.buildScriptTag();aObj.addScriptTag();}};Dashboards.registerAddIn("NewMapComponent","LocationResolver",new AddIn(geonames));var urlMarker={name:"urlMarker",label:"Url Marker",defaults:{defaultUrl:'getResource/system/pentaho-cdf-dd/resources/custom/components/NewMapComponent/images/marker_grey.png'},implementation:function(tgt,st,opt){if(st.url)
return st.url;if(st.position){switch(st.position%5){case 0:return'getResource/system/pentaho-cdf-dd/resources/custom/components/NewMapComponent/images/marker_grey.png';case 1:return'getResource/system/pentaho-cdf-dd/resources/custom/components/NewMapComponent/images/marker_blue.png'
case 2:return'getResource/system/pentaho-cdf-dd/resources/custom/components/NewMapComponent/images/marker_grey02.png';case 3:return'getResource/system/pentaho-cdf-dd/resources/custom/components/NewMapComponent/images/marker_orange.png';case 4:return'getResource/system/pentaho-cdf-dd/resources/custom/components/NewMapComponent/images/marker_purple.png';}}
return opt.defaultUrl;}};Dashboards.registerAddIn("NewMapComponent","MarkerImage",new AddIn(urlMarker));var cggMarker={name:"cggMarker",label:"CGG Marker",defaults:{},implementation:function(tgt,st,opt){var url='../cgg/draw?script='+st.cggGraphName;var width=st.width;var height=st.height;var cggParameters={};if(st.width)cggParameters.width=st.width;if(st.height)cggParameters.height=st.height;for(parameter in st.parameters){cggParameters[parameter]=st.parameters[parameter];}
for(parameter in cggParameters){if(cggParameters[parameter]!==undefined){url+="&param"+parameter+"="+encodeURIComponent(cggParameters[parameter]);}}
return url;}};Dashboards.registerAddIn("NewMapComponent","MarkerImage",new AddIn(cggMarker));})();var NewMapComponent=BaseComponent.extend({ph:undefined,mapEngine:undefined,values:undefined,update:function(){var myself=this;if(this.testData){this.render(this.testData);return;}
if(!myself.queryDefinition){myself.render({});return}
var query=new Query(myself.queryDefinition);query.fetchData(myself.parameters,function(values){var changedValues=undefined;if((typeof(myself.postFetch)=='function')){changedValues=myself.postFetch(values);}
if(changedValues!==undefined){values=changedValues;}
myself.render(values);});},render:function(values){if(this.mapEngineType=='google')
this.mapEngine=new GoogleMapEngine();else
this.mapEngine=new OpenStreetMapEngine();this.values=values;this.mapEngine.init(this);},initCallBack:function(){this.ph=$("#"+this.htmlObject);this.ph.empty();this.mapEngine.renderMap(this.ph[0],this.centerLongitude,this.centerLatitude,this.defaultZoomLevel);this.setupMarkers(this.values);},setupMarkers:function(values){var mapping=this.getMapping(values);if(!values||!values.resultset)
return;var myself=this;$(values.resultset).each(function(i,elt){var location;if(mapping.addressType!='coordinates'){location=myself.getAddressLocation((mapping.address!=undefined?elt[mapping.address]:undefined),mapping.addressType,elt,mapping,i);}else{location=[elt[mapping.longitude],elt[mapping.latitude]];myself.renderMarker(location,elt,mapping,i);}});},renderMarker:function(location,elt,mapping,position){var myself=this;if(location===undefined){Dashboards.log('Unable to get location for address '+elt[mapping.address]+'. Ignoring element.');return true;}
var marker;var description;var markerWidth=myself.markerWidth;if(mapping.markerWidth)
markerWidth=elt[mapping.markerWidth];var markerHeight=myself.markerHeight;if(mapping.markerHeight)
markerHeight=elt[mapping.markerHeight];var defaultMarkers=false;if(mapping.marker)marker=elt[mapping.marker];if(marker==undefined){var st={data:elt,position:position};var addinName=this.markerImageGetter;if(this.markerCggGraph){st.cggGraphName=this.markerCggGraph;st.width=markerWidth;st.height=markerHeight;st.parameters={};$(this.cggGraphParameters).each(function(i,parameter){st.parameters[parameter[0]]=elt[mapping[parameter[1]]];});addinName='cggMarker';}else{st.url=myself.marker;defaultMarkers=myself.marker==undefined;addinName='urlMarker';}
if(!addinName)addinName='urlMarker';var addIn=this.getAddIn("MarkerImage",addinName);marker=addIn.call(this.ph,st,this.getAddInOptions("MarkerImage",addIn.name));}
if(mapping.description)description=elt[mapping.description];var clickFunction=function(data,mapElement){$(myself.popupParameters).each(function(i,eltA){Dashboards.fireChange(eltA[1],data[mapping[eltA[0].toLowerCase()]]);});if(myself.popupContentsDiv||mapping.popupContents){var contents;if(mapping.popupContents)contents=elt[mapping.popupContents];var height=mapping.popupContentsHeight?elt[mapping.popupContentsHeight]:undefined;if(!height)height=myself.popupHeight;var width=mapping.popupContentsWidth?elt[mapping.popupContentsWidth]:undefined;if(!width)width=myself.popupWidth;var borderColor=undefined;if(defaultMarkers){switch(position%5){case 0:borderColor="#394246";break;case 1:borderColor="#11b4eb";break;case 2:borderColor="#7a879a";break;case 3:borderColor="#e35c15";break;case 4:borderColor="#674f73";break;}}
myself.mapEngine.showPopup(data,mapElement,height,width,contents,myself.popupContentsDiv,borderColor);}};Dashboards.log('About to render '+location[0]+' / '+location[1]+' with marker '+marker+' sized '+markerHeight+' / '+markerWidth+'and description '+description);myself.mapEngine.setMarker(location[0],location[1],marker,description,elt,clickFunction,markerWidth,markerHeight);},getAddressLocation:function(address,addressType,data,mapping,position){var addinName=this.locationResolver;if(!addinName)addinName='geonames';var addIn=this.getAddIn("LocationResolver",addinName);target=this.ph;var state={address:address,addressType:addressType,position:position};if(mapping.country!=undefined)state.country=data[mapping.country];if(mapping.city!=undefined)state.city=data[mapping.city];if(mapping.county!=undefined)state.county=data[mapping.county];if(mapping.region!=undefined)state.region=data[mapping.region];if(mapping.state!=undefined)state.state=data[mapping.state];var myself=this;state.continuationFunction=function(location){myself.renderMarker(location,data,mapping,position);}
addIn.call(target,state,this.getAddInOptions("LocationResolver",addIn.name));},getMapping:function(values){var map={};if(!values.metadata||values.metadata.length==0)
return map;$(values.metadata).each(function(i,elt){switch(elt.colName.toLowerCase()){case'latitude':map.addressType='coordinates';map.latitude=i;break;case'longitude':map.addressType='coordinates';map.longitude=i;break;case'description':map.description=i;break;case'marker':map.marker=i;break;case'markerWidth':map.markerWidth=i;break;case'markerHeight':map.markerHeight=i;break;case'popupContents':map.popupContents=i;break;case'popupWidth':map.popupWidth=i;break;case'popupHeight':map.popupHeight=i;break;case'address':if(!map.addressType){map.address=i;map.addressType='address';}
break;default:map[elt.colName.toLowerCase()]=i;break;}});return map;}});var GoogleMapEngine=Base.extend({map:undefined,centered:false,overlays:[],init:function(mapComponent){$.when(loadGoogleMaps(3,API_KEY)).then(function(status){OurMapOverlay.prototype=new google.maps.OverlayView();OurMapOverlay.prototype.onAdd=function(){var div=document.createElement('DIV');div.id='MapOverlay';div.style.position="absolute";if(this.borderColor_){div.style.border='3px solid '+this.borderColor_;}else{div.style.border="none";}
if(this.popupContentDiv_&&this.popupContentDiv_.length>0){$(div).append($('#'+this.popupContentDiv_));}else
div.innerHTML=this.htmlContent_;this.div_=div;var panes=this.getPanes();panes.overlayLayer.appendChild(div);};OurMapOverlay.prototype.draw=function(){var overlayProjection=this.getProjection();var sp=overlayProjection.fromLatLngToDivPixel(this.startPoint_);var div=this.div_;div.style.left=sp.x+'px';div.style.top=(sp.y+30)+'px';div.style.width=this.width_+'px';div.style.height=this.height_+'px';};OurMapOverlay.prototype.onRemove=function(){if(this.popupContentDiv_){}
this.div_.style.display='none';};mapComponent.initCallBack();});},setMarker:function(lon,lat,icon,description,data,clickFunction,markerWidth,markerHeight){var myLatLng=new google.maps.LatLng(lat,lon);var image=new google.maps.MarkerImage(icon,new google.maps.Size(markerWidth,markerHeight),new google.maps.Point(0,0),new google.maps.Point(0,0));var marker=new google.maps.Marker({position:myLatLng,map:this.map,icon:image,title:description});if(clickFunction!==undefined){google.maps.event.addListener(marker,'click',function(){clickFunction(data,marker);});}
if(!this.centered)
this.map.setCenter(myLatLng);},renderMap:function(target,centerLongitude,centerLatitude,zoomLevel){var latlng;if(centerLatitude&&centerLatitude!=''&&centerLongitude&&centerLongitude!=''){latlng=new google.maps.LatLng(centerLatitude,centerLongitude);this.centered=true;}else
latlng=new google.maps.LatLng(38.471,-9.15);if(!zoomLevel)zoomLevel=2;var myOptions={zoom:zoomLevel,center:latlng,mapTypeId:google.maps.MapTypeId.ROADMAP};this.map=new google.maps.Map(target,myOptions);},showPopup:function(data,mapElement,popupHeight,popupWidth,contents,popupContentDiv,borderColor){var overlay=new OurMapOverlay(mapElement.getPosition(),popupWidth,popupHeight,contents,popupContentDiv,this.map,borderColor);$(this.overlays).each(function(i,elt){elt.setMap(null);});this.overlays.push(overlay);}});function OurMapOverlay(startPoint,width,height,htmlContent,popupContentDiv,map,borderColor){this.startPoint_=startPoint;this.width_=width;this.height_=height;this.map_=map;this.htmlContent_=htmlContent;this.popupContentDiv_=popupContentDiv;this.borderColor_=borderColor;this.div_=null;this.setMap(map);}
var OpenStreetMapEngine=Base.extend({map:undefined,markers:undefined,centered:false,useMercator:true,init:function(mapComponent){mapComponent.initCallBack();},showPopup:function(data,mapElement,popupHeight,popupWidth,contents,popupContentDiv,borderColor){var feature=mapElement;if(popupContentDiv&&popupContentDiv.length>0){var div=$('<div>');div.append($('#'+popupContentDiv));contents=div.html();}
var name="featurePopup";if(borderColor!=undefined){name=name+borderColor.substring(1);}
popup=new OpenLayers.Popup.Anchored(name,feature.lonlat,new OpenLayers.Size(popupHeight,popupWidth),contents,null,true,null);feature.popup=popup;popup.feature=feature;$(this.map.popups).each(function(i,elt){elt.hide();});this.map.addPopup(popup);},setMarker:function(lon,lat,icon,description,data,clickFunction,markerWidth,markerHeight){var size=new OpenLayers.Size(markerWidth,markerHeight);var offset=new OpenLayers.Pixel(-(size.w/2),-size.h);var iconObj=new OpenLayers.Icon(icon,size,offset);var marker,feature;if(this.useMercator){marker=new OpenLayers.Marker(lonLatToMercator(new OpenLayers.LonLat(lon,lat)),iconObj);feature=new OpenLayers.Feature(this.markers,lonLatToMercator(new OpenLayers.LonLat(lon,lat)),data);}else{marker=new OpenLayers.Marker(new OpenLayers.LonLat(lon,lat),iconObj);feature=new OpenLayers.Feature(this.markers,new OpenLayers.LonLat(lon,lat),data);}
feature.marker=marker;if(clickFunction!=undefined)
marker.events.register('mousedown',feature,function(evt){clickFunction(data,feature);});this.markers.addMarker(marker);if(!this.centered)
this.map.setCenter(marker.lonlat);},renderMap:function(target,centerLongitude,centerLatitude,zoomLevel){Dashboards.log('Entered renderMap');var useLayerControl=false;var customMap=false;var centerPoint;if(centerLongitude&&centerLongitude!=''&&centerLatitude&&centerLatitude!=''){if(this.useMercator){centerPoint=lonLatToMercator(new OpenLayers.LonLat(centerLongitude,centerLatitude));}else{centerPoint=new OpenLayers.LonLat(centerLongitude,centerLatitude);}}
this.map=new OpenLayers.Map(target,{maxExtent:new OpenLayers.Bounds(-20037508,-20037508,20037508,20037508),numZoomLevels:18,maxResolution:156543,units:'m',projection:"EPSG:41001"});var layer=new OpenLayers.Layer.TMS("OpenStreetMap","http://tile.openstreetmap.org/",{type:'png',getURL:osm_getTileURL,transparent:'true',displayOutsideMaxExtent:true});this.map.addLayer(layer);this.markers=new OpenLayers.Layer.Markers("Markers");this.map.addLayer(this.markers);if(centerPoint){this.map.setCenter(centerPoint);this.centered=true;}else{this.map.setCenter(lonLatToMercator(new OpenLayers.LonLat(-9.15,38.46)));}
if(zoomLevel!='')
this.map.zoomTo(zoomLevel);Dashboards.log('Exited renderMap');}});(function(){var root=this;var previousUnderscore=root._;var breaker={};var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var slice=ArrayProto.slice,unshift=ArrayProto.unshift,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var
nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){return new wrapper(obj);};if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports){exports=module.exports=_;}
exports._=_;}else{root['_']=_;}
_.VERSION='1.3.3';var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null)return;if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context);}else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++){if(i in obj&&iterator.call(context,obj[i],i,obj)===breaker)return;}}else{for(var key in obj){if(_.has(obj,key)){if(iterator.call(context,obj[key],key,obj)===breaker)return;}}}};_.map=_.collect=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeMap&&obj.map===nativeMap)return obj.map(iterator,context);each(obj,function(value,index,list){results[results.length]=iterator.call(context,value,index,list);});if(obj.length===+obj.length)results.length=obj.length;return results;};_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduce&&obj.reduce===nativeReduce){if(context)iterator=_.bind(iterator,context);return initial?obj.reduce(iterator,memo):obj.reduce(iterator);}
each(obj,function(value,index,list){if(!initial){memo=value;initial=true;}else{memo=iterator.call(context,memo,value,index,list);}});if(!initial)throw new TypeError('Reduce of empty array with no initial value');return memo;};_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduceRight&&obj.reduceRight===nativeReduceRight){if(context)iterator=_.bind(iterator,context);return initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);}
var reversed=_.toArray(obj).reverse();if(context&&!initial)iterator=_.bind(iterator,context);return initial?_.reduce(reversed,iterator,memo,context):_.reduce(reversed,iterator);};_.find=_.detect=function(obj,iterator,context){var result;any(obj,function(value,index,list){if(iterator.call(context,value,index,list)){result=value;return true;}});return result;};_.filter=_.select=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeFilter&&obj.filter===nativeFilter)return obj.filter(iterator,context);each(obj,function(value,index,list){if(iterator.call(context,value,index,list))results[results.length]=value;});return results;};_.reject=function(obj,iterator,context){var results=[];if(obj==null)return results;each(obj,function(value,index,list){if(!iterator.call(context,value,index,list))results[results.length]=value;});return results;};_.every=_.all=function(obj,iterator,context){var result=true;if(obj==null)return result;if(nativeEvery&&obj.every===nativeEvery)return obj.every(iterator,context);each(obj,function(value,index,list){if(!(result=result&&iterator.call(context,value,index,list)))return breaker;});return!!result;};var any=_.some=_.any=function(obj,iterator,context){iterator||(iterator=_.identity);var result=false;if(obj==null)return result;if(nativeSome&&obj.some===nativeSome)return obj.some(iterator,context);each(obj,function(value,index,list){if(result||(result=iterator.call(context,value,index,list)))return breaker;});return!!result;};_.include=_.contains=function(obj,target){var found=false;if(obj==null)return found;if(nativeIndexOf&&obj.indexOf===nativeIndexOf)return obj.indexOf(target)!=-1;found=any(obj,function(value){return value===target;});return found;};_.invoke=function(obj,method){var args=slice.call(arguments,2);return _.map(obj,function(value){return(_.isFunction(method)?method||value:value[method]).apply(value,args);});};_.pluck=function(obj,key){return _.map(obj,function(value){return value[key];});};_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0])return Math.max.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return-Infinity;var result={computed:-Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>=result.computed&&(result={value:value,computed:computed});});return result.value;};_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0])return Math.min.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return Infinity;var result={computed:Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed<result.computed&&(result={value:value,computed:computed});});return result.value;};_.shuffle=function(obj){var shuffled=[],rand;each(obj,function(value,index,list){rand=Math.floor(Math.random()*(index+1));shuffled[index]=shuffled[rand];shuffled[rand]=value;});return shuffled;};_.sortBy=function(obj,val,context){var iterator=_.isFunction(val)?val:function(obj){return obj[val];};return _.pluck(_.map(obj,function(value,index,list){return{value:value,criteria:iterator.call(context,value,index,list)};}).sort(function(left,right){var a=left.criteria,b=right.criteria;if(a===void 0)return 1;if(b===void 0)return-1;return a<b?-1:a>b?1:0;}),'value');};_.groupBy=function(obj,val){var result={};var iterator=_.isFunction(val)?val:function(obj){return obj[val];};each(obj,function(value,index){var key=iterator(value,index);(result[key]||(result[key]=[])).push(value);});return result;};_.sortedIndex=function(array,obj,iterator){iterator||(iterator=_.identity);var low=0,high=array.length;while(low<high){var mid=(low+high)>>1;iterator(array[mid])<iterator(obj)?low=mid+1:high=mid;}
return low;};_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(_.isArguments(obj))return slice.call(obj);if(obj.toArray&&_.isFunction(obj.toArray))return obj.toArray();return _.values(obj);};_.size=function(obj){return _.isArray(obj)?obj.length:_.keys(obj).length;};_.first=_.head=_.take=function(array,n,guard){return(n!=null)&&!guard?slice.call(array,0,n):array[0];};_.initial=function(array,n,guard){return slice.call(array,0,array.length-((n==null)||guard?1:n));};_.last=function(array,n,guard){if((n!=null)&&!guard){return slice.call(array,Math.max(array.length-n,0));}else{return array[array.length-1];}};_.rest=_.tail=function(array,index,guard){return slice.call(array,(index==null)||guard?1:index);};_.compact=function(array){return _.filter(array,function(value){return!!value;});};_.flatten=function(array,shallow){return _.reduce(array,function(memo,value){if(_.isArray(value))return memo.concat(shallow?value:_.flatten(value));memo[memo.length]=value;return memo;},[]);};_.without=function(array){return _.difference(array,slice.call(arguments,1));};_.uniq=_.unique=function(array,isSorted,iterator){var initial=iterator?_.map(array,iterator):array;var results=[];if(array.length<3)isSorted=true;_.reduce(initial,function(memo,value,index){if(isSorted?_.last(memo)!==value||!memo.length:!_.include(memo,value)){memo.push(value);results.push(array[index]);}
return memo;},[]);return results;};_.union=function(){return _.uniq(_.flatten(arguments,true));};_.intersection=_.intersect=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.indexOf(other,item)>=0;});});};_.difference=function(array){var rest=_.flatten(slice.call(arguments,1),true);return _.filter(array,function(value){return!_.include(rest,value);});};_.zip=function(){var args=slice.call(arguments);var length=_.max(_.pluck(args,'length'));var results=new Array(length);for(var i=0;i<length;i++)results[i]=_.pluck(args,""+i);return results;};_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i,l;if(isSorted){i=_.sortedIndex(array,item);return array[i]===item?i:-1;}
if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item);for(i=0,l=array.length;i<l;i++)if(i in array&&array[i]===item)return i;return-1;};_.lastIndexOf=function(array,item){if(array==null)return-1;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf)return array.lastIndexOf(item);var i=array.length;while(i--)if(i in array&&array[i]===item)return i;return-1;};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0;}
step=arguments[2]||1;var len=Math.max(Math.ceil((stop-start)/step),0);var idx=0;var range=new Array(len);while(idx<len){range[idx++]=start;start+=step;}
return range;};var ctor=function(){};_.bind=function bind(func,context){var bound,args;if(func.bind===nativeBind&&nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError;args=slice.call(arguments,2);return bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));ctor.prototype=func.prototype;var self=new ctor;var result=func.apply(self,args.concat(slice.call(arguments)));if(Object(result)===result)return result;return self;};};_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(funcs.length==0)funcs=_.functions(obj);each(funcs,function(f){obj[f]=_.bind(obj[f],obj);});return obj;};_.memoize=function(func,hasher){var memo={};hasher||(hasher=_.identity);return function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:(memo[key]=func.apply(this,arguments));};};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args);},wait);};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)));};_.throttle=function(func,wait){var context,args,timeout,throttling,more,result;var whenDone=_.debounce(function(){more=throttling=false;},wait);return function(){context=this;args=arguments;var later=function(){timeout=null;if(more)func.apply(context,args);whenDone();};if(!timeout)timeout=setTimeout(later,wait);if(throttling){more=true;}else{result=func.apply(context,args);}
whenDone();throttling=true;return result;};};_.debounce=function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)func.apply(context,args);};if(immediate&&!timeout)func.apply(context,args);clearTimeout(timeout);timeout=setTimeout(later,wait);};};_.once=function(func){var ran=false,memo;return function(){if(ran)return memo;ran=true;return memo=func.apply(this,arguments);};};_.wrap=function(func,wrapper){return function(){var args=[func].concat(slice.call(arguments,0));return wrapper.apply(this,args);};};_.compose=function(){var funcs=arguments;return function(){var args=arguments;for(var i=funcs.length-1;i>=0;i--){args=[funcs[i].apply(this,args)];}
return args[0];};};_.after=function(times,func){if(times<=0)return func();return function(){if(--times<1){return func.apply(this,arguments);}};};_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError('Invalid object');var keys=[];for(var key in obj)if(_.has(obj,key))keys[keys.length]=key;return keys;};_.values=function(obj){return _.map(obj,_.identity);};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key);}
return names.sort();};_.extend=function(obj){each(slice.call(arguments,1),function(source){for(var prop in source){obj[prop]=source[prop];}});return obj;};_.pick=function(obj){var result={};each(_.flatten(slice.call(arguments,1)),function(key){if(key in obj)result[key]=obj[key];});return result;};_.defaults=function(obj){each(slice.call(arguments,1),function(source){for(var prop in source){if(obj[prop]==null)obj[prop]=source[prop];}});return obj;};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj);};_.tap=function(obj,interceptor){interceptor(obj);return obj;};function eq(a,b,stack){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;if(a._chain)a=a._wrapped;if(b._chain)b=b._wrapped;if(a.isEqual&&_.isFunction(a.isEqual))return a.isEqual(b);if(b.isEqual&&_.isFunction(b.isEqual))return b.isEqual(a);var className=toString.call(a);if(className!=toString.call(b))return false;switch(className){case'[object String]':return a==String(b);case'[object Number]':return a!=+a?b!=+b:(a==0?1/a==1/b:a==+b);case'[object Date]':case'[object Boolean]':return+a==+b;case'[object RegExp]':return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase;}
if(typeof a!='object'||typeof b!='object')return false;var length=stack.length;while(length--){if(stack[length]==a)return true;}
stack.push(a);var size=0,result=true;if(className=='[object Array]'){size=a.length;result=size==b.length;if(result){while(size--){if(!(result=size in a==size in b&&eq(a[size],b[size],stack)))break;}}}else{if('constructor'in a!='constructor'in b||a.constructor!=b.constructor)return false;for(var key in a){if(_.has(a,key)){size++;if(!(result=_.has(b,key)&&eq(a[key],b[key],stack)))break;}}
if(result){for(key in b){if(_.has(b,key)&&!(size--))break;}
result=!size;}}
stack.pop();return result;}
_.isEqual=function(a,b){return eq(a,b,[]);};_.isEmpty=function(obj){if(obj==null)return true;if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(_.has(obj,key))return false;return true;};_.isElement=function(obj){return!!(obj&&obj.nodeType==1);};_.isArray=nativeIsArray||function(obj){return toString.call(obj)=='[object Array]';};_.isObject=function(obj){return obj===Object(obj);};_.isArguments=function(obj){return toString.call(obj)=='[object Arguments]';};if(!_.isArguments(arguments)){_.isArguments=function(obj){return!!(obj&&_.has(obj,'callee'));};}
_.isFunction=function(obj){return toString.call(obj)=='[object Function]';};_.isString=function(obj){return toString.call(obj)=='[object String]';};_.isNumber=function(obj){return toString.call(obj)=='[object Number]';};_.isFinite=function(obj){return _.isNumber(obj)&&isFinite(obj);};_.isNaN=function(obj){return obj!==obj;};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)=='[object Boolean]';};_.isDate=function(obj){return toString.call(obj)=='[object Date]';};_.isRegExp=function(obj){return toString.call(obj)=='[object RegExp]';};_.isNull=function(obj){return obj===null;};_.isUndefined=function(obj){return obj===void 0;};_.has=function(obj,key){return hasOwnProperty.call(obj,key);};_.noConflict=function(){root._=previousUnderscore;return this;};_.identity=function(value){return value;};_.times=function(n,iterator,context){for(var i=0;i<n;i++)iterator.call(context,i);};_.escape=function(string){return(''+string).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#x27;').replace(/\//g,'&#x2F;');};_.result=function(object,property){if(object==null)return null;var value=object[property];return _.isFunction(value)?value.call(object):value;};_.mixin=function(obj){each(_.functions(obj),function(name){addToWrapper(name,_[name]=obj[name]);});};var idCounter=0;_.uniqueId=function(prefix){var id=idCounter++;return prefix?prefix+id:id;};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/.^/;var escapes={'\\':'\\',"'":"'",'r':'\r','n':'\n','t':'\t','u2028':'\u2028','u2029':'\u2029'};for(var p in escapes)escapes[escapes[p]]=p;var escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;var unescaper=/\\(\\|'|r|n|t|u2028|u2029)/g;var unescape=function(code){return code.replace(unescaper,function(match,escape){return escapes[escape];});};_.template=function(text,data,settings){settings=_.defaults(settings||{},_.templateSettings);var source="__p+='"+text.replace(escaper,function(match){return'\\'+escapes[match];}).replace(settings.escape||noMatch,function(match,code){return"'+\n_.escape("+unescape(code)+")+\n'";}).replace(settings.interpolate||noMatch,function(match,code){return"'+\n("+unescape(code)+")+\n'";}).replace(settings.evaluate||noMatch,function(match,code){return"';\n"+unescape(code)+"\n;__p+='";})+"';\n";if(!settings.variable)source='with(obj||{}){\n'+source+'}\n';source="var __p='';"+"var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+
source+"return __p;\n";var render=new Function(settings.variable||'obj','_',source);if(data)return render(data,_);var template=function(data){return render.call(this,data,_);};template.source='function('+(settings.variable||'obj')+'){\n'+
source+'}';return template;};_.chain=function(obj){return _(obj).chain();};var wrapper=function(obj){this._wrapped=obj;};_.prototype=wrapper.prototype;var result=function(obj,chain){return chain?_(obj).chain():obj;};var addToWrapper=function(name,func){wrapper.prototype[name]=function(){var args=slice.call(arguments);unshift.call(args,this._wrapped);return result(func.apply(_,args),this._chain);};};_.mixin(_);each(['pop','push','reverse','shift','sort','splice','unshift'],function(name){var method=ArrayProto[name];wrapper.prototype[name]=function(){var wrapped=this._wrapped;method.apply(wrapped,arguments);var length=wrapped.length;if((name=='shift'||name=='splice')&&length===0)delete wrapped[0];return result(wrapped,this._chain);};});each(['concat','join','slice'],function(name){var method=ArrayProto[name];wrapper.prototype[name]=function(){return result(method.apply(this._wrapped,arguments),this._chain);};});wrapper.prototype.chain=function(){this._chain=true;return this;};wrapper.prototype.value=function(){return this._wrapped;};}).call(this);(function(){var root=this;var previousBackbone=root.Backbone;var slice=Array.prototype.slice;var splice=Array.prototype.splice;var Backbone;if(typeof exports!=='undefined'){Backbone=exports;}else{Backbone=root.Backbone={};}
Backbone.VERSION='0.9.2';var _=root._;if(!_&&(typeof require!=='undefined'))_=require('underscore');var $=root.jQuery||root.Zepto||root.ender;Backbone.setDomLibrary=function(lib){$=lib;};Backbone.noConflict=function(){root.Backbone=previousBackbone;return this;};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var eventSplitter=/\s+/;var Events=Backbone.Events={on:function(events,callback,context){var calls,event,node,tail,list;if(!callback)return this;events=events.split(eventSplitter);calls=this._callbacks||(this._callbacks={});while(event=events.shift()){list=calls[event];node=list?list.tail:{};node.next=tail={};node.context=context;node.callback=callback;calls[event]={tail:tail,next:list?list.next:node};}
return this;},off:function(events,callback,context){var event,calls,node,tail,cb,ctx;if(!(calls=this._callbacks))return;if(!(events||callback||context)){delete this._callbacks;return this;}
events=events?events.split(eventSplitter):_.keys(calls);while(event=events.shift()){node=calls[event];delete calls[event];if(!node||!(callback||context))continue;tail=node.tail;while((node=node.next)!==tail){cb=node.callback;ctx=node.context;if((callback&&cb!==callback)||(context&&ctx!==context)){this.on(event,cb,ctx);}}}
return this;},trigger:function(events){var event,node,calls,tail,args,all,rest;if(!(calls=this._callbacks))return this;all=calls.all;events=events.split(eventSplitter);rest=slice.call(arguments,1);while(event=events.shift()){if(node=calls[event]){tail=node.tail;while((node=node.next)!==tail){node.callback.apply(node.context||this,rest);}}
if(node=all){tail=node.tail;args=[event].concat(rest);while((node=node.next)!==tail){node.callback.apply(node.context||this,args);}}}
return this;}};Events.bind=Events.on;Events.unbind=Events.off;var Model=Backbone.Model=function(attributes,options){var defaults;attributes||(attributes={});if(options&&options.parse)attributes=this.parse(attributes);if(defaults=getValue(this,'defaults')){attributes=_.extend({},defaults,attributes);}
if(options&&options.collection)this.collection=options.collection;this.attributes={};this._escapedAttributes={};this.cid=_.uniqueId('c');this.changed={};this._silent={};this._pending={};this.set(attributes,{silent:true});this.changed={};this._silent={};this._pending={};this._previousAttributes=_.clone(this.attributes);this.initialize.apply(this,arguments);};_.extend(Model.prototype,Events,{changed:null,_silent:null,_pending:null,idAttribute:'id',initialize:function(){},toJSON:function(options){return _.clone(this.attributes);},get:function(attr){return this.attributes[attr];},escape:function(attr){var html;if(html=this._escapedAttributes[attr])return html;var val=this.get(attr);return this._escapedAttributes[attr]=_.escape(val==null?'':''+val);},has:function(attr){return this.get(attr)!=null;},set:function(key,value,options){var attrs,attr,val;if(_.isObject(key)||key==null){attrs=key;options=value;}else{attrs={};attrs[key]=value;}
options||(options={});if(!attrs)return this;if(attrs instanceof Model)attrs=attrs.attributes;if(options.unset)for(attr in attrs)attrs[attr]=void 0;if(!this._validate(attrs,options))return false;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];var changes=options.changes={};var now=this.attributes;var escaped=this._escapedAttributes;var prev=this._previousAttributes||{};for(attr in attrs){val=attrs[attr];if(!_.isEqual(now[attr],val)||(options.unset&&_.has(now,attr))){delete escaped[attr];(options.silent?this._silent:changes)[attr]=true;}
options.unset?delete now[attr]:now[attr]=val;if(!_.isEqual(prev[attr],val)||(_.has(now,attr)!=_.has(prev,attr))){this.changed[attr]=val;if(!options.silent)this._pending[attr]=true;}else{delete this.changed[attr];delete this._pending[attr];}}
if(!options.silent)this.change(options);return this;},unset:function(attr,options){(options||(options={})).unset=true;return this.set(attr,null,options);},clear:function(options){(options||(options={})).unset=true;return this.set(_.clone(this.attributes),options);},fetch:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;options.success=function(resp,status,xhr){if(!model.set(model.parse(resp,xhr),options))return false;if(success)success(model,resp);};options.error=Backbone.wrapError(options.error,model,options);return(this.sync||Backbone.sync).call(this,'read',this,options);},save:function(key,value,options){var attrs,current;if(_.isObject(key)||key==null){attrs=key;options=value;}else{attrs={};attrs[key]=value;}
options=options?_.clone(options):{};if(options.wait){if(!this._validate(attrs,options))return false;current=_.clone(this.attributes);}
var silentOptions=_.extend({},options,{silent:true});if(attrs&&!this.set(attrs,options.wait?silentOptions:options)){return false;}
var model=this;var success=options.success;options.success=function(resp,status,xhr){var serverAttrs=model.parse(resp,xhr);if(options.wait){delete options.wait;serverAttrs=_.extend(attrs||{},serverAttrs);}
if(!model.set(serverAttrs,options))return false;if(success){success(model,resp);}else{model.trigger('sync',model,resp,options);}};options.error=Backbone.wrapError(options.error,model,options);var method=this.isNew()?'create':'update';var xhr=(this.sync||Backbone.sync).call(this,method,this,options);if(options.wait)this.set(current,silentOptions);return xhr;},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var triggerDestroy=function(){model.trigger('destroy',model,model.collection,options);};if(this.isNew()){triggerDestroy();return false;}
options.success=function(resp){if(options.wait)triggerDestroy();if(success){success(model,resp);}else{model.trigger('sync',model,resp,options);}};options.error=Backbone.wrapError(options.error,model,options);var xhr=(this.sync||Backbone.sync).call(this,'delete',this,options);if(!options.wait)triggerDestroy();return xhr;},url:function(){var base=getValue(this,'urlRoot')||getValue(this.collection,'url')||urlError();if(this.isNew())return base;return base+(base.charAt(base.length-1)=='/'?'':'/')+encodeURIComponent(this.id);},parse:function(resp,xhr){return resp;},clone:function(){return new this.constructor(this.attributes);},isNew:function(){return this.id==null;},change:function(options){options||(options={});var changing=this._changing;this._changing=true;for(var attr in this._silent)this._pending[attr]=true;var changes=_.extend({},options.changes,this._silent);this._silent={};for(var attr in changes){this.trigger('change:'+attr,this,this.get(attr),options);}
if(changing)return this;while(!_.isEmpty(this._pending)){this._pending={};this.trigger('change',this,options);for(var attr in this.changed){if(this._pending[attr]||this._silent[attr])continue;delete this.changed[attr];}
this._previousAttributes=_.clone(this.attributes);}
this._changing=false;return this;},hasChanged:function(attr){if(!arguments.length)return!_.isEmpty(this.changed);return _.has(this.changed,attr);},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false,old=this._previousAttributes;for(var attr in diff){if(_.isEqual(old[attr],(val=diff[attr])))continue;(changed||(changed={}))[attr]=val;}
return changed;},previous:function(attr){if(!arguments.length||!this._previousAttributes)return null;return this._previousAttributes[attr];},previousAttributes:function(){return _.clone(this._previousAttributes);},isValid:function(){return!this.validate(this.attributes);},_validate:function(attrs,options){if(options.silent||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validate(attrs,options);if(!error)return true;if(options&&options.error){options.error(this,error,options);}else{this.trigger('error',this,error,options);}
return false;}});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.model)this.model=options.model;if(options.comparator)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,{silent:true,parse:options.parse});};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options);});},add:function(models,options){var i,index,length,model,cid,id,cids={},ids={},dups=[];options||(options={});models=_.isArray(models)?models.slice():[models];for(i=0,length=models.length;i<length;i++){if(!(model=models[i]=this._prepareModel(models[i],options))){throw new Error("Can't add an invalid model to a collection");}
cid=model.cid;id=model.id;if(cids[cid]||this._byCid[cid]||((id!=null)&&(ids[id]||this._byId[id]))){dups.push(i);continue;}
cids[cid]=ids[id]=model;}
i=dups.length;while(i--){models.splice(dups[i],1);}
for(i=0,length=models.length;i<length;i++){(model=models[i]).on('all',this._onModelEvent,this);this._byCid[model.cid]=model;if(model.id!=null)this._byId[model.id]=model;}
this.length+=length;index=options.at!=null?options.at:this.models.length;splice.apply(this.models,[index,0].concat(models));if(this.comparator)this.sort({silent:true});if(options.silent)return this;for(i=0,length=this.models.length;i<length;i++){if(!cids[(model=this.models[i]).cid])continue;options.index=i;model.trigger('add',model,this,options);}
return this;},remove:function(models,options){var i,l,index,model;options||(options={});models=_.isArray(models)?models.slice():[models];for(i=0,l=models.length;i<l;i++){model=this.getByCid(models[i])||this.get(models[i]);if(!model)continue;delete this._byId[model.id];delete this._byCid[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger('remove',model,this,options);}
this._removeReference(model);}
return this;},push:function(model,options){model=this._prepareModel(model,options);this.add(model,options);return model;},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model;},unshift:function(model,options){model=this._prepareModel(model,options);this.add(model,_.extend({at:0},options));return model;},shift:function(options){var model=this.at(0);this.remove(model,options);return model;},get:function(id){if(id==null)return void 0;return this._byId[id.id!=null?id.id:id];},getByCid:function(cid){return cid&&this._byCid[cid.cid||cid];},at:function(index){return this.models[index];},where:function(attrs){if(_.isEmpty(attrs))return[];return this.filter(function(model){for(var key in attrs){if(attrs[key]!==model.get(key))return false;}
return true;});},sort:function(options){options||(options={});if(!this.comparator)throw new Error('Cannot sort a set without a comparator');var boundComparator=_.bind(this.comparator,this);if(this.comparator.length==1){this.models=this.sortBy(boundComparator);}else{this.models.sort(boundComparator);}
if(!options.silent)this.trigger('reset',this,options);return this;},pluck:function(attr){return _.map(this.models,function(model){return model.get(attr);});},reset:function(models,options){models||(models=[]);options||(options={});for(var i=0,l=this.models.length;i<l;i++){this._removeReference(this.models[i]);}
this._reset();this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger('reset',this,options);return this;},fetch:function(options){options=options?_.clone(options):{};if(options.parse===undefined)options.parse=true;var collection=this;var success=options.success;options.success=function(resp,status,xhr){collection[options.add?'add':'reset'](collection.parse(resp,xhr),options);if(success)success(collection,resp);};options.error=Backbone.wrapError(options.error,collection,options);return(this.sync||Backbone.sync).call(this,'read',this,options);},create:function(model,options){var coll=this;options=options?_.clone(options):{};model=this._prepareModel(model,options);if(!model)return false;if(!options.wait)coll.add(model,options);var success=options.success;options.success=function(nextModel,resp,xhr){if(options.wait)coll.add(nextModel,options);if(success){success(nextModel,resp);}else{nextModel.trigger('sync',model,resp,options);}};model.save(null,options);return model;},parse:function(resp,xhr){return resp;},chain:function(){return _(this.models).chain();},_reset:function(options){this.length=0;this.models=[];this._byId={};this._byCid={};},_prepareModel:function(model,options){options||(options={});if(!(model instanceof Model)){var attrs=model;options.collection=this;model=new this.model(attrs,options);if(!model._validate(model.attributes,options))model=false;}else if(!model.collection){model.collection=this;}
return model;},_removeReference:function(model){if(this==model.collection){delete model.collection;}
model.off('all',this._onModelEvent,this);},_onModelEvent:function(event,model,collection,options){if((event=='add'||event=='remove')&&collection!=this)return;if(event=='destroy'){this.remove(model,options);}
if(model&&event==='change:'+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];this._byId[model.id]=model;}
this.trigger.apply(this,arguments);}});var methods=['forEach','each','map','reduce','reduceRight','find','detect','filter','select','reject','every','all','some','any','include','contains','invoke','max','min','sortBy','sortedIndex','toArray','size','first','initial','rest','last','without','indexOf','shuffle','lastIndexOf','isEmpty','groupBy'];_.each(methods,function(method){Collection.prototype[method]=function(){return _[method].apply(_,[this.models].concat(_.toArray(arguments)));};});var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments);};var namedParam=/:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[-[\]{}()+?.,\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){Backbone.history||(Backbone.history=new History);if(!_.isRegExp(route))route=this._routeToRegExp(route);if(!callback)callback=this[name];Backbone.history.route(route,_.bind(function(fragment){var args=this._extractParameters(route,fragment);callback&&callback.apply(this,args);this.trigger.apply(this,['route:'+name].concat(args));Backbone.history.trigger('route',this,name,args);},this));return this;},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);},_bindRoutes:function(){if(!this.routes)return;var routes=[];for(var route in this.routes){routes.unshift([route,this.routes[route]]);}
for(var i=0,l=routes.length;i<l;i++){this.route(routes[i][0],routes[i][1],this[routes[i][1]]);}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,'\\$&').replace(namedParam,'([^\/]+)').replace(splatParam,'(.*?)');return new RegExp('^'+route+'$');},_extractParameters:function(route,fragment){return route.exec(fragment).slice(1);}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,'checkUrl');};var routeStripper=/^[#\/]/;var isExplorer=/msie [\w.]+/;History.started=false;_.extend(History.prototype,Events,{interval:50,getHash:function(windowOverride){var loc=windowOverride?windowOverride.location:window.location;var match=loc.href.match(/#(.*)$/);return match?match[1]:'';},getFragment:function(fragment,forcePushState){if(fragment==null){if(this._hasPushState||forcePushState){fragment=window.location.pathname;var search=window.location.search;if(search)fragment+=search;}else{fragment=this.getHash();}}
if(!fragment.indexOf(this.options.root))fragment=fragment.substr(this.options.root.length);return fragment.replace(routeStripper,'');},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({},{root:'/'},this.options,options);this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var fragment=this.getFragment();var docMode=document.documentMode;var oldIE=(isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7));if(oldIE){this.iframe=$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo('body')[0].contentWindow;this.navigate(fragment);}
if(this._hasPushState){$(window).bind('popstate',this.checkUrl);}else if(this._wantsHashChange&&('onhashchange'in window)&&!oldIE){$(window).bind('hashchange',this.checkUrl);}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval);}
this.fragment=fragment;var loc=window.location;var atRoot=loc.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!atRoot){this.fragment=this.getFragment(null,true);window.location.replace(this.options.root+'#'+this.fragment);return true;}else if(this._wantsPushState&&this._hasPushState&&atRoot&&loc.hash){this.fragment=this.getHash().replace(routeStripper,'');window.history.replaceState({},document.title,loc.protocol+'//'+loc.host+this.options.root+this.fragment);}
if(!this.options.silent){return this.loadUrl();}},stop:function(){$(window).unbind('popstate',this.checkUrl).unbind('hashchange',this.checkUrl);clearInterval(this._checkUrlInterval);History.started=false;},route:function(route,callback){this.handlers.unshift({route:route,callback:callback});},checkUrl:function(e){var current=this.getFragment();if(current==this.fragment&&this.iframe)current=this.getFragment(this.getHash(this.iframe));if(current==this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl()||this.loadUrl(this.getHash());},loadUrl:function(fragmentOverride){var fragment=this.fragment=this.getFragment(fragmentOverride);var matched=_.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true;}});return matched;},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:options};var frag=(fragment||'').replace(routeStripper,'');if(this.fragment==frag)return;if(this._hasPushState){if(frag.indexOf(this.options.root)!=0)frag=this.options.root+frag;this.fragment=frag;window.history[options.replace?'replaceState':'pushState']({},document.title,frag);}else if(this._wantsHashChange){this.fragment=frag;this._updateHash(window.location,frag,options.replace);if(this.iframe&&(frag!=this.getFragment(this.getHash(this.iframe)))){if(!options.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,frag,options.replace);}}else{window.location.assign(this.options.root+fragment);}
if(options.trigger)this.loadUrl(fragment);},_updateHash:function(location,fragment,replace){if(replace){location.replace(location.toString().replace(/(javascript:|#).*$/,'')+'#'+fragment);}else{location.hash=fragment;}}});var View=Backbone.View=function(options){this.cid=_.uniqueId('view');this._configure(options||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents();};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=['model','collection','el','id','attributes','className','tagName'];_.extend(View.prototype,Events,{tagName:'div',$:function(selector){return this.$el.find(selector);},initialize:function(){},render:function(){return this;},remove:function(){this.$el.remove();return this;},make:function(tagName,attributes,content){var el=document.createElement(tagName);if(attributes)$(el).attr(attributes);if(content)$(el).html(content);return el;},setElement:function(element,delegate){if(this.$el)this.undelegateEvents();this.$el=(element instanceof $)?element:$(element);this.el=this.$el[0];if(delegate!==false)this.delegateEvents();return this;},delegateEvents:function(events){if(!(events||(events=getValue(this,'events'))))return;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)throw new Error('Method "'+events[key]+'" does not exist');var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+='.delegateEvents'+this.cid;if(selector===''){this.$el.bind(eventName,method);}else{this.$el.delegate(selector,eventName,method);}}},undelegateEvents:function(){this.$el.unbind('.delegateEvents'+this.cid);},_configure:function(options){if(this.options)options=_.extend({},this.options,options);for(var i=0,l=viewOptions.length;i<l;i++){var attr=viewOptions[i];if(options[attr])this[attr]=options[attr];}
this.options=options;},_ensureElement:function(){if(!this.el){var attrs=getValue(this,'attributes')||{};if(this.id)attrs.id=this.id;if(this.className)attrs['class']=this.className;this.setElement(this.make(this.tagName,attrs),false);}else{this.setElement(this.el,false);}}});var extend=function(protoProps,classProps){var child=inherits(this,protoProps,classProps);child.extend=this.extend;return child;};Model.extend=Collection.extend=Router.extend=View.extend=extend;var methodMap={'create':'POST','update':'PUT','delete':'DELETE','read':'GET'};Backbone.sync=function(method,model,options){var type=methodMap[method];options||(options={});var params={type:type,dataType:'json'};if(!options.url){params.url=getValue(model,'url')||urlError();}
if(!options.data&&model&&(method=='create'||method=='update')){params.contentType='application/json';params.data=JSON.stringify(model.toJSON());}
if(Backbone.emulateJSON){params.contentType='application/x-www-form-urlencoded';params.data=params.data?{model:params.data}:{};}
if(Backbone.emulateHTTP){if(type==='PUT'||type==='DELETE'){if(Backbone.emulateJSON)params.data._method=type;params.type='POST';params.beforeSend=function(xhr){xhr.setRequestHeader('X-HTTP-Method-Override',type);};}}
if(params.type!=='GET'&&!Backbone.emulateJSON){params.processData=false;}
return $.ajax(_.extend(params,options));};Backbone.wrapError=function(onError,originalModel,options){return function(model,resp){resp=model===originalModel?resp:model;if(onError){onError(originalModel,resp,options);}else{originalModel.trigger('error',originalModel,resp,options);}};};var ctor=function(){};var inherits=function(parent,protoProps,staticProps){var child;if(protoProps&&protoProps.hasOwnProperty('constructor')){child=protoProps.constructor;}else{child=function(){parent.apply(this,arguments);};}
_.extend(child,parent);ctor.prototype=parent.prototype;child.prototype=new ctor();if(protoProps)_.extend(child.prototype,protoProps);if(staticProps)_.extend(child,staticProps);child.prototype.constructor=child;child.__super__=parent.prototype;return child;};var getValue=function(object,prop){if(!(object&&object[prop]))return null;return _.isFunction(object[prop])?object[prop]():object[prop];};var urlError=function(){throw new Error('A "url" property or function must be specified');};}).call(this);var Mustache=(typeof module!=="undefined"&&module.exports)||{};(function(exports){exports.name="mustache.js";exports.version="0.5.0-dev";exports.tags=["{{","}}"];exports.parse=parse;exports.compile=compile;exports.render=render;exports.clearCache=clearCache;exports.to_html=function(template,view,partials,send){var result=render(template,view,partials);if(typeof send==="function"){send(result);}else{return result;}};var _toString=Object.prototype.toString;var _isArray=Array.isArray;var _forEach=Array.prototype.forEach;var _trim=String.prototype.trim;var isArray;if(_isArray){isArray=_isArray;}else{isArray=function(obj){return _toString.call(obj)==="[object Array]";};}
var forEach;if(_forEach){forEach=function(obj,callback,scope){return _forEach.call(obj,callback,scope);};}else{forEach=function(obj,callback,scope){for(var i=0,len=obj.length;i<len;++i){callback.call(scope,obj[i],i,obj);}};}
var spaceRe=/^\s*$/;function isWhitespace(string){return spaceRe.test(string);}
var trim;if(_trim){trim=function(string){return string==null?"":_trim.call(string);};}else{var trimLeft,trimRight;if(isWhitespace("\xA0")){trimLeft=/^\s+/;trimRight=/\s+$/;}else{trimLeft=/^[\s\xA0]+/;trimRight=/[\s\xA0]+$/;}
trim=function(string){return string==null?"":String(string).replace(trimLeft,"").replace(trimRight,"");};}
var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':'&quot;',"'":'&#39;'};function escapeHTML(string){return String(string).replace(/&(?!\w+;)|[<>"']/g,function(s){return escapeMap[s]||s;});}
function debug(e,template,line,file){file=file||"<template>";var lines=template.split("\n"),start=Math.max(line-3,0),end=Math.min(lines.length,line+3),context=lines.slice(start,end);var c;for(var i=0,len=context.length;i<len;++i){c=i+start+1;context[i]=(c===line?" >> ":"    ")+context[i];}
e.template=template;e.line=line;e.file=file;e.message=[file+":"+line,context.join("\n"),"",e.message].join("\n");return e;}
function lookup(name,stack,defaultValue){if(name==="."){return stack[stack.length-1];}
var names=name.split(".");var lastIndex=names.length-1;var target=names[lastIndex];var value,context,i=stack.length,j,localStack;while(i){localStack=stack.slice(0);context=stack[--i];j=0;while(j<lastIndex){context=context[names[j++]];if(context==null){break;}
localStack.push(context);}
if(context&&typeof context==="object"&&target in context){value=context[target];break;}}
if(typeof value==="function"){value=value.call(localStack[localStack.length-1]);}
if(value==null){return defaultValue;}
return value;}
function renderSection(name,stack,callback,inverted){var buffer="";var value=lookup(name,stack);if(inverted){if(value==null||value===false||(isArray(value)&&value.length===0)){buffer+=callback();}}else if(isArray(value)){forEach(value,function(value){stack.push(value);buffer+=callback();stack.pop();});}else if(typeof value==="object"){stack.push(value);buffer+=callback();stack.pop();}else if(typeof value==="function"){var scope=stack[stack.length-1];var scopedRender=function(template){return render(template,scope);};buffer+=value.call(scope,callback(),scopedRender)||"";}else if(value){buffer+=callback();}
return buffer;}
function parse(template,options){options=options||{};var tags=options.tags||exports.tags,openTag=tags[0],closeTag=tags[tags.length-1];var code=['var buffer = "";',"\nvar line = 1;","\ntry {",'\nbuffer += "'];var spaces=[],hasTag=false,nonSpace=false;var stripSpace=function(){if(hasTag&&!nonSpace&&!options.space){while(spaces.length){code.splice(spaces.pop(),1);}}else{spaces=[];}
hasTag=false;nonSpace=false;};var sectionStack=[],updateLine,nextOpenTag,nextCloseTag;var setTags=function(source){tags=trim(source).split(/\s+/);nextOpenTag=tags[0];nextCloseTag=tags[tags.length-1];};var includePartial=function(source){code.push('";',updateLine,'\nvar partial = partials["'+trim(source)+'"];','\nif (partial) {','\n  buffer += render(partial,stack[stack.length - 1],partials);','\n}','\nbuffer += "');};var openSection=function(source,inverted){var name=trim(source);if(name===""){throw debug(new Error("Section name may not be empty"),template,line,options.file);}
sectionStack.push({name:name,inverted:inverted});code.push('";',updateLine,'\nvar name = "'+name+'";','\nvar callback = (function () {','\n  return function () {','\n    var buffer = "";','\nbuffer += "');};var openInvertedSection=function(source){openSection(source,true);};var closeSection=function(source){var name=trim(source);var openName=sectionStack.length!=0&&sectionStack[sectionStack.length-1].name;if(!openName||name!=openName){throw debug(new Error('Section named "'+name+'" was never opened'),template,line,options.file);}
var section=sectionStack.pop();code.push('";','\n    return buffer;','\n  };','\n})();');if(section.inverted){code.push("\nbuffer += renderSection(name,stack,callback,true);");}else{code.push("\nbuffer += renderSection(name,stack,callback);");}
code.push('\nbuffer += "');};var sendPlain=function(source){code.push('";',updateLine,'\nbuffer += lookup("'+trim(source)+'",stack,"");','\nbuffer += "');};var sendEscaped=function(source){code.push('";',updateLine,'\nbuffer += escapeHTML(lookup("'+trim(source)+'",stack,""));','\nbuffer += "');};var line=1,c,callback;for(var i=0,len=template.length;i<len;++i){if(template.slice(i,i+openTag.length)===openTag){i+=openTag.length;c=template.substr(i,1);updateLine='\nline = '+line+';';nextOpenTag=openTag;nextCloseTag=closeTag;hasTag=true;switch(c){case"!":i++;callback=null;break;case"=":i++;closeTag="="+closeTag;callback=setTags;break;case">":i++;callback=includePartial;break;case"#":i++;callback=openSection;break;case"^":i++;callback=openInvertedSection;break;case"/":i++;callback=closeSection;break;case"{":closeTag="}"+closeTag;case"&":i++;nonSpace=true;callback=sendPlain;break;default:nonSpace=true;callback=sendEscaped;}
var end=template.indexOf(closeTag,i);if(end===-1){throw debug(new Error('Tag "'+openTag+'" was not closed properly'),template,line,options.file);}
var source=template.substring(i,end);if(callback){callback(source);}
var n=0;while(~(n=source.indexOf("\n",n))){line++;n++;}
i=end+closeTag.length-1;openTag=nextOpenTag;closeTag=nextCloseTag;}else{c=template.substr(i,1);switch(c){case'"':case"\\":nonSpace=true;code.push("\\"+c);break;case"\r":break;case"\n":spaces.push(code.length);code.push("\\n");stripSpace();line++;break;default:if(isWhitespace(c)){spaces.push(code.length);}else{nonSpace=true;}
code.push(c);}}}
if(sectionStack.length!=0){throw debug(new Error('Section "'+sectionStack[sectionStack.length-1].name+'" was not closed properly'),template,line,options.file);}
stripSpace();code.push('";',"\nreturn buffer;","\n} catch (e) { throw {error: e, line: line}; }");var body=code.join("").replace(/buffer \+= "";\n/g,"");if(options.debug){if(typeof console!="undefined"&&console.log){console.log(body);}else if(typeof print==="function"){print(body);}}
return body;}
function _compile(template,options){var args="view,partials,stack,lookup,escapeHTML,renderSection,render";var body=parse(template,options);var fn=new Function(args,body);return function(view,partials){partials=partials||{};var stack=[view];try{return fn(view,partials,stack,lookup,escapeHTML,renderSection,render);}catch(e){throw debug(e.error,template,e.line,options.file);}};}
var _cache={};function clearCache(){_cache={};}
function compile(template,options){options=options||{};if(options.cache!==false){if(!_cache[template]){_cache[template]=_compile(template,options);}
return _cache[template];}
return _compile(template,options);}
function render(template,view,partials){return compile(template)(view,partials);}})(Mustache);var views=views||{};views.pagingSelector={};var models=models||{};models.pagingSelector={};models.pagingSelector.SelectorModel=Backbone.Model.extend({defaults:{"title":"","search":true,"advancedSearch":false,"multiselect":true,"searchterm":"","collapsed":true,"values":null,"pageStart":0,"pageSize":Infinity,"totalRecords":0},initialize:function(values){this.set("values",new Backbone.Collection());var values=this.get("values");values.comparator=function(val){return val.get("idx");};values.model=models.pagingSelector.OptionModel;values.on("change:selected",this.updateSelection,this);this.on("change:searchterm",this.updateSearch,this);this.updateValues(values);},addPage:function(newValues){var v,newValue,values=this.get("values");for(v=0;v<newValues.length;v++){var newValue=newValues[v],found=values.detect(function(model){return model.get("idx")==newValue.idx;});if(!found){values.add(newValues[v],{silent:true});}}
values.trigger("add");},nextPage:function(){var start=this.get("pageStart"),size=this.get("pageSize"),total=this.get("totalRecords"),requestedPage=start+size,lastPage=total-total%size;this.set("pageStart",Math.min(requestedPage,lastPage));},prevPage:function(){var start=this.get("pageStart"),size=this.get("pageSize");this.set("pageStart",Math.max(0,start-size));},firstPage:function(){this.set("pageStart",0);},lastPage:function(){var total=this.get("totalRecords"),size=this.get("pageSize");this.set("pageStart",total-total%size);},goToPage:function(page){var total=this.get("totalRecords"),size=this.get("pageSize"),requestedPage=page*size,lastPage=total-total%size;this.set("pageStart",Math.min(requestedPage,lastPage));},updateValues:function(values){this.get("values").reset(values);},updateSelection:function(m,selected){if(selected&&!this.get("multiselect")){_(this.get("values").without(m)).each(function(other){other.set("selected",false);});}},clearSelection:function(){this.get("values").each(function(m){m.set("selected",false);})},toggleCollapsed:function(){this.set("collapsed",!this.get("collapsed"));},selectedValues:function(){return _(this.get("values").where({selected:true})).map(function(m){return m.get("value")});},updateSearch:function(){var term=this.get("searchterm");var pattern=new RegExp(term);this.get("values").each(function(m){var match=pattern.test(m.get('label'))||(this.get("advancedSearch")&&pattern.test(m.get("value")));m.set("visible",match);},this);}});models.pagingSelector.OptionModel=Backbone.Model.extend({defaults:{"idx":0,"label":"","value":null,"visible":true,"selected":false,"new":false},toggleSelected:function(){this.set("selected",!this.get("selected"));}});views.pagingSelector.SelectorView=Backbone.View.extend({events:{"click .title":"toggleCollapsed","click .first":"firstPage","click .prev":"prevPage","click .next":"nextPage","click .last":"lastPage","click .pages span":"goToPage","change .search input":"updateSearch","keydown .search input":"testChange","click .validate":"toggleCollapsed"},initialize:function(){this.initializeOptions();this.configureListeners();},configureListeners:function(){this.model.on("change",this.render,this);this.model.on("change:collapsed",this.updateCollapsed,this);this.model.on("change:pageStart",this.renderPages,this);var values=this.model.get("values");values.on("change:selected",this.toggleSelected,this);values.on("add remove reset",this.updateOptions,this)},initializeOptions:function(){this._selectedViews=[];this._optionViews=[];this.model.get("values").each(function(m){this._optionViews.push(new views.pagingSelector.OptionView({model:m}));if(m.get("selected")){this._selectedViews.push(new views.pagingSelector.SelectionView({model:m}));}},this);},updateSearch:function(evt){this.model.set("searchterm",evt.target.value);evt.stopPropagation();},testChange:function(evt){if(evt.which==13){this.updateSearch(evt);}},render:function(){this.$el.html(templates.pagingSelector.main(this.model.toJSON()));this.updateCollapsed();this.renderOptions();this.renderPages();},renderPages:function(){var m=this.model,currPage=Math.ceil(m.get("pageStart")/m.get("pageSize")),maxPages=Math.ceil(m.get("totalRecords")/m.get("pageSize")),$pages=this.$el.find(".pages"),i,preSkip=false,postSkip=false;$pages.empty();for(i=0;i<maxPages;i++){if(i<5||maxPages-i<5||Math.abs(currPage-i)<2){$pages.append($("<span class='page'>"+(i+1)+"</span>").attr("data-page",i).addClass(i==currPage?"current":""));}else{if(!preSkip&&i<currPage){$pages.append("&hellip;");preSkip=true;}else if(!postSkip&&i>currPage){$pages.append("&hellip;");postSkip=true;}}}},renderOptions:function(){var optionContainer=this.$el.find(".options").empty(),selectionContainer=this.$el.find(".selection").empty(),minIdx=this.model.get('pageStart'),maxIdx=this.model.get('pageStart')+this.model.get('pageSize');_(this._optionViews).each(function(v){var idx=v.model.get("idx");if(idx<maxIdx&&idx>=minIdx){optionContainer.append(v.render().el);}});_(this._selectedViews).each(function(v){selectionContainer.append(v.render().el);});},updateOptions:function(){this.initializeOptions();this.renderOptions();},toggleSelected:function(m,selected){var v;if(selected){v=new views.pagingSelector.SelectionView({model:m});this.$el.find(".selection").append(v.render().el);this._selectedViews.push(v);}else{v=_(this._selectedViews).find(function(v){return v.model===m});v.remove();this._selectedViews=_(this._selectedViews).without(v);}},toggleCollapsed:function(){this.model.toggleCollapsed();},updateCollapsed:function(){$('.selectorComponent').addClass('collapsed').removeClass('expanded');if(this.model.get("collapsed")){this.$el.find('.selectorComponent').addClass('collapsed').removeClass('expanded');}else{$(".datepicker-title").removeClass("datepicker-title-visible");$(".datepicker-outerbox").hide();$(".manage-views.active").click();this.$el.find('.selectorComponent').removeClass('collapsed').addClass('expanded');var optionList=this.$el.find(".optionList"),minimumMargin=10,topEdge=optionList.offset().top,bottomEdge=topEdge+optionList.outerHeight(),topLimit=$(window).scrollTop(),bottomLimit=topLimit+$(window).height(),offset=bottomEdge<=bottomLimit?0:bottomLimit-bottomEdge-minimumMargin;offset=topEdge-offset>=topLimit?offset:topLimit-topEdge+minimumMargin;optionList.css("top",(optionList.position().top+offset)+"px");}},nextPage:function(){this.model.nextPage();},prevPage:function(){this.model.prevPage();},firstPage:function(){this.model.firstPage();},lastPage:function(){this.model.lastPage();},goToPage:function(evt){var page=$(evt.target).attr("data-page");this.model.goToPage(page);}});views.pagingSelector.OptionView=Backbone.View.extend({tagName:"span",events:{"click .target":"toggleSelection"},initialize:function(){this.model.on("change:selected",this.updateSelectionDisplay,this);this.model.on("change:visible",this.updateVisibility,this);},render:function(){this.$el.html(templates.pagingSelector.option(this.model.toJSON()));this.$el.addClass('item');this.updateSelectionDisplay();this.updateVisibility();this.delegateEvents();return this;},toggleSelection:function(){this.model.toggleSelected();},updateVisibility:function(){if(this.model.get('visible')){this.$el.show();}else{this.$el.hide();}},updateSelectionDisplay:function(){if(this.model.get('selected')){this.$el.addClass('selected');}else{this.$el.removeClass('selected');}}});views.pagingSelector.SelectionView=Backbone.View.extend({tagName:"li",events:{"click .remove":"unselect"},render:function(){this.$el.html(templates.pagingSelector.picked(this.model.toJSON()));this.$el.addClass('item');this.delegateEvents();return this;},unselect:function(){this.model.set("selected",false);}});var templates=templates||{};templates.pagingSelector={};templates.pagingSelector.main=Mustache.compile("<div class='selectorComponent'>"+"  <div class='pulldown'>"+"    <div class='title'>{{title}}</div>"+"      <div class='optionList'>"+"        <div class='search'>"+"          <input type='text' placeholder='Search...' value='{{searchterm}}'/>"+"          <div class='cancel'>&nbsp;</div>"+"        </div>"+"        <div class='options'></div>"+"        <div class='paginationContainer'>"+"          <div class='pagination'>"+"            <div class='first paginateButton'><div class='arrow'>&nbsp;</div></div>"+"            <div class='prev paginateButton'><div class='arrow'>&nbsp;</div></div>"+"            <div class='pages'></div>"+"            <div class='next paginateButton'><div class='arrow'>&nbsp;</div></div>"+"            <div class='last paginateButton'><div class='arrow'>&nbsp;</div></div>"+"          </div>"+"          <div class='validate'><div class='image'>&nbsp;</div></div>"+"        </div>"+"      </div>"+"  </div>"+"  <div class='selection'></div>"+"</div>");templates.pagingSelector.option=Mustache.compile("<div class='target'>"+"  <span class='name' title='{{label}}'>{{label}}</span>"+"  <span class='check'>&nbsp;</span>"+"  {{#new}}<span class='new'>&nbsp;</span>{{/new}}"+"</div>");templates.pagingSelector.picked=Mustache.compile("<div class='target'>"+"  <span class='name' title='{{label}}'>{{label}}</span>"+"  <div class='remove'>&nbsp;</div>"+"</div>");var NewSelectorComponent=UnmanagedComponent.extend({pageStart:0,pageSize:54,update:function(){$.extend(this.options,this);this.ph=$("#"+this.htmlObject).empty();var redraw=_.bind(this.redraw,this);if(typeof this.valuesArray!="undefined"&&this.valuesArray.length>0){this.synchronous(redraw,this.valuesArray);}else{var params=Dashboards.propertiesArrayToObject(this.parameters);var pattern=(this.selectorModel)?this.selectorModel.get("searchterm"):"";params[this.searchParam]="'"+pattern+"'";this.parameters=Dashboards.objectToPropertiesArray(params);this.triggerQuery(this.chartDefinition,redraw,{pageSize:this.pageSize});}},values:function(results){var data=results.resultset,idx=(results.queryInfo)?results.queryInfo.pageStart:0,currentValues=Dashboards.getParameterValue(this.parameter),vid=this.chartDefinition.valueAsId,values=[];if(!_.isArray(currentValues))currentValues=[currentValues];_.each(data,function(row){var value=row[vid?1:0],v={idx:idx++,value:value,label:row[1],selected:!!(1+currentValues.indexOf(value)),"new":!!row[2]};values.push(v);},this);return values;},redraw:function(data){var values=this.values(data),modelOptions={title:this.title,pageSize:this.pageSize,pageStart:this.pageStart,totalRecords:(data.queryInfo)?data.queryInfo.totalRows:0,multiselect:this.multiselect},v,p;v=_.pluck(values,"value"),p=Dashboards.getParameterValue(this.parameter);p=_.filter(p,function(val){return _.include(v,val);});Dashboards.setParameter(this.parameter,p);if(!this.selectorModel){this.selectorModel=new models.pagingSelector.SelectorModel(modelOptions);}else{this.selectorModel.set(modelOptions);}
this.selectorModel.updateValues(values);if(!this.selectorView){this.selectorView=new views.pagingSelector.SelectorView({model:this.selectorModel,el:this.ph.get(0)});}
this.selectorView.render();this.selectorModel.off('change:searchterm',this.update);this.selectorModel.on('change:searchterm',this.update,this);this.selectorModel.off('change:pageSize',this.pagingHandler);this.selectorModel.on('change:pageSize',this.pagingHandler,this);this.selectorModel.off('change:pageStart',this.pagingHandler);this.selectorModel.on('change:pageStart',this.pagingHandler,this);this.selectorModel.off("change:collapsed",this.handleCollapse);this.selectorModel.on("change:collapsed",this.handleCollapse,this);this.timeout=0;var values=this.selectorModel.get("values");values.off("change:selected",this.handleSelectionChange);values.on("change:selected",this.handleSelectionChange,this);},handleCollapse:function(evt){if(evt.changed.collapsed)Dashboards.processChange(this.name);},handleSelectionChange:function(evt){if(!evt.changed.selected&&this.selectorModel.get("collapsed")){if(this.timeout!==0){clearTimeout(this.timetimeout);};var myself=this;this.timeout=setTimeout(function(){Dashboards.processChange(myself.name);timeout=0;},1500);}},pagingHandler:function(){var redraw=this.getSuccessHandler(_.bind(function(data){var values=this.values(data);this.selectorModel.addPage(values);},this));this.queryState.pageStartingAt(this.selectorModel.get("pageStart"),redraw);},getValue:function(){return this.selectorModel.selectedValues();}});var wd=wd||{};wd.components=wd.components||{};wd.components.olapSelector=wd.components.olapSelector||{};var OlapSelectorModel=Backbone.Model.extend({defaults:{"title":"","search":true,"multiselect":true,"multilevelselect":true,"deselectDescendants":false,"searchterm":"","collapsed":true,"values":null,"level":"","paginate":true,"pageStart":0,"pageSize":42,"morePages":false,"totalRecords":0,"mode":"level",olapUtils:null,"levels":null,"breadcrumb":[]},initialize:function(){var values=new Backbone.Collection();this.set("values",values);values.comparator=function(left,right){var leftLevel=left.get("level"),rightLevel=right.get("level"),leftMember=left.get("name"),rightMember=right.get("name"),cmpLevel=leftLevel.localeCompare(rightLevel),cmpMember=leftMember.localeCompare(rightMember);return cmpLevel!=0?cmpLevel/Math.abs(cmpLevel):cmpMember!=0?cmpMember/Math.abs(cmpMember):0;};values.model=OptionModel;this.updateValues();this.set("levels",new Backbone.Collection());var levels=this.get("levels");levels.model=LevelModel;this.updateLevels();this.processLevelSelection();levels.on("change:selected",this.processLevelSelection,this);this.setupEvents();this.fetchValues();},updateLevels:function(){var olapUtils=this.get("olapUtils"),h=olapUtils.getHierarchy();if(h.hasAll){var allMember={name:h.defaultMember,qualifiedName:h.defaultMemberQualifiedName,allMember:true}
this.get("levels").add(allMember);}
this.get("levels").add(olapUtils.getLevels(),{silent:true});},processLevelSelection:function(evt){if(this.getSelectedLevels().length==0){if(evt==null){this.get("levels").at(0).set({"selected":true});}
else{evt.set({selected:true});}
return;}
if(this.getSelectedLevels().size()>1){_(this.getSelectedLevels().without(evt)).each(function(f){f.set({selected:false})});this.set("pageStart",0);return;}},getSelectedLevels:function(){return new Backbone.Collection(this.get("levels").where({selected:true}));},setupEvents:function(){var values=this.get("values");values.on("change:selected",this.updateSelection,this);values.on("change:drill",this.drillDown,this);this.on("page",this.fetchValues,this,this);this.on("change:collapsed",this.handleCollapse,this);this.on("change:searchterm",this.updateSearch,this);this.on("drillUp",this.drillUp,this);this.get("levels").on("select",this.changeLevel,this);},handleCollapse:function(m,isCollapsed){if(isCollapsed){return;}
var oldValues=this.get("values").where({selected:true}).map(function(e){return e.get("qualifiedName");});this.set("oldValues",oldValues);},apply:function(){this.toggleCollapsed();},cancel:function(){var oldValues=this.get("oldValues");this.get("values").each(function(e){e.set("selected",oldValues.indexOf(e.get("qualifiedName"))>-1);});this.get("values").trigger("select");this.toggleCollapsed();},drillDown:function(m,drill){if(drill){this.get("breadcrumb").push(m);var levels=this.get("levels"),olapUtils=this.get("olapUtils"),defaultQualified=olapUtils.getHierarchy().defaultMemberQualifiedName,atTopLevel,selectedLevel=levels.where({selected:true})[0],qualifiedName=selectedLevel.get("qualifiedName"),idx=levels.indexOf(selectedLevel);selectedLevel.set("selected",false);atTopLevel=qualifiedName==defaultQualified;if(atTopLevel){levels.at(idx+2).set("selected",true);}else{levels.at(idx+1).set("selected",true);}
this.set("pageStart",0,{silent:true});this.trigger("drill");this.fetchValues();}},drillUp:function(){var crumbtrail=this.get("breadcrumb");if(crumbtrail.length){crumbtrail.pop();var levels=this.get("levels"),selectedLevel=levels.where({selected:true})[0],idx=levels.indexOf(selectedLevel);selectedLevel.set("selected",false);this.set("pageStart",0,{silent:true});levels.at(idx-1).set("selected",true);this.trigger("drill");this.fetchValues();}},changeLevel:function(m,value){if(m&&value===false){return;}
this.set("breadcrumb",[]);this.trigger("drill");this.set("pageStart",0);this.fetchValues();},fetchValues:function(m,value){var selectedLevel=this.get("levels").where({selected:true})[0],olapUtils=this.get("olapUtils"),options={pageSize:this.get("pageSize"),pageStart:this.get("pageStart"),searchTerm:this.get("searchterm")},breadcrumb=this.get("breadcrumb"),level;if(breadcrumb&&breadcrumb.length){var l=breadcrumb.length-1;options.startMember=breadcrumb[l].get("qualifiedName");}
level=selectedLevel?selectedLevel.get("name"):"";if(!level||level==olapUtils.getHierarchy().defaultMember){options.level=olapUtils.getLevels()[0].name;}else{options.level=level;}
var myself=this;this.get("olapUtils").getPaginatedLevelMembers(options,function(v){myself.set("morePages",v.more);myself.addPage(v.members);});},addPage:function(newValues){var v,newValue,idx=this.get("pageStart");values=this.get("values");for(v=0;v<newValues.length;v++){var newValue=newValues[v],found;newValue.level=this.getSelectedLevels().at(0).get("qualifiedName");found=values.detect(function(model){return model.get("level")==newValue.level&&model.get("qualifiedName")==newValue.qualifiedName;});if(!found){values.add(newValue,{silent:true});}}
values.trigger("add");},nextPage:function(){if(!this.get("morePages")){return;}
var start=this.get("pageStart"),size=this.get("pageSize");this.set("pageStart",start+size);this.trigger("page");},prevPage:function(){if(this.get("pageStart")==0){return;}
var start=this.get("pageStart"),size=this.get("pageSize");this.set("pageStart",Math.max(0,start-size));this.trigger("page");},firstPage:function(){if(this.get("pageStart")==0){return;}
this.set("pageStart",0);this.trigger("page");},lastPage:function(){var total=this.get("totalRecords"),size=this.get("pageSize");this.set("pageStart",total-total%size);this.trigger("page");},goToPage:function(page){var size=this.get("pageSize");this.set("pageStart",page*size);this.trigger("page");},updateValues:function(values){this.get("values").reset(values);},updateSelection:function(m,selected){if(!selected){return}
var isMultiselect=this.get("multiselect"),deselectDescendants=this.get("deselectDescendants"),isMultilevel=this.get("multilevelselect"),selectedLevel=this.getSelectedLevels().at(0).get("qualifiedName"),memberName=m.get("qualifiedName");_(this.get("values").without(m)).each(function(other){if(!isMultiselect){other.set("selected",false);}
if(deselectDescendants&&other.get("qualifiedName").indexOf(memberName)>-1){other.set("selected",false);}
if(!isMultilevel&&selectedLevel!=other.get("level")){other.set("selected",false);}});},clearSelection:function(){this.get("values").each(function(m){m.set("selected",false);})},toggleCollapsed:function(predicate){this.set("collapsed",(_.isBoolean(predicate))?predicate:!this.get("collapsed"));},selectedValues:function(){return _(this.get("values").where({selected:true})).map(function(m){return m.get("value")});},updateSearch:function(){var term=this.get("searchterm");this.set("pageStart",0,{silent:true});this.fetchValues();},notifyUpdate:function(){this.trigger('notify',this);}});var OptionModel=Backbone.Model.extend({defaults:{"idx":0,"name":"","value":null,"level":null,"drill":false,"selected":false},toggleSelected:function(){this.set("selected",!this.get("selected"));}});var LevelModel=OptionModel.extend({defaults:{},initialize:function(o){this.on("change:qualifiedName change:name",function(o){wd.log("Detected changes");this.set("id",o.get("qualifiedName"));this.set("label",o.get("name"));});this.set("id",this.get("qualifiedName"));this.set("label",this.get("name"));}});var OlapSelectorView=Backbone.View.extend({events:{"click .title":"toggleCollapsed","click .first":"firstPage","click .prev":"prevPage","click .next":"nextPage","click .last":"lastPage","click .pages span":"goToPage","change .search input":"updateSearch","click .validate":"apply","click .cancel":"cancel","click .breadcrumb .name":"drillUp"},levelViews:[],renderLevels:function(){var levelContainer=this.$el.find(".levels").empty();_(this.levelViews).each(function(v){levelContainer.append(v.render().el);});},initialize:function(){this.initializeOptions();this.configureListeners();this.levelViews=[];this.model.get("levels").each(function(m){this.levelViews.push(new LevelView({model:m}));},this);},configureListeners:function(){this.model.on("change",this.render,this);this.model.on("drill",this.renderCrumbtrail,this);this.model.on("change:collapsed",this.updateCollapsed,this);this.model.on("page",this.renderPages,this);var values=this.model.get("values");values.on("add remove reset",this.updateOptions,this)
values.on("select",this.updateOptions,this);values.on("notify",this.notifyUpdate,this);},initializeOptions:function(){this._selectedViews=[];this._selectedViewsOut=[];this._optionViews=[];this.model.get("values").each(function(m){this._optionViews.push(new OptionView({model:m}));if(m.get("selected")){this._selectedViews.push(new SelectionView({model:m}));this._selectedViewsOut.push(new SelectionViewOut({model:m}));}},this);},updateSearch:function(evt){this.model.set("searchterm",evt.target.value);},render:function(){this.$el.html(templates.olapSelector.main(this.model.toJSON()));this.renderLevels();this.updateCollapsed();this.renderLevels();this.renderOptions();this.renderPages();this.renderCrumbtrail();this.delegateEvents();},renderCrumbtrail:function(){var currentLevelName=this.model.get("levels").where({selected:true})[0].get("name"),crumbtrail=this.model.get("breadcrumb");if(crumbtrail.length>0){var breadcrumb=crumbtrail[crumbtrail.length-1];this.$el.find(".breadcrumb").html(templates.olapSelector.crumbtrail({level:currentLevelName,name:breadcrumb.get("name")}));}else{this.$el.find(".breadcrumb").empty();}},renderPages:function(){var m=this.model;this.$el.find(".pagination .next").toggleClass("disabled",!m.get("morePages"));this.$el.find(".pagination .prev").toggleClass("disabled",!m.get("pageStart"));this.$el.find(".pagination .first").toggleClass("disabled",!m.get("pageStart"));},renderOptions:function(){var optionContainer=this.$el.find(".rightArea .options").empty(),selectionContainer=this.$el.find(".leftArea .selection").empty(),selectionContainerOut=this.$el.find(".outsideArea .selection").empty(),myself=this,minIdx=this.model.get('pageStart'),maxIdx=this.model.get('pageStart')+this.model.get('pageSize');_(this._optionViews).chain().filter(this.isVisible,this).slice(minIdx,maxIdx).each(function(v){optionContainer.append(v.render().el);},this);_(this._selectedViewsOut).each(function(v){selectionContainerOut.append(v.render().el);});_(this._selectedViews).each(function(v){selectionContainer.append(v.render().el);});},updateOptions:function(){this.initializeOptions();this.renderOptions();this.highlightParents();},notifyUpdate:function(){this.model.toggleCollapsed(false);this.model.toggleCollapsed(true);},isVisible:function(view){var parentModel=this.model,model=view.model,levelVisible=parentModel.getSelectedLevels().at(0).get("id")==model.get("level"),searchTerm=parentModel.get("searchterm"),searchVisible=searchTerm==null||RegExp(searchTerm,"i").test(model.get("name")),drillTerm=_.last(parentModel.get("breadcrumb")),drillVisible=drillTerm==null||model.get("qualifiedName").indexOf(drillTerm.get("qualifiedName"))>-1;return levelVisible&&searchVisible&&drillVisible;},highlightParents:function(){var parentModel=this.model,selectedMembers=parentModel.get("values").where({selected:true}).map(function(m){return m.get("qualifiedName");});_(this._optionViews).each(function(v){var name=v.model.get("qualifiedName");var childrenSelected=_(selectedMembers).chain().without(v.model.get("qualifiedName")).filter(function(m){return m.indexOf(name)>-1;}).value();v.$el.toggleClass("highlight",childrenSelected.length>0);if(childrenSelected.length>0){v.$el.find(".drill-down .label").text(childrenSelected.length);}else{v.$el.find(".drill-down .label").html("&nbsp;");}},this);},toggleSelected:function(m,selected){var vInner,vOuter,v;if(selected){vInner=new SelectionView({model:m});this.$el.find(".leftArea .selection").append(vInner.render().el);this._selectedViews.push(vInner);vOuter=new SelectionViewOut({model:m});this.$el.find(".outsideArea .selection").append(vOuter.render().el);this._selectedViews.push(vOuter);}else{v=_(this._selectedViews).filter(function(v){return v.model===m});var myself=this;_.each(v,function(e){e.remove();myself._selectedViews=_(myself._selectedViews).without(e);});v=_(this._selectedViewsOut).filter(function(v){return v.model===m});var myself=this;_.each(v,function(e){e.remove();myself._selectedViewsOut=_(myself._selectedViewsOut).without(e);});}},drillUp:function(){this.model.trigger("drillUp");},cancel:function(){this.model.cancel();},apply:function(){this.model.apply();},toggleCollapsed:function(){this.model.toggleCollapsed();},updateCollapsed:function(){$('.olapSelectorComponent').addClass('collapsed').removeClass('expanded');if(this.model.get("collapsed")){this.$el.find('.olapSelectorComponent').addClass('collapsed').removeClass('expanded');}else{this.$el.find('.olapSelectorComponent').removeClass('collapsed').addClass('expanded');var optionList=this.$el.find(".optionList"),minimumMargin=10,topEdge=optionList.offset().top,bottomEdge=topEdge+optionList.outerHeight(),topLimit=$(window).scrollTop(),bottomLimit=topLimit+$(window).height(),offset=bottomEdge<=bottomLimit?0:bottomLimit-bottomEdge-minimumMargin;offset=topEdge-offset>=topLimit?offset:topLimit-topEdge+minimumMargin;console.log("Offset is "+offset+" after correction");optionList.css("top",(optionList.position().top+offset)+"px");}},nextPage:function(){this.model.nextPage();},prevPage:function(){this.model.prevPage();},firstPage:function(){this.model.firstPage();},lastPage:function(){this.model.lastPage();},goToPage:function(evt){var page=$(evt.target).attr("data-page");this.model.goToPage(page);}});var OptionView=Backbone.View.extend({tagName:"span",template:null,events:{"click .target":"toggleSelection","click .drill-down":"drillDown"},initialize:function(){this.setTemplate();this.model.on("change:selected",this.updateSelectionDisplay,this);},setTemplate:function(){this.template=templates.olapSelector.option},drillDown:function(){this.model.set("drill",true);},render:function(){this.$el.html(this.template(this.model.toJSON()));this.$el.addClass('item');this.updateSelectionDisplay();this.delegateEvents();return this;},toggleSelection:function(){this.model.toggleSelected();this.model.trigger("select");},updateSelectionDisplay:function(){if(this.model.get('selected')){this.$el.addClass('selected');}else{this.$el.removeClass('selected');}}});var LevelView=OptionView.extend({tagName:"span",template:null,setTemplate:function(){this.template=templates.olapSelector.level;}});var SelectionView=Backbone.View.extend({tagName:"li",events:{"click .remove":"unselect"},render:function(){this.$el.html(templates.olapSelector.picked(this.model.toJSON()));this.delegateEvents();return this;},unselect:function(){this.model.set("selected",false);this.model.trigger("select");}});var SelectionViewOut=SelectionView.extend({unselect:function(){this.model.set("selected",false);this.model.trigger("select");this.model.trigger("notify");}});var templates=templates||{};templates.olapSelector={};templates.olapSelector.main=Mustache.compile("<div class='olapSelectorComponent'>"+" <div class='pulldown'>"+"   <div class='title'>{{title}}</div>"+"     <div class='optionList'>"+"       <div class='leftArea'>"+"         <div class='header'>Select Level</div>"+"         <div class='levels'></div>"+"         <div class='selectionPanel'>"+"           <div class='label'>Selected Filters</div>"+"           <ul class='selection'></ul>"+"         </div>"+"       </div>"+"       <div class='rightArea {{#paginate}}paginate{{/paginate}}'>"+"         <div class='header'>"+"<div class='breadcrumb'>Breadcrumb &#x21FE; Content</div>"+"<div class='search'>"+"             <input type='text' placeholder='Search...' value='{{searchterm}}'/>"+"             <div class='cancel'>&nbsp;</div>"+"           </div>"+"         </div>"+"         <div class='options'></div>"+"         <div class='paginationContainer'>"+"           <div class='pagination'>"+"             <div class='prev paginateButton'>Previous Page<div class='arrow'>&nbsp;</div></div>"+"             <div class='next paginateButton'>Next Page<div class='arrow'>&nbsp;</div></div>"+"           </div>"+"         </div>"+"         <div class='footer'>"+"           <div class='button cancel'>Cancel</div>"+"           <div class='button validate'>Apply</div>"+"         </div>"+"       </div>"+"     </div>"+" </div>"+" <div class='outsideArea'>"+"   <ul class='selection'></ul>"+" </div>"+"</div>");templates.olapSelector.option=Mustache.compile("<div class='target'>"+" <span class='name' title='{{name}}'>{{name}}</span>"+" <span class='check'>&nbsp;</span>"+"</div>"+"<div class='drill-down'><span class='label'>&nbsp;</span></div>");templates.olapSelector.picked=Mustache.compile("<div class='target'>"+"  <span class='name' title='{{name}}'>{{name}}</span>"+"  <div class='remove'>&nbsp;</div>"+"</div>");templates.olapSelector.levels=Mustache.compile("<div class='levelTitle'>Levels</div>"+"<div class='levels options'></div>");templates.olapSelector.level=Mustache.compile("<div class='target'>"+"  <span class='name' title='{{label}}'>{{label}}</span>"+"</div>");templates.olapSelector.crumbtrail=Mustache.compile("<span class='level'>{{level}}</span>"+"<span class='separator'>&nbsp;</span>"+"<span class='name'>{{name}}</span>")
if(typeof console==="undefined"){console={};console.log=function(){return;}}
wd=wd||{};wd.utils=wd.utils||{};wd.utils.OlapUtils=function(spec){var defaults={url:"OlapUtils",extraParams:{}};var myself={};myself.options=$.extend({},defaults,spec);var isInitialized=false;var catalog=myself.options.catalog;var cube=myself.options.cube;var allSelectedObjects=[];var catalogs=[];var cubeStructureCache={};var olapOperations={GET_CUBE_STRUCTURE:'GetCubeStructure',GET_PAGINATED_LEVEL_MEMBERS:'GetPaginatedLevelMembers',GET_MEMBER_STRUCTURE:'GetLevelMembersStructure',GET_OLAP_CUBES:'GetOlapCubes'};myself.initialize=function(){if(!isInitialized){myself.initCatalogs();isInitialized=true;}}
myself.setOptions=function(_args){myself.options=$.extend(myself.options,_args);}
myself.initCatalogs=function(){wd.debug("Getting info from cube");myself.callOlapUtils({operation:olapOperations.GET_OLAP_CUBES},function(result){catalogs=result.catalogs;wd.info("[OlapUtils] Successfully got catalog information");});}
myself.resetCubeStructure=function(_args){var catalog=myself.getSelectedCatalogName(_args);var cube=myself.getSelectedCubeName(_args);var cacheKey=catalog+"::"+cube;if(cacheKey){delete cubeStructureCache[cacheKey];}
else{cubeStructureCache={};}
return true;}
myself.getCatalogs=function(){return catalogs;}
myself.getCubes=function(_args){var catalog=myself.getSelectedCatalogName(_args);var entry=_.find(catalogs,function(c){return c.schema.indexOf(catalog)>=0;});return entry?entry.cubes:null;}
myself.getCubeStructure=function(_args){var catalog=myself.getSelectedCatalogName(_args);var cube=myself.getSelectedCubeName(_args);var cacheKey=catalog+"::"+cube;if(!catalog||!cube){wd.error("Catalog or Cube not specified");return null;}
if(cubeStructureCache[cacheKey]){return cubeStructureCache[cacheKey];}
var params={operation:olapOperations.GET_CUBE_STRUCTURE,catalog:catalog,cube:cube};var result=myself.callOlapUtilsSync(params);cubeStructureCache[cacheKey]=result;return result;}
myself.getCube=function(_args){return myself.getCubeStructure(_args);}
myself.getDimensions=function(_args){var cubeStructure=myself.getCubeStructure(_args);return cubeStructure!=null?cubeStructure.dimensions:null;}
myself.getDimension=function(_args){var dimension=myself.getSelectedDimensionName(_args);var cubeStructure=myself.getCubeStructure(_args);var d=_.find(cubeStructure.dimensions,function(d){return d.name==dimension});return d;}
myself.getHierarchies=function(_args){var d=myself.getDimension(_args);return d!=null?d.hierarchies:null;}
myself.getHierarchy=function(_args){var hierarchyName=myself.getSelectedHierarchyName(_args);var h=_.find(myself.getHierarchies(_args),function(hier){return hier.name==hierarchyName});return h;}
myself.getLevels=function(_args){var h=myself.getHierarchy(_args);return h!=null?h.levels:null;}
myself.getLevel=function(_args){var levelName=myself.getSelectedLevelName(_args);var l=_.find(myself.getLevels(_args),function(level){return level.name==levelName});return l;}
myself.getPaginatedLevelMembers=function(_args,callback){var defaults={operation:olapOperations.GET_PAGINATED_LEVEL_MEMBERS,startMember:"",pageStart:0,pageSize:100,searchTerm:"",context:""}
var params=$.extend({},defaults,_args);params.catalog=myself.getSelectedCatalogName(_args);params.cube=myself.getSelectedCubeName(_args);var l=myself.getLevel(_args);params.level=l.qualifiedName;myself.callOlapUtils(params,function(json){var members=json.members;wd.debug("Got results for paginatedLevelMembers: "+_(members).pluck("name").join(", "));if(callback){callback(json);}});};myself.getOlapUtilsUrl=function(){return myself.options.url};myself.getSelectedCatalogName=function(_args){var catalog=$.extend({},myself.options,_args).catalog;if(catalog.charAt(0)=='/'){catalog='solution:'+catalog.substring(1);}
else{catalog='solution:'+catalog;}
return catalog;};myself.getSelectedCubeName=function(_args){return $.extend({},myself.options,_args).cube;};myself.getSelectedDimensionName=function(_args){return $.extend({},myself.options,_args).dimension;};myself.getSelectedHierarchyName=function(_args){var h=$.extend({},myself.options,_args).hierarchy;if(h==null){h=myself.getHierarchies(_args)[0].name;myself.options.hierarchy=h;wd.info("No hierarchy explicitly selected - setting the default one to '"+h+"'");}
return h;};myself.getSelectedLevelName=function(_args){return $.extend({},myself.options,_args).level;};myself.callOlapUtilsSync=function(params){return myself.callOlapUtils(params,undefined,undefined,true);}
myself.callOlapUtils=function(params,callback,errorCallback,sync){var myself=this;var ret;$.ajax({url:myself.getOlapUtilsUrl(),data:$.extend({},myself.options.extraParams,params),dataType:"json",success:function(json){if(json&&json.status=="true"&&json.result){if(sync){ret=json.result}
else{callback(json.result);}}
else{if(typeof(errorCallback)!='function')errorCallback=alert;return errorCallback(json);}},async:!sync});return ret;};myself.initialize();wd.info("OlapUtils initialized!");return myself;}
if(!Array.prototype.map)
{Array.prototype.map=function(fun)
{var len=this.length;if(typeof fun!="function")
throw new TypeError();var res=new Array(len);var thisp=arguments[1];for(var i=0;i<len;i++)
{if(i in this)
res[i]=fun.call(thisp,this[i],i,this);}
return res;};}
if(!Array.prototype.indexOf){Array.prototype.indexOf=function(searchElement){"use strict";if(this==null){throw new TypeError();}
var t=Object(this);var len=t.length>>>0;if(len===0){return-1;}
var n=0;if(arguments.length>0){n=Number(arguments[1]);if(n!=n){n=0;}else if(n!=0&&n!=Infinity&&n!=-Infinity){n=(n>0||-1)*Math.floor(Math.abs(n));}}
if(n>=len){return-1;}
var k=n>=0?n:Math.max(len-Math.abs(n),0);for(;k<len;k++){if(k in t&&t[k]===searchElement){return k;}}
return-1;}}
Function.prototype.method=Function.prototype.method||function(name,func){this.prototype[name]=func;return this;};var wd=wd||{};wd.loglevels=['debug','info','warn','error','exception'];wd.loglevel='debug';wd.log=function(m,type){type=type||"info";if(wd.loglevels.indexOf(type)<wd.loglevels.indexOf(wd.loglevel)){return;}
if(typeof console!=="undefined"){if(type&&console[type]){console[type]("["+type+"] WD: "+m);}else if(type==='exception'&&!console.exception){console.error("["+type+"] WD: "+(m.stack||m));}
else{console.log("WD: "+m);}}}
wd.warn=function(m){return wd.log(m,"warn");}
wd.error=function(m){return wd.log(m,"error");}
wd.info=function(m){return wd.log(m,"info");}
wd.debug=function(m){return wd.log(m,"debug");}
var OlapSelectorComponent=BaseComponent.extend({init:function(){this.model=new OlapSelectorModel({olapUtils:new wd.utils.OlapUtils({url:"/pentaho/content/pentaho-cdf-dd/OlapUtils",catalog:this.catalog,cube:this.cube,dimension:this.dimensionName,}),title:this.title});this.view=new OlapSelectorView({model:this.model,el:$("#"+this.htmlObject).get(0)})},update:function(){if(!this.isInitialized){this.init();this.isInitialized=true;}
var myself=this;this.model.on("change:collapsed",function(m,v){if(v){Dashboards.processChange(myself.name);}})
this.view.render();},getValue:function(){return _(this.model.get("values").where({selected:true})).map(function(m){return m.get("qualifiedName");});}});var PopupComponent=BaseComponent.extend({ph:undefined,arrow:undefined,content:undefined,cancel:undefined,$overlay:undefined,update:function(){var myself=this;this.content=$("#"+this.htmlObject).detach();this.ph=this.ph?this.ph.empty():$('<div>').appendTo($('body'));this.content.appendTo(this.ph);this.ph.hide();this.ph.addClass('popupComponent');this.cancel=$("<a>&nbsp;</a>");this.cancel.addClass("close").click(function(){myself.hide();});this.cancel.appendTo(this.ph);this.arrow=$("<div class='arrow'>").appendTo(this.ph);this.content.removeClass('hidePopup');},clone:function(params,comps,html){var that=this.base(params,comps,html);that.ph=this.ph.clone();that.ph.insertAfter(this.ph);that.ph.hide();that.ph.find("[id]").each(function(i,e){$e=$(e);var id=$e.attr("id");if(id&&id in html){$e.attr("id",html[id]);}else{$e.attr("id",id+'_'+Dashboards.duplicateIndex);}});return that;},popup:function(target,gravity){var pos=target.offset(),css={'top':'auto','bottom':'auto','left':'auto','right':'auto'},minimumDistance=20,vertexOffset=18-6,vertexSize=45,targetOffset,phHeight=this.ph.outerHeight(),phWidth=this.ph.outerWidth();gravity=gravity||this.gravity;var draggable=typeof this.draggable==="undefined"?true:this.draggable;if(this.horizontalScroll){$("#"+this.htmlObject).css("overflow-x","scroll");}
if(this.verticalScroll){$("#"+this.htmlObject).css("overflow-y","scroll");}
$("#"+this.htmlObject).parent().draggable({cancel:"#"+this.htmlObject});var closeOnClickOutside=typeof this.closeOnClickOutside==="undefined"?false:this.closeOnClickOutside;this.arrow.css({top:"",left:"",bottom:"",right:""});this.arrow.show();this.ph.removeClass('north south east west');var minWidth=minimumDistance,maxWidth=$(document).width()-minimumDistance,minHeight=minimumDistance,maxHeight=$(document).height()-minimumDistance,targetWidth,targetHeight,paddingNear,paddingFar;switch(gravity){case'N':paddingNear=parseInt(target.css('padding-top').replace(/(.*)px/,"$1"),10);css.left=this.center(target.outerWidth(),phWidth,pos.left,minWidth,maxWidth);targetHeight="ownerSVGElement"in target[0]?(target.attr("height")?target.attr("height")-0:0):target.height();targetOffset=pos.left-css.left-this.ph.css('border-top-width').replace(/(.*)px/,"$1");css.top=this.offset(targetHeight,phHeight,pos.top+paddingNear,vertexOffset,minHeight,maxHeight,'near');this.arrow.css('left',this.center(target.outerWidth(),vertexSize,targetOffset,0,phWidth));this.ph.addClass(css.top<pos.top?'north':'south');break;case'S':paddingNear=parseInt(target.css('padding-top').replace(/(.*)px/,"$1"),10);targetHeight="ownerSVGElement"in target[0]?(target.attr("height")?target.attr("height")-0:0):target.height();css.left=this.center(target.outerWidth(),phWidth,pos.left,minWidth,maxWidth);css.top=this.offset(targetHeight,phHeight,pos.top+paddingNear,vertexOffset,minHeight,maxHeight,'far');targetOffset=pos.left-css.left-this.ph.css('border-top-width').replace(/(.*)px/,"$1");this.arrow.css('left',this.center(target.outerWidth(),vertexSize,targetOffset,0,phWidth));this.ph.addClass(css.top<pos.top?'north':'south');break;case'W':paddingNear=parseInt(target.css('padding-left').replace(/(.*)px/,"$1"),10);css.top=this.center(target.outerHeight(),phHeight,pos.top,minHeight,maxHeight);targetWidth="ownerSVGElement"in target[0]?(target.attr("width")?target.attr("width")-0:0):target.width();css.left=this.offset(target.width(),phWidth,pos.left+paddingNear,vertexOffset,minWidth,maxWidth,'near');targetOffset=pos.top-css.top-this.ph.css('border-left-width').replace(/(.*)px/,"$1");this.arrow.css('top',this.center(target.outerHeight(),vertexSize,targetOffset,0,phHeight));this.ph.addClass(css.left<pos.left?'west':'east');break;case'E':paddingNear=parseInt(target.css('padding-left').replace(/(.*)px/,"$1"),10);css.top=this.center(target.outerHeight(),phHeight,pos.top,minHeight,maxHeight);targetWidth="ownerSVGElement"in target[0]?(target.attr("width")?target.attr("width")-0:0):target.width();css.left=this.offset(targetWidth,phWidth,pos.left+paddingNear,vertexOffset,minWidth,maxWidth,'far');targetOffset=pos.top-css.top-this.ph.css('border-left-width').replace(/(.*)px/,"$1");this.arrow.css('top',this.center(target.outerHeight(),vertexSize,targetOffset,0,phHeight));this.ph.addClass(css.left<pos.left?'west':'east');break;}
this.ph.css(css);this.ph.show();var escHandler,myself=this;escHandler=function(e){if(e.which==27){myself.ph.hide();$(document).unbind('keydown',escHandler);}};$(document).keydown(escHandler);var dragHandler;dragHandler=function(){myself.arrow.hide();}
this.ph.bind('drag',dragHandler);if(draggable){this.ph.draggable();}
var basePos,dragPos;this.ph.bind('touchstart',function(e){basePos=myself.ph.offset();dragPos={left:e.originalEvent.touches[0].pageX,top:e.originalEvent.touches[0].pageY};});this.ph.bind('touchmove',function(e){var finalPos={top:basePos.top+e.originalEvent.touches[0].pageY-dragPos.top,left:basePos.left+e.originalEvent.touches[0].pageX-dragPos.left};myself.ph.offset(finalPos);myself.arrow.hide();e.preventDefault();});if(closeOnClickOutside){if(!this.$overlay){this.$overlay=$('<div id="popupComponentOverlay"></div>');}
this.$overlay.appendTo("body").click(function(event){event.stopPropagation();myself.hide();})}},hide:function(){this.ph.hide();if(this.$overlay){this.$overlay.unbind('click');this.$overlay.detach();}},center:function(targetSize,phSize,offset,min,max){var candidate=offset+targetSize/2-phSize/2;return candidate+phSize>max?max-phSize:candidate<min?min:candidate;},offset:function(targetSize,phSize,offset,gap,min,max,range){var near=offset-phSize-gap,far=offset+targetSize+gap,nearAdmissible=near>min,farAdmissible=far+phSize<max;return range=='near'?(nearAdmissible||!farAdmissible?near:far):range=='far'?(farAdmissible||!nearAdmissible?far:near):near;}});var ExportPopupComponent=PopupComponent.extend({ph:undefined,arrow:undefined,content:undefined,cancel:undefined,dataComponent:undefined,chartComponent:undefined,baseSize:200,scalingFactor:1.5,clone:function(parameterRemap,componentRemap,htmlRemap){var dataComponent=this.dataComponent,chartComponent=this.chartComponent;delete this.dataComponent;delete this.chartComponent;var that=this.base(parameterRemap,componentRemap,htmlRemap);this.dataComponent=dataComponent;that.dataComponent=componentRemap[dataComponent.name]||dataComponent;this.chartComponent=chartComponent;var truncated=/render_(.*)/.test(chartComponent.name)?chartComponent.name.match(/render_(.*)/)[1]:null;if(componentRemap[chartComponent.name]){that.chartComponent=Dashboards.getComponentByName(componentRemap[chartComponent.name]);that.chartExportComponent=componentRemap[chartComponent.name];}else if(truncated&&componentRemap[truncated]){that.chartComponent=Dashboards.getComponentByName("render_"+componentRemap[truncated]);that.chartExportComponent=componentRemap[truncated];}else{that.chartComponent=chartComponent;}
that.chartComponent=componentRemap[chartComponent.name]||chartComponent;return that;},update:function(){var myself=this;if(this.ph){this.ph.remove();}
this.chartComponent=window["render_"+this.chartExportComponent];this.dataComponent=window["render_"+this.dataExportComponent];this.ph=$('<div>');$("#"+this.htmlObject).empty();var link=$('<div class="popupTitle">');link.text(this.title||'Export');link.click(function(e){myself.popup(link);e.stopPropagation();})
$("#"+this.htmlObject).append(link);if(this.chartComponent){var realChartExportLabel="Export Chart";if(this.chartExportLabel&&this.chartExportLabel.length>0)
realChartExportLabel=this.chartExportLabel;var chartExportElt=$('<div class="exportElement">');chartExportElt.text(realChartExportLabel);chartExportElt.click(function(){myself.exportChart();});chartExportElt.appendTo(myself.ph);}
if(this.dataComponent){var realTableExportLabel="Export Data";if(this.dataExportLabel&&this.dataExportLabel.length>0)
realTableExportLabel=this.dataExportLabel;var dataExportElt=$('<div class="exportElement">');dataExportElt.text(realTableExportLabel);dataExportElt.click(function(){myself.exportData();});dataExportElt.appendTo(myself.ph);}
$(this.contentLinks).each(function(i,elt){var popupElt=$('<div class="exportElement">');popupElt.text(elt[0]);popupElt.click(elt[1]);popupElt.appendTo(myself.ph);});this.ph.hide().appendTo($('body'));this.ph.addClass('popupComponent');this.ph.addClass('exportOptions');this.cancel=$("<a>&nbsp;</a>");this.cancel.addClass("close").click(function(){myself.hide();});this.cancel.appendTo(this.ph);this.arrow=$("<div class='arrow'>").appendTo(this.ph);},popup:function(target,gravity){this.base(target,gravity);var myself=this;var docClick=function(e){var x=e.pageX;var y=e.pageY;var linkPos=$("#"+myself.htmlObject).position();if((x<linkPos.left||x>linkPos.left+$("#"+myself.htmlObject).width())||(y<linkPos.top||y>linkPos.top+$("#"+myself.htmlObject).height())){myself.hide();$(document).unbind('click',docClick);}};$(document).click(docClick);},exportData:function(det){var effectiveExportType=det==undefined?this.dataExportType:det;Dashboards.log("Exporting to "+effectiveExportType);var parameters=this.dataComponent.parameters;var cd=(this.dataComponent.chartDefinition)?this.dataComponent.chartDefinition:this.dataComponent.queryDefinition;var dataAccess=cd.dataAccessId;var path=cd.path;var url="../cda/doQuery?path="+path+"&dataAccessId="+dataAccess+"&outputType="+effectiveExportType+"&settingattachmentName="+this.dataExportAttachmentName+"."+effectiveExportType;var doQueryParameters={};for(var i=0;i<parameters.length;i++){var paramName='param'+parameters[i][0];doQueryParameters[paramName]=parameters[i][0]!='metadata'?Dashboards.ev(Dashboards.getParameterValue(parameters[i][1])):'false';}
var theDoQuery=url+'&wrapItUp=wrapit';$.post(theDoQuery,doQueryParameters,function(uuid){var _exportIframe=_exportIframe||$('<iframe style="display:none">');_exportIframe.detach();_exportIframe[0].src=webAppPath+'/content/cda/unwrapQuery?'+$.param({"path":cd.path,"uuid":uuid});_exportIframe.appendTo($('body'));});},exportChart:function(cet){var effectiveExportType=cet==undefined?this.chartExportType:cet;Dashboards.log("Exporting to "+effectiveExportType);var parameters=this.chartComponent.parameters;var dataAccess=this.chartComponent.chartDefinition.dataAccessId;var path=this.chartComponent.chartDefinition.path;var loc=(Dashboards.getQueryParameter("solution")+"/"+Dashboards.getQueryParameter("path")+"/").replace(/\/\//g,"/");var url="../cgg/draw?script="+loc+this.chartExportComponent+".js&outputType="+effectiveExportType;var param;for(var i=0;i<parameters.length;i++){param=Dashboards.ev(Dashboards.getParameterValue(parameters[i][1]));if(param!==undefined){url+="&param"+parameters[i][0]+"="+(parameters[i][0]!='metadata'?encodeURIComponent(param):'false');}}
var myself=this;var masterDiv=$('<div class="exportChartMasterDiv">');var totalWidth=Math.max(700,this.chartComponent.chartDefinition.width);var popupButtonsDiv=$("<div class='exportChartPopupButtons' style='width:"+totalWidth+"px'>");masterDiv.append(popupButtonsDiv);var titleDiv=$("<div class='exportChartTitle'>Export Options</div>");popupButtonsDiv.append(titleDiv);var smallButton=$("<div class='exportChartPopupButton exportChartButtonNotLast'>Small</div>");smallButton.click(function(){$('.exportChartPopupButtonClicked').each(function(i,elt){$(elt).removeClass('exportChartPopupButtonClicked')})
$(this).addClass('exportChartPopupButtonClicked');$('#width').attr('disabled',true);$('#height').attr('disabled',true);$('#width').val(myself.baseSize);$('#height').val(myself.baseSize*(myself.chartComponent.chartDefinition.height/myself.chartComponent.chartDefinition.width));});popupButtonsDiv.append(smallButton);var mediumButton=$("<div class='exportChartPopupButton exportChartButtonNotLast exportChartButtonMiddle'>Medium</div>");mediumButton.click(function(){$('.exportChartPopupButtonClicked').each(function(i,elt){$(elt).removeClass('exportChartPopupButtonClicked')})
$(this).addClass('exportChartPopupButtonClicked');$('#width').attr('disabled',true);$('#height').attr('disabled',true);var size=myself.baseSize*myself.scalingFactor;$('#width').val(size);$('#height').val(size*(myself.chartComponent.chartDefinition.height/myself.chartComponent.chartDefinition.width));});mediumButton.getComponentData=function(){return[(myself.chartComponent.chartDefinition.width),(myself.chartComponent.chartDefinition.height)];}
popupButtonsDiv.append(mediumButton);var largeButton=$("<div class='exportChartPopupButton exportChartButtonNotLast exportChartButtonMiddle'>Large</div>");largeButton.click(function(){$('.exportChartPopupButtonClicked').each(function(i,elt){$(elt).removeClass('exportChartPopupButtonClicked')})
$(this).addClass('exportChartPopupButtonClicked');$('#width').attr('disabled',true);$('#height').attr('disabled',true);var size=myself.baseSize*myself.scalingFactor*myself.scalingFactor;$('#width').val(size);$('#height').val(size*(myself.chartComponent.chartDefinition.height/myself.chartComponent.chartDefinition.width));});popupButtonsDiv.append(largeButton);var customButton=$("<div class='exportChartPopupButton exportChartButtonMiddle'>Custom</div>");customButton.click(function(){$('.exportChartPopupButtonClicked').each(function(i,elt){$(elt).removeClass('exportChartPopupButtonClicked')})
$(this).addClass('exportChartPopupButtonClicked');$('#width').removeAttr('disabled');$('#height').removeAttr('disabled');$('#width').val(myself.chartComponent.chartDefinition.width);$('#height').val(myself.chartComponent.chartDefinition.height);});popupButtonsDiv.append(customButton);var inputsWidthDiv=$("<div class='exportChartInput'>&nbsp;&nbsp;&gt;&nbsp;&nbsp;&nbsp;Width:&nbsp;<input id='width'  disabled='true' style='width:50px' value='"+this.chartComponent.chartDefinition.width+"' onChange='javascript:$(\"#height\").val($(\"#width\").val() * "+(myself.chartComponent.chartDefinition.height/myself.chartComponent.chartDefinition.width)+");' type='text'></div>");popupButtonsDiv.append(inputsWidthDiv);var inputsHeightDiv=$("<div class='exportChartInput'>Height:&nbsp;</span><input id='height' disabled='true' style='width:50px' value='"+this.chartComponent.chartDefinition.height+"' type='text'></div>");popupButtonsDiv.append(inputsHeightDiv);var okButton=$("<div class='exportChartPopupButton exportChartOkButton'>Export</div>");okButton.click(function(){var dimensions,size;switch($('.exportChartPopupButtonClicked').text()){case"Small":dimensions=[myself.baseSize,myself.BaseSize*(myself.chartComponent.chartDefinition.height/myself.chartComponent.chartDefinition.width)];break;case"Medium":size=myself.baseSize*myself.scalingFactor;dimensions=[size,size*(myself.chartComponent.chartDefinition.height/myself.chartComponent.chartDefinition.width)];break;case"Large":size=myself.baseSize*myself.scalingFactor*myself.scalingFactor;dimensions=[size,size*(myself.chartComponent.chartDefinition.height/myself.chartComponent.chartDefinition.width)];break;case"Custom":default:dimensions=[$('#width').val(),$('#height').val()];break;}
var _exportIframe=$('<iframe style="display:none">');_exportIframe.detach();_exportIframe[0].src=url+"&attachmentName="+myself.dataExportAttachmentName+"."+effectiveExportType+"&paramwidth="+dimensions[0]+'&paramheight='+dimensions[1];_exportIframe.appendTo($('body'));});popupButtonsDiv.append(okButton);var img=$("<img src='"+url+"&paramwidth="+this.chartComponent.chartDefinition.width+"&paramheight="+this.chartComponent.chartDefinition.height+"'/>");var imgDiv=$("<div class='exportChartImageDiv'>");imgDiv.append(img);imgDiv.append("&nbsp;");masterDiv.append(imgDiv);$.fancybox({type:"html",content:masterDiv,width:totalWidth,height:this.chartComponent.chartDefinition.height+60});}});var PopupComponent=BaseComponent.extend({ph:undefined,arrow:undefined,content:undefined,cancel:undefined,$overlay:undefined,update:function(){var myself=this;this.content=$("#"+this.htmlObject).detach();this.ph=this.ph?this.ph.empty():$('<div>').appendTo($('body'));this.content.appendTo(this.ph);this.ph.hide();this.ph.addClass('popupComponent');this.cancel=$("<a>&nbsp;</a>");this.cancel.addClass("close").click(function(){myself.hide();});this.cancel.appendTo(this.ph);this.arrow=$("<div class='arrow'>").appendTo(this.ph);this.content.removeClass('hidePopup');},clone:function(params,comps,html){var that=this.base(params,comps,html);that.ph=this.ph.clone();that.ph.insertAfter(this.ph);that.ph.hide();that.ph.find("[id]").each(function(i,e){$e=$(e);var id=$e.attr("id");if(id&&id in html){$e.attr("id",html[id]);}else{$e.attr("id",id+'_'+Dashboards.duplicateIndex);}});return that;},popup:function(target,gravity){var pos=target.offset(),css={'top':'auto','bottom':'auto','left':'auto','right':'auto'},minimumDistance=20,vertexOffset=18-6,vertexSize=45,targetOffset,phHeight=this.ph.outerHeight(),phWidth=this.ph.outerWidth();gravity=gravity||this.gravity;var draggable=typeof this.draggable==="undefined"?true:this.draggable;if(this.horizontalScroll){$("#"+this.htmlObject).css("overflow-x","scroll");}
if(this.verticalScroll){$("#"+this.htmlObject).css("overflow-y","scroll");}
$("#"+this.htmlObject).parent().draggable({cancel:"#"+this.htmlObject});var closeOnClickOutside=typeof this.closeOnClickOutside==="undefined"?false:this.closeOnClickOutside;this.arrow.css({top:"",left:"",bottom:"",right:""});this.arrow.show();this.ph.removeClass('north south east west');var minWidth=minimumDistance,maxWidth=$(document).width()-minimumDistance,minHeight=minimumDistance,maxHeight=$(document).height()-minimumDistance,targetWidth,targetHeight,paddingNear,paddingFar;switch(gravity){case'N':paddingNear=parseInt(target.css('padding-top').replace(/(.*)px/,"$1"),10);css.left=this.center(target.outerWidth(),phWidth,pos.left,minWidth,maxWidth);targetHeight="ownerSVGElement"in target[0]?(target.attr("height")?target.attr("height")-0:0):target.height();targetOffset=pos.left-css.left-this.ph.css('border-top-width').replace(/(.*)px/,"$1");css.top=this.offset(targetHeight,phHeight,pos.top+paddingNear,vertexOffset,minHeight,maxHeight,'near');this.arrow.css('left',this.center(target.outerWidth(),vertexSize,targetOffset,0,phWidth));this.ph.addClass(css.top<pos.top?'north':'south');break;case'S':paddingNear=parseInt(target.css('padding-top').replace(/(.*)px/,"$1"),10);targetHeight="ownerSVGElement"in target[0]?(target.attr("height")?target.attr("height")-0:0):target.height();css.left=this.center(target.outerWidth(),phWidth,pos.left,minWidth,maxWidth);css.top=this.offset(targetHeight,phHeight,pos.top+paddingNear,vertexOffset,minHeight,maxHeight,'far');targetOffset=pos.left-css.left-this.ph.css('border-top-width').replace(/(.*)px/,"$1");this.arrow.css('left',this.center(target.outerWidth(),vertexSize,targetOffset,0,phWidth));this.ph.addClass(css.top<pos.top?'north':'south');break;case'W':paddingNear=parseInt(target.css('padding-left').replace(/(.*)px/,"$1"),10);css.top=this.center(target.outerHeight(),phHeight,pos.top,minHeight,maxHeight);targetWidth="ownerSVGElement"in target[0]?(target.attr("width")?target.attr("width")-0:0):target.width();css.left=this.offset(target.width(),phWidth,pos.left+paddingNear,vertexOffset,minWidth,maxWidth,'near');targetOffset=pos.top-css.top-this.ph.css('border-left-width').replace(/(.*)px/,"$1");this.arrow.css('top',this.center(target.outerHeight(),vertexSize,targetOffset,0,phHeight));this.ph.addClass(css.left<pos.left?'west':'east');break;case'E':paddingNear=parseInt(target.css('padding-left').replace(/(.*)px/,"$1"),10);css.top=this.center(target.outerHeight(),phHeight,pos.top,minHeight,maxHeight);targetWidth="ownerSVGElement"in target[0]?(target.attr("width")?target.attr("width")-0:0):target.width();css.left=this.offset(targetWidth,phWidth,pos.left+paddingNear,vertexOffset,minWidth,maxWidth,'far');targetOffset=pos.top-css.top-this.ph.css('border-left-width').replace(/(.*)px/,"$1");this.arrow.css('top',this.center(target.outerHeight(),vertexSize,targetOffset,0,phHeight));this.ph.addClass(css.left<pos.left?'west':'east');break;}
this.ph.css(css);this.ph.show();var escHandler,myself=this;escHandler=function(e){if(e.which==27){myself.ph.hide();$(document).unbind('keydown',escHandler);}};$(document).keydown(escHandler);var dragHandler;dragHandler=function(){myself.arrow.hide();}
this.ph.bind('drag',dragHandler);if(draggable){this.ph.draggable();}
var basePos,dragPos;this.ph.bind('touchstart',function(e){basePos=myself.ph.offset();dragPos={left:e.originalEvent.touches[0].pageX,top:e.originalEvent.touches[0].pageY};});this.ph.bind('touchmove',function(e){var finalPos={top:basePos.top+e.originalEvent.touches[0].pageY-dragPos.top,left:basePos.left+e.originalEvent.touches[0].pageX-dragPos.left};myself.ph.offset(finalPos);myself.arrow.hide();e.preventDefault();});if(closeOnClickOutside){if(!this.$overlay){this.$overlay=$('<div id="popupComponentOverlay"></div>');}
this.$overlay.appendTo("body").click(function(event){event.stopPropagation();myself.hide();})}},hide:function(){this.ph.hide();if(this.$overlay){this.$overlay.unbind('click');this.$overlay.detach();}},center:function(targetSize,phSize,offset,min,max){var candidate=offset+targetSize/2-phSize/2;return candidate+phSize>max?max-phSize:candidate<min?min:candidate;},offset:function(targetSize,phSize,offset,gap,min,max,range){var near=offset-phSize-gap,far=offset+targetSize+gap,nearAdmissible=near>min,farAdmissible=far+phSize<max;return range=='near'?(nearAdmissible||!farAdmissible?near:far):range=='far'?(farAdmissible||!nearAdmissible?far:near):near;}});var ExportPopupComponent=PopupComponent.extend({ph:undefined,arrow:undefined,content:undefined,cancel:undefined,dataComponent:undefined,chartComponent:undefined,baseSize:200,scalingFactor:1.5,clone:function(parameterRemap,componentRemap,htmlRemap){var dataComponent=this.dataComponent,chartComponent=this.chartComponent;delete this.dataComponent;delete this.chartComponent;var that=this.base(parameterRemap,componentRemap,htmlRemap);this.dataComponent=dataComponent;that.dataComponent=componentRemap[dataComponent.name]||dataComponent;this.chartComponent=chartComponent;var truncated=/render_(.*)/.test(chartComponent.name)?chartComponent.name.match(/render_(.*)/)[1]:null;if(componentRemap[chartComponent.name]){that.chartComponent=Dashboards.getComponentByName(componentRemap[chartComponent.name]);that.chartExportComponent=componentRemap[chartComponent.name];}else if(truncated&&componentRemap[truncated]){that.chartComponent=Dashboards.getComponentByName("render_"+componentRemap[truncated]);that.chartExportComponent=componentRemap[truncated];}else{that.chartComponent=chartComponent;}
that.chartComponent=componentRemap[chartComponent.name]||chartComponent;return that;},update:function(){var myself=this;if(this.ph){this.ph.remove();}
this.chartComponent=window["render_"+this.chartExportComponent];this.dataComponent=window["render_"+this.dataExportComponent];this.ph=$('<div>');$("#"+this.htmlObject).empty();var link=$('<div class="popupTitle">');link.text(this.title||'Export');link.click(function(e){myself.popup(link);e.stopPropagation();})
$("#"+this.htmlObject).append(link);if(this.chartComponent){var realChartExportLabel="Export Chart";if(this.chartExportLabel&&this.chartExportLabel.length>0)
realChartExportLabel=this.chartExportLabel;var chartExportElt=$('<div class="exportElement">');chartExportElt.text(realChartExportLabel);chartExportElt.click(function(){myself.exportChart();});chartExportElt.appendTo(myself.ph);}
if(this.dataComponent){var realTableExportLabel="Export Data";if(this.dataExportLabel&&this.dataExportLabel.length>0)
realTableExportLabel=this.dataExportLabel;var dataExportElt=$('<div class="exportElement">');dataExportElt.text(realTableExportLabel);dataExportElt.click(function(){myself.exportData();});dataExportElt.appendTo(myself.ph);}
$(this.contentLinks).each(function(i,elt){var popupElt=$('<div class="exportElement">');popupElt.text(elt[0]);popupElt.click(elt[1]);popupElt.appendTo(myself.ph);});this.ph.hide().appendTo($('body'));this.ph.addClass('popupComponent');this.ph.addClass('exportOptions');this.cancel=$("<a>&nbsp;</a>");this.cancel.addClass("close").click(function(){myself.hide();});this.cancel.appendTo(this.ph);this.arrow=$("<div class='arrow'>").appendTo(this.ph);},popup:function(target,gravity){this.base(target,gravity);var myself=this;var docClick=function(e){var x=e.pageX;var y=e.pageY;var linkPos=$("#"+myself.htmlObject).position();if((x<linkPos.left||x>linkPos.left+$("#"+myself.htmlObject).width())||(y<linkPos.top||y>linkPos.top+$("#"+myself.htmlObject).height())){myself.hide();$(document).unbind('click',docClick);}};$(document).click(docClick);},exportData:function(det){var effectiveExportType=det==undefined?this.dataExportType:det;Dashboards.log("Exporting to "+effectiveExportType);var parameters=this.dataComponent.parameters;var cd=(this.dataComponent.chartDefinition)?this.dataComponent.chartDefinition:this.dataComponent.queryDefinition;var dataAccess=cd.dataAccessId;var path=cd.path;var url="../cda/doQuery?path="+path+"&dataAccessId="+dataAccess+"&outputType="+effectiveExportType+"&settingattachmentName="+this.dataExportAttachmentName+"."+effectiveExportType;var doQueryParameters={};for(var i=0;i<parameters.length;i++){var paramName='param'+parameters[i][0];doQueryParameters[paramName]=parameters[i][0]!='metadata'?Dashboards.ev(Dashboards.getParameterValue(parameters[i][1])):'false';}
var theDoQuery=url+'&wrapItUp=wrapit';$.post(theDoQuery,doQueryParameters,function(uuid){var _exportIframe=_exportIframe||$('<iframe style="display:none">');_exportIframe.detach();_exportIframe[0].src=webAppPath+'/content/cda/unwrapQuery?'+$.param({"path":cd.path,"uuid":uuid});_exportIframe.appendTo($('body'));});},exportChart:function(cet){var effectiveExportType=cet==undefined?this.chartExportType:cet;Dashboards.log("Exporting to "+effectiveExportType);var parameters=this.chartComponent.parameters;var dataAccess=this.chartComponent.chartDefinition.dataAccessId;var path=this.chartComponent.chartDefinition.path;var loc=(Dashboards.getQueryParameter("solution")+"/"+Dashboards.getQueryParameter("path")+"/").replace(/\/\//g,"/");var url="../cgg/draw?script="+loc+this.chartExportComponent+".js&outputType="+effectiveExportType;var param;for(var i=0;i<parameters.length;i++){param=Dashboards.ev(Dashboards.getParameterValue(parameters[i][1]));if(param!==undefined){url+="&param"+parameters[i][0]+"="+(parameters[i][0]!='metadata'?encodeURIComponent(param):'false');}}
var myself=this;var masterDiv=$('<div class="exportChartMasterDiv">');var totalWidth=Math.max(700,this.chartComponent.chartDefinition.width);var popupButtonsDiv=$("<div class='exportChartPopupButtons' style='width:"+totalWidth+"px'>");masterDiv.append(popupButtonsDiv);var titleDiv=$("<div class='exportChartTitle'>Export Options</div>");popupButtonsDiv.append(titleDiv);var smallButton=$("<div class='exportChartPopupButton exportChartButtonNotLast'>Small</div>");smallButton.click(function(){$('.exportChartPopupButtonClicked').each(function(i,elt){$(elt).removeClass('exportChartPopupButtonClicked')})
$(this).addClass('exportChartPopupButtonClicked');$('#width').attr('disabled',true);$('#height').attr('disabled',true);$('#width').val(myself.baseSize);$('#height').val(myself.baseSize*(myself.chartComponent.chartDefinition.height/myself.chartComponent.chartDefinition.width));});popupButtonsDiv.append(smallButton);var mediumButton=$("<div class='exportChartPopupButton exportChartButtonNotLast exportChartButtonMiddle'>Medium</div>");mediumButton.click(function(){$('.exportChartPopupButtonClicked').each(function(i,elt){$(elt).removeClass('exportChartPopupButtonClicked')})
$(this).addClass('exportChartPopupButtonClicked');$('#width').attr('disabled',true);$('#height').attr('disabled',true);var size=myself.baseSize*myself.scalingFactor;$('#width').val(size);$('#height').val(size*(myself.chartComponent.chartDefinition.height/myself.chartComponent.chartDefinition.width));});mediumButton.getComponentData=function(){return[(myself.chartComponent.chartDefinition.width),(myself.chartComponent.chartDefinition.height)];}
popupButtonsDiv.append(mediumButton);var largeButton=$("<div class='exportChartPopupButton exportChartButtonNotLast exportChartButtonMiddle'>Large</div>");largeButton.click(function(){$('.exportChartPopupButtonClicked').each(function(i,elt){$(elt).removeClass('exportChartPopupButtonClicked')})
$(this).addClass('exportChartPopupButtonClicked');$('#width').attr('disabled',true);$('#height').attr('disabled',true);var size=myself.baseSize*myself.scalingFactor*myself.scalingFactor;$('#width').val(size);$('#height').val(size*(myself.chartComponent.chartDefinition.height/myself.chartComponent.chartDefinition.width));});popupButtonsDiv.append(largeButton);var customButton=$("<div class='exportChartPopupButton exportChartButtonMiddle'>Custom</div>");customButton.click(function(){$('.exportChartPopupButtonClicked').each(function(i,elt){$(elt).removeClass('exportChartPopupButtonClicked')})
$(this).addClass('exportChartPopupButtonClicked');$('#width').removeAttr('disabled');$('#height').removeAttr('disabled');$('#width').val(myself.chartComponent.chartDefinition.width);$('#height').val(myself.chartComponent.chartDefinition.height);});popupButtonsDiv.append(customButton);var inputsWidthDiv=$("<div class='exportChartInput'>&nbsp;&nbsp;&gt;&nbsp;&nbsp;&nbsp;Width:&nbsp;<input id='width'  disabled='true' style='width:50px' value='"+this.chartComponent.chartDefinition.width+"' onChange='javascript:$(\"#height\").val($(\"#width\").val() * "+(myself.chartComponent.chartDefinition.height/myself.chartComponent.chartDefinition.width)+");' type='text'></div>");popupButtonsDiv.append(inputsWidthDiv);var inputsHeightDiv=$("<div class='exportChartInput'>Height:&nbsp;</span><input id='height' disabled='true' style='width:50px' value='"+this.chartComponent.chartDefinition.height+"' type='text'></div>");popupButtonsDiv.append(inputsHeightDiv);var okButton=$("<div class='exportChartPopupButton exportChartOkButton'>Export</div>");okButton.click(function(){var dimensions,size;switch($('.exportChartPopupButtonClicked').text()){case"Small":dimensions=[myself.baseSize,myself.BaseSize*(myself.chartComponent.chartDefinition.height/myself.chartComponent.chartDefinition.width)];break;case"Medium":size=myself.baseSize*myself.scalingFactor;dimensions=[size,size*(myself.chartComponent.chartDefinition.height/myself.chartComponent.chartDefinition.width)];break;case"Large":size=myself.baseSize*myself.scalingFactor*myself.scalingFactor;dimensions=[size,size*(myself.chartComponent.chartDefinition.height/myself.chartComponent.chartDefinition.width)];break;case"Custom":default:dimensions=[$('#width').val(),$('#height').val()];break;}
var _exportIframe=$('<iframe style="display:none">');_exportIframe.detach();_exportIframe[0].src=url+"&attachmentName="+myself.dataExportAttachmentName+"."+effectiveExportType+"&paramwidth="+dimensions[0]+'&paramheight='+dimensions[1];_exportIframe.appendTo($('body'));});popupButtonsDiv.append(okButton);var img=$("<img src='"+url+"&paramwidth="+this.chartComponent.chartDefinition.width+"&paramheight="+this.chartComponent.chartDefinition.height+"'/>");var imgDiv=$("<div class='exportChartImageDiv'>");imgDiv.append(img);imgDiv.append("&nbsp;");masterDiv.append(imgDiv);$.fancybox({type:"html",content:masterDiv,width:totalWidth,height:this.chartComponent.chartDefinition.height+60});}});(function(){function R(){if(R.is(arguments[0],array)){var a=arguments[0],cnv=create[apply](R,a.splice(0,3+R.is(a[0],nu))),res=cnv.set();for(var i=0,ii=a[length];i<ii;i++){var j=a[i]||{};elements[has](j.type)&&res[push](cnv[j.type]().attr(j));}
return res;}
return create[apply](R,arguments);}
R.version="1.5.2";var separator=/[, ]+/,elements={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},formatrg=/\{(\d+)\}/g,proto="prototype",has="hasOwnProperty",doc=document,win=window,oldRaphael={was:Object[proto][has].call(win,"Raphael"),is:win.Raphael},Paper=function(){this.customAttributes={};},paperproto,appendChild="appendChild",apply="apply",concat="concat",supportsTouch="createTouch"in doc,E="",S=" ",Str=String,split="split",events="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend orientationchange touchcancel gesturestart gesturechange gestureend"[split](S),touchMap={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},join="join",length="length",lowerCase=Str[proto].toLowerCase,math=Math,mmax=math.max,mmin=math.min,abs=math.abs,pow=math.pow,PI=math.PI,nu="number",string="string",array="array",toString="toString",fillString="fill",objectToString=Object[proto][toString],paper={},push="push",ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,colourRegExp=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,isnan={"NaN":1,"Infinity":1,"-Infinity":1},bezierrg=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,round=math.round,setAttribute="setAttribute",toFloat=parseFloat,toInt=parseInt,ms=" progid:DXImageTransform.Microsoft",upperCase=Str[proto].toUpperCase,availableAttrs={blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/",opacity:1,path:"M0,0",r:0,rotation:0,rx:0,ry:0,scale:"1 1",src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",translation:"0 0",width:0,x:0,y:0},availableAnimAttrs={along:"along",blur:nu,"clip-rect":"csv",cx:nu,cy:nu,fill:"colour","fill-opacity":nu,"font-size":nu,height:nu,opacity:nu,path:"path",r:nu,rotation:"csv",rx:nu,ry:nu,scale:"csv",stroke:"colour","stroke-opacity":nu,"stroke-width":nu,translation:"csv",width:nu,x:nu,y:nu},rp="replace",animKeyFrames=/^(from|to|\d+%?)$/,commaSpaces=/\s*,\s*/,hsrg={hs:1,rg:1},p2s=/,?([achlmqrstvxz]),?/gi,pathCommand=/([achlmqstvz])[\s,]*((-?\d*\.?\d*(?:e[-+]?\d+)?\s*,?\s*)+)/ig,pathValues=/(-?\d*\.?\d*(?:e[-+]?\d+)?)\s*,?\s*/ig,radial_gradient=/^r(?:\(([^,]+?)\s*,\s*([^\)]+?)\))?/,sortByKey=function(a,b){return a.key-b.key;};R.type=(win.SVGAngle||doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML");if(R.type=="VML"){var d=doc.createElement("div"),b;d.innerHTML='<v:shape adj="1"/>';b=d.firstChild;b.style.behavior="url(#default#VML)";if(!(b&&typeof b.adj=="object")){return R.type=null;}
d=null;}
R.svg=!(R.vml=R.type=="VML");Paper[proto]=R[proto];paperproto=Paper[proto];R._id=0;R._oid=0;R.fn={};R.is=function(o,type){type=lowerCase.call(type);if(type=="finite"){return!isnan[has](+o);}
return(type=="null"&&o===null)||(type==typeof o)||(type=="object"&&o===Object(o))||(type=="array"&&Array.isArray&&Array.isArray(o))||objectToString.call(o).slice(8,-1).toLowerCase()==type;};R.angle=function(x1,y1,x2,y2,x3,y3){if(x3==null){var x=x1-x2,y=y1-y2;if(!x&&!y){return 0;}
return((x<0)*180+math.atan(-y/-x)*180/PI+360)%360;}else{return R.angle(x1,y1,x3,y3)-R.angle(x2,y2,x3,y3);}};R.rad=function(deg){return deg%360*PI/180;};R.deg=function(rad){return rad*180/PI%360;};R.snapTo=function(values,value,tolerance){tolerance=R.is(tolerance,"finite")?tolerance:10;if(R.is(values,array)){var i=values.length;while(i--)if(abs(values[i]-value)<=tolerance){return values[i];}}else{values=+values;var rem=value%values;if(rem<tolerance){return value-rem;}
if(rem>values-tolerance){return value-rem+values;}}
return value;};function createUUID(){var s=[],i=0;for(;i<32;i++){s[i]=(~~(math.random()*16))[toString](16);}
s[12]=4;s[16]=((s[16]&3)|8)[toString](16);return"r-"+s[join]("");}
R.setWindow=function(newwin){win=newwin;doc=win.document;};var toHex=function(color){if(R.vml){var trim=/^\s+|\s+$/g;var bod;try{var docum=new ActiveXObject("htmlfile");docum.write("<body>");docum.close();bod=docum.body;}catch(e){bod=createPopup().document.body;}
var range=bod.createTextRange();toHex=cacher(function(color){try{bod.style.color=Str(color)[rp](trim,E);var value=range.queryCommandValue("ForeColor");value=((value&255)<<16)|(value&65280)|((value&16711680)>>>16);return"#"+("000000"+value[toString](16)).slice(-6);}catch(e){return"none";}});}else{var i=doc.createElement("i");i.title="Rapha\xebl Colour Picker";i.style.display="none";doc.body[appendChild](i);toHex=cacher(function(color){i.style.color=color;return doc.defaultView.getComputedStyle(i,E).getPropertyValue("color");});}
return toHex(color);},hsbtoString=function(){return"hsb("+[this.h,this.s,this.b]+")";},hsltoString=function(){return"hsl("+[this.h,this.s,this.l]+")";},rgbtoString=function(){return this.hex;};R.hsb2rgb=function(h,s,b,o){if(R.is(h,"object")&&"h"in h&&"s"in h&&"b"in h){b=h.b;s=h.s;h=h.h;o=h.o;}
return R.hsl2rgb(h,s,b/2,o);};R.hsl2rgb=function(h,s,l,o){if(R.is(h,"object")&&"h"in h&&"s"in h&&"l"in h){l=h.l;s=h.s;h=h.h;}
if(h>1||s>1||l>1){h/=360;s/=100;l/=100;}
var rgb={},channels=["r","g","b"],t2,t1,t3,r,g,b;if(!s){rgb={r:l,g:l,b:l};}else{if(l<.5){t2=l*(1+s);}else{t2=l+s-l*s;}
t1=2*l-t2;for(var i=0;i<3;i++){t3=h+1/3*-(i-1);t3<0&&t3++;t3>1&&t3--;if(t3*6<1){rgb[channels[i]]=t1+(t2-t1)*6*t3;}else if(t3*2<1){rgb[channels[i]]=t2;}else if(t3*3<2){rgb[channels[i]]=t1+(t2-t1)*(2/3-t3)*6;}else{rgb[channels[i]]=t1;}}}
rgb.r*=255;rgb.g*=255;rgb.b*=255;rgb.hex="#"+(16777216|rgb.b|(rgb.g<<8)|(rgb.r<<16)).toString(16).slice(1);R.is(o,"finite")&&(rgb.opacity=o);rgb.toString=rgbtoString;return rgb;};R.rgb2hsb=function(red,green,blue){if(green==null&&R.is(red,"object")&&"r"in red&&"g"in red&&"b"in red){blue=red.b;green=red.g;red=red.r;}
if(green==null&&R.is(red,string)){var clr=R.getRGB(red);red=clr.r;green=clr.g;blue=clr.b;}
if(red>1||green>1||blue>1){red/=255;green/=255;blue/=255;}
var max=mmax(red,green,blue),min=mmin(red,green,blue),hue,saturation,brightness=max;if(min==max){return{h:0,s:0,b:max,toString:hsbtoString};}else{var delta=(max-min);saturation=delta/max;if(red==max){hue=(green-blue)/delta;}else if(green==max){hue=2+((blue-red)/delta);}else{hue=4+((red-green)/delta);}
hue/=6;hue<0&&hue++;hue>1&&hue--;}
return{h:hue,s:saturation,b:brightness,toString:hsbtoString};};R.rgb2hsl=function(red,green,blue){if(green==null&&R.is(red,"object")&&"r"in red&&"g"in red&&"b"in red){blue=red.b;green=red.g;red=red.r;}
if(green==null&&R.is(red,string)){var clr=R.getRGB(red);red=clr.r;green=clr.g;blue=clr.b;}
if(red>1||green>1||blue>1){red/=255;green/=255;blue/=255;}
var max=mmax(red,green,blue),min=mmin(red,green,blue),h,s,l=(max+min)/2,hsl;if(min==max){hsl={h:0,s:0,l:l};}else{var delta=max-min;s=l<.5?delta/(max+min):delta/(2-max-min);if(red==max){h=(green-blue)/delta;}else if(green==max){h=2+(blue-red)/delta;}else{h=4+(red-green)/delta;}
h/=6;h<0&&h++;h>1&&h--;hsl={h:h,s:s,l:l};}
hsl.toString=hsltoString;return hsl;};R._path2string=function(){return this.join(",")[rp](p2s,"$1");};function cacher(f,scope,postprocessor){function newf(){var arg=Array[proto].slice.call(arguments,0),args=arg[join]("\u25ba"),cache=newf.cache=newf.cache||{},count=newf.count=newf.count||[];if(cache[has](args)){return postprocessor?postprocessor(cache[args]):cache[args];}
count[length]>=1e3&&delete cache[count.shift()];count[push](args);cache[args]=f[apply](scope,arg);return postprocessor?postprocessor(cache[args]):cache[args];}
return newf;}
R.getRGB=cacher(function(colour){if(!colour||!!((colour=Str(colour)).indexOf("-")+1)){return{r:-1,g:-1,b:-1,hex:"none",error:1};}
if(colour=="none"){return{r:-1,g:-1,b:-1,hex:"none"};}!(hsrg[has](colour.toLowerCase().substring(0,2))||colour.charAt()=="#")&&(colour=toHex(colour));var res,red,green,blue,opacity,t,values,rgb=colour.match(colourRegExp);if(rgb){if(rgb[2]){blue=toInt(rgb[2].substring(5),16);green=toInt(rgb[2].substring(3,5),16);red=toInt(rgb[2].substring(1,3),16);}
if(rgb[3]){blue=toInt((t=rgb[3].charAt(3))+t,16);green=toInt((t=rgb[3].charAt(2))+t,16);red=toInt((t=rgb[3].charAt(1))+t,16);}
if(rgb[4]){values=rgb[4][split](commaSpaces);red=toFloat(values[0]);values[0].slice(-1)=="%"&&(red*=2.55);green=toFloat(values[1]);values[1].slice(-1)=="%"&&(green*=2.55);blue=toFloat(values[2]);values[2].slice(-1)=="%"&&(blue*=2.55);rgb[1].toLowerCase().slice(0,4)=="rgba"&&(opacity=toFloat(values[3]));values[3]&&values[3].slice(-1)=="%"&&(opacity/=100);}
if(rgb[5]){values=rgb[5][split](commaSpaces);red=toFloat(values[0]);values[0].slice(-1)=="%"&&(red*=2.55);green=toFloat(values[1]);values[1].slice(-1)=="%"&&(green*=2.55);blue=toFloat(values[2]);values[2].slice(-1)=="%"&&(blue*=2.55);(values[0].slice(-3)=="deg"||values[0].slice(-1)=="\xb0")&&(red/=360);rgb[1].toLowerCase().slice(0,4)=="hsba"&&(opacity=toFloat(values[3]));values[3]&&values[3].slice(-1)=="%"&&(opacity/=100);return R.hsb2rgb(red,green,blue,opacity);}
if(rgb[6]){values=rgb[6][split](commaSpaces);red=toFloat(values[0]);values[0].slice(-1)=="%"&&(red*=2.55);green=toFloat(values[1]);values[1].slice(-1)=="%"&&(green*=2.55);blue=toFloat(values[2]);values[2].slice(-1)=="%"&&(blue*=2.55);(values[0].slice(-3)=="deg"||values[0].slice(-1)=="\xb0")&&(red/=360);rgb[1].toLowerCase().slice(0,4)=="hsla"&&(opacity=toFloat(values[3]));values[3]&&values[3].slice(-1)=="%"&&(opacity/=100);return R.hsl2rgb(red,green,blue,opacity);}
rgb={r:red,g:green,b:blue};rgb.hex="#"+(16777216|blue|(green<<8)|(red<<16)).toString(16).slice(1);R.is(opacity,"finite")&&(rgb.opacity=opacity);return rgb;}
return{r:-1,g:-1,b:-1,hex:"none",error:1};},R);R.getColor=function(value){var start=this.getColor.start=this.getColor.start||{h:0,s:1,b:value||.75},rgb=this.hsb2rgb(start.h,start.s,start.b);start.h+=.075;if(start.h>1){start.h=0;start.s-=.2;start.s<=0&&(this.getColor.start={h:0,s:1,b:start.b});}
return rgb.hex;};R.getColor.reset=function(){delete this.start;};R.parsePathString=cacher(function(pathString){if(!pathString){return null;}
var paramCounts={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},data=[];if(R.is(pathString,array)&&R.is(pathString[0],array)){data=pathClone(pathString);}
if(!data[length]){Str(pathString)[rp](pathCommand,function(a,b,c){var params=[],name=lowerCase.call(b);c[rp](pathValues,function(a,b){b&&params[push](+b);});if(name=="m"&&params[length]>2){data[push]([b][concat](params.splice(0,2)));name="l";b=b=="m"?"l":"L";}
while(params[length]>=paramCounts[name]){data[push]([b][concat](params.splice(0,paramCounts[name])));if(!paramCounts[name]){break;}}});}
data[toString]=R._path2string;return data;});R.findDotsAtSegment=function(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t){var t1=1-t,x=pow(t1,3)*p1x+pow(t1,2)*3*t*c1x+t1*3*t*t*c2x+pow(t,3)*p2x,y=pow(t1,3)*p1y+pow(t1,2)*3*t*c1y+t1*3*t*t*c2y+pow(t,3)*p2y,mx=p1x+2*t*(c1x-p1x)+t*t*(c2x-2*c1x+p1x),my=p1y+2*t*(c1y-p1y)+t*t*(c2y-2*c1y+p1y),nx=c1x+2*t*(c2x-c1x)+t*t*(p2x-2*c2x+c1x),ny=c1y+2*t*(c2y-c1y)+t*t*(p2y-2*c2y+c1y),ax=(1-t)*p1x+t*c1x,ay=(1-t)*p1y+t*c1y,cx=(1-t)*c2x+t*p2x,cy=(1-t)*c2y+t*p2y,alpha=(90-math.atan((mx-nx)/(my-ny))*180/PI);(mx>nx||my<ny)&&(alpha+=180);return{x:x,y:y,m:{x:mx,y:my},n:{x:nx,y:ny},start:{x:ax,y:ay},end:{x:cx,y:cy},alpha:alpha};};var pathDimensions=cacher(function(path){if(!path){return{x:0,y:0,width:0,height:0};}
path=path2curve(path);var x=0,y=0,X=[],Y=[],p;for(var i=0,ii=path[length];i<ii;i++){p=path[i];if(p[0]=="M"){x=p[1];y=p[2];X[push](x);Y[push](y);}else{var dim=curveDim(x,y,p[1],p[2],p[3],p[4],p[5],p[6]);X=X[concat](dim.min.x,dim.max.x);Y=Y[concat](dim.min.y,dim.max.y);x=p[5];y=p[6];}}
var xmin=mmin[apply](0,X),ymin=mmin[apply](0,Y);return{x:xmin,y:ymin,width:mmax[apply](0,X)-xmin,height:mmax[apply](0,Y)-ymin};}),pathClone=function(pathArray){var res=[];if(!R.is(pathArray,array)||!R.is(pathArray&&pathArray[0],array)){pathArray=R.parsePathString(pathArray);}
for(var i=0,ii=pathArray[length];i<ii;i++){res[i]=[];for(var j=0,jj=pathArray[i][length];j<jj;j++){res[i][j]=pathArray[i][j];}}
res[toString]=R._path2string;return res;},pathToRelative=cacher(function(pathArray){if(!R.is(pathArray,array)||!R.is(pathArray&&pathArray[0],array)){pathArray=R.parsePathString(pathArray);}
var res=[],x=0,y=0,mx=0,my=0,start=0;if(pathArray[0][0]=="M"){x=pathArray[0][1];y=pathArray[0][2];mx=x;my=y;start++;res[push](["M",x,y]);}
for(var i=start,ii=pathArray[length];i<ii;i++){var r=res[i]=[],pa=pathArray[i];if(pa[0]!=lowerCase.call(pa[0])){r[0]=lowerCase.call(pa[0]);switch(r[0]){case"a":r[1]=pa[1];r[2]=pa[2];r[3]=pa[3];r[4]=pa[4];r[5]=pa[5];r[6]=+(pa[6]-x).toFixed(3);r[7]=+(pa[7]-y).toFixed(3);break;case"v":r[1]=+(pa[1]-y).toFixed(3);break;case"m":mx=pa[1];my=pa[2];default:for(var j=1,jj=pa[length];j<jj;j++){r[j]=+(pa[j]-((j%2)?x:y)).toFixed(3);}}}else{r=res[i]=[];if(pa[0]=="m"){mx=pa[1]+x;my=pa[2]+y;}
for(var k=0,kk=pa[length];k<kk;k++){res[i][k]=pa[k];}}
var len=res[i][length];switch(res[i][0]){case"z":x=mx;y=my;break;case"h":x+=+res[i][len-1];break;case"v":y+=+res[i][len-1];break;default:x+=+res[i][len-2];y+=+res[i][len-1];}}
res[toString]=R._path2string;return res;},0,pathClone),pathToAbsolute=cacher(function(pathArray){if(!R.is(pathArray,array)||!R.is(pathArray&&pathArray[0],array)){pathArray=R.parsePathString(pathArray);}
var res=[],x=0,y=0,mx=0,my=0,start=0;if(pathArray[0][0]=="M"){x=+pathArray[0][1];y=+pathArray[0][2];mx=x;my=y;start++;res[0]=["M",x,y];}
for(var i=start,ii=pathArray[length];i<ii;i++){var r=res[i]=[],pa=pathArray[i];if(pa[0]!=upperCase.call(pa[0])){r[0]=upperCase.call(pa[0]);switch(r[0]){case"A":r[1]=pa[1];r[2]=pa[2];r[3]=pa[3];r[4]=pa[4];r[5]=pa[5];r[6]=+(pa[6]+x);r[7]=+(pa[7]+y);break;case"V":r[1]=+pa[1]+y;break;case"H":r[1]=+pa[1]+x;break;case"M":mx=+pa[1]+x;my=+pa[2]+y;default:for(var j=1,jj=pa[length];j<jj;j++){r[j]=+pa[j]+((j%2)?x:y);}}}else{for(var k=0,kk=pa[length];k<kk;k++){res[i][k]=pa[k];}}
switch(r[0]){case"Z":x=mx;y=my;break;case"H":x=r[1];break;case"V":y=r[1];break;case"M":mx=res[i][res[i][length]-2];my=res[i][res[i][length]-1];default:x=res[i][res[i][length]-2];y=res[i][res[i][length]-1];}}
res[toString]=R._path2string;return res;},null,pathClone),l2c=function(x1,y1,x2,y2){return[x1,y1,x2,y2,x2,y2];},q2c=function(x1,y1,ax,ay,x2,y2){var _13=1/3,_23=2/3;return[_13*x1+_23*ax,_13*y1+_23*ay,_13*x2+_23*ax,_13*y2+_23*ay,x2,y2];},a2c=function(x1,y1,rx,ry,angle,large_arc_flag,sweep_flag,x2,y2,recursive){var _120=PI*120/180,rad=PI/180*(+angle||0),res=[],xy,rotate=cacher(function(x,y,rad){var X=x*math.cos(rad)-y*math.sin(rad),Y=x*math.sin(rad)+y*math.cos(rad);return{x:X,y:Y};});if(!recursive){xy=rotate(x1,y1,-rad);x1=xy.x;y1=xy.y;xy=rotate(x2,y2,-rad);x2=xy.x;y2=xy.y;var cos=math.cos(PI/180*angle),sin=math.sin(PI/180*angle),x=(x1-x2)/2,y=(y1-y2)/2;var h=(x*x)/(rx*rx)+(y*y)/(ry*ry);if(h>1){h=math.sqrt(h);rx=h*rx;ry=h*ry;}
var rx2=rx*rx,ry2=ry*ry,k=(large_arc_flag==sweep_flag?-1:1)*math.sqrt(abs((rx2*ry2-rx2*y*y-ry2*x*x)/(rx2*y*y+ry2*x*x))),cx=k*rx*y/ry+(x1+x2)/2,cy=k*-ry*x/rx+(y1+y2)/2,f1=math.asin(((y1-cy)/ry).toFixed(9)),f2=math.asin(((y2-cy)/ry).toFixed(9));f1=x1<cx?PI-f1:f1;f2=x2<cx?PI-f2:f2;f1<0&&(f1=PI*2+f1);f2<0&&(f2=PI*2+f2);if(sweep_flag&&f1>f2){f1=f1-PI*2;}
if(!sweep_flag&&f2>f1){f2=f2-PI*2;}}else{f1=recursive[0];f2=recursive[1];cx=recursive[2];cy=recursive[3];}
var df=f2-f1;if(abs(df)>_120){var f2old=f2,x2old=x2,y2old=y2;f2=f1+_120*(sweep_flag&&f2>f1?1:-1);x2=cx+rx*math.cos(f2);y2=cy+ry*math.sin(f2);res=a2c(x2,y2,rx,ry,angle,0,sweep_flag,x2old,y2old,[f2,f2old,cx,cy]);}
df=f2-f1;var c1=math.cos(f1),s1=math.sin(f1),c2=math.cos(f2),s2=math.sin(f2),t=math.tan(df/4),hx=4/3*rx*t,hy=4/3*ry*t,m1=[x1,y1],m2=[x1+hx*s1,y1-hy*c1],m3=[x2+hx*s2,y2-hy*c2],m4=[x2,y2];m2[0]=2*m1[0]-m2[0];m2[1]=2*m1[1]-m2[1];if(recursive){return[m2,m3,m4][concat](res);}else{res=[m2,m3,m4][concat](res)[join]()[split](",");var newres=[];for(var i=0,ii=res[length];i<ii;i++){newres[i]=i%2?rotate(res[i-1],res[i],rad).y:rotate(res[i],res[i+1],rad).x;}
return newres;}},findDotAtSegment=function(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t){var t1=1-t;return{x:pow(t1,3)*p1x+pow(t1,2)*3*t*c1x+t1*3*t*t*c2x+pow(t,3)*p2x,y:pow(t1,3)*p1y+pow(t1,2)*3*t*c1y+t1*3*t*t*c2y+pow(t,3)*p2y};},curveDim=cacher(function(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y){var a=(c2x-2*c1x+p1x)-(p2x-2*c2x+c1x),b=2*(c1x-p1x)-2*(c2x-c1x),c=p1x-c1x,t1=(-b+math.sqrt(b*b-4*a*c))/2/a,t2=(-b-math.sqrt(b*b-4*a*c))/2/a,y=[p1y,p2y],x=[p1x,p2x],dot;abs(t1)>"1e12"&&(t1=.5);abs(t2)>"1e12"&&(t2=.5);if(t1>0&&t1<1){dot=findDotAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t1);x[push](dot.x);y[push](dot.y);}
if(t2>0&&t2<1){dot=findDotAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t2);x[push](dot.x);y[push](dot.y);}
a=(c2y-2*c1y+p1y)-(p2y-2*c2y+c1y);b=2*(c1y-p1y)-2*(c2y-c1y);c=p1y-c1y;t1=(-b+math.sqrt(b*b-4*a*c))/2/a;t2=(-b-math.sqrt(b*b-4*a*c))/2/a;abs(t1)>"1e12"&&(t1=.5);abs(t2)>"1e12"&&(t2=.5);if(t1>0&&t1<1){dot=findDotAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t1);x[push](dot.x);y[push](dot.y);}
if(t2>0&&t2<1){dot=findDotAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t2);x[push](dot.x);y[push](dot.y);}
return{min:{x:mmin[apply](0,x),y:mmin[apply](0,y)},max:{x:mmax[apply](0,x),y:mmax[apply](0,y)}};}),path2curve=cacher(function(path,path2){var p=pathToAbsolute(path),p2=path2&&pathToAbsolute(path2),attrs={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},attrs2={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},processPath=function(path,d){var nx,ny;if(!path){return["C",d.x,d.y,d.x,d.y,d.x,d.y];}!(path[0]in{T:1,Q:1})&&(d.qx=d.qy=null);switch(path[0]){case"M":d.X=path[1];d.Y=path[2];break;case"A":path=["C"][concat](a2c[apply](0,[d.x,d.y][concat](path.slice(1))));break;case"S":nx=d.x+(d.x-(d.bx||d.x));ny=d.y+(d.y-(d.by||d.y));path=["C",nx,ny][concat](path.slice(1));break;case"T":d.qx=d.x+(d.x-(d.qx||d.x));d.qy=d.y+(d.y-(d.qy||d.y));path=["C"][concat](q2c(d.x,d.y,d.qx,d.qy,path[1],path[2]));break;case"Q":d.qx=path[1];d.qy=path[2];path=["C"][concat](q2c(d.x,d.y,path[1],path[2],path[3],path[4]));break;case"L":path=["C"][concat](l2c(d.x,d.y,path[1],path[2]));break;case"H":path=["C"][concat](l2c(d.x,d.y,path[1],d.y));break;case"V":path=["C"][concat](l2c(d.x,d.y,d.x,path[1]));break;case"Z":path=["C"][concat](l2c(d.x,d.y,d.X,d.Y));break;}
return path;},fixArc=function(pp,i){if(pp[i][length]>7){pp[i].shift();var pi=pp[i];while(pi[length]){pp.splice(i++,0,["C"][concat](pi.splice(0,6)));}
pp.splice(i,1);ii=mmax(p[length],p2&&p2[length]||0);}},fixM=function(path1,path2,a1,a2,i){if(path1&&path2&&path1[i][0]=="M"&&path2[i][0]!="M"){path2.splice(i,0,["M",a2.x,a2.y]);a1.bx=0;a1.by=0;a1.x=path1[i][1];a1.y=path1[i][2];ii=mmax(p[length],p2&&p2[length]||0);}};for(var i=0,ii=mmax(p[length],p2&&p2[length]||0);i<ii;i++){p[i]=processPath(p[i],attrs);fixArc(p,i);p2&&(p2[i]=processPath(p2[i],attrs2));p2&&fixArc(p2,i);fixM(p,p2,attrs,attrs2,i);fixM(p2,p,attrs2,attrs,i);var seg=p[i],seg2=p2&&p2[i],seglen=seg[length],seg2len=p2&&seg2[length];attrs.x=seg[seglen-2];attrs.y=seg[seglen-1];attrs.bx=toFloat(seg[seglen-4])||attrs.x;attrs.by=toFloat(seg[seglen-3])||attrs.y;attrs2.bx=p2&&(toFloat(seg2[seg2len-4])||attrs2.x);attrs2.by=p2&&(toFloat(seg2[seg2len-3])||attrs2.y);attrs2.x=p2&&seg2[seg2len-2];attrs2.y=p2&&seg2[seg2len-1];}
return p2?[p,p2]:p;},null,pathClone),parseDots=cacher(function(gradient){var dots=[];for(var i=0,ii=gradient[length];i<ii;i++){var dot={},par=gradient[i].match(/^([^:]*):?([\d\.]*)/);dot.color=R.getRGB(par[1]);if(dot.color.error){return null;}
dot.color=dot.color.hex;par[2]&&(dot.offset=par[2]+"%");dots[push](dot);}
for(i=1,ii=dots[length]-1;i<ii;i++){if(!dots[i].offset){var start=toFloat(dots[i-1].offset||0),end=0;for(var j=i+1;j<ii;j++){if(dots[j].offset){end=dots[j].offset;break;}}
if(!end){end=100;j=ii;}
end=toFloat(end);var d=(end-start)/(j-i+1);for(;i<j;i++){start+=d;dots[i].offset=start+"%";}}}
return dots;}),getContainer=function(x,y,w,h){var container;if(R.is(x,string)||R.is(x,"object")){container=R.is(x,string)?doc.getElementById(x):x;if(container.tagName){if(y==null){return{container:container,width:container.style.pixelWidth||container.offsetWidth,height:container.style.pixelHeight||container.offsetHeight};}else{return{container:container,width:y,height:w};}}}else{return{container:1,x:x,y:y,width:w,height:h};}},plugins=function(con,add){var that=this;for(var prop in add){if(add[has](prop)&&!(prop in con)){switch(typeof add[prop]){case"function":(function(f){con[prop]=con===that?f:function(){return f[apply](that,arguments);};})(add[prop]);break;case"object":con[prop]=con[prop]||{};plugins.call(this,con[prop],add[prop]);break;default:con[prop]=add[prop];break;}}}},tear=function(el,paper){el==paper.top&&(paper.top=el.prev);el==paper.bottom&&(paper.bottom=el.next);el.next&&(el.next.prev=el.prev);el.prev&&(el.prev.next=el.next);},tofront=function(el,paper){if(paper.top===el){return;}
tear(el,paper);el.next=null;el.prev=paper.top;paper.top.next=el;paper.top=el;},toback=function(el,paper){if(paper.bottom===el){return;}
tear(el,paper);el.next=paper.bottom;el.prev=null;paper.bottom.prev=el;paper.bottom=el;},insertafter=function(el,el2,paper){tear(el,paper);el2==paper.top&&(paper.top=el);el2.next&&(el2.next.prev=el);el.next=el2.next;el.prev=el2;el2.next=el;},insertbefore=function(el,el2,paper){tear(el,paper);el2==paper.bottom&&(paper.bottom=el);el2.prev&&(el2.prev.next=el);el.prev=el2.prev;el2.prev=el;el.next=el2;},removed=function(methodname){return function(){throw new Error("Rapha\xebl: you are calling to method \u201c"+methodname+"\u201d of removed object");};};R.pathToRelative=pathToRelative;if(R.svg){paperproto.svgns="http://www.w3.org/2000/svg";paperproto.xlink="http://www.w3.org/1999/xlink";round=function(num){return+num+(~~num===num)*.5;};var $=function(el,attr){if(attr){for(var key in attr){if(attr[has](key)){el[setAttribute](key,Str(attr[key]));}}}else{el=doc.createElementNS(paperproto.svgns,el);el.style.webkitTapHighlightColor="rgba(0,0,0,0)";return el;}};R[toString]=function(){return"Your browser supports SVG.\nYou are running Rapha\xebl "+this.version;};var thePath=function(pathString,SVG){var el=$("path");SVG.canvas&&SVG.canvas[appendChild](el);var p=new Element(el,SVG);p.type="path";setFillAndStroke(p,{fill:"none",stroke:"#000",path:pathString});return p;};var addGradientFill=function(o,gradient,SVG){var type="linear",fx=.5,fy=.5,s=o.style;gradient=Str(gradient)[rp](radial_gradient,function(all,_fx,_fy){type="radial";if(_fx&&_fy){fx=toFloat(_fx);fy=toFloat(_fy);var dir=((fy>.5)*2-1);pow(fx-.5,2)+pow(fy-.5,2)>.25&&(fy=math.sqrt(.25-pow(fx-.5,2))*dir+.5)&&fy!=.5&&(fy=fy.toFixed(5)-1e-5*dir);}
return E;});gradient=gradient[split](/\s*\-\s*/);if(type=="linear"){var angle=gradient.shift();angle=-toFloat(angle);if(isNaN(angle)){return null;}
var vector=[0,0,math.cos(angle*PI/180),math.sin(angle*PI/180)],max=1/(mmax(abs(vector[2]),abs(vector[3]))||1);vector[2]*=max;vector[3]*=max;if(vector[2]<0){vector[0]=-vector[2];vector[2]=0;}
if(vector[3]<0){vector[1]=-vector[3];vector[3]=0;}}
var dots=parseDots(gradient);if(!dots){return null;}
var id=o.getAttribute(fillString);id=id.match(/^url\(#(.*)\)$/);id&&SVG.defs.removeChild(doc.getElementById(id[1]));var el=$(type+"Gradient");el.id=createUUID();$(el,type=="radial"?{fx:fx,fy:fy}:{x1:vector[0],y1:vector[1],x2:vector[2],y2:vector[3]});SVG.defs[appendChild](el);for(var i=0,ii=dots[length];i<ii;i++){var stop=$("stop");$(stop,{offset:dots[i].offset?dots[i].offset:!i?"0%":"100%","stop-color":dots[i].color||"#fff"});el[appendChild](stop);}
$(o,{fill:"url(#"+el.id+")",opacity:1,"fill-opacity":1});s.fill=E;s.opacity=1;s.fillOpacity=1;return 1;};var updatePosition=function(o){var bbox=o.getBBox();$(o.pattern,{patternTransform:R.format("translate({0},{1})",bbox.x,bbox.y)});};var setFillAndStroke=function(o,params){var dasharray={"":[0],"none":[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},node=o.node,attrs=o.attrs,rot=o.rotate(),addDashes=function(o,value){value=dasharray[lowerCase.call(value)];if(value){var width=o.attrs["stroke-width"]||"1",butt={round:width,square:width,butt:0}[o.attrs["stroke-linecap"]||params["stroke-linecap"]]||0,dashes=[];var i=value[length];while(i--){dashes[i]=value[i]*width+((i%2)?1:-1)*butt;}
$(node,{"stroke-dasharray":dashes[join](",")});}};params[has]("rotation")&&(rot=params.rotation);var rotxy=Str(rot)[split](separator);if(!(rotxy.length-1)){rotxy=null;}else{rotxy[1]=+rotxy[1];rotxy[2]=+rotxy[2];}
toFloat(rot)&&o.rotate(0,true);for(var att in params){if(params[has](att)){if(!availableAttrs[has](att)){continue;}
var value=params[att];attrs[att]=value;switch(att){case"blur":o.blur(value);break;case"rotation":o.rotate(value,true);break;case"href":case"title":case"target":var pn=node.parentNode;if(lowerCase.call(pn.tagName)!="a"){var hl=$("a");pn.insertBefore(hl,node);hl[appendChild](node);pn=hl;}
if(att=="target"&&value=="blank"){pn.setAttributeNS(o.paper.xlink,"show","new");}else{pn.setAttributeNS(o.paper.xlink,att,value);}
break;case"cursor":node.style.cursor=value;break;case"clip-rect":var rect=Str(value)[split](separator);if(rect[length]==4){o.clip&&o.clip.parentNode.parentNode.removeChild(o.clip.parentNode);var el=$("clipPath"),rc=$("rect");el.id=createUUID();$(rc,{x:rect[0],y:rect[1],width:rect[2],height:rect[3]});el[appendChild](rc);o.paper.defs[appendChild](el);$(node,{"clip-path":"url(#"+el.id+")"});o.clip=rc;}
if(!value){var clip=doc.getElementById(node.getAttribute("clip-path")[rp](/(^url\(#|\)$)/g,E));clip&&clip.parentNode.removeChild(clip);$(node,{"clip-path":E});delete o.clip;}
break;case"path":if(o.type=="path"){$(node,{d:value?attrs.path=pathToAbsolute(value):"M0,0"});}
break;case"width":node[setAttribute](att,value);if(attrs.fx){att="x";value=attrs.x;}else{break;}
case"x":if(attrs.fx){value=-attrs.x-(attrs.width||0);}
case"rx":if(att=="rx"&&o.type=="rect"){break;}
case"cx":rotxy&&(att=="x"||att=="cx")&&(rotxy[1]+=value-attrs[att]);node[setAttribute](att,value);o.pattern&&updatePosition(o);break;case"height":node[setAttribute](att,value);if(attrs.fy){att="y";value=attrs.y;}else{break;}
case"y":if(attrs.fy){value=-attrs.y-(attrs.height||0);}
case"ry":if(att=="ry"&&o.type=="rect"){break;}
case"cy":rotxy&&(att=="y"||att=="cy")&&(rotxy[2]+=value-attrs[att]);node[setAttribute](att,value);o.pattern&&updatePosition(o);break;case"r":if(o.type=="rect"){$(node,{rx:value,ry:value});}else{node[setAttribute](att,value);}
break;case"src":if(o.type=="image"){node.setAttributeNS(o.paper.xlink,"href",value);}
break;case"stroke-width":node.style.strokeWidth=value;node[setAttribute](att,value);if(attrs["stroke-dasharray"]){addDashes(o,attrs["stroke-dasharray"]);}
break;case"stroke-dasharray":addDashes(o,value);break;case"translation":var xy=Str(value)[split](separator);xy[0]=+xy[0]||0;xy[1]=+xy[1]||0;if(rotxy){rotxy[1]+=xy[0];rotxy[2]+=xy[1];}
translate.call(o,xy[0],xy[1]);break;case"scale":xy=Str(value)[split](separator);o.scale(+xy[0]||1,+xy[1]||+xy[0]||1,isNaN(toFloat(xy[2]))?null:+xy[2],isNaN(toFloat(xy[3]))?null:+xy[3]);break;case fillString:var isURL=Str(value).match(ISURL);if(isURL){el=$("pattern");var ig=$("image");el.id=createUUID();$(el,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1});$(ig,{x:0,y:0});ig.setAttributeNS(o.paper.xlink,"href",isURL[1]);el[appendChild](ig);var img=doc.createElement("img");img.style.cssText="position:absolute;left:-9999em;top-9999em";img.onload=function(){$(el,{width:this.offsetWidth,height:this.offsetHeight});$(ig,{width:this.offsetWidth,height:this.offsetHeight});doc.body.removeChild(this);o.paper.safari();};doc.body[appendChild](img);img.src=isURL[1];o.paper.defs[appendChild](el);node.style.fill="url(#"+el.id+")";$(node,{fill:"url(#"+el.id+")"});o.pattern=el;o.pattern&&updatePosition(o);break;}
var clr=R.getRGB(value);if(!clr.error){delete params.gradient;delete attrs.gradient;!R.is(attrs.opacity,"undefined")&&R.is(params.opacity,"undefined")&&$(node,{opacity:attrs.opacity});!R.is(attrs["fill-opacity"],"undefined")&&R.is(params["fill-opacity"],"undefined")&&$(node,{"fill-opacity":attrs["fill-opacity"]});}else if((({circle:1,ellipse:1})[has](o.type)||Str(value).charAt()!="r")&&addGradientFill(node,value,o.paper)){attrs.gradient=value;attrs.fill="none";break;}
clr[has]("opacity")&&$(node,{"fill-opacity":clr.opacity>1?clr.opacity/100:clr.opacity});case"stroke":clr=R.getRGB(value);node[setAttribute](att,clr.hex);att=="stroke"&&clr[has]("opacity")&&$(node,{"stroke-opacity":clr.opacity>1?clr.opacity/100:clr.opacity});break;case"gradient":(({circle:1,ellipse:1})[has](o.type)||Str(value).charAt()!="r")&&addGradientFill(node,value,o.paper);break;case"opacity":if(attrs.gradient&&!attrs[has]("stroke-opacity")){$(node,{"stroke-opacity":value>1?value/100:value});}
case"fill-opacity":if(attrs.gradient){var gradient=doc.getElementById(node.getAttribute(fillString)[rp](/^url\(#|\)$/g,E));if(gradient){var stops=gradient.getElementsByTagName("stop");stops[stops[length]-1][setAttribute]("stop-opacity",value);}
break;}
default:att=="font-size"&&(value=toInt(value,10)+"px");var cssrule=att[rp](/(\-.)/g,function(w){return upperCase.call(w.substring(1));});node.style[cssrule]=value;node[setAttribute](att,value);break;}}}
tuneText(o,params);if(rotxy){o.rotate(rotxy.join(S));}else{toFloat(rot)&&o.rotate(rot,true);}};var leading=1.2,tuneText=function(el,params){if(el.type!="text"||!(params[has]("text")||params[has]("font")||params[has]("font-size")||params[has]("x")||params[has]("y"))){return;}
var a=el.attrs,node=el.node,fontSize=node.firstChild?toInt(doc.defaultView.getComputedStyle(node.firstChild,E).getPropertyValue("font-size"),10):10;if(params[has]("text")){a.text=params.text;while(node.firstChild){node.removeChild(node.firstChild);}
var texts=Str(params.text)[split]("\n");for(var i=0,ii=texts[length];i<ii;i++)if(texts[i]){var tspan=$("tspan");i&&$(tspan,{dy:fontSize*leading,x:a.x});tspan[appendChild](doc.createTextNode(texts[i]));node[appendChild](tspan);}}else{texts=node.getElementsByTagName("tspan");for(i=0,ii=texts[length];i<ii;i++){i&&$(texts[i],{dy:fontSize*leading,x:a.x});}}
$(node,{y:a.y});var bb=el.getBBox(),dif=a.y-(bb.y+bb.height/2);dif&&R.is(dif,"finite")&&$(node,{y:a.y+dif});},Element=function(node,svg){var X=0,Y=0;this[0]=node;this.id=R._oid++;this.node=node;node.raphael=this;this.paper=svg;this.attrs=this.attrs||{};this.transformations=[];this._={tx:0,ty:0,rt:{deg:0,cx:0,cy:0},sx:1,sy:1};!svg.bottom&&(svg.bottom=this);this.prev=svg.top;svg.top&&(svg.top.next=this);svg.top=this;this.next=null;};var elproto=Element[proto];Element[proto].rotate=function(deg,cx,cy){if(this.removed){return this;}
if(deg==null){if(this._.rt.cx){return[this._.rt.deg,this._.rt.cx,this._.rt.cy][join](S);}
return this._.rt.deg;}
var bbox=this.getBBox();deg=Str(deg)[split](separator);if(deg[length]-1){cx=toFloat(deg[1]);cy=toFloat(deg[2]);}
deg=toFloat(deg[0]);if(cx!=null&&cx!==false){this._.rt.deg=deg;}else{this._.rt.deg+=deg;}
(cy==null)&&(cx=null);this._.rt.cx=cx;this._.rt.cy=cy;cx=cx==null?bbox.x+bbox.width/2:cx;cy=cy==null?bbox.y+bbox.height/2:cy;if(this._.rt.deg){this.transformations[0]=R.format("rotate({0} {1} {2})",this._.rt.deg,cx,cy);this.clip&&$(this.clip,{transform:R.format("rotate({0} {1} {2})",-this._.rt.deg,cx,cy)});}else{this.transformations[0]=E;this.clip&&$(this.clip,{transform:E});}
$(this.node,{transform:this.transformations[join](S)});return this;};Element[proto].hide=function(){!this.removed&&(this.node.style.display="none");return this;};Element[proto].show=function(){!this.removed&&(this.node.style.display="");return this;};Element[proto].remove=function(){if(this.removed){return;}
tear(this,this.paper);this.node.parentNode.removeChild(this.node);for(var i in this){delete this[i];}
this.removed=true;};Element[proto].getBBox=function(){if(this.removed){return this;}
if(this.type=="path"){return pathDimensions(this.attrs.path);}
if(this.node.style.display=="none"){this.show();var hide=true;}
var bbox={};try{bbox=this.node.getBBox();}catch(e){}finally{bbox=bbox||{};}
if(this.type=="text"){bbox={x:bbox.x,y:Infinity,width:0,height:0};for(var i=0,ii=this.node.getNumberOfChars();i<ii;i++){var bb=this.node.getExtentOfChar(i);(bb.y<bbox.y)&&(bbox.y=bb.y);(bb.y+bb.height-bbox.y>bbox.height)&&(bbox.height=bb.y+bb.height-bbox.y);(bb.x+bb.width-bbox.x>bbox.width)&&(bbox.width=bb.x+bb.width-bbox.x);}}
hide&&this.hide();return bbox;};Element[proto].attr=function(name,value){if(this.removed){return this;}
if(name==null){var res={};for(var i in this.attrs)if(this.attrs[has](i)){res[i]=this.attrs[i];}
this._.rt.deg&&(res.rotation=this.rotate());(this._.sx!=1||this._.sy!=1)&&(res.scale=this.scale());res.gradient&&res.fill=="none"&&(res.fill=res.gradient)&&delete res.gradient;return res;}
if(value==null&&R.is(name,string)){if(name=="translation"){return translate.call(this);}
if(name=="rotation"){return this.rotate();}
if(name=="scale"){return this.scale();}
if(name==fillString&&this.attrs.fill=="none"&&this.attrs.gradient){return this.attrs.gradient;}
return this.attrs[name];}
if(value==null&&R.is(name,array)){var values={};for(var j=0,jj=name.length;j<jj;j++){values[name[j]]=this.attr(name[j]);}
return values;}
if(value!=null){var params={};params[name]=value;}else if(name!=null&&R.is(name,"object")){params=name;}
for(var key in this.paper.customAttributes)if(this.paper.customAttributes[has](key)&&params[has](key)&&R.is(this.paper.customAttributes[key],"function")){var par=this.paper.customAttributes[key].apply(this,[][concat](params[key]));this.attrs[key]=params[key];for(var subkey in par)if(par[has](subkey)){params[subkey]=par[subkey];}}
setFillAndStroke(this,params);return this;};Element[proto].toFront=function(){if(this.removed){return this;}
this.node.parentNode[appendChild](this.node);var svg=this.paper;svg.top!=this&&tofront(this,svg);return this;};Element[proto].toBack=function(){if(this.removed){return this;}
if(this.node.parentNode.firstChild!=this.node){this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild);toback(this,this.paper);var svg=this.paper;}
return this;};Element[proto].insertAfter=function(element){if(this.removed){return this;}
var node=element.node||element[element.length-1].node;if(node.nextSibling){node.parentNode.insertBefore(this.node,node.nextSibling);}else{node.parentNode[appendChild](this.node);}
insertafter(this,element,this.paper);return this;};Element[proto].insertBefore=function(element){if(this.removed){return this;}
var node=element.node||element[0].node;node.parentNode.insertBefore(this.node,node);insertbefore(this,element,this.paper);return this;};Element[proto].blur=function(size){var t=this;if(+size!==0){var fltr=$("filter"),blur=$("feGaussianBlur");t.attrs.blur=size;fltr.id=createUUID();$(blur,{stdDeviation:+size||1.5});fltr.appendChild(blur);t.paper.defs.appendChild(fltr);t._blur=fltr;$(t.node,{filter:"url(#"+fltr.id+")"});}else{if(t._blur){t._blur.parentNode.removeChild(t._blur);delete t._blur;delete t.attrs.blur;}
t.node.removeAttribute("filter");}};var theCircle=function(svg,x,y,r){var el=$("circle");svg.canvas&&svg.canvas[appendChild](el);var res=new Element(el,svg);res.attrs={cx:x,cy:y,r:r,fill:"none",stroke:"#000"};res.type="circle";$(el,res.attrs);return res;},theRect=function(svg,x,y,w,h,r){var el=$("rect");svg.canvas&&svg.canvas[appendChild](el);var res=new Element(el,svg);res.attrs={x:x,y:y,width:w,height:h,r:r||0,rx:r||0,ry:r||0,fill:"none",stroke:"#000"};res.type="rect";$(el,res.attrs);return res;},theEllipse=function(svg,x,y,rx,ry){var el=$("ellipse");svg.canvas&&svg.canvas[appendChild](el);var res=new Element(el,svg);res.attrs={cx:x,cy:y,rx:rx,ry:ry,fill:"none",stroke:"#000"};res.type="ellipse";$(el,res.attrs);return res;},theImage=function(svg,src,x,y,w,h){var el=$("image");$(el,{x:x,y:y,width:w,height:h,preserveAspectRatio:"none"});el.setAttributeNS(svg.xlink,"href",src);svg.canvas&&svg.canvas[appendChild](el);var res=new Element(el,svg);res.attrs={x:x,y:y,width:w,height:h,src:src};res.type="image";return res;},theText=function(svg,x,y,text){var el=$("text");$(el,{x:x,y:y,"text-anchor":"middle"});svg.canvas&&svg.canvas[appendChild](el);var res=new Element(el,svg);res.attrs={x:x,y:y,"text-anchor":"middle",text:text,font:availableAttrs.font,stroke:"none",fill:"#000"};res.type="text";setFillAndStroke(res,res.attrs);return res;},setSize=function(width,height){this.width=width||this.width;this.height=height||this.height;this.canvas[setAttribute]("width",this.width);this.canvas[setAttribute]("height",this.height);return this;},create=function(){var con=getContainer[apply](0,arguments),container=con&&con.container,x=con.x,y=con.y,width=con.width,height=con.height;if(!container){throw new Error("SVG container not found.");}
var cnvs=$("svg");x=x||0;y=y||0;width=width||512;height=height||342;$(cnvs,{xmlns:"http://www.w3.org/2000/svg",version:1.1,width:width,height:height});if(container==1){cnvs.style.cssText="position:absolute;left:"+x+"px;top:"+y+"px";doc.body[appendChild](cnvs);}else{if(container.firstChild){container.insertBefore(cnvs,container.firstChild);}else{container[appendChild](cnvs);}}
container=new Paper;container.width=width;container.height=height;container.canvas=cnvs;plugins.call(container,container,R.fn);container.clear();return container;};paperproto.clear=function(){var c=this.canvas;while(c.firstChild){c.removeChild(c.firstChild);}
this.bottom=this.top=null;(this.desc=$("desc"))[appendChild](doc.createTextNode("Created with Rapha\xebl"));c[appendChild](this.desc);c[appendChild](this.defs=$("defs"));};paperproto.remove=function(){this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var i in this){this[i]=removed(i);}};}
if(R.vml){var map={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},bites=/([clmz]),?([^clmz]*)/gi,blurregexp=/ progid:\S+Blur\([^\)]+\)/g,val=/-?[^,\s-]+/g,coordsize=1e3+S+1e3,zoom=10,pathlike={path:1,rect:1},path2vml=function(path){var total=/[ahqstv]/ig,command=pathToAbsolute;Str(path).match(total)&&(command=path2curve);total=/[clmz]/g;if(command==pathToAbsolute&&!Str(path).match(total)){var res=Str(path)[rp](bites,function(all,command,args){var vals=[],isMove=lowerCase.call(command)=="m",res=map[command];args[rp](val,function(value){if(isMove&&vals[length]==2){res+=vals+map[command=="m"?"l":"L"];vals=[];}
vals[push](round(value*zoom));});return res+vals;});return res;}
var pa=command(path),p,r;res=[];for(var i=0,ii=pa[length];i<ii;i++){p=pa[i];r=lowerCase.call(pa[i][0]);r=="z"&&(r="x");for(var j=1,jj=p[length];j<jj;j++){r+=round(p[j]*zoom)+(j!=jj-1?",":E);}
res[push](r);}
return res[join](S);};R[toString]=function(){return"Your browser doesn\u2019t support SVG. Falling down to VML.\nYou are running Rapha\xebl "+this.version;};thePath=function(pathString,vml){var g=createNode("group");g.style.cssText="position:absolute;left:0;top:0;width:"+vml.width+"px;height:"+vml.height+"px";g.coordsize=vml.coordsize;g.coordorigin=vml.coordorigin;var el=createNode("shape"),ol=el.style;ol.width=vml.width+"px";ol.height=vml.height+"px";el.coordsize=coordsize;el.coordorigin=vml.coordorigin;g[appendChild](el);var p=new Element(el,g,vml),attr={fill:"none",stroke:"#000"};pathString&&(attr.path=pathString);p.type="path";p.path=[];p.Path=E;setFillAndStroke(p,attr);vml.canvas[appendChild](g);return p;};setFillAndStroke=function(o,params){o.attrs=o.attrs||{};var node=o.node,a=o.attrs,s=node.style,xy,newpath=(params.x!=a.x||params.y!=a.y||params.width!=a.width||params.height!=a.height||params.r!=a.r)&&o.type=="rect",res=o;for(var par in params)if(params[has](par)){a[par]=params[par];}
if(newpath){a.path=rectPath(a.x,a.y,a.width,a.height,a.r);o.X=a.x;o.Y=a.y;o.W=a.width;o.H=a.height;}
params.href&&(node.href=params.href);params.title&&(node.title=params.title);params.target&&(node.target=params.target);params.cursor&&(s.cursor=params.cursor);"blur"in params&&o.blur(params.blur);if(params.path&&o.type=="path"||newpath){node.path=path2vml(a.path);}
if(params.rotation!=null){o.rotate(params.rotation,true);}
if(params.translation){xy=Str(params.translation)[split](separator);translate.call(o,xy[0],xy[1]);if(o._.rt.cx!=null){o._.rt.cx+=+xy[0];o._.rt.cy+=+xy[1];o.setBox(o.attrs,xy[0],xy[1]);}}
if(params.scale){xy=Str(params.scale)[split](separator);o.scale(+xy[0]||1,+xy[1]||+xy[0]||1,+xy[2]||null,+xy[3]||null);}
if("clip-rect"in params){var rect=Str(params["clip-rect"])[split](separator);if(rect[length]==4){rect[2]=+rect[2]+(+rect[0]);rect[3]=+rect[3]+(+rect[1]);var div=node.clipRect||doc.createElement("div"),dstyle=div.style,group=node.parentNode;dstyle.clip=R.format("rect({1}px {2}px {3}px {0}px)",rect);if(!node.clipRect){dstyle.position="absolute";dstyle.top=0;dstyle.left=0;dstyle.width=o.paper.width+"px";dstyle.height=o.paper.height+"px";group.parentNode.insertBefore(div,group);div[appendChild](group);node.clipRect=div;}}
if(!params["clip-rect"]){node.clipRect&&(node.clipRect.style.clip=E);}}
if(o.type=="image"&&params.src){node.src=params.src;}
if(o.type=="image"&&params.opacity){node.filterOpacity=ms+".Alpha(opacity="+(params.opacity*100)+")";s.filter=(node.filterMatrix||E)+(node.filterOpacity||E);}
params.font&&(s.font=params.font);params["font-family"]&&(s.fontFamily='"'+params["font-family"][split](",")[0][rp](/^['"]+|['"]+$/g,E)+'"');params["font-size"]&&(s.fontSize=params["font-size"]);params["font-weight"]&&(s.fontWeight=params["font-weight"]);params["font-style"]&&(s.fontStyle=params["font-style"]);if(params.opacity!=null||params["stroke-width"]!=null||params.fill!=null||params.stroke!=null||params["stroke-width"]!=null||params["stroke-opacity"]!=null||params["fill-opacity"]!=null||params["stroke-dasharray"]!=null||params["stroke-miterlimit"]!=null||params["stroke-linejoin"]!=null||params["stroke-linecap"]!=null){node=o.shape||node;var fill=(node.getElementsByTagName(fillString)&&node.getElementsByTagName(fillString)[0]),newfill=false;!fill&&(newfill=fill=createNode(fillString));if("fill-opacity"in params||"opacity"in params){var opacity=((+a["fill-opacity"]+1||2)-1)*((+a.opacity+1||2)-1)*((+R.getRGB(params.fill).o+1||2)-1);opacity=mmin(mmax(opacity,0),1);fill.opacity=opacity;}
params.fill&&(fill.on=true);if(fill.on==null||params.fill=="none"){fill.on=false;}
if(fill.on&&params.fill){var isURL=params.fill.match(ISURL);if(isURL){fill.src=isURL[1];fill.type="tile";}else{fill.color=R.getRGB(params.fill).hex;fill.src=E;fill.type="solid";if(R.getRGB(params.fill).error&&(res.type in{circle:1,ellipse:1}||Str(params.fill).charAt()!="r")&&addGradientFill(res,params.fill)){a.fill="none";a.gradient=params.fill;}}}
newfill&&node[appendChild](fill);var stroke=(node.getElementsByTagName("stroke")&&node.getElementsByTagName("stroke")[0]),newstroke=false;!stroke&&(newstroke=stroke=createNode("stroke"));if((params.stroke&&params.stroke!="none")||params["stroke-width"]||params["stroke-opacity"]!=null||params["stroke-dasharray"]||params["stroke-miterlimit"]||params["stroke-linejoin"]||params["stroke-linecap"]){stroke.on=true;}
(params.stroke=="none"||stroke.on==null||params.stroke==0||params["stroke-width"]==0)&&(stroke.on=false);var strokeColor=R.getRGB(params.stroke);stroke.on&&params.stroke&&(stroke.color=strokeColor.hex);opacity=((+a["stroke-opacity"]+1||2)-1)*((+a.opacity+1||2)-1)*((+strokeColor.o+1||2)-1);var width=(toFloat(params["stroke-width"])||1)*.75;opacity=mmin(mmax(opacity,0),1);params["stroke-width"]==null&&(width=a["stroke-width"]);params["stroke-width"]&&(stroke.weight=width);width&&width<1&&(opacity*=width)&&(stroke.weight=1);stroke.opacity=opacity;params["stroke-linejoin"]&&(stroke.joinstyle=params["stroke-linejoin"]||"miter");stroke.miterlimit=params["stroke-miterlimit"]||8;params["stroke-linecap"]&&(stroke.endcap=params["stroke-linecap"]=="butt"?"flat":params["stroke-linecap"]=="square"?"square":"round");if(params["stroke-dasharray"]){var dasharray={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};stroke.dashstyle=dasharray[has](params["stroke-dasharray"])?dasharray[params["stroke-dasharray"]]:E;}
newstroke&&node[appendChild](stroke);}
if(res.type=="text"){s=res.paper.span.style;a.font&&(s.font=a.font);a["font-family"]&&(s.fontFamily=a["font-family"]);a["font-size"]&&(s.fontSize=a["font-size"]);a["font-weight"]&&(s.fontWeight=a["font-weight"]);a["font-style"]&&(s.fontStyle=a["font-style"]);res.node.string&&(res.paper.span.innerHTML=Str(res.node.string)[rp](/</g,"&#60;")[rp](/&/g,"&#38;")[rp](/\n/g,"<br>"));res.W=a.w=res.paper.span.offsetWidth;res.H=a.h=res.paper.span.offsetHeight;res.X=a.x;res.Y=a.y+round(res.H/2);switch(a["text-anchor"]){case"start":res.node.style["v-text-align"]="left";res.bbx=round(res.W/2);break;case"end":res.node.style["v-text-align"]="right";res.bbx=-round(res.W/2);break;default:res.node.style["v-text-align"]="center";break;}}};addGradientFill=function(o,gradient){o.attrs=o.attrs||{};var attrs=o.attrs,fill,type="linear",fxfy=".5 .5";o.attrs.gradient=gradient;gradient=Str(gradient)[rp](radial_gradient,function(all,fx,fy){type="radial";if(fx&&fy){fx=toFloat(fx);fy=toFloat(fy);pow(fx-.5,2)+pow(fy-.5,2)>.25&&(fy=math.sqrt(.25-pow(fx-.5,2))*((fy>.5)*2-1)+.5);fxfy=fx+S+fy;}
return E;});gradient=gradient[split](/\s*\-\s*/);if(type=="linear"){var angle=gradient.shift();angle=-toFloat(angle);if(isNaN(angle)){return null;}}
var dots=parseDots(gradient);if(!dots){return null;}
o=o.shape||o.node;fill=o.getElementsByTagName(fillString)[0]||createNode(fillString);!fill.parentNode&&o.appendChild(fill);if(dots[length]){fill.on=true;fill.method="none";fill.color=dots[0].color;fill.color2=dots[dots[length]-1].color;var clrs=[];for(var i=0,ii=dots[length];i<ii;i++){dots[i].offset&&clrs[push](dots[i].offset+S+dots[i].color);}
fill.colors&&(fill.colors.value=clrs[length]?clrs[join]():"0% "+fill.color);if(type=="radial"){fill.type="gradientradial";fill.focus="100%";fill.focussize=fxfy;fill.focusposition=fxfy;}else{fill.type="gradient";fill.angle=(270-angle)%360;}}
return 1;};Element=function(node,group,vml){var Rotation=0,RotX=0,RotY=0,Scale=1;this[0]=node;this.id=R._oid++;this.node=node;node.raphael=this;this.X=0;this.Y=0;this.attrs={};this.Group=group;this.paper=vml;this._={tx:0,ty:0,rt:{deg:0},sx:1,sy:1};!vml.bottom&&(vml.bottom=this);this.prev=vml.top;vml.top&&(vml.top.next=this);vml.top=this;this.next=null;};elproto=Element[proto];elproto.rotate=function(deg,cx,cy){if(this.removed){return this;}
if(deg==null){if(this._.rt.cx){return[this._.rt.deg,this._.rt.cx,this._.rt.cy][join](S);}
return this._.rt.deg;}
deg=Str(deg)[split](separator);if(deg[length]-1){cx=toFloat(deg[1]);cy=toFloat(deg[2]);}
deg=toFloat(deg[0]);if(cx!=null){this._.rt.deg=deg;}else{this._.rt.deg+=deg;}
cy==null&&(cx=null);this._.rt.cx=cx;this._.rt.cy=cy;this.setBox(this.attrs,cx,cy);this.Group.style.rotation=this._.rt.deg;return this;};elproto.setBox=function(params,cx,cy){if(this.removed){return this;}
var gs=this.Group.style,os=(this.shape&&this.shape.style)||this.node.style;params=params||{};for(var i in params)if(params[has](i)){this.attrs[i]=params[i];}
cx=cx||this._.rt.cx;cy=cy||this._.rt.cy;var attr=this.attrs,x,y,w,h;switch(this.type){case"circle":x=attr.cx-attr.r;y=attr.cy-attr.r;w=h=attr.r*2;break;case"ellipse":x=attr.cx-attr.rx;y=attr.cy-attr.ry;w=attr.rx*2;h=attr.ry*2;break;case"image":x=+attr.x;y=+attr.y;w=attr.width||0;h=attr.height||0;break;case"text":this.textpath.v=["m",round(attr.x),", ",round(attr.y-2),"l",round(attr.x)+1,", ",round(attr.y-2)][join](E);x=attr.x-round(this.W/2);y=attr.y-this.H/2;w=this.W;h=this.H;break;case"rect":case"path":if(!this.attrs.path){x=0;y=0;w=this.paper.width;h=this.paper.height;}else{var dim=pathDimensions(this.attrs.path);x=dim.x;y=dim.y;w=dim.width;h=dim.height;}
break;default:x=0;y=0;w=this.paper.width;h=this.paper.height;break;}
cx=(cx==null)?x+w/2:cx;cy=(cy==null)?y+h/2:cy;var left=cx-this.paper.width/2,top=cy-this.paper.height/2,t;gs.left!=(t=left+"px")&&(gs.left=t);gs.top!=(t=top+"px")&&(gs.top=t);this.X=pathlike[has](this.type)?-left:x;this.Y=pathlike[has](this.type)?-top:y;this.W=w;this.H=h;if(pathlike[has](this.type)){os.left!=(t=-left*zoom+"px")&&(os.left=t);os.top!=(t=-top*zoom+"px")&&(os.top=t);}else if(this.type=="text"){os.left!=(t=-left+"px")&&(os.left=t);os.top!=(t=-top+"px")&&(os.top=t);}else{gs.width!=(t=this.paper.width+"px")&&(gs.width=t);gs.height!=(t=this.paper.height+"px")&&(gs.height=t);os.left!=(t=x-left+"px")&&(os.left=t);os.top!=(t=y-top+"px")&&(os.top=t);os.width!=(t=w+"px")&&(os.width=t);os.height!=(t=h+"px")&&(os.height=t);}};elproto.hide=function(){!this.removed&&(this.Group.style.display="none");return this;};elproto.show=function(){!this.removed&&(this.Group.style.display="block");return this;};elproto.getBBox=function(){if(this.removed){return this;}
if(pathlike[has](this.type)){return pathDimensions(this.attrs.path);}
return{x:this.X+(this.bbx||0),y:this.Y,width:this.W,height:this.H};};elproto.remove=function(){if(this.removed){return;}
tear(this,this.paper);this.node.parentNode.removeChild(this.node);this.Group.parentNode.removeChild(this.Group);this.shape&&this.shape.parentNode.removeChild(this.shape);for(var i in this){delete this[i];}
this.removed=true;};elproto.attr=function(name,value){if(this.removed){return this;}
if(name==null){var res={};for(var i in this.attrs)if(this.attrs[has](i)){res[i]=this.attrs[i];}
this._.rt.deg&&(res.rotation=this.rotate());(this._.sx!=1||this._.sy!=1)&&(res.scale=this.scale());res.gradient&&res.fill=="none"&&(res.fill=res.gradient)&&delete res.gradient;return res;}
if(value==null&&R.is(name,"string")){if(name=="translation"){return translate.call(this);}
if(name=="rotation"){return this.rotate();}
if(name=="scale"){return this.scale();}
if(name==fillString&&this.attrs.fill=="none"&&this.attrs.gradient){return this.attrs.gradient;}
return this.attrs[name];}
if(this.attrs&&value==null&&R.is(name,array)){var ii,values={};for(i=0,ii=name[length];i<ii;i++){values[name[i]]=this.attr(name[i]);}
return values;}
var params;if(value!=null){params={};params[name]=value;}
value==null&&R.is(name,"object")&&(params=name);if(params){for(var key in this.paper.customAttributes)if(this.paper.customAttributes[has](key)&&params[has](key)&&R.is(this.paper.customAttributes[key],"function")){var par=this.paper.customAttributes[key].apply(this,[][concat](params[key]));this.attrs[key]=params[key];for(var subkey in par)if(par[has](subkey)){params[subkey]=par[subkey];}}
if(params.text&&this.type=="text"){this.node.string=params.text;}
setFillAndStroke(this,params);if(params.gradient&&(({circle:1,ellipse:1})[has](this.type)||Str(params.gradient).charAt()!="r")){addGradientFill(this,params.gradient);}
(!pathlike[has](this.type)||this._.rt.deg)&&this.setBox(this.attrs);}
return this;};elproto.toFront=function(){!this.removed&&this.Group.parentNode[appendChild](this.Group);this.paper.top!=this&&tofront(this,this.paper);return this;};elproto.toBack=function(){if(this.removed){return this;}
if(this.Group.parentNode.firstChild!=this.Group){this.Group.parentNode.insertBefore(this.Group,this.Group.parentNode.firstChild);toback(this,this.paper);}
return this;};elproto.insertAfter=function(element){if(this.removed){return this;}
if(element.constructor==Set){element=element[element.length-1];}
if(element.Group.nextSibling){element.Group.parentNode.insertBefore(this.Group,element.Group.nextSibling);}else{element.Group.parentNode[appendChild](this.Group);}
insertafter(this,element,this.paper);return this;};elproto.insertBefore=function(element){if(this.removed){return this;}
if(element.constructor==Set){element=element[0];}
element.Group.parentNode.insertBefore(this.Group,element.Group);insertbefore(this,element,this.paper);return this;};elproto.blur=function(size){var s=this.node.runtimeStyle,f=s.filter;f=f.replace(blurregexp,E);if(+size!==0){this.attrs.blur=size;s.filter=f+S+ms+".Blur(pixelradius="+(+size||1.5)+")";s.margin=R.format("-{0}px 0 0 -{0}px",round(+size||1.5));}else{s.filter=f;s.margin=0;delete this.attrs.blur;}};theCircle=function(vml,x,y,r){var g=createNode("group"),o=createNode("oval"),ol=o.style;g.style.cssText="position:absolute;left:0;top:0;width:"+vml.width+"px;height:"+vml.height+"px";g.coordsize=coordsize;g.coordorigin=vml.coordorigin;g[appendChild](o);var res=new Element(o,g,vml);res.type="circle";setFillAndStroke(res,{stroke:"#000",fill:"none"});res.attrs.cx=x;res.attrs.cy=y;res.attrs.r=r;res.setBox({x:x-r,y:y-r,width:r*2,height:r*2});vml.canvas[appendChild](g);return res;};function rectPath(x,y,w,h,r){if(r){return R.format("M{0},{1}l{2},0a{3},{3},0,0,1,{3},{3}l0,{5}a{3},{3},0,0,1,{4},{3}l{6},0a{3},{3},0,0,1,{4},{4}l0,{7}a{3},{3},0,0,1,{3},{4}z",x+r,y,w-r*2,r,-r,h-r*2,r*2-w,r*2-h);}else{return R.format("M{0},{1}l{2},0,0,{3},{4},0z",x,y,w,h,-w);}}
theRect=function(vml,x,y,w,h,r){var path=rectPath(x,y,w,h,r),res=vml.path(path),a=res.attrs;res.X=a.x=x;res.Y=a.y=y;res.W=a.width=w;res.H=a.height=h;a.r=r;a.path=path;res.type="rect";return res;};theEllipse=function(vml,x,y,rx,ry){var g=createNode("group"),o=createNode("oval"),ol=o.style;g.style.cssText="position:absolute;left:0;top:0;width:"+vml.width+"px;height:"+vml.height+"px";g.coordsize=coordsize;g.coordorigin=vml.coordorigin;g[appendChild](o);var res=new Element(o,g,vml);res.type="ellipse";setFillAndStroke(res,{stroke:"#000"});res.attrs.cx=x;res.attrs.cy=y;res.attrs.rx=rx;res.attrs.ry=ry;res.setBox({x:x-rx,y:y-ry,width:rx*2,height:ry*2});vml.canvas[appendChild](g);return res;};theImage=function(vml,src,x,y,w,h){var g=createNode("group"),o=createNode("image");g.style.cssText="position:absolute;left:0;top:0;width:"+vml.width+"px;height:"+vml.height+"px";g.coordsize=coordsize;g.coordorigin=vml.coordorigin;o.src=src;g[appendChild](o);var res=new Element(o,g,vml);res.type="image";res.attrs.src=src;res.attrs.x=x;res.attrs.y=y;res.attrs.w=w;res.attrs.h=h;res.setBox({x:x,y:y,width:w,height:h});vml.canvas[appendChild](g);return res;};theText=function(vml,x,y,text){var g=createNode("group"),el=createNode("shape"),ol=el.style,path=createNode("path"),ps=path.style,o=createNode("textpath");g.style.cssText="position:absolute;left:0;top:0;width:"+vml.width+"px;height:"+vml.height+"px";g.coordsize=coordsize;g.coordorigin=vml.coordorigin;path.v=R.format("m{0},{1}l{2},{1}",round(x*10),round(y*10),round(x*10)+1);path.textpathok=true;ol.width=vml.width;ol.height=vml.height;o.string=Str(text);o.on=true;el[appendChild](o);el[appendChild](path);g[appendChild](el);var res=new Element(o,g,vml);res.shape=el;res.textpath=path;res.type="text";res.attrs.text=text;res.attrs.x=x;res.attrs.y=y;res.attrs.w=1;res.attrs.h=1;setFillAndStroke(res,{font:availableAttrs.font,stroke:"none",fill:"#000"});res.setBox();vml.canvas[appendChild](g);return res;};setSize=function(width,height){var cs=this.canvas.style;width==+width&&(width+="px");height==+height&&(height+="px");cs.width=width;cs.height=height;cs.clip="rect(0 "+width+" "+height+" 0)";return this;};var createNode;doc.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!doc.namespaces.rvml&&doc.namespaces.add("rvml","urn:schemas-microsoft-com:vml");createNode=function(tagName){return doc.createElement('<rvml:'+tagName+' class="rvml">');};}catch(e){createNode=function(tagName){return doc.createElement('<'+tagName+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">');};}
create=function(){var con=getContainer[apply](0,arguments),container=con.container,height=con.height,s,width=con.width,x=con.x,y=con.y;if(!container){throw new Error("VML container not found.");}
var res=new Paper,c=res.canvas=doc.createElement("div"),cs=c.style;x=x||0;y=y||0;width=width||512;height=height||342;width==+width&&(width+="px");height==+height&&(height+="px");res.width=1e3;res.height=1e3;res.coordsize=zoom*1e3+S+zoom*1e3;res.coordorigin="0 0";res.span=doc.createElement("span");res.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";c[appendChild](res.span);cs.cssText=R.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",width,height);if(container==1){doc.body[appendChild](c);cs.left=x+"px";cs.top=y+"px";cs.position="absolute";}else{if(container.firstChild){container.insertBefore(c,container.firstChild);}else{container[appendChild](c);}}
plugins.call(res,res,R.fn);return res;};paperproto.clear=function(){this.canvas.innerHTML=E;this.span=doc.createElement("span");this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";this.canvas[appendChild](this.span);this.bottom=this.top=null;};paperproto.remove=function(){this.canvas.parentNode.removeChild(this.canvas);for(var i in this){this[i]=removed(i);}
return true;};}
var version=navigator.userAgent.match(/Version\/(.*?)\s/);if((navigator.vendor=="Apple Computer, Inc.")&&(version&&version[1]<4||navigator.platform.slice(0,2)=="iP")){paperproto.safari=function(){var rect=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});win.setTimeout(function(){rect.remove();});};}else{paperproto.safari=function(){};}
var preventDefault=function(){this.returnValue=false;},preventTouch=function(){return this.originalEvent.preventDefault();},stopPropagation=function(){this.cancelBubble=true;},stopTouch=function(){return this.originalEvent.stopPropagation();},addEvent=(function(){if(doc.addEventListener){return function(obj,type,fn,element){var realName=supportsTouch&&touchMap[type]?touchMap[type]:type;var f=function(e){if(supportsTouch&&touchMap[has](type)){for(var i=0,ii=e.targetTouches&&e.targetTouches.length;i<ii;i++){if(e.targetTouches[i].target==obj){var olde=e;e=e.targetTouches[i];e.originalEvent=olde;e.preventDefault=preventTouch;e.stopPropagation=stopTouch;break;}}}
return fn.call(element,e);};obj.addEventListener(realName,f,false);return function(){obj.removeEventListener(realName,f,false);return true;};};}else if(doc.attachEvent){return function(obj,type,fn,element){var f=function(e){e=e||win.event;e.preventDefault=e.preventDefault||preventDefault;e.stopPropagation=e.stopPropagation||stopPropagation;return fn.call(element,e);};obj.attachEvent("on"+type,f);var detacher=function(){obj.detachEvent("on"+type,f);return true;};return detacher;};}})(),drag=[],dragMove=function(e){var x=e.clientX,y=e.clientY,scrollY=doc.documentElement.scrollTop||doc.body.scrollTop,scrollX=doc.documentElement.scrollLeft||doc.body.scrollLeft,dragi,j=drag.length;while(j--){dragi=drag[j];if(supportsTouch){var i=e.touches.length,touch;while(i--){touch=e.touches[i];if(touch.identifier==dragi.el._drag.id){x=touch.clientX;y=touch.clientY;(e.originalEvent?e.originalEvent:e).preventDefault();break;}}}else{e.preventDefault();}
x+=scrollX;y+=scrollY;dragi.move&&dragi.move.call(dragi.move_scope||dragi.el,x-dragi.el._drag.x,y-dragi.el._drag.y,x,y,e);}},dragUp=function(e){R.unmousemove(dragMove).unmouseup(dragUp);var i=drag.length,dragi;while(i--){dragi=drag[i];dragi.el._drag={};dragi.end&&dragi.end.call(dragi.end_scope||dragi.start_scope||dragi.move_scope||dragi.el,e);}
drag=[];};for(var i=events[length];i--;){(function(eventName){R[eventName]=Element[proto][eventName]=function(fn,scope){if(R.is(fn,"function")){this.events=this.events||[];this.events.push({name:eventName,f:fn,unbind:addEvent(this.shape||this.node||doc,eventName,fn,scope||this)});}
return this;};R["un"+eventName]=Element[proto]["un"+eventName]=function(fn){var events=this.events,l=events[length];while(l--)if(events[l].name==eventName&&events[l].f==fn){events[l].unbind();events.splice(l,1);!events.length&&delete this.events;return this;}
return this;};})(events[i]);}
elproto.hover=function(f_in,f_out,scope_in,scope_out){return this.mouseover(f_in,scope_in).mouseout(f_out,scope_out||scope_in);};elproto.unhover=function(f_in,f_out){return this.unmouseover(f_in).unmouseout(f_out);};elproto.drag=function(onmove,onstart,onend,move_scope,start_scope,end_scope){this._drag={};this.mousedown(function(e){(e.originalEvent||e).preventDefault();var scrollY=doc.documentElement.scrollTop||doc.body.scrollTop,scrollX=doc.documentElement.scrollLeft||doc.body.scrollLeft;this._drag.x=e.clientX+scrollX;this._drag.y=e.clientY+scrollY;this._drag.id=e.identifier;onstart&&onstart.call(start_scope||move_scope||this,e.clientX+scrollX,e.clientY+scrollY,e);!drag.length&&R.mousemove(dragMove).mouseup(dragUp);drag.push({el:this,move:onmove,end:onend,move_scope:move_scope,start_scope:start_scope,end_scope:end_scope});});return this;};elproto.undrag=function(onmove,onstart,onend){var i=drag.length;while(i--){drag[i].el==this&&(drag[i].move==onmove&&drag[i].end==onend)&&drag.splice(i++,1);}!drag.length&&R.unmousemove(dragMove).unmouseup(dragUp);};paperproto.circle=function(x,y,r){return theCircle(this,x||0,y||0,r||0);};paperproto.rect=function(x,y,w,h,r){return theRect(this,x||0,y||0,w||0,h||0,r||0);};paperproto.ellipse=function(x,y,rx,ry){return theEllipse(this,x||0,y||0,rx||0,ry||0);};paperproto.path=function(pathString){pathString&&!R.is(pathString,string)&&!R.is(pathString[0],array)&&(pathString+=E);return thePath(R.format[apply](R,arguments),this);};paperproto.image=function(src,x,y,w,h){return theImage(this,src||"about:blank",x||0,y||0,w||0,h||0);};paperproto.text=function(x,y,text){return theText(this,x||0,y||0,Str(text));};paperproto.set=function(itemsArray){arguments[length]>1&&(itemsArray=Array[proto].splice.call(arguments,0,arguments[length]));return new Set(itemsArray);};paperproto.setSize=setSize;paperproto.top=paperproto.bottom=null;paperproto.raphael=R;function x_y(){return this.x+S+this.y;}
elproto.resetScale=function(){if(this.removed){return this;}
this._.sx=1;this._.sy=1;this.attrs.scale="1 1";};elproto.scale=function(x,y,cx,cy){if(this.removed){return this;}
if(x==null&&y==null){return{x:this._.sx,y:this._.sy,toString:x_y};}
y=y||x;!+y&&(y=x);var dx,dy,dcx,dcy,a=this.attrs;if(x!=0){var bb=this.getBBox(),rcx=bb.x+bb.width/2,rcy=bb.y+bb.height/2,kx=abs(x/this._.sx),ky=abs(y/this._.sy);cx=(+cx||cx==0)?cx:rcx;cy=(+cy||cy==0)?cy:rcy;var posx=this._.sx>0,posy=this._.sy>0,dirx=~~(x/abs(x)),diry=~~(y/abs(y)),dkx=kx*dirx,dky=ky*diry,s=this.node.style,ncx=cx+abs(rcx-cx)*dkx*(rcx>cx==posx?1:-1),ncy=cy+abs(rcy-cy)*dky*(rcy>cy==posy?1:-1),fr=(x*dirx>y*diry?ky:kx);switch(this.type){case"rect":case"image":var neww=a.width*kx,newh=a.height*ky;this.attr({height:newh,r:a.r*fr,width:neww,x:ncx-neww/2,y:ncy-newh/2});break;case"circle":case"ellipse":this.attr({rx:a.rx*kx,ry:a.ry*ky,r:a.r*fr,cx:ncx,cy:ncy});break;case"text":this.attr({x:ncx,y:ncy});break;case"path":var path=pathToRelative(a.path),skip=true,fx=posx?dkx:kx,fy=posy?dky:ky;for(var i=0,ii=path[length];i<ii;i++){var p=path[i],P0=upperCase.call(p[0]);if(P0=="M"&&skip){continue;}else{skip=false;}
if(P0=="A"){p[path[i][length]-2]*=fx;p[path[i][length]-1]*=fy;p[1]*=kx;p[2]*=ky;p[5]=+(dirx+diry?!!+p[5]:!+p[5]);}else if(P0=="H"){for(var j=1,jj=p[length];j<jj;j++){p[j]*=fx;}}else if(P0=="V"){for(j=1,jj=p[length];j<jj;j++){p[j]*=fy;}}else{for(j=1,jj=p[length];j<jj;j++){p[j]*=(j%2)?fx:fy;}}}
var dim2=pathDimensions(path);dx=ncx-dim2.x-dim2.width/2;dy=ncy-dim2.y-dim2.height/2;path[0][1]+=dx;path[0][2]+=dy;this.attr({path:path});break;}
if(this.type in{text:1,image:1}&&(dirx!=1||diry!=1)){if(this.transformations){this.transformations[2]="scale("[concat](dirx,",",diry,")");this.node[setAttribute]("transform",this.transformations[join](S));dx=(dirx==-1)?-a.x-(neww||0):a.x;dy=(diry==-1)?-a.y-(newh||0):a.y;this.attr({x:dx,y:dy});a.fx=dirx-1;a.fy=diry-1;}else{this.node.filterMatrix=ms+".Matrix(M11="[concat](dirx,", M12=0, M21=0, M22=",diry,", Dx=0, Dy=0, sizingmethod='auto expand', filtertype='bilinear')");s.filter=(this.node.filterMatrix||E)+(this.node.filterOpacity||E);}}else{if(this.transformations){this.transformations[2]=E;this.node[setAttribute]("transform",this.transformations[join](S));a.fx=0;a.fy=0;}else{this.node.filterMatrix=E;s.filter=(this.node.filterMatrix||E)+(this.node.filterOpacity||E);}}
a.scale=[x,y,cx,cy][join](S);this._.sx=x;this._.sy=y;}
return this;};elproto.clone=function(){if(this.removed){return null;}
var attr=this.attr();delete attr.scale;delete attr.translation;return this.paper[this.type]().attr(attr);};var curveslengths={},getPointAtSegmentLength=function(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,length){var len=0,precision=100,name=[p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y].join(),cache=curveslengths[name],old,dot;!cache&&(curveslengths[name]=cache={data:[]});cache.timer&&clearTimeout(cache.timer);cache.timer=setTimeout(function(){delete curveslengths[name];},2000);if(length!=null){var total=getPointAtSegmentLength(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y);precision=~~total*10;}
for(var i=0;i<precision+1;i++){if(cache.data[length]>i){dot=cache.data[i*precision];}else{dot=R.findDotsAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,i/precision);cache.data[i]=dot;}
i&&(len+=pow(pow(old.x-dot.x,2)+pow(old.y-dot.y,2),.5));if(length!=null&&len>=length){return dot;}
old=dot;}
if(length==null){return len;}},getLengthFactory=function(istotal,subpath){return function(path,length,onlystart){path=path2curve(path);var x,y,p,l,sp="",subpaths={},point,len=0;for(var i=0,ii=path.length;i<ii;i++){p=path[i];if(p[0]=="M"){x=+p[1];y=+p[2];}else{l=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6]);if(len+l>length){if(subpath&&!subpaths.start){point=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6],length-len);sp+=["C",point.start.x,point.start.y,point.m.x,point.m.y,point.x,point.y];if(onlystart){return sp;}
subpaths.start=sp;sp=["M",point.x,point.y+"C",point.n.x,point.n.y,point.end.x,point.end.y,p[5],p[6]][join]();len+=l;x=+p[5];y=+p[6];continue;}
if(!istotal&&!subpath){point=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6],length-len);return{x:point.x,y:point.y,alpha:point.alpha};}}
len+=l;x=+p[5];y=+p[6];}
sp+=p;}
subpaths.end=sp;point=istotal?len:subpath?subpaths:R.findDotsAtSegment(x,y,p[1],p[2],p[3],p[4],p[5],p[6],1);point.alpha&&(point={x:point.x,y:point.y,alpha:point.alpha});return point;};};var getTotalLength=getLengthFactory(1),getPointAtLength=getLengthFactory(),getSubpathsAtLength=getLengthFactory(0,1);elproto.getTotalLength=function(){if(this.type!="path"){return;}
if(this.node.getTotalLength){return this.node.getTotalLength();}
return getTotalLength(this.attrs.path);};elproto.getPointAtLength=function(length){if(this.type!="path"){return;}
return getPointAtLength(this.attrs.path,length);};elproto.getSubpath=function(from,to){if(this.type!="path"){return;}
if(abs(this.getTotalLength()-to)<"1e-6"){return getSubpathsAtLength(this.attrs.path,from).end;}
var a=getSubpathsAtLength(this.attrs.path,to,1);return from?getSubpathsAtLength(a,from).end:a;};R.easing_formulas={linear:function(n){return n;},"<":function(n){return pow(n,3);},">":function(n){return pow(n-1,3)+1;},"<>":function(n){n=n*2;if(n<1){return pow(n,3)/2;}
n-=2;return(pow(n,3)+2)/2;},backIn:function(n){var s=1.70158;return n*n*((s+1)*n-s);},backOut:function(n){n=n-1;var s=1.70158;return n*n*((s+1)*n+s)+1;},elastic:function(n){if(n==0||n==1){return n;}
var p=.3,s=p/4;return pow(2,-10*n)*math.sin((n-s)*(2*PI)/p)+1;},bounce:function(n){var s=7.5625,p=2.75,l;if(n<(1/p)){l=s*n*n;}else{if(n<(2/p)){n-=(1.5/p);l=s*n*n+.75;}else{if(n<(2.5/p)){n-=(2.25/p);l=s*n*n+.9375;}else{n-=(2.625/p);l=s*n*n+.984375;}}}
return l;}};var animationElements=[],animation=function(){var Now=+new Date;for(var l=0;l<animationElements[length];l++){var e=animationElements[l];if(e.stop||e.el.removed){continue;}
var time=Now-e.start,ms=e.ms,easing=e.easing,from=e.from,diff=e.diff,to=e.to,t=e.t,that=e.el,set={},now;if(time<ms){var pos=easing(time/ms);for(var attr in from)if(from[has](attr)){switch(availableAnimAttrs[attr]){case"along":now=pos*ms*diff[attr];to.back&&(now=to.len-now);var point=getPointAtLength(to[attr],now);that.translate(diff.sx-diff.x||0,diff.sy-diff.y||0);diff.x=point.x;diff.y=point.y;that.translate(point.x-diff.sx,point.y-diff.sy);to.rot&&that.rotate(diff.r+point.alpha,point.x,point.y);break;case nu:now=+from[attr]+pos*ms*diff[attr];break;case"colour":now="rgb("+[upto255(round(from[attr].r+pos*ms*diff[attr].r)),upto255(round(from[attr].g+pos*ms*diff[attr].g)),upto255(round(from[attr].b+pos*ms*diff[attr].b))][join](",")+")";break;case"path":now=[];for(var i=0,ii=from[attr][length];i<ii;i++){now[i]=[from[attr][i][0]];for(var j=1,jj=from[attr][i][length];j<jj;j++){now[i][j]=+from[attr][i][j]+pos*ms*diff[attr][i][j];}
now[i]=now[i][join](S);}
now=now[join](S);break;case"csv":switch(attr){case"translation":var x=pos*ms*diff[attr][0]-t.x,y=pos*ms*diff[attr][1]-t.y;t.x+=x;t.y+=y;now=x+S+y;break;case"rotation":now=+from[attr][0]+pos*ms*diff[attr][0];from[attr][1]&&(now+=","+from[attr][1]+","+from[attr][2]);break;case"scale":now=[+from[attr][0]+pos*ms*diff[attr][0],+from[attr][1]+pos*ms*diff[attr][1],(2 in to[attr]?to[attr][2]:E),(3 in to[attr]?to[attr][3]:E)][join](S);break;case"clip-rect":now=[];i=4;while(i--){now[i]=+from[attr][i]+pos*ms*diff[attr][i];}
break;}
break;default:var from2=[].concat(from[attr]);now=[];i=that.paper.customAttributes[attr].length;while(i--){now[i]=+from2[i]+pos*ms*diff[attr][i];}
break;}
set[attr]=now;}
that.attr(set);that._run&&that._run.call(that);}else{if(to.along){point=getPointAtLength(to.along,to.len*!to.back);that.translate(diff.sx-(diff.x||0)+point.x-diff.sx,diff.sy-(diff.y||0)+point.y-diff.sy);to.rot&&that.rotate(diff.r+point.alpha,point.x,point.y);}
(t.x||t.y)&&that.translate(-t.x,-t.y);to.scale&&(to.scale+=E);that.attr(to);animationElements.splice(l--,1);}}
R.svg&&that&&that.paper&&that.paper.safari();animationElements[length]&&setTimeout(animation);},keyframesRun=function(attr,element,time,prev,prevcallback){var dif=time-prev;element.timeouts.push(setTimeout(function(){R.is(prevcallback,"function")&&prevcallback.call(element);element.animate(attr,dif,attr.easing);},prev));},upto255=function(color){return mmax(mmin(color,255),0);},translate=function(x,y){if(x==null){return{x:this._.tx,y:this._.ty,toString:x_y};}
this._.tx+=+x;this._.ty+=+y;switch(this.type){case"circle":case"ellipse":this.attr({cx:+x+this.attrs.cx,cy:+y+this.attrs.cy});break;case"rect":case"image":case"text":this.attr({x:+x+this.attrs.x,y:+y+this.attrs.y});break;case"path":var path=pathToRelative(this.attrs.path);path[0][1]+=+x;path[0][2]+=+y;this.attr({path:path});break;}
return this;};elproto.animateWith=function(element,params,ms,easing,callback){for(var i=0,ii=animationElements.length;i<ii;i++){if(animationElements[i].el.id==element.id){params.start=animationElements[i].start;}}
return this.animate(params,ms,easing,callback);};elproto.animateAlong=along();elproto.animateAlongBack=along(1);function along(isBack){return function(path,ms,rotate,callback){var params={back:isBack};R.is(rotate,"function")?(callback=rotate):(params.rot=rotate);path&&path.constructor==Element&&(path=path.attrs.path);path&&(params.along=path);return this.animate(params,ms,callback);};}
function CubicBezierAtTime(t,p1x,p1y,p2x,p2y,duration){var cx=3*p1x,bx=3*(p2x-p1x)-cx,ax=1-cx-bx,cy=3*p1y,by=3*(p2y-p1y)-cy,ay=1-cy-by;function sampleCurveX(t){return((ax*t+bx)*t+cx)*t;}
function solve(x,epsilon){var t=solveCurveX(x,epsilon);return((ay*t+by)*t+cy)*t;}
function solveCurveX(x,epsilon){var t0,t1,t2,x2,d2,i;for(t2=x,i=0;i<8;i++){x2=sampleCurveX(t2)-x;if(abs(x2)<epsilon){return t2;}
d2=(3*ax*t2+2*bx)*t2+cx;if(abs(d2)<1e-6){break;}
t2=t2-x2/d2;}
t0=0;t1=1;t2=x;if(t2<t0){return t0;}
if(t2>t1){return t1;}
while(t0<t1){x2=sampleCurveX(t2);if(abs(x2-x)<epsilon){return t2;}
if(x>x2){t0=t2;}else{t1=t2;}
t2=(t1-t0)/2+t0;}
return t2;}
return solve(t,1/(200*duration));}
elproto.onAnimation=function(f){this._run=f||0;return this;};elproto.animate=function(params,ms,easing,callback){var element=this;element.timeouts=element.timeouts||[];if(R.is(easing,"function")||!easing){callback=easing||null;}
if(element.removed){callback&&callback.call(element);return element;}
var from={},to={},animateable=false,diff={};for(var attr in params)if(params[has](attr)){if(availableAnimAttrs[has](attr)||element.paper.customAttributes[has](attr)){animateable=true;from[attr]=element.attr(attr);(from[attr]==null)&&(from[attr]=availableAttrs[attr]);to[attr]=params[attr];switch(availableAnimAttrs[attr]){case"along":var len=getTotalLength(params[attr]);var point=getPointAtLength(params[attr],len*!!params.back);var bb=element.getBBox();diff[attr]=len/ms;diff.tx=bb.x;diff.ty=bb.y;diff.sx=point.x;diff.sy=point.y;to.rot=params.rot;to.back=params.back;to.len=len;params.rot&&(diff.r=toFloat(element.rotate())||0);break;case nu:diff[attr]=(to[attr]-from[attr])/ms;break;case"colour":from[attr]=R.getRGB(from[attr]);var toColour=R.getRGB(to[attr]);diff[attr]={r:(toColour.r-from[attr].r)/ms,g:(toColour.g-from[attr].g)/ms,b:(toColour.b-from[attr].b)/ms};break;case"path":var pathes=path2curve(from[attr],to[attr]);from[attr]=pathes[0];var toPath=pathes[1];diff[attr]=[];for(var i=0,ii=from[attr][length];i<ii;i++){diff[attr][i]=[0];for(var j=1,jj=from[attr][i][length];j<jj;j++){diff[attr][i][j]=(toPath[i][j]-from[attr][i][j])/ms;}}
break;case"csv":var values=Str(params[attr])[split](separator),from2=Str(from[attr])[split](separator);switch(attr){case"translation":from[attr]=[0,0];diff[attr]=[values[0]/ms,values[1]/ms];break;case"rotation":from[attr]=(from2[1]==values[1]&&from2[2]==values[2])?from2:[0,values[1],values[2]];diff[attr]=[(values[0]-from[attr][0])/ms,0,0];break;case"scale":params[attr]=values;from[attr]=Str(from[attr])[split](separator);diff[attr]=[(values[0]-from[attr][0])/ms,(values[1]-from[attr][1])/ms,0,0];break;case"clip-rect":from[attr]=Str(from[attr])[split](separator);diff[attr]=[];i=4;while(i--){diff[attr][i]=(values[i]-from[attr][i])/ms;}
break;}
to[attr]=values;break;default:values=[].concat(params[attr]);from2=[].concat(from[attr]);diff[attr]=[];i=element.paper.customAttributes[attr][length];while(i--){diff[attr][i]=((values[i]||0)-(from2[i]||0))/ms;}
break;}}}
if(!animateable){var attrs=[],lastcall;for(var key in params)if(params[has](key)&&animKeyFrames.test(key)){attr={value:params[key]};key=="from"&&(key=0);key=="to"&&(key=100);attr.key=toInt(key,10);attrs.push(attr);}
attrs.sort(sortByKey);if(attrs[0].key){attrs.unshift({key:0,value:element.attrs});}
for(i=0,ii=attrs[length];i<ii;i++){keyframesRun(attrs[i].value,element,ms/100*attrs[i].key,ms/100*(attrs[i-1]&&attrs[i-1].key||0),attrs[i-1]&&attrs[i-1].value.callback);}
lastcall=attrs[attrs[length]-1].value.callback;if(lastcall){element.timeouts.push(setTimeout(function(){lastcall.call(element);},ms));}}else{var easyeasy=R.easing_formulas[easing];if(!easyeasy){easyeasy=Str(easing).match(bezierrg);if(easyeasy&&easyeasy[length]==5){var curve=easyeasy;easyeasy=function(t){return CubicBezierAtTime(t,+curve[1],+curve[2],+curve[3],+curve[4],ms);};}else{easyeasy=function(t){return t;};}}
animationElements.push({start:params.start||+new Date,ms:ms,easing:easyeasy,from:from,diff:diff,to:to,el:element,t:{x:0,y:0}});R.is(callback,"function")&&(element._ac=setTimeout(function(){callback.call(element);},ms));animationElements[length]==1&&setTimeout(animation);}
return this;};elproto.stop=function(){for(var i=0;i<animationElements.length;i++){animationElements[i].el.id==this.id&&animationElements.splice(i--,1);}
for(i=0,ii=this.timeouts&&this.timeouts.length;i<ii;i++){clearTimeout(this.timeouts[i]);}
this.timeouts=[];clearTimeout(this._ac);delete this._ac;return this;};elproto.translate=function(x,y){return this.attr({translation:x+" "+y});};elproto[toString]=function(){return"Rapha\xebl\u2019s object";};R.ae=animationElements;var Set=function(items){this.items=[];this[length]=0;this.type="set";if(items){for(var i=0,ii=items[length];i<ii;i++){if(items[i]&&(items[i].constructor==Element||items[i].constructor==Set)){this[this.items[length]]=this.items[this.items[length]]=items[i];this[length]++;}}}};Set[proto][push]=function(){var item,len;for(var i=0,ii=arguments[length];i<ii;i++){item=arguments[i];if(item&&(item.constructor==Element||item.constructor==Set)){len=this.items[length];this[len]=this.items[len]=item;this[length]++;}}
return this;};Set[proto].pop=function(){delete this[this[length]--];return this.items.pop();};for(var method in elproto)if(elproto[has](method)){Set[proto][method]=(function(methodname){return function(){for(var i=0,ii=this.items[length];i<ii;i++){this.items[i][methodname][apply](this.items[i],arguments);}
return this;};})(method);}
Set[proto].attr=function(name,value){if(name&&R.is(name,array)&&R.is(name[0],"object")){for(var j=0,jj=name[length];j<jj;j++){this.items[j].attr(name[j]);}}else{for(var i=0,ii=this.items[length];i<ii;i++){this.items[i].attr(name,value);}}
return this;};Set[proto].animate=function(params,ms,easing,callback){(R.is(easing,"function")||!easing)&&(callback=easing||null);var len=this.items[length],i=len,item,set=this,collector;callback&&(collector=function(){!--len&&callback.call(set);});easing=R.is(easing,string)?easing:collector;item=this.items[--i].animate(params,ms,easing,collector);while(i--){this.items[i]&&!this.items[i].removed&&this.items[i].animateWith(item,params,ms,easing,collector);}
return this;};Set[proto].insertAfter=function(el){var i=this.items[length];while(i--){this.items[i].insertAfter(el);}
return this;};Set[proto].getBBox=function(){var x=[],y=[],w=[],h=[];for(var i=this.items[length];i--;){var box=this.items[i].getBBox();x[push](box.x);y[push](box.y);w[push](box.x+box.width);h[push](box.y+box.height);}
x=mmin[apply](0,x);y=mmin[apply](0,y);return{x:x,y:y,width:mmax[apply](0,w)-x,height:mmax[apply](0,h)-y};};Set[proto].clone=function(s){s=new Set;for(var i=0,ii=this.items[length];i<ii;i++){s[push](this.items[i].clone());}
return s;};R.registerFont=function(font){if(!font.face){return font;}
this.fonts=this.fonts||{};var fontcopy={w:font.w,face:{},glyphs:{}},family=font.face["font-family"];for(var prop in font.face)if(font.face[has](prop)){fontcopy.face[prop]=font.face[prop];}
if(this.fonts[family]){this.fonts[family][push](fontcopy);}else{this.fonts[family]=[fontcopy];}
if(!font.svg){fontcopy.face["units-per-em"]=toInt(font.face["units-per-em"],10);for(var glyph in font.glyphs)if(font.glyphs[has](glyph)){var path=font.glyphs[glyph];fontcopy.glyphs[glyph]={w:path.w,k:{},d:path.d&&"M"+path.d[rp](/[mlcxtrv]/g,function(command){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[command]||"M";})+"z"};if(path.k){for(var k in path.k)if(path[has](k)){fontcopy.glyphs[glyph].k[k]=path.k[k];}}}}
return font;};paperproto.getFont=function(family,weight,style,stretch){stretch=stretch||"normal";style=style||"normal";weight=+weight||{normal:400,bold:700,lighter:300,bolder:800}[weight]||400;if(!R.fonts){return;}
var font=R.fonts[family];if(!font){var name=new RegExp("(^|\\s)"+family[rp](/[^\w\d\s+!~.:_-]/g,E)+"(\\s|$)","i");for(var fontName in R.fonts)if(R.fonts[has](fontName)){if(name.test(fontName)){font=R.fonts[fontName];break;}}}
var thefont;if(font){for(var i=0,ii=font[length];i<ii;i++){thefont=font[i];if(thefont.face["font-weight"]==weight&&(thefont.face["font-style"]==style||!thefont.face["font-style"])&&thefont.face["font-stretch"]==stretch){break;}}}
return thefont;};paperproto.print=function(x,y,string,font,size,origin,letter_spacing){origin=origin||"middle";letter_spacing=mmax(mmin(letter_spacing||0,1),-1);var out=this.set(),letters=Str(string)[split](E),shift=0,path=E,scale;R.is(font,string)&&(font=this.getFont(font));if(font){scale=(size||16)/font.face["units-per-em"];var bb=font.face.bbox.split(separator),top=+bb[0],height=+bb[1]+(origin=="baseline"?bb[3]-bb[1]+(+font.face.descent):(bb[3]-bb[1])/2);for(var i=0,ii=letters[length];i<ii;i++){var prev=i&&font.glyphs[letters[i-1]]||{},curr=font.glyphs[letters[i]];shift+=i?(prev.w||font.w)+(prev.k&&prev.k[letters[i]]||0)+(font.w*letter_spacing):0;curr&&curr.d&&out[push](this.path(curr.d).attr({fill:"#000",stroke:"none",translation:[shift,0]}));}
out.scale(scale,scale,top,height).translate(x-top,y-height);}
return out;};R.format=function(token,params){var args=R.is(params,array)?[0][concat](params):arguments;token&&R.is(token,string)&&args[length]-1&&(token=token[rp](formatrg,function(str,i){return args[++i]==null?E:args[i];}));return token||E;};R.ninja=function(){oldRaphael.was?(win.Raphael=oldRaphael.is):delete Raphael;return R;};R.el=elproto;R.st=Set[proto];oldRaphael.was?(win.Raphael=R):(Raphael=R);})();var RaphaelComponent=BaseComponent.extend({update:function(){var myself=this;this.customfunction.apply(myself,this.parameters?this.parameters:[]);}});var RelatedContentComponent=BaseComponent.extend({update:function(){if(typeof(this.relatedContent)!="undefined"){var placeHolder=$("#"+this.htmlObject);placeHolder.empty();var contentString='<div id="relatedContentMainDiv"><p>Related content</p><ul>';for(key in this.relatedContent){contentString=contentString+'<li><a href=\''+this.relatedContent[key][1]+'\'">'+this.relatedContent[key][0]+'</a></li>';}
contentString=contentString+'</ul></div>';placeHolder.append(contentString);}}});var SiteMapComponent=BaseComponent.extend({ph:undefined,selected:"UNUSEDPARAM!@#$",templates:{list:Mustache.compile("<ul class='siteMap siteMapLevel{{level}}' ></ul>"),item:Mustache.compile("<li class='siteMapItem {{classes}}''>"+"  <a {{#link}}href='{{link}}'{{/link}}>{{name}}</a>"+"</li>"),},update:function(){var items=[],myself=this;if(typeof this.siteMapSelectedParameter!=="undefined"&&this.siteMapSelectedParameter!=""){this.selected=Dashboards.getParameterValue(this.siteMapSelectedParameter)}
this.ph=$("#"+this.htmlObject).empty();if(this.ajaxUrl){var opts={url:this.ajaxUrl}
if(_.isEmpty(this.parameters)){opts.data=Dashboards.propertiesArrayToObject(this.ajaxData);}
myself.fetchItems(opts,function(items){myself.renderList(myself.ph,items,0);});}else if(this.siteMapParameter){this.renderList(this.ph,Dashboards.getParameterValue(this.siteMapParameter),0);}
this.ph.find(".siteMapItem.siteMapSelected").parents(".siteMapItem").addClass("siteMapSelected");this.ph.find(".siteMapItem.siteMapInitial").parents(".siteMapItem").addClass("siteMapInitial");},fetchItems:function(overrides,callback){var myself=this;overrides=overrides||{};var ajaxOpts={type:'GET',success:function(json){callback(json);},dataType:'json',async:true};ajaxOpts=_.extend({},ajaxOpts,overrides);$.ajax(ajaxOpts);},renderList:function(ph,arr,level){var myself=this;var list=$(myself.templates.list({level:level}));$.each(arr,function(n,l){var item=$(myself.templates.item({name:l.name||l.id||"",link:l.link,classes:l.classes||""}));if(!l.link&&typeof l.action==="function"){item.find('a').click(function(){l.action(item);myself.ph.find(".siteMapItem.siteMapSelected").removeClass("siteMapSelected");$(this).parents(".siteMapItem").addClass("siteMapSelected");Dashboards.fireChange(myself.siteMapSelectedParameter,typeof l.id!=="undefined"?l.id:l.name);});}
if(typeof(l.id)!=="undefined"?l.id==myself.selected:l.name==myself.selected){item.addClass("siteMapSelected siteMapInitial");}
if(l.sublinks&&l.sublinks.length>0)
myself.renderList(item,l.sublinks,level+1);item.appendTo(list);});list.appendTo(ph);}});var TextEditorComponent=BaseComponent.extend({$ph:undefined,$rightPanel:undefined,isRightPanelShown:false,isInitialized:false,externalEditor:undefined,defaultButtons:[{clazz:"save",label:"Save",callback:function(){this.save();if(typeof this.saveCallback==="function"){this.saveCallback();}}}],initialize:function(){Dashboards.log("Initializing TextEditorComponent")
this.isInitialized=true;if(this.htmlObject){this.$ph=$("#"+this.htmlObject);}
else{this.$ph=$("<div id='textEditorDefautlId'></div>").appendTo("body");}},update:function(){var myself=this;if(this.parameter){this.setFile(Dashboards.getParameterValue(this.parameter));}
if(!this.isInitialized){myself.initialize();}
this.isRightPanelShown=false;var buttons=this.getButtons();var template="<div class='textEditorComponent'><div class='textEditorControls'>"+"<div class='textEditorFile'><span class='fileLabel'>File: </span>{{file}}</div>"+"<div class='textEditorButtons'>{{#buttons}}<button class='{{clazz}}'>{{label}}</button>{{/buttons}}</div>"+"</div><div class='textEditorNotification'><span class='textEditorNotificationMsg'>Test</span></div>"+"<div class='textEditorRightPanel'></div>"+"<div class='textEditorIframeContainer'><div class='textEditorIframe'><iframe seamless='true' marginheight='0'></iframe></div>"+"</div>";this.$ph.html(Mustache.render(template,{file:this.file||"Unknown file",buttons:buttons}));this.$ph.find(".textEditorControls").on("click","button",function(){var $this=$(this);var idx=$this.prevAll("button").length;buttons[idx].callback(arguments);})
if(this.file){this.loadFile();}},getButtons:function(){var myself=this;var _extraButtons=this.extraButtons||[];_.chain(this.defaultButtons).each(function(b){b.callback=_.bind(b.callback,myself);})
return this.defaultButtons.concat(_extraButtons);},setFile:function(_file){this.file=_file;},getFile:function(){return this.file;},loadFile:function(){var myself=this;$('button.save',this.$ph).attr('disabled',true);this.externalEditor=$('iframe',this.$ph);var headerHeight=$('.textEditorControls',this.$ph).height()+$('.textEditorNotification',this.$ph).height();var editorHeight=this.$ph.height()-headerHeight-5;this.externalEditor.height(editorHeight);this.externalEditor.load(function()
{var editorEnv=myself.getEditorWindow();editorEnv.listeners.onStatusUpdate=myself.setDirty;editorEnv.listeners.notify=function(msg,type){myself.notify(msg);}
$('#notifications').hide();});this.externalEditor.attr('src','../pentaho-cdf-dd/extEditor?path='+this.file+'&theme=ace/theme/eclipse&editorOnly=true');},notify:function(msg,level){var $notifications=this.$ph.find(".textEditorNotificationMsg");$notifications.text(msg);$notifications.show().delay(4000).fadeOut('slow');},setDirty:function(isDirty){$('button.save',this.$ph).attr('disabled',!isDirty);},getEditorWindow:function(){return this.externalEditor[0].contentWindow;},save:function(){this.getEditorWindow().save();},getRightPanel:function(){return this.$ph.find(".textEditorRightPanel");},toggleRightPanel:function(){this.getRightPanel().toggle();this.isRightPanelShown=!this.isRightPanelShown;this.getEditorWindow().editor.getEditor().resize();return this.isRightPanelShown;}});var PopupTextEditorComponent=BaseComponent.extend({$ph:undefined,isInitialized:false,textEditor:undefined,textEditorPopupId:"popupTextEditorId",isQueryPreviewShown:false,testPromptPopup:undefined,$testPromptPopupObj:undefined,defaultButtons:[{clazz:"run",label:"Preview Test",callback:function(){this.runTest();}},{clazz:"previewQuery",label:"Query results",callback:function(){this.toggleQueryResults();}},{clazz:"close",label:"Close",callback:function(){this.hide();}}],initialize:function(){Dashboards.log("Initializing PopupTextEditorComponent")
this.isInitialized=true;this.$ph=$("#"+this.textEditorPopupId);if(this.$ph.length>0){Dashboards.log("[PopupTextEditorComponent] Unexpected - Found an element with id "+this.popupTextEditorDefautlId)}
else{this.$ph=$("<div id='"+this.textEditorPopupId+"'></div>").appendTo("body");}
this.textEditor={name:"popupInnerTextEditorComponent",type:"textEditor",file:undefined,htmlObject:this.textEditorPopupId,extraButtons:this.getButtons(),saveCallback:this.saveCallback};Dashboards.addComponents([this.textEditor]);},update:function(){var myself=this;this.isQueryPreviewShown=false;if(!this.isInitialized){myself.initialize();}
this.textEditor.update();},show:function(){this.$ph.find(">div.textEditorComponent").height($(window).height());this.$ph.slideDown();},hide:function(){this.$ph.slideUp();},runTest:function(){var env=this.setupEnvironment();if(env){var test=this.getTestToOperate(env,this.runTestCallback,$("button.previewQuery",this.$ph));}},runTestCallback:function(env,test){var myself=this;this.textEditor.notify("Running test...");env.cdv.runTest(test,{callback:function(result){myself.textEditor.notify(result.getTestResultDescription());}});},toggleQueryResults:function(){if(this.isQueryPreviewShown){this.isQueryPreviewShown=this.textEditor.toggleRightPanel();return;}
var env=this.setupEnvironment();if(env){var test=this.getTestToOperate(env,this.toggleQueryResultsCallback,$("button.run",this.$ph));}},toggleQueryResultsCallback:function(env,test){var myself=this;this.textEditor.notify("Running query...");env.cdv.executeQuery(test,null,function(test,opts,queryResult){myself.textEditor.notify("Queries ran in "+queryResult.duration+"ms");myself.textEditor.getRightPanel().html("<pre>"+JSON.stringify(queryResult.resultset,undefined,2)+"</pre>");myself.isQueryPreviewShown=myself.textEditor.toggleRightPanel();wd.log("Toggling!");});},getButtons:function(){var myself=this;var _extraButtons=this.extraButtons||[];_.chain(this.defaultButtons).each(function(b){b.callback=_.bind(b.callback,myself);})
return this.defaultButtons.concat(_extraButtons);},setFile:function(_file){this.file=_file;this.textEditor.setFile(_file);},setupEnvironment:function(){var src=this.textEditor.getEditorWindow().editor.getContents();var mask={cdv:wd.cdv.cdv({isServerSide:false})};for(p in this)
mask[p]=undefined;try{(new Function("with(this) { "+src+"}")).call(mask);}
catch(err){alert(err);return null;}
return mask;},getTestToOperate:function(env,operationCallback,target){var myself=this;var flattenedTests=env.cdv.listTestsFlatten().sort(function(a,b){return(a.group+a.name)>=(b.group+b.name)});if(flattenedTests.length==1){operationCallback.call(myself,env,env.cdv.getTest(flattenedTests[0].group,flattenedTests[0].name));return;}
if(!this.testPromptPopup){this.testPromptPopup={name:"testPromptPopup",type:"popup",htmlObject:'testPromptPopupObj',gravity:"S",draggable:false,closeOnClickOutside:true}
this.$testPromptPopupObj=$("<div id='testPromptPopupObj'></div>").appendTo("body");Dashboards.addComponents([this.testPromptPopup]);this.testPromptPopup.update();this.$testPromptPopupObj.parent("div.popupComponent").addClass("testPromptPopup");}
var template='<div class="testChooserWrapper"><div class="title">Multiple tests found. Choose the one you want:</div>'+'<div class="testChooserButtons">{{#tests}}<button> {{group}} - {{name}}</button>{{/tests}}</div></div>'
this.$testPromptPopupObj.html(Mustache.render(template,{tests:flattenedTests}));this.$testPromptPopupObj.off("click","button");this.$testPromptPopupObj.on("click","button",function(evt){var idx=$(this).prevAll("button").length;operationCallback.call(myself,env,env.cdv.getTest(flattenedTests[idx].group,flattenedTests[idx].name));myself.testPromptPopup.hide();})
this.testPromptPopup.popup(target);return;}});var wd=wd||{}
wd.cdf=wd.cdf||{};wd.cdf.views=wd.cdf.views||{};var templates=templates||{};templates.dashboardViews=templates.dashboardViews||{};wd.cdf.views.getUrl=function(){var params=$.param({file:this.file,path:this.path,solution:this.solution,view:this.name}).replace(/\+/g,"%20");if(/\.(wcdf|cdfde)$/.test(this.file)){return webAppPath+"/content/pentaho-cdf-dd/Render?"+params}else{return webAppPath+"/content/pentaho-cdf/renderWcdf?"+params}};wd.cdf.views.DashboardView=Backbone.Model.extend({defaults:{"id":"","name":"","description":"","key":null,"params":{},"unbound":[],"user":"","solution":"","path":"","file":"","url":wd.cdf.views.getUrl,"timestamp":0},isSynced:function(){var modelParams=this.get("parameters"),dashboardParams=Dashboards.getViewParameters();if(Object.keys(modelParams).length!==Object.keys(dashboardParams).length){return false;}
for(p in modelParams)if(modelParams.hasOwnProperty(p)){if(!dashboardParams.hasOwnProperty(p)||dashboardParams[p]!==modelParams[p]){return false;}}
return true;},syncWithDashboard:function(){this.set("parameters",Dashboards.getViewParameters());}});wd.cdf.views.Report=Backbone.Model.extend({defaults:{"name":"","label":"","dashboardView":null,"params":{},"user":"","timestamp":0}});wd.cdf.views.newDashboardView=function(name,description){var m={id:name,name:name,description:description,params:Dashboards.getViewParameters(),unbound:Dashboards.getUnboundParameters(),user:Dashboards.context.user,solution:Dashboards.context.solution,path:Dashboards.context.path,file:Dashboards.context.file,timestamp:(new Date()).getTime()};return new wd.cdf.views.DashboardView(m);};wd.cdf.views.ViewManager=Backbone.Model.extend({defaults:{"currentView":"Unsaved View","views":null,"viewCount":0,},initViews:function(views){if(Dashboards.view){this.set("currentView",Dashboards.view.name,{silent:true});}
var viewCollection=new Backbone.Collection();viewCollection.model=wd.cdf.views.DashboardView;viewCollection.reset(views);this.set("views",viewCollection,{silent:true});this.set("viewCount",viewCollection.size(),{silent:true});this.change();}});wd.cdf.views.ViewManagerView=Backbone.View.extend({events:{'click .tab':"clickTab",'click .manage-views, .save-panel .cancel':"toggleViewManager",'click .view-item .delete':"deleteView",'click .save-panel .save':"save"},tabs:[{label:"List",selector:".list-panel",template:"viewListPanel"},{label:"Save",selector:".save-panel",template:"viewSavePanel"}],initialize:function(){this.configureListeners();},clickTab:function(evt){var $tgt=$(evt.target),selector=$tgt.data('target');this.$(".tab").removeClass("selected");$tgt.addClass("selected");this.$('.panel').hide();this.$(selector).show();},configureListeners:function(){this.model.on("change",this.render,this);},renderTabs:function(){var tabs=this.$(".tabs").empty(),tabContents=this.$(".tab-contents").empty();_(this.tabs).each(function(t){tabs.append(templates.viewManagerTab(t));tabContents.append(templates[t.template](this.model.toJSON()));},this);tabs.children().slice(0,1).addClass('selected');tabContents.children().slice(1).hide();},renderViewList:function(){var $views=this.$(".list-panel .views").empty();this.model.get("views").each(function(e){var $view=$(templates.viewListItem(e.toJSON()));$view.data("model",e);$views.append($view);});},toggleViewManager:function(){this.$('.manage-views').toggleClass("active");this.$('.view-manager').toggle();},render:function(){this.$el.html(templates.viewManager(this.model.toJSON()));this.renderTabs();this.renderViewList();this.$(".view-manager").hide();},save:function(){var name=this.$(".save-properties .name").val(),desc=this.$(".save-properties .description").val(),view=wd.cdf.views.newDashboardView(name,desc).toJSON(),args;view.params=Base64.encode(JSON.stringify(view.params)),old=this.model.get("views").filter(function(m){return m.get("name")==name})[0];if(old){view.key=old.get("key");}
args={method:"saveView",view:JSON.stringify(view)};var myself=this;$.post(webAppPath+"/content/pentaho-cdf/Views",$.param(args),function(){Dashboards.view=view;myself.model.set("currentView",name);myself.model.trigger("update");});},deleteView:function(evt){var view=$(evt.target).parent().data("model"),args={method:"deleteView",name:view.get("name")};var myself=this;$.post(webAppPath+"/content/pentaho-cdf/Views",$.param(args),function(){myself.model.get("views").remove(view);myself.model.trigger("update");});},});templates.viewManager=Mustache.compile("<div class='view-manager-component'>"+" <div class='current-view'>"+"   <span class='label'>Current View: </span>"+"   <span class='value'>{{currentView}}</span>"+" </div>"+" <div class='big-button manage-views'>Manage Views</div>"+" <div class='view-manager'>"+"   <div class='tabs'></div>"+"   <div class='tab-contents'></div>"+" </div>"+"</div>");templates.viewManagerTab=Mustache.compile("<div class='tab' data-target='{{selector}}'>"+"{{label}}"+"</div>");templates.viewListPanel=Mustache.compile("<div class='list-panel panel'>"+" <div class='total-views'>"+"   <span class='label'>Total Views: </span>"+"   <span class='value'>{{viewCount}}</span>"+" </div>"+" <div class='views'></div>"+" <div class='view-all'>"+"   <span class='label'>View All</span>"+"   <span class='description'>(go to View Manager)</span>"+" </div>"+"</div>");templates.viewListItem=Mustache.compile("<div class='view-item'>"+" <a class='name' href='{{url}}'>{{name}}</a>"+" <span class='delete'></span>"+"</div>");templates.viewSubscriptionPanel=Mustache.compile("<div class='subscrition-panel panel'>"+" <div class='current-view'>"+"   <span class='label'>Current View:</span>"+"   <span class='value'></span>"+" </div>"+" <div class='unsaved'>"+"   <div>Your current view is not saved. To subscribe,"+"     you must first save it. Do you wish to proceed?"+"   </div>"+"   <div class='button save'>Save</div>"+"   <div class='button cancel'>Cancel</div>"+" </div>"+" <div class='subscription-properties'>"+"   <span class='label'></span>"+"   <input type='radio'>"+" </div>"+"</div>");templates.viewSavePanel=Mustache.compile("<div class='save-panel panel'>"+" <div class='current-view'>"+"   <span class='label'>Current View:</span>"+"   <span class='value'>{{currentView}}</span>"+" </div>"+" <div class='save-properties'>"+"   <div><span class='label'>Title</span><input type='text' class='name' value='{{currentView}}'></div>"+"   <div><span class='label'>Description</span><textarea class='description' placeholder='Enter a description'>{{description}}</textarea></div>"+" </div>"+" <div class='save-actions'>"+"   <div class='big-button active save'>Save</div>"+"   <div class='big-button cancel'>Cancel</div>"+" </div>"+"</div>");var viewManagerComponent=BaseComponent.extend({update:function(){function fetchData(){$.ajax({url:webAppPath+"/content/pentaho-cdf/Views",data:{method:"listViews"},dataType:'json',success:function(response){myself.model.initViews(response.views);myself.view.render();},cache:false});};this.ph=$("#"+this.htmlObject);this.model=new wd.cdf.views.ViewManager();this.view=new wd.cdf.views.ViewManagerView({el:this.ph.get(0),model:this.model});var myself=this;fetchData();this.model.on("update",fetchData,this);}});